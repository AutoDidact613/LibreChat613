{"version":3,"file":"index.es.js","sources":["../../src/types/assistants.ts","../../src/feedback.ts","../../src/schemas.ts","../../src/models.ts","../../src/file-config.ts","../../src/types/files.ts","../../src/types/agents.ts","../../src/utils.ts","../../src/mcp.ts","../../src/api-endpoints.ts","../../src/config.ts","../../src/request.ts","../../src/headers-helpers.ts","../../src/data-service.ts","../../src/keys.ts","../../src/accessPermissions.ts","../../src/react-query/react-query-service.ts"],"sourcesContent":["import type { OpenAPIV3 } from 'openapi-types';\r\nimport type { AssistantsEndpoint, AgentProvider } from 'src/schemas';\r\nimport type { ContentTypes } from './runs';\r\nimport type { Agents } from './agents';\r\nimport type { TFile } from './files';\r\nimport { ArtifactModes } from 'src/artifacts';\r\n\r\nexport type Schema = OpenAPIV3.SchemaObject & { description?: string };\r\nexport type Reference = OpenAPIV3.ReferenceObject & { description?: string };\r\n\r\nexport type Metadata = {\r\n  avatar?: string;\r\n  author?: string;\r\n} & {\r\n  [key: string]: unknown;\r\n};\r\n\r\nexport enum Tools {\r\n  execute_code = 'execute_code',\r\n  code_interpreter = 'code_interpreter',\r\n  file_search = 'file_search',\r\n  web_search = 'web_search',\r\n  retrieval = 'retrieval',\r\n  function = 'function',\r\n  memory = 'memory',\r\n  ui_resources = 'ui_resources',\r\n}\r\n\r\nexport enum EToolResources {\r\n  code_interpreter = 'code_interpreter',\r\n  execute_code = 'execute_code',\r\n  file_search = 'file_search',\r\n  image_edit = 'image_edit',\r\n  context = 'context',\r\n  ocr = 'ocr',\r\n}\r\n\r\nexport type Tool = {\r\n  [type: string]: Tools;\r\n};\r\n\r\nexport type FunctionTool = {\r\n  type: Tools;\r\n  function?: {\r\n    description: string;\r\n    name: string;\r\n    parameters: Record<string, unknown>;\r\n    strict?: boolean;\r\n    additionalProperties?: boolean; // must be false if strict is true https://platform.openai.com/docs/guides/structured-outputs/some-type-specific-keywords-are-not-yet-supported\r\n  };\r\n};\r\n\r\n/**\r\n * A set of resources that are used by the assistant's tools. The resources are\r\n * specific to the type of tool. For example, the `code_interpreter` tool requires\r\n * a list of file IDs, while the `file_search` tool requires a list of vector store\r\n * IDs.\r\n */\r\nexport interface ToolResources {\r\n  code_interpreter?: CodeInterpreterResource;\r\n  file_search?: FileSearchResource;\r\n}\r\nexport interface CodeInterpreterResource {\r\n  /**\r\n   * A list of [file](https://platform.openai.com/docs/api-reference/files) IDs made\r\n   * available to the `code_interpreter`` tool. There can be a maximum of 20 files\r\n   * associated with the tool.\r\n   */\r\n  file_ids?: Array<string>;\r\n}\r\n\r\nexport interface FileSearchResource {\r\n  /**\r\n   * The ID of the\r\n   * [vector store](https://platform.openai.com/docs/api-reference/vector-stores/object)\r\n   * attached to this assistant. There can be a maximum of 1 vector store attached to\r\n   * the assistant.\r\n   */\r\n  vector_store_ids?: Array<string>;\r\n}\r\n\r\n/* Assistant types */\r\n\r\nexport type Assistant = {\r\n  id: string;\r\n  created_at: number;\r\n  description: string | null;\r\n  file_ids?: string[];\r\n  instructions: string | null;\r\n  conversation_starters?: string[];\r\n  metadata: Metadata | null;\r\n  model: string;\r\n  name: string | null;\r\n  object: string;\r\n  tools?: FunctionTool[];\r\n  tool_resources?: ToolResources;\r\n};\r\n\r\nexport type TAssistantsMap = Record<AssistantsEndpoint, Record<string, Assistant>>;\r\n\r\nexport type AssistantCreateParams = {\r\n  model: string;\r\n  description?: string | null;\r\n  file_ids?: string[];\r\n  instructions?: string | null;\r\n  conversation_starters?: string[];\r\n  metadata?: Metadata | null;\r\n  name?: string | null;\r\n  tools?: Array<FunctionTool | string>;\r\n  endpoint: AssistantsEndpoint;\r\n  version: number | string;\r\n  append_current_datetime?: boolean;\r\n};\r\n\r\nexport type AssistantUpdateParams = {\r\n  model?: string;\r\n  description?: string | null;\r\n  file_ids?: string[];\r\n  instructions?: string | null;\r\n  conversation_starters?: string[] | null;\r\n  metadata?: Metadata | null;\r\n  name?: string | null;\r\n  tools?: Array<FunctionTool | string>;\r\n  tool_resources?: ToolResources;\r\n  endpoint: AssistantsEndpoint;\r\n  append_current_datetime?: boolean;\r\n};\r\n\r\nexport type AssistantListParams = {\r\n  limit?: number;\r\n  before?: string | null;\r\n  after?: string | null;\r\n  order?: 'asc' | 'desc';\r\n  endpoint: AssistantsEndpoint;\r\n};\r\n\r\nexport type AssistantListResponse = {\r\n  object: string;\r\n  data: Assistant[];\r\n  first_id: string;\r\n  last_id: string;\r\n  has_more: boolean;\r\n};\r\n\r\nexport type File = {\r\n  file_id: string;\r\n  id?: string;\r\n  temp_file_id?: string;\r\n  bytes: number;\r\n  created_at: number;\r\n  filename: string;\r\n  object: string;\r\n  purpose: 'fine-tune' | 'fine-tune-results' | 'assistants' | 'assistants_output';\r\n};\r\n\r\n/* Agent types */\r\n\r\nexport type AgentParameterValue = number | string | null;\r\n\r\nexport type AgentModelParameters = {\r\n  model?: string;\r\n  temperature: AgentParameterValue;\r\n  maxContextTokens: AgentParameterValue;\r\n  max_context_tokens: AgentParameterValue;\r\n  max_output_tokens: AgentParameterValue;\r\n  top_p: AgentParameterValue;\r\n  frequency_penalty: AgentParameterValue;\r\n  presence_penalty: AgentParameterValue;\r\n};\r\n\r\nexport interface AgentBaseResource {\r\n  /**\r\n   * A list of file IDs made available to the tool.\r\n   */\r\n  file_ids?: Array<string>;\r\n  /**\r\n   * A list of files already fetched.\r\n   */\r\n  files?: Array<TFile>;\r\n}\r\n\r\nexport interface AgentToolResources {\r\n  [EToolResources.image_edit]?: AgentBaseResource;\r\n  [EToolResources.execute_code]?: ExecuteCodeResource;\r\n  [EToolResources.file_search]?: AgentFileResource;\r\n  [EToolResources.context]?: AgentBaseResource;\r\n  /** @deprecated Use context instead */\r\n  [EToolResources.ocr]?: AgentBaseResource;\r\n}\r\n/**\r\n * A resource for the execute_code tool.\r\n * Contains file IDs made available to the tool (max 20 files) and already fetched files.\r\n */\r\nexport type ExecuteCodeResource = AgentBaseResource;\r\n\r\nexport interface AgentFileResource extends AgentBaseResource {\r\n  /**\r\n   * The ID of the vector store attached to this agent. There\r\n   * can be a maximum of 1 vector store attached to the agent.\r\n   */\r\n  vector_store_ids?: Array<string>;\r\n}\r\nexport type SupportContact = {\r\n  name?: string;\r\n  email?: string;\r\n};\r\n\r\nexport type Agent = {\r\n  _id?: string;\r\n  id: string;\r\n  name: string | null;\r\n  author?: string | null;\r\n  /** The original custom endpoint name, lowercased */\r\n  endpoint?: string | null;\r\n  authorName?: string | null;\r\n  description: string | null;\r\n  created_at: number;\r\n  avatar: AgentAvatar | null;\r\n  instructions: string | null;\r\n  additional_instructions?: string | null;\r\n  tools?: string[];\r\n  projectIds?: string[];\r\n  tool_kwargs?: Record<string, unknown>;\r\n  metadata?: Record<string, unknown>;\r\n  provider: AgentProvider;\r\n  model: string | null;\r\n  model_parameters: AgentModelParameters;\r\n  conversation_starters?: string[];\r\n  /** @deprecated Use ACL permissions instead */\r\n  isCollaborative?: boolean;\r\n  tool_resources?: AgentToolResources;\r\n  agent_ids?: string[];\r\n  end_after_tools?: boolean;\r\n  hide_sequential_outputs?: boolean;\r\n  artifacts?: ArtifactModes;\r\n  recursion_limit?: number;\r\n  isPublic?: boolean;\r\n  version?: number;\r\n  category?: string;\r\n  support_contact?: SupportContact;\r\n};\r\n\r\nexport type TAgentsMap = Record<string, Agent | undefined>;\r\n\r\nexport type AgentCreateParams = {\r\n  name?: string | null;\r\n  description?: string | null;\r\n  avatar?: AgentAvatar | null;\r\n  file_ids?: string[];\r\n  instructions?: string | null;\r\n  tools?: Array<FunctionTool | string>;\r\n  provider: AgentProvider;\r\n  model: string | null;\r\n  model_parameters: AgentModelParameters;\r\n} & Pick<\r\n  Agent,\r\n  | 'agent_ids'\r\n  | 'end_after_tools'\r\n  | 'hide_sequential_outputs'\r\n  | 'artifacts'\r\n  | 'recursion_limit'\r\n  | 'category'\r\n  | 'support_contact'\r\n>;\r\n\r\nexport type AgentUpdateParams = {\r\n  name?: string | null;\r\n  description?: string | null;\r\n  avatar?: AgentAvatar | null;\r\n  file_ids?: string[];\r\n  instructions?: string | null;\r\n  tools?: Array<FunctionTool | string>;\r\n  tool_resources?: ToolResources;\r\n  provider?: AgentProvider;\r\n  model?: string | null;\r\n  model_parameters?: AgentModelParameters;\r\n  projectIds?: string[];\r\n  removeProjectIds?: string[];\r\n  isCollaborative?: boolean;\r\n} & Pick<\r\n  Agent,\r\n  | 'agent_ids'\r\n  | 'end_after_tools'\r\n  | 'hide_sequential_outputs'\r\n  | 'artifacts'\r\n  | 'recursion_limit'\r\n  | 'category'\r\n  | 'support_contact'\r\n>;\r\n\r\nexport type AgentListParams = {\r\n  limit?: number;\r\n  requiredPermission: number;\r\n  category?: string;\r\n  search?: string;\r\n  cursor?: string;\r\n  promoted?: 0 | 1;\r\n};\r\n\r\nexport type AgentListResponse = {\r\n  object: string;\r\n  data: Agent[];\r\n  first_id: string;\r\n  last_id: string;\r\n  has_more: boolean;\r\n  after?: string;\r\n};\r\n\r\nexport type AgentFile = {\r\n  file_id: string;\r\n  id?: string;\r\n  temp_file_id?: string;\r\n  bytes: number;\r\n  created_at: number;\r\n  filename: string;\r\n  object: string;\r\n  purpose: 'fine-tune' | 'fine-tune-results' | 'agents' | 'agents_output';\r\n};\r\n\r\n/**\r\n * Details of the Code Interpreter tool call the run step was involved in.\r\n * Includes the tool call ID, the code interpreter definition, and the type of tool call.\r\n */\r\nexport type CodeToolCall = {\r\n  id: string; // The ID of the tool call.\r\n  code_interpreter: {\r\n    input: string; // The input to the Code Interpreter tool call.\r\n    outputs: Array<Record<string, unknown>>; // The outputs from the Code Interpreter tool call.\r\n  };\r\n  type: 'code_interpreter'; // The type of tool call, always 'code_interpreter'.\r\n};\r\n\r\n/**\r\n * Details of a Function tool call the run step was involved in.\r\n * Includes the tool call ID, the function definition, and the type of tool call.\r\n */\r\nexport type FunctionToolCall = {\r\n  id: string; // The ID of the tool call object.\r\n  function: {\r\n    arguments: string; // The arguments passed to the function.\r\n    name: string; // The name of the function.\r\n    output: string | null; // The output of the function, null if not submitted.\r\n  };\r\n  type: 'function'; // The type of tool call, always 'function'.\r\n};\r\n\r\n/**\r\n * Details of a Retrieval tool call the run step was involved in.\r\n * Includes the tool call ID and the type of tool call.\r\n */\r\nexport type RetrievalToolCall = {\r\n  id: string; // The ID of the tool call object.\r\n  retrieval: unknown; // An empty object for now.\r\n  type: 'retrieval'; // The type of tool call, always 'retrieval'.\r\n};\r\n\r\n/**\r\n * Details of a Retrieval tool call the run step was involved in.\r\n * Includes the tool call ID and the type of tool call.\r\n */\r\nexport type FileSearchToolCall = {\r\n  id: string; // The ID of the tool call object.\r\n  file_search: unknown; // An empty object for now.\r\n  type: 'file_search'; // The type of tool call, always 'retrieval'.\r\n};\r\n\r\n/**\r\n * Details of the tool calls involved in a run step.\r\n * Can be associated with one of three types of tools: `code_interpreter`, `retrieval`, or `function`.\r\n */\r\nexport type ToolCallsStepDetails = {\r\n  tool_calls: Array<CodeToolCall | RetrievalToolCall | FileSearchToolCall | FunctionToolCall>; // An array of tool calls the run step was involved in.\r\n  type: 'tool_calls'; // Always 'tool_calls'.\r\n};\r\n\r\nexport type ImageFile = TFile & {\r\n  /**\r\n   * The [File](https://platform.openai.com/docs/api-reference/files) ID of the image\r\n   * in the message content.\r\n   */\r\n  file_id: string;\r\n  filename: string;\r\n  filepath: string;\r\n  height: number;\r\n  width: number;\r\n  /**\r\n   * Prompt used to generate the image if applicable.\r\n   */\r\n  prompt?: string;\r\n  /**\r\n   * Additional metadata used to generate or about the image/tool_call.\r\n   */\r\n  metadata?: Record<string, unknown>;\r\n};\r\n\r\n// FileCitation.ts\r\nexport type FileCitation = {\r\n  end_index: number;\r\n  file_citation: FileCitationDetails;\r\n  start_index: number;\r\n  text: string;\r\n  type: 'file_citation';\r\n};\r\n\r\nexport type FileCitationDetails = {\r\n  file_id: string;\r\n  quote: string;\r\n};\r\n\r\nexport type FilePath = {\r\n  end_index: number;\r\n  file_path: FilePathDetails;\r\n  start_index: number;\r\n  text: string;\r\n  type: 'file_path';\r\n};\r\n\r\nexport type FilePathDetails = {\r\n  file_id: string;\r\n};\r\n\r\nexport type Text = {\r\n  annotations?: Array<FileCitation | FilePath>;\r\n  value: string;\r\n};\r\n\r\nexport enum AnnotationTypes {\r\n  FILE_CITATION = 'file_citation',\r\n  FILE_PATH = 'file_path',\r\n}\r\n\r\nexport enum StepStatus {\r\n  IN_PROGRESS = 'in_progress',\r\n  CANCELLED = 'cancelled',\r\n  FAILED = 'failed',\r\n  COMPLETED = 'completed',\r\n  EXPIRED = 'expired',\r\n}\r\n\r\nexport enum MessageContentTypes {\r\n  TEXT = 'text',\r\n  IMAGE_FILE = 'image_file',\r\n}\r\n\r\n//enum for RunStatus\r\n// The status of the run: queued, in_progress, requires_action, cancelling, cancelled, failed, completed, or expired.\r\nexport enum RunStatus {\r\n  QUEUED = 'queued',\r\n  IN_PROGRESS = 'in_progress',\r\n  REQUIRES_ACTION = 'requires_action',\r\n  CANCELLING = 'cancelling',\r\n  CANCELLED = 'cancelled',\r\n  FAILED = 'failed',\r\n  COMPLETED = 'completed',\r\n  EXPIRED = 'expired',\r\n}\r\n\r\nexport type PartMetadata = {\r\n  progress?: number;\r\n  asset_pointer?: string;\r\n  status?: string;\r\n  action?: boolean;\r\n  auth?: string;\r\n  expires_at?: number;\r\n};\r\n\r\nexport type ContentPart = (\r\n  | CodeToolCall\r\n  | RetrievalToolCall\r\n  | FileSearchToolCall\r\n  | FunctionToolCall\r\n  | Agents.AgentToolCall\r\n  | ImageFile\r\n  | Text\r\n) &\r\n  PartMetadata;\r\n\r\nexport type TMessageContentParts =\r\n  | { type: ContentTypes.ERROR; text?: string | (Text & PartMetadata); error?: string }\r\n  | { type: ContentTypes.THINK; think: string | (Text & PartMetadata) }\r\n  | { type: ContentTypes.TEXT; text: string | (Text & PartMetadata); tool_call_ids?: string[] }\r\n  | {\r\n      type: ContentTypes.TOOL_CALL;\r\n      tool_call: (\r\n        | CodeToolCall\r\n        | RetrievalToolCall\r\n        | FileSearchToolCall\r\n        | FunctionToolCall\r\n        | Agents.AgentToolCall\r\n      ) &\r\n        PartMetadata;\r\n    }\r\n  | { type: ContentTypes.IMAGE_FILE; image_file: ImageFile & PartMetadata }\r\n  | Agents.AgentUpdate\r\n  | Agents.MessageContentImageUrl;\r\n\r\nexport type StreamContentData = TMessageContentParts & {\r\n  /** The index of the current content part */\r\n  index: number;\r\n  /** The current text content was already served but edited to replace elements therein */\r\n  edited?: boolean;\r\n};\r\n\r\nexport type TContentData = StreamContentData & {\r\n  messageId: string;\r\n  conversationId: string;\r\n  userMessageId: string;\r\n  thread_id: string;\r\n  stream?: boolean;\r\n};\r\n\r\nexport const actionDelimiter = '_action_';\r\nexport const actionDomainSeparator = '---';\r\nexport const hostImageIdSuffix = '_host_copy';\r\nexport const hostImageNamePrefix = 'host_copy_';\r\n\r\nexport type AssistantAvatar = {\r\n  filepath: string;\r\n  source: string;\r\n};\r\n\r\nexport type AssistantDocument = {\r\n  user: string;\r\n  assistant_id: string;\r\n  conversation_starters?: string[];\r\n  avatar?: AssistantAvatar;\r\n  access_level?: number;\r\n  file_ids?: string[];\r\n  actions?: string[];\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n  append_current_datetime?: boolean;\r\n};\r\n\r\n/* Agent types */\r\n\r\nexport type AgentAvatar = {\r\n  filepath: string;\r\n  source: string;\r\n};\r\n\r\nexport enum FilePurpose {\r\n  Vision = 'vision',\r\n  FineTune = 'fine-tune',\r\n  FineTuneResults = 'fine-tune-results',\r\n  Assistants = 'assistants',\r\n  AssistantsOutput = 'assistants_output',\r\n}\r\n\r\nexport const defaultOrderQuery: {\r\n  order: 'desc';\r\n  limit: 100;\r\n} = {\r\n  order: 'desc',\r\n  limit: 100,\r\n};\r\n\r\nexport enum AssistantStreamEvents {\r\n  ThreadCreated = 'thread.created',\r\n  ThreadRunCreated = 'thread.run.created',\r\n  ThreadRunQueued = 'thread.run.queued',\r\n  ThreadRunInProgress = 'thread.run.in_progress',\r\n  ThreadRunRequiresAction = 'thread.run.requires_action',\r\n  ThreadRunCompleted = 'thread.run.completed',\r\n  ThreadRunFailed = 'thread.run.failed',\r\n  ThreadRunCancelling = 'thread.run.cancelling',\r\n  ThreadRunCancelled = 'thread.run.cancelled',\r\n  ThreadRunExpired = 'thread.run.expired',\r\n  ThreadRunStepCreated = 'thread.run.step.created',\r\n  ThreadRunStepInProgress = 'thread.run.step.in_progress',\r\n  ThreadRunStepCompleted = 'thread.run.step.completed',\r\n  ThreadRunStepFailed = 'thread.run.step.failed',\r\n  ThreadRunStepCancelled = 'thread.run.step.cancelled',\r\n  ThreadRunStepExpired = 'thread.run.step.expired',\r\n  ThreadRunStepDelta = 'thread.run.step.delta',\r\n  ThreadMessageCreated = 'thread.message.created',\r\n  ThreadMessageInProgress = 'thread.message.in_progress',\r\n  ThreadMessageCompleted = 'thread.message.completed',\r\n  ThreadMessageIncomplete = 'thread.message.incomplete',\r\n  ThreadMessageDelta = 'thread.message.delta',\r\n  ErrorEvent = 'error',\r\n}\r\n","import { z } from 'zod';\r\n\r\nexport type TFeedbackRating = 'thumbsUp' | 'thumbsDown';\r\nexport const FEEDBACK_RATINGS = ['thumbsUp', 'thumbsDown'] as const;\r\n\r\nexport const FEEDBACK_REASON_KEYS = [\r\n  // Down\r\n  'not_matched',\r\n  'inaccurate',\r\n  'bad_style',\r\n  'missing_image',\r\n  'unjustified_refusal',\r\n  'not_helpful',\r\n  'other',\r\n  // Up\r\n  'accurate_reliable',\r\n  'creative_solution',\r\n  'clear_well_written',\r\n  'attention_to_detail',\r\n] as const;\r\n\r\nexport type TFeedbackTagKey = (typeof FEEDBACK_REASON_KEYS)[number];\r\n\r\nexport interface TFeedbackTag {\r\n  key: TFeedbackTagKey;\r\n  label: string;\r\n  direction: TFeedbackRating;\r\n  icon: string;\r\n}\r\n\r\n// --- Tag Registry ---\r\nexport const FEEDBACK_TAGS: TFeedbackTag[] = [\r\n  // Thumbs Down\r\n  {\r\n    key: 'not_matched',\r\n    label: 'com_ui_feedback_tag_not_matched',\r\n    direction: 'thumbsDown',\r\n    icon: 'AlertCircle',\r\n  },\r\n  {\r\n    key: 'inaccurate',\r\n    label: 'com_ui_feedback_tag_inaccurate',\r\n    direction: 'thumbsDown',\r\n    icon: 'AlertCircle',\r\n  },\r\n  {\r\n    key: 'bad_style',\r\n    label: 'com_ui_feedback_tag_bad_style',\r\n    direction: 'thumbsDown',\r\n    icon: 'PenTool',\r\n  },\r\n  {\r\n    key: 'missing_image',\r\n    label: 'com_ui_feedback_tag_missing_image',\r\n    direction: 'thumbsDown',\r\n    icon: 'ImageOff',\r\n  },\r\n  {\r\n    key: 'unjustified_refusal',\r\n    label: 'com_ui_feedback_tag_unjustified_refusal',\r\n    direction: 'thumbsDown',\r\n    icon: 'Ban',\r\n  },\r\n  {\r\n    key: 'not_helpful',\r\n    label: 'com_ui_feedback_tag_not_helpful',\r\n    direction: 'thumbsDown',\r\n    icon: 'ThumbsDown',\r\n  },\r\n  {\r\n    key: 'other',\r\n    label: 'com_ui_feedback_tag_other',\r\n    direction: 'thumbsDown',\r\n    icon: 'HelpCircle',\r\n  },\r\n  // Thumbs Up\r\n  {\r\n    key: 'accurate_reliable',\r\n    label: 'com_ui_feedback_tag_accurate_reliable',\r\n    direction: 'thumbsUp',\r\n    icon: 'CheckCircle',\r\n  },\r\n  {\r\n    key: 'creative_solution',\r\n    label: 'com_ui_feedback_tag_creative_solution',\r\n    direction: 'thumbsUp',\r\n    icon: 'Lightbulb',\r\n  },\r\n  {\r\n    key: 'clear_well_written',\r\n    label: 'com_ui_feedback_tag_clear_well_written',\r\n    direction: 'thumbsUp',\r\n    icon: 'PenTool',\r\n  },\r\n  {\r\n    key: 'attention_to_detail',\r\n    label: 'com_ui_feedback_tag_attention_to_detail',\r\n    direction: 'thumbsUp',\r\n    icon: 'Search',\r\n  },\r\n];\r\n\r\nexport function getTagsForRating(rating: TFeedbackRating): TFeedbackTag[] {\r\n  return FEEDBACK_TAGS.filter((tag) => tag.direction === rating);\r\n}\r\n\r\nexport const feedbackTagKeySchema = z.enum(FEEDBACK_REASON_KEYS);\r\nexport const feedbackRatingSchema = z.enum(FEEDBACK_RATINGS);\r\n\r\nexport const feedbackSchema = z.object({\r\n  rating: feedbackRatingSchema,\r\n  tag: feedbackTagKeySchema,\r\n  text: z.string().max(1024).optional(),\r\n});\r\n\r\nexport type TMinimalFeedback = z.infer<typeof feedbackSchema>;\r\n\r\nexport type TFeedback = {\r\n  rating: TFeedbackRating;\r\n  tag: TFeedbackTag | undefined;\r\n  text?: string;\r\n};\r\n\r\nexport function toMinimalFeedback(feedback: TFeedback | undefined): TMinimalFeedback | undefined {\r\n  if (!feedback?.rating || !feedback?.tag || !feedback.tag.key) {\r\n    return undefined;\r\n  }\r\n\r\n  return {\r\n    rating: feedback.rating,\r\n    tag: feedback.tag.key,\r\n    text: feedback.text,\r\n  };\r\n}\r\n\r\nexport function getTagByKey(key: TFeedbackTagKey | undefined): TFeedbackTag | undefined {\r\n  if (!key) {\r\n    return undefined;\r\n  }\r\n  return FEEDBACK_TAGS.find((tag) => tag.key === key);\r\n}\r\n","import { z } from 'zod';\r\nimport { Tools } from './types/assistants';\r\nimport type { TMessageContentParts, FunctionTool, FunctionToolCall } from './types/assistants';\r\nimport { TFeedback, feedbackSchema } from './feedback';\r\nimport type { SearchResultData } from './types/web';\r\nimport type { TFile } from './types/files';\r\n\r\nexport const isUUID = z.string().uuid();\r\n\r\nexport enum AuthType {\r\n  OVERRIDE_AUTH = 'override_auth',\r\n  USER_PROVIDED = 'user_provided',\r\n  SYSTEM_DEFINED = 'system_defined',\r\n}\r\n\r\nexport const authTypeSchema = z.nativeEnum(AuthType);\r\n\r\nexport enum EModelEndpoint {\r\n  azureOpenAI = 'azureOpenAI',\r\n  openAI = 'openAI',\r\n  google = 'google',\r\n  anthropic = 'anthropic',\r\n  assistants = 'assistants',\r\n  azureAssistants = 'azureAssistants',\r\n  agents = 'agents',\r\n  custom = 'custom',\r\n  bedrock = 'bedrock',\r\n  /** @deprecated */\r\n  chatGPTBrowser = 'chatGPTBrowser',\r\n  /** @deprecated */\r\n  gptPlugins = 'gptPlugins',\r\n}\r\n\r\nexport const paramEndpoints = new Set<EModelEndpoint | string>([\r\n  EModelEndpoint.agents,\r\n  EModelEndpoint.openAI,\r\n  EModelEndpoint.bedrock,\r\n  EModelEndpoint.azureOpenAI,\r\n  EModelEndpoint.anthropic,\r\n  EModelEndpoint.custom,\r\n  EModelEndpoint.google,\r\n]);\r\n\r\nexport enum BedrockProviders {\r\n  AI21 = 'ai21',\r\n  Amazon = 'amazon',\r\n  Anthropic = 'anthropic',\r\n  Cohere = 'cohere',\r\n  Meta = 'meta',\r\n  MistralAI = 'mistral',\r\n  StabilityAI = 'stability',\r\n  DeepSeek = 'deepseek',\r\n}\r\n\r\nexport const getModelKey = (endpoint: EModelEndpoint | string, model: string) => {\r\n  if (endpoint === EModelEndpoint.bedrock) {\r\n    const parts = model.split('.');\r\n    const provider = [parts[0], parts[1]].find((part) =>\r\n      Object.values(BedrockProviders).includes(part as BedrockProviders),\r\n    );\r\n    return (provider ?? parts[0]) as BedrockProviders;\r\n  }\r\n  return model;\r\n};\r\n\r\nexport const getSettingsKeys = (endpoint: EModelEndpoint | string, model: string) => {\r\n  const endpointKey = endpoint;\r\n  const modelKey = getModelKey(endpointKey, model);\r\n  const combinedKey = `${endpointKey}-${modelKey}`;\r\n  return [combinedKey, endpointKey];\r\n};\r\n\r\nexport type AssistantsEndpoint = EModelEndpoint.assistants | EModelEndpoint.azureAssistants;\r\n\r\nexport const isAssistantsEndpoint = (_endpoint?: AssistantsEndpoint | null | string): boolean => {\r\n  const endpoint = _endpoint ?? '';\r\n  if (!endpoint) {\r\n    return false;\r\n  }\r\n  return endpoint.toLowerCase().endsWith(EModelEndpoint.assistants);\r\n};\r\n\r\nexport type AgentProvider = Exclude<keyof typeof EModelEndpoint, EModelEndpoint.agents> | string;\r\n\r\nexport const isAgentsEndpoint = (_endpoint?: EModelEndpoint.agents | null | string): boolean => {\r\n  const endpoint = _endpoint ?? '';\r\n  if (!endpoint) {\r\n    return false;\r\n  }\r\n  return endpoint === EModelEndpoint.agents;\r\n};\r\n\r\nexport const isParamEndpoint = (\r\n  endpoint: EModelEndpoint | string,\r\n  endpointType?: EModelEndpoint | string,\r\n): boolean => {\r\n  if (paramEndpoints.has(endpoint)) {\r\n    return true;\r\n  }\r\n\r\n  if (endpointType != null) {\r\n    return paramEndpoints.has(endpointType);\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport enum ImageDetail {\r\n  low = 'low',\r\n  auto = 'auto',\r\n  high = 'high',\r\n}\r\n\r\nexport enum ReasoningEffort {\r\n  none = '',\r\n  minimal = 'minimal',\r\n  low = 'low',\r\n  medium = 'medium',\r\n  high = 'high',\r\n}\r\n\r\nexport enum ReasoningSummary {\r\n  none = '',\r\n  auto = 'auto',\r\n  concise = 'concise',\r\n  detailed = 'detailed',\r\n}\r\n\r\nexport enum Verbosity {\r\n  none = '',\r\n  low = 'low',\r\n  medium = 'medium',\r\n  high = 'high',\r\n}\r\n\r\nexport const imageDetailNumeric = {\r\n  [ImageDetail.low]: 0,\r\n  [ImageDetail.auto]: 1,\r\n  [ImageDetail.high]: 2,\r\n};\r\n\r\nexport const imageDetailValue = {\r\n  0: ImageDetail.low,\r\n  1: ImageDetail.auto,\r\n  2: ImageDetail.high,\r\n};\r\n\r\nexport const eImageDetailSchema = z.nativeEnum(ImageDetail);\r\nexport const eReasoningEffortSchema = z.nativeEnum(ReasoningEffort);\r\nexport const eReasoningSummarySchema = z.nativeEnum(ReasoningSummary);\r\nexport const eVerbositySchema = z.nativeEnum(Verbosity);\r\n\r\nexport const defaultAssistantFormValues = {\r\n  assistant: '',\r\n  id: '',\r\n  name: '',\r\n  description: '',\r\n  instructions: '',\r\n  conversation_starters: [],\r\n  model: '',\r\n  functions: [],\r\n  code_interpreter: false,\r\n  image_vision: false,\r\n  retrieval: false,\r\n  append_current_datetime: false,\r\n};\r\n\r\nexport const defaultAgentFormValues = {\r\n  agent: {},\r\n  id: '',\r\n  name: '',\r\n  description: '',\r\n  instructions: '',\r\n  model: '',\r\n  model_parameters: {},\r\n  tools: [],\r\n  provider: {},\r\n  projectIds: [],\r\n  artifacts: '',\r\n  /** @deprecated Use ACL permissions instead */\r\n  isCollaborative: false,\r\n  recursion_limit: undefined,\r\n  [Tools.execute_code]: false,\r\n  [Tools.file_search]: false,\r\n  [Tools.web_search]: false,\r\n  category: 'general',\r\n  support_contact: {\r\n    name: '',\r\n    email: '',\r\n  },\r\n};\r\n\r\nexport const ImageVisionTool: FunctionTool = {\r\n  type: Tools.function,\r\n  [Tools.function]: {\r\n    name: 'image_vision',\r\n    description: 'Get detailed text descriptions for all current image attachments.',\r\n    parameters: {\r\n      type: 'object',\r\n      properties: {},\r\n      required: [],\r\n    },\r\n  },\r\n};\r\n\r\nexport const isImageVisionTool = (tool: FunctionTool | FunctionToolCall) =>\r\n  tool.type === 'function' && tool.function?.name === ImageVisionTool.function?.name;\r\n\r\nexport const openAISettings = {\r\n  model: {\r\n    default: 'gpt-4o-mini' as const,\r\n  },\r\n  temperature: {\r\n    min: 0 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  top_p: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  presence_penalty: {\r\n    min: -2 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 0 as const,\r\n  },\r\n  frequency_penalty: {\r\n    min: -2 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 0 as const,\r\n  },\r\n  resendFiles: {\r\n    default: true as const,\r\n  },\r\n  maxContextTokens: {\r\n    default: undefined,\r\n  },\r\n  max_tokens: {\r\n    default: undefined,\r\n  },\r\n  imageDetail: {\r\n    default: ImageDetail.auto as const,\r\n    min: 0 as const,\r\n    max: 2 as const,\r\n    step: 1 as const,\r\n  },\r\n};\r\n\r\nexport const googleSettings = {\r\n  model: {\r\n    default: 'gemini-1.5-flash-latest' as const,\r\n  },\r\n  maxOutputTokens: {\r\n    min: 1 as const,\r\n    max: 64000 as const,\r\n    step: 1 as const,\r\n    default: 8192 as const,\r\n  },\r\n  temperature: {\r\n    min: 0 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  topP: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 0.95 as const,\r\n  },\r\n  topK: {\r\n    min: 1 as const,\r\n    max: 40 as const,\r\n    step: 1 as const,\r\n    default: 40 as const,\r\n  },\r\n  thinking: {\r\n    default: true as const,\r\n  },\r\n  thinkingBudget: {\r\n    min: -1 as const,\r\n    max: 32768 as const,\r\n    step: 1 as const,\r\n    /** `-1` = Dynamic Thinking, meaning the model will adjust\r\n     * the budget based on the complexity of the request.\r\n     */\r\n    default: -1 as const,\r\n  },\r\n};\r\n\r\nconst ANTHROPIC_MAX_OUTPUT = 128000 as const;\r\nconst DEFAULT_MAX_OUTPUT = 8192 as const;\r\nconst LEGACY_ANTHROPIC_MAX_OUTPUT = 4096 as const;\r\nexport const anthropicSettings = {\r\n  model: {\r\n    default: 'claude-3-5-sonnet-latest' as const,\r\n  },\r\n  temperature: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  promptCache: {\r\n    default: true as const,\r\n  },\r\n  thinking: {\r\n    default: true as const,\r\n  },\r\n  thinkingBudget: {\r\n    min: 1024 as const,\r\n    step: 100 as const,\r\n    max: 200000 as const,\r\n    default: 2000 as const,\r\n  },\r\n  maxOutputTokens: {\r\n    min: 1 as const,\r\n    max: ANTHROPIC_MAX_OUTPUT,\r\n    step: 1 as const,\r\n    default: DEFAULT_MAX_OUTPUT,\r\n    reset: (modelName: string) => {\r\n      if (/claude-3[-.]5-sonnet/.test(modelName) || /claude-3[-.]7/.test(modelName)) {\r\n        return DEFAULT_MAX_OUTPUT;\r\n      }\r\n\r\n      return 4096;\r\n    },\r\n    set: (value: number, modelName: string) => {\r\n      if (\r\n        !(/claude-3[-.]5-sonnet/.test(modelName) || /claude-3[-.]7/.test(modelName)) &&\r\n        value > LEGACY_ANTHROPIC_MAX_OUTPUT\r\n      ) {\r\n        return LEGACY_ANTHROPIC_MAX_OUTPUT;\r\n      }\r\n\r\n      return value;\r\n    },\r\n  },\r\n  topP: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 0.7 as const,\r\n  },\r\n  topK: {\r\n    min: 1 as const,\r\n    max: 40 as const,\r\n    step: 1 as const,\r\n    default: 5 as const,\r\n  },\r\n  resendFiles: {\r\n    default: true as const,\r\n  },\r\n  maxContextTokens: {\r\n    default: undefined,\r\n  },\r\n  legacy: {\r\n    maxOutputTokens: {\r\n      min: 1 as const,\r\n      max: LEGACY_ANTHROPIC_MAX_OUTPUT,\r\n      step: 1 as const,\r\n      default: LEGACY_ANTHROPIC_MAX_OUTPUT,\r\n    },\r\n  },\r\n  web_search: {\r\n    default: false as const,\r\n  },\r\n};\r\n\r\nexport const agentsSettings = {\r\n  model: {\r\n    default: 'gpt-3.5-turbo-test' as const,\r\n  },\r\n  temperature: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  top_p: {\r\n    min: 0 as const,\r\n    max: 1 as const,\r\n    step: 0.01 as const,\r\n    default: 1 as const,\r\n  },\r\n  presence_penalty: {\r\n    min: -2 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 0 as const,\r\n  },\r\n  frequency_penalty: {\r\n    min: -2 as const,\r\n    max: 2 as const,\r\n    step: 0.01 as const,\r\n    default: 0 as const,\r\n  },\r\n  resendFiles: {\r\n    default: true as const,\r\n  },\r\n  maxContextTokens: {\r\n    default: undefined,\r\n  },\r\n  max_tokens: {\r\n    default: undefined,\r\n  },\r\n  imageDetail: {\r\n    default: ImageDetail.auto as const,\r\n  },\r\n};\r\n\r\nexport const endpointSettings = {\r\n  [EModelEndpoint.openAI]: openAISettings,\r\n  [EModelEndpoint.google]: googleSettings,\r\n  [EModelEndpoint.anthropic]: anthropicSettings,\r\n  [EModelEndpoint.agents]: agentsSettings,\r\n  [EModelEndpoint.bedrock]: agentsSettings,\r\n};\r\n\r\nconst google = endpointSettings[EModelEndpoint.google];\r\n\r\nexport const eModelEndpointSchema = z.nativeEnum(EModelEndpoint);\r\n\r\nexport const extendedModelEndpointSchema = z.union([eModelEndpointSchema, z.string()]);\r\n\r\nexport const tPluginAuthConfigSchema = z.object({\r\n  authField: z.string(),\r\n  label: z.string(),\r\n  description: z.string(),\r\n});\r\n\r\nexport type TPluginAuthConfig = z.infer<typeof tPluginAuthConfigSchema>;\r\n\r\nexport const tPluginSchema = z.object({\r\n  name: z.string(),\r\n  pluginKey: z.string(),\r\n  description: z.string().optional(),\r\n  icon: z.string().optional(),\r\n  authConfig: z.array(tPluginAuthConfigSchema).optional(),\r\n  authenticated: z.boolean().optional(),\r\n  chatMenu: z.boolean().optional(),\r\n  isButton: z.boolean().optional(),\r\n  toolkit: z.boolean().optional(),\r\n});\r\n\r\nexport type TPlugin = z.infer<typeof tPluginSchema>;\r\n\r\nexport type TInput = {\r\n  inputStr: string;\r\n};\r\n\r\nexport type TResPlugin = {\r\n  plugin: string;\r\n  input: string;\r\n  thought: string;\r\n  loading?: boolean;\r\n  outputs?: string;\r\n  latest?: string;\r\n  inputs?: TInput[];\r\n};\r\n\r\nexport const tExampleSchema = z.object({\r\n  input: z.object({\r\n    content: z.string(),\r\n  }),\r\n  output: z.object({\r\n    content: z.string(),\r\n  }),\r\n});\r\n\r\nexport type TExample = z.infer<typeof tExampleSchema>;\r\n\r\nexport enum EAgent {\r\n  functions = 'functions',\r\n  classic = 'classic',\r\n}\r\n\r\nexport const agentOptionSettings = {\r\n  model: {\r\n    default: 'gpt-4o-mini',\r\n  },\r\n  temperature: {\r\n    min: 0,\r\n    max: 1,\r\n    step: 0.01,\r\n    default: 0,\r\n  },\r\n  agent: {\r\n    default: EAgent.functions,\r\n    options: [EAgent.functions, EAgent.classic],\r\n  },\r\n  skipCompletion: {\r\n    default: true,\r\n  },\r\n};\r\n\r\nexport const eAgentOptionsSchema = z.nativeEnum(EAgent);\r\n\r\nexport const tAgentOptionsSchema = z.object({\r\n  agent: z.string().default(EAgent.functions),\r\n  skipCompletion: z.boolean().default(agentOptionSettings.skipCompletion.default),\r\n  model: z.string(),\r\n  temperature: z.number().default(agentOptionSettings.temperature.default),\r\n});\r\n\r\nexport const tMessageSchema = z.object({\r\n  messageId: z.string(),\r\n  endpoint: z.string().optional(),\r\n  clientId: z.string().nullable().optional(),\r\n  conversationId: z.string().nullable(),\r\n  parentMessageId: z.string().nullable(),\r\n  responseMessageId: z.string().nullable().optional(),\r\n  overrideParentMessageId: z.string().nullable().optional(),\r\n  bg: z.string().nullable().optional(),\r\n  model: z.string().nullable().optional(),\r\n  title: z.string().nullable().or(z.literal('New Chat')).default('New Chat'),\r\n  sender: z.string().optional(),\r\n  text: z.string(),\r\n  /** @deprecated */\r\n  generation: z.string().nullable().optional(),\r\n  isCreatedByUser: z.boolean(),\r\n  error: z.boolean().optional(),\r\n  clientTimestamp: z.string().optional(),\r\n  createdAt: z\r\n    .string()\r\n    .optional()\r\n    .default(() => new Date().toISOString()),\r\n  updatedAt: z\r\n    .string()\r\n    .optional()\r\n    .default(() => new Date().toISOString()),\r\n  current: z.boolean().optional(),\r\n  unfinished: z.boolean().optional(),\r\n  searchResult: z.boolean().optional(),\r\n  finish_reason: z.string().optional(),\r\n  /* assistant */\r\n  thread_id: z.string().optional(),\r\n  /* frontend components */\r\n  iconURL: z.string().nullable().optional(),\r\n  feedback: feedbackSchema.optional(),\r\n});\r\n\r\nexport type MemoryArtifact = {\r\n  key: string;\r\n  value?: string;\r\n  tokenCount?: number;\r\n  type: 'update' | 'delete' | 'error';\r\n};\r\n\r\nexport type UIResource = {\r\n  type?: string;\r\n  data?: unknown;\r\n  uri?: string;\r\n  mimeType?: string;\r\n  text?: string;\r\n  [key: string]: unknown;\r\n};\r\n\r\nexport type TAttachmentMetadata = {\r\n  type?: Tools;\r\n  messageId: string;\r\n  toolCallId: string;\r\n  [Tools.memory]?: MemoryArtifact;\r\n  [Tools.ui_resources]?: UIResource[];\r\n  [Tools.web_search]?: SearchResultData;\r\n  [Tools.file_search]?: SearchResultData;\r\n};\r\n\r\nexport type TAttachment =\r\n  | (TFile & TAttachmentMetadata)\r\n  | (Pick<TFile, 'filename' | 'filepath' | 'conversationId'> & {\r\n      expiresAt: number;\r\n    } & TAttachmentMetadata)\r\n  | (Partial<Pick<TFile, 'filename' | 'filepath'>> &\r\n      Pick<TFile, 'conversationId'> &\r\n      TAttachmentMetadata);\r\n\r\nexport type TMessage = z.input<typeof tMessageSchema> & {\r\n  children?: TMessage[];\r\n  plugin?: TResPlugin | null;\r\n  plugins?: TResPlugin[];\r\n  content?: TMessageContentParts[];\r\n  files?: Partial<TFile>[];\r\n  depth?: number;\r\n  siblingIndex?: number;\r\n  attachments?: TAttachment[];\r\n  clientTimestamp?: string;\r\n  feedback?: TFeedback;\r\n};\r\n\r\nexport const coerceNumber = z.union([z.number(), z.string()]).transform((val) => {\r\n  if (typeof val === 'string') {\r\n    return val.trim() === '' ? undefined : parseFloat(val);\r\n  }\r\n  return val;\r\n});\r\n\r\ntype DocumentTypeValue =\r\n  | null\r\n  | boolean\r\n  | number\r\n  | string\r\n  | DocumentTypeValue[]\r\n  | { [key: string]: DocumentTypeValue };\r\n\r\nconst DocumentType: z.ZodType<DocumentTypeValue> = z.lazy(() =>\r\n  z.union([\r\n    z.null(),\r\n    z.boolean(),\r\n    z.number(),\r\n    z.string(),\r\n    z.array(z.lazy(() => DocumentType)),\r\n    z.record(z.lazy(() => DocumentType)),\r\n  ]),\r\n);\r\n\r\nexport const tConversationSchema = z.object({\r\n  conversationId: z.string().nullable(),\r\n  endpoint: eModelEndpointSchema.nullable(),\r\n  endpointType: eModelEndpointSchema.nullable().optional(),\r\n  isArchived: z.boolean().optional(),\r\n  title: z.string().nullable().or(z.literal('New Chat')).default('New Chat'),\r\n  user: z.string().optional(),\r\n  messages: z.array(z.string()).optional(),\r\n  tools: z.union([z.array(tPluginSchema), z.array(z.string())]).optional(),\r\n  modelLabel: z.string().nullable().optional(),\r\n  userLabel: z.string().optional(),\r\n  model: z.string().nullable().optional(),\r\n  promptPrefix: z.string().nullable().optional(),\r\n  temperature: z.number().nullable().optional(),\r\n  topP: z.number().optional(),\r\n  topK: z.number().optional(),\r\n  top_p: z.number().optional(),\r\n  frequency_penalty: z.number().optional(),\r\n  presence_penalty: z.number().optional(),\r\n  parentMessageId: z.string().optional(),\r\n  maxOutputTokens: coerceNumber.nullable().optional(),\r\n  maxContextTokens: coerceNumber.optional(),\r\n  max_tokens: coerceNumber.optional(),\r\n  /* Anthropic */\r\n  promptCache: z.boolean().optional(),\r\n  system: z.string().optional(),\r\n  thinking: z.boolean().optional(),\r\n  thinkingBudget: coerceNumber.optional(),\r\n  stream: z.boolean().optional(),\r\n  /* artifacts */\r\n  artifacts: z.string().optional(),\r\n  /* google */\r\n  context: z.string().nullable().optional(),\r\n  examples: z.array(tExampleSchema).optional(),\r\n  /* DB */\r\n  tags: z.array(z.string()).optional(),\r\n  createdAt: z.string(),\r\n  updatedAt: z.string(),\r\n  /* Files */\r\n  resendFiles: z.boolean().optional(),\r\n  file_ids: z.array(z.string()).optional(),\r\n  /* vision */\r\n  imageDetail: eImageDetailSchema.optional(),\r\n  /* OpenAI: Reasoning models only */\r\n  reasoning_effort: eReasoningEffortSchema.optional().nullable(),\r\n  reasoning_summary: eReasoningSummarySchema.optional().nullable(),\r\n  /* OpenAI: Verbosity control */\r\n  verbosity: eVerbositySchema.optional().nullable(),\r\n  /* OpenAI: use Responses API */\r\n  useResponsesApi: z.boolean().optional(),\r\n  /* OpenAI Responses API / Anthropic API / Google API */\r\n  web_search: z.boolean().optional(),\r\n  /* disable streaming */\r\n  disableStreaming: z.boolean().optional(),\r\n  /* assistant */\r\n  assistant_id: z.string().optional(),\r\n  /* agents */\r\n  agent_id: z.string().optional(),\r\n  /* AWS Bedrock */\r\n  region: z.string().optional(),\r\n  maxTokens: coerceNumber.optional(),\r\n  additionalModelRequestFields: DocumentType.optional(),\r\n  /* assistants */\r\n  instructions: z.string().optional(),\r\n  additional_instructions: z.string().optional(),\r\n  append_current_datetime: z.boolean().optional(),\r\n  /** Used to overwrite active conversation settings when saving a Preset */\r\n  presetOverride: z.record(z.unknown()).optional(),\r\n  stop: z.array(z.string()).optional(),\r\n  /* frontend components */\r\n  greeting: z.string().optional(),\r\n  spec: z.string().nullable().optional(),\r\n  iconURL: z.string().nullable().optional(),\r\n  /* temporary chat */\r\n  expiredAt: z.string().nullable().optional(),\r\n  /* file token limits */\r\n  fileTokenLimit: coerceNumber.optional(),\r\n  /** @deprecated */\r\n  resendImages: z.boolean().optional(),\r\n  /** @deprecated */\r\n  agentOptions: tAgentOptionsSchema.nullable().optional(),\r\n  /** @deprecated Prefer `modelLabel` over `chatGptLabel` */\r\n  chatGptLabel: z.string().nullable().optional(),\r\n});\r\n\r\nexport const tPresetSchema = tConversationSchema\r\n  .omit({\r\n    conversationId: true,\r\n    createdAt: true,\r\n    updatedAt: true,\r\n    title: true,\r\n  })\r\n  .merge(\r\n    z.object({\r\n      conversationId: z.string().nullable().optional(),\r\n      presetId: z.string().nullable().optional(),\r\n      title: z.string().nullable().optional(),\r\n      defaultPreset: z.boolean().optional(),\r\n      order: z.number().optional(),\r\n      endpoint: extendedModelEndpointSchema.nullable(),\r\n    }),\r\n  );\r\n\r\nexport const tConvoUpdateSchema = tConversationSchema.merge(\r\n  z.object({\r\n    endpoint: extendedModelEndpointSchema.nullable(),\r\n    createdAt: z.string().optional(),\r\n    updatedAt: z.string().optional(),\r\n  }),\r\n);\r\n\r\nexport const tQueryParamsSchema = tConversationSchema\r\n  .pick({\r\n    // librechat settings\r\n    /** The model spec to be used */\r\n    spec: true,\r\n    /** The AI context window, overrides the system-defined window as determined by `model` value */\r\n    maxContextTokens: true,\r\n    /**\r\n     * Whether or not to re-submit files from previous messages on subsequent messages\r\n     * */\r\n    resendFiles: true,\r\n    /**\r\n     * @endpoints openAI, custom, azureOpenAI\r\n     *\r\n     * System parameter that only affects the above endpoints.\r\n     * Image detail for re-sizing according to OpenAI spec, defaults to `auto`\r\n     * */\r\n    imageDetail: true,\r\n    /**\r\n     * AKA Custom Instructions, dynamically added to chat history as a system message;\r\n     * for `bedrock` endpoint, this is used as the `system` model param if the provider uses it;\r\n     * for `assistants` endpoint, this is used as the `additional_instructions` model param:\r\n     * https://platform.openai.com/docs/api-reference/runs/createRun#runs-createrun-additional_instructions\r\n     * ; otherwise, a message with `system` role is added to the chat history\r\n     */\r\n    promptPrefix: true,\r\n    // Model parameters\r\n    /** @endpoints openAI, custom, azureOpenAI, google, anthropic, assistants, azureAssistants, bedrock */\r\n    model: true,\r\n    /** @endpoints openAI, custom, azureOpenAI, google, anthropic, bedrock */\r\n    temperature: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    presence_penalty: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    frequency_penalty: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    stop: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    top_p: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    max_tokens: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    reasoning_effort: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    reasoning_summary: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    verbosity: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    useResponsesApi: true,\r\n    /** @endpoints openAI, anthropic, google */\r\n    web_search: true,\r\n    /** @endpoints openAI, custom, azureOpenAI */\r\n    disableStreaming: true,\r\n    /** @endpoints google, anthropic, bedrock */\r\n    topP: true,\r\n    /** @endpoints google, anthropic */\r\n    topK: true,\r\n    /** @endpoints google, anthropic */\r\n    maxOutputTokens: true,\r\n    /** @endpoints anthropic */\r\n    promptCache: true,\r\n    thinking: true,\r\n    thinkingBudget: true,\r\n    /** @endpoints bedrock */\r\n    region: true,\r\n    /** @endpoints bedrock */\r\n    maxTokens: true,\r\n    /** @endpoints agents */\r\n    agent_id: true,\r\n    /** @endpoints assistants, azureAssistants */\r\n    assistant_id: true,\r\n    /** @endpoints assistants, azureAssistants */\r\n    append_current_datetime: true,\r\n    /**\r\n     * @endpoints assistants, azureAssistants\r\n     *\r\n     * Overrides existing assistant instructions, only used for the current run:\r\n     * https://platform.openai.com/docs/api-reference/runs/createRun#runs-createrun-instructions\r\n     * */\r\n    instructions: true,\r\n    /** @endpoints openAI, google, anthropic */\r\n    fileTokenLimit: true,\r\n  })\r\n  .merge(\r\n    z.object({\r\n      /** @endpoints openAI, custom, azureOpenAI, google, anthropic, assistants, azureAssistants, bedrock, agents */\r\n      endpoint: extendedModelEndpointSchema.nullable(),\r\n    }),\r\n  );\r\n\r\nexport type TPreset = z.infer<typeof tPresetSchema>;\r\n\r\nexport type TSetOption = (\r\n  param: number | string,\r\n) => (newValue: number | string | boolean | string[] | Partial<TPreset>) => void;\r\n\r\nexport type TConversation = z.infer<typeof tConversationSchema> & {\r\n  presetOverride?: Partial<TPreset>;\r\n  disableParams?: boolean;\r\n};\r\n\r\nexport const tSharedLinkSchema = z.object({\r\n  conversationId: z.string(),\r\n  shareId: z.string(),\r\n  messages: z.array(z.string()),\r\n  isPublic: z.boolean(),\r\n  title: z.string(),\r\n  createdAt: z.string(),\r\n  updatedAt: z.string(),\r\n});\r\n\r\nexport type TSharedLink = z.infer<typeof tSharedLinkSchema>;\r\n\r\nexport const tConversationTagSchema = z.object({\r\n  _id: z.string(),\r\n  user: z.string(),\r\n  tag: z.string(),\r\n  description: z.string().optional(),\r\n  createdAt: z.string(),\r\n  updatedAt: z.string(),\r\n  count: z.number(),\r\n  position: z.number(),\r\n});\r\nexport type TConversationTag = z.infer<typeof tConversationTagSchema>;\r\n\r\nexport const googleBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  modelLabel: true,\r\n  promptPrefix: true,\r\n  examples: true,\r\n  temperature: true,\r\n  maxOutputTokens: true,\r\n  artifacts: true,\r\n  topP: true,\r\n  topK: true,\r\n  thinking: true,\r\n  thinkingBudget: true,\r\n  web_search: true,\r\n  fileTokenLimit: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n  maxContextTokens: true,\r\n});\r\n\r\nexport const googleSchema = googleBaseSchema\r\n  .transform((obj: Partial<TConversation>) => removeNullishValues(obj))\r\n  .catch(() => ({}));\r\n\r\n/**\r\n   * TODO: Map the following fields:\r\n  - presence_penalty -> presencePenalty\r\n  - frequency_penalty -> frequencyPenalty\r\n  - stop -> stopSequences\r\n   */\r\nexport const googleGenConfigSchema = z\r\n  .object({\r\n    maxOutputTokens: coerceNumber.optional(),\r\n    temperature: coerceNumber.optional(),\r\n    topP: coerceNumber.optional(),\r\n    topK: coerceNumber.optional(),\r\n    presencePenalty: coerceNumber.optional(),\r\n    frequencyPenalty: coerceNumber.optional(),\r\n    stopSequences: z.array(z.string()).optional(),\r\n    thinkingConfig: z\r\n      .object({\r\n        includeThoughts: z.boolean().optional(),\r\n        thinkingBudget: coerceNumber.optional(),\r\n      })\r\n      .optional(),\r\n    web_search: z.boolean().optional(),\r\n  })\r\n  .strip()\r\n  .optional();\r\n\r\nconst gptPluginsBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  modelLabel: true,\r\n  chatGptLabel: true,\r\n  promptPrefix: true,\r\n  temperature: true,\r\n  artifacts: true,\r\n  top_p: true,\r\n  presence_penalty: true,\r\n  frequency_penalty: true,\r\n  tools: true,\r\n  agentOptions: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n  maxContextTokens: true,\r\n});\r\n\r\nexport const gptPluginsSchema = gptPluginsBaseSchema\r\n  .transform((obj) => {\r\n    const result = {\r\n      ...obj,\r\n      model: obj.model ?? 'gpt-3.5-turbo',\r\n      chatGptLabel: obj.chatGptLabel ?? obj.modelLabel ?? null,\r\n      promptPrefix: obj.promptPrefix ?? null,\r\n      temperature: obj.temperature ?? 0.8,\r\n      top_p: obj.top_p ?? 1,\r\n      presence_penalty: obj.presence_penalty ?? 0,\r\n      frequency_penalty: obj.frequency_penalty ?? 0,\r\n      tools: obj.tools ?? [],\r\n      agentOptions: obj.agentOptions ?? {\r\n        agent: EAgent.functions,\r\n        skipCompletion: true,\r\n        model: 'gpt-3.5-turbo',\r\n        temperature: 0,\r\n      },\r\n      iconURL: obj.iconURL ?? undefined,\r\n      greeting: obj.greeting ?? undefined,\r\n      spec: obj.spec ?? undefined,\r\n      maxContextTokens: obj.maxContextTokens ?? undefined,\r\n    };\r\n\r\n    if (obj.modelLabel != null && obj.modelLabel !== '') {\r\n      result.modelLabel = null;\r\n    }\r\n\r\n    return result;\r\n  })\r\n  .catch(() => ({\r\n    model: 'gpt-3.5-turbo',\r\n    chatGptLabel: null,\r\n    promptPrefix: null,\r\n    temperature: 0.8,\r\n    top_p: 1,\r\n    presence_penalty: 0,\r\n    frequency_penalty: 0,\r\n    tools: [],\r\n    agentOptions: {\r\n      agent: EAgent.functions,\r\n      skipCompletion: true,\r\n      model: 'gpt-3.5-turbo',\r\n      temperature: 0,\r\n    },\r\n    iconURL: undefined,\r\n    greeting: undefined,\r\n    spec: undefined,\r\n    maxContextTokens: undefined,\r\n  }));\r\n\r\nexport function removeNullishValues<T extends Record<string, unknown>>(\r\n  obj: T,\r\n  removeEmptyStrings?: boolean,\r\n): Partial<T> {\r\n  const newObj: Partial<T> = { ...obj };\r\n\r\n  (Object.keys(newObj) as Array<keyof T>).forEach((key) => {\r\n    const value = newObj[key];\r\n    if (value === undefined || value === null) {\r\n      delete newObj[key];\r\n    }\r\n    if (removeEmptyStrings && typeof value === 'string' && value === '') {\r\n      delete newObj[key];\r\n    }\r\n  });\r\n\r\n  return newObj;\r\n}\r\n\r\nconst assistantBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  assistant_id: true,\r\n  instructions: true,\r\n  artifacts: true,\r\n  promptPrefix: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n  append_current_datetime: true,\r\n});\r\n\r\nexport const assistantSchema = assistantBaseSchema\r\n  .transform((obj) => ({\r\n    ...obj,\r\n    model: obj.model ?? openAISettings.model.default,\r\n    assistant_id: obj.assistant_id ?? undefined,\r\n    instructions: obj.instructions ?? undefined,\r\n    promptPrefix: obj.promptPrefix ?? null,\r\n    iconURL: obj.iconURL ?? undefined,\r\n    greeting: obj.greeting ?? undefined,\r\n    spec: obj.spec ?? undefined,\r\n    append_current_datetime: obj.append_current_datetime ?? false,\r\n  }))\r\n  .catch(() => ({\r\n    model: openAISettings.model.default,\r\n    assistant_id: undefined,\r\n    instructions: undefined,\r\n    promptPrefix: null,\r\n    iconURL: undefined,\r\n    greeting: undefined,\r\n    spec: undefined,\r\n    append_current_datetime: false,\r\n  }));\r\n\r\nconst compactAssistantBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  assistant_id: true,\r\n  instructions: true,\r\n  promptPrefix: true,\r\n  artifacts: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n});\r\n\r\nexport const compactAssistantSchema = compactAssistantBaseSchema\r\n  .transform((obj) => removeNullishValues(obj))\r\n  .catch(() => ({}));\r\n\r\nexport const agentsBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  modelLabel: true,\r\n  temperature: true,\r\n  top_p: true,\r\n  presence_penalty: true,\r\n  frequency_penalty: true,\r\n  resendFiles: true,\r\n  imageDetail: true,\r\n  agent_id: true,\r\n  instructions: true,\r\n  promptPrefix: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  maxContextTokens: true,\r\n});\r\n\r\nexport const agentsSchema = agentsBaseSchema\r\n  .transform((obj) => ({\r\n    ...obj,\r\n    model: obj.model ?? agentsSettings.model.default,\r\n    modelLabel: obj.modelLabel ?? null,\r\n    temperature: obj.temperature ?? 1,\r\n    top_p: obj.top_p ?? 1,\r\n    presence_penalty: obj.presence_penalty ?? 0,\r\n    frequency_penalty: obj.frequency_penalty ?? 0,\r\n    resendFiles:\r\n      typeof obj.resendFiles === 'boolean' ? obj.resendFiles : agentsSettings.resendFiles.default,\r\n    imageDetail: obj.imageDetail ?? ImageDetail.auto,\r\n    agent_id: obj.agent_id ?? undefined,\r\n    instructions: obj.instructions ?? undefined,\r\n    promptPrefix: obj.promptPrefix ?? null,\r\n    iconURL: obj.iconURL ?? undefined,\r\n    greeting: obj.greeting ?? undefined,\r\n    maxContextTokens: obj.maxContextTokens ?? undefined,\r\n  }))\r\n  .catch(() => ({\r\n    model: agentsSettings.model.default,\r\n    modelLabel: null,\r\n    temperature: 1,\r\n    top_p: 1,\r\n    presence_penalty: 0,\r\n    frequency_penalty: 0,\r\n    resendFiles: agentsSettings.resendFiles.default,\r\n    imageDetail: ImageDetail.auto,\r\n    agent_id: undefined,\r\n    instructions: undefined,\r\n    promptPrefix: null,\r\n    iconURL: undefined,\r\n    greeting: undefined,\r\n    maxContextTokens: undefined,\r\n  }));\r\n\r\nexport const openAIBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  modelLabel: true,\r\n  chatGptLabel: true,\r\n  promptPrefix: true,\r\n  temperature: true,\r\n  top_p: true,\r\n  presence_penalty: true,\r\n  frequency_penalty: true,\r\n  resendFiles: true,\r\n  artifacts: true,\r\n  imageDetail: true,\r\n  stop: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n  maxContextTokens: true,\r\n  max_tokens: true,\r\n  reasoning_effort: true,\r\n  reasoning_summary: true,\r\n  verbosity: true,\r\n  useResponsesApi: true,\r\n  web_search: true,\r\n  disableStreaming: true,\r\n  fileTokenLimit: true,\r\n});\r\n\r\nexport const openAISchema = openAIBaseSchema\r\n  .transform((obj: Partial<TConversation>) => removeNullishValues(obj, true))\r\n  .catch(() => ({}));\r\n\r\nexport const compactGoogleSchema = googleBaseSchema\r\n  .transform((obj) => {\r\n    const newObj: Partial<TConversation> = { ...obj };\r\n    if (newObj.temperature === google.temperature.default) {\r\n      delete newObj.temperature;\r\n    }\r\n    if (newObj.maxOutputTokens === google.maxOutputTokens.default) {\r\n      delete newObj.maxOutputTokens;\r\n    }\r\n    if (newObj.topP === google.topP.default) {\r\n      delete newObj.topP;\r\n    }\r\n    if (newObj.topK === google.topK.default) {\r\n      delete newObj.topK;\r\n    }\r\n\r\n    return removeNullishValues(newObj);\r\n  })\r\n  .catch(() => ({}));\r\n\r\nexport const anthropicBaseSchema = tConversationSchema.pick({\r\n  model: true,\r\n  modelLabel: true,\r\n  promptPrefix: true,\r\n  temperature: true,\r\n  maxOutputTokens: true,\r\n  topP: true,\r\n  topK: true,\r\n  resendFiles: true,\r\n  promptCache: true,\r\n  thinking: true,\r\n  thinkingBudget: true,\r\n  artifacts: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  spec: true,\r\n  maxContextTokens: true,\r\n  web_search: true,\r\n  fileTokenLimit: true,\r\n  stop: true,\r\n  stream: true,\r\n});\r\n\r\nexport const anthropicSchema = anthropicBaseSchema\r\n  .transform((obj) => removeNullishValues(obj))\r\n  .catch(() => ({}));\r\n\r\nexport const compactPluginsSchema = gptPluginsBaseSchema\r\n  .transform((obj) => {\r\n    const newObj: Partial<TConversation> = { ...obj };\r\n    if (newObj.modelLabel === null) {\r\n      delete newObj.modelLabel;\r\n    }\r\n    if (newObj.chatGptLabel === null) {\r\n      delete newObj.chatGptLabel;\r\n    }\r\n    if (newObj.promptPrefix === null) {\r\n      delete newObj.promptPrefix;\r\n    }\r\n    if (newObj.temperature === 0.8) {\r\n      delete newObj.temperature;\r\n    }\r\n    if (newObj.top_p === 1) {\r\n      delete newObj.top_p;\r\n    }\r\n    if (newObj.presence_penalty === 0) {\r\n      delete newObj.presence_penalty;\r\n    }\r\n    if (newObj.frequency_penalty === 0) {\r\n      delete newObj.frequency_penalty;\r\n    }\r\n    if (newObj.tools?.length === 0) {\r\n      delete newObj.tools;\r\n    }\r\n\r\n    if (\r\n      newObj.agentOptions &&\r\n      newObj.agentOptions.agent === EAgent.functions &&\r\n      newObj.agentOptions.skipCompletion === true &&\r\n      newObj.agentOptions.model === 'gpt-3.5-turbo' &&\r\n      newObj.agentOptions.temperature === 0\r\n    ) {\r\n      delete newObj.agentOptions;\r\n    }\r\n\r\n    return removeNullishValues(newObj);\r\n  })\r\n  .catch(() => ({}));\r\n\r\nexport const tBannerSchema = z.object({\r\n  bannerId: z.string(),\r\n  message: z.string(),\r\n  displayFrom: z.string(),\r\n  displayTo: z.string(),\r\n  createdAt: z.string(),\r\n  updatedAt: z.string(),\r\n  isPublic: z.boolean(),\r\n});\r\nexport type TBanner = z.infer<typeof tBannerSchema>;\r\n\r\nexport const compactAgentsBaseSchema = tConversationSchema.pick({\r\n  spec: true,\r\n  // model: true,\r\n  iconURL: true,\r\n  greeting: true,\r\n  agent_id: true,\r\n  instructions: true,\r\n  additional_instructions: true,\r\n});\r\n\r\nexport const compactAgentsSchema = compactAgentsBaseSchema\r\n  .transform((obj) => removeNullishValues(obj))\r\n  .catch(() => ({}));\r\n","import { z } from 'zod';\r\nimport type { TPreset } from './schemas';\r\nimport {\r\n  EModelEndpoint,\r\n  tPresetSchema,\r\n  eModelEndpointSchema,\r\n  AuthType,\r\n  authTypeSchema,\r\n} from './schemas';\r\n\r\nexport type TModelSpec = {\r\n  name: string;\r\n  label: string;\r\n  preset: TPreset;\r\n  order?: number;\r\n  default?: boolean;\r\n  description?: string;\r\n  showIconInMenu?: boolean;\r\n  showIconInHeader?: boolean;\r\n  iconURL?: string | EModelEndpoint; // Allow using project-included icons\r\n  authType?: AuthType;\r\n};\r\n\r\nexport const tModelSpecSchema = z.object({\r\n  name: z.string(),\r\n  label: z.string(),\r\n  preset: tPresetSchema,\r\n  order: z.number().optional(),\r\n  default: z.boolean().optional(),\r\n  description: z.string().optional(),\r\n  showIconInMenu: z.boolean().optional(),\r\n  showIconInHeader: z.boolean().optional(),\r\n  iconURL: z.union([z.string(), eModelEndpointSchema]).optional(),\r\n  authType: authTypeSchema.optional(),\r\n});\r\n\r\nexport const specsConfigSchema = z.object({\r\n  enforce: z.boolean().default(false),\r\n  prioritize: z.boolean().default(true),\r\n  list: z.array(tModelSpecSchema).min(1),\r\n  addedEndpoints: z.array(z.union([z.string(), eModelEndpointSchema])).optional(),\r\n});\r\n\r\nexport type TSpecsConfig = z.infer<typeof specsConfigSchema>;\r\n","import { z } from 'zod';\r\nimport { EModelEndpoint } from './schemas';\r\nimport type { EndpointFileConfig, FileConfig } from './types/files';\r\n\r\nexport const supportsFiles = {\r\n  [EModelEndpoint.openAI]: true,\r\n  [EModelEndpoint.google]: true,\r\n  [EModelEndpoint.assistants]: true,\r\n  [EModelEndpoint.azureAssistants]: true,\r\n  [EModelEndpoint.agents]: true,\r\n  [EModelEndpoint.azureOpenAI]: true,\r\n  [EModelEndpoint.anthropic]: true,\r\n  [EModelEndpoint.custom]: true,\r\n  [EModelEndpoint.bedrock]: true,\r\n};\r\n\r\nexport const excelFileTypes = [\r\n  'application/vnd.ms-excel',\r\n  'application/msexcel',\r\n  'application/x-msexcel',\r\n  'application/x-ms-excel',\r\n  'application/x-excel',\r\n  'application/x-dos_ms_excel',\r\n  'application/xls',\r\n  'application/x-xls',\r\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n];\r\n\r\nexport const fullMimeTypesList = [\r\n  'text/x-c',\r\n  'text/x-c++',\r\n  'application/csv',\r\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  'text/html',\r\n  'text/x-java',\r\n  'application/json',\r\n  'text/markdown',\r\n  'application/pdf',\r\n  'text/x-php',\r\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n  'text/x-python',\r\n  'text/x-script.python',\r\n  'text/x-ruby',\r\n  'text/x-tex',\r\n  'text/plain',\r\n  'text/css',\r\n  'text/vtt',\r\n  'image/jpeg',\r\n  'text/javascript',\r\n  'image/gif',\r\n  'image/png',\r\n  'image/heic',\r\n  'image/heif',\r\n  'application/x-tar',\r\n  'application/typescript',\r\n  'application/xml',\r\n  'application/zip',\r\n  'image/svg',\r\n  'image/svg+xml',\r\n  ...excelFileTypes,\r\n];\r\n\r\nexport const codeInterpreterMimeTypesList = [\r\n  'text/x-c',\r\n  'text/x-c++',\r\n  'application/csv',\r\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  'text/html',\r\n  'text/x-java',\r\n  'application/json',\r\n  'text/markdown',\r\n  'application/pdf',\r\n  'text/x-php',\r\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n  'text/x-python',\r\n  'text/x-script.python',\r\n  'text/x-ruby',\r\n  'text/x-tex',\r\n  'text/plain',\r\n  'text/css',\r\n  'image/jpeg',\r\n  'text/javascript',\r\n  'image/gif',\r\n  'image/png',\r\n  'image/heic',\r\n  'image/heif',\r\n  'application/x-tar',\r\n  'application/typescript',\r\n  'application/xml',\r\n  'application/zip',\r\n  ...excelFileTypes,\r\n];\r\n\r\nexport const retrievalMimeTypesList = [\r\n  'text/x-c',\r\n  'text/x-c++',\r\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n  'text/html',\r\n  'text/x-java',\r\n  'application/json',\r\n  'text/markdown',\r\n  'application/pdf',\r\n  'text/x-php',\r\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n  'text/x-python',\r\n  'text/x-script.python',\r\n  'text/x-ruby',\r\n  'text/x-tex',\r\n  'text/plain',\r\n];\r\n\r\nexport const imageExtRegex = /\\.(jpg|jpeg|png|gif|webp|heic|heif)$/i;\r\n\r\nexport const excelMimeTypes =\r\n  /^application\\/(vnd\\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\\.openxmlformats-officedocument\\.spreadsheetml\\.sheet)$/;\r\n\r\nexport const textMimeTypes =\r\n  /^(text\\/(x-c|x-csharp|tab-separated-values|x-c\\+\\+|x-h|x-java|html|markdown|x-php|x-python|x-script\\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/;\r\n\r\nexport const applicationMimeTypes =\r\n  /^(application\\/(epub\\+zip|csv|json|pdf|x-tar|typescript|vnd\\.openxmlformats-officedocument\\.(wordprocessingml\\.document|presentationml\\.presentation|spreadsheetml\\.sheet)|xml|zip))$/;\r\n\r\nexport const imageMimeTypes = /^image\\/(jpeg|gif|png|webp|heic|heif)$/;\r\n\r\nexport const audioMimeTypes =\r\n  /^audio\\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|x-m4a|flac|x-flac|webm)$/;\r\n\r\nexport const defaultOCRMimeTypes = [\r\n  imageMimeTypes,\r\n  /^application\\/pdf$/,\r\n  /^application\\/vnd\\.openxmlformats-officedocument\\.(wordprocessingml\\.document|presentationml\\.presentation|spreadsheetml\\.sheet)$/,\r\n  /^application\\/vnd\\.ms-(word|powerpoint|excel)$/,\r\n  /^application\\/epub\\+zip$/,\r\n];\r\n\r\nexport const defaultTextMimeTypes = [/^[\\w.-]+\\/[\\w.-]+$/];\r\n\r\nexport const defaultSTTMimeTypes = [audioMimeTypes];\r\n\r\nexport const supportedMimeTypes = [\r\n  textMimeTypes,\r\n  excelMimeTypes,\r\n  applicationMimeTypes,\r\n  imageMimeTypes,\r\n  audioMimeTypes,\r\n  /** Supported by LC Code Interpreter PAI */\r\n  /^image\\/(svg|svg\\+xml)$/,\r\n];\r\n\r\nexport const codeInterpreterMimeTypes = [\r\n  textMimeTypes,\r\n  excelMimeTypes,\r\n  applicationMimeTypes,\r\n  imageMimeTypes,\r\n];\r\n\r\nexport const codeTypeMapping: { [key: string]: string } = {\r\n  c: 'text/x-c',\r\n  cs: 'text/x-csharp',\r\n  cpp: 'text/x-c++',\r\n  h: 'text/x-h',\r\n  md: 'text/markdown',\r\n  php: 'text/x-php',\r\n  py: 'text/x-python',\r\n  rb: 'text/x-ruby',\r\n  tex: 'text/x-tex',\r\n  js: 'text/javascript',\r\n  sh: 'application/x-sh',\r\n  ts: 'application/typescript',\r\n  tar: 'application/x-tar',\r\n  zip: 'application/zip',\r\n  yml: 'application/x-yaml',\r\n  yaml: 'application/x-yaml',\r\n  log: 'text/plain',\r\n  tsv: 'text/tab-separated-values',\r\n};\r\n\r\nexport const retrievalMimeTypes = [\r\n  /^(text\\/(x-c|x-c\\+\\+|x-h|html|x-java|markdown|x-php|x-python|x-script\\.python|x-ruby|x-tex|plain|vtt|xml))$/,\r\n  /^(application\\/(json|pdf|vnd\\.openxmlformats-officedocument\\.(wordprocessingml\\.document|presentationml\\.presentation)))$/,\r\n];\r\n\r\nexport const megabyte = 1024 * 1024;\r\n/** Helper function to get megabytes value */\r\nexport const mbToBytes = (mb: number): number => mb * megabyte;\r\n\r\nconst defaultSizeLimit = mbToBytes(512);\r\nconst defaultTokenLimit = 100000;\r\nconst assistantsFileConfig = {\r\n  fileLimit: 10,\r\n  fileSizeLimit: defaultSizeLimit,\r\n  totalSizeLimit: defaultSizeLimit,\r\n  supportedMimeTypes,\r\n  disabled: false,\r\n};\r\n\r\nexport const fileConfig = {\r\n  endpoints: {\r\n    [EModelEndpoint.assistants]: assistantsFileConfig,\r\n    [EModelEndpoint.azureAssistants]: assistantsFileConfig,\r\n    [EModelEndpoint.agents]: assistantsFileConfig,\r\n    default: {\r\n      fileLimit: 10,\r\n      fileSizeLimit: defaultSizeLimit,\r\n      totalSizeLimit: defaultSizeLimit,\r\n      supportedMimeTypes,\r\n      disabled: false,\r\n    },\r\n  },\r\n  serverFileSizeLimit: defaultSizeLimit,\r\n  avatarSizeLimit: mbToBytes(2),\r\n  fileTokenLimit: defaultTokenLimit,\r\n  clientImageResize: {\r\n    enabled: false,\r\n    maxWidth: 1900,\r\n    maxHeight: 1900,\r\n    quality: 0.92,\r\n  },\r\n  ocr: {\r\n    supportedMimeTypes: defaultOCRMimeTypes,\r\n  },\r\n  text: {\r\n    supportedMimeTypes: defaultTextMimeTypes,\r\n  },\r\n  stt: {\r\n    supportedMimeTypes: defaultSTTMimeTypes,\r\n  },\r\n  checkType: function (fileType: string, supportedTypes: RegExp[] = supportedMimeTypes) {\r\n    return supportedTypes.some((regex) => regex.test(fileType));\r\n  },\r\n};\r\n\r\nconst supportedMimeTypesSchema = z\r\n  .array(z.any())\r\n  .optional()\r\n  .refine(\r\n    (mimeTypes) => {\r\n      if (!mimeTypes) {\r\n        return true;\r\n      }\r\n      return mimeTypes.every(\r\n        (mimeType) => mimeType instanceof RegExp || typeof mimeType === 'string',\r\n      );\r\n    },\r\n    {\r\n      message: 'Each mimeType must be a string or a RegExp object.',\r\n    },\r\n  );\r\n\r\nexport const endpointFileConfigSchema = z.object({\r\n  disabled: z.boolean().optional(),\r\n  fileLimit: z.number().min(0).optional(),\r\n  fileSizeLimit: z.number().min(0).optional(),\r\n  totalSizeLimit: z.number().min(0).optional(),\r\n  supportedMimeTypes: supportedMimeTypesSchema.optional(),\r\n});\r\n\r\nexport const fileConfigSchema = z.object({\r\n  endpoints: z.record(endpointFileConfigSchema).optional(),\r\n  serverFileSizeLimit: z.number().min(0).optional(),\r\n  avatarSizeLimit: z.number().min(0).optional(),\r\n  fileTokenLimit: z.number().min(0).optional(),\r\n  imageGeneration: z\r\n    .object({\r\n      percentage: z.number().min(0).max(100).optional(),\r\n      px: z.number().min(0).optional(),\r\n    })\r\n    .optional(),\r\n  clientImageResize: z\r\n    .object({\r\n      enabled: z.boolean().optional(),\r\n      maxWidth: z.number().min(0).optional(),\r\n      maxHeight: z.number().min(0).optional(),\r\n      quality: z.number().min(0).max(1).optional(),\r\n    })\r\n    .optional(),\r\n  ocr: z\r\n    .object({\r\n      supportedMimeTypes: supportedMimeTypesSchema.optional(),\r\n    })\r\n    .optional(),\r\n  text: z\r\n    .object({\r\n      supportedMimeTypes: supportedMimeTypesSchema.optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\n/** Helper function to safely convert string patterns to RegExp objects */\r\nexport const convertStringsToRegex = (patterns: string[]): RegExp[] =>\r\n  patterns.reduce((acc: RegExp[], pattern) => {\r\n    try {\r\n      const regex = new RegExp(pattern);\r\n      acc.push(regex);\r\n    } catch (error) {\r\n      console.error(`Invalid regex pattern \"${pattern}\" skipped.`, error);\r\n    }\r\n    return acc;\r\n  }, []);\r\n\r\nexport function mergeFileConfig(dynamic: z.infer<typeof fileConfigSchema> | undefined): FileConfig {\r\n  const mergedConfig: FileConfig = {\r\n    ...fileConfig,\r\n    ocr: {\r\n      ...fileConfig.ocr,\r\n      supportedMimeTypes: fileConfig.ocr?.supportedMimeTypes || [],\r\n    },\r\n    text: {\r\n      ...fileConfig.text,\r\n      supportedMimeTypes: fileConfig.text?.supportedMimeTypes || [],\r\n    },\r\n    stt: {\r\n      ...fileConfig.stt,\r\n      supportedMimeTypes: fileConfig.stt?.supportedMimeTypes || [],\r\n    },\r\n  };\r\n  if (!dynamic) {\r\n    return mergedConfig;\r\n  }\r\n\r\n  if (dynamic.serverFileSizeLimit !== undefined) {\r\n    mergedConfig.serverFileSizeLimit = mbToBytes(dynamic.serverFileSizeLimit);\r\n  }\r\n\r\n  if (dynamic.avatarSizeLimit !== undefined) {\r\n    mergedConfig.avatarSizeLimit = mbToBytes(dynamic.avatarSizeLimit);\r\n  }\r\n\r\n  if (dynamic.fileTokenLimit !== undefined) {\r\n    mergedConfig.fileTokenLimit = dynamic.fileTokenLimit;\r\n  }\r\n\r\n  // Merge clientImageResize configuration\r\n  if (dynamic.clientImageResize !== undefined) {\r\n    mergedConfig.clientImageResize = {\r\n      ...mergedConfig.clientImageResize,\r\n      ...dynamic.clientImageResize,\r\n    };\r\n  }\r\n\r\n  if (dynamic.ocr !== undefined) {\r\n    mergedConfig.ocr = {\r\n      ...mergedConfig.ocr,\r\n      ...dynamic.ocr,\r\n    };\r\n    if (dynamic.ocr.supportedMimeTypes) {\r\n      mergedConfig.ocr.supportedMimeTypes = convertStringsToRegex(dynamic.ocr.supportedMimeTypes);\r\n    }\r\n  }\r\n\r\n  if (dynamic.text !== undefined) {\r\n    mergedConfig.text = {\r\n      ...mergedConfig.text,\r\n      ...dynamic.text,\r\n    };\r\n    if (dynamic.text.supportedMimeTypes) {\r\n      mergedConfig.text.supportedMimeTypes = convertStringsToRegex(dynamic.text.supportedMimeTypes);\r\n    }\r\n  }\r\n\r\n  if (!dynamic.endpoints) {\r\n    return mergedConfig;\r\n  }\r\n\r\n  for (const key in dynamic.endpoints) {\r\n    const dynamicEndpoint = (dynamic.endpoints as Record<string, EndpointFileConfig>)[key];\r\n\r\n    if (!mergedConfig.endpoints[key]) {\r\n      mergedConfig.endpoints[key] = {};\r\n    }\r\n\r\n    const mergedEndpoint = mergedConfig.endpoints[key];\r\n\r\n    if (dynamicEndpoint.disabled === true) {\r\n      mergedEndpoint.disabled = true;\r\n      mergedEndpoint.fileLimit = 0;\r\n      mergedEndpoint.fileSizeLimit = 0;\r\n      mergedEndpoint.totalSizeLimit = 0;\r\n      mergedEndpoint.supportedMimeTypes = [];\r\n      continue;\r\n    }\r\n\r\n    if (dynamicEndpoint.fileSizeLimit !== undefined) {\r\n      mergedEndpoint.fileSizeLimit = mbToBytes(dynamicEndpoint.fileSizeLimit);\r\n    }\r\n\r\n    if (dynamicEndpoint.totalSizeLimit !== undefined) {\r\n      mergedEndpoint.totalSizeLimit = mbToBytes(dynamicEndpoint.totalSizeLimit);\r\n    }\r\n\r\n    const configKeys = ['fileLimit'] as const;\r\n    configKeys.forEach((field) => {\r\n      if (dynamicEndpoint[field] !== undefined) {\r\n        mergedEndpoint[field] = dynamicEndpoint[field];\r\n      }\r\n    });\r\n\r\n    if (dynamicEndpoint.supportedMimeTypes) {\r\n      mergedEndpoint.supportedMimeTypes = convertStringsToRegex(\r\n        dynamicEndpoint.supportedMimeTypes as unknown as string[],\r\n      );\r\n    }\r\n  }\r\n\r\n  return mergedConfig;\r\n}\r\n","import { EToolResources } from './assistants';\r\n\r\nexport enum FileSources {\r\n  local = 'local',\r\n  firebase = 'firebase',\r\n  azure = 'azure',\r\n  azure_blob = 'azure_blob',\r\n  openai = 'openai',\r\n  s3 = 's3',\r\n  vectordb = 'vectordb',\r\n  execute_code = 'execute_code',\r\n  mistral_ocr = 'mistral_ocr',\r\n  azure_mistral_ocr = 'azure_mistral_ocr',\r\n  vertexai_mistral_ocr = 'vertexai_mistral_ocr',\r\n  text = 'text',\r\n}\r\n\r\nexport const checkOpenAIStorage = (source: string) =>\r\n  source === FileSources.openai || source === FileSources.azure;\r\n\r\nexport enum FileContext {\r\n  avatar = 'avatar',\r\n  unknown = 'unknown',\r\n  agents = 'agents',\r\n  assistants = 'assistants',\r\n  execute_code = 'execute_code',\r\n  image_generation = 'image_generation',\r\n  assistants_output = 'assistants_output',\r\n  message_attachment = 'message_attachment',\r\n  filename = 'filename',\r\n  updatedAt = 'updatedAt',\r\n  source = 'source',\r\n  filterSource = 'filterSource',\r\n  context = 'context',\r\n  bytes = 'bytes',\r\n}\r\n\r\nexport type EndpointFileConfig = {\r\n  disabled?: boolean;\r\n  fileLimit?: number;\r\n  fileSizeLimit?: number;\r\n  totalSizeLimit?: number;\r\n  supportedMimeTypes?: RegExp[];\r\n};\r\n\r\nexport type FileConfig = {\r\n  endpoints: {\r\n    [key: string]: EndpointFileConfig;\r\n  };\r\n  fileTokenLimit?: number;\r\n  serverFileSizeLimit?: number;\r\n  avatarSizeLimit?: number;\r\n  clientImageResize?: {\r\n    enabled?: boolean;\r\n    maxWidth?: number;\r\n    maxHeight?: number;\r\n    quality?: number;\r\n  };\r\n  ocr?: {\r\n    supportedMimeTypes?: RegExp[];\r\n  };\r\n  text?: {\r\n    supportedMimeTypes?: RegExp[];\r\n  };\r\n  stt?: {\r\n    supportedMimeTypes?: RegExp[];\r\n  };\r\n  checkType?: (fileType: string, supportedTypes: RegExp[]) => boolean;\r\n};\r\n\r\nexport type FileConfigInput = {\r\n  endpoints?: {\r\n    [key: string]: EndpointFileConfig;\r\n  };\r\n  serverFileSizeLimit?: number;\r\n  avatarSizeLimit?: number;\r\n  clientImageResize?: {\r\n    enabled?: boolean;\r\n    maxWidth?: number;\r\n    maxHeight?: number;\r\n    quality?: number;\r\n  };\r\n  ocr?: {\r\n    supportedMimeTypes?: string[];\r\n  };\r\n  text?: {\r\n    supportedMimeTypes?: string[];\r\n  };\r\n  stt?: {\r\n    supportedMimeTypes?: string[];\r\n  };\r\n  checkType?: (fileType: string, supportedTypes: RegExp[]) => boolean;\r\n};\r\n\r\nexport type TFile = {\r\n  _id?: string;\r\n  __v?: number;\r\n  user: string;\r\n  conversationId?: string;\r\n  message?: string;\r\n  file_id: string;\r\n  temp_file_id?: string;\r\n  bytes: number;\r\n  embedded: boolean;\r\n  filename: string;\r\n  filepath: string;\r\n  object: 'file';\r\n  type: string;\r\n  usage: number;\r\n  context?: FileContext;\r\n  source?: FileSources;\r\n  filterSource?: FileSources;\r\n  width?: number;\r\n  height?: number;\r\n  expiresAt?: string | Date;\r\n  preview?: string;\r\n  metadata?: { fileIdentifier?: string };\r\n  createdAt?: string | Date;\r\n  updatedAt?: string | Date;\r\n};\r\n\r\nexport type TFileUpload = TFile & {\r\n  temp_file_id: string;\r\n};\r\n\r\nexport type AvatarUploadResponse = {\r\n  url: string;\r\n};\r\n\r\nexport type SpeechToTextResponse = {\r\n  text: string;\r\n};\r\n\r\nexport type VoiceResponse = string[];\r\n\r\nexport type UploadMutationOptions = {\r\n  onSuccess?: (data: TFileUpload, variables: FormData, context?: unknown) => void;\r\n  onMutate?: (variables: FormData) => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: FormData, context?: unknown) => void;\r\n};\r\n\r\nexport type UploadAvatarOptions = {\r\n  onSuccess?: (data: AvatarUploadResponse, variables: FormData, context?: unknown) => void;\r\n  onMutate?: (variables: FormData) => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: FormData, context?: unknown) => void;\r\n};\r\n\r\nexport type SpeechToTextOptions = {\r\n  onSuccess?: (data: SpeechToTextResponse, variables: FormData, context?: unknown) => void;\r\n  onMutate?: (variables: FormData) => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: FormData, context?: unknown) => void;\r\n};\r\n\r\nexport type TextToSpeechOptions = {\r\n  onSuccess?: (data: ArrayBuffer, variables: FormData, context?: unknown) => void;\r\n  onMutate?: (variables: FormData) => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: FormData, context?: unknown) => void;\r\n};\r\n\r\nexport type VoiceOptions = {\r\n  onSuccess?: (data: VoiceResponse, variables: unknown, context?: unknown) => void;\r\n  onMutate?: () => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: unknown, context?: unknown) => void;\r\n};\r\n\r\nexport type DeleteFilesResponse = {\r\n  message: string;\r\n  result: Record<string, unknown>;\r\n};\r\n\r\nexport type BatchFile = {\r\n  file_id: string;\r\n  filepath: string;\r\n  embedded: boolean;\r\n  source: FileSources;\r\n  temp_file_id?: string;\r\n};\r\n\r\nexport type DeleteFilesBody = {\r\n  files: BatchFile[];\r\n  agent_id?: string;\r\n  assistant_id?: string;\r\n  tool_resource?: EToolResources;\r\n};\r\n\r\nexport type DeleteMutationOptions = {\r\n  onSuccess?: (data: DeleteFilesResponse, variables: DeleteFilesBody, context?: unknown) => void;\r\n  onMutate?: (variables: DeleteFilesBody) => void | Promise<unknown>;\r\n  onError?: (error: unknown, variables: DeleteFilesBody, context?: unknown) => void;\r\n};\r\n","/* eslint-disable @typescript-eslint/no-namespace */\r\nimport { StepTypes, ContentTypes, ToolCallTypes } from './runs';\r\nimport type { TAttachment, TPlugin } from 'src/schemas';\r\nimport type { FunctionToolCall } from './assistants';\r\n\r\nexport namespace Agents {\r\n  export type MessageType = 'human' | 'ai' | 'generic' | 'system' | 'function' | 'tool' | 'remove';\r\n\r\n  export type ImageDetail = 'auto' | 'low' | 'high';\r\n\r\n  export type ReasoningContentText = {\r\n    type: ContentTypes.THINK;\r\n    think: string;\r\n  };\r\n\r\n  export type MessageContentText = {\r\n    type: ContentTypes.TEXT;\r\n    text: string;\r\n    tool_call_ids?: string[];\r\n  };\r\n\r\n  export type AgentUpdate = {\r\n    type: ContentTypes.AGENT_UPDATE;\r\n    agent_update: {\r\n      index: number;\r\n      runId: string;\r\n      agentId: string;\r\n    };\r\n  };\r\n\r\n  export type MessageContentImageUrl = {\r\n    type: ContentTypes.IMAGE_URL;\r\n    image_url: string | { url: string; detail?: ImageDetail };\r\n  };\r\n\r\n  export type MessageContentComplex =\r\n    | ReasoningContentText\r\n    | AgentUpdate\r\n    | MessageContentText\r\n    | MessageContentImageUrl\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    | (Record<string, any> & { type?: ContentTypes | string })\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    | (Record<string, any> & { type?: never });\r\n\r\n  export type MessageContent = string | MessageContentComplex[];\r\n\r\n  /**\r\n   * A call to a tool.\r\n   */\r\n  export type ToolCall = {\r\n    /** Type (\"tool_call\") according to Assistants Tool Call Structure */\r\n    type: ToolCallTypes.TOOL_CALL;\r\n    /** The name of the tool to be called */\r\n    name: string;\r\n\r\n    /** The arguments to the tool call */\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    args?: string | Record<string, any>;\r\n\r\n    /** If provided, an identifier associated with the tool call */\r\n    id?: string;\r\n    /** If provided, the output of the tool call */\r\n    output?: string;\r\n    /** Auth URL */\r\n    auth?: string;\r\n    /** Expiration time */\r\n    expires_at?: number;\r\n  };\r\n\r\n  export type ToolEndEvent = {\r\n    /** The Step Id of the Tool Call */\r\n    id: string;\r\n    /** The Completed Tool Call */\r\n    tool_call?: ToolCall;\r\n    /** The content index of the tool call */\r\n    index: number;\r\n  };\r\n\r\n  export type ToolCallContent = {\r\n    type: ContentTypes.TOOL_CALL;\r\n    tool_call?: ToolCall;\r\n  };\r\n\r\n  /**\r\n   * A chunk of a tool call (e.g., as part of a stream).\r\n   * When merging ToolCallChunks (e.g., via AIMessageChunk.__add__),\r\n   * all string attributes are concatenated. Chunks are only merged if their\r\n   * values of `index` are equal and not None.\r\n   *\r\n   * @example\r\n   * ```ts\r\n   * const leftChunks = [\r\n   *   {\r\n   *     name: \"foo\",\r\n   *     args: '{\"a\":',\r\n   *     index: 0\r\n   *   }\r\n   * ];\r\n   *\r\n   * const leftAIMessageChunk = new AIMessageChunk({\r\n   *   content: \"\",\r\n   *   tool_call_chunks: leftChunks\r\n   * });\r\n   *\r\n   * const rightChunks = [\r\n   *   {\r\n   *     name: undefined,\r\n   *     args: '1}',\r\n   *     index: 0\r\n   *   }\r\n   * ];\r\n   *\r\n   * const rightAIMessageChunk = new AIMessageChunk({\r\n   *   content: \"\",\r\n   *   tool_call_chunks: rightChunks\r\n   * });\r\n   *\r\n   * const result = leftAIMessageChunk.concat(rightAIMessageChunk);\r\n   * // result.tool_call_chunks is equal to:\r\n   * // [\r\n   * //   {\r\n   * //     name: \"foo\",\r\n   * //     args: '{\"a\":1}'\r\n   * //     index: 0\r\n   * //   }\r\n   * // ]\r\n   * ```\r\n   *\r\n   * @property {string} [name] - If provided, a substring of the name of the tool to be called\r\n   * @property {string} [args] - If provided, a JSON substring of the arguments to the tool call\r\n   * @property {string} [id] - If provided, a substring of an identifier for the tool call\r\n   * @property {number} [index] - If provided, the index of the tool call in a sequence\r\n   */\r\n  export type ToolCallChunk = {\r\n    name?: string;\r\n\r\n    args?: string;\r\n\r\n    id?: string;\r\n\r\n    index?: number;\r\n\r\n    type?: 'tool_call_chunk';\r\n  };\r\n\r\n  /** Event names are of the format: on_[runnable_type]_(start|stream|end).\r\n\r\n  Runnable types are one of:\r\n\r\n  llm - used by non chat models\r\n  chat_model - used by chat models\r\n  prompt -- e.g., ChatPromptTemplate\r\n  tool -- LangChain tools\r\n  chain - most Runnables are of this type\r\n  Further, the events are categorized as one of:\r\n\r\n  start - when the runnable starts\r\n  stream - when the runnable is streaming\r\n  end - when the runnable ends\r\n  start, stream and end are associated with slightly different data payload.\r\n\r\n  Please see the documentation for EventData for more details. */\r\n  export type EventName = string;\r\n  export type RunStep = {\r\n    type: StepTypes;\r\n    id: string; // #new\r\n    runId?: string; // #new\r\n    index: number; // #new\r\n    stepIndex?: number; // #new\r\n    stepDetails: StepDetails;\r\n    usage: null | object;\r\n  };\r\n  /**\r\n   * Represents a run step delta i.e. any changed fields on a run step during\r\n   * streaming.\r\n   */\r\n  export interface RunStepDeltaEvent {\r\n    /**\r\n     * The identifier of the run step, which can be referenced in API endpoints.\r\n     */\r\n    id: string;\r\n    /**\r\n     * The delta containing the fields that have changed on the run step.\r\n     */\r\n    delta: ToolCallDelta;\r\n  }\r\n  export type StepDetails = MessageCreationDetails | ToolCallsDetails;\r\n  export type MessageCreationDetails = {\r\n    type: StepTypes.MESSAGE_CREATION;\r\n    message_creation: {\r\n      message_id: string;\r\n    };\r\n  };\r\n  export type ToolCallsDetails = {\r\n    type: StepTypes.TOOL_CALLS;\r\n    tool_calls: AgentToolCall[];\r\n  };\r\n  export type ToolCallDelta = {\r\n    type: StepTypes.TOOL_CALLS | string;\r\n    tool_calls?: ToolCallChunk[];\r\n    auth?: string;\r\n    expires_at?: number;\r\n  };\r\n  export type AgentToolCall = FunctionToolCall | ToolCall;\r\n  export interface ExtendedMessageContent {\r\n    type?: string;\r\n    text?: string;\r\n    input?: string;\r\n    index?: number;\r\n    id?: string;\r\n    name?: string;\r\n  }\r\n  /**\r\n   * Represents a message delta i.e. any changed fields on a message during\r\n   * streaming.\r\n   */\r\n  export interface MessageDeltaEvent {\r\n    /**\r\n     * The identifier of the message, which can be referenced in API endpoints.\r\n     */\r\n    id: string;\r\n    /**\r\n     * The delta containing the fields that have changed on the Message.\r\n     */\r\n    delta: MessageDelta;\r\n  }\r\n  /**\r\n   * The delta containing the fields that have changed on the Message.\r\n   */\r\n  export interface MessageDelta {\r\n    /**\r\n     * The content of the message in array of text and/or images.\r\n     */\r\n    content?: Agents.MessageContentComplex[];\r\n  }\r\n\r\n  /**\r\n   * Represents a reasoning delta i.e. any changed fields on a message during\r\n   * streaming.\r\n   */\r\n  export interface ReasoningDeltaEvent {\r\n    /**\r\n     * The identifier of the message, which can be referenced in API endpoints.\r\n     */\r\n    id: string;\r\n\r\n    /**\r\n     * The delta containing the fields that have changed.\r\n     */\r\n    delta: ReasoningDelta;\r\n  }\r\n\r\n  /**\r\n   * The reasoning delta containing the fields that have changed on the Message.\r\n   */\r\n  export interface ReasoningDelta {\r\n    /**\r\n     * The content of the message in array of text and/or images.\r\n     */\r\n    content?: MessageContentComplex[];\r\n  }\r\n\r\n  export type ReasoningDeltaUpdate = { type: ContentTypes.THINK; think: string };\r\n  export type ContentType =\r\n    | ContentTypes.THINK\r\n    | ContentTypes.TEXT\r\n    | ContentTypes.IMAGE_URL\r\n    | string;\r\n}\r\n\r\nexport type ToolCallResult = {\r\n  user: string;\r\n  toolId: string;\r\n  result?: unknown;\r\n  messageId: string;\r\n  partIndex?: number;\r\n  blockIndex?: number;\r\n  conversationId: string;\r\n  attachments?: TAttachment[];\r\n};\r\n\r\nexport enum AuthTypeEnum {\r\n  ServiceHttp = 'service_http',\r\n  OAuth = 'oauth',\r\n  None = 'none',\r\n}\r\n\r\nexport enum AuthorizationTypeEnum {\r\n  Bearer = 'bearer',\r\n  Basic = 'basic',\r\n  Custom = 'custom',\r\n}\r\n\r\nexport enum TokenExchangeMethodEnum {\r\n  DefaultPost = 'default_post',\r\n  BasicAuthHeader = 'basic_auth_header',\r\n}\r\n\r\nexport type Action = {\r\n  action_id: string;\r\n  type?: string;\r\n  settings?: Record<string, unknown>;\r\n  metadata: ActionMetadata;\r\n  version: number | string;\r\n} & ({ assistant_id: string; agent_id?: never } | { assistant_id?: never; agent_id: string });\r\n\r\nexport type ActionMetadata = {\r\n  api_key?: string;\r\n  auth?: ActionAuth;\r\n  domain?: string;\r\n  privacy_policy_url?: string;\r\n  raw_spec?: string;\r\n  oauth_client_id?: string;\r\n  oauth_client_secret?: string;\r\n};\r\n\r\nexport type ActionAuth = {\r\n  authorization_type?: AuthorizationTypeEnum;\r\n  custom_auth_header?: string;\r\n  type?: AuthTypeEnum;\r\n  authorization_content_type?: string;\r\n  authorization_url?: string;\r\n  client_url?: string;\r\n  scope?: string;\r\n  token_exchange_method?: TokenExchangeMethodEnum;\r\n};\r\n\r\nexport type ActionMetadataRuntime = ActionMetadata & {\r\n  oauth_access_token?: string;\r\n  oauth_refresh_token?: string;\r\n  oauth_token_expires_at?: Date;\r\n};\r\n\r\nexport type MCP = {\r\n  mcp_id: string;\r\n  metadata: MCPMetadata;\r\n} & ({ assistant_id: string; agent_id?: never } | { assistant_id?: never; agent_id?: string });\r\n\r\nexport type MCPMetadata = Omit<ActionMetadata, 'auth'> & {\r\n  name?: string;\r\n  description?: string;\r\n  url?: string;\r\n  tools?: string[];\r\n  auth?: MCPAuth;\r\n  icon?: string;\r\n  trust?: boolean;\r\n};\r\n\r\nexport type MCPAuth = ActionAuth;\r\n\r\nexport type AgentToolType = {\r\n  tool_id: string;\r\n  metadata: ToolMetadata;\r\n} & ({ assistant_id: string; agent_id?: never } | { assistant_id?: never; agent_id?: string });\r\n\r\nexport type ToolMetadata = TPlugin;\r\n","export const envVarRegex = /^\\${(.+)}$/;\r\n\r\n/** Extracts the environment variable name from a template literal string */\r\nexport function extractVariableName(value: string): string | null {\r\n  if (!value) {\r\n    return null;\r\n  }\r\n\r\n  const match = value.trim().match(envVarRegex);\r\n  return match ? match[1] : null;\r\n}\r\n\r\n/** Extracts the value of an environment variable from a string. */\r\nexport function extractEnvVariable(value: string) {\r\n  if (!value) {\r\n    return value;\r\n  }\r\n\r\n  // Trim the input\r\n  const trimmed = value.trim();\r\n\r\n  // Special case: if it's just a single environment variable\r\n  const singleMatch = trimmed.match(envVarRegex);\r\n  if (singleMatch) {\r\n    const varName = singleMatch[1];\r\n    return process.env[varName] || trimmed;\r\n  }\r\n\r\n  // For multiple variables, process them using a regex loop\r\n  const regex = /\\${([^}]+)}/g;\r\n  let result = trimmed;\r\n\r\n  // First collect all matches and their positions\r\n  const matches = [];\r\n  let match;\r\n  while ((match = regex.exec(trimmed)) !== null) {\r\n    matches.push({\r\n      fullMatch: match[0],\r\n      varName: match[1],\r\n      index: match.index,\r\n    });\r\n  }\r\n\r\n  // Process matches in reverse order to avoid position shifts\r\n  for (let i = matches.length - 1; i >= 0; i--) {\r\n    const { fullMatch, varName, index } = matches[i];\r\n    const envValue = process.env[varName] || fullMatch;\r\n\r\n    // Replace at exact position\r\n    result = result.substring(0, index) + envValue + result.substring(index + fullMatch.length);\r\n  }\r\n\r\n  return result;\r\n}\r\n","import { z } from 'zod';\r\nimport { TokenExchangeMethodEnum } from './types/agents';\r\nimport { extractEnvVariable } from './utils';\r\n\r\nconst BaseOptionsSchema = z.object({\r\n  /**\r\n   * Controls whether the MCP server is initialized during application startup.\r\n   * - true (default): Server is initialized during app startup and included in app-level connections\r\n   * - false: Skips initialization at startup and excludes from app-level connections - useful for servers\r\n   *   requiring manual authentication (e.g., GitHub PAT tokens) that need to be configured through the UI after startup\r\n   */\r\n  startup: z.boolean().optional(),\r\n  iconPath: z.string().optional(),\r\n  timeout: z.number().optional(),\r\n  initTimeout: z.number().optional(),\r\n  /** Controls visibility in chat dropdown menu (MCPSelect) */\r\n  chatMenu: z.boolean().optional(),\r\n  /**\r\n   * Controls server instruction behavior:\r\n   * - undefined/not set: No instructions included (default)\r\n   * - true: Use server-provided instructions\r\n   * - string: Use custom instructions (overrides server-provided)\r\n   */\r\n  serverInstructions: z.union([z.boolean(), z.string()]).optional(),\r\n  /**\r\n   * Whether this server requires OAuth authentication\r\n   * If not specified, will be auto-detected during construction\r\n   */\r\n  requiresOAuth: z.boolean().optional(),\r\n  /**\r\n   * OAuth configuration for SSE and Streamable HTTP transports\r\n   * - Optional: OAuth can be auto-discovered on 401 responses\r\n   * - Pre-configured values will skip discovery steps\r\n   */\r\n  oauth: z\r\n    .object({\r\n      /** OAuth authorization endpoint (optional - can be auto-discovered) */\r\n      authorization_url: z.string().url().optional(),\r\n      /** OAuth token endpoint (optional - can be auto-discovered) */\r\n      token_url: z.string().url().optional(),\r\n      /** OAuth client ID (optional - can use dynamic registration) */\r\n      client_id: z.string().optional(),\r\n      /** OAuth client secret (optional - can use dynamic registration) */\r\n      client_secret: z.string().optional(),\r\n      /** OAuth scopes to request */\r\n      scope: z.string().optional(),\r\n      /** OAuth redirect URI (defaults to /api/mcp/{serverName}/oauth/callback) */\r\n      redirect_uri: z.string().url().optional(),\r\n      /** Token exchange method */\r\n      token_exchange_method: z.nativeEnum(TokenExchangeMethodEnum).optional(),\r\n      /** Supported grant types (defaults to ['authorization_code', 'refresh_token']) */\r\n      grant_types_supported: z.array(z.string()).optional(),\r\n      /** Supported token endpoint authentication methods (defaults to ['client_secret_basic', 'client_secret_post']) */\r\n      token_endpoint_auth_methods_supported: z.array(z.string()).optional(),\r\n      /** Supported response types (defaults to ['code']) */\r\n      response_types_supported: z.array(z.string()).optional(),\r\n      /** Supported code challenge methods (defaults to ['S256', 'plain']) */\r\n      code_challenge_methods_supported: z.array(z.string()).optional(),\r\n      /** OAuth revocation endpoint (optional - can be auto-discovered) */\r\n      revocation_endpoint: z.string().url().optional(),\r\n      /** OAuth revocation endpoint authentication methods supported (optional - can be auto-discovered) */\r\n      revocation_endpoint_auth_methods_supported: z.array(z.string()).optional(),\r\n    })\r\n    .optional(),\r\n  customUserVars: z\r\n    .record(\r\n      z.string(),\r\n      z.object({\r\n        title: z.string(),\r\n        description: z.string(),\r\n      }),\r\n    )\r\n    .optional(),\r\n});\r\n\r\nexport const StdioOptionsSchema = BaseOptionsSchema.extend({\r\n  type: z.literal('stdio').optional(),\r\n  /**\r\n   * The executable to run to start the server.\r\n   */\r\n  command: z.string(),\r\n  /**\r\n   * Command line arguments to pass to the executable.\r\n   */\r\n  args: z.array(z.string()),\r\n  /**\r\n   * The environment to use when spawning the process.\r\n   *\r\n   * If not specified, the result of getDefaultEnvironment() will be used.\r\n   * Environment variables can be referenced using ${VAR_NAME} syntax.\r\n   */\r\n  env: z\r\n    .record(z.string(), z.string())\r\n    .optional()\r\n    .transform((env) => {\r\n      if (!env) {\r\n        return env;\r\n      }\r\n\r\n      const processedEnv: Record<string, string> = {};\r\n      for (const [key, value] of Object.entries(env)) {\r\n        processedEnv[key] = extractEnvVariable(value);\r\n      }\r\n      return processedEnv;\r\n    }),\r\n  /**\r\n   * How to handle stderr of the child process. This matches the semantics of Node's `child_process.spawn`.\r\n   *\r\n   * @type {import('node:child_process').IOType | import('node:stream').Stream | number}\r\n   *\r\n   * The default is \"inherit\", meaning messages to stderr will be printed to the parent process's stderr.\r\n   */\r\n  stderr: z.any().optional(),\r\n});\r\n\r\nexport const WebSocketOptionsSchema = BaseOptionsSchema.extend({\r\n  type: z.literal('websocket').optional(),\r\n  url: z\r\n    .string()\r\n    .transform((val: string) => extractEnvVariable(val))\r\n    .pipe(z.string().url())\r\n    .refine(\r\n      (val: string) => {\r\n        const protocol = new URL(val).protocol;\r\n        return protocol === 'ws:' || protocol === 'wss:';\r\n      },\r\n      {\r\n        message: 'WebSocket URL must start with ws:// or wss://',\r\n      },\r\n    ),\r\n});\r\n\r\nexport const SSEOptionsSchema = BaseOptionsSchema.extend({\r\n  type: z.literal('sse').optional(),\r\n  headers: z.record(z.string(), z.string()).optional(),\r\n  url: z\r\n    .string()\r\n    .transform((val: string) => extractEnvVariable(val))\r\n    .pipe(z.string().url())\r\n    .refine(\r\n      (val: string) => {\r\n        const protocol = new URL(val).protocol;\r\n        return protocol !== 'ws:' && protocol !== 'wss:';\r\n      },\r\n      {\r\n        message: 'SSE URL must not start with ws:// or wss://',\r\n      },\r\n    ),\r\n});\r\n\r\nexport const StreamableHTTPOptionsSchema = BaseOptionsSchema.extend({\r\n  type: z.union([z.literal('streamable-http'), z.literal('http')]),\r\n  headers: z.record(z.string(), z.string()).optional(),\r\n  url: z\r\n    .string()\r\n    .transform((val: string) => extractEnvVariable(val))\r\n    .pipe(z.string().url())\r\n    .refine(\r\n      (val: string) => {\r\n        const protocol = new URL(val).protocol;\r\n        return protocol !== 'ws:' && protocol !== 'wss:';\r\n      },\r\n      {\r\n        message: 'Streamable HTTP URL must not start with ws:// or wss://',\r\n      },\r\n    ),\r\n});\r\n\r\nexport const MCPOptionsSchema = z.union([\r\n  StdioOptionsSchema,\r\n  WebSocketOptionsSchema,\r\n  SSEOptionsSchema,\r\n  StreamableHTTPOptionsSchema,\r\n]);\r\n\r\nexport const MCPServersSchema = z.record(z.string(), MCPOptionsSchema);\r\n\r\nexport type MCPOptions = z.infer<typeof MCPOptionsSchema>;\r\n","import type { AssistantsEndpoint } from './schemas';\r\nimport * as q from './types/queries';\r\nimport { ResourceType } from './accessPermissions';\r\n\r\nlet BASE_URL = '';\r\nif (\r\n  typeof process === 'undefined' ||\r\n  (process as typeof process & { browser?: boolean }).browser === true\r\n) {\r\n  // process is only available in node context, or process.browser is true in client-side code\r\n  // This is to ensure that the BASE_URL is set correctly based on the <base>\r\n  // element in the HTML document, if it exists.\r\n  const baseEl = document.querySelector('base');\r\n  BASE_URL = baseEl?.getAttribute('href') || '/';\r\n}\r\n\r\nif (BASE_URL && BASE_URL.endsWith('/')) {\r\n  BASE_URL = BASE_URL.slice(0, -1);\r\n}\r\n\r\nexport const apiBaseUrl = () => BASE_URL;\r\n\r\n// Testing this buildQuery function\r\nconst buildQuery = (params: Record<string, unknown>): string => {\r\n  const query = Object.entries(params)\r\n    .filter(([, value]) => {\r\n      if (Array.isArray(value)) {\r\n        return value.length > 0;\r\n      }\r\n      return value !== undefined && value !== null && value !== '';\r\n    })\r\n    .map(([key, value]) => {\r\n      if (Array.isArray(value)) {\r\n        return value.map((v) => `${key}=${encodeURIComponent(v)}`).join('&');\r\n      }\r\n      return `${key}=${encodeURIComponent(String(value))}`;\r\n    })\r\n    .join('&');\r\n  return query ? `?${query}` : '';\r\n};\r\n\r\nexport const health = () => `${BASE_URL}/health`;\r\nexport const user = () => `${BASE_URL}/api/user`;\r\n\r\nexport const balance = () => `${BASE_URL}/api/balance`;\r\n\r\nexport const userPlugins = () => `${BASE_URL}/api/user/plugins`;\r\n\r\nexport const deleteUser = () => `${BASE_URL}/api/user/delete`;\r\n\r\nconst messagesRoot = `${BASE_URL}/api/messages`;\r\n\r\nexport const messages = (params: q.MessagesListParams) => {\r\n  const { conversationId, messageId, ...rest } = params;\r\n\r\n  if (conversationId && messageId) {\r\n    return `${messagesRoot}/${conversationId}/${messageId}`;\r\n  }\r\n\r\n  if (conversationId) {\r\n    return `${messagesRoot}/${conversationId}`;\r\n  }\r\n\r\n  return `${messagesRoot}${buildQuery(rest)}`;\r\n};\r\n\r\nexport const messagesArtifacts = (messageId: string) => `${messagesRoot}/artifacts/${messageId}`;\r\n\r\nconst shareRoot = `${BASE_URL}/api/share`;\r\nexport const shareMessages = (shareId: string) => `${shareRoot}/${shareId}`;\r\nexport const getSharedLink = (conversationId: string) => `${shareRoot}/link/${conversationId}`;\r\nexport const getSharedLinks = (\r\n  pageSize: number,\r\n  isPublic: boolean,\r\n  sortBy: 'title' | 'createdAt',\r\n  sortDirection: 'asc' | 'desc',\r\n  search?: string,\r\n  cursor?: string,\r\n) =>\r\n  `${shareRoot}?pageSize=${pageSize}&isPublic=${isPublic}&sortBy=${sortBy}&sortDirection=${sortDirection}${\r\n    search ? `&search=${search}` : ''\r\n  }${cursor ? `&cursor=${cursor}` : ''}`;\r\nexport const createSharedLink = (conversationId: string) => `${shareRoot}/${conversationId}`;\r\nexport const updateSharedLink = (shareId: string) => `${shareRoot}/${shareId}`;\r\n\r\nconst keysEndpoint = `${BASE_URL}/api/keys`;\r\n\r\nexport const keys = () => keysEndpoint;\r\n\r\nexport const userKeyQuery = (name: string) => `${keysEndpoint}?name=${name}`;\r\n\r\nexport const revokeUserKey = (name: string) => `${keysEndpoint}/${name}`;\r\n\r\nexport const revokeAllUserKeys = () => `${keysEndpoint}?all=true`;\r\n\r\nexport const conversationsRoot = `${BASE_URL}/api/convos`;\r\n\r\nexport const conversations = (params: q.ConversationListParams) => {\r\n  return `${conversationsRoot}${buildQuery(params)}`;\r\n};\r\n\r\nexport const conversationById = (id: string) => `${conversationsRoot}/${id}`;\r\n\r\nexport const genTitle = () => `${conversationsRoot}/gen_title`;\r\n\r\nexport const updateConversation = () => `${conversationsRoot}/update`;\r\n\r\nexport const deleteConversation = () => `${conversationsRoot}`;\r\n\r\nexport const deleteAllConversation = () => `${conversationsRoot}/all`;\r\n\r\nexport const importConversation = () => `${conversationsRoot}/import`;\r\n\r\nexport const forkConversation = () => `${conversationsRoot}/fork`;\r\n\r\nexport const duplicateConversation = () => `${conversationsRoot}/duplicate`;\r\n\r\nexport const search = (q: string, cursor?: string | null) =>\r\n  `${BASE_URL}/api/search?q=${q}${cursor ? `&cursor=${cursor}` : ''}`;\r\n\r\nexport const searchEnabled = () => `${BASE_URL}/api/search/enable`;\r\n\r\nexport const presets = () => `${BASE_URL}/api/presets`;\r\n\r\nexport const deletePreset = () => `${BASE_URL}/api/presets/delete`;\r\n\r\nexport const aiEndpoints = () => `${BASE_URL}/api/endpoints`;\r\n\r\nexport const models = () => `${BASE_URL}/api/models`;\r\n\r\nexport const tokenizer = () => `${BASE_URL}/api/tokenizer`;\r\n\r\nexport const login = () => `${BASE_URL}/api/auth/login`;\r\n\r\nexport const logout = () => `${BASE_URL}/api/auth/logout`;\r\n\r\nexport const register = () => `${BASE_URL}/api/auth/register`;\r\n\r\nexport const loginFacebook = () => `${BASE_URL}/api/auth/facebook`;\r\n\r\nexport const loginGoogle = () => `${BASE_URL}/api/auth/google`;\r\n\r\nexport const refreshToken = (retry?: boolean) =>\r\n  `${BASE_URL}/api/auth/refresh${retry === true ? '?retry=true' : ''}`;\r\n\r\nexport const requestPasswordReset = () => `${BASE_URL}/api/auth/requestPasswordReset`;\r\n\r\nexport const resetPassword = () => `${BASE_URL}/api/auth/resetPassword`;\r\n\r\nexport const verifyEmail = () => `${BASE_URL}/api/user/verify`;\r\n\r\nexport const resendVerificationEmail = () => `${BASE_URL}/api/user/verify/resend`;\r\n\r\nexport const plugins = () => `${BASE_URL}/api/plugins`;\r\n\r\nexport const mcpReinitialize = (serverName: string) =>\r\n  `${BASE_URL}/api/mcp/${serverName}/reinitialize`;\r\nexport const mcpConnectionStatus = () => `${BASE_URL}/api/mcp/connection/status`;\r\nexport const mcpServerConnectionStatus = (serverName: string) =>\r\n  `${BASE_URL}/api/mcp/connection/status/${serverName}`;\r\nexport const mcpAuthValues = (serverName: string) => {\r\n  return `${BASE_URL}/api/mcp/${serverName}/auth-values`;\r\n};\r\n\r\nexport const cancelMCPOAuth = (serverName: string) => {\r\n  return `${BASE_URL}/api/mcp/oauth/cancel/${serverName}`;\r\n};\r\n\r\nexport const config = () => `${BASE_URL}/api/config`;\r\n\r\nexport const prompts = () => `${BASE_URL}/api/prompts`;\r\n\r\nexport const addPromptToGroup = (groupId: string) =>\r\n  `${BASE_URL}/api/prompts/groups/${groupId}/prompts`;\r\n\r\nexport const assistants = ({\r\n  path = '',\r\n  options,\r\n  version,\r\n  endpoint,\r\n  isAvatar,\r\n}: {\r\n  path?: string;\r\n  options?: object;\r\n  endpoint?: AssistantsEndpoint;\r\n  version: number | string;\r\n  isAvatar?: boolean;\r\n}) => {\r\n  let url = isAvatar === true ? `${images()}/assistants` : `${BASE_URL}/api/assistants/v${version}`;\r\n\r\n  if (path && path !== '') {\r\n    url += `/${path}`;\r\n  }\r\n\r\n  if (endpoint) {\r\n    options = {\r\n      ...(options ?? {}),\r\n      endpoint,\r\n    };\r\n  }\r\n\r\n  if (options && Object.keys(options).length > 0) {\r\n    const queryParams = new URLSearchParams(options as Record<string, string>).toString();\r\n    url += `?${queryParams}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n\r\nexport const agents = ({ path = '', options }: { path?: string; options?: object }) => {\r\n  let url = `${BASE_URL}/api/agents`;\r\n\r\n  if (path && path !== '') {\r\n    url += `/${path}`;\r\n  }\r\n\r\n  if (options && Object.keys(options).length > 0) {\r\n    const queryParams = new URLSearchParams(options as Record<string, string>).toString();\r\n    url += `?${queryParams}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n\r\nexport const mcp = {\r\n  tools: `${BASE_URL}/api/mcp/tools`,\r\n};\r\n\r\nexport const revertAgentVersion = (agent_id: string) => `${agents({ path: `${agent_id}/revert` })}`;\r\n\r\nexport const files = () => `${BASE_URL}/api/files`;\r\nexport const fileUpload = () => `${BASE_URL}/api/files`;\r\nexport const fileDelete = () => `${BASE_URL}/api/files`;\r\nexport const fileDownload = (userId: string, fileId: string) =>\r\n  `${BASE_URL}/api/files/download/${userId}/${fileId}`;\r\nexport const fileConfig = () => `${BASE_URL}/api/files/config`;\r\nexport const agentFiles = (agentId: string) => `${BASE_URL}/api/files/agent/${agentId}`;\r\n\r\nexport const images = () => `${files()}/images`;\r\n\r\nexport const avatar = () => `${images()}/avatar`;\r\n\r\nexport const speech = () => `${files()}/speech`;\r\n\r\nexport const speechToText = () => `${speech()}/stt`;\r\n\r\nexport const textToSpeech = () => `${speech()}/tts`;\r\n\r\nexport const textToSpeechManual = () => `${textToSpeech()}/manual`;\r\n\r\nexport const textToSpeechVoices = () => `${textToSpeech()}/voices`;\r\n\r\nexport const getCustomConfigSpeech = () => `${speech()}/config/get`;\r\n\r\nexport const getPromptGroup = (_id: string) => `${prompts()}/groups/${_id}`;\r\n\r\nexport const getPromptGroupsWithFilters = (filter: object) => {\r\n  let url = `${prompts()}/groups`;\r\n  // Filter out undefined/null values\r\n  const cleanedFilter = Object.entries(filter).reduce(\r\n    (acc, [key, value]) => {\r\n      if (value !== undefined && value !== null && value !== '') {\r\n        acc[key] = value;\r\n      }\r\n      return acc;\r\n    },\r\n    {} as Record<string, string>,\r\n  );\r\n\r\n  if (Object.keys(cleanedFilter).length > 0) {\r\n    const queryParams = new URLSearchParams(cleanedFilter).toString();\r\n    url += `?${queryParams}`;\r\n  }\r\n  return url;\r\n};\r\n\r\nexport const getPromptsWithFilters = (filter: object) => {\r\n  let url = prompts();\r\n  if (Object.keys(filter).length > 0) {\r\n    const queryParams = new URLSearchParams(filter as Record<string, string>).toString();\r\n    url += `?${queryParams}`;\r\n  }\r\n  return url;\r\n};\r\n\r\nexport const getPrompt = (_id: string) => `${prompts()}/${_id}`;\r\n\r\nexport const getRandomPrompts = (limit: number, skip: number) =>\r\n  `${prompts()}/random?limit=${limit}&skip=${skip}`;\r\n\r\nexport const postPrompt = prompts;\r\n\r\nexport const updatePromptGroup = getPromptGroup;\r\n\r\nexport const updatePromptLabels = (_id: string) => `${getPrompt(_id)}/labels`;\r\n\r\nexport const updatePromptTag = (_id: string) => `${getPrompt(_id)}/tags/production`;\r\n\r\nexport const deletePromptGroup = getPromptGroup;\r\n\r\nexport const deletePrompt = ({ _id, groupId }: { _id: string; groupId: string }) => {\r\n  return `${prompts()}/${_id}?groupId=${groupId}`;\r\n};\r\n\r\nexport const getCategories = () => `${BASE_URL}/api/categories`;\r\n\r\nexport const getAllPromptGroups = () => `${prompts()}/all`;\r\n\r\n/* Roles */\r\nexport const roles = () => `${BASE_URL}/api/roles`;\r\nexport const getRole = (roleName: string) => `${roles()}/${roleName.toLowerCase()}`;\r\nexport const updatePromptPermissions = (roleName: string) => `${getRole(roleName)}/prompts`;\r\nexport const updateMemoryPermissions = (roleName: string) => `${getRole(roleName)}/memories`;\r\nexport const updateAgentPermissions = (roleName: string) => `${getRole(roleName)}/agents`;\r\nexport const updatePeoplePickerPermissions = (roleName: string) =>\r\n  `${getRole(roleName)}/people-picker`;\r\n\r\nexport const updateMarketplacePermissions = (roleName: string) =>\r\n  `${getRole(roleName)}/marketplace`;\r\n\r\n/* Conversation Tags */\r\nexport const conversationTags = (tag?: string) =>\r\n  `${BASE_URL}/api/tags${tag != null && tag ? `/${encodeURIComponent(tag)}` : ''}`;\r\n\r\nexport const conversationTagsList = (pageNumber: string, sort?: string, order?: string) =>\r\n  `${conversationTags()}/list?pageNumber=${pageNumber}${sort ? `&sort=${sort}` : ''}${\r\n    order ? `&order=${order}` : ''\r\n  }`;\r\n\r\nexport const addTagToConversation = (conversationId: string) =>\r\n  `${conversationTags()}/convo/${conversationId}`;\r\n\r\nexport const userTerms = () => `${BASE_URL}/api/user/terms`;\r\nexport const acceptUserTerms = () => `${BASE_URL}/api/user/terms/accept`;\r\nexport const banner = () => `${BASE_URL}/api/banner`;\r\n\r\n// Message Feedback\r\nexport const feedback = (conversationId: string, messageId: string) =>\r\n  `${BASE_URL}/api/messages/${conversationId}/${messageId}/feedback`;\r\n\r\n// Two-Factor Endpoints\r\nexport const enableTwoFactor = () => `${BASE_URL}/api/auth/2fa/enable`;\r\nexport const verifyTwoFactor = () => `${BASE_URL}/api/auth/2fa/verify`;\r\nexport const confirmTwoFactor = () => `${BASE_URL}/api/auth/2fa/confirm`;\r\nexport const disableTwoFactor = () => `${BASE_URL}/api/auth/2fa/disable`;\r\nexport const regenerateBackupCodes = () => `${BASE_URL}/api/auth/2fa/backup/regenerate`;\r\nexport const verifyTwoFactorTemp = () => `${BASE_URL}/api/auth/2fa/verify-temp`;\r\n\r\n/* Memories */\r\nexport const memories = () => `${BASE_URL}/api/memories`;\r\nexport const memory = (key: string) => `${memories()}/${encodeURIComponent(key)}`;\r\nexport const memoryPreferences = () => `${memories()}/preferences`;\r\n\r\nexport const searchPrincipals = (params: q.PrincipalSearchParams) => {\r\n  const { q: query, limit, types } = params;\r\n  let url = `${BASE_URL}/api/permissions/search-principals?q=${encodeURIComponent(query)}`;\r\n\r\n  if (limit !== undefined) {\r\n    url += `&limit=${limit}`;\r\n  }\r\n\r\n  if (types && types.length > 0) {\r\n    url += `&types=${types.join(',')}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n\r\nexport const getAccessRoles = (resourceType: ResourceType) =>\r\n  `${BASE_URL}/api/permissions/${resourceType}/roles`;\r\n\r\nexport const getResourcePermissions = (resourceType: ResourceType, resourceId: string) =>\r\n  `${BASE_URL}/api/permissions/${resourceType}/${resourceId}`;\r\n\r\nexport const updateResourcePermissions = (resourceType: ResourceType, resourceId: string) =>\r\n  `${BASE_URL}/api/permissions/${resourceType}/${resourceId}`;\r\n\r\nexport const getEffectivePermissions = (resourceType: ResourceType, resourceId: string) =>\r\n  `${BASE_URL}/api/permissions/${resourceType}/${resourceId}/effective`;\r\n\r\n// SharePoint Graph API Token\r\nexport const graphToken = (scopes: string) =>\r\n  `${BASE_URL}/api/auth/graph-token?scopes=${encodeURIComponent(scopes)}`;\r\n","import { z } from 'zod';\r\nimport type { ZodError } from 'zod';\r\nimport type { TModelsConfig } from './types';\r\nimport { EModelEndpoint, eModelEndpointSchema } from './schemas';\r\nimport { specsConfigSchema, TSpecsConfig } from './models';\r\nimport { fileConfigSchema } from './file-config';\r\nimport { FileSources } from './types/files';\r\nimport { MCPServersSchema } from './mcp';\r\nimport { apiBaseUrl } from './api-endpoints';\r\n\r\nexport const defaultSocialLogins = ['google', 'facebook', 'openid', 'github', 'discord', 'saml'];\r\n\r\nexport const defaultRetrievalModels = [\r\n  'gpt-4o',\r\n  'o1-preview-2024-09-12',\r\n  'o1-preview',\r\n  'o1-mini-2024-09-12',\r\n  'o1-mini',\r\n  'o3-mini',\r\n  'chatgpt-4o-latest',\r\n  'gpt-4o-2024-05-13',\r\n  'gpt-4o-2024-08-06',\r\n  'gpt-4o-mini',\r\n  'gpt-4o-mini-2024-07-18',\r\n  'gpt-4-turbo-preview',\r\n  'gpt-3.5-turbo-0125',\r\n  'gpt-4-0125-preview',\r\n  'gpt-4-1106-preview',\r\n  'gpt-3.5-turbo-1106',\r\n  'gpt-3.5-turbo-0125',\r\n  'gpt-4-turbo',\r\n  'gpt-4-0125',\r\n  'gpt-4-1106',\r\n];\r\n\r\nexport const excludedKeys = new Set([\r\n  'conversationId',\r\n  'title',\r\n  'iconURL',\r\n  'greeting',\r\n  'endpoint',\r\n  'endpointType',\r\n  'createdAt',\r\n  'updatedAt',\r\n  'expiredAt',\r\n  'messages',\r\n  'isArchived',\r\n  'tags',\r\n  'user',\r\n  '__v',\r\n  '_id',\r\n  'tools',\r\n  'model',\r\n  'files',\r\n  'spec',\r\n  'disableParams',\r\n]);\r\n\r\nexport enum SettingsViews {\r\n  default = 'default',\r\n  advanced = 'advanced',\r\n}\r\n\r\nexport const fileSourceSchema = z.nativeEnum(FileSources);\r\n\r\nexport const fileStrategiesSchema = z\r\n  .object({\r\n    default: fileSourceSchema.optional(),\r\n    avatar: fileSourceSchema.optional(),\r\n    image: fileSourceSchema.optional(),\r\n    document: fileSourceSchema.optional(),\r\n  })\r\n  .optional();\r\n\r\n// Helper type to extract the shape of the Zod object schema\r\ntype SchemaShape<T> = T extends z.ZodObject<infer U> ? U : never;\r\n\r\n// Helper type to determine the default value or undefined based on whether the field has a default\r\ntype DefaultValue<T> =\r\n  T extends z.ZodDefault<z.ZodTypeAny> ? ReturnType<T['_def']['defaultValue']> : undefined;\r\n\r\n// Extract default values or undefined from the schema shape\r\ntype ExtractDefaults<T> = {\r\n  [P in keyof T]: DefaultValue<T[P]>;\r\n};\r\n\r\nexport type SchemaDefaults<T> = ExtractDefaults<SchemaShape<T>>;\r\n\r\nexport type TConfigDefaults = SchemaDefaults<typeof configSchema>;\r\n\r\nexport function getSchemaDefaults<Schema extends z.AnyZodObject>(\r\n  schema: Schema,\r\n): ExtractDefaults<SchemaShape<Schema>> {\r\n  const shape = schema.shape;\r\n  const entries = Object.entries(shape).map(([key, value]) => {\r\n    if (value instanceof z.ZodDefault) {\r\n      // Extract default value if it exists\r\n      return [key, value._def.defaultValue()];\r\n    }\r\n    return [key, undefined];\r\n  });\r\n\r\n  // Create the object with the right types\r\n  return Object.fromEntries(entries) as ExtractDefaults<SchemaShape<Schema>>;\r\n}\r\n\r\nexport const modelConfigSchema = z\r\n  .object({\r\n    deploymentName: z.string().optional(),\r\n    version: z.string().optional(),\r\n    assistants: z.boolean().optional(),\r\n  })\r\n  .or(z.boolean());\r\n\r\nexport type TAzureModelConfig = z.infer<typeof modelConfigSchema>;\r\n\r\nexport const azureBaseSchema = z.object({\r\n  apiKey: z.string(),\r\n  serverless: z.boolean().optional(),\r\n  instanceName: z.string().optional(),\r\n  deploymentName: z.string().optional(),\r\n  assistants: z.boolean().optional(),\r\n  addParams: z.record(z.any()).optional(),\r\n  dropParams: z.array(z.string()).optional(),\r\n  forcePrompt: z.boolean().optional(),\r\n  version: z.string().optional(),\r\n  baseURL: z.string().optional(),\r\n  additionalHeaders: z.record(z.any()).optional(),\r\n});\r\n\r\nexport type TAzureBaseSchema = z.infer<typeof azureBaseSchema>;\r\n\r\nexport const azureGroupSchema = z\r\n  .object({\r\n    group: z.string(),\r\n    models: z.record(z.string(), modelConfigSchema),\r\n  })\r\n  .required()\r\n  .and(azureBaseSchema);\r\n\r\nexport const azureGroupConfigsSchema = z.array(azureGroupSchema).min(1);\r\nexport type TAzureGroup = z.infer<typeof azureGroupSchema>;\r\nexport type TAzureGroups = z.infer<typeof azureGroupConfigsSchema>;\r\nexport type TAzureModelMapSchema = {\r\n  // deploymentName?: string;\r\n  // version?: string;\r\n  group: string;\r\n};\r\n\r\nexport type TAzureModelGroupMap = Record<string, TAzureModelMapSchema | undefined>;\r\nexport type TAzureGroupMap = Record<\r\n  string,\r\n  (TAzureBaseSchema & { models: Record<string, TAzureModelConfig | undefined> }) | undefined\r\n>;\r\n\r\nexport type TValidatedAzureConfig = {\r\n  modelNames: string[];\r\n  modelGroupMap: TAzureModelGroupMap;\r\n  groupMap: TAzureGroupMap;\r\n};\r\n\r\nexport type TAzureConfigValidationResult = TValidatedAzureConfig & {\r\n  isValid: boolean;\r\n  errors: (ZodError | string)[];\r\n};\r\n\r\nexport enum Capabilities {\r\n  code_interpreter = 'code_interpreter',\r\n  image_vision = 'image_vision',\r\n  retrieval = 'retrieval',\r\n  actions = 'actions',\r\n  tools = 'tools',\r\n}\r\n\r\nexport enum AgentCapabilities {\r\n  hide_sequential_outputs = 'hide_sequential_outputs',\r\n  end_after_tools = 'end_after_tools',\r\n  execute_code = 'execute_code',\r\n  file_search = 'file_search',\r\n  web_search = 'web_search',\r\n  artifacts = 'artifacts',\r\n  actions = 'actions',\r\n  context = 'context',\r\n  tools = 'tools',\r\n  chain = 'chain',\r\n  ocr = 'ocr',\r\n}\r\n\r\nexport const defaultAssistantsVersion = {\r\n  [EModelEndpoint.assistants]: 2,\r\n  [EModelEndpoint.azureAssistants]: 1,\r\n};\r\n\r\nexport const baseEndpointSchema = z.object({\r\n  streamRate: z.number().optional(),\r\n  baseURL: z.string().optional(),\r\n  titlePrompt: z.string().optional(),\r\n  titleModel: z.string().optional(),\r\n  titleConvo: z.boolean().optional(),\r\n  titleMethod: z\r\n    .union([z.literal('completion'), z.literal('functions'), z.literal('structured')])\r\n    .optional(),\r\n  titleEndpoint: z.string().optional(),\r\n  titlePromptTemplate: z.string().optional(),\r\n});\r\n\r\nexport type TBaseEndpoint = z.infer<typeof baseEndpointSchema>;\r\n\r\nexport const bedrockEndpointSchema = baseEndpointSchema.merge(\r\n  z.object({\r\n    availableRegions: z.array(z.string()).optional(),\r\n  }),\r\n);\r\n\r\nexport const assistantEndpointSchema = baseEndpointSchema.merge(\r\n  z.object({\r\n    /* assistants specific */\r\n    disableBuilder: z.boolean().optional(),\r\n    pollIntervalMs: z.number().optional(),\r\n    timeoutMs: z.number().optional(),\r\n    version: z.union([z.string(), z.number()]).default(2),\r\n    supportedIds: z.array(z.string()).min(1).optional(),\r\n    excludedIds: z.array(z.string()).min(1).optional(),\r\n    privateAssistants: z.boolean().optional(),\r\n    retrievalModels: z.array(z.string()).min(1).optional().default(defaultRetrievalModels),\r\n    capabilities: z\r\n      .array(z.nativeEnum(Capabilities))\r\n      .optional()\r\n      .default([\r\n        Capabilities.code_interpreter,\r\n        Capabilities.image_vision,\r\n        Capabilities.retrieval,\r\n        Capabilities.actions,\r\n        Capabilities.tools,\r\n      ]),\r\n    /* general */\r\n    apiKey: z.string().optional(),\r\n    models: z\r\n      .object({\r\n        default: z.array(z.string()).min(1),\r\n        fetch: z.boolean().optional(),\r\n        userIdQuery: z.boolean().optional(),\r\n      })\r\n      .optional(),\r\n    headers: z.record(z.any()).optional(),\r\n  }),\r\n);\r\n\r\nexport type TAssistantEndpoint = z.infer<typeof assistantEndpointSchema>;\r\n\r\nexport const defaultAgentCapabilities = [\r\n  AgentCapabilities.execute_code,\r\n  AgentCapabilities.file_search,\r\n  AgentCapabilities.web_search,\r\n  AgentCapabilities.artifacts,\r\n  AgentCapabilities.actions,\r\n  AgentCapabilities.context,\r\n  AgentCapabilities.tools,\r\n  AgentCapabilities.chain,\r\n  AgentCapabilities.ocr,\r\n];\r\n\r\nexport const agentsEndpointSchema = baseEndpointSchema\r\n  .merge(\r\n    z.object({\r\n      /* agents specific */\r\n      recursionLimit: z.number().optional(),\r\n      disableBuilder: z.boolean().optional().default(false),\r\n      maxRecursionLimit: z.number().optional(),\r\n      maxCitations: z.number().min(1).max(50).optional().default(30),\r\n      maxCitationsPerFile: z.number().min(1).max(10).optional().default(7),\r\n      minRelevanceScore: z.number().min(0.0).max(1.0).optional().default(0.45),\r\n      allowedProviders: z.array(z.union([z.string(), eModelEndpointSchema])).optional(),\r\n      capabilities: z\r\n        .array(z.nativeEnum(AgentCapabilities))\r\n        .optional()\r\n        .default(defaultAgentCapabilities),\r\n    }),\r\n  )\r\n  .default({\r\n    disableBuilder: false,\r\n    capabilities: defaultAgentCapabilities,\r\n    maxCitations: 30,\r\n    maxCitationsPerFile: 7,\r\n    minRelevanceScore: 0.45,\r\n  });\r\n\r\nexport type TAgentsEndpoint = z.infer<typeof agentsEndpointSchema>;\r\n\r\nexport const endpointSchema = baseEndpointSchema.merge(\r\n  z.object({\r\n    name: z.string().refine((value) => !eModelEndpointSchema.safeParse(value).success, {\r\n      message: `Value cannot be one of the default endpoint (EModelEndpoint) values: ${Object.values(\r\n        EModelEndpoint,\r\n      ).join(', ')}`,\r\n    }),\r\n    apiKey: z.string(),\r\n    baseURL: z.string(),\r\n    models: z.object({\r\n      default: z.array(z.string()).min(1),\r\n      fetch: z.boolean().optional(),\r\n      userIdQuery: z.boolean().optional(),\r\n    }),\r\n    summarize: z.boolean().optional(),\r\n    summaryModel: z.string().optional(),\r\n    iconURL: z.string().optional(),\r\n    forcePrompt: z.boolean().optional(),\r\n    modelDisplayLabel: z.string().optional(),\r\n    headers: z.record(z.any()).optional(),\r\n    addParams: z.record(z.any()).optional(),\r\n    dropParams: z.array(z.string()).optional(),\r\n    customParams: z\r\n      .object({\r\n        defaultParamsEndpoint: z.string().default('custom'),\r\n        paramDefinitions: z.array(z.record(z.any())).optional(),\r\n      })\r\n      .strict(),\r\n    customOrder: z.number().optional(),\r\n    directEndpoint: z.boolean().optional(),\r\n    titleMessageRole: z.string().optional(),\r\n  }),\r\n);\r\n\r\nexport type TEndpoint = z.infer<typeof endpointSchema>;\r\n\r\nexport const azureEndpointSchema = z\r\n  .object({\r\n    groups: azureGroupConfigsSchema,\r\n    plugins: z.boolean().optional(),\r\n    assistants: z.boolean().optional(),\r\n  })\r\n  .and(\r\n    endpointSchema\r\n      .pick({\r\n        streamRate: true,\r\n        titleConvo: true,\r\n        titleMethod: true,\r\n        titleModel: true,\r\n        titlePrompt: true,\r\n        titlePromptTemplate: true,\r\n        summarize: true,\r\n        summaryModel: true,\r\n        customOrder: true,\r\n      })\r\n      .partial(),\r\n  );\r\n\r\nexport type TAzureConfig = Omit<z.infer<typeof azureEndpointSchema>, 'groups'> &\r\n  TAzureConfigValidationResult;\r\n\r\nconst ttsOpenaiSchema = z.object({\r\n  url: z.string().optional(),\r\n  apiKey: z.string(),\r\n  model: z.string(),\r\n  voices: z.array(z.string()),\r\n});\r\n\r\nconst ttsAzureOpenAISchema = z.object({\r\n  instanceName: z.string(),\r\n  apiKey: z.string(),\r\n  deploymentName: z.string(),\r\n  apiVersion: z.string(),\r\n  model: z.string(),\r\n  voices: z.array(z.string()),\r\n});\r\n\r\nconst ttsElevenLabsSchema = z.object({\r\n  url: z.string().optional(),\r\n  websocketUrl: z.string().optional(),\r\n  apiKey: z.string(),\r\n  model: z.string(),\r\n  voices: z.array(z.string()),\r\n  voice_settings: z\r\n    .object({\r\n      similarity_boost: z.number().optional(),\r\n      stability: z.number().optional(),\r\n      style: z.number().optional(),\r\n      use_speaker_boost: z.boolean().optional(),\r\n    })\r\n    .optional(),\r\n  pronunciation_dictionary_locators: z.array(z.string()).optional(),\r\n});\r\n\r\nconst ttsLocalaiSchema = z.object({\r\n  url: z.string(),\r\n  apiKey: z.string().optional(),\r\n  voices: z.array(z.string()),\r\n  backend: z.string(),\r\n});\r\n\r\nconst ttsSchema = z.object({\r\n  openai: ttsOpenaiSchema.optional(),\r\n  azureOpenAI: ttsAzureOpenAISchema.optional(),\r\n  elevenlabs: ttsElevenLabsSchema.optional(),\r\n  localai: ttsLocalaiSchema.optional(),\r\n});\r\n\r\nconst sttOpenaiSchema = z.object({\r\n  url: z.string().optional(),\r\n  apiKey: z.string(),\r\n  model: z.string(),\r\n});\r\n\r\nconst sttAzureOpenAISchema = z.object({\r\n  instanceName: z.string(),\r\n  apiKey: z.string(),\r\n  deploymentName: z.string(),\r\n  apiVersion: z.string(),\r\n});\r\n\r\nconst sttSchema = z.object({\r\n  openai: sttOpenaiSchema.optional(),\r\n  azureOpenAI: sttAzureOpenAISchema.optional(),\r\n});\r\n\r\nconst speechTab = z\r\n  .object({\r\n    conversationMode: z.boolean().optional(),\r\n    advancedMode: z.boolean().optional(),\r\n    speechToText: z\r\n      .boolean()\r\n      .optional()\r\n      .or(\r\n        z.object({\r\n          engineSTT: z.string().optional(),\r\n          languageSTT: z.string().optional(),\r\n          autoTranscribeAudio: z.boolean().optional(),\r\n          decibelValue: z.number().optional(),\r\n          autoSendText: z.number().optional(),\r\n        }),\r\n      )\r\n      .optional(),\r\n    textToSpeech: z\r\n      .boolean()\r\n      .optional()\r\n      .or(\r\n        z.object({\r\n          engineTTS: z.string().optional(),\r\n          voice: z.string().optional(),\r\n          languageTTS: z.string().optional(),\r\n          automaticPlayback: z.boolean().optional(),\r\n          playbackRate: z.number().optional(),\r\n          cacheTTS: z.boolean().optional(),\r\n        }),\r\n      )\r\n      .optional(),\r\n  })\r\n  .optional();\r\n\r\nexport enum RateLimitPrefix {\r\n  FILE_UPLOAD = 'FILE_UPLOAD',\r\n  IMPORT = 'IMPORT',\r\n  TTS = 'TTS',\r\n  STT = 'STT',\r\n}\r\n\r\nexport const rateLimitSchema = z.object({\r\n  fileUploads: z\r\n    .object({\r\n      ipMax: z.number().optional(),\r\n      ipWindowInMinutes: z.number().optional(),\r\n      userMax: z.number().optional(),\r\n      userWindowInMinutes: z.number().optional(),\r\n    })\r\n    .optional(),\r\n  conversationsImport: z\r\n    .object({\r\n      ipMax: z.number().optional(),\r\n      ipWindowInMinutes: z.number().optional(),\r\n      userMax: z.number().optional(),\r\n      userWindowInMinutes: z.number().optional(),\r\n    })\r\n    .optional(),\r\n  tts: z\r\n    .object({\r\n      ipMax: z.number().optional(),\r\n      ipWindowInMinutes: z.number().optional(),\r\n      userMax: z.number().optional(),\r\n      userWindowInMinutes: z.number().optional(),\r\n    })\r\n    .optional(),\r\n  stt: z\r\n    .object({\r\n      ipMax: z.number().optional(),\r\n      ipWindowInMinutes: z.number().optional(),\r\n      userMax: z.number().optional(),\r\n      userWindowInMinutes: z.number().optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\nexport enum EImageOutputType {\r\n  PNG = 'png',\r\n  WEBP = 'webp',\r\n  JPEG = 'jpeg',\r\n}\r\n\r\nconst termsOfServiceSchema = z.object({\r\n  externalUrl: z.string().optional(),\r\n  openNewTab: z.boolean().optional(),\r\n  modalAcceptance: z.boolean().optional(),\r\n  modalTitle: z.string().optional(),\r\n  modalContent: z.string().or(z.array(z.string())).optional(),\r\n});\r\n\r\nexport type TTermsOfService = z.infer<typeof termsOfServiceSchema>;\r\n\r\nconst mcpServersSchema = z.object({\r\n  placeholder: z.string().optional(),\r\n});\r\n\r\nexport type TMcpServersConfig = z.infer<typeof mcpServersSchema>;\r\n\r\nexport const interfaceSchema = z\r\n  .object({\r\n    privacyPolicy: z\r\n      .object({\r\n        externalUrl: z.string().optional(),\r\n        openNewTab: z.boolean().optional(),\r\n      })\r\n      .optional(),\r\n    termsOfService: termsOfServiceSchema.optional(),\r\n    customWelcome: z.string().optional(),\r\n    mcpServers: mcpServersSchema.optional(),\r\n    endpointsMenu: z.boolean().optional(),\r\n    modelSelect: z.boolean().optional(),\r\n    parameters: z.boolean().optional(),\r\n    sidePanel: z.boolean().optional(),\r\n    multiConvo: z.boolean().optional(),\r\n    bookmarks: z.boolean().optional(),\r\n    memories: z.boolean().optional(),\r\n    presets: z.boolean().optional(),\r\n    prompts: z.boolean().optional(),\r\n    agents: z.boolean().optional(),\r\n    temporaryChat: z.boolean().optional(),\r\n    temporaryChatRetention: z.number().min(1).max(8760).optional(),\r\n    runCode: z.boolean().optional(),\r\n    webSearch: z.boolean().optional(),\r\n    peoplePicker: z\r\n      .object({\r\n        users: z.boolean().optional(),\r\n        groups: z.boolean().optional(),\r\n        roles: z.boolean().optional(),\r\n      })\r\n      .optional(),\r\n    marketplace: z\r\n      .object({\r\n        use: z.boolean().optional(),\r\n      })\r\n      .optional(),\r\n    fileSearch: z.boolean().optional(),\r\n    fileCitations: z.boolean().optional(),\r\n  })\r\n  .default({\r\n    endpointsMenu: true,\r\n    modelSelect: true,\r\n    parameters: true,\r\n    sidePanel: true,\r\n    presets: true,\r\n    multiConvo: true,\r\n    bookmarks: true,\r\n    memories: true,\r\n    prompts: true,\r\n    agents: true,\r\n    temporaryChat: true,\r\n    runCode: true,\r\n    webSearch: true,\r\n    peoplePicker: {\r\n      users: true,\r\n      groups: true,\r\n      roles: true,\r\n    },\r\n    marketplace: {\r\n      use: false,\r\n    },\r\n    fileSearch: true,\r\n    fileCitations: true,\r\n  });\r\n\r\nexport type TInterfaceConfig = z.infer<typeof interfaceSchema>;\r\nexport type TBalanceConfig = z.infer<typeof balanceSchema>;\r\nexport type TTransactionsConfig = z.infer<typeof transactionsSchema>;\r\n\r\nexport const turnstileOptionsSchema = z\r\n  .object({\r\n    language: z.string().default('auto'),\r\n    size: z.enum(['normal', 'compact', 'flexible', 'invisible']).default('normal'),\r\n  })\r\n  .default({\r\n    language: 'auto',\r\n    size: 'normal',\r\n  });\r\n\r\nexport const turnstileSchema = z.object({\r\n  siteKey: z.string(),\r\n  options: turnstileOptionsSchema.optional(),\r\n});\r\n\r\nexport type TTurnstileConfig = z.infer<typeof turnstileSchema>;\r\n\r\nexport type TStartupConfig = {\r\n  appTitle: string;\r\n  socialLogins?: string[];\r\n  interface?: TInterfaceConfig;\r\n  turnstile?: TTurnstileConfig;\r\n  balance?: TBalanceConfig;\r\n  transactions?: TTransactionsConfig;\r\n  discordLoginEnabled: boolean;\r\n  facebookLoginEnabled: boolean;\r\n  githubLoginEnabled: boolean;\r\n  googleLoginEnabled: boolean;\r\n  openidLoginEnabled: boolean;\r\n  appleLoginEnabled: boolean;\r\n  samlLoginEnabled: boolean;\r\n  openidLabel: string;\r\n  openidImageUrl: string;\r\n  openidAutoRedirect: boolean;\r\n  samlLabel: string;\r\n  samlImageUrl: string;\r\n  /** LDAP Auth Configuration */\r\n  ldap?: {\r\n    /** LDAP enabled */\r\n    enabled: boolean;\r\n    /** Whether LDAP uses username vs. email */\r\n    username?: boolean;\r\n  };\r\n  serverDomain: string;\r\n  emailLoginEnabled: boolean;\r\n  registrationEnabled: boolean;\r\n  socialLoginEnabled: boolean;\r\n  passwordResetEnabled: boolean;\r\n  emailEnabled: boolean;\r\n  showBirthdayIcon: boolean;\r\n  helpAndFaqURL: string;\r\n  customFooter?: string;\r\n  modelSpecs?: TSpecsConfig;\r\n  sharedLinksEnabled: boolean;\r\n  publicSharedLinksEnabled: boolean;\r\n  analyticsGtmId?: string;\r\n  instanceProjectId: string;\r\n  bundlerURL?: string;\r\n  staticBundlerURL?: string;\r\n  sharePointFilePickerEnabled?: boolean;\r\n  sharePointBaseUrl?: string;\r\n  sharePointPickerGraphScope?: string;\r\n  sharePointPickerSharePointScope?: string;\r\n  openidReuseTokens?: boolean;\r\n  minPasswordLength?: number;\r\n  webSearch?: {\r\n    searchProvider?: SearchProviders;\r\n    scraperType?: ScraperTypes;\r\n    rerankerType?: RerankerTypes;\r\n  };\r\n  mcpServers?: Record<\r\n    string,\r\n    {\r\n      customUserVars: Record<\r\n        string,\r\n        {\r\n          title: string;\r\n          description: string;\r\n        }\r\n      >;\r\n      chatMenu?: boolean;\r\n      isOAuth?: boolean;\r\n      startup?: boolean;\r\n    }\r\n  >;\r\n  mcpPlaceholder?: string;\r\n};\r\n\r\nexport enum OCRStrategy {\r\n  MISTRAL_OCR = 'mistral_ocr',\r\n  CUSTOM_OCR = 'custom_ocr',\r\n  AZURE_MISTRAL_OCR = 'azure_mistral_ocr',\r\n  VERTEXAI_MISTRAL_OCR = 'vertexai_mistral_ocr',\r\n}\r\n\r\nexport enum SearchCategories {\r\n  PROVIDERS = 'providers',\r\n  SCRAPERS = 'scrapers',\r\n  RERANKERS = 'rerankers',\r\n}\r\n\r\nexport enum SearchProviders {\r\n  SERPER = 'serper',\r\n  SEARXNG = 'searxng',\r\n}\r\n\r\nexport enum ScraperTypes {\r\n  FIRECRAWL = 'firecrawl',\r\n  SERPER = 'serper',\r\n}\r\n\r\nexport enum RerankerTypes {\r\n  JINA = 'jina',\r\n  COHERE = 'cohere',\r\n}\r\n\r\nexport enum SafeSearchTypes {\r\n  OFF = 0,\r\n  MODERATE = 1,\r\n  STRICT = 2,\r\n}\r\n\r\nexport const webSearchSchema = z.object({\r\n  serperApiKey: z.string().optional().default('${SERPER_API_KEY}'),\r\n  searxngInstanceUrl: z.string().optional().default('${SEARXNG_INSTANCE_URL}'),\r\n  searxngApiKey: z.string().optional().default('${SEARXNG_API_KEY}'),\r\n  firecrawlApiKey: z.string().optional().default('${FIRECRAWL_API_KEY}'),\r\n  firecrawlApiUrl: z.string().optional().default('${FIRECRAWL_API_URL}'),\r\n  jinaApiKey: z.string().optional().default('${JINA_API_KEY}'),\r\n  jinaApiUrl: z.string().optional().default('${JINA_API_URL}'),\r\n  cohereApiKey: z.string().optional().default('${COHERE_API_KEY}'),\r\n  searchProvider: z.nativeEnum(SearchProviders).optional(),\r\n  scraperType: z.nativeEnum(ScraperTypes).optional(),\r\n  rerankerType: z.nativeEnum(RerankerTypes).optional(),\r\n  scraperTimeout: z.number().optional(),\r\n  safeSearch: z.nativeEnum(SafeSearchTypes).default(SafeSearchTypes.MODERATE),\r\n  firecrawlOptions: z\r\n    .object({\r\n      formats: z.array(z.string()).optional(),\r\n      includeTags: z.array(z.string()).optional(),\r\n      excludeTags: z.array(z.string()).optional(),\r\n      headers: z.record(z.string()).optional(),\r\n      waitFor: z.number().optional(),\r\n      timeout: z.number().optional(),\r\n      maxAge: z.number().optional(),\r\n      mobile: z.boolean().optional(),\r\n      skipTlsVerification: z.boolean().optional(),\r\n      blockAds: z.boolean().optional(),\r\n      removeBase64Images: z.boolean().optional(),\r\n      parsePDF: z.boolean().optional(),\r\n      storeInCache: z.boolean().optional(),\r\n      zeroDataRetention: z.boolean().optional(),\r\n      location: z\r\n        .object({\r\n          country: z.string().optional(),\r\n          languages: z.array(z.string()).optional(),\r\n        })\r\n        .optional(),\r\n      onlyMainContent: z.boolean().optional(),\r\n      changeTrackingOptions: z\r\n        .object({\r\n          modes: z.array(z.string()).optional(),\r\n          schema: z.record(z.unknown()).optional(),\r\n          prompt: z.string().optional(),\r\n          tag: z.string().nullable().optional(),\r\n        })\r\n        .optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\nexport type TWebSearchConfig = z.infer<typeof webSearchSchema>;\r\n\r\nexport const ocrSchema = z.object({\r\n  mistralModel: z.string().optional(),\r\n  apiKey: z.string().optional().default('${OCR_API_KEY}'),\r\n  baseURL: z.string().optional().default('${OCR_BASEURL}'),\r\n  strategy: z.nativeEnum(OCRStrategy).default(OCRStrategy.MISTRAL_OCR),\r\n});\r\n\r\nexport const balanceSchema = z.object({\r\n  enabled: z.boolean().optional().default(false),\r\n  startBalance: z.number().optional().default(20000),\r\n  autoRefillEnabled: z.boolean().optional().default(false),\r\n  refillIntervalValue: z.number().optional().default(30),\r\n  refillIntervalUnit: z\r\n    .enum(['seconds', 'minutes', 'hours', 'days', 'weeks', 'months'])\r\n    .optional()\r\n    .default('days'),\r\n  refillAmount: z.number().optional().default(10000),\r\n});\r\n\r\nexport const transactionsSchema = z.object({\r\n  enabled: z.boolean().optional().default(true),\r\n});\r\n\r\nexport const memorySchema = z.object({\r\n  disabled: z.boolean().optional(),\r\n  validKeys: z.array(z.string()).optional(),\r\n  tokenLimit: z.number().optional(),\r\n  charLimit: z.number().optional().default(10000),\r\n  personalize: z.boolean().default(true),\r\n  messageWindowSize: z.number().optional().default(5),\r\n  agent: z\r\n    .union([\r\n      z.object({\r\n        id: z.string(),\r\n      }),\r\n      z.object({\r\n        provider: z.string(),\r\n        model: z.string(),\r\n        instructions: z.string().optional(),\r\n        model_parameters: z.record(z.any()).optional(),\r\n      }),\r\n    ])\r\n    .optional(),\r\n});\r\n\r\nexport type TMemoryConfig = z.infer<typeof memorySchema>;\r\n\r\nconst customEndpointsSchema = z.array(endpointSchema.partial()).optional();\r\n\r\nexport const configSchema = z.object({\r\n  version: z.string(),\r\n  cache: z.boolean().default(true),\r\n  ocr: ocrSchema.optional(),\r\n  webSearch: webSearchSchema.optional(),\r\n  memory: memorySchema.optional(),\r\n  secureImageLinks: z.boolean().optional(),\r\n  imageOutputType: z.nativeEnum(EImageOutputType).default(EImageOutputType.PNG),\r\n  includedTools: z.array(z.string()).optional(),\r\n  filteredTools: z.array(z.string()).optional(),\r\n  mcpServers: MCPServersSchema.optional(),\r\n  interface: interfaceSchema,\r\n  turnstile: turnstileSchema.optional(),\r\n  fileStrategy: fileSourceSchema.default(FileSources.local),\r\n  fileStrategies: fileStrategiesSchema,\r\n  actions: z\r\n    .object({\r\n      allowedDomains: z.array(z.string()).optional(),\r\n    })\r\n    .optional(),\r\n  registration: z\r\n    .object({\r\n      socialLogins: z.array(z.string()).optional(),\r\n      allowedDomains: z.array(z.string()).optional(),\r\n    })\r\n    .default({ socialLogins: defaultSocialLogins }),\r\n  balance: balanceSchema.optional(),\r\n  transactions: transactionsSchema.optional(),\r\n  speech: z\r\n    .object({\r\n      tts: ttsSchema.optional(),\r\n      stt: sttSchema.optional(),\r\n      speechTab: speechTab.optional(),\r\n    })\r\n    .optional(),\r\n  rateLimits: rateLimitSchema.optional(),\r\n  fileConfig: fileConfigSchema.optional(),\r\n  modelSpecs: specsConfigSchema.optional(),\r\n  endpoints: z\r\n    .object({\r\n      all: baseEndpointSchema.optional(),\r\n      [EModelEndpoint.openAI]: baseEndpointSchema.optional(),\r\n      [EModelEndpoint.google]: baseEndpointSchema.optional(),\r\n      [EModelEndpoint.anthropic]: baseEndpointSchema.optional(),\r\n      [EModelEndpoint.gptPlugins]: baseEndpointSchema.optional(),\r\n      [EModelEndpoint.azureOpenAI]: azureEndpointSchema.optional(),\r\n      [EModelEndpoint.azureAssistants]: assistantEndpointSchema.optional(),\r\n      [EModelEndpoint.assistants]: assistantEndpointSchema.optional(),\r\n      [EModelEndpoint.agents]: agentsEndpointSchema.optional(),\r\n      [EModelEndpoint.custom]: customEndpointsSchema.optional(),\r\n      [EModelEndpoint.bedrock]: baseEndpointSchema.optional(),\r\n    })\r\n    .strict()\r\n    .refine((data) => Object.keys(data).length > 0, {\r\n      message: 'At least one `endpoints` field must be provided.',\r\n    })\r\n    .optional(),\r\n});\r\n\r\nexport const getConfigDefaults = () => getSchemaDefaults(configSchema);\r\n\r\nexport type TCustomConfig = z.infer<typeof configSchema>;\r\nexport type TCustomEndpoints = z.infer<typeof customEndpointsSchema>;\r\n\r\nexport type TProviderSchema =\r\n  | z.infer<typeof ttsOpenaiSchema>\r\n  | z.infer<typeof ttsElevenLabsSchema>\r\n  | z.infer<typeof ttsLocalaiSchema>\r\n  | undefined;\r\n\r\nexport enum KnownEndpoints {\r\n  anyscale = 'anyscale',\r\n  apipie = 'apipie',\r\n  cohere = 'cohere',\r\n  fireworks = 'fireworks',\r\n  deepseek = 'deepseek',\r\n  groq = 'groq',\r\n  huggingface = 'huggingface',\r\n  mistral = 'mistral',\r\n  mlx = 'mlx',\r\n  ollama = 'ollama',\r\n  openrouter = 'openrouter',\r\n  perplexity = 'perplexity',\r\n  shuttleai = 'shuttleai',\r\n  'together.ai' = 'together.ai',\r\n  unify = 'unify',\r\n  vercel = 'vercel',\r\n  xai = 'xai',\r\n}\r\n\r\nexport enum FetchTokenConfig {\r\n  openrouter = KnownEndpoints.openrouter,\r\n}\r\n\r\nexport const defaultEndpoints: EModelEndpoint[] = [\r\n  EModelEndpoint.openAI,\r\n  EModelEndpoint.assistants,\r\n  EModelEndpoint.azureAssistants,\r\n  EModelEndpoint.azureOpenAI,\r\n  EModelEndpoint.agents,\r\n  EModelEndpoint.chatGPTBrowser,\r\n  EModelEndpoint.gptPlugins,\r\n  EModelEndpoint.google,\r\n  EModelEndpoint.anthropic,\r\n  EModelEndpoint.custom,\r\n  EModelEndpoint.bedrock,\r\n];\r\n\r\nexport const alternateName = {\r\n  [EModelEndpoint.openAI]: 'OpenAI',\r\n  [EModelEndpoint.assistants]: 'Assistants',\r\n  [EModelEndpoint.agents]: 'My Agents',\r\n  [EModelEndpoint.azureAssistants]: 'Azure Assistants',\r\n  [EModelEndpoint.azureOpenAI]: 'Azure OpenAI',\r\n  [EModelEndpoint.chatGPTBrowser]: 'ChatGPT',\r\n  [EModelEndpoint.gptPlugins]: 'Plugins',\r\n  [EModelEndpoint.google]: 'Google',\r\n  [EModelEndpoint.anthropic]: 'Anthropic',\r\n  [EModelEndpoint.custom]: 'Custom',\r\n  [EModelEndpoint.bedrock]: 'AWS Bedrock',\r\n  [KnownEndpoints.ollama]: 'Ollama',\r\n  [KnownEndpoints.deepseek]: 'DeepSeek',\r\n  [KnownEndpoints.xai]: 'xAI',\r\n  [KnownEndpoints.vercel]: 'Vercel',\r\n};\r\n\r\nconst sharedOpenAIModels = [\r\n  'gpt-4o-mini',\r\n  'gpt-4o',\r\n  'gpt-4.5-preview',\r\n  'gpt-4.5-preview-2025-02-27',\r\n  'gpt-3.5-turbo',\r\n  'gpt-3.5-turbo-0125',\r\n  'gpt-4-turbo',\r\n  'gpt-4-turbo-2024-04-09',\r\n  'gpt-4-0125-preview',\r\n  'gpt-4-turbo-preview',\r\n  'gpt-4-1106-preview',\r\n  'gpt-3.5-turbo-1106',\r\n  'gpt-3.5-turbo-16k-0613',\r\n  'gpt-3.5-turbo-16k',\r\n  'gpt-4',\r\n  'gpt-4-0314',\r\n  'gpt-4-32k-0314',\r\n  'gpt-4-0613',\r\n  'gpt-3.5-turbo-0613',\r\n];\r\n\r\nconst sharedAnthropicModels = [\r\n  'claude-sonnet-4-5',\r\n  'claude-sonnet-4-5-20250929',\r\n  'claude-opus-4-1',\r\n  'claude-opus-4-1-20250805',\r\n  'claude-sonnet-4-20250514',\r\n  'claude-sonnet-4-0',\r\n  'claude-opus-4-20250514',\r\n  'claude-opus-4-0',\r\n  'claude-3-7-sonnet-latest',\r\n  'claude-3-7-sonnet-20250219',\r\n  'claude-3-5-haiku-20241022',\r\n  'claude-3-5-sonnet-20241022',\r\n  'claude-3-5-sonnet-20240620',\r\n  'claude-3-5-sonnet-latest',\r\n  'claude-3-opus-20240229',\r\n  'claude-3-sonnet-20240229',\r\n  'claude-3-haiku-20240307',\r\n  'claude-2.1',\r\n  'claude-2',\r\n  'claude-1.2',\r\n  'claude-1',\r\n  'claude-1-100k',\r\n  'claude-instant-1',\r\n  'claude-instant-1-100k',\r\n];\r\n\r\nexport const bedrockModels = [\r\n  'anthropic.claude-3-5-sonnet-20241022-v2:0',\r\n  'anthropic.claude-3-5-sonnet-20240620-v1:0',\r\n  'anthropic.claude-3-5-haiku-20241022-v1:0',\r\n  'anthropic.claude-3-haiku-20240307-v1:0',\r\n  'anthropic.claude-3-opus-20240229-v1:0',\r\n  'anthropic.claude-3-sonnet-20240229-v1:0',\r\n  'anthropic.claude-v2',\r\n  'anthropic.claude-v2:1',\r\n  'anthropic.claude-instant-v1',\r\n  // 'cohere.command-text-v14', // no conversation history\r\n  // 'cohere.command-light-text-v14', // no conversation history\r\n  'cohere.command-r-v1:0',\r\n  'cohere.command-r-plus-v1:0',\r\n  'meta.llama2-13b-chat-v1',\r\n  'meta.llama2-70b-chat-v1',\r\n  'meta.llama3-8b-instruct-v1:0',\r\n  'meta.llama3-70b-instruct-v1:0',\r\n  'meta.llama3-1-8b-instruct-v1:0',\r\n  'meta.llama3-1-70b-instruct-v1:0',\r\n  'meta.llama3-1-405b-instruct-v1:0',\r\n  'mistral.mistral-7b-instruct-v0:2',\r\n  'mistral.mixtral-8x7b-instruct-v0:1',\r\n  'mistral.mistral-large-2402-v1:0',\r\n  'mistral.mistral-large-2407-v1:0',\r\n  'mistral.mistral-small-2402-v1:0',\r\n  'ai21.jamba-instruct-v1:0',\r\n  // 'ai21.j2-mid-v1', // no streaming\r\n  // 'ai21.j2-ultra-v1', no conversation history\r\n  'amazon.titan-text-lite-v1',\r\n  'amazon.titan-text-express-v1',\r\n  'amazon.titan-text-premier-v1:0',\r\n];\r\n\r\nexport const defaultModels = {\r\n  [EModelEndpoint.azureAssistants]: sharedOpenAIModels,\r\n  [EModelEndpoint.assistants]: [...sharedOpenAIModels, 'chatgpt-4o-latest'],\r\n  [EModelEndpoint.agents]: sharedOpenAIModels, // TODO: Add agent models (agentsModels)\r\n  [EModelEndpoint.google]: [\r\n    // Gemini 2.5 Models\r\n    'gemini-2.5-pro',\r\n    'gemini-2.5-flash',\r\n    'gemini-2.5-flash-lite',\r\n    // Gemini 2.0 Models\r\n    'gemini-2.0-flash-001',\r\n    'gemini-2.0-flash-lite',\r\n  ],\r\n  [EModelEndpoint.anthropic]: sharedAnthropicModels,\r\n  [EModelEndpoint.openAI]: [\r\n    ...sharedOpenAIModels,\r\n    'chatgpt-4o-latest',\r\n    'gpt-4-vision-preview',\r\n    'gpt-3.5-turbo-instruct-0914',\r\n    'gpt-3.5-turbo-instruct',\r\n  ],\r\n  [EModelEndpoint.bedrock]: bedrockModels,\r\n};\r\n\r\nconst fitlerAssistantModels = (str: string) => {\r\n  return /gpt-4|gpt-3\\\\.5/i.test(str) && !/vision|instruct/i.test(str);\r\n};\r\n\r\nconst openAIModels = defaultModels[EModelEndpoint.openAI];\r\n\r\nexport const initialModelsConfig: TModelsConfig = {\r\n  initial: [],\r\n  [EModelEndpoint.openAI]: openAIModels,\r\n  [EModelEndpoint.assistants]: openAIModels.filter(fitlerAssistantModels),\r\n  [EModelEndpoint.agents]: openAIModels, // TODO: Add agent models (agentsModels)\r\n  [EModelEndpoint.gptPlugins]: openAIModels,\r\n  [EModelEndpoint.azureOpenAI]: openAIModels,\r\n  [EModelEndpoint.chatGPTBrowser]: ['text-davinci-002-render-sha'],\r\n  [EModelEndpoint.google]: defaultModels[EModelEndpoint.google],\r\n  [EModelEndpoint.anthropic]: defaultModels[EModelEndpoint.anthropic],\r\n  [EModelEndpoint.bedrock]: defaultModels[EModelEndpoint.bedrock],\r\n};\r\n\r\nexport const EndpointURLs = {\r\n  [EModelEndpoint.assistants]: `${apiBaseUrl()}/api/assistants/v2/chat`,\r\n  [EModelEndpoint.azureAssistants]: `${apiBaseUrl()}/api/assistants/v1/chat`,\r\n  [EModelEndpoint.agents]: `${apiBaseUrl()}/api/${EModelEndpoint.agents}/chat`,\r\n} as const;\r\n\r\nexport const modularEndpoints = new Set<EModelEndpoint | string>([\r\n  EModelEndpoint.gptPlugins,\r\n  EModelEndpoint.anthropic,\r\n  EModelEndpoint.google,\r\n  EModelEndpoint.openAI,\r\n  EModelEndpoint.azureOpenAI,\r\n  EModelEndpoint.custom,\r\n  EModelEndpoint.agents,\r\n  EModelEndpoint.bedrock,\r\n]);\r\n\r\nexport const supportsBalanceCheck = {\r\n  [EModelEndpoint.custom]: true,\r\n  [EModelEndpoint.openAI]: true,\r\n  [EModelEndpoint.anthropic]: true,\r\n  [EModelEndpoint.gptPlugins]: true,\r\n  [EModelEndpoint.assistants]: true,\r\n  [EModelEndpoint.agents]: true,\r\n  [EModelEndpoint.azureAssistants]: true,\r\n  [EModelEndpoint.azureOpenAI]: true,\r\n  [EModelEndpoint.bedrock]: true,\r\n};\r\n\r\nexport const visionModels = [\r\n  'qwen-vl',\r\n  'grok-vision',\r\n  'grok-2-vision',\r\n  'grok-3',\r\n  'gpt-4o-mini',\r\n  'gpt-4o',\r\n  'gpt-4-turbo',\r\n  'gpt-4-vision',\r\n  'o4-mini',\r\n  'o3',\r\n  'o1',\r\n  'gpt-4.1',\r\n  'gpt-4.5',\r\n  'llava',\r\n  'llava-13b',\r\n  'gemini-pro-vision',\r\n  'claude-3',\r\n  'gemma',\r\n  'gemini-exp',\r\n  'gemini-1.5',\r\n  'gemini-2',\r\n  'gemini-2.5',\r\n  'gemini-3',\r\n  'moondream',\r\n  'llama3.2-vision',\r\n  'llama-3.2-11b-vision',\r\n  'llama-3-2-11b-vision',\r\n  'llama-3.2-90b-vision',\r\n  'llama-3-2-90b-vision',\r\n  'llama-4',\r\n  'claude-opus-4',\r\n  'claude-sonnet-4',\r\n  'claude-haiku-4',\r\n];\r\nexport enum VisionModes {\r\n  generative = 'generative',\r\n  agents = 'agents',\r\n}\r\n\r\nexport function validateVisionModel({\r\n  model,\r\n  additionalModels = [],\r\n  availableModels,\r\n}: {\r\n  model: string;\r\n  additionalModels?: string[];\r\n  availableModels?: string[];\r\n}) {\r\n  if (!model) {\r\n    return false;\r\n  }\r\n\r\n  if (model.includes('gpt-4-turbo-preview') || model.includes('o1-mini')) {\r\n    return false;\r\n  }\r\n\r\n  if (availableModels && !availableModels.includes(model)) {\r\n    return false;\r\n  }\r\n\r\n  return visionModels.concat(additionalModels).some((visionModel) => model.includes(visionModel));\r\n}\r\n\r\nexport const imageGenTools = new Set(['dalle', 'dall-e', 'stable-diffusion', 'flux']);\r\n\r\n/**\r\n * Enum for collections using infinite queries\r\n */\r\nexport enum InfiniteCollections {\r\n  /**\r\n   * Collection for Prompt Groups\r\n   */\r\n  PROMPT_GROUPS = 'promptGroups',\r\n  /**\r\n   * Collection for Shared Links\r\n   */\r\n  SHARED_LINKS = 'sharedLinks',\r\n}\r\n\r\n/**\r\n * Enum for time intervals\r\n */\r\nexport enum Time {\r\n  ONE_DAY = 86400000,\r\n  ONE_HOUR = 3600000,\r\n  THIRTY_MINUTES = 1800000,\r\n  TEN_MINUTES = 600000,\r\n  FIVE_MINUTES = 300000,\r\n  THREE_MINUTES = 180000,\r\n  TWO_MINUTES = 120000,\r\n  ONE_MINUTE = 60000,\r\n  THIRTY_SECONDS = 30000,\r\n}\r\n\r\n/**\r\n * Enum for cache keys.\r\n */\r\nexport enum CacheKeys {\r\n  /**\r\n   * Key for the config store namespace.\r\n   */\r\n  CONFIG_STORE = 'CONFIG_STORE',\r\n  /**\r\n   * Key for the roles cache.\r\n   */\r\n  ROLES = 'ROLES',\r\n  /**\r\n   * Key for the plugins cache.\r\n   */\r\n  PLUGINS = 'PLUGINS',\r\n  /**\r\n   * Key for the title generation cache.\r\n   */\r\n  GEN_TITLE = 'GEN_TITLE',\r\n  /**\r\n   * Key for the tools cache.\r\n   */\r\n  TOOLS = 'TOOLS',\r\n  /**\r\n   * Key for the model config cache.\r\n   */\r\n  MODELS_CONFIG = 'MODELS_CONFIG',\r\n  /**\r\n   * Key for the model queries cache.\r\n   */\r\n  MODEL_QUERIES = 'MODEL_QUERIES',\r\n  /**\r\n   * Key for the default startup config cache.\r\n   */\r\n  STARTUP_CONFIG = 'STARTUP_CONFIG',\r\n  /**\r\n   * Key for the default endpoint config cache.\r\n   */\r\n  ENDPOINT_CONFIG = 'ENDPOINT_CONFIG',\r\n  /**\r\n   * Key for accessing the model token config cache.\r\n   */\r\n  TOKEN_CONFIG = 'TOKEN_CONFIG',\r\n  /**\r\n   * Key for the app config namespace.\r\n   */\r\n  APP_CONFIG = 'APP_CONFIG',\r\n  /**\r\n   * Key for accessing Abort Keys\r\n   */\r\n  ABORT_KEYS = 'ABORT_KEYS',\r\n  /**\r\n   * Key for the bans cache.\r\n   */\r\n  BANS = 'BANS',\r\n  /**\r\n   * Key for the encoded domains cache.\r\n   * Used by Azure OpenAI Assistants.\r\n   */\r\n  ENCODED_DOMAINS = 'ENCODED_DOMAINS',\r\n  /**\r\n   * Key for the cached audio run Ids.\r\n   */\r\n  AUDIO_RUNS = 'AUDIO_RUNS',\r\n  /**\r\n   * Key for in-progress messages.\r\n   */\r\n  MESSAGES = 'MESSAGES',\r\n  /**\r\n   * Key for in-progress flow states.\r\n   */\r\n  FLOWS = 'FLOWS',\r\n  /**\r\n   * Key for pending chat requests (concurrency check)\r\n   */\r\n  PENDING_REQ = 'PENDING_REQ',\r\n  /**\r\n   * Key for s3 check intervals per user\r\n   */\r\n  S3_EXPIRY_INTERVAL = 'S3_EXPIRY_INTERVAL',\r\n  /**\r\n   * key for open id exchanged tokens\r\n   */\r\n  OPENID_EXCHANGED_TOKENS = 'OPENID_EXCHANGED_TOKENS',\r\n  /**\r\n   * Key for OpenID session.\r\n   */\r\n  OPENID_SESSION = 'OPENID_SESSION',\r\n  /**\r\n   * Key for SAML session.\r\n   */\r\n  SAML_SESSION = 'SAML_SESSION',\r\n}\r\n\r\n/**\r\n * Enum for violation types, used to identify, log, and cache violations.\r\n */\r\nexport enum ViolationTypes {\r\n  /**\r\n   * File Upload Violations (exceeding limit).\r\n   */\r\n  FILE_UPLOAD_LIMIT = 'file_upload_limit',\r\n  /**\r\n   * Illegal Model Request (not available).\r\n   */\r\n  ILLEGAL_MODEL_REQUEST = 'illegal_model_request',\r\n  /**\r\n   * Token Limit Violation.\r\n   */\r\n  TOKEN_BALANCE = 'token_balance',\r\n  /**\r\n   * An issued ban.\r\n   */\r\n  BAN = 'ban',\r\n  /**\r\n   * TTS Request Limit Violation.\r\n   */\r\n  TTS_LIMIT = 'tts_limit',\r\n  /**\r\n   * STT Request Limit Violation.\r\n   */\r\n  STT_LIMIT = 'stt_limit',\r\n  /**\r\n   * Reset Password Limit Violation.\r\n   */\r\n  RESET_PASSWORD_LIMIT = 'reset_password_limit',\r\n  /**\r\n   * Verify Email Limit Violation.\r\n   */\r\n  VERIFY_EMAIL_LIMIT = 'verify_email_limit',\r\n  /**\r\n   * Verify Conversation Access violation.\r\n   */\r\n  CONVO_ACCESS = 'convo_access',\r\n  /**\r\n   * Tool Call Limit Violation.\r\n   */\r\n  TOOL_CALL_LIMIT = 'tool_call_limit',\r\n  /**\r\n   * General violation (catch-all).\r\n   */\r\n  GENERAL = 'general',\r\n  /**\r\n   * Login attempt violations.\r\n   */\r\n  LOGINS = 'logins',\r\n  /**\r\n   * Concurrent request violations.\r\n   */\r\n  CONCURRENT = 'concurrent',\r\n  /**\r\n   * Non-browser access violations.\r\n   */\r\n  NON_BROWSER = 'non_browser',\r\n  /**\r\n   * Message limit violations.\r\n   */\r\n  MESSAGE_LIMIT = 'message_limit',\r\n  /**\r\n   * Registration violations.\r\n   */\r\n  REGISTRATIONS = 'registrations',\r\n}\r\n\r\n/**\r\n * Enum for error message types that are not \"violations\" as above, used to identify client-facing errors.\r\n */\r\nexport enum ErrorTypes {\r\n  /**\r\n   * No User-provided Key.\r\n   */\r\n  NO_USER_KEY = 'no_user_key',\r\n  /**\r\n   * Expired User-provided Key.\r\n   */\r\n  EXPIRED_USER_KEY = 'expired_user_key',\r\n  /**\r\n   * Invalid User-provided Key.\r\n   */\r\n  INVALID_USER_KEY = 'invalid_user_key',\r\n  /**\r\n   * No Base URL Provided.\r\n   */\r\n  NO_BASE_URL = 'no_base_url',\r\n  /**\r\n   * Moderation error\r\n   */\r\n  MODERATION = 'moderation',\r\n  /**\r\n   * Prompt exceeds max length\r\n   */\r\n  INPUT_LENGTH = 'INPUT_LENGTH',\r\n  /**\r\n   * Invalid request error, API rejected request\r\n   */\r\n  INVALID_REQUEST = 'invalid_request_error',\r\n  /**\r\n   * Invalid action request error, likely not on list of allowed domains\r\n   */\r\n  INVALID_ACTION = 'invalid_action_error',\r\n  /**\r\n   * Invalid request error, API rejected request\r\n   */\r\n  NO_SYSTEM_MESSAGES = 'no_system_messages',\r\n  /**\r\n   * Google provider returned an error\r\n   */\r\n  GOOGLE_ERROR = 'google_error',\r\n  /**\r\n   * Google provider does not allow custom tools with built-in tools\r\n   */\r\n  GOOGLE_TOOL_CONFLICT = 'google_tool_conflict',\r\n  /**\r\n   * Invalid Agent Provider (excluded by Admin)\r\n   */\r\n  INVALID_AGENT_PROVIDER = 'invalid_agent_provider',\r\n  /**\r\n   * Missing model selection\r\n   */\r\n  MISSING_MODEL = 'missing_model',\r\n  /**\r\n   * Models configuration not loaded\r\n   */\r\n  MODELS_NOT_LOADED = 'models_not_loaded',\r\n  /**\r\n   * Endpoint models not loaded\r\n   */\r\n  ENDPOINT_MODELS_NOT_LOADED = 'endpoint_models_not_loaded',\r\n  /**\r\n   * Generic Authentication failure\r\n   */\r\n  AUTH_FAILED = 'auth_failed',\r\n}\r\n\r\n/**\r\n * Enum for authentication keys.\r\n */\r\nexport enum AuthKeys {\r\n  /**\r\n   * Key for the Service Account to use Vertex AI.\r\n   */\r\n  GOOGLE_SERVICE_KEY = 'GOOGLE_SERVICE_KEY',\r\n  /**\r\n   * API key to use Google Generative AI.\r\n   *\r\n   * Note: this is not for Environment Variables, but to access encrypted object values.\r\n   */\r\n  GOOGLE_API_KEY = 'GOOGLE_API_KEY',\r\n}\r\n\r\n/**\r\n * Enum for Image Detail Cost.\r\n *\r\n * **Low Res Fixed Cost:** `85`\r\n *\r\n * **High Res Calculation:**\r\n *\r\n * Number of `512px` Tiles * `170` + `85` (Additional Cost)\r\n */\r\nexport enum ImageDetailCost {\r\n  /**\r\n   * Low resolution is a fixed value.\r\n   */\r\n  LOW = 85,\r\n  /**\r\n   * High resolution Cost Per Tile\r\n   */\r\n  HIGH = 170,\r\n  /**\r\n   * Additional Cost added to High Resolution Total Cost\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-duplicate-enum-values\r\n  ADDITIONAL = 85,\r\n}\r\n\r\n/**\r\n * Tab values for Settings Dialog\r\n */\r\nexport enum SettingsTabValues {\r\n  /**\r\n   * Tab for General Settings\r\n   */\r\n  GENERAL = 'general',\r\n  /**\r\n   * Tab for Chat Settings\r\n   */\r\n  CHAT = 'chat',\r\n  /**\r\n   * Tab for Speech Settings\r\n   */\r\n  SPEECH = 'speech',\r\n  /**\r\n   * Tab for Beta Features\r\n   */\r\n  BETA = 'beta',\r\n  /**\r\n   * Tab for Data Controls\r\n   */\r\n  DATA = 'data',\r\n  /**\r\n   * Tab for Balance Settings\r\n   */\r\n  BALANCE = 'balance',\r\n  /**\r\n   * Tab for Account Settings\r\n   */\r\n  ACCOUNT = 'account',\r\n  /**\r\n   * Chat input commands\r\n   */\r\n  COMMANDS = 'commands',\r\n  /**\r\n   * Tab for Personalization Settings\r\n   */\r\n  PERSONALIZATION = 'personalization',\r\n}\r\n\r\nexport enum STTProviders {\r\n  /**\r\n   * Provider for OpenAI STT\r\n   */\r\n  OPENAI = 'openai',\r\n  /**\r\n   * Provider for Microsoft Azure STT\r\n   */\r\n  AZURE_OPENAI = 'azureOpenAI',\r\n}\r\n\r\nexport enum TTSProviders {\r\n  /**\r\n   * Provider for OpenAI TTS\r\n   */\r\n  OPENAI = 'openai',\r\n  /**\r\n   * Provider for Microsoft Azure OpenAI TTS\r\n   */\r\n  AZURE_OPENAI = 'azureOpenAI',\r\n  /**\r\n   * Provider for ElevenLabs TTS\r\n   */\r\n  ELEVENLABS = 'elevenlabs',\r\n  /**\r\n   * Provider for LocalAI TTS\r\n   */\r\n  LOCALAI = 'localai',\r\n}\r\n\r\n/** Enum for app-wide constants */\r\nexport enum Constants {\r\n  /** Key for the app's version. */\r\n  VERSION = 'v0.8.0-rc4',\r\n  /** Key for the Custom Config's version (librechat.yaml). */\r\n  CONFIG_VERSION = '1.2.9',\r\n  /** Standard value for the first message's `parentMessageId` value, to indicate no parent exists. */\r\n  NO_PARENT = '00000000-0000-0000-0000-000000000000',\r\n  /** Standard value to use whatever the submission prelim. `responseMessageId` is */\r\n  USE_PRELIM_RESPONSE_MESSAGE_ID = 'USE_PRELIM_RESPONSE_MESSAGE_ID',\r\n  /** Standard value for the initial conversationId before a request is sent */\r\n  NEW_CONVO = 'new',\r\n  /** Standard value for the temporary conversationId after a request is sent and before the server responds */\r\n  PENDING_CONVO = 'PENDING',\r\n  /** Standard value for the conversationId used for search queries */\r\n  SEARCH = 'search',\r\n  /** Fixed, encoded domain length for Azure OpenAI Assistants Function name parsing. */\r\n  ENCODED_DOMAIN_LENGTH = 10,\r\n  /** Identifier for using current_model in multi-model requests. */\r\n  CURRENT_MODEL = 'current_model',\r\n  /** Common divider for text values */\r\n  COMMON_DIVIDER = '__',\r\n  /** Max length for commands */\r\n  COMMANDS_MAX_LENGTH = 56,\r\n  /** Default Stream Rate (ms) */\r\n  DEFAULT_STREAM_RATE = 1,\r\n  /** Saved Tag */\r\n  SAVED_TAG = 'Saved',\r\n  /** Max number of Conversation starters for Agents/Assistants */\r\n  MAX_CONVO_STARTERS = 4,\r\n  /** Global/instance Project Name */\r\n  GLOBAL_PROJECT_NAME = 'instance',\r\n  /** Delimiter for MCP tools */\r\n  mcp_delimiter = '_mcp_',\r\n  /** Prefix for MCP plugins */\r\n  mcp_prefix = 'mcp_',\r\n  /** Unique value to indicate all MCP servers. For backend use only. */\r\n  mcp_all = 'sys__all__sys',\r\n  /**\r\n   * Unique value to indicate the MCP tool was added to an agent.\r\n   * This helps inform the UI if the mcp server was previously added.\r\n   * */\r\n  mcp_server = 'sys__server__sys',\r\n  /** Placeholder Agent ID for Ephemeral Agents */\r\n  EPHEMERAL_AGENT_ID = 'ephemeral',\r\n}\r\n\r\nexport enum LocalStorageKeys {\r\n  /** Key for the admin defined App Title */\r\n  APP_TITLE = 'appTitle',\r\n  /** Key for the last conversation setup. */\r\n  LAST_CONVO_SETUP = 'lastConversationSetup',\r\n  /** Key for the last selected model. */\r\n  LAST_MODEL = 'lastSelectedModel',\r\n  /** Key for the last selected tools. */\r\n  LAST_TOOLS = 'lastSelectedTools',\r\n  /** Key for the last selected spec by name*/\r\n  LAST_SPEC = 'lastSelectedSpec',\r\n  /** Key for temporary files to delete */\r\n  FILES_TO_DELETE = 'filesToDelete',\r\n  /** Prefix key for the last selected assistant ID by index */\r\n  ASST_ID_PREFIX = 'assistant_id__',\r\n  /** Prefix key for the last selected agent ID by index */\r\n  AGENT_ID_PREFIX = 'agent_id__',\r\n  /** Key for the last selected fork setting */\r\n  FORK_SETTING = 'forkSetting',\r\n  /** Key for remembering the last selected option, instead of manually selecting */\r\n  REMEMBER_FORK_OPTION = 'rememberDefaultFork',\r\n  /** Key for remembering the split at target fork option modifier */\r\n  FORK_SPLIT_AT_TARGET = 'splitAtTarget',\r\n  /** Key for saving text drafts */\r\n  TEXT_DRAFT = 'textDraft_',\r\n  /** Key for saving file drafts */\r\n  FILES_DRAFT = 'filesDraft_',\r\n  /** Key for last Selected Prompt Category */\r\n  LAST_PROMPT_CATEGORY = 'lastPromptCategory',\r\n  /** Key for rendering User Messages as Markdown */\r\n  ENABLE_USER_MSG_MARKDOWN = 'enableUserMsgMarkdown',\r\n  /** Key for displaying analysis tool code input */\r\n  SHOW_ANALYSIS_CODE = 'showAnalysisCode',\r\n  /** Last selected MCP values per conversation ID */\r\n  LAST_MCP_ = 'LAST_MCP_',\r\n  /** Last checked toggle for Code Interpreter API per conversation ID */\r\n  LAST_CODE_TOGGLE_ = 'LAST_CODE_TOGGLE_',\r\n  /** Last checked toggle for Web Search per conversation ID */\r\n  LAST_WEB_SEARCH_TOGGLE_ = 'LAST_WEB_SEARCH_TOGGLE_',\r\n  /** Last checked toggle for File Search per conversation ID */\r\n  LAST_FILE_SEARCH_TOGGLE_ = 'LAST_FILE_SEARCH_TOGGLE_',\r\n  /** Last checked toggle for Artifacts per conversation ID */\r\n  LAST_ARTIFACTS_TOGGLE_ = 'LAST_ARTIFACTS_TOGGLE_',\r\n  /** Key for the last selected agent provider */\r\n  LAST_AGENT_PROVIDER = 'lastAgentProvider',\r\n  /** Key for the last selected agent model */\r\n  LAST_AGENT_MODEL = 'lastAgentModel',\r\n  /** Pin state for MCP tools per conversation ID */\r\n  PIN_MCP_ = 'PIN_MCP_',\r\n  /** Pin state for Web Search per conversation ID */\r\n  PIN_WEB_SEARCH_ = 'PIN_WEB_SEARCH_',\r\n  /** Pin state for Code Interpreter per conversation ID */\r\n  PIN_CODE_INTERPRETER_ = 'PIN_CODE_INTERPRETER_',\r\n}\r\n\r\nexport enum ForkOptions {\r\n  /** Key for direct path option */\r\n  DIRECT_PATH = 'directPath',\r\n  /** Key for including branches */\r\n  INCLUDE_BRANCHES = 'includeBranches',\r\n  /** Key for target level fork (default) */\r\n  TARGET_LEVEL = 'targetLevel',\r\n  /** Default option */\r\n  DEFAULT = 'default',\r\n}\r\n\r\n/**\r\n * Enum for Cohere related constants\r\n */\r\nexport enum CohereConstants {\r\n  /**\r\n   * Cohere API Endpoint, for special handling\r\n   */\r\n  API_URL = 'https://api.cohere.ai/v1',\r\n  /**\r\n   * Role for \"USER\" messages\r\n   */\r\n  ROLE_USER = 'USER',\r\n  /**\r\n   * Role for \"SYSTEM\" messages\r\n   */\r\n  ROLE_SYSTEM = 'SYSTEM',\r\n  /**\r\n   * Role for \"CHATBOT\" messages\r\n   */\r\n  ROLE_CHATBOT = 'CHATBOT',\r\n  /**\r\n   * Title message as required by Cohere\r\n   */\r\n  TITLE_MESSAGE = 'TITLE:',\r\n}\r\n\r\nexport enum SystemCategories {\r\n  ALL = 'sys__all__sys',\r\n  MY_PROMPTS = 'sys__my__prompts__sys',\r\n  NO_CATEGORY = 'sys__no__category__sys',\r\n  SHARED_PROMPTS = 'sys__shared__prompts__sys',\r\n}\r\n\r\nexport const providerEndpointMap = {\r\n  [EModelEndpoint.openAI]: EModelEndpoint.openAI,\r\n  [EModelEndpoint.bedrock]: EModelEndpoint.bedrock,\r\n  [EModelEndpoint.anthropic]: EModelEndpoint.anthropic,\r\n  [EModelEndpoint.azureOpenAI]: EModelEndpoint.azureOpenAI,\r\n};\r\n\r\nexport const specialVariables = {\r\n  current_date: true,\r\n  current_user: true,\r\n  iso_datetime: true,\r\n  current_datetime: true,\r\n};\r\n\r\nexport type TSpecialVarLabel = `com_ui_special_var_${keyof typeof specialVariables}`;\r\n","/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport axios, { AxiosError, AxiosRequestConfig } from 'axios';\r\nimport * as endpoints from './api-endpoints';\r\nimport { setTokenHeader } from './headers-helpers';\r\nimport type * as t from './types';\r\n\r\nasync function _get<T>(url: string, options?: AxiosRequestConfig): Promise<T> {\r\n  const response = await axios.get(url, { ...options });\r\n  return response.data;\r\n}\r\n\r\nasync function _getResponse<T>(url: string, options?: AxiosRequestConfig): Promise<T> {\r\n  return await axios.get(url, { ...options });\r\n}\r\n\r\nasync function _post(url: string, data?: any) {\r\n  const response = await axios.post(url, JSON.stringify(data), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return response.data;\r\n}\r\n\r\nasync function _postMultiPart(url: string, formData: FormData, options?: AxiosRequestConfig) {\r\n  const response = await axios.post(url, formData, {\r\n    ...options,\r\n    headers: { 'Content-Type': 'multipart/form-data' },\r\n  });\r\n  return response.data;\r\n}\r\n\r\nasync function _postTTS(url: string, formData: FormData, options?: AxiosRequestConfig) {\r\n  const response = await axios.post(url, formData, {\r\n    ...options,\r\n    headers: { 'Content-Type': 'multipart/form-data' },\r\n    responseType: 'arraybuffer',\r\n  });\r\n  return response.data;\r\n}\r\n\r\nasync function _put(url: string, data?: any) {\r\n  const response = await axios.put(url, JSON.stringify(data), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return response.data;\r\n}\r\n\r\nasync function _delete<T>(url: string): Promise<T> {\r\n  const response = await axios.delete(url);\r\n  return response.data;\r\n}\r\n\r\nasync function _deleteWithOptions<T>(url: string, options?: AxiosRequestConfig): Promise<T> {\r\n  const response = await axios.delete(url, { ...options });\r\n  return response.data;\r\n}\r\n\r\nasync function _patch(url: string, data?: any) {\r\n  const response = await axios.patch(url, JSON.stringify(data), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  return response.data;\r\n}\r\n\r\nlet isRefreshing = false;\r\nlet failedQueue: { resolve: (value?: any) => void; reject: (reason?: any) => void }[] = [];\r\n\r\nconst refreshToken = (retry?: boolean): Promise<t.TRefreshTokenResponse | undefined> =>\r\n  _post(endpoints.refreshToken(retry));\r\n\r\nconst dispatchTokenUpdatedEvent = (token: string) => {\r\n  setTokenHeader(token);\r\n  window.dispatchEvent(new CustomEvent('tokenUpdated', { detail: token }));\r\n};\r\n\r\nconst processQueue = (error: AxiosError | null, token: string | null = null) => {\r\n  failedQueue.forEach((prom) => {\r\n    if (error) {\r\n      prom.reject(error);\r\n    } else {\r\n      prom.resolve(token);\r\n    }\r\n  });\r\n  failedQueue = [];\r\n};\r\n\r\nif (typeof window !== 'undefined') {\r\n  axios.interceptors.response.use(\r\n    (response) => response,\r\n    async (error) => {\r\n      const originalRequest = error.config;\r\n      if (!error.response) {\r\n        return Promise.reject(error);\r\n      }\r\n\r\n      if (originalRequest.url?.includes('/api/auth/2fa') === true) {\r\n        return Promise.reject(error);\r\n      }\r\n      if (originalRequest.url?.includes('/api/auth/logout') === true) {\r\n        return Promise.reject(error);\r\n      }\r\n\r\n      if (error.response.status === 401 && !originalRequest._retry) {\r\n        console.warn('401 error, refreshing token');\r\n        originalRequest._retry = true;\r\n\r\n        if (isRefreshing) {\r\n          try {\r\n            const token = await new Promise((resolve, reject) => {\r\n              failedQueue.push({ resolve, reject });\r\n            });\r\n            originalRequest.headers['Authorization'] = 'Bearer ' + token;\r\n            return await axios(originalRequest);\r\n          } catch (err) {\r\n            return Promise.reject(err);\r\n          }\r\n        }\r\n\r\n        isRefreshing = true;\r\n\r\n        try {\r\n          const response = await refreshToken(\r\n            // Handle edge case where we get a blank screen if the initial 401 error is from a refresh token request\r\n            originalRequest.url?.includes('api/auth/refresh') === true ? true : false,\r\n          );\r\n\r\n          const token = response?.token ?? '';\r\n\r\n          if (token) {\r\n            originalRequest.headers['Authorization'] = 'Bearer ' + token;\r\n            dispatchTokenUpdatedEvent(token);\r\n            processQueue(null, token);\r\n            return await axios(originalRequest);\r\n          } else if (window.location.href.includes('share/')) {\r\n            console.log(\r\n              `Refresh token failed from shared link, attempting request to ${originalRequest.url}`,\r\n            );\r\n          } else {\r\n            window.location.href = '/login';\r\n          }\r\n        } catch (err) {\r\n          processQueue(err as AxiosError, null);\r\n          return Promise.reject(err);\r\n        } finally {\r\n          isRefreshing = false;\r\n        }\r\n      }\r\n\r\n      return Promise.reject(error);\r\n    },\r\n  );\r\n}\r\n\r\nexport default {\r\n  get: _get,\r\n  getResponse: _getResponse,\r\n  post: _post,\r\n  postMultiPart: _postMultiPart,\r\n  postTTS: _postTTS,\r\n  put: _put,\r\n  delete: _delete,\r\n  deleteWithOptions: _deleteWithOptions,\r\n  patch: _patch,\r\n  refreshToken,\r\n  dispatchTokenUpdatedEvent,\r\n};\r\n","import axios from 'axios';\r\n\r\nexport function setAcceptLanguageHeader(value: string): void {\r\n  axios.defaults.headers.common['Accept-Language'] = value;\r\n}\r\n\r\nexport function setTokenHeader(token: string) {\r\n  axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;\r\n}\r\n","import type { AxiosResponse } from 'axios';\r\nimport type * as t from './types';\r\nimport * as endpoints from './api-endpoints';\r\nimport * as a from './types/assistants';\r\nimport * as ag from './types/agents';\r\nimport * as m from './types/mutations';\r\nimport * as q from './types/queries';\r\nimport * as f from './types/files';\r\nimport * as config from './config';\r\nimport request from './request';\r\nimport * as s from './schemas';\r\nimport * as r from './roles';\r\nimport * as permissions from './accessPermissions';\r\n\r\nexport function revokeUserKey(name: string): Promise<unknown> {\r\n  return request.delete(endpoints.revokeUserKey(name));\r\n}\r\n\r\nexport function revokeAllUserKeys(): Promise<unknown> {\r\n  return request.delete(endpoints.revokeAllUserKeys());\r\n}\r\n\r\nexport function deleteUser(): Promise<s.TPreset> {\r\n  return request.delete(endpoints.deleteUser());\r\n}\r\n\r\nexport function getSharedMessages(shareId: string): Promise<t.TSharedMessagesResponse> {\r\n  return request.get(endpoints.shareMessages(shareId));\r\n}\r\n\r\nexport const listSharedLinks = async (\r\n  params: q.SharedLinksListParams,\r\n): Promise<q.SharedLinksResponse> => {\r\n  const { pageSize, isPublic, sortBy, sortDirection, search, cursor } = params;\r\n\r\n  return request.get(\r\n    endpoints.getSharedLinks(pageSize, isPublic, sortBy, sortDirection, search, cursor),\r\n  );\r\n};\r\n\r\nexport function getSharedLink(conversationId: string): Promise<t.TSharedLinkGetResponse> {\r\n  return request.get(endpoints.getSharedLink(conversationId));\r\n}\r\n\r\nexport function createSharedLink(conversationId: string): Promise<t.TSharedLinkResponse> {\r\n  return request.post(endpoints.createSharedLink(conversationId));\r\n}\r\n\r\nexport function updateSharedLink(shareId: string): Promise<t.TSharedLinkResponse> {\r\n  return request.patch(endpoints.updateSharedLink(shareId));\r\n}\r\n\r\nexport function deleteSharedLink(shareId: string): Promise<m.TDeleteSharedLinkResponse> {\r\n  return request.delete(endpoints.shareMessages(shareId));\r\n}\r\n\r\nexport function updateUserKey(payload: t.TUpdateUserKeyRequest) {\r\n  const { value } = payload;\r\n  if (!value) {\r\n    throw new Error('value is required');\r\n  }\r\n\r\n  return request.put(endpoints.keys(), payload);\r\n}\r\n\r\nexport function getPresets(): Promise<s.TPreset[]> {\r\n  return request.get(endpoints.presets());\r\n}\r\n\r\nexport function createPreset(payload: s.TPreset): Promise<s.TPreset> {\r\n  return request.post(endpoints.presets(), payload);\r\n}\r\n\r\nexport function updatePreset(payload: s.TPreset): Promise<s.TPreset> {\r\n  return request.post(endpoints.presets(), payload);\r\n}\r\n\r\nexport function deletePreset(arg: s.TPreset | undefined): Promise<m.PresetDeleteResponse> {\r\n  return request.post(endpoints.deletePreset(), arg);\r\n}\r\n\r\nexport function getSearchEnabled(): Promise<boolean> {\r\n  return request.get(endpoints.searchEnabled());\r\n}\r\n\r\nexport function getUser(): Promise<t.TUser> {\r\n  return request.get(endpoints.user());\r\n}\r\n\r\nexport function getUserBalance(): Promise<t.TBalanceResponse> {\r\n  return request.get(endpoints.balance());\r\n}\r\n\r\nexport const updateTokenCount = (text: string) => {\r\n  return request.post(endpoints.tokenizer(), { arg: text });\r\n};\r\n\r\nexport const login = (payload: t.TLoginUser): Promise<t.TLoginResponse> => {\r\n  return request.post(endpoints.login(), payload);\r\n};\r\n\r\nexport const logout = (): Promise<m.TLogoutResponse> => {\r\n  return request.post(endpoints.logout());\r\n};\r\n\r\nexport const register = (payload: t.TRegisterUser) => {\r\n  return request.post(endpoints.register(), payload);\r\n};\r\n\r\nexport const userKeyQuery = (name: string): Promise<t.TCheckUserKeyResponse> =>\r\n  request.get(endpoints.userKeyQuery(name));\r\n\r\nexport const getLoginGoogle = () => {\r\n  return request.get(endpoints.loginGoogle());\r\n};\r\n\r\nexport const requestPasswordReset = (\r\n  payload: t.TRequestPasswordReset,\r\n): Promise<t.TRequestPasswordResetResponse> => {\r\n  return request.post(endpoints.requestPasswordReset(), payload);\r\n};\r\n\r\nexport const resetPassword = (payload: t.TResetPassword) => {\r\n  return request.post(endpoints.resetPassword(), payload);\r\n};\r\n\r\nexport const verifyEmail = (payload: t.TVerifyEmail): Promise<t.VerifyEmailResponse> => {\r\n  return request.post(endpoints.verifyEmail(), payload);\r\n};\r\n\r\nexport const resendVerificationEmail = (\r\n  payload: t.TResendVerificationEmail,\r\n): Promise<t.VerifyEmailResponse> => {\r\n  return request.post(endpoints.resendVerificationEmail(), payload);\r\n};\r\n\r\nexport const getAvailablePlugins = (): Promise<s.TPlugin[]> => {\r\n  return request.get(endpoints.plugins());\r\n};\r\n\r\nexport const updateUserPlugins = (payload: t.TUpdateUserPlugins) => {\r\n  return request.post(endpoints.userPlugins(), payload);\r\n};\r\n\r\nexport const reinitializeMCPServer = (serverName: string) => {\r\n  return request.post(endpoints.mcpReinitialize(serverName));\r\n};\r\n\r\nexport const getMCPConnectionStatus = (): Promise<q.MCPConnectionStatusResponse> => {\r\n  return request.get(endpoints.mcpConnectionStatus());\r\n};\r\n\r\nexport const getMCPServerConnectionStatus = (\r\n  serverName: string,\r\n): Promise<q.MCPServerConnectionStatusResponse> => {\r\n  return request.get(endpoints.mcpServerConnectionStatus(serverName));\r\n};\r\n\r\nexport const getMCPAuthValues = (serverName: string): Promise<q.MCPAuthValuesResponse> => {\r\n  return request.get(endpoints.mcpAuthValues(serverName));\r\n};\r\n\r\nexport function cancelMCPOAuth(serverName: string): Promise<m.CancelMCPOAuthResponse> {\r\n  return request.post(endpoints.cancelMCPOAuth(serverName), {});\r\n}\r\n\r\n/* Config */\r\n\r\nexport const getStartupConfig = (): Promise<\r\n  config.TStartupConfig & {\r\n    mcpCustomUserVars?: Record<string, { title: string; description: string }>;\r\n  }\r\n> => {\r\n  return request.get(endpoints.config());\r\n};\r\n\r\nexport const getAIEndpoints = (): Promise<t.TEndpointsConfig> => {\r\n  return request.get(endpoints.aiEndpoints());\r\n};\r\n\r\nexport const getModels = async (): Promise<t.TModelsConfig> => {\r\n  return request.get(endpoints.models());\r\n};\r\n\r\n/* Assistants */\r\n\r\nexport const createAssistant = ({\r\n  version,\r\n  ...data\r\n}: a.AssistantCreateParams): Promise<a.Assistant> => {\r\n  return request.post(endpoints.assistants({ version }), data);\r\n};\r\n\r\nexport const getAssistantById = ({\r\n  endpoint,\r\n  assistant_id,\r\n  version,\r\n}: {\r\n  endpoint: s.AssistantsEndpoint;\r\n  assistant_id: string;\r\n  version: number | string | number;\r\n}): Promise<a.Assistant> => {\r\n  return request.get(\r\n    endpoints.assistants({\r\n      path: assistant_id,\r\n      endpoint,\r\n      version,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const updateAssistant = ({\r\n  assistant_id,\r\n  data,\r\n  version,\r\n}: {\r\n  assistant_id: string;\r\n  data: a.AssistantUpdateParams;\r\n  version: number | string;\r\n}): Promise<a.Assistant> => {\r\n  return request.patch(\r\n    endpoints.assistants({\r\n      path: assistant_id,\r\n      version,\r\n    }),\r\n    data,\r\n  );\r\n};\r\n\r\nexport const deleteAssistant = ({\r\n  assistant_id,\r\n  model,\r\n  endpoint,\r\n  version,\r\n}: m.DeleteAssistantBody & { version: number | string }): Promise<void> => {\r\n  return request.delete(\r\n    endpoints.assistants({\r\n      path: assistant_id,\r\n      options: { model, endpoint },\r\n      version,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const listAssistants = (\r\n  params: a.AssistantListParams,\r\n  version: number | string,\r\n): Promise<a.AssistantListResponse> => {\r\n  return request.get(\r\n    endpoints.assistants({\r\n      version,\r\n      options: params,\r\n    }),\r\n  );\r\n};\r\n\r\nexport function getAssistantDocs({\r\n  endpoint,\r\n  version,\r\n}: {\r\n  endpoint: s.AssistantsEndpoint | string;\r\n  version: number | string;\r\n}): Promise<a.AssistantDocument[]> {\r\n  if (!s.isAssistantsEndpoint(endpoint)) {\r\n    return Promise.resolve([]);\r\n  }\r\n  return request.get(\r\n    endpoints.assistants({\r\n      path: 'documents',\r\n      version,\r\n      options: { endpoint },\r\n      endpoint: endpoint as s.AssistantsEndpoint,\r\n    }),\r\n  );\r\n}\r\n\r\n/* Tools */\r\n\r\nexport const getAvailableTools = (\r\n  _endpoint: s.AssistantsEndpoint | s.EModelEndpoint.agents,\r\n  version?: number | string,\r\n): Promise<s.TPlugin[]> => {\r\n  let path = '';\r\n  if (s.isAssistantsEndpoint(_endpoint)) {\r\n    const endpoint = _endpoint as s.AssistantsEndpoint;\r\n    path = endpoints.assistants({\r\n      path: 'tools',\r\n      endpoint: endpoint,\r\n      version: version ?? config.defaultAssistantsVersion[endpoint],\r\n    });\r\n  } else {\r\n    path = endpoints.agents({\r\n      path: 'tools',\r\n    });\r\n  }\r\n\r\n  return request.get(path);\r\n};\r\n\r\n/* MCP Tools - Decoupled from regular tools */\r\n\r\nexport const getMCPTools = (): Promise<q.MCPServersResponse> => {\r\n  return request.get(endpoints.mcp.tools);\r\n};\r\n\r\nexport const getVerifyAgentToolAuth = (\r\n  params: q.VerifyToolAuthParams,\r\n): Promise<q.VerifyToolAuthResponse> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: `tools/${params.toolId}/auth`,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const callTool = <T extends m.ToolId>({\r\n  toolId,\r\n  toolParams,\r\n}: {\r\n  toolId: T;\r\n  toolParams: m.ToolParams<T>;\r\n}): Promise<m.ToolCallResponse> => {\r\n  return request.post(\r\n    endpoints.agents({\r\n      path: `tools/${toolId}/call`,\r\n    }),\r\n    toolParams,\r\n  );\r\n};\r\n\r\nexport const getToolCalls = (params: q.GetToolCallParams): Promise<q.ToolCallResults> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: 'tools/calls',\r\n      options: params,\r\n    }),\r\n  );\r\n};\r\n\r\n/* Files */\r\n\r\nexport const getFiles = (): Promise<f.TFile[]> => {\r\n  return request.get(endpoints.files());\r\n};\r\n\r\nexport const getAgentFiles = (agentId: string): Promise<f.TFile[]> => {\r\n  return request.get(endpoints.agentFiles(agentId));\r\n};\r\n\r\nexport const getFileConfig = (): Promise<f.FileConfig> => {\r\n  return request.get(`${endpoints.files()}/config`);\r\n};\r\n\r\nexport const uploadImage = (\r\n  data: FormData,\r\n  signal?: AbortSignal | null,\r\n): Promise<f.TFileUpload> => {\r\n  const requestConfig = signal ? { signal } : undefined;\r\n  return request.postMultiPart(endpoints.images(), data, requestConfig);\r\n};\r\n\r\nexport const uploadFile = (data: FormData, signal?: AbortSignal | null): Promise<f.TFileUpload> => {\r\n  const requestConfig = signal ? { signal } : undefined;\r\n  return request.postMultiPart(endpoints.files(), data, requestConfig);\r\n};\r\n\r\n/* actions */\r\n\r\nexport const updateAction = (data: m.UpdateActionVariables): Promise<m.UpdateActionResponse> => {\r\n  const { assistant_id, version, ...body } = data;\r\n  return request.post(\r\n    endpoints.assistants({\r\n      path: `actions/${assistant_id}`,\r\n      version,\r\n    }),\r\n    body,\r\n  );\r\n};\r\n\r\nexport function getActions(): Promise<ag.Action[]> {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: 'actions',\r\n    }),\r\n  );\r\n}\r\n\r\nexport const deleteAction = async ({\r\n  assistant_id,\r\n  action_id,\r\n  model,\r\n  version,\r\n  endpoint,\r\n}: m.DeleteActionVariables & { version: number | string }): Promise<void> =>\r\n  request.delete(\r\n    endpoints.assistants({\r\n      path: `actions/${assistant_id}/${action_id}/${model}`,\r\n      version,\r\n      endpoint,\r\n    }),\r\n  );\r\n\r\n/**\r\n * Agents\r\n */\r\n\r\nexport const createAgent = ({ ...data }: a.AgentCreateParams): Promise<a.Agent> => {\r\n  return request.post(endpoints.agents({}), data);\r\n};\r\n\r\nexport const getAgentById = ({ agent_id }: { agent_id: string }): Promise<a.Agent> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: agent_id,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const getExpandedAgentById = ({ agent_id }: { agent_id: string }): Promise<a.Agent> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: `${agent_id}/expanded`,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const updateAgent = ({\r\n  agent_id,\r\n  data,\r\n}: {\r\n  agent_id: string;\r\n  data: a.AgentUpdateParams;\r\n}): Promise<a.Agent> => {\r\n  return request.patch(\r\n    endpoints.agents({\r\n      path: agent_id,\r\n    }),\r\n    data,\r\n  );\r\n};\r\n\r\nexport const duplicateAgent = ({\r\n  agent_id,\r\n}: m.DuplicateAgentBody): Promise<{ agent: a.Agent; actions: ag.Action[] }> => {\r\n  return request.post(\r\n    endpoints.agents({\r\n      path: `${agent_id}/duplicate`,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const deleteAgent = ({ agent_id }: m.DeleteAgentBody): Promise<void> => {\r\n  return request.delete(\r\n    endpoints.agents({\r\n      path: agent_id,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const listAgents = (params: a.AgentListParams): Promise<a.AgentListResponse> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      options: params,\r\n    }),\r\n  );\r\n};\r\n\r\nexport const revertAgentVersion = ({\r\n  agent_id,\r\n  version_index,\r\n}: {\r\n  agent_id: string;\r\n  version_index: number;\r\n}): Promise<a.Agent> => request.post(endpoints.revertAgentVersion(agent_id), { version_index });\r\n\r\n/* Marketplace */\r\n\r\n/**\r\n * Get agent categories with counts for marketplace tabs\r\n */\r\nexport const getAgentCategories = (): Promise<t.TMarketplaceCategory[]> => {\r\n  return request.get(endpoints.agents({ path: 'categories' }));\r\n};\r\n\r\n/**\r\n * Unified marketplace agents endpoint with query string controls\r\n */\r\nexport const getMarketplaceAgents = (params: {\r\n  requiredPermission: number;\r\n  category?: string;\r\n  search?: string;\r\n  limit?: number;\r\n  cursor?: string;\r\n  promoted?: 0 | 1;\r\n}): Promise<a.AgentListResponse> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      // path: 'marketplace',\r\n      options: params,\r\n    }),\r\n  );\r\n};\r\n\r\n/* Tools */\r\n\r\nexport const getAvailableAgentTools = (): Promise<s.TPlugin[]> => {\r\n  return request.get(\r\n    endpoints.agents({\r\n      path: 'tools',\r\n    }),\r\n  );\r\n};\r\n\r\n/* Actions */\r\n\r\nexport const updateAgentAction = (\r\n  data: m.UpdateAgentActionVariables,\r\n): Promise<m.UpdateAgentActionResponse> => {\r\n  const { agent_id, ...body } = data;\r\n  return request.post(\r\n    endpoints.agents({\r\n      path: `actions/${agent_id}`,\r\n    }),\r\n    body,\r\n  );\r\n};\r\n\r\nexport const deleteAgentAction = async ({\r\n  agent_id,\r\n  action_id,\r\n}: m.DeleteAgentActionVariables): Promise<void> =>\r\n  request.delete(\r\n    endpoints.agents({\r\n      path: `actions/${agent_id}/${action_id}`,\r\n    }),\r\n  );\r\n\r\n/**\r\n * Imports a conversations file.\r\n *\r\n * @param data - The FormData containing the file to import.\r\n * @returns A Promise that resolves to the import start response.\r\n */\r\nexport const importConversationsFile = (data: FormData): Promise<t.TImportResponse> => {\r\n  return request.postMultiPart(endpoints.importConversation(), data);\r\n};\r\n\r\nexport const uploadAvatar = (data: FormData): Promise<f.AvatarUploadResponse> => {\r\n  return request.postMultiPart(endpoints.avatar(), data);\r\n};\r\n\r\nexport const uploadAssistantAvatar = (data: m.AssistantAvatarVariables): Promise<a.Assistant> => {\r\n  return request.postMultiPart(\r\n    endpoints.assistants({\r\n      isAvatar: true,\r\n      path: `${data.assistant_id}/avatar`,\r\n      options: { model: data.model, endpoint: data.endpoint },\r\n      version: data.version,\r\n    }),\r\n    data.formData,\r\n  );\r\n};\r\n\r\nexport const uploadAgentAvatar = (data: m.AgentAvatarVariables): Promise<a.Agent> => {\r\n  return request.postMultiPart(\r\n    `${endpoints.images()}/agents/${data.agent_id}/avatar`,\r\n    data.formData,\r\n  );\r\n};\r\n\r\nexport const getFileDownload = async (userId: string, file_id: string): Promise<AxiosResponse> => {\r\n  return request.getResponse(`${endpoints.files()}/download/${userId}/${file_id}`, {\r\n    responseType: 'blob',\r\n    headers: {\r\n      Accept: 'application/octet-stream',\r\n    },\r\n  });\r\n};\r\n\r\nexport const getCodeOutputDownload = async (url: string): Promise<AxiosResponse> => {\r\n  return request.getResponse(url, {\r\n    responseType: 'blob',\r\n    headers: {\r\n      Accept: 'application/octet-stream',\r\n    },\r\n  });\r\n};\r\n\r\nexport const deleteFiles = async (payload: {\r\n  files: f.BatchFile[];\r\n  agent_id?: string;\r\n  assistant_id?: string;\r\n  tool_resource?: a.EToolResources;\r\n}): Promise<f.DeleteFilesResponse> =>\r\n  request.deleteWithOptions(endpoints.files(), {\r\n    data: payload,\r\n  });\r\n\r\n/* Speech */\r\n\r\nexport const speechToText = (data: FormData): Promise<f.SpeechToTextResponse> => {\r\n  return request.postMultiPart(endpoints.speechToText(), data);\r\n};\r\n\r\nexport const textToSpeech = (data: FormData): Promise<ArrayBuffer> => {\r\n  return request.postTTS(endpoints.textToSpeechManual(), data);\r\n};\r\n\r\nexport const getVoices = (): Promise<f.VoiceResponse> => {\r\n  return request.get(endpoints.textToSpeechVoices());\r\n};\r\n\r\nexport const getCustomConfigSpeech = (): Promise<t.TCustomConfigSpeechResponse> => {\r\n  return request.get(endpoints.getCustomConfigSpeech());\r\n};\r\n\r\n/* conversations */\r\n\r\nexport function duplicateConversation(\r\n  payload: t.TDuplicateConvoRequest,\r\n): Promise<t.TDuplicateConvoResponse> {\r\n  return request.post(endpoints.duplicateConversation(), payload);\r\n}\r\n\r\nexport function forkConversation(payload: t.TForkConvoRequest): Promise<t.TForkConvoResponse> {\r\n  return request.post(endpoints.forkConversation(), payload);\r\n}\r\n\r\nexport function deleteConversation(payload: t.TDeleteConversationRequest) {\r\n  return request.deleteWithOptions(endpoints.deleteConversation(), { data: { arg: payload } });\r\n}\r\n\r\nexport function clearAllConversations(): Promise<unknown> {\r\n  return request.delete(endpoints.deleteAllConversation());\r\n}\r\n\r\nexport const listConversations = (\r\n  params?: q.ConversationListParams,\r\n): Promise<q.ConversationListResponse> => {\r\n  return request.get(endpoints.conversations(params ?? {}));\r\n};\r\n\r\nexport function getConversations(cursor: string): Promise<t.TGetConversationsResponse> {\r\n  return request.get(endpoints.conversations({ cursor }));\r\n}\r\n\r\nexport function getConversationById(id: string): Promise<s.TConversation> {\r\n  return request.get(endpoints.conversationById(id));\r\n}\r\n\r\nexport function updateConversation(\r\n  payload: t.TUpdateConversationRequest,\r\n): Promise<t.TUpdateConversationResponse> {\r\n  return request.post(endpoints.updateConversation(), { arg: payload });\r\n}\r\n\r\nexport function archiveConversation(\r\n  payload: t.TArchiveConversationRequest,\r\n): Promise<t.TArchiveConversationResponse> {\r\n  return request.post(endpoints.updateConversation(), { arg: payload });\r\n}\r\n\r\nexport function genTitle(payload: m.TGenTitleRequest): Promise<m.TGenTitleResponse> {\r\n  return request.post(endpoints.genTitle(), payload);\r\n}\r\n\r\nexport const listMessages = (params?: q.MessagesListParams): Promise<q.MessagesListResponse> => {\r\n  return request.get(endpoints.messages(params ?? {}));\r\n};\r\n\r\nexport function updateMessage(payload: t.TUpdateMessageRequest): Promise<unknown> {\r\n  const { conversationId, messageId, text } = payload;\r\n  if (!conversationId) {\r\n    throw new Error('conversationId is required');\r\n  }\r\n\r\n  return request.put(endpoints.messages({ conversationId, messageId }), { text });\r\n}\r\n\r\nexport function updateMessageContent(payload: t.TUpdateMessageContent): Promise<unknown> {\r\n  const { conversationId, messageId, index, text } = payload;\r\n  if (!conversationId) {\r\n    throw new Error('conversationId is required');\r\n  }\r\n\r\n  return request.put(endpoints.messages({ conversationId, messageId }), { text, index });\r\n}\r\n\r\nexport const editArtifact = async ({\r\n  messageId,\r\n  ...params\r\n}: m.TEditArtifactRequest): Promise<m.TEditArtifactResponse> => {\r\n  return request.post(endpoints.messagesArtifacts(messageId), params);\r\n};\r\n\r\nexport function getMessagesByConvoId(conversationId: string): Promise<s.TMessage[]> {\r\n  if (\r\n    conversationId === config.Constants.NEW_CONVO ||\r\n    conversationId === config.Constants.PENDING_CONVO\r\n  ) {\r\n    return Promise.resolve([]);\r\n  }\r\n  return request.get(endpoints.messages({ conversationId }));\r\n}\r\n\r\nexport function getPrompt(id: string): Promise<{ prompt: t.TPrompt }> {\r\n  return request.get(endpoints.getPrompt(id));\r\n}\r\n\r\nexport function getPrompts(filter: t.TPromptsWithFilterRequest): Promise<t.TPrompt[]> {\r\n  return request.get(endpoints.getPromptsWithFilters(filter));\r\n}\r\n\r\nexport function getAllPromptGroups(): Promise<q.AllPromptGroupsResponse> {\r\n  return request.get(endpoints.getAllPromptGroups());\r\n}\r\n\r\nexport function getPromptGroups(\r\n  filter: t.TPromptGroupsWithFilterRequest,\r\n): Promise<t.PromptGroupListResponse> {\r\n  return request.get(endpoints.getPromptGroupsWithFilters(filter));\r\n}\r\n\r\nexport function getPromptGroup(id: string): Promise<t.TPromptGroup> {\r\n  return request.get(endpoints.getPromptGroup(id));\r\n}\r\n\r\nexport function createPrompt(payload: t.TCreatePrompt): Promise<t.TCreatePromptResponse> {\r\n  return request.post(endpoints.postPrompt(), payload);\r\n}\r\n\r\nexport function addPromptToGroup(\r\n  groupId: string,\r\n  payload: t.TCreatePrompt,\r\n): Promise<t.TCreatePromptResponse> {\r\n  return request.post(endpoints.addPromptToGroup(groupId), payload);\r\n}\r\n\r\nexport function updatePromptGroup(\r\n  variables: t.TUpdatePromptGroupVariables,\r\n): Promise<t.TUpdatePromptGroupResponse> {\r\n  return request.patch(endpoints.updatePromptGroup(variables.id), variables.payload);\r\n}\r\n\r\nexport function deletePrompt(payload: t.TDeletePromptVariables): Promise<t.TDeletePromptResponse> {\r\n  return request.delete(endpoints.deletePrompt(payload));\r\n}\r\n\r\nexport function makePromptProduction(id: string): Promise<t.TMakePromptProductionResponse> {\r\n  return request.patch(endpoints.updatePromptTag(id));\r\n}\r\n\r\nexport function updatePromptLabels(\r\n  variables: t.TUpdatePromptLabelsRequest,\r\n): Promise<t.TUpdatePromptLabelsResponse> {\r\n  return request.patch(endpoints.updatePromptLabels(variables.id), variables.payload);\r\n}\r\n\r\nexport function deletePromptGroup(id: string): Promise<t.TDeletePromptGroupResponse> {\r\n  return request.delete(endpoints.deletePromptGroup(id));\r\n}\r\n\r\nexport function getCategories(): Promise<t.TGetCategoriesResponse> {\r\n  return request.get(endpoints.getCategories());\r\n}\r\n\r\nexport function getRandomPrompts(\r\n  variables: t.TGetRandomPromptsRequest,\r\n): Promise<t.TGetRandomPromptsResponse> {\r\n  return request.get(endpoints.getRandomPrompts(variables.limit, variables.skip));\r\n}\r\n\r\n/* Roles */\r\nexport function getRole(roleName: string): Promise<r.TRole> {\r\n  return request.get(endpoints.getRole(roleName));\r\n}\r\n\r\nexport function updatePromptPermissions(\r\n  variables: m.UpdatePromptPermVars,\r\n): Promise<m.UpdatePermResponse> {\r\n  return request.put(endpoints.updatePromptPermissions(variables.roleName), variables.updates);\r\n}\r\n\r\nexport function updateAgentPermissions(\r\n  variables: m.UpdateAgentPermVars,\r\n): Promise<m.UpdatePermResponse> {\r\n  return request.put(endpoints.updateAgentPermissions(variables.roleName), variables.updates);\r\n}\r\n\r\nexport function updateMemoryPermissions(\r\n  variables: m.UpdateMemoryPermVars,\r\n): Promise<m.UpdatePermResponse> {\r\n  return request.put(endpoints.updateMemoryPermissions(variables.roleName), variables.updates);\r\n}\r\n\r\nexport function updatePeoplePickerPermissions(\r\n  variables: m.UpdatePeoplePickerPermVars,\r\n): Promise<m.UpdatePermResponse> {\r\n  return request.put(\r\n    endpoints.updatePeoplePickerPermissions(variables.roleName),\r\n    variables.updates,\r\n  );\r\n}\r\n\r\nexport function updateMarketplacePermissions(\r\n  variables: m.UpdateMarketplacePermVars,\r\n): Promise<m.UpdatePermResponse> {\r\n  return request.put(endpoints.updateMarketplacePermissions(variables.roleName), variables.updates);\r\n}\r\n\r\n/* Tags */\r\nexport function getConversationTags(): Promise<t.TConversationTagsResponse> {\r\n  return request.get(endpoints.conversationTags());\r\n}\r\n\r\nexport function createConversationTag(\r\n  payload: t.TConversationTagRequest,\r\n): Promise<t.TConversationTagResponse> {\r\n  return request.post(endpoints.conversationTags(), payload);\r\n}\r\n\r\nexport function updateConversationTag(\r\n  tag: string,\r\n  payload: t.TConversationTagRequest,\r\n): Promise<t.TConversationTagResponse> {\r\n  return request.put(endpoints.conversationTags(tag), payload);\r\n}\r\nexport function deleteConversationTag(tag: string): Promise<t.TConversationTagResponse> {\r\n  return request.delete(endpoints.conversationTags(tag));\r\n}\r\n\r\nexport function addTagToConversation(\r\n  conversationId: string,\r\n  payload: t.TTagConversationRequest,\r\n): Promise<t.TTagConversationResponse> {\r\n  return request.put(endpoints.addTagToConversation(conversationId), payload);\r\n}\r\nexport function rebuildConversationTags(): Promise<t.TConversationTagsResponse> {\r\n  return request.post(endpoints.conversationTags('rebuild'));\r\n}\r\n\r\nexport function healthCheck(): Promise<string> {\r\n  return request.get(endpoints.health());\r\n}\r\n\r\nexport function getUserTerms(): Promise<t.TUserTermsResponse> {\r\n  return request.get(endpoints.userTerms());\r\n}\r\n\r\nexport function acceptTerms(): Promise<t.TAcceptTermsResponse> {\r\n  return request.post(endpoints.acceptUserTerms());\r\n}\r\n\r\nexport function getBanner(): Promise<t.TBannerResponse> {\r\n  return request.get(endpoints.banner());\r\n}\r\n\r\nexport function updateFeedback(\r\n  conversationId: string,\r\n  messageId: string,\r\n  payload: t.TUpdateFeedbackRequest,\r\n): Promise<t.TUpdateFeedbackResponse> {\r\n  return request.put(endpoints.feedback(conversationId, messageId), payload);\r\n}\r\n\r\n// 2FA\r\nexport function enableTwoFactor(): Promise<t.TEnable2FAResponse> {\r\n  return request.get(endpoints.enableTwoFactor());\r\n}\r\n\r\nexport function verifyTwoFactor(payload: t.TVerify2FARequest): Promise<t.TVerify2FAResponse> {\r\n  return request.post(endpoints.verifyTwoFactor(), payload);\r\n}\r\n\r\nexport function confirmTwoFactor(payload: t.TVerify2FARequest): Promise<t.TVerify2FAResponse> {\r\n  return request.post(endpoints.confirmTwoFactor(), payload);\r\n}\r\n\r\nexport function disableTwoFactor(payload?: t.TDisable2FARequest): Promise<t.TDisable2FAResponse> {\r\n  return request.post(endpoints.disableTwoFactor(), payload);\r\n}\r\n\r\nexport function regenerateBackupCodes(): Promise<t.TRegenerateBackupCodesResponse> {\r\n  return request.post(endpoints.regenerateBackupCodes());\r\n}\r\n\r\nexport function verifyTwoFactorTemp(\r\n  payload: t.TVerify2FATempRequest,\r\n): Promise<t.TVerify2FATempResponse> {\r\n  return request.post(endpoints.verifyTwoFactorTemp(), payload);\r\n}\r\n\r\n/* Memories */\r\nexport const getMemories = (): Promise<q.MemoriesResponse> => {\r\n  return request.get(endpoints.memories());\r\n};\r\n\r\nexport const deleteMemory = (key: string): Promise<void> => {\r\n  return request.delete(endpoints.memory(key));\r\n};\r\n\r\nexport const updateMemory = (\r\n  key: string,\r\n  value: string,\r\n  originalKey?: string,\r\n): Promise<q.TUserMemory> => {\r\n  return request.patch(endpoints.memory(originalKey || key), { key, value });\r\n};\r\n\r\nexport const updateMemoryPreferences = (preferences: {\r\n  memories: boolean;\r\n}): Promise<{ updated: boolean; preferences: { memories: boolean } }> => {\r\n  return request.patch(endpoints.memoryPreferences(), preferences);\r\n};\r\n\r\nexport const createMemory = (data: {\r\n  key: string;\r\n  value: string;\r\n}): Promise<{ created: boolean; memory: q.TUserMemory }> => {\r\n  return request.post(endpoints.memories(), data);\r\n};\r\n\r\nexport function searchPrincipals(\r\n  params: q.PrincipalSearchParams,\r\n): Promise<q.PrincipalSearchResponse> {\r\n  return request.get(endpoints.searchPrincipals(params));\r\n}\r\n\r\nexport function getAccessRoles(\r\n  resourceType: permissions.ResourceType,\r\n): Promise<q.AccessRolesResponse> {\r\n  return request.get(endpoints.getAccessRoles(resourceType));\r\n}\r\n\r\nexport function getResourcePermissions(\r\n  resourceType: permissions.ResourceType,\r\n  resourceId: string,\r\n): Promise<permissions.TGetResourcePermissionsResponse> {\r\n  return request.get(endpoints.getResourcePermissions(resourceType, resourceId));\r\n}\r\n\r\nexport function updateResourcePermissions(\r\n  resourceType: permissions.ResourceType,\r\n  resourceId: string,\r\n  data: permissions.TUpdateResourcePermissionsRequest,\r\n): Promise<permissions.TUpdateResourcePermissionsResponse> {\r\n  return request.put(endpoints.updateResourcePermissions(resourceType, resourceId), data);\r\n}\r\n\r\nexport function getEffectivePermissions(\r\n  resourceType: permissions.ResourceType,\r\n  resourceId: string,\r\n): Promise<permissions.TEffectivePermissionsResponse> {\r\n  return request.get(endpoints.getEffectivePermissions(resourceType, resourceId));\r\n}\r\n\r\n// SharePoint Graph API Token\r\nexport function getGraphApiToken(params: q.GraphTokenParams): Promise<q.GraphTokenResponse> {\r\n  return request.get(endpoints.graphToken(params.scopes));\r\n}\r\n\r\nexport function getDomainServerBaseUrl(): string {\r\n  return `${endpoints.apiBaseUrl()}/api`;\r\n}\r\n","export enum QueryKeys {\r\n  messages = 'messages',\r\n  sharedMessages = 'sharedMessages',\r\n  sharedLinks = 'sharedLinks',\r\n  allConversations = 'allConversations',\r\n  archivedConversations = 'archivedConversations',\r\n  searchConversations = 'searchConversations',\r\n  conversation = 'conversation',\r\n  searchEnabled = 'searchEnabled',\r\n  user = 'user',\r\n  name = 'name', // user key name\r\n  models = 'models',\r\n  balance = 'balance',\r\n  endpoints = 'endpoints',\r\n  presets = 'presets',\r\n  searchResults = 'searchResults',\r\n  tokenCount = 'tokenCount',\r\n  availablePlugins = 'availablePlugins',\r\n  startupConfig = 'startupConfig',\r\n  assistants = 'assistants',\r\n  assistant = 'assistant',\r\n  agents = 'agents',\r\n  agent = 'agent',\r\n  files = 'files',\r\n  fileConfig = 'fileConfig',\r\n  tools = 'tools',\r\n  toolAuth = 'toolAuth',\r\n  toolCalls = 'toolCalls',\r\n  mcpTools = 'mcpTools',\r\n  mcpConnectionStatus = 'mcpConnectionStatus',\r\n  mcpAuthValues = 'mcpAuthValues',\r\n  agentTools = 'agentTools',\r\n  actions = 'actions',\r\n  assistantDocs = 'assistantDocs',\r\n  agentDocs = 'agentDocs',\r\n  fileDownload = 'fileDownload',\r\n  voices = 'voices',\r\n  customConfigSpeech = 'customConfigSpeech',\r\n  prompts = 'prompts',\r\n  prompt = 'prompt',\r\n  promptGroups = 'promptGroups',\r\n  allPromptGroups = 'allPromptGroups',\r\n  promptGroup = 'promptGroup',\r\n  categories = 'categories',\r\n  randomPrompts = 'randomPrompts',\r\n  agentCategories = 'agentCategories',\r\n  marketplaceAgents = 'marketplaceAgents',\r\n  roles = 'roles',\r\n  conversationTags = 'conversationTags',\r\n  health = 'health',\r\n  userTerms = 'userTerms',\r\n  banner = 'banner',\r\n  /* Memories */\r\n  memories = 'memories',\r\n  principalSearch = 'principalSearch',\r\n  accessRoles = 'accessRoles',\r\n  resourcePermissions = 'resourcePermissions',\r\n  effectivePermissions = 'effectivePermissions',\r\n  graphToken = 'graphToken',\r\n}\r\n\r\n// Dynamic query keys that require parameters\r\nexport const DynamicQueryKeys = {\r\n  agentFiles: (agentId: string) => ['agentFiles', agentId] as const,\r\n} as const;\r\n\r\nexport enum MutationKeys {\r\n  fileUpload = 'fileUpload',\r\n  fileDelete = 'fileDelete',\r\n  updatePreset = 'updatePreset',\r\n  deletePreset = 'deletePreset',\r\n  loginUser = 'loginUser',\r\n  logoutUser = 'logoutUser',\r\n  refreshToken = 'refreshToken',\r\n  avatarUpload = 'avatarUpload',\r\n  speechToText = 'speechToText',\r\n  textToSpeech = 'textToSpeech',\r\n  assistantAvatarUpload = 'assistantAvatarUpload',\r\n  agentAvatarUpload = 'agentAvatarUpload',\r\n  updateAction = 'updateAction',\r\n  updateAgentAction = 'updateAgentAction',\r\n  deleteAction = 'deleteAction',\r\n  deleteAgentAction = 'deleteAgentAction',\r\n  revertAgentVersion = 'revertAgentVersion',\r\n  deleteUser = 'deleteUser',\r\n  updateRole = 'updateRole',\r\n  enableTwoFactor = 'enableTwoFactor',\r\n  verifyTwoFactor = 'verifyTwoFactor',\r\n  updateMemoryPreferences = 'updateMemoryPreferences',\r\n}\r\n","import { z } from 'zod';\r\n\r\n/**\r\n * Granular Permission System Types for Agent Sharing\r\n *\r\n * This file contains TypeScript interfaces and Zod schemas for the enhanced\r\n * agent permission system that supports sharing with specific users/groups\r\n * and Entra ID integration.\r\n */\r\n\r\n// ===== ENUMS & CONSTANTS =====\r\n\r\n/**\r\n * Principal types for permission system\r\n */\r\nexport enum PrincipalType {\r\n  USER = 'user',\r\n  GROUP = 'group',\r\n  PUBLIC = 'public',\r\n  ROLE = 'role',\r\n}\r\n\r\n/**\r\n * Principal model types for MongoDB references\r\n */\r\nexport enum PrincipalModel {\r\n  USER = 'User',\r\n  GROUP = 'Group',\r\n  ROLE = 'Role',\r\n}\r\n\r\n/**\r\n * Source of the principal (local LibreChat or external Entra ID)\r\n */\r\nexport type TPrincipalSource = 'local' | 'entra';\r\n\r\n/**\r\n * Access levels for agents\r\n */\r\nexport type TAccessLevel = 'none' | 'viewer' | 'editor' | 'owner';\r\n\r\n/**\r\n * Resource types for permission system\r\n */\r\nexport enum ResourceType {\r\n  AGENT = 'agent',\r\n  PROMPTGROUP = 'promptGroup',\r\n}\r\n\r\n/**\r\n * Permission bit constants for bitwise operations\r\n */\r\nexport enum PermissionBits {\r\n  /** 001 - Can view and use agent */\r\n  VIEW = 1,\r\n  /**  010 - Can modify agent settings */\r\n  EDIT = 2,\r\n  /**  100 - Can delete agent */\r\n  DELETE = 4,\r\n  /**  1000 - Can share agent with others (future) */\r\n  SHARE = 8,\r\n}\r\n\r\n/**\r\n * Standard access role IDs\r\n */\r\nexport enum AccessRoleIds {\r\n  AGENT_VIEWER = 'agent_viewer',\r\n  AGENT_EDITOR = 'agent_editor',\r\n  AGENT_OWNER = 'agent_owner',\r\n  PROMPTGROUP_VIEWER = 'promptGroup_viewer',\r\n  PROMPTGROUP_EDITOR = 'promptGroup_editor',\r\n  PROMPTGROUP_OWNER = 'promptGroup_owner',\r\n}\r\n\r\n// ===== ZOD SCHEMAS =====\r\n\r\n/**\r\n * Principal schema - represents a user, group, role, or public access\r\n */\r\nexport const principalSchema = z.object({\r\n  type: z.nativeEnum(PrincipalType),\r\n  id: z.string().optional(), // undefined for 'public' type, role name for 'role' type\r\n  name: z.string().optional(),\r\n  email: z.string().optional(), // for user and group types\r\n  source: z.enum(['local', 'entra']).optional(),\r\n  avatar: z.string().optional(), // for user and group types\r\n  description: z.string().optional(), // for group and role types\r\n  idOnTheSource: z.string().optional(), // Entra ID for users/groups\r\n  accessRoleId: z.nativeEnum(AccessRoleIds).optional(), // Access role ID for permissions\r\n  memberCount: z.number().optional(), // for group type\r\n});\r\n\r\n/**\r\n * Access role schema - defines named permission sets\r\n */\r\nexport const accessRoleSchema = z.object({\r\n  accessRoleId: z.nativeEnum(AccessRoleIds),\r\n  name: z.string(),\r\n  description: z.string().optional(),\r\n  resourceType: z.nativeEnum(ResourceType).default(ResourceType.AGENT),\r\n  permBits: z.number(),\r\n});\r\n\r\n/**\r\n * Permission entry schema - represents a single ACL entry\r\n */\r\nexport const permissionEntrySchema = z.object({\r\n  id: z.string(),\r\n  principalType: z.nativeEnum(PrincipalType),\r\n  principalId: z.string().optional(), // undefined for 'public'\r\n  principalName: z.string().optional(),\r\n  role: accessRoleSchema,\r\n  grantedBy: z.string(),\r\n  grantedAt: z.string(), // ISO date string\r\n  inheritedFrom: z.string().optional(), // for project-level inheritance\r\n  source: z.enum(['local', 'entra']).optional(),\r\n});\r\n\r\n/**\r\n * Resource permissions response schema\r\n */\r\nexport const resourcePermissionsResponseSchema = z.object({\r\n  resourceType: z.nativeEnum(ResourceType),\r\n  resourceId: z.string(),\r\n  permissions: z.array(permissionEntrySchema),\r\n});\r\n\r\n/**\r\n * Update resource permissions request schema\r\n * This matches the user's requirement for the frontend DTO structure\r\n */\r\nexport const updateResourcePermissionsRequestSchema = z.object({\r\n  updated: principalSchema.array(),\r\n  removed: principalSchema.array(),\r\n  public: z.boolean(),\r\n  publicAccessRoleId: z.string().optional(),\r\n});\r\n\r\n/**\r\n * Update resource permissions response schema\r\n * Returns the updated permissions with accessRoleId included\r\n */\r\nexport const updateResourcePermissionsResponseSchema = z.object({\r\n  message: z.string(),\r\n  results: z.object({\r\n    principals: principalSchema.array(),\r\n    public: z.boolean(),\r\n    publicAccessRoleId: z.string().optional(),\r\n  }),\r\n});\r\n\r\n// ===== TYPESCRIPT TYPES =====\r\n\r\n/**\r\n * Principal - represents a user, group, or public access\r\n */\r\nexport type TPrincipal = z.infer<typeof principalSchema>;\r\n\r\n/**\r\n * Access role - defines named permission sets\r\n */\r\nexport type TAccessRole = z.infer<typeof accessRoleSchema>;\r\n\r\n/**\r\n * Permission entry - represents a single ACL entry\r\n */\r\nexport type TPermissionEntry = z.infer<typeof permissionEntrySchema>;\r\n\r\n/**\r\n * Resource permissions response\r\n */\r\nexport type TResourcePermissionsResponse = z.infer<typeof resourcePermissionsResponseSchema>;\r\n\r\n/**\r\n * Update resource permissions request\r\n * This matches the user's requirement for the frontend DTO structure\r\n */\r\nexport type TUpdateResourcePermissionsRequest = z.infer<\r\n  typeof updateResourcePermissionsRequestSchema\r\n>;\r\n\r\n/**\r\n * Update resource permissions response\r\n * Returns the updated permissions with accessRoleId included\r\n */\r\nexport type TUpdateResourcePermissionsResponse = z.infer<\r\n  typeof updateResourcePermissionsResponseSchema\r\n>;\r\n\r\n/**\r\n * Principal search request parameters\r\n */\r\nexport type TPrincipalSearchParams = {\r\n  q: string; // search query (required)\r\n  limit?: number; // max results (1-50, default 10)\r\n  type?: PrincipalType.USER | PrincipalType.GROUP | PrincipalType.ROLE; // filter by type (optional)\r\n};\r\n\r\n/**\r\n * Principal search result item\r\n */\r\nexport type TPrincipalSearchResult = {\r\n  id?: string | null; // null for Entra ID principals that don't exist locally yet\r\n  type: PrincipalType.USER | PrincipalType.GROUP | PrincipalType.ROLE;\r\n  name: string;\r\n  email?: string; // for users and groups\r\n  username?: string; // for users\r\n  avatar?: string; // for users and groups\r\n  provider?: string; // for users\r\n  source: 'local' | 'entra';\r\n  memberCount?: number; // for groups\r\n  description?: string; // for groups\r\n  idOnTheSource?: string; // Entra ID for users (maps to openidId) and groups (maps to idOnTheSource)\r\n};\r\n\r\n/**\r\n * Principal search response\r\n */\r\nexport type TPrincipalSearchResponse = {\r\n  query: string;\r\n  limit: number;\r\n  type?: PrincipalType.USER | PrincipalType.GROUP | PrincipalType.ROLE;\r\n  results: TPrincipalSearchResult[];\r\n  count: number;\r\n  sources: {\r\n    local: number;\r\n    entra: number;\r\n  };\r\n};\r\n\r\n/**\r\n * Available roles response\r\n */\r\nexport type TAvailableRolesResponse = {\r\n  resourceType: ResourceType;\r\n  roles: TAccessRole[];\r\n};\r\n\r\n/**\r\n * Get resource permissions response schema\r\n * This matches the enhanced aggregation-based endpoint response format\r\n */\r\nexport const getResourcePermissionsResponseSchema = z.object({\r\n  resourceType: z.nativeEnum(ResourceType),\r\n  resourceId: z.nativeEnum(AccessRoleIds),\r\n  principals: z.array(principalSchema),\r\n  public: z.boolean(),\r\n  publicAccessRoleId: z.nativeEnum(AccessRoleIds).optional(),\r\n});\r\n\r\n/**\r\n * Get resource permissions response type\r\n * This matches the enhanced aggregation-based endpoint response format\r\n */\r\nexport type TGetResourcePermissionsResponse = z.infer<typeof getResourcePermissionsResponseSchema>;\r\n\r\n/**\r\n * Effective permissions response schema\r\n * Returns just the permission bitmask for a user on a resource\r\n */\r\nexport const effectivePermissionsResponseSchema = z.object({\r\n  permissionBits: z.number(),\r\n});\r\n\r\n/**\r\n * Effective permissions response type\r\n * Returns just the permission bitmask for a user on a resource\r\n */\r\nexport type TEffectivePermissionsResponse = z.infer<typeof effectivePermissionsResponseSchema>;\r\n\r\n// ===== UTILITY TYPES =====\r\n\r\n/**\r\n * Permission check result\r\n */\r\nexport interface TPermissionCheck {\r\n  canView: boolean;\r\n  canEdit: boolean;\r\n  canDelete: boolean;\r\n  canShare: boolean;\r\n  accessLevel: TAccessLevel;\r\n}\r\n\r\n// ===== HELPER FUNCTIONS =====\r\n\r\n/**\r\n * Convert permission bits to access level\r\n */\r\nexport function permBitsToAccessLevel(permBits: number): TAccessLevel {\r\n  if ((permBits & PermissionBits.DELETE) > 0) return 'owner';\r\n  if ((permBits & PermissionBits.EDIT) > 0) return 'editor';\r\n  if ((permBits & PermissionBits.VIEW) > 0) return 'viewer';\r\n  return 'none';\r\n}\r\n\r\n/**\r\n * Convert access role ID to permission bits\r\n */\r\nexport function accessRoleToPermBits(accessRoleId: string): number {\r\n  switch (accessRoleId) {\r\n    case AccessRoleIds.AGENT_VIEWER:\r\n      return PermissionBits.VIEW;\r\n    case AccessRoleIds.AGENT_EDITOR:\r\n      return PermissionBits.VIEW | PermissionBits.EDIT;\r\n    case AccessRoleIds.AGENT_OWNER:\r\n      return PermissionBits.VIEW | PermissionBits.EDIT | PermissionBits.DELETE;\r\n    default:\r\n      return PermissionBits.VIEW;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if permission bitmask contains other bitmask\r\n * @param permissions - The permission bitmask to check\r\n * @param requiredPermission - The required permission bit(s)\r\n * @returns {boolean} Whether permissions contains requiredPermission\r\n */\r\nexport function hasPermissions(permissions: number, requiredPermission: number): boolean {\r\n  return (permissions & requiredPermission) === requiredPermission;\r\n}\r\n","import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport type {\r\n  UseQueryOptions,\r\n  UseMutationResult,\r\n  QueryObserverResult,\r\n} from '@tanstack/react-query';\r\nimport { Constants, initialModelsConfig } from '../config';\r\nimport { defaultOrderQuery } from '../types/assistants';\r\nimport { MCPServerConnectionStatusResponse } from '../types/queries';\r\nimport * as dataService from '../data-service';\r\nimport * as m from '../types/mutations';\r\nimport * as q from '../types/queries';\r\nimport { QueryKeys } from '../keys';\r\nimport * as s from '../schemas';\r\nimport * as t from '../types';\r\nimport * as permissions from '../accessPermissions';\r\nimport { ResourceType } from '../accessPermissions';\r\n\r\nexport { hasPermissions } from '../accessPermissions';\r\n\r\nexport const useGetSharedMessages = (\r\n  shareId: string,\r\n  config?: UseQueryOptions<t.TSharedMessagesResponse>,\r\n): QueryObserverResult<t.TSharedMessagesResponse> => {\r\n  return useQuery<t.TSharedMessagesResponse>(\r\n    [QueryKeys.sharedMessages, shareId],\r\n    () => dataService.getSharedMessages(shareId),\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useGetSharedLinkQuery = (\r\n  conversationId: string,\r\n  config?: UseQueryOptions<t.TSharedLinkGetResponse>,\r\n): QueryObserverResult<t.TSharedLinkGetResponse> => {\r\n  const queryClient = useQueryClient();\r\n  return useQuery<t.TSharedLinkGetResponse>(\r\n    [QueryKeys.sharedLinks, conversationId],\r\n    () => dataService.getSharedLink(conversationId),\r\n    {\r\n      enabled:\r\n        !!conversationId &&\r\n        conversationId !== Constants.NEW_CONVO &&\r\n        conversationId !== Constants.PENDING_CONVO,\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      onSuccess: (data) => {\r\n        queryClient.setQueryData([QueryKeys.sharedLinks, conversationId], {\r\n          conversationId: data.conversationId,\r\n          shareId: data.shareId,\r\n        });\r\n      },\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useGetConversationByIdQuery = (\r\n  id: string,\r\n  config?: UseQueryOptions<s.TConversation>,\r\n): QueryObserverResult<s.TConversation> => {\r\n  return useQuery<s.TConversation>(\r\n    [QueryKeys.conversation, id],\r\n    () => dataService.getConversationById(id),\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\n//This isn't ideal because its just a query and we're using mutation, but it was the only way\r\n//to make it work with how the Chat component is structured\r\nexport const useGetConversationByIdMutation = (id: string): UseMutationResult<s.TConversation> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(() => dataService.getConversationById(id), {\r\n    // onSuccess: (res: s.TConversation) => {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.conversation, id]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateMessageMutation = (\r\n  id: string,\r\n): UseMutationResult<unknown, unknown, t.TUpdateMessageRequest, unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((payload: t.TUpdateMessageRequest) => dataService.updateMessage(payload), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.messages, id]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateMessageContentMutation = (\r\n  conversationId: string,\r\n): UseMutationResult<unknown, unknown, t.TUpdateMessageContent, unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(\r\n    (payload: t.TUpdateMessageContent) => dataService.updateMessageContent(payload),\r\n    {\r\n      onSuccess: () => {\r\n        queryClient.invalidateQueries([QueryKeys.messages, conversationId]);\r\n      },\r\n    },\r\n  );\r\n};\r\n\r\nexport const useUpdateUserKeysMutation = (): UseMutationResult<\r\n  t.TUser,\r\n  unknown,\r\n  t.TUpdateUserKeyRequest,\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((payload: t.TUpdateUserKeyRequest) => dataService.updateUserKey(payload), {\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries([QueryKeys.name, variables.name]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useClearConversationsMutation = (): UseMutationResult<unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(() => dataService.clearAllConversations(), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.allConversations]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useRevokeUserKeyMutation = (name: string): UseMutationResult<unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(() => dataService.revokeUserKey(name), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.name, name]);\r\n      if (s.isAssistantsEndpoint(name)) {\r\n        queryClient.invalidateQueries([QueryKeys.assistants, name, defaultOrderQuery]);\r\n        queryClient.invalidateQueries([QueryKeys.assistantDocs]);\r\n        queryClient.invalidateQueries([QueryKeys.assistants]);\r\n        queryClient.invalidateQueries([QueryKeys.assistant]);\r\n        queryClient.invalidateQueries([QueryKeys.mcpTools]);\r\n        queryClient.invalidateQueries([QueryKeys.actions]);\r\n        queryClient.invalidateQueries([QueryKeys.tools]);\r\n      }\r\n    },\r\n  });\r\n};\r\n\r\nexport const useRevokeAllUserKeysMutation = (): UseMutationResult<unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(() => dataService.revokeAllUserKeys(), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.name]);\r\n      queryClient.invalidateQueries([\r\n        QueryKeys.assistants,\r\n        s.EModelEndpoint.assistants,\r\n        defaultOrderQuery,\r\n      ]);\r\n      queryClient.invalidateQueries([\r\n        QueryKeys.assistants,\r\n        s.EModelEndpoint.azureAssistants,\r\n        defaultOrderQuery,\r\n      ]);\r\n      queryClient.invalidateQueries([QueryKeys.assistantDocs]);\r\n      queryClient.invalidateQueries([QueryKeys.assistants]);\r\n      queryClient.invalidateQueries([QueryKeys.assistant]);\r\n      queryClient.invalidateQueries([QueryKeys.mcpTools]);\r\n      queryClient.invalidateQueries([QueryKeys.actions]);\r\n      queryClient.invalidateQueries([QueryKeys.tools]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useGetModelsQuery = (\r\n  config?: UseQueryOptions<t.TModelsConfig>,\r\n): QueryObserverResult<t.TModelsConfig> => {\r\n  return useQuery<t.TModelsConfig>([QueryKeys.models], () => dataService.getModels(), {\r\n    initialData: initialModelsConfig,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: false,\r\n    refetchOnMount: false,\r\n    staleTime: Infinity,\r\n    ...config,\r\n  });\r\n};\r\n\r\nexport const useCreatePresetMutation = (): UseMutationResult<\r\n  s.TPreset,\r\n  unknown,\r\n  s.TPreset,\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((payload: s.TPreset) => dataService.createPreset(payload), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.presets]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeletePresetMutation = (): UseMutationResult<\r\n  m.PresetDeleteResponse,\r\n  unknown,\r\n  s.TPreset | undefined,\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((payload: s.TPreset | undefined) => dataService.deletePreset(payload), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.presets]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateTokenCountMutation = (): UseMutationResult<\r\n  t.TUpdateTokenCountResponse,\r\n  unknown,\r\n  { text: string },\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(({ text }: { text: string }) => dataService.updateTokenCount(text), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.tokenCount]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useRegisterUserMutation = (\r\n  options?: m.RegistrationOptions,\r\n): UseMutationResult<t.TError, unknown, t.TRegisterUser, unknown> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation<t.TRegisterUserResponse, t.TError, t.TRegisterUser>(\r\n    (payload: t.TRegisterUser) => dataService.register(payload),\r\n    {\r\n      ...options,\r\n      onSuccess: (...args) => {\r\n        queryClient.invalidateQueries([QueryKeys.user]);\r\n        if (options?.onSuccess) {\r\n          options.onSuccess(...args);\r\n        }\r\n      },\r\n    },\r\n  );\r\n};\r\n\r\nexport const useUserKeyQuery = (\r\n  name: string,\r\n  config?: UseQueryOptions<t.TCheckUserKeyResponse>,\r\n): QueryObserverResult<t.TCheckUserKeyResponse> => {\r\n  return useQuery<t.TCheckUserKeyResponse>(\r\n    [QueryKeys.name, name],\r\n    () => {\r\n      if (!name) {\r\n        return Promise.resolve({ expiresAt: '' });\r\n      }\r\n      return dataService.userKeyQuery(name);\r\n    },\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      retry: false,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useRequestPasswordResetMutation = (): UseMutationResult<\r\n  t.TRequestPasswordResetResponse,\r\n  unknown,\r\n  t.TRequestPasswordReset,\r\n  unknown\r\n> => {\r\n  return useMutation((payload: t.TRequestPasswordReset) =>\r\n    dataService.requestPasswordReset(payload),\r\n  );\r\n};\r\n\r\nexport const useResetPasswordMutation = (): UseMutationResult<\r\n  unknown,\r\n  unknown,\r\n  t.TResetPassword,\r\n  unknown\r\n> => {\r\n  return useMutation((payload: t.TResetPassword) => dataService.resetPassword(payload));\r\n};\r\n\r\nexport const useAvailablePluginsQuery = <TData = s.TPlugin[]>(\r\n  config?: UseQueryOptions<s.TPlugin[], unknown, TData>,\r\n): QueryObserverResult<TData> => {\r\n  return useQuery<s.TPlugin[], unknown, TData>(\r\n    [QueryKeys.availablePlugins],\r\n    () => dataService.getAvailablePlugins(),\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useUpdateUserPluginsMutation = (\r\n  _options?: m.UpdatePluginAuthOptions,\r\n): UseMutationResult<t.TUser, unknown, t.TUpdateUserPlugins, unknown> => {\r\n  const queryClient = useQueryClient();\r\n  const { onSuccess, ...options } = _options ?? {};\r\n  return useMutation((payload: t.TUpdateUserPlugins) => dataService.updateUserPlugins(payload), {\r\n    ...options,\r\n    onSuccess: (...args) => {\r\n      queryClient.invalidateQueries([QueryKeys.user]);\r\n      onSuccess?.(...args);\r\n      if (args[1]?.action === 'uninstall' && args[1]?.pluginKey?.startsWith(Constants.mcp_prefix)) {\r\n        const serverName = args[1]?.pluginKey?.substring(Constants.mcp_prefix.length);\r\n        queryClient.invalidateQueries([QueryKeys.mcpAuthValues, serverName]);\r\n      }\r\n    },\r\n  });\r\n};\r\n\r\nexport const useReinitializeMCPServerMutation = (): UseMutationResult<\r\n  {\r\n    success: boolean;\r\n    message: string;\r\n    serverName: string;\r\n    oauthRequired?: boolean;\r\n    oauthUrl?: string;\r\n  },\r\n  unknown,\r\n  string,\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((serverName: string) => dataService.reinitializeMCPServer(serverName), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.mcpTools]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useCancelMCPOAuthMutation = (): UseMutationResult<\r\n  m.CancelMCPOAuthResponse,\r\n  unknown,\r\n  string,\r\n  unknown\r\n> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation((serverName: string) => dataService.cancelMCPOAuth(serverName), {\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries([QueryKeys.mcpConnectionStatus]);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useGetCustomConfigSpeechQuery = (\r\n  config?: UseQueryOptions<t.TCustomConfigSpeechResponse>,\r\n): QueryObserverResult<t.TCustomConfigSpeechResponse> => {\r\n  return useQuery<t.TCustomConfigSpeechResponse>(\r\n    [QueryKeys.customConfigSpeech],\r\n    () => dataService.getCustomConfigSpeech(),\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useUpdateFeedbackMutation = (\r\n  conversationId: string,\r\n  messageId: string,\r\n): UseMutationResult<t.TUpdateFeedbackResponse, Error, t.TUpdateFeedbackRequest> => {\r\n  const queryClient = useQueryClient();\r\n  return useMutation(\r\n    (payload: t.TUpdateFeedbackRequest) =>\r\n      dataService.updateFeedback(conversationId, messageId, payload),\r\n    {\r\n      onSuccess: () => {\r\n        queryClient.invalidateQueries([QueryKeys.messages, messageId]);\r\n      },\r\n    },\r\n  );\r\n};\r\n\r\nexport const useSearchPrincipalsQuery = (\r\n  params: q.PrincipalSearchParams,\r\n  config?: UseQueryOptions<q.PrincipalSearchResponse>,\r\n): QueryObserverResult<q.PrincipalSearchResponse> => {\r\n  return useQuery<q.PrincipalSearchResponse>(\r\n    [QueryKeys.principalSearch, params],\r\n    () => dataService.searchPrincipals(params),\r\n    {\r\n      enabled: !!params.q && params.q.length >= 2,\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      staleTime: 30000,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useGetAccessRolesQuery = (\r\n  resourceType: ResourceType,\r\n  config?: UseQueryOptions<q.AccessRolesResponse>,\r\n): QueryObserverResult<q.AccessRolesResponse> => {\r\n  return useQuery<q.AccessRolesResponse>(\r\n    [QueryKeys.accessRoles, resourceType],\r\n    () => dataService.getAccessRoles(resourceType),\r\n    {\r\n      enabled: !!resourceType,\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      staleTime: 5 * 60 * 1000, // Cache for 5 minutes\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useGetResourcePermissionsQuery = (\r\n  resourceType: ResourceType,\r\n  resourceId: string,\r\n  config?: UseQueryOptions<permissions.TGetResourcePermissionsResponse>,\r\n): QueryObserverResult<permissions.TGetResourcePermissionsResponse> => {\r\n  return useQuery<permissions.TGetResourcePermissionsResponse>(\r\n    [QueryKeys.resourcePermissions, resourceType, resourceId],\r\n    () => dataService.getResourcePermissions(resourceType, resourceId),\r\n    {\r\n      enabled: !!resourceType && !!resourceId,\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      staleTime: 2 * 60 * 1000, // Cache for 2 minutes\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n\r\nexport const useUpdateResourcePermissionsMutation = (): UseMutationResult<\r\n  permissions.TUpdateResourcePermissionsResponse,\r\n  Error,\r\n  {\r\n    resourceType: ResourceType;\r\n    resourceId: string;\r\n    data: permissions.TUpdateResourcePermissionsRequest;\r\n  }\r\n> => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: ({ resourceType, resourceId, data }) =>\r\n      dataService.updateResourcePermissions(resourceType, resourceId, data),\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({\r\n        queryKey: [QueryKeys.accessRoles, variables.resourceType],\r\n      });\r\n\r\n      queryClient.invalidateQueries({\r\n        queryKey: [QueryKeys.resourcePermissions, variables.resourceType, variables.resourceId],\r\n      });\r\n\r\n      queryClient.invalidateQueries({\r\n        queryKey: [QueryKeys.effectivePermissions, variables.resourceType, variables.resourceId],\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useGetEffectivePermissionsQuery = (\r\n  resourceType: ResourceType,\r\n  resourceId: string,\r\n  config?: UseQueryOptions<permissions.TEffectivePermissionsResponse>,\r\n): QueryObserverResult<permissions.TEffectivePermissionsResponse> => {\r\n  return useQuery<permissions.TEffectivePermissionsResponse>({\r\n    queryKey: [QueryKeys.effectivePermissions, resourceType, resourceId],\r\n    queryFn: () => dataService.getEffectivePermissions(resourceType, resourceId),\r\n    enabled: !!resourceType && !!resourceId,\r\n    refetchOnWindowFocus: false,\r\n    staleTime: 30000,\r\n    ...config,\r\n  });\r\n};\r\n\r\nexport const useMCPServerConnectionStatusQuery = (\r\n  serverName: string,\r\n  config?: UseQueryOptions<MCPServerConnectionStatusResponse>,\r\n): QueryObserverResult<MCPServerConnectionStatusResponse> => {\r\n  return useQuery<MCPServerConnectionStatusResponse>(\r\n    [QueryKeys.mcpConnectionStatus, serverName],\r\n    () => dataService.getMCPServerConnectionStatus(serverName),\r\n    {\r\n      refetchOnWindowFocus: false,\r\n      refetchOnReconnect: false,\r\n      refetchOnMount: false,\r\n      staleTime: 10000, // 10 seconds\r\n      enabled: !!serverName,\r\n      ...config,\r\n    },\r\n  );\r\n};\r\n"],"names":["Tools","EToolResources","AnnotationTypes","StepStatus","MessageContentTypes","RunStatus","FilePurpose","AssistantStreamEvents","defaultOrderQuery","order","limit","AuthType","feedbackTagKeySchema","z","enum","feedbackRatingSchema","feedbackSchema","object","rating","tag","text","string","max","optional","uuid","EModelEndpoint","BedrockProviders","authTypeSchema","nativeEnum","Set","agents","openAI","bedrock","azureOpenAI","anthropic","custom","google","ImageDetail","ReasoningEffort","ReasoningSummary","Verbosity","_a","low","auto","high","eImageDetailSchema","eReasoningEffortSchema","eReasoningSummarySchema","eVerbositySchema","_b","agent","id","name","description","instructions","model","model_parameters","tools","provider","projectIds","artifacts","isCollaborative","recursion_limit","undefined","execute_code","file_search","web_search","category","support_contact","email","type","function","parameters","properties","required","EAgent","openAISettings","default","temperature","min","step","top_p","presence_penalty","frequency_penalty","resendFiles","maxContextTokens","max_tokens","imageDetail","LEGACY_ANTHROPIC_MAX_OUTPUT","anthropicSettings","promptCache","thinking","thinkingBudget","maxOutputTokens","reset","modelName","test","set","value","topP","topK","legacy","agentsSettings","_d","eModelEndpointSchema","extendedModelEndpointSchema","union","tPluginAuthConfigSchema","authField","label","tPluginSchema","pluginKey","icon","authConfig","array","authenticated","boolean","chatMenu","isButton","toolkit","tExampleSchema","input","content","output","agentOptionSettings","functions","classic","tAgentOptionsSchema","skipCompletion","number","messageId","endpoint","clientId","nullable","conversationId","parentMessageId","responseMessageId","overrideParentMessageId","bg","title","or","literal","sender","generation","isCreatedByUser","error","clientTimestamp","createdAt","Date","toISOString","updatedAt","current","unfinished","searchResult","finish_reason","thread_id","iconURL","feedback","coerceNumber","transform","val","trim","parseFloat","DocumentType","lazy","null","record","tConversationSchema","endpointType","isArchived","user","messages","modelLabel","userLabel","promptPrefix","system","stream","context","examples","tags","file_ids","reasoning_effort","reasoning_summary","verbosity","useResponsesApi","disableStreaming","assistant_id","agent_id","region","maxTokens","additionalModelRequestFields","additional_instructions","append_current_datetime","presetOverride","unknown","stop","greeting","spec","expiredAt","fileTokenLimit","resendImages","agentOptions","chatGptLabel","tPresetSchema","omit","merge","presetId","defaultPreset","pick","shareId","isPublic","_id","count","position","googleBaseSchema","obj","removeNullishValues","catch","presencePenalty","frequencyPenalty","stopSequences","thinkingConfig","includeThoughts","strip","gptPluginsBaseSchema","removeEmptyStrings","newObj","__assign","Object","keys","forEach","key","result","_c","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","length","bannerId","message","displayFrom","displayTo","tModelSpecSchema","preset","showIconInMenu","showIconInHeader","authType","specsConfigSchema","enforce","prioritize","list","addedEndpoints","assistants","azureAssistants","excelFileTypes","__spreadArray","supportedMimeTypes","defaultSizeLimit","assistantsFileConfig","fileLimit","fileSizeLimit","totalSizeLimit","disabled","FileSources","FileContext","AuthTypeEnum","AuthorizationTypeEnum","TokenExchangeMethodEnum","supportedMimeTypesSchema","any","refine","mimeTypes","every","mimeType","RegExp","endpointFileConfigSchema","fileConfigSchema","endpoints","serverFileSizeLimit","avatarSizeLimit","imageGeneration","percentage","px","clientImageResize","enabled","maxWidth","maxHeight","quality","ocr","envVarRegex","extractEnvVariable","trimmed","singleMatch","match","varName","process","env","regex","matches","exec","push","fullMatch","index","i","envValue","substring","BaseOptionsSchema","startup","iconPath","timeout","initTimeout","serverInstructions","requiresOAuth","oauth","authorization_url","url","token_url","client_id","client_secret","scope","redirect_uri","token_exchange_method","grant_types_supported","token_endpoint_auth_methods_supported","response_types_supported","code_challenge_methods_supported","revocation_endpoint","revocation_endpoint_auth_methods_supported","customUserVars","StdioOptionsSchema","extend","command","args","processedEnv","_i","entries","stderr","WebSocketOptionsSchema","pipe","protocol","URL","SSEOptionsSchema","headers","StreamableHTTPOptionsSchema","MCPOptionsSchema","MCPServersSchema","BASE_URL","browser","baseEl","document","querySelector","getAttribute","endsWith","slice","SettingsViews","apiBaseUrl","messagesRoot","concat","params","rest","__rest","query","filter","Array","isArray","map","v","encodeURIComponent","join","String","buildQuery","shareRoot","keysEndpoint","conversationsRoot","speech","Capabilities","AgentCapabilities","fileSourceSchema","fileStrategiesSchema","avatar","image","modelConfigSchema","deploymentName","version","azureBaseSchema","apiKey","serverless","instanceName","addParams","dropParams","forcePrompt","baseURL","additionalHeaders","azureGroupSchema","group","models","and","azureGroupConfigsSchema","baseEndpointSchema","streamRate","titlePrompt","titleModel","titleConvo","titleMethod","titleEndpoint","titlePromptTemplate","availableRegions","RateLimitPrefix","assistantEndpointSchema","disableBuilder","pollIntervalMs","timeoutMs","supportedIds","excludedIds","privateAssistants","retrievalModels","capabilities","code_interpreter","image_vision","retrieval","actions","fetch","userIdQuery","defaultAgentCapabilities","chain","agentsEndpointSchema","recursionLimit","maxRecursionLimit","maxCitations","maxCitationsPerFile","minRelevanceScore","allowedProviders","endpointSchema","safeParse","success","values","summarize","summaryModel","modelDisplayLabel","customParams","defaultParamsEndpoint","paramDefinitions","strict","customOrder","directEndpoint","titleMessageRole","azureEndpointSchema","groups","plugins","partial","ttsOpenaiSchema","voices","ttsAzureOpenAISchema","apiVersion","ttsElevenLabsSchema","websocketUrl","voice_settings","similarity_boost","stability","style","use_speaker_boost","pronunciation_dictionary_locators","ttsLocalaiSchema","backend","ttsSchema","openai","elevenlabs","localai","sttOpenaiSchema","sttAzureOpenAISchema","sttSchema","speechTab","conversationMode","advancedMode","speechToText","engineSTT","languageSTT","autoTranscribeAudio","decibelValue","autoSendText","textToSpeech","engineTTS","voice","languageTTS","automaticPlayback","playbackRate","cacheTTS","EImageOutputType","rateLimitSchema","fileUploads","ipMax","ipWindowInMinutes","userMax","userWindowInMinutes","conversationsImport","tts","stt","OCRStrategy","SearchCategories","SearchProviders","ScraperTypes","RerankerTypes","SafeSearchTypes","termsOfServiceSchema","externalUrl","openNewTab","modalAcceptance","modalTitle","modalContent","mcpServersSchema","placeholder","interfaceSchema","privacyPolicy","termsOfService","customWelcome","mcpServers","endpointsMenu","modelSelect","sidePanel","multiConvo","bookmarks","memories","presets","prompts","temporaryChat","temporaryChatRetention","runCode","webSearch","peoplePicker","users","roles","marketplace","use","fileSearch","fileCitations","turnstileOptionsSchema","language","size","turnstileSchema","siteKey","options","KnownEndpoints","FetchTokenConfig","webSearchSchema","serperApiKey","searxngInstanceUrl","searxngApiKey","firecrawlApiKey","firecrawlApiUrl","jinaApiKey","jinaApiUrl","cohereApiKey","searchProvider","scraperType","rerankerType","scraperTimeout","safeSearch","MODERATE","firecrawlOptions","formats","includeTags","excludeTags","waitFor","maxAge","mobile","skipTlsVerification","blockAds","removeBase64Images","parsePDF","storeInCache","zeroDataRetention","location","country","languages","onlyMainContent","changeTrackingOptions","modes","schema","prompt","ocrSchema","mistralModel","strategy","MISTRAL_OCR","balanceSchema","startBalance","autoRefillEnabled","refillIntervalValue","refillIntervalUnit","refillAmount","transactionsSchema","memorySchema","validKeys","tokenLimit","charLimit","personalize","messageWindowSize","customEndpointsSchema","cache","memory","secureImageLinks","imageOutputType","PNG","includedTools","filteredTools","interface","turnstile","fileStrategy","local","fileStrategies","allowedDomains","registration","socialLogins","balance","transactions","rateLimits","fileConfig","modelSpecs","all","gptPlugins","data","chatGPTBrowser","ollama","deepseek","xai","vercel","VisionModes","InfiniteCollections","Time","CacheKeys","ViolationTypes","ErrorTypes","AuthKeys","ImageDetailCost","SettingsTabValues","STTProviders","TTSProviders","Constants","LocalStorageKeys","ForkOptions","CohereConstants","SystemCategories","sharedOpenAIModels","defaultModels","openAIModels","initialModelsConfig","initial","str","_post","axios","post","JSON","stringify","sent","isRefreshing","failedQueue","refreshToken","retry","endpoints.refreshToken","dispatchTokenUpdatedEvent","token","defaults","common","setTokenHeader","window","dispatchEvent","CustomEvent","detail","processQueue","prom","reject","resolve","interceptors","response","__awaiter","originalRequest","config","Promise","includes","status","_retry","console","warn","err_1","href","log","err_2","request","get","getResponse","postMultiPart","formData","postTTS","responseType","put","delete","deleteWithOptions","patch","revokeUserKey","endpoints.revokeUserKey","revokeAllUserKeys","getSharedMessages","endpoints.shareMessages","getSharedLink","endpoints.getSharedLink","updateUserKey","payload","Error","createPreset","deletePreset","arg","updateTokenCount","register","userKeyQuery","endpoints.userKeyQuery","requestPasswordReset","resetPassword","getAvailablePlugins","updateUserPlugins","reinitializeMCPServer","serverName","endpoints.mcpReinitialize","getMCPServerConnectionStatus","endpoints.mcpServerConnectionStatus","cancelMCPOAuth","endpoints.cancelMCPOAuth","QueryKeys","MutationKeys","PrincipalType","PrincipalModel","ResourceType","PermissionBits","AccessRoleIds","getCustomConfigSpeech","clearAllConversations","getConversationById","endpoints.conversationById","updateFeedback","endpoints.feedback","searchPrincipals","q","types","endpoints.searchPrincipals","getAccessRoles","resourceType","endpoints.getAccessRoles","getResourcePermissions","resourceId","endpoints.getResourcePermissions","updateResourcePermissions","endpoints.updateResourcePermissions","getEffectivePermissions","endpoints.getEffectivePermissions","principalSchema","source","idOnTheSource","accessRoleId","memberCount","accessRoleSchema","AGENT","permBits","permissionEntrySchema","principalType","principalId","principalName","role","grantedBy","grantedAt","inheritedFrom","hasPermissions","permissions","requiredPermission","updated","removed","public","publicAccessRoleId","results","principals","permissionBits","useGetSharedMessages","useQuery","sharedMessages","dataService.getSharedMessages","refetchOnWindowFocus","refetchOnReconnect","refetchOnMount","useGetSharedLinkQuery","queryClient","useQueryClient","sharedLinks","dataService.getSharedLink","NEW_CONVO","PENDING_CONVO","onSuccess","setQueryData","useGetConversationByIdQuery","conversation","dataService.getConversationById","useGetConversationByIdMutation","useMutation","invalidateQueries","useUpdateMessageMutation","endpoints.messages","dataService.updateMessage","useUpdateMessageContentMutation","dataService.updateMessageContent","useUpdateUserKeysMutation","dataService.updateUserKey","variables","useClearConversationsMutation","dataService.clearAllConversations","allConversations","useRevokeUserKeyMutation","dataService.revokeUserKey","_endpoint","toLowerCase","assistantDocs","assistant","mcpTools","useRevokeAllUserKeysMutation","dataService.revokeAllUserKeys","s.EModelEndpoint","useGetModelsQuery","initialData","staleTime","Infinity","useCreatePresetMutation","dataService.createPreset","useDeletePresetMutation","dataService.deletePreset","useUpdateTokenCountMutation","dataService.updateTokenCount","tokenCount","useRegisterUserMutation","dataService.register","arguments","apply","useUserKeyQuery","dataService.userKeyQuery","expiresAt","useRequestPasswordResetMutation","dataService.requestPasswordReset","useResetPasswordMutation","dataService.resetPassword","useAvailablePluginsQuery","availablePlugins","dataService.getAvailablePlugins","useUpdateUserPluginsMutation","_options","dataService.updateUserPlugins","action","startsWith","mcp_prefix","mcpAuthValues","useReinitializeMCPServerMutation","dataService.reinitializeMCPServer","useCancelMCPOAuthMutation","dataService.cancelMCPOAuth","mcpConnectionStatus","useGetCustomConfigSpeechQuery","customConfigSpeech","dataService.getCustomConfigSpeech","useUpdateFeedbackMutation","dataService.updateFeedback","useSearchPrincipalsQuery","principalSearch","dataService.searchPrincipals","useGetAccessRolesQuery","accessRoles","dataService.getAccessRoles","useGetResourcePermissionsQuery","resourcePermissions","dataService.getResourcePermissions","useUpdateResourcePermissionsMutation","mutationFn","dataService.updateResourcePermissions","_","queryKey","effectivePermissions","useGetEffectivePermissionsQuery","queryFn","dataService.getEffectivePermissions","useMCPServerConnectionStatusQuery","dataService.getMCPServerConnectionStatus"],"mappings":"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"}