const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BookmarkNav.TMwYk4NF.js","./vendor.Cqzv7Y2e.js","./react-interactions.BiO1nID1.js","./markdown_highlight.YFvJ8PVJ.js","./validation.CeCA-dRw.js","./math-katex.steiuUVT.js","./math-katex.sdXCKFqw.css","./radix-ui.BJcN8DO5.js","./utilities.Be-Is_-r.js","./tanstack-vendor.B_PTOi1V.js","./headlessui.IsuTRzxN.js","./locales.DEChDTFf.js","./i18n.DMSRYMuy.js","./routing.DINL4Gax.js","./avatars.h8saQOOS.js","./advanced-inputs.Cy5dtKGC.js","./animations.DoCLRNBg.js","./virtualization.uzjuHVPe.js","./framer-motion.CoSbn_z6.js","./http-client.DABZ03PL.js","./date-utils.j-oxXFG2.js","./forms.WVfMSmLf.js","./security-ui.BiG1lPPp.js","./heic-converter.Cz_Prg7D.js","./markdown-processing.MlvRvaVW.js","./sandpack.CdwMuX9e.js","./codemirror-core.CxU5-1DU.js","./codemirror-state.Pf71Wo5N.js","./codemirror-view.lFdxsulL.js","./codemirror-language.CSMPAXPP.js","./AccountSettings.4B1-w-QW.js","./AgentMarketplaceButton.dR_d2pWo.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{r as n,j as s,bx as a,by as r,bz as o,bA as i,bB as l,bC as c,bD as d,bE as u,bF as m,bG as p,bH as f,bI as h,bJ as g,bK as x,bL as v,bM as b,bN as _,bO as y,bP as j,bQ as w,bR as N,bS as C,bT as k,R as S,bU as T,bV as E,bW as R,bX as I,bY as P,bZ as A,b_ as M,b$ as L,c0 as O,c1 as D,c2 as F,c3 as z,c4 as U,c5 as V,c6 as B,c7 as $,c8 as H,c9 as G,ca as K,cb as W,cc as q,cd as Q,ce as Y,cf as X,cg as Z,ch as J,ci as ee,cj as te,ck as ne,cl as se,cm as ae,cn as re,co as oe,cp as ie,cq as le,cr as ce,cs as de,ct as ue,cu as me,cv as pe,cw as fe,cx as he,cy as ge,ai as xe,cz as ve,cA as be,cB as _e,aq as ye,cC as je,cD as we,cE as Ne,cF as Ce,cG as ke,cH as Se,cI as Te,cJ as Ee,cK as Re,cL as Ie,cM as Pe,cN as Ae,cO as Me,cP as Le,cQ as Oe,aT as De,aU as Fe,cR as ze,cS as Ue,cT as Ve,cU as Be,cV as $e,cW as He,cX as Ge,cY as Ke,cZ as We,c_ as qe,c$ as Qe,d0 as Ye,d1 as Xe,d2 as Ze,d3 as Je,d4 as et,d5 as tt,d6 as nt,d7 as st,d8 as at,d9 as rt,da as ot,db as it,dc as lt,dd as ct,de as dt,df as ut,dg as mt,dh as pt,di as ft,dj as ht,dk as gt,dl as xt,dm as vt,dn as bt,dp as _t,dq as yt,dr as jt,ds as wt,dt as Nt,du as Ct,dv as kt,dw as St,dx as Tt,dy as Et,dz as Rt,dA as It,dB as Pt,dC as At,dD as Mt,dE as Lt,dF as Ot,dG as Dt,dH as Ft,dI as zt,dJ as Ut,dK as Vt,dL as Bt,dM as $t,dN as Ht,dO as Gt,dP as Kt,dQ as Wt,dR as qt,dS as Qt,dT as Yt,dU as Xt,dV as Zt,dW as Jt,dX as en,dY as tn,dZ as nn,d_ as sn,d$ as an,e0 as rn,e1 as on,e2 as ln,e3 as cn,ax as dn,e4 as un,e5 as mn,e6 as pn,e7 as fn,e8 as hn,e9 as gn,ea as xn,eb as vn,ec as bn,ed as _n,ee as yn,ef as jn,eg as wn,eh as Nn,ei as Cn,ej as kn,ek as Sn,el as Tn,em as En,en as Rn,eo as In,ep as Pn,eq as An,er as Mn,es as Ln,et as On,eu as Dn,ev as Fn,ew as zn,ex as Un,ey as Vn,ez as Bn,eA as $n,eB as Hn,eC as Gn,eD as Kn,eE as Wn,eF as qn,eG as Qn,eH as Yn,eI as Xn,eJ as Zn,eK as Jn,eL as es,eM as ts,eN as ns,eO as ss,eP as as,eQ as rs,eR as os,eS as is,eT as ls,eU as cs,eV as ds,eW as us,eX as ms,eY as ps,eZ as fs,e_ as hs,e$ as gs,f0 as xs,f1 as vs,f2 as bs,f3 as _s,f4 as ys,f5 as js,f6 as ws,f7 as Ns,f8 as Cs,f9 as ks,fa as Ss,fb as Ts,fc as Es,fd as Rs}from"./vendor.Cqzv7Y2e.js";import"./locales.DEChDTFf.js";import{c as Is,u as Ps,L as As,a as Ms,R as Ls}from"./routing.DINL4Gax.js";import{I as Os,H as Ds,T as Fs,C as zs,a as Us,$ as Vs,b as Bs,d as $s,e as Hs,f as Gs,g as Ks,h as Ws,i as qs,j as Qs,S as Ys,k as Xs,P as Zs,l as Js,m as ea,n as ta,o as na,R as sa,L as aa,p as ra,q as oa,r as ia,s as la,t as ca,u as da,v as ua,w as ma,x as pa,y as fa,z as ha,A as ga,B as xa,D as va,E as ba,F as _a,G as ya,J as ja,K as wa,M as Na,N as Ca,O as ka,Q as Sa,U as Ta,V as Ea,W as Ra,X as Ia,Y as Pa,Z as Aa,_ as Ma,a0 as La,a1 as Oa,a2 as Da,a3 as Fa,a4 as za,a5 as Ua,a6 as Va,a7 as Ba,a8 as $a,a9 as Ha,aa as Ga,ab as Ka,ac as Wa,ad as qa,ae as Qa,af as Ya,ag as Xa,ah as Za,ai as Ja}from"./radix-ui.BJcN8DO5.js";import{u as er,F as tr,b as nr,h as sr,y as ar,D as rr,H as or}from"./react-interactions.BiO1nID1.js";import{f as ir,u as lr,g as cr,b as dr,c as ur,d as mr,h as pr,i as fr,j as hr,k as gr,Q as xr,l as vr,m as br,R as _r}from"./tanstack-vendor.B_PTOi1V.js";import{c as yr,p as jr}from"./avatars.h8saQOOS.js";import{T as wr,I as Nr,S as Cr,a as kr,P as Sr,C as Tr,V as Er,L as Rr,b as Ir,c as Pr,d as Ar,e as Mr}from"./advanced-inputs.Cy5dtKGC.js";import{u as Lr,a as Or,T as Dr,C as Fr,e as zr}from"./animations.DoCLRNBg.js";import{u as Ur,C as Vr,a as Br,A as $r,L as Hr}from"./virtualization.uzjuHVPe.js";import{w as Gr,a as Kr,V as Wr,z as qr,B as Qr,k as Yr,L as Xr,q as Zr,b as Jr,H as eo,c as to,R as no,I as so}from"./headlessui.IsuTRzxN.js";import{A as ao,m as ro,a as oo,b as io}from"./framer-motion.CoSbn_z6.js";import{u as lo}from"./i18n.DMSRYMuy.js";import{a as co}from"./http-client.DABZ03PL.js";import{e as uo,o as mo,s as po,n as fo,u as ho,b as go,a as xo,c as vo,l as bo,d as _o,f as yo,r as jo,g as wo,h as No,Z as Co}from"./validation.CeCA-dRw.js";import{d as ko,l as So,t as To,i as Eo,k as Ro}from"./utilities.Be-Is_-r.js";import{p as Io,i as Po,a as Ao,s as Mo,b as Lo,c as Oo,f as Do,g as Fo,d as zo}from"./date-utils.j-oxXFG2.js";import{u as Uo,a as Vo,C as Bo,F as $o,b as Ho,c as Go,d as Ko}from"./forms.WVfMSmLf.js";import{T as Wo,Q as qo}from"./security-ui.BiG1lPPp.js";import{v as Qo,E as Yo}from"./heic-converter.Cz_Prg7D.js";import{M as Xo,r as Zo,s as Jo,a as ei,b as ti,c as ni,d as si}from"./markdown-processing.MlvRvaVW.js";import{S as ai,u as ri,a as oi,b as ii,c as li,_ as ci}from"./sandpack.CdwMuX9e.js";import"./math-katex.steiuUVT.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const di=(...e)=>a(H(e)),ui=e=>{const t=document.documentElement;switch(e.split("-")[1]){case"xs":t.style.setProperty("--markdown-font-size","0.75rem");break;case"sm":t.style.setProperty("--markdown-font-size","0.875rem");break;case"base":t.style.setProperty("--markdown-font-size","1rem");break;case"lg":t.style.setProperty("--markdown-font-size","1.125rem");break;case"xl":t.style.setProperty("--markdown-font-size","1.25rem")}},mi=Fa,pi=n.forwardRef((({className:e="",...t},n)=>s.jsx(Os,{ref:n,className:di("border-b",e),...t})));pi.displayName="AccordionItem";n.forwardRef((({className:e="",children:t,...n},a)=>s.jsx(Ds,{className:"flex",children:s.jsxs(Fs,{ref:a,className:di("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,s.jsx(zs,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}))).displayName=Fs.displayName;const fi=n.forwardRef((({className:e="",children:t,...n},a)=>s.jsx(Us,{ref:a,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:s.jsx("div",{className:di("pb-4 pt-0",e),children:t})})));function hi(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}fi.displayName=Us.displayName,hi("/* AnimatedTabs.css */\r\n.animated-tab-panel {\r\n  transition-property: opacity, translate;\r\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\r\n  transition-duration: 300ms;\r\n  animation-duration: 300ms;\r\n}\r\n\r\n/* Sliding underline animation for tabs */\r\n.animated-tab-list {\r\n  position: relative;\r\n}\r\n\r\n.animated-tab-list::after {\r\n  content: '';\r\n  position: absolute;\r\n  bottom: 0;\r\n  height: 2px;\r\n  background-color: currentColor; /* Inherit color from active tab */\r\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n  left: var(--tab-left, 0);\r\n  width: var(--tab-width, 0);\r\n}\r\n\r\n.animated-tab {\r\n  position: relative;\r\n}\r\n\r\n.animated-tab[data-state='active'] {\r\n  border-bottom-color: transparent !important;\r\n}\r\n\r\n.animated-tab-panel[data-enter] {\r\n  opacity: 1 !important;\r\n  translate: 0 !important;\r\n}\r\n\r\n@media (prefers-reduced-motion: reduce) {\r\n  .animated-tab-panel {\r\n    transition: none;\r\n  }\r\n}\r\n\r\n.animated-tab-panel:not([data-open]) {\r\n  position: absolute;\r\n  top: 0px;\r\n}\r\n\r\n.animated-panels:has(> [data-was-open]) > .animated-tab-panel {\r\n  opacity: 0;\r\n  translate: -100%;\r\n}\r\n\r\n.animated-panels [data-was-open] ~ .animated-tab-panel,\r\n.animated-panels [data-open] ~ .animated-tab-panel {\r\n  translate: 100%;\r\n}\r\n");const gi=n.forwardRef((function(e,t){const a=n.useRef(null);return n.useEffect((()=>{const e=a.current;if(!e)return;const t=()=>{const t="true"===e.getAttribute("aria-selected");e.setAttribute("data-state",t?"active":"inactive")};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,attributeFilter:["aria-selected"]}),()=>n.disconnect()}),[]),s.jsx(r,{ref:e=>{a.current=e,"function"==typeof t?t(e):t&&(t.current=e)},...e,className:`animated-tab aria-selected:text-token-text-primary flex select-none items-center justify-center gap-2 whitespace-nowrap border-none text-sm font-medium outline-none transition-colors aria-disabled:opacity-50 ${e.className||""}`})})),xi=n.forwardRef((function(e,t){const a=o(),r=function(e){const t=n.useRef(void 0);return n.useEffect((()=>{t.current=e}),[e]),t.current}(i(a,"selectedId")),c=e.tabId&&r===e.tabId;return s.jsx(l,{ref:t,...e,"data-was-open":c||void 0,className:`animated-tab-panel max-w-full ${e.className||""}`})}));function vi({tabs:e,className:t="",tabListClassName:a="",tabClassName:r="",tabPanelClassName:o="",containerClassName:i="",tabListProps:l={},defaultSelectedId:c}){const d=e.map(((e,t)=>e.id||`tab-${t}`)),u=c||d[0],m=n.useRef(null);return n.useEffect((()=>{const e=m.current;if(!e)return;const t=()=>{const t=e.querySelector('[data-state="active"]');t&&(e.style.setProperty("--tab-left",`${t.offsetLeft}px`),e.style.setProperty("--tab-width",`${t.offsetWidth}px`))};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,subtree:!0,attributeFilter:["data-state"]}),()=>n.disconnect()}),[e]),s.jsx("div",{className:`w-full ${t}`,children:s.jsxs(ue,{defaultSelectedId:u,children:[s.jsx(me,{ref:m,"aria-label":"Tabs",className:`animated-tab-list flex py-1 ${a}`,...l,children:e.map(((e,t)=>s.jsx(gi,{id:d[t],disabled:e.disabled,className:r,"data-state":d[t]===u?"active":"inactive",children:e.label},d[t])))}),s.jsx("div",{className:di("animated-panels relative flex w-full flex-col items-center overflow-hidden p-0",i),children:e.map(((e,t)=>s.jsx(xi,{id:`panel-${d[t]}`,tabId:d[t],className:o,children:e.content},`panel-${d[t]}`)))})]})})}const bi=({className:e="",children:t,...n})=>s.jsx(Ra,{className:di(e),...n,children:s.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:t})});bi.displayName=Ra.displayName;const _i=n.forwardRef((({className:e="",...t},n)=>s.jsx(Vs,{className:di("fixed inset-0 z-50 bg-gray-500/90 transition-opacity animate-in fade-in dark:bg-gray-800/90",e),...t,ref:n})));_i.displayName=Vs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsxs(bi,{children:[s.jsx(_i,{}),s.jsx(Bs,{ref:n,className:di("fixed z-50 grid w-full max-w-lg scale-100 gap-4 bg-white p-6 opacity-100 animate-in fade-in-90 slide-in-from-bottom-10 sm:rounded-lg sm:zoom-in-90 sm:slide-in-from-bottom-0 md:w-full","dark:bg-gray-900",e),...t})]}))).displayName=Bs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx($s,{ref:n,className:di("text-lg font-semibold text-gray-900","dark:text-gray-50",e),...t}))).displayName=$s.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Hs,{ref:n,className:di("text-sm text-gray-500","dark:text-gray-400",e),...t}))).displayName=Hs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Gs,{ref:n,className:di("inline-flex h-10 items-center justify-center rounded-md bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-gray-100 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),...t}))).displayName=Gs.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Ks,{ref:n,className:di("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e),...t}))).displayName=Ks.displayName;const yi=n.forwardRef((({...e},t)=>s.jsx("nav",{ref:t,"aria-label":"breadcrumb",...e})));yi.displayName="Breadcrumb";const ji=n.forwardRef((({className:e,...t},n)=>s.jsx("ol",{ref:n,className:di("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",e),...t})));ji.displayName="BreadcrumbList";const wi=n.forwardRef((({className:e,...t},n)=>s.jsx("li",{ref:n,className:di("inline-flex items-center gap-1.5",e),...t})));wi.displayName="BreadcrumbItem";const Ni=n.forwardRef((({asChild:e,className:t,...n},a)=>s.jsx(e?Ws:"a",{ref:a,className:di("transition-colors hover:text-foreground",t),...n})));Ni.displayName="BreadcrumbLink";n.forwardRef((({className:e,...t},n)=>s.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:di("font-normal text-foreground",e),...t}))).displayName="BreadcrumbPage";const Ci=({children:e,className:t,...n})=>s.jsx("li",{role:"presentation","aria-hidden":"true",className:di("[&>svg]:size-3.5",t),...n,children:e??s.jsx(u,{})});Ci.displayName="BreadcrumbSeparator";const ki=c("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-surface-destructive text-destructive-foreground hover:bg-surface-destructive-hover",outline:"text-text-primary border border-border-light bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-surface-hover hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",submit:"bg-surface-submit text-white hover:bg-surface-submit-hover"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-lg px-8",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}}),Si=n.forwardRef((({className:e,variant:t,size:n,asChild:a=!1,...r},o)=>s.jsx(a?Ws:"button",{className:di(ki({variant:t,size:n,className:e})),ref:o,...r})));Si.displayName="Button";const Ti=n.forwardRef((({className:e="",...t},n)=>s.jsx(qs,{ref:n,className:di("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:s.jsx(Qs,{className:di("flex items-center justify-center"),children:s.jsx(d,{className:"h-4 w-4"})})})));Ti.displayName=qs.displayName;const Ei=La,Ri=Oa,Ii=Da;n.forwardRef((({className:e="",inset:t,children:n,...a},r)=>s.jsxs(Ys,{ref:r,className:di("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-900 dark:data-[state=open]:bg-gray-900",t?"pl-8":"",e),...a,children:[n,s.jsx(u,{className:"ml-auto h-4 w-4"})]}))).displayName=Ys.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Xs,{ref:n,className:di("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in slide-in-from-left-1 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...t}))).displayName=Xs.displayName;const Pi=n.forwardRef((({className:e="",sideOffset:t=4,...n},a)=>s.jsx(Zs,{children:s.jsx(Js,{ref:a,sideOffset:t,className:di("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...n})})));Pi.displayName=Js.displayName;const Ai=n.forwardRef((({className:e="",inset:t,...n},a)=>s.jsx(ea,{ref:a,className:di("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",t?"pl-8":"",e),...n})));Ai.displayName=ea.displayName;const Mi=n.forwardRef((({className:e="",children:t,checked:n,...a},r)=>s.jsxs(ta,{ref:r,className:di("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",e),checked:n,...a,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(na,{children:s.jsx(d,{className:"h-4 w-4"})})}),t]})));Mi.displayName=ta.displayName;n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(sa,{ref:a,className:di(e,"relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800"),...n,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(na,{children:s.jsx(m,{className:"h-2 w-2 fill-current"})})}),t]}))).displayName=sa.displayName;n.forwardRef((({className:e="",inset:t,...n},a)=>s.jsx(aa,{ref:a,className:di("px-2 py-1.5 text-sm font-semibold text-gray-900 dark:text-gray-300",t?"pl-8":"",e),...n}))).displayName=aa.displayName;const Li=n.forwardRef((({className:e="",...t},n)=>s.jsx(ra,{ref:n,className:di("-mx-1 my-1 h-px bg-border-medium",e),...t})));var Oi,Di,Fi;Li.displayName=ra.displayName,(Fi=Oi||(Oi={})).Top="top",Fi.Right="right",Fi.Bottom="bottom",Fi.Left="left",function(e){e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(Di||(Di={}));const zi=p("en"),Ui=p("ltr");p("text-base");const Vi=p({open:!1,message:"",severity:Di.SUCCESS,showIcon:!0});function Bi(e=100){const[t,s]=ge(Vi),a=n.useRef(null),r=n.useRef(null);return n.useEffect((()=>()=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current)}),[]),{toast:t,onOpenChange:e=>s({...t,open:e}),showToast:({message:t,severity:n=Di.SUCCESS,showIcon:o=!0,duration:i=3e3,status:l})=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current),a.current=window.setTimeout((()=>{s({open:!0,message:t,severity:l??n,showIcon:o}),r.current=window.setTimeout((()=>{s((e=>({...e,open:!1})))}),i)}),e)}}}const $i={},Hi=e=>n.useMemo((()=>{const{username:t,name:n}=e??{},s=n||t;if(!s)return"";if((null==e?void 0:e.avatar)&&""!==(null==e?void 0:e.avatar))return e.avatar;if($i[s])return $i[s];const a=yr(jr,{seed:s,fontFamily:["Verdana"],fontSize:36});let r="";try{r=a.toDataUri(),r&&($i[s]=r)}catch(ru){console.error("Failed to generate avatar:",ru)}return r}),[e]);function Gi({value:e,options:t}){const[s,a]=n.useState(!1),[r,o]=n.useState(""),i=n.useMemo((()=>{if(!r)return t;const n=A(t,r,{keys:["label","value"]}),s=t.find((t=>t.value===e));return s&&!n.includes(s)&&n.push(s),n}),[r,e,t]);return{open:s,setOpen:a,searchValue:r,setSearchValue:o,matches:i}}function Ki(){const e=g(zi),{t:t,i18n:s}=lo();return n.useEffect((()=>{s.language!==e&&s.changeLanguage(e)}),[e,s]),(e,n)=>t(e,n)}function Wi(e){const[t,s]=n.useState(!1);return n.useEffect((()=>{const n=window.matchMedia(e);n.matches!==t&&s(n.matches);const a=()=>s(n.matches);return n.addEventListener("change",a),()=>n.removeEventListener("change",a)}),[t,e]),t}function qi(e,t,s,a){n.useEffect((()=>{const n=n=>{const r=n.target;r&&"id"in r&&s.includes(r.id)||(null==r?void 0:r.parentNode)&&"id"in r.parentNode&&s.includes(r.parentNode.id)||a||e.current&&!e.current.contains(r)&&t()};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}}),[e,t])}const Qi=pa,Yi=Ma,Xi=({className:e="",children:t,...n})=>s.jsx(fa,{className:di(e),...n,children:s.jsx("div",{className:"fixed inset-0 z-[999] flex items-start justify-center sm:items-center",children:t})});Xi.displayName=fa.displayName;const Zi=n.forwardRef((({className:e,...t},n)=>s.jsx(oa,{className:di("fixed inset-0 z-[999] bg-gray-600/65 transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in dark:bg-black/80",e??""),...t,ref:n})));Zi.displayName=oa.displayName;const Ji=n.forwardRef((({className:e,children:t=!0,showCloseButton:n=!0,disableScroll:a=!1,...r},o)=>{const i=Wi("(max-width: 768px)");return s.jsxs(Xi,{children:[s.jsx(Zi,{}),s.jsxs(ia,{ref:o,className:di("fixed z-[999] grid w-full gap-4 rounded-b-lg bg-white pb-6 animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:rounded-lg","dark:bg-gray-700",i?"fixed left-1/2 top-1/2 z-[999] m-auto grid w-11/12 -translate-x-1/2 -translate-y-1/2 gap-4 rounded-xl bg-white pb-6":"",a?"overflow-hidden":"",e??""),...r,children:[t,n&&s.jsxs(la,{className:"absolute right-6 top-[1.6rem] rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 dark:focus:ring-white dark:focus:ring-offset-gray-700 dark:data-[state=open]:bg-gray-800",children:[s.jsx(f,{className:"h-5 w-5 text-black dark:text-white"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}));Ji.displayName=ia.displayName;const el=({className:e,...t})=>s.jsx("div",{className:di("flex flex-col space-y-2 border-b border-black/10 p-6 pb-4 text-left dark:border-white/10",e??""),...t});el.displayName="DialogHeader";const tl=({className:e,...t})=>s.jsx("div",{className:di("flex flex-row justify-between space-x-2 px-6 py-4",e??""),...t});tl.displayName="DialogFooter";const nl=n.forwardRef((({className:e,...t},n)=>s.jsx(ca,{ref:n,className:di("text-lg font-semibold text-gray-900","dark:text-gray-50",e??""),...t})));nl.displayName=ca.displayName;const sl=n.forwardRef((({className:e,...t},n)=>s.jsx(da,{ref:n,className:di("text-sm text-gray-500","dark:text-gray-400",e??""),...t})));sl.displayName=da.displayName;const al=n.forwardRef((({className:e,...t},n)=>s.jsx(la,{ref:n,className:di("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t})));al.displayName=ca.displayName;n.forwardRef((({className:e,...t},n)=>s.jsx(Si,{ref:n,variant:"outline",className:di("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t}))).displayName=ca.displayName;const rl=Ia,ol=Pa,il=Aa,ll=n.forwardRef((({className:e="",align:t="center",sideOffset:n=6,disabled:a=!1,...r},o)=>a?null:s.jsx(ua,{ref:o,align:t,sideOffset:n,className:di("z-50 w-64 origin-[--radix-hover-card-content-transform-origin] rounded-xl border border-border-light bg-surface-secondary p-4 text-text-primary shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})));ll.displayName=ua.displayName;const cl=n.forwardRef((({className:e,...t},n)=>s.jsx("input",{className:di("flex h-10 w-full rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e??""),ref:n,...t})));cl.displayName="Input";const dl=n.forwardRef((({className:e,...t},n)=>s.jsx(h,{className:di("flex max-h-5 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50",e??""),ref:n,...t})));dl.displayName="Input";const ul=n.forwardRef((({className:e="",...t},n)=>s.jsx(ma,{ref:n,...t,className:di("block w-full break-all text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-200",e)})));ul.displayName=ma.displayName;const ml=n.forwardRef((({children:e,triggerRef:t,triggerRefs:n,onOpenChange:a,...r},o)=>s.jsx(pa,{...r,onOpenChange:e=>{!e&&(null==t?void 0:t.current)&&setTimeout((()=>{var e;null==(e=t.current)||e.focus()}),0),(null==n?void 0:n.length)&&n.forEach((e=>{(null==e?void 0:e.current)&&setTimeout((()=>{var t;null==(t=e.current)||t.focus()}),0)})),null==a||a(e)},children:e}))),pl=Ma,fl=fa,hl=la,gl=n.forwardRef((({className:e,...t},n)=>s.jsx(oa,{ref:n,className:di("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t})));gl.displayName=oa.displayName;const xl=n.forwardRef((({className:e,overlayClassName:t,showCloseButton:n=!0,children:a,...r},o)=>s.jsxs(fl,{children:[s.jsx(gl,{className:t}),s.jsxs(ia,{ref:o,className:di("max-w-11/12 fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 rounded-2xl bg-background p-6 text-text-primary shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...r,children:[a,n&&s.jsxs(la,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-ring-primary ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));xl.displayName=ia.displayName;const vl=({className:e,...t})=>s.jsx("div",{className:di("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});vl.displayName="DialogHeader";const bl=({className:e,...t})=>s.jsx("div",{className:di("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});bl.displayName="DialogFooter";const _l=n.forwardRef((({className:e,...t},n)=>s.jsx(ca,{ref:n,className:di("text-lg font-semibold leading-none tracking-tight",e),...t})));_l.displayName=ca.displayName;const yl=n.forwardRef((({className:e,...t},n)=>s.jsx(da,{ref:n,className:di("text-sm text-text-secondary",e),...t})));yl.displayName=da.displayName;const jl=n.forwardRef((({className:e,onDoubleClick:t,...n},a)=>s.jsxs(ha,{ref:a,...n,className:di("relative flex w-full cursor-pointer touch-none select-none items-center",e),onDoubleClick:t,children:[s.jsx(ga,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:s.jsx(xa,{className:"absolute h-full bg-primary"})}),s.jsx(va,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})));jl.displayName=ha.displayName;const wl=n.forwardRef((({className:e="",orientation:t="horizontal",decorative:n=!0,...a},r)=>s.jsx(ba,{ref:r,...a,decorative:n,orientation:t,className:di("shrink-0 bg-border-light","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e)})));wl.displayName=ba.displayName;const Nl=({label:e,labelClassName:t,placeholder:n="Select an option",options:a,className:r,value:o,onChange:i,onBlur:l})=>{const c=e=>null!=e&&"object"==typeof e&&"value"in e,[d,u]=S.useState(!1),[m,p]=S.useState(o),[f,h]=S.useState(!1);S.useEffect((()=>{p(o)}),[o]);const g=e=>{p(e),i(e)};return s.jsxs(G,{value:m,setValue:g,children:[null!=e&&s.jsx(K,{className:di("mb-2 block text-sm font-medium text-text-primary",t??""),children:e}),s.jsx("div",{className:di("relative",f?"rounded-md ring-2 ring-ring-primary":""),children:s.jsx(z,{placeholder:n,className:di("h-10 w-full rounded-md border border-border-light bg-surface-primary px-3 py-2 text-sm","placeholder-text-secondary hover:bg-surface-hover","focus:outline-none",r),onChange:e=>g(e.target.value),onBlur:()=>{h(!1),l()},onFocusVisible:()=>{h(!0),u(!0)},onMouseDown:()=>{h(!1)}})}),s.jsx(W,{gutter:4,sameWidth:!0,open:d,onClose:()=>u(!1),className:di("z-50 max-h-60 w-full overflow-auto rounded-md bg-surface-primary p-1 shadow-lg","animate-in fade-in-0 zoom-in-95"),children:a.map(((e,t)=>s.jsxs(B,{className:di("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none","cursor-pointer hover:bg-surface-tertiary hover:text-text-primary","data-[active-item]:bg-surface-tertiary data-[active-item]:text-text-primary"),value:c(e)?`${e.value??""}`:e,children:[c(e)&&null!=e.icon&&s.jsx("span",{className:"mr-2 flex-shrink-0",children:e.icon}),c(e)?e.label:e]},t)))})]})};function Cl({className:e,...t}){return s.jsx("div",{className:di("animate-pulse rounded-md bg-surface-tertiary opacity-50 dark:opacity-25",e),...t})}const kl=n.forwardRef((({className:e,...t},n)=>s.jsx(_a,{className:di("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-unchecked",e),...t,ref:n,children:s.jsx(ya,{className:di("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})));kl.displayName=_a.displayName;const Sl=n.forwardRef((({className:e,...t},n)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:n,className:di("w-full caption-bottom text-sm",e),...t})})));Sl.displayName="Table";const Tl=n.forwardRef((({className:e,...t},n)=>s.jsx("thead",{ref:n,className:di("[&_tr]:border-b",e),...t})));Tl.displayName="TableHeader";const El=n.forwardRef((({className:e,...t},n)=>s.jsx("tbody",{ref:n,className:di("[&_tr:last-child]:border-0",e),...t})));El.displayName="TableBody";n.forwardRef((({className:e,...t},n)=>s.jsx("tfoot",{ref:n,className:di("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}))).displayName="TableFooter";const Rl=n.forwardRef((({className:e,...t},n)=>s.jsx("tr",{ref:n,className:di("border-b border-border-light transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t})));Rl.displayName="TableRow";const Il=n.forwardRef((({className:e,...t},n)=>s.jsx("th",{ref:n,className:di("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t})));Il.displayName="TableHead";const Pl=n.forwardRef((({className:e,...t},n)=>s.jsx("td",{ref:n,className:di("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t})));Pl.displayName="TableCell";n.forwardRef((({className:e,...t},n)=>s.jsx("caption",{ref:n,className:di("mt-4 text-sm text-muted-foreground",e),...t}))).displayName="TableCaption";n.forwardRef((({className:e="",...t},n)=>s.jsx(ja,{ref:n,className:di("inline-flex items-center justify-center rounded-md bg-surface-primary",e),...t}))).displayName=ja.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(wa,{className:di("inline-flex min-w-[100px] items-center justify-center rounded-[0.185rem] px-3 py-1.5 text-sm font-medium text-gray-700 transition-all disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-800 data-[state=active]:shadow-sm dark:data-[state=active]:bg-gray-700 dark:data-[state=active]:text-gray-200",e),...t,ref:n}))).displayName=wa.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Na,{className:di("mt-2 rounded-md p-6",e),...t,ref:n}))).displayName=Na.displayName;const Al=n.forwardRef((({CancelButton:e,LabelNode:t,label:n,onRemove:a,className:r="",labelClassName:o="",...i},l)=>s.jsxs("div",{ref:l,...i,className:di("flex max-h-8 items-center overflow-y-hidden rounded-3xl border-2 border-green-600 bg-green-600/20 text-xs text-green-600 dark:text-white",r),children:[s.jsxs("div",{className:di("ml-1 whitespace-pre-wrap px-2 py-1",o),children:[t?s.jsxs(s.Fragment,{children:[t," "]}):null,n]}),e||a&&s.jsx("button",{onClick:e=>{e.stopPropagation(),a(e)},className:"rounded-full bg-green-600/50","aria-label":`Remove ${n}`,children:s.jsx(f,{className:"m-[1.5px] p-1"})})]})));Al.displayName="Tag";const Ml=n.memo(Al);n.forwardRef((({className:e="",...t},n)=>s.jsx("textarea",{className:di("flex h-20 w-full resize-none rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),ref:n,...t}))).displayName="Textarea";const Ll=n.forwardRef(((e,t)=>{const[,a]=n.useState(!1),r=g(Ui).toLowerCase();return n.useLayoutEffect((()=>a(!0)),[]),s.jsx(x,{dir:r,...e,ref:t})}));function Ol(){const{toast:e,onOpenChange:t}=Bi(),n={[Di.INFO]:"border-gray-500 bg-gray-500",[Di.SUCCESS]:"border-green-500 bg-green-500",[Di.WARNING]:"border-orange-500 bg-orange-500",[Di.ERROR]:"border-red-500 bg-red-500"};return s.jsx(za,{open:e.open,onOpenChange:t,className:"toast-root",style:{height:"74px",marginBottom:"0px"},children:s.jsx("div",{className:"w-full p-1 text-center md:w-auto md:text-justify",children:s.jsxs("div",{className:`alert-root pointer-events-auto inline-flex flex-row gap-2 rounded-md border px-3 py-2 text-white ${n[e.severity]}`,children:[e.showIcon&&s.jsx("div",{className:"mt-1 flex-shrink-0 flex-grow-0",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"}),s.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),s.jsx(Ua,{className:"flex-1 justify-center gap-2",children:s.jsx("div",{className:"whitespace-pre-wrap text-left",children:e.message})})]})})})}hi(".tooltip {\r\n  z-index: 50;\r\n  cursor: pointer;\r\n  border-radius: 0.275rem;\r\n  background-color: var(--surface-primary);\r\n  padding-top: 0.25rem;\r\n  padding-bottom: 0.25rem;\r\n  padding-left: 0.5rem;\r\n  padding-right: 0.5rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5rem;\r\n  color: black;\r\n  box-shadow: 0 2px 4px 0 rgb(0 0 0 / 0.25);\r\n  /* Enhanced layout for longer descriptions */\r\n  max-width: 320px;\r\n  word-wrap: break-word;\r\n  text-align: left;\r\n}\r\n\r\n@media (max-width: 640px) {\r\n  .tooltip {\r\n    max-width: 200px;\r\n  }\r\n}\r\n\r\n.tooltip:where(.dark, .dark *) {\r\n  background-color: var(--surface-primary);\r\n  color: white;\r\n  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.35);\r\n}\r\n");const Dl=n.forwardRef((function({description:e,side:t="top",className:a,role:r,enableHTML:o=!1,...l},c){const d=v({placement:t}),u=i(d,(e=>e.mounted)),m=i(d,(e=>e.placement)),p=n.useId(),f=n.useMemo((()=>{const e=b();return e.addHook("afterSanitizeAttributes",(e=>{e.tagName&&"A"===e.tagName&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))})),e}),[]),h=n.useMemo((()=>{if(!o)return"";try{return f.sanitize(e,{ALLOWED_TAGS:["a","strong","b","em","i","br","code"],ALLOWED_ATTR:["href","class","target","rel"],ALLOW_DATA_ATTR:!1,ALLOW_ARIA_ATTR:!1})}catch(Fi){return console.error("Sanitization failed",Fi),e}}),[o,e,f]),{x:g,y:x}=n.useMemo((()=>{switch(m.split("-")[0]){case"top":return{x:0,y:-8};case"bottom":return{x:0,y:8};case"left":return{x:-8,y:0};case"right":return{x:8,y:0};default:return{x:0,y:0}}}),[m]);return s.jsxs(_,{store:d,hideTimeout:0,children:[s.jsx(y,{...l,ref:c,role:r,"aria-describedby":p,onKeyDown:e=>{"button"===r&&"Enter"===e.key&&(e.preventDefault(),e.target.click())},className:di("cursor-pointer",a)}),s.jsx(ao,{children:!0===u&&s.jsxs(j,{gutter:4,alwaysVisible:!0,className:"tooltip",id:p,render:s.jsx(ro.div,{initial:{opacity:0,x:g,y:x},animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:g,y:x}}),children:[s.jsx(w,{}),o?s.jsx("div",{dangerouslySetInnerHTML:{__html:h}}):e]})})]})}));n.forwardRef((({className:e,...t},n)=>s.jsx("ul",{ref:n,className:di("flex flex-row items-center gap-1",e),...t}))).displayName="PaginationContent";n.forwardRef((({className:e,...t},n)=>s.jsx("li",{ref:n,className:di("",e),...t}))).displayName="PaginationItem";const Fl=n.forwardRef((({className:e,value:t,...n},a)=>s.jsx(Ca,{ref:a,className:di("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...n,children:s.jsx(ka,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})));Fl.displayName=Ca.displayName;const zl=n.forwardRef((({className:e,containerClassName:t,...n},a)=>s.jsx(N,{ref:a,containerClassName:di("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:di("disabled:cursor-not-allowed",e),...n})));zl.displayName="InputOTP";const Ul=n.forwardRef((({className:e,...t},n)=>s.jsx("div",{ref:n,className:di("flex items-center",e),...t})));Ul.displayName="InputOTPGroup";const Vl=n.forwardRef((({index:e,className:t,...a},r)=>{const o=n.useContext(C);if(!o)throw new Error("InputOTPSlot must be used within an OTPInput");const{char:i,hasFakeCaret:l,isActive:c}=o.slots[e];return s.jsxs("div",{ref:r,className:di("text-md relative flex h-11 w-11 items-center justify-center border-y border-r border-input shadow-sm transition-all first:rounded-l-xl first:border-l last:rounded-r-xl",c&&"z-10 ring-1 ring-ring",t),...a,children:[i,l&&s.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})}));Vl.displayName="InputOTPSlot";const Bl=n.forwardRef((({...e},t)=>s.jsx("div",{ref:t,role:"separator",...e,children:s.jsx(k,{})})));function $l({value:e,onChange:t,placeholder:a,className:r=""}){const o=n.useRef(null),i=n.useCallback((e=>t(e.target.value)),[t]);return s.jsxs("div",{className:di("focus:to-surface-primary/50 group sticky left-0 top-0 z-10 flex h-12 items-center gap-2 bg-gradient-to-b from-surface-tertiary-alt from-65% to-transparent px-3 py-2 text-text-primary transition-colors duration-300 focus:bg-gradient-to-b focus:from-surface-primary",r),children:[s.jsx(F,{className:"h-4 w-4 text-text-secondary-alt transition-colors duration-300","aria-hidden":"true"}),s.jsx("input",{ref:o,type:"text",value:e??"",onChange:i,placeholder:String(a??"Search..."),"aria-label":"Search Model",className:"flex-1 rounded-md border-none bg-transparent px-2.5 py-2 text-sm placeholder-text-secondary focus:outline-none focus:ring-1 focus:ring-ring-primary"}),s.jsx("button",{className:di("relative flex h-5 w-5 items-center justify-end rounded-md text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"hidden"),"aria-label":"Clear search",onClick:()=>{t(""),setTimeout((()=>{var e;null==(e=o.current)||e.focus()}),0)},tabIndex:0,children:s.jsx(f,{"aria-hidden":"true",className:di("text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"opacity-0")})})]})}function Hl(e){return"string"==typeof e?e.startsWith("---")&&e.endsWith("---")?"":e.toUpperCase():""}function Gl({availableOptions:e=[],placeholder:t,getTextKeyOverride:a,className:r,disabled:o=!1}){const[i,l]=n.useState(null),c=e.length>10&&!o,d=a||Hl,u=n.useMemo((()=>{const t=i??"";if(!c||!t||!e.length)return e;const n=t.toUpperCase();return e.filter((e=>d(e).includes(n)))}),[e,d,i,c]),m=n.useCallback((e=>l(e)),[]);return[u,c?s.jsx($l,{value:i,className:r,onChange:m,placeholder:t}):null]}Bl.displayName="InputOTPSeparator";const Kl=({className:e="",...t})=>s.jsx(de,{className:di("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),Wl=X,ql=({withHandle:e,className:t="",...n})=>s.jsx(J,{className:di("group relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:e&&s.jsx("div",{className:"invisible z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border group-hover:visible group-active:visible",children:s.jsx(ee,{className:"h-2.5 w-2.5"})})});n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(wr,{ref:a,className:di("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-gray-200 border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 [&>span]:line-clamp-1","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[t,s.jsx(Nr,{asChild:!0,children:s.jsx(Sa,{className:"h-4 w-4 opacity-50"})})]}))).displayName=wr.displayName;const Ql=n.forwardRef((({className:e="",...t},n)=>s.jsx(Cr,{ref:n,className:di("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:s.jsx(Ta,{})})));Ql.displayName=Cr.displayName;const Yl=n.forwardRef((({className:e="",...t},n)=>s.jsx(kr,{ref:n,className:di("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:s.jsx(zs,{})})));Yl.displayName=kr.displayName;n.forwardRef((({className:e="",children:t,position:n="popper",...a},r)=>s.jsx(Sr,{children:s.jsxs(Tr,{ref:r,className:di("bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-600","popper"===n?"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1":"",e),position:n,...a,children:[s.jsx(Ql,{}),s.jsx(Er,{className:di("p-1","popper"===n?"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]":""),children:t}),s.jsx(Yl,{})]})}))).displayName=Tr.displayName;n.forwardRef((({className:e="",...t},n)=>s.jsx(Rr,{ref:n,className:di("px-2 py-1.5 text-sm font-semibold",e),...t}))).displayName=Rr.displayName;n.forwardRef((({className:e="",children:t,...n},a)=>s.jsxs(Ir,{ref:a,className:di("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[s.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(Pr,{children:s.jsx(Ea,{className:"h-4 w-4"})})}),s.jsx(Ar,{children:t})]}))).displayName=Ir.displayName;function Xl({icon:e,label:t,id:n,isActive:a=!1,isEditing:r=!1,isDragging:o=!1,isAvailable:i=!0,isInChat:l=!1,onBadgeAction:c,onToggle:d,className:u,...m}){const p=r&&i,h="1"===n&&l;return s.jsxs(ro.button,{onClick:e=>{if(h)return e.preventDefault(),void e.stopPropagation();!r&&d&&(e.preventDefault(),e.stopPropagation(),d())},className:di("group relative inline-flex items-center gap-1.5 rounded-full px-4 py-1.5","border border-border-medium text-sm font-medium transition-shadow md:w-full","size-9 p-2 md:p-3",a?"bg-surface-active shadow-md":"bg-surface-chat shadow-sm hover:bg-surface-hover hover:shadow-md","active:scale-95 active:shadow-inner",p&&"cursor-move",h&&"cursor-not-allowed opacity-50 hover:shadow-sm",u),animate:{scale:o?1.1:1,boxShadow:o?"0 10px 25px rgba(0,0,0,0.1)":void 0},whileTap:{scale:o?1.1:h?1:.97},transition:{type:"tween",duration:.1,ease:"easeOut"},...m,children:[e&&s.jsx(e,{className:di("relative h-5 w-5 md:h-4 md:w-4",!t&&"mx-auto")}),s.jsx("span",{className:"relative hidden md:inline",children:t}),r&&!o&&s.jsx(ro.button,{className:"absolute -right-1 -top-1 flex h-6 w-6 items-center justify-center rounded-full bg-surface-secondary-alt text-text-primary shadow-sm md:h-5 md:w-5",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},whileTap:{scale:.9},onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),null==c||c()},children:s.jsx(i?f:pe,{className:"h-3 w-3"})})]})}function Zl({className:e=""}){return s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",className:di("lucide lucide-blocks",e),children:[s.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),s.jsx("path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3"})]})}function Jl({className:e="",...t}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"none",className:di("h-4 w-4",e),width:"16",height:"16",strokeWidth:"2",...t,children:s.jsxs("g",{fill:"currentColor",children:[s.jsx("path",{d:"M13.164.98a.7.7 0 0 0-1.328 0l-.478 1.435a.7.7 0 0 1-.443.443l-1.436.478a.7.7 0 0 0 0 1.328l1.436.479a.7.7 0 0 1 .443.442l.478 1.436a.7.7 0 0 0 1.328 0l.478-1.436a.7.7 0 0 1 .443-.443l1.436-.478a.7.7 0 0 0 0-1.328l-1.436-.478a.7.7 0 0 1-.443-.443L13.164.979Z"}),s.jsx("path",{d:"M13.237 10.534c-.228-.245-.513-.46-.847-.46a.823.823 0 0 0-.828.849c.04 1.04.128 2.067.263 3.08a.619.619 0 0 1-.528.695c-.872.121-1.748.208-2.626.262a.8.8 0 0 1-.845-.805c0-.325.21-.602.45-.82.235-.215.375-.488.375-.787 0-.683-.738-1.237-1.65-1.237-.911 0-1.65.554-1.65 1.237 0 .294.137.563.364.775.245.229.461.513.461.848a.823.823 0 0 1-.85.829 33.809 33.809 0 0 1-3.266-.278.619.619 0 0 1-.532-.532 34.099 34.099 0 0 1-.278-3.267.823.823 0 0 1 .83-.85c.333 0 .619.216.846.461.212.228.482.364.776.364.683 0 1.237-.738 1.237-1.65 0-.91-.554-1.65-1.237-1.65-.299 0-.572.142-.786.376-.219.24-.496.45-.821.45a.8.8 0 0 1-.805-.845c.054-.885.142-1.76.262-2.626a.619.619 0 0 1 .695-.528c1.022.136 2.05.224 3.08.263a.822.822 0 0 0 .85-.828c0-.334-.217-.62-.462-.847-.227-.212-.363-.482-.363-.776C5.352 1.554 6.09 1 7.002 1c.91 0 1.649.554 1.649 1.237 0 .173-.012.327-.029.473C8.258 3 8 3.41 8 4c0 1.5 1.667 1.833 2.5 2 .167.833.5 2.5 2 2.5.732 0 1.186-.397 1.479-.9l.034-.001c.683 0 1.237.738 1.237 1.65 0 .911-.554 1.65-1.237 1.65-.294 0-.564-.137-.776-.364Z"})]})})}function ec({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 41 41",fill:"none",xmlns:"http://www.w3.org/2000/svg",strokeWidth:"1.5",className:di(t,""),children:s.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z",fill:"currentColor"})})}n.forwardRef((({className:e="",...t},n)=>s.jsx(Mr,{ref:n,className:di("-mx-1 my-1 h-px bg-muted",e),...t}))).displayName=Mr.displayName,n.memo((function({options:e,value:t,onChange:a,disabled:r=!1}){const o=Ki(),[i,l]=n.useState(t??""),c=n.useRef([]),[d,u]=n.useState({}),m=n.useCallback((()=>{const t=e.findIndex((e=>e.value===i));if(t>=0&&c.current[t]){const e=c.current[t],n=null==e?void 0:e.parentElement;if(e&&n){const t=n.getBoundingClientRect(),s=e.getBoundingClientRect(),a=s.left-t.left-4;u({width:`${s.width}px`,transform:`translateX(${a}px)`})}}}),[i,e]);if(n.useLayoutEffect((()=>{m()}),[m]),n.useLayoutEffect((()=>{void 0!==t&&l(t)}),[t]),0===e.length)return s.jsx("div",{className:"relative inline-flex items-center rounded-lg bg-muted p-1 opacity-50",role:"radiogroup",children:s.jsx("span",{className:"px-4 py-2 text-xs text-muted-foreground",children:o("com_ui_no_options")})});const p=e.findIndex((e=>e.value===i));return s.jsxs("div",{className:"relative inline-flex items-center rounded-lg bg-muted p-1",role:"radiogroup",children:[p>=0&&s.jsx("div",{className:"pointer-events-none absolute inset-y-1 rounded-md border border-border/50 bg-background shadow-sm transition-all duration-300 ease-out",style:d}),e.map(((e,t)=>s.jsx("button",{ref:e=>{c.current[t]=e},type:"button",role:"radio","aria-checked":i===e.value,onClick:()=>{return t=e.value,l(t),void(null==a||a(t));var t},disabled:r,className:`relative z-10 flex h-[34px] items-center justify-center rounded-md px-4 text-sm font-medium transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring ${e.value,"text-foreground"} ${r?"cursor-not-allowed opacity-50":""}`,children:s.jsx("span",{className:"whitespace-nowrap",children:e.label})},e.value)))]})}));const tc=S.forwardRef(((e,t)=>{const{className:n="icon-md",size:a="1.2em"}=e;return s.jsx("svg",{ref:t,fill:"none",strokeWidth:"2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",height:a,width:a,className:di(n),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z",fill:"currentColor"})})}));function nc({className:e="icon-sm"}){return s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.00633 5.5C6.02321 5.53319 6.07042 5.60366 6.19525 5.70906C6.42458 5.9027 6.81573 6.12215 7.38659 6.32603C8.5196 6.73067 10.1506 7 12 7C13.8494 7 15.4804 6.73067 16.6134 6.32603C17.1843 6.12215 17.5754 5.9027 17.8048 5.70906C17.9296 5.60366 17.9768 5.53319 17.9937 5.5C17.9768 5.46681 17.9296 5.39634 17.8048 5.29094C17.5754 5.0973 17.1843 4.87785 16.6134 4.67397C15.4804 4.26933 13.8494 4 12 4C10.1506 4 8.5196 4.26933 7.38659 4.67397C6.81573 4.87785 6.42458 5.0973 6.19525 5.29094C6.07042 5.39634 6.02321 5.46681 6.00633 5.5ZM18 7.91726C17.7726 8.02403 17.5333 8.12123 17.2861 8.20951C15.8856 8.70968 14.0166 9 12 9C9.98341 9 8.1144 8.70968 6.71392 8.20951C6.46674 8.12123 6.22738 8.02403 6 7.91726V11.9866C6.00813 12.0073 6.03931 12.0661 6.14259 12.1624C6.31976 12.3277 6.63181 12.5252 7.10609 12.7189C8.04837 13.1039 9.43027 13.3932 11.051 13.476C11.6026 13.5042 12.0269 13.9741 11.9987 14.5257C11.9705 15.0773 11.5005 15.5016 10.949 15.4734C9.17744 15.3829 7.55934 15.0646 6.34969 14.5704C6.23097 14.5219 6.11419 14.4709 6 14.4173V18.4866C6.00813 18.5073 6.03931 18.5661 6.14259 18.6624C6.31976 18.8277 6.63181 19.0252 7.10609 19.2189C8.04837 19.6039 9.43027 19.8932 11.051 19.976C11.6026 20.0042 12.0269 20.4741 11.9987 21.0257C11.9705 21.5773 11.5005 22.0016 10.949 21.9734C9.17744 21.8829 7.55934 21.5646 6.34969 21.0704C5.74801 20.8246 5.19611 20.5146 4.77833 20.1249C4.35948 19.7341 4 19.1866 4 18.5V5.5C4 4.74631 4.43048 4.16346 4.90494 3.76283C5.38405 3.35829 6.01803 3.03902 6.71392 2.79049C8.1144 2.29032 9.98341 2 12 2C14.0166 2 15.8856 2.29032 17.2861 2.79049C17.982 3.03902 18.616 3.35829 19.0951 3.76283C19.5695 4.16346 20 4.74631 20 5.5V10C20 10.5523 19.5523 11 19 11C18.4477 11 18 10.5523 18 10V7.91726ZM17.5 13C18.0523 13 18.5 13.4477 18.5 14V14.6707C18.851 14.7948 19.172 14.9823 19.4492 15.2195L20.0308 14.8837C20.5091 14.6075 21.1207 14.7714 21.3968 15.2497C21.673 15.728 21.5091 16.3396 21.0308 16.6157L20.4499 16.9511C20.4828 17.1291 20.5 17.3125 20.5 17.5C20.5 17.6873 20.4828 17.8707 20.45 18.0485L21.0308 18.3838C21.5091 18.6599 21.6729 19.2715 21.3968 19.7498C21.1206 20.2281 20.5091 20.392 20.0308 20.1158L19.4495 19.7803C19.1722 20.0176 18.8511 20.2052 18.5 20.3293V21C18.5 21.5523 18.0523 22 17.5 22C16.9477 22 16.5 21.5523 16.5 21V20.3293C16.1489 20.2052 15.8277 20.0176 15.5504 19.7802L14.969 20.1159C14.4907 20.392 13.8791 20.2282 13.603 19.7499C13.3269 19.2716 13.4907 18.66 13.969 18.3839L14.55 18.0484C14.5172 17.8706 14.5 17.6873 14.5 17.5C14.5 17.3127 14.5172 17.1294 14.55 16.9515L13.9691 16.6161C13.4908 16.34 13.3269 15.7284 13.6031 15.2501C13.8792 14.7718 14.4908 14.608 14.9691 14.8841L15.5504 15.2197C15.8278 14.9824 16.1489 14.7948 16.5 14.6707V14C16.5 13.4477 16.9477 13 17.5 13ZM16.624 17.0174C16.6274 17.0117 16.6308 17.0059 16.6342 17.0001C16.6374 16.9946 16.6405 16.989 16.6436 16.9834C16.8187 16.6937 17.1367 16.5 17.5 16.5C17.8645 16.5 18.1835 16.6951 18.3583 16.9865C18.3607 16.9909 18.3632 16.9953 18.3658 16.9997C18.3685 17.0044 18.3713 17.0091 18.3741 17.0138C18.4543 17.1577 18.5 17.3235 18.5 17.5C18.5 17.6737 18.4557 17.8371 18.3778 17.9794C18.3737 17.9861 18.3697 17.9929 18.3657 17.9998C18.3619 18.0064 18.3581 18.0131 18.3545 18.0198C18.1789 18.3077 17.8619 18.5 17.5 18.5C17.1362 18.5 16.8178 18.3058 16.6428 18.0154C16.64 18.0102 16.6371 18.005 16.6341 17.9999C16.631 17.9945 16.6278 17.9891 16.6246 17.9838C16.5452 17.8404 16.5 17.6755 16.5 17.5C16.5 17.325 16.545 17.1605 16.624 17.0174Z",fill:"currentColor"})})}function sc({className:e}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z",fill:"currentColor"})})}function ac({className:e}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})}function rc({className:e="m-auto",size:t=20,color:n="currentColor",bgOpacity:a=.1,speed:r=.75}){const o={"--spinner-speed":`${r}s`};return s.jsxs("svg",{className:di(e,"spinner"),width:t,height:t,viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",style:o,children:[s.jsx("defs",{children:s.jsx("style",{type:"text/css",children:"\n          .spinner {\n            transform-origin: center;\n            overflow: visible;\n            animation: spinner-rotate var(--spinner-speed) linear infinite;\n          }\n          @keyframes spinner-rotate {\n            to { transform: rotate(360deg); }\n          }\n        "})}),s.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeOpacity:a}),s.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeDasharray:"25 75",strokeLinecap:"round"})]})}function oc({className:e="icon-md-heavy",size:t="1em"}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di(e),children:s.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z",clipRule:"evenodd"})})}function ic({className:e=""}){return s.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di("h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.0633 5.67375C18.5196 5.98487 18.6374 6.607 18.3262 7.06331L10.8262 18.0633C10.6585 18.3093 10.3898 18.4678 10.0934 18.4956C9.79688 18.5234 9.50345 18.4176 9.29289 18.2071L4.79289 13.7071C4.40237 13.3166 4.40237 12.6834 4.79289 12.2929C5.18342 11.9023 5.81658 11.9023 6.20711 12.2929L9.85368 15.9394L16.6738 5.93664C16.9849 5.48033 17.607 5.36263 18.0633 5.67375Z",fill:"currentColor"})})}function lc({className:e=""}){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di(e,"h-4 w-4"),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function cc({size:e=25,className:t=""}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:di("lucide lucide-bot",t),children:[s.jsx("path",{d:"M12 8V4H8"}),s.jsx("rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}),s.jsx("path",{d:"M2 14h2"}),s.jsx("path",{d:"M20 14h2"}),s.jsx("path",{d:"M15 13v2"}),s.jsx("path",{d:"M9 13v2"})]})}function dc({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor","aria-hidden":"true",className:di("h-6 w-6",e),children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"})})}function uc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 7C9 4.23858 11.2386 2 14 2C16.7614 2 19 4.23858 19 7V15C19 18.866 15.866 22 12 22C8.13401 22 5 18.866 5 15V9C5 8.44772 5.44772 8 6 8C6.55228 8 7 8.44772 7 9V15C7 17.7614 9.23858 20 12 20C14.7614 20 17 17.7614 17 15V7C17 5.34315 15.6569 4 14 4C12.3431 4 11 5.34315 11 7V15C11 15.5523 11.4477 16 12 16C12.5523 16 13 15.5523 13 15V9C13 8.44772 13.4477 8 14 8C14.5523 8 15 8.44772 15 9V15C15 16.6569 13.6569 18 12 18C10.3431 18 9 16.6569 9 15V7Z",fill:"currentColor"})})}function mc({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:di(e??"","lucide lucide-messages-square"),children:[s.jsx("path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"}),s.jsx("path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"})]})}function pc({className:e="",size:t="1em"}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di("icon-md-heavy",e),children:s.jsx("path",{fill:"currentColor",d:"M3.07 10.876C3.623 6.436 7.41 3 12 3a9.15 9.15 0 0 1 6.012 2.254V4a1 1 0 1 1 2 0v4a1 1 0 0 1-1 1H15a1 1 0 1 1 0-2h1.957A7.15 7.15 0 0 0 12 5a7 7 0 0 0-6.946 6.124 1 1 0 1 1-1.984-.248m16.992 1.132a1 1 0 0 1 .868 1.116C20.377 17.564 16.59 21 12 21a9.15 9.15 0 0 1-6-2.244V20a1 1 0 1 1-2 0v-4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H7.043A7.15 7.15 0 0 0 12 19a7 7 0 0 0 6.946-6.124 1 1 0 0 1 1.116-.868"})})}function fc({className:e=""}){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di("h-3 w-3 -rotate-180",e),height:"19",width:"19",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("polygon",{points:"11 19 2 12 11 5 11 19"}),s.jsx("polygon",{points:"22 19 13 12 22 5 22 19"})]})}function hc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",id:"google",className:"h-5 w-5",children:[s.jsx("path",{fill:"#fbbb00",d:"M113.47 309.408 95.648 375.94l-65.139 1.378C11.042 341.211 0 299.9 0 256c0-42.451 10.324-82.483 28.624-117.732h.014L86.63 148.9l25.404 57.644c-5.317 15.501-8.215 32.141-8.215 49.456.002 18.792 3.406 36.797 9.651 53.408z"}),s.jsx("path",{fill:"#518ef8",d:"M507.527 208.176C510.467 223.662 512 239.655 512 256c0 18.328-1.927 36.206-5.598 53.451-12.462 58.683-45.025 109.925-90.134 146.187l-.014-.014-73.044-3.727-10.338-64.535c29.932-17.554 53.324-45.025 65.646-77.911h-136.89V208.176h245.899z"}),s.jsx("path",{fill:"#28b446",d:"m416.253 455.624.014.014C372.396 490.901 316.666 512 256 512c-97.491 0-182.252-54.491-225.491-134.681l82.961-67.91c21.619 57.698 77.278 98.771 142.53 98.771 28.047 0 54.323-7.582 76.87-20.818l83.383 68.262z"}),s.jsx("path",{fill:"#f14336",d:"m419.404 58.936-82.933 67.896C313.136 112.246 285.552 103.82 256 103.82c-66.729 0-123.429 42.957-143.965 102.724l-83.397-68.276h-.014C71.23 56.123 157.06 0 256 0c62.115 0 119.068 22.126 163.404 58.936z"})]})}function gc(){return s.jsxs("svg",{viewBox:"0 0 40 40",width:"25",height:"25",children:[s.jsxs("linearGradient",{id:"a",x1:-277.375,x2:-277.375,y1:406.602,y2:407.573,gradientTransform:"matrix(40 0 0 -39.7778 11115.001 16212.334)",gradientUnits:"userSpaceOnUse",children:[s.jsx("stop",{offset:0,stopColor:"#0062e0"}),s.jsx("stop",{offset:1,stopColor:"#19afff"})]}),s.jsx("path",{fill:"url(#a)",d:"M16.7 39.8C7.2 38.1 0 29.9 0 20 0 9 9 0 20 0s20 9 20 20c0 9.9-7.2 18.1-16.7 19.8l-1.1-.9h-4.4l-1.1.9z"}),s.jsx("path",{fill:"#fff",d:"m27.8 25.6.9-5.6h-5.3v-3.9c0-1.6.6-2.8 3-2.8H29V8.2c-1.4-.2-3-.4-4.4-.4-4.6 0-7.8 2.8-7.8 7.8V20h-5v5.6h5v14.1c1.1.2 2.2.3 3.3.3 1.1 0 2.2-.1 3.3-.3V25.6h4.4z"})]})}function xc(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",id:"openid",className:"h-5 w-5",children:s.jsx("path",{fill:"currentColor",d:"M271.5 432l-68 32C88.5 453.7 0 392.5 0 318.2c0-71.5 82.5-131 191.7-144.3v43c-71.5 12.5-124 53-124 101.3 0 51 58.5 93.3 135.7 103v-340l68-33.2v384zM448 291l-131.3-28.5 36.8-20.7c-19.5-11.5-43.5-20-70-24.8v-43c46.2 5.5 87.7 19.5 120.3 39.3l35-19.8L448 291z"})})}function vc(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"none",children:s.jsx("path",{fill:"currentColor",d:"M12 0a12 12 0 0 0-3.84 23.399c.608.112.832-.256.832-.576v-2.015c-3.395.736-4.115-1.632-4.115-1.632a3.241 3.241 0 0 0-1.359-1.792c-1.104-.736.064-.736.064-.736a2.566 2.566 0 0 1 1.824 1.216a2.638 2.638 0 0 0 3.616 1.024a2.607 2.607 0 0 1 .768-1.6c-2.688-.32-5.504-1.344-5.504-5.984a4.677 4.677 0 0 1 1.216-3.168a4.383 4.383 0 0 1 .128-3.136s1.024-.32 3.36 1.216a11.66 11.66 0 0 1 6.112 0c2.336-1.536 3.36-1.216 3.36-1.216a4.354 4.354 0 0 1 .128 3.136a4.628 4.628 0 0 1 1.216 3.168c0 4.672-2.848 5.664-5.536 5.952a2.881 2.881 0 0 1 .832 2.24v3.36c0 .32.224.672.832.576A12 12 0 0 0 12 0z"})})}function bc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",id:"discord",className:"h-6 w-6",children:[s.jsx("circle",{cx:"512",cy:"512",r:"512",fill:"#5865f2"}),s.jsx("path",{fill:"#fff",d:"M689.43 349a422.21 422.21 0 0 0-104.22-32.32 1.58 1.58 0 0 0-1.68.79 294.11 294.11 0 0 0-13 26.66 389.78 389.78 0 0 0-117.05 0 269.75 269.75 0 0 0-13.18-26.66 1.64 1.64 0 0 0-1.68-.79A421 421 0 0 0 334.44 349a1.49 1.49 0 0 0-.69.59c-66.37 99.17-84.55 195.9-75.63 291.41a1.76 1.76 0 0 0 .67 1.2 424.58 424.58 0 0 0 127.85 64.63 1.66 1.66 0 0 0 1.8-.59 303.45 303.45 0 0 0 26.15-42.54 1.62 1.62 0 0 0-.89-2.25 279.6 279.6 0 0 1-39.94-19 1.64 1.64 0 0 1-.16-2.72c2.68-2 5.37-4.1 7.93-6.22a1.58 1.58 0 0 1 1.65-.22c83.79 38.26 174.51 38.26 257.31 0a1.58 1.58 0 0 1 1.68.2c2.56 2.11 5.25 4.23 8 6.24a1.64 1.64 0 0 1-.14 2.72 262.37 262.37 0 0 1-40 19 1.63 1.63 0 0 0-.87 2.28 340.72 340.72 0 0 0 26.13 42.52 1.62 1.62 0 0 0 1.8.61 423.17 423.17 0 0 0 128-64.63 1.64 1.64 0 0 0 .67-1.18c10.68-110.44-17.88-206.38-75.7-291.42a1.3 1.3 0 0 0-.63-.63zM427.09 582.85c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.02 28.44-20.37 51.6-46 51.6zm170.13 0c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.01 28.44-20.17 51.6-46 51.6z"})]})}function _c(){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 814 1000",id:"apple",className:"h-6 w-6",children:s.jsx("path",{d:"M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 790.7 0 663 0 541.8c0-194.4 126.4-297.5 250.8-297.5 66.1 0 121.2 43.4 162.7 43.4 39.5 0 101.1-46 176.3-46 28.5 0 130.9 2.6 198.3 99.2zm-234-181.5c31.1-36.9 53.1-88.1 53.1-139.3 0-7.1-.6-14.3-1.9-20.1-50.6 1.9-110.8 33.7-147.1 75.8-28.5 32.4-55.1 83.6-55.1 135.5 0 7.8 1.3 15.6 1.9 18.1 3.2.6 8.4 1.3 13.6 1.3 45.4 0 102.5-30.4 135.5-71.3z",fill:"currentColor"})})}function yc(){return s.jsx("svg",{width:"800px",height:"800px",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"h-5 w-5",children:s.jsxs("g",{fill:"#000000",children:[s.jsx("path",{d:"M7.754 2l.463.41c.343.304.687.607 1.026.915C11.44 5.32 13.3 7.565 14.7 10.149c.072.132.137.268.202.403l.098.203-.108.057-.081-.115-.21-.299-.147-.214c-1.019-1.479-2.04-2.96-3.442-4.145a6.563 6.563 0 00-1.393-.904c-1.014-.485-1.916-.291-2.69.505-.736.757-1.118 1.697-1.463 2.653-.045.123-.092.245-.139.367l-.082.215-.172-.055c.1-.348.192-.698.284-1.049.21-.795.42-1.59.712-2.356.31-.816.702-1.603 1.093-2.39.169-.341.338-.682.5-1.025h.092z"}),s.jsx("path",{d:"M8.448 11.822c-1.626.77-5.56 1.564-7.426 1.36C.717 11.576 3.71 4.05 5.18 2.91l-.095.218a4.638 4.638 0 01-.138.303l-.066.129c-.76 1.462-1.519 2.926-1.908 4.53a7.482 7.482 0 00-.228 1.689c-.01 1.34.824 2.252 2.217 2.309.67.027 1.347-.043 2.023-.114.294-.03.587-.061.88-.084.108-.008.214-.021.352-.039l.231-.028z"}),s.jsx("path",{d:"M3.825 14.781c-.445.034-.89.068-1.333.108 4.097.39 8.03-.277 11.91-1.644-1.265-2.23-2.97-3.991-4.952-5.522.026.098.084.169.141.239l.048.06c.17.226.348.448.527.67.409.509.818 1.018 1.126 1.578.778 1.42.356 2.648-1.168 3.296-1.002.427-2.097.718-3.18.892-1.03.164-2.075.243-3.119.323z"})]})})}function jc({size:e=25,className:t=""}){return s.jsxs("svg",{viewBox:"0 0 24 16",overflow:"visible",width:e,height:e,className:di("fill-current text-black",t),children:[s.jsx("g",{style:{transform:"translateX(13px) rotateZ(0deg)",transformOrigin:"4.775px 7.73501px"},children:s.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M0,0 C0,0 6.1677093505859375,15.470022201538086 6.1677093505859375,15.470022201538086 C6.1677093505859375,15.470022201538086 9.550004005432129,15.470022201538086 9.550004005432129,15.470022201538086 C9.550004005432129,15.470022201538086 3.382294178009033,0 3.382294178009033,0 C3.382294178009033,0 0,0 0,0 C0,0 0,0 0,0z"})}),s.jsx("g",{style:{transform:"none",transformOrigin:"7.935px 7.73501px"},opacity:"1",children:s.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 7.93500280380249,3.911694288253784 7.93500280380249,3.911694288253784 C7.93500280380249,3.911694288253784 10.045400619506836,9.348296165466309 10.045400619506836,9.348296165466309 C10.045400619506836,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309z M6.166755199432373,0 C6.166755199432373,0 0,15.470022201538086 0,15.470022201538086 C0,15.470022201538086 3.4480772018432617,15.470022201538086 3.4480772018432617,15.470022201538086 C3.4480772018432617,15.470022201538086 4.709278583526611,12.22130012512207 4.709278583526611,12.22130012512207 C4.709278583526611,12.22130012512207 11.16093635559082,12.22130012512207 11.16093635559082,12.22130012512207 C11.16093635559082,12.22130012512207 12.421928405761719,15.470022201538086 12.421928405761719,15.470022201538086 C12.421928405761719,15.470022201538086 15.87000560760498,15.470022201538086 15.87000560760498,15.470022201538086 C15.87000560760498,15.470022201538086 9.703250885009766,0 9.703250885009766,0 C9.703250885009766,0 6.166755199432373,0 6.166755199432373,0 C6.166755199432373,0 6.166755199432373,0 6.166755199432373,0z"})})]})}function wc({size:e=24,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",className:di("text-white dark:text-black",t),children:s.jsx("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function Nc(){return s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 5C14.4477 5 14 4.55228 14 4C14 3.44772 14.4477 3 15 3H20C20.5523 3 21 3.44772 21 4V9C21 9.55228 20.5523 10 20 10C19.4477 10 19 9.55228 19 9V6.41421L13.7071 11.7071C13.3166 12.0976 12.6834 12.0976 12.2929 11.7071C11.9024 11.3166 11.9024 10.6834 12.2929 10.2929L17.5858 5H15ZM4 7C4 5.34315 5.34315 4 7 4H10C10.5523 4 11 4.44772 11 5C11 5.55228 10.5523 6 10 6H7C6.44772 6 6 6.44772 6 7V17C6 17.5523 6.44772 18 7 18H17C17.5523 18 18 17.5523 18 17V14C18 13.4477 18.4477 13 19 13C19.5523 13 20 13.4477 20 14V17C20 18.6569 18.6569 20 17 20H7C5.34315 20 4 18.6569 4 17V7Z",fill:"currentColor"})})}const Cc=({className:e=""})=>s.jsxs("svg",{className:e,width:"17",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),s.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]});function kc({unpin:e=!1}){return e?s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[s.jsx("path",{d:"M15 15V17.5585C15 18.4193 14.4491 19.1836 13.6325 19.4558L13.1726 19.6091C12.454 19.8487 11.6616 19.6616 11.126 19.126L4.87403 12.874C4.33837 12.3384 4.15132 11.546 4.39088 10.8274L4.54415 10.3675C4.81638 9.55086 5.58066 9 6.44152 9H9M12 6.2L13.6277 3.92116C14.3461 2.91549 15.7955 2.79552 16.6694 3.66942L20.3306 7.33058C21.2045 8.20448 21.0845 9.65392 20.0788 10.3723L18 11.8571",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M8 16L3 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M4 4L20 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):s.jsx("svg",{className:"icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.4845 2.8798C16.1773 1.57258 14.0107 1.74534 12.9272 3.24318L9.79772 7.56923C9.60945 7.82948 9.30775 7.9836 8.98654 7.9836H6.44673C3.74061 7.9836 2.27414 11.6759 4.16948 13.5713L6.59116 15.993L2.29324 20.2909C1.90225 20.6819 1.90225 21.3158 2.29324 21.7068C2.68422 22.0977 3.31812 22.0977 3.70911 21.7068L8.00703 17.4088L10.4287 19.8305C12.3241 21.7259 16.0164 20.2594 16.0164 17.5533V15.0135C16.0164 14.6923 16.1705 14.3906 16.4308 14.2023L20.7568 11.0728C22.2547 9.98926 22.4274 7.8227 21.1202 6.51549L17.4845 2.8798ZM11.8446 18.4147C12.4994 19.0694 14.0141 18.4928 14.0141 17.5533V15.0135C14.0141 14.0499 14.4764 13.1447 15.2572 12.58L19.5832 9.45047C20.0825 9.08928 20.1401 8.3671 19.7043 7.93136L16.0686 4.29567C15.6329 3.85993 14.9107 3.91751 14.5495 4.4168L11.4201 8.74285C10.8553 9.52359 9.95016 9.98594 8.98654 9.98594H6.44673C5.5072 9.98594 4.93059 11.5006 5.58535 12.1554L11.8446 18.4147Z",fill:"currentColor"})})}function Sc({className:e=""}){return s.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di("icon-md h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z",fill:"currentColor"})})}function Tc({size:e,className:t="icon-md"}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.4646 19C15.2219 20.6961 13.7632 22 12 22C10.2368 22 8.77806 20.6961 8.53544 19H6C4.34315 19 3 17.6569 3 16V13.5C3 12.9477 3.44772 12.5 4 12.5H4.5C5.32843 12.5 6 11.8284 6 11C6 10.1716 5.32843 9.5 4.5 9.5H4C3.44772 9.5 3 9.05229 3 8.5L3 6C3 4.34315 4.34315 3 6 3L18 3C19.6569 3 21 4.34315 21 6L21 16C21 17.6569 19.6569 19 18 19H15.4646ZM12 20C12.8284 20 13.5 19.3284 13.5 18.5V18C13.5 17.4477 13.9477 17 14.5 17H18C18.5523 17 19 16.5523 19 16L19 6C19 5.44772 18.5523 5 18 5L6 5C5.44772 5 5 5.44772 5 6V7.53544C6.69615 7.77806 8 9.23676 8 11C8 12.7632 6.69615 14.2219 5 14.4646L5 16C5 16.5523 5.44771 17 6 17H9.5C10.0523 17 10.5 17.4477 10.5 18V18.5C10.5 19.3284 11.1716 20 12 20Z",fill:"currentColor"})})}function Ec({size:e=25,className:t="h-4 w-4"}){const n=e,a=e;return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:di(t,""),width:a,height:n,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"m8.0458 0.81981a1.1197 1.1197 0 0 0-1.0608 0.76184l-6.7912 20.123a1.1178 1.1178 0 0 0 1.0592 1.4751h5.4647a1.1197 1.1197 0 0 0 1.0608-0.7615l1.3528-4.0084-2.3684-2.2107a0.51536 0.51536 0 0 1 0.35193-0.8923h3.0639l1.8213-5.3966-2.8111-8.3294a1.1181 1.1181 0 0 0-1.0595-0.76049h-0.0836z"}),s.jsx("path",{d:"m7.1147 15.307a0.51536 0.51536 0 0 0-0.35193 0.8923l7.1552 6.6782a1.1248 1.1248 0 0 0 0.76724 0.30238h0.2417a1.1181 1.1181 0 0 0 1.0534-1.4755l-2.1591-6.3974z"}),s.jsx("path",{d:"m17.015 1.5807a1.1178 1.1178 0 0 0-1.0593-0.76049h-7.8258a1.1181 1.1181 0 0 1 1.0593 0.76049l6.7916 20.123a1.1181 1.1181 0 0 1-1.0593 1.4757h7.8261a1.1181 1.1181 0 0 0 1.059-1.4757z"})]})}function Rc({className:e="h-4 w-4"}){return s.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"1",viewBox:"0 0 40 40",strokeLinecap:"round",strokeLinejoin:"round",className:e,height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z"})})}function Ic({size:e=25,className:t=""}){return s.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 19 17",fill:"none",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[s.jsx("path",{d:"M9.62674 16.2202H9.7049C10.4225 16.2202 11.0016 15.6412 11.0016 14.9236V4.04224H8.33008V14.92C8.33008 15.6376 8.90914 16.2202 9.62674 16.2202Z",fill:"#F9AB00"}),s.jsx("path",{d:"M14.6819 8.02813C13.3249 6.66752 11.2964 6.39398 9.66577 7.2004L15.0585 12.5931C15.2823 12.8169 15.6624 12.7281 15.7583 12.4297C16.2308 10.927 15.8756 9.21822 14.6819 8.02813Z",fill:"#5BB974"}),s.jsx("path",{d:"M4.64953 8.02813C6.00659 6.66752 8.03507 6.39398 9.66567 7.2004L4.27297 12.5931C4.04916 12.8169 3.66904 12.7281 3.57312 12.4297C3.10064 10.927 3.45589 9.21822 4.64953 8.02813Z",fill:"#129EAF"}),s.jsx("path",{d:"M14.284 3.84326C12.1383 3.84326 10.3159 5.25005 9.66577 7.20038H18.1918C18.5399 7.20038 18.7744 6.83092 18.6145 6.5183C17.8081 4.93033 16.1704 3.84326 14.284 3.84326Z",fill:"#AF5CF7"}),s.jsx("path",{d:"M10.5574 1.55901C9.04053 3.07593 8.74567 5.36019 9.66577 7.20039L15.6944 1.17179C15.943 0.923113 15.8436 0.496814 15.5132 0.390239C13.8151 -0.1604 11.8896 0.226822 10.5574 1.55901Z",fill:"#FF8BCB"}),s.jsx("path",{d:"M8.77408 1.55901C10.291 3.07593 10.5859 5.36019 9.66576 7.20039L3.63716 1.17179C3.38848 0.923113 3.48795 0.496814 3.81833 0.390239C5.51643 -0.1604 7.44189 0.226822 8.77408 1.55901Z",fill:"#FA7B17"}),s.jsx("path",{d:"M5.04752 3.84326C7.19323 3.84326 9.01566 5.25005 9.66577 7.20038H1.13976C0.791616 7.20038 0.55715 6.83092 0.717013 6.5183C1.52343 4.93033 3.16114 3.84326 5.04752 3.84326Z",fill:"#4285F4"})]})}function Pc({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,className:di("dark:fill-white",t),viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:s.jsx("path",{d:"M2 4.006C2 2.898 2.897 2 4.006 2h9.988C15.102 2 16 2.897 16 4.006v9.988A2.005 2.005 0 0 1 13.994 16H4.006A2.005 2.005 0 0 1 2 13.994V4.006zM13.992 9l.003-.003L10.997 6 9.75 7.247 11.503 9 9.75 10.753 10.997 12l2.997-2.997L13.992 9zm-9.99 0L4 8.997 6.997 6l1.247 1.247L6.492 9l1.753 1.753L6.997 12 4 9.003 4.003 9z",fillRule:"evenodd"})})}function Ac({size:e=25,className:t=""}){return s.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[s.jsx("path",{fill:"url(#_4rif_paint0_radial_897_42)",d:"M9 18c0-1.245-.24-2.415-.72-3.51a8.934 8.934 0 00-1.912-2.857A8.934 8.934 0 003.51 9.72 8.646 8.646 0 000 9a8.886 8.886 0 003.51-.697 9.247 9.247 0 002.857-1.936A8.934 8.934 0 008.28 3.51C8.76 2.415 9 1.245 9 0c0 1.245.232 2.415.697 3.51a9.247 9.247 0 001.936 2.857 9.247 9.247 0 002.857 1.936A8.886 8.886 0 0018 9c-1.245 0-2.415.24-3.51.72a8.934 8.934 0 00-2.857 1.912 9.247 9.247 0 00-1.935 2.858A8.886 8.886 0 009 18z"}),s.jsx("defs",{children:s.jsxs("radialGradient",{id:"_4rif_paint0_radial_897_42",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"rotate(135 9 3.728) scale(25.4558 12.7279)",children:[s.jsx("stop",{offset:".325",stopColor:"#FFDDB7"}),s.jsx("stop",{offset:".706",stopColor:"#076EFF"})]})})]})}function Mc({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",width:"800px",height:"800px",viewBox:"0 0 512 512",className:di("h-4 w-4",e),children:s.jsx("path",{d:"M473.16,221.48l-2.26-9.59H262.46v88.22H387c-12.93,61.4-72.93,93.72-121.94,93.72-35.66,0-73.25-15-98.13-39.11a140.08,140.08,0,0,1-41.8-98.88c0-37.16,16.7-74.33,41-98.78s61-38.13,97.49-38.13c41.79,0,71.74,22.19,82.94,32.31l62.69-62.36C390.86,72.72,340.34,32,261.6,32h0c-60.75,0-119,23.27-161.58,65.71C58,139.5,36.25,199.93,36.25,256S56.83,369.48,97.55,411.6C141.06,456.52,202.68,480,266.13,480c57.73,0,112.45-22.62,151.45-63.66,38.34-40.4,58.17-96.3,58.17-154.9C475.75,236.77,473.27,222.12,473.16,221.48Z"})})}function Lc({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:di(e),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),s.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),s.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function Oc({className:e="",size:t="1em"}){return s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:di(e),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 4.9099C11 4.47485 10.4828 4.24734 10.1621 4.54132L6.67572 7.7372C6.49129 7.90626 6.25019 8.00005 6 8.00005H4C3.44772 8.00005 3 8.44776 3 9.00005V15C3 15.5523 3.44772 16 4 16H6C6.25019 16 6.49129 16.0938 6.67572 16.2629L10.1621 19.4588C10.4828 19.7527 11 19.5252 11 19.0902V4.9099ZM8.81069 3.06701C10.4142 1.59714 13 2.73463 13 4.9099V19.0902C13 21.2655 10.4142 22.403 8.81069 20.9331L5.61102 18H4C2.34315 18 1 16.6569 1 15V9.00005C1 7.34319 2.34315 6.00005 4 6.00005H5.61102L8.81069 3.06701ZM20.3166 6.35665C20.8019 6.09313 21.409 6.27296 21.6725 6.75833C22.5191 8.3176 22.9996 10.1042 22.9996 12.0001C22.9996 13.8507 22.5418 15.5974 21.7323 17.1302C21.4744 17.6185 20.8695 17.8054 20.3811 17.5475C19.8927 17.2896 19.7059 16.6846 19.9638 16.1962C20.6249 14.9444 20.9996 13.5175 20.9996 12.0001C20.9996 10.4458 20.6064 8.98627 19.9149 7.71262C19.6514 7.22726 19.8312 6.62017 20.3166 6.35665ZM15.7994 7.90049C16.241 7.5688 16.8679 7.65789 17.1995 8.09947C18.0156 9.18593 18.4996 10.5379 18.4996 12.0001C18.4996 13.3127 18.1094 14.5372 17.4385 15.5604C17.1357 16.0222 16.5158 16.1511 16.0539 15.8483C15.5921 15.5455 15.4632 14.9255 15.766 14.4637C16.2298 13.7564 16.4996 12.9113 16.4996 12.0001C16.4996 10.9859 16.1653 10.0526 15.6004 9.30063C15.2687 8.85905 15.3578 8.23218 15.7994 7.90049Z",fill:"currentColor"})})}function Dc({className:e="",size:t="1em"}){return s.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:di(e),children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM9.5 8.5C8.94772 8.5 8.5 8.94772 8.5 9.5V14.5C8.5 15.0523 8.94772 15.5 9.5 15.5H14.5C15.0523 15.5 15.5 15.0523 15.5 14.5V9.5C15.5 8.94772 15.0523 8.5 14.5 8.5H9.5Z",fill:"currentColor"})})}function Fc(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}function zc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:di("text-black dark:text-white",e),"aria-hidden":!0,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})}function Uc({className:e=""}){return s.jsxs("svg",{version:"1.1",viewBox:"0 0 233.33 290",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:di("h-9 w-9",e),children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"linearGradient1842",x1:"163.92",x2:"173.66",y1:"22.212",y2:"-6.5784",gradientTransform:"translate(.10391 .050143)",gradientUnits:"userSpaceOnUse",children:[s.jsx("stop",{stopColor:"#640a62",offset:"0"}),s.jsx("stop",{stopColor:"#852283",offset:".49917"}),s.jsx("stop",{stopColor:"#640a62",offset:"1"})]})}),s.jsxs("g",{children:[s.jsx("path",{transform:"matrix(.43416 .90084 -.89966 .4366 0 0)",d:"m259.29-126.03a232.2 237.56 0 0 1-17.412 231.34l-193.32-131.59z",fill:"url(#linearGradient1842)"}),s.jsx("path",{transform:"matrix(.6967 .051926 -.051926 .6967 35.578 23.196)",d:"m50.818 31.415c-1.4654 2.4749-10.838 2.4195-12.997 4.3204-2.1584 1.9009-3.288 11.206-5.9282 12.347-2.6402 1.1409-10.191-4.4132-13.054-4.1441-2.8636 0.26917-9.2466 7.133-12.053 6.5041-2.8066-0.62889-5.6503-9.5602-8.1252-11.026-2.4749-1.4654-11.673 0.33572-13.574-1.8227s1.0482-11.056-0.0927-13.696c-1.1409-2.6402-9.6412-6.5898-9.9104-9.4533-0.26917-2.8636 7.3463-8.328 7.9752-11.135 0.62889-2.8066-3.9265-10.998-2.4612-13.473 1.4654-2.4749 10.838-2.4195 12.997-4.3204 2.1584-1.9009 3.288-11.206 5.9282-12.347 2.6402-1.1409 10.191 4.4132 13.054 4.1441 2.8636-0.26917 9.2466-7.133 12.053-6.5041 2.8066 0.62889 5.6503 9.5602 8.1252 11.026s11.673-0.33572 13.574 1.8227c1.9009 2.1584-1.0482 11.056 0.0927 13.696 1.1409 2.6402 9.6412 6.5898 9.9104 9.4533 0.26917 2.8635-7.3463 8.328-7.9752 11.135-0.62889 2.8066 3.9265 10.998 2.4612 13.473z",fill:"#ff9d78",stroke:"#f29472",strokeWidth:"4.7877"}),s.jsx("circle",{cx:"170.36",cy:"215.76",r:"12.903",fill:"#cfffff"}),s.jsx("path",{d:"m220.77 174.77c-88.526 101.03-191.21 85.731-209.5 82.142-2.2101-2e-5 -2.6686 0.42426-3.437 2.0021l-1.7042 7.5028c0.056197 2.3603 0.37544 2.6428 1.9121 3.5409 18.396 3.3746 130.27 19.488 223.46-86.881 0.64011-1.5095 0.46653-3.1324-0.59137-4.7337l-5.1558-3.6482c-1.586-0.8743-3.9524-0.94332-4.9837 0.0751z",color:"#000000",fill:"#ff9d78",stroke:"#f29472",strokeLinejoin:"round",strokeWidth:"2.8913"}),s.jsxs("g",{fill:"#cfffff",children:[s.jsx("circle",{cx:"72.684",cy:"99.47",r:"12.903"}),s.jsx("circle",{cx:"99.144",cy:"172.32",r:"12.903"}),s.jsx("circle",{cx:"59.617",cy:"214.78",r:"12.903"}),s.jsx("circle",{cx:"135.4",cy:"118.42",r:"12.903"}),s.jsx("path",{transform:"rotate(38.66)",d:"m254.21-1.9608a12.903 12.903 0 0 1-6.4852 11.194 12.903 12.903 0 0 1-12.937-0.0582 12.903 12.903 0 0 1-6.3843-11.252l12.903 0.1161z"}),s.jsx("path",{d:"m29.476 158.16a12.903 12.903 0 0 0-3.6562 0.5293l-3.3691 23.189a12.903 12.903 0 0 0 7.0254 2.0879 12.903 12.903 0 0 0 12.904-12.904 12.903 12.903 0 0 0-12.904-12.902z"})]})]})]})}function Vc({className:e="",size:t="1em"}){return s.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:di("text-token-secondary h-2/3 w-2/3",e),xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),s.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),s.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}function Bc({className:e="",size:t=24}){return s.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:di("icon-md shrink-0",e),children:[s.jsx("path",{d:"M19.3975 1.35498C19.3746 1.15293 19.2037 1.00021 19.0004 1C18.7971 0.999793 18.6259 1.15217 18.6026 1.35417C18.4798 2.41894 18.1627 3.15692 17.6598 3.65983C17.1569 4.16274 16.4189 4.47983 15.3542 4.60264C15.1522 4.62593 14.9998 4.79707 15 5.00041C15.0002 5.20375 15.1529 5.37457 15.355 5.39746C16.4019 5.51605 17.1562 5.83304 17.6716 6.33906C18.1845 6.84269 18.5078 7.57998 18.6016 8.63539C18.6199 8.84195 18.7931 9.00023 19.0005 9C19.2078 8.99977 19.3806 8.84109 19.3985 8.6345C19.4883 7.59673 19.8114 6.84328 20.3273 6.32735C20.8433 5.81142 21.5967 5.48834 22.6345 5.39851C22.8411 5.38063 22.9998 5.20782 23 5.00045C23.0002 4.79308 22.842 4.61992 22.6354 4.60157C21.58 4.50782 20.8427 4.18447 20.3391 3.67157C19.833 3.15623 19.516 2.40192 19.3975 1.35498Z",fill:"currentColor"}),s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 3C11.4833 3 11.8974 3.34562 11.9839 3.82111C12.4637 6.46043 13.279 8.23983 14.5196 9.48039C15.7602 10.721 17.5396 11.5363 20.1789 12.0161C20.6544 12.1026 21 12.5167 21 13C21 13.4833 20.6544 13.8974 20.1789 13.9839C17.5396 14.4637 15.7602 15.279 14.5196 16.5196C13.279 17.7602 12.4637 19.5396 11.9839 22.1789C11.8974 22.6544 11.4833 23 11 23C10.5167 23 10.1026 22.6544 10.0161 22.1789C9.53625 19.5396 8.72096 17.7602 7.48039 16.5196C6.23983 15.279 4.46043 14.4637 1.82111 13.9839C1.34562 13.8974 1 13.4833 1 13C1 12.5167 1.34562 12.1026 1.82111 12.0161C4.46043 11.5363 6.23983 10.721 7.48039 9.48039C8.72096 8.23983 9.53625 6.46043 10.0161 3.82111C10.1026 3.34562 10.5167 3 11 3ZM5.66618 13C6.9247 13.5226 7.99788 14.2087 8.89461 15.1054C9.79134 16.0021 10.4774 17.0753 11 18.3338C11.5226 17.0753 12.2087 16.0021 13.1054 15.1054C14.0021 14.2087 15.0753 13.5226 16.3338 13C15.0753 12.4774 14.0021 11.7913 13.1054 10.8946C12.2087 9.99788 11.5226 8.9247 11 7.66618C10.4774 8.9247 9.79134 9.99788 8.89461 10.8946C7.99788 11.7913 6.9247 12.4774 5.66618 13Z",fill:"currentColor"})]})}function $c({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:di(e),children:[s.jsx("path",{d:"M2 10v3"}),s.jsx("path",{d:"M6 6v11"}),s.jsx("path",{d:"M10 3v18"}),s.jsx("path",{d:"M14 8v7"}),s.jsx("path",{d:"M18 5v13"}),s.jsx("path",{d:"M22 10v3"})]})}function Hc({size:e="1em",className:t}){return s.jsx("svg",{viewBox:"64 64 896 896",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,width:e,height:e,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"})})}function Gc({className:e="icon-md-heavy",size:t="1em"}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:di(e),children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.jsx("path",{d:"M12 17h.01"})]})}function Kc({size:e=25,className:t=""}){return s.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:di("fill-current text-black",t),children:s.jsx("g",{fill:"currentColor",children:s.jsx("path",{d:"M12,18.1397014 L9.574,18.9487014 L8.628,18.3177014 L9.658,17.9737014 L9.342,17.0257014 L7.574,17.6147014 L7,17.2327014 L7,14.4997014 C7,14.3107014 6.893,14.1377014 6.724,14.0527014 L5,13.1907014 L5,10.8087014 L6.5,10.0587014 L8,10.8087014 L8,12.4997014 C8,12.6897014 8.107,12.8627014 8.276,12.9477014 L10.276,13.9477014 L10.724,13.0527014 L9,12.1907014 L9,10.8087014 L10.724,9.94770136 C10.893,9.86270136 11,9.68970136 11,9.49970136 L11,7.99970136 L10,7.99970136 L10,9.19070136 L8.5,9.94070136 L7,9.19070136 L7,6.76770136 L8,6.10070136 L8,7.99970136 L9,7.99970136 L9,5.43470136 L9.574,5.05170136 L12,5.86070136 L12,18.1397014 Z M17.5,16.9997014 C17.775,16.9997014 18,17.2237014 18,17.4997014 C18,17.7757014 17.775,17.9997014 17.5,17.9997014 C17.225,17.9997014 17,17.7757014 17,17.4997014 C17,17.2237014 17.225,16.9997014 17.5,16.9997014 L17.5,16.9997014 Z M16.5,5.99970136 C16.775,5.99970136 17,6.22370136 17,6.49970136 C17,6.77570136 16.775,6.99970136 16.5,6.99970136 C16.225,6.99970136 16,6.77570136 16,6.49970136 C16,6.22370136 16.225,5.99970136 16.5,5.99970136 L16.5,5.99970136 Z M18.5,11.9997014 C18.775,11.9997014 19,12.2237014 19,12.4997014 C19,12.7757014 18.775,12.9997014 18.5,12.9997014 C18.225,12.9997014 18,12.7757014 18,12.4997014 C18,12.2237014 18.225,11.9997014 18.5,11.9997014 L18.5,11.9997014 Z M17.092,12.9997014 C17.299,13.5807014 17.849,13.9997014 18.5,13.9997014 C19.327,13.9997014 20,13.3277014 20,12.4997014 C20,11.6727014 19.327,10.9997014 18.5,10.9997014 C17.849,10.9997014 17.299,11.4197014 17.092,11.9997014 L13,11.9997014 L13,9.99970136 L16.5,9.99970136 C16.776,9.99970136 17,9.77670136 17,9.49970136 L17,7.90770136 C17.581,7.70070136 18,7.15070136 18,6.49970136 C18,5.67270136 17.327,4.99970136 16.5,4.99970136 C15.673,4.99970136 15,5.67270136 15,6.49970136 C15,7.15070136 15.419,7.70070136 16,7.90770136 L16,8.99970136 L13,8.99970136 L13,5.49970136 C13,5.28470136 12.862,5.09370136 12.658,5.02570136 L9.658,4.02570136 C9.511,3.97670136 9.351,3.99870136 9.223,4.08370136 L6.223,6.08370136 C6.084,6.17670136 6,6.33270136 6,6.49970136 L6,9.19070136 L4.276,10.0527014 C4.107,10.1377014 4,10.3107014 4,10.4997014 L4,13.4997014 C4,13.6897014 4.107,13.8627014 4.276,13.9477014 L6,14.8087014 L6,17.4997014 C6,17.6667014 6.084,17.8237014 6.223,17.9157014 L9.223,19.9157014 C9.306,19.9717014 9.402,19.9997014 9.5,19.9997014 C9.553,19.9997014 9.606,19.9917014 9.658,19.9737014 L12.658,18.9737014 C12.862,18.9067014 13,18.7157014 13,18.4997014 L13,15.9997014 L15.293,15.9997014 L16.146,16.8537014 L16.159,16.8407014 C16.061,17.0407014 16,17.2627014 16,17.4997014 C16,18.3267014 16.673,18.9997014 17.5,18.9997014 C18.327,18.9997014 19,18.3267014 19,17.4997014 C19,16.6727014 18.327,15.9997014 17.5,15.9997014 C17.262,15.9997014 17.04,16.0607014 16.841,16.1597014 L16.854,16.1467014 L15.854,15.1467014 C15.76,15.0527014 15.633,14.9997014 15.5,14.9997014 L13,14.9997014 L13,12.9997014 L17.092,12.9997014 Z"})})})}function Wc({className:e="",size:t="1em",bold:n=!1}){return n?s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[s.jsx("path",{d:"M12.592 2.50386C12.8047 2.13014 13.2317 1.935 13.652 2.01942C15.5627 2.40314 16.7246 4.36079 16.1516 6.23085L15.303 9L17.0142 9C19.6409 9 21.5485 11.5079 20.8574 14.0525L19.4994 19.0525C19.0267 20.7927 17.4526 22 15.6562 22H9.96721C8.869 21.9979 7.97939 21.1033 7.97939 20V9H8.31734C8.67472 9 9.0047 8.80771 9.18201 8.49613L12.592 2.50386Z",fill:"currentColor"}),s.jsx("path",{d:"M5.98763 9C4.33761 9 3 10.3431 3 12V19C3 20.6569 4.33761 22 5.98763 22H6.52055C6.18162 21.4116 5.98763 20.7286 5.98763 20V9Z",fill:"currentColor"})]}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.1318 2.50389C12.3321 2.15338 12.7235 1.95768 13.124 2.00775L13.5778 2.06447C16.0449 2.37286 17.636 4.83353 16.9048 7.20993L16.354 8.99999H17.0722C19.7097 8.99999 21.6253 11.5079 20.9313 14.0525L19.5677 19.0525C19.0931 20.7927 17.5124 22 15.7086 22H6C4.34315 22 3 20.6568 3 19V12C3 10.3431 4.34315 8.99999 6 8.99999H8C8.25952 8.99999 8.49914 8.86094 8.6279 8.63561L12.1318 2.50389ZM10 20H15.7086C16.6105 20 17.4008 19.3964 17.6381 18.5262L19.0018 13.5262C19.3488 12.2539 18.391 11 17.0722 11H15C14.6827 11 14.3841 10.8494 14.1956 10.5941C14.0071 10.3388 13.9509 10.0092 14.0442 9.70591L14.9932 6.62175C15.3384 5.49984 14.6484 4.34036 13.5319 4.08468L10.3644 9.62789C10.0522 10.1742 9.56691 10.5859 9 10.8098V19C9 19.5523 9.44772 20 10 20ZM7 11V19C7 19.3506 7.06015 19.6872 7.17071 20H6C5.44772 20 5 19.5523 5 19V12C5 11.4477 5.44772 11 6 11H7Z",fill:"currentColor"})})}function qc({className:e="",size:t="1em",bold:n=!1}){return n?s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[s.jsx("path",{d:"M11.4079 21.4961C11.1953 21.8698 10.7683 22.0649 10.348 21.9805C8.4373 21.5968 7.27541 19.6391 7.84844 17.7691L8.69697 14.9999L6.98577 14.9999C4.35915 14.9999 2.45151 12.492 3.14262 9.94747L4.50063 4.94747C4.97329 3.20722 6.54741 1.99994 8.34378 1.99994H14.0328C15.131 2.00207 16.0206 2.89668 16.0206 3.99994V14.9999H15.6827C15.3253 14.9999 14.9953 15.1922 14.818 15.5038L11.4079 21.4961Z",fill:"currentColor"}),s.jsx("path",{d:"M18.0124 14.9999C19.6624 14.9999 21 13.6568 21 11.9999V4.99994C21 3.34308 19.6624 1.99994 18.0124 1.99994H17.4794C17.8184 2.58829 18.0124 3.27136 18.0124 3.99994V14.9999Z",fill:"currentColor"})]}):s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.8727 21.4961C11.6725 21.8466 11.2811 22.0423 10.8805 21.9922L10.4267 21.9355C7.95958 21.6271 6.36855 19.1665 7.09975 16.7901L7.65054 15H6.93226C4.29476 15 2.37923 12.4921 3.0732 9.94753L4.43684 4.94753C4.91145 3.20728 6.49209 2 8.29589 2H18.0045C19.6614 2 21.0045 3.34315 21.0045 5V12C21.0045 13.6569 19.6614 15 18.0045 15H16.0045C15.745 15 15.5054 15.1391 15.3766 15.3644L11.8727 21.4961ZM14.0045 4H8.29589C7.39399 4 6.60367 4.60364 6.36637 5.47376L5.00273 10.4738C4.65574 11.746 5.61351 13 6.93226 13H9.00451C9.32185 13 9.62036 13.1506 9.8089 13.4059C9.99743 13.6612 10.0536 13.9908 9.96028 14.2941L9.01131 17.3782C8.6661 18.5002 9.35608 19.6596 10.4726 19.9153L13.6401 14.3721C13.9523 13.8258 14.4376 13.4141 15.0045 13.1902V5C15.0045 4.44772 14.5568 4 14.0045 4ZM17.0045 13V5C17.0045 4.64937 16.9444 4.31278 16.8338 4H18.0045C18.5568 4 19.0045 4.44772 19.0045 5V12C19.0045 12.5523 18.5568 13 18.0045 13H17.0045Z",fill:"currentColor"})})}function Qc({className:e=""}){return s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",fill:"currentColor",className:e,children:s.jsx("path",{d:"m3.005 8.858 8.783 12.544h3.904L6.908 8.858zM6.905 15.825 3 21.402h3.907l1.951-2.788zM16.585 2l-6.75 9.64 1.953 2.79L20.492 2zM17.292 7.965v13.437h3.2V3.395z"})})}function Yc({className:e=""}){return s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`icon-sm ${e}`,children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4C10.3431 4 9 5.34315 9 7C9 8.65685 10.3431 10 12 10C13.6569 10 15 8.65685 15 7C15 5.34315 13.6569 4 12 4ZM7 7C7 4.23858 9.23858 2 12 2C14.7614 2 17 4.23858 17 7C17 9.76142 14.7614 12 12 12C9.23858 12 7 9.76142 7 7ZM19.0277 15.6255C18.6859 15.5646 18.1941 15.6534 17.682 16.1829C17.4936 16.3777 17.2342 16.4877 16.9632 16.4877C16.6922 16.4877 16.4328 16.3777 16.2444 16.1829C15.7322 15.6534 15.2405 15.5646 14.8987 15.6255C14.5381 15.6897 14.2179 15.9384 14.0623 16.3275C13.8048 16.9713 13.9014 18.662 16.9632 20.4617C20.0249 18.662 20.1216 16.9713 19.864 16.3275C19.7084 15.9384 19.3882 15.6897 19.0277 15.6255ZM21.721 15.5847C22.5748 17.7191 21.2654 20.429 17.437 22.4892C17.1412 22.6484 16.7852 22.6484 16.4893 22.4892C12.6609 20.4291 11.3516 17.7191 12.2053 15.5847C12.6117 14.5689 13.4917 13.8446 14.5481 13.6565C15.3567 13.5125 16.2032 13.6915 16.9632 14.1924C17.7232 13.6915 18.5697 13.5125 19.3783 13.6565C20.4347 13.8446 21.3147 14.5689 21.721 15.5847ZM9.92597 14.2049C10.1345 14.7163 9.889 15.2999 9.3776 15.5084C7.06131 16.453 5.5 18.5813 5.5 20.9999C5.5 21.5522 5.05228 21.9999 4.5 21.9999C3.94772 21.9999 3.5 21.5522 3.5 20.9999C3.5 17.6777 5.641 14.8723 8.6224 13.6565C9.1338 13.448 9.71743 13.6935 9.92597 14.2049Z",fill:"currentColor"})})}function Xc({className:e}){return s.jsxs("svg",{width:"195",height:"195",viewBox:"0 2 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[s.jsx("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),s.jsx("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),s.jsx("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"})]})}function Zc({className:e}){return s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:e,"aria-label":"",children:s.jsx("path",{d:"M7.45996 14.375C7.45996 13.3616 6.63844 12.54 5.625 12.54C4.61156 12.54 3.79004 13.3616 3.79004 14.375C3.79004 15.3884 4.61156 16.21 5.625 16.21C6.63844 16.21 7.45996 15.3884 7.45996 14.375ZM16.21 14.375C16.21 13.3616 15.3884 12.54 14.375 12.54C13.3616 12.54 12.54 13.3616 12.54 14.375C12.54 15.3884 13.3616 16.21 14.375 16.21C15.3884 16.21 16.21 15.3884 16.21 14.375ZM7.45996 5.625C7.45996 4.61156 6.63844 3.79004 5.625 3.79004C4.61156 3.79004 3.79004 4.61156 3.79004 5.625C3.79004 6.63844 4.61156 7.45996 5.625 7.45996C6.63844 7.45996 7.45996 6.63844 7.45996 5.625ZM16.21 5.625C16.21 4.61156 15.3884 3.79004 14.375 3.79004C13.3616 3.79004 12.54 4.61156 12.54 5.625C12.54 6.63844 13.3616 7.45996 14.375 7.45996C15.3884 7.45996 16.21 6.63844 16.21 5.625ZM17.54 14.375C17.54 16.123 16.123 17.54 14.375 17.54C12.627 17.54 11.21 16.123 11.21 14.375C11.21 12.627 12.627 11.21 14.375 11.21C16.123 11.21 17.54 12.627 17.54 14.375ZM8.79004 5.625C8.79004 7.37298 7.37298 8.79004 5.625 8.79004C3.87702 8.79004 2.45996 7.37298 2.45996 5.625C2.45996 3.87702 3.87702 2.45996 5.625 2.45996C7.37298 2.45996 8.79004 3.87702 8.79004 5.625ZM17.54 5.625C17.54 7.37298 16.123 8.79004 14.375 8.79004C13.7416 8.79004 13.153 8.60173 12.6582 8.28125L8.28125 12.6582C8.60173 13.153 8.79004 13.7416 8.79004 14.375C8.79004 16.123 7.37298 17.54 5.625 17.54C3.87702 17.54 2.45996 16.123 2.45996 14.375C2.45996 12.627 3.87702 11.21 5.625 11.21C6.25794 11.21 6.84623 11.3977 7.34082 11.7178L11.7178 7.34082C11.3977 6.84623 11.21 6.25794 11.21 5.625C11.21 3.87702 12.627 2.45996 14.375 2.45996C16.123 2.45996 17.54 3.87702 17.54 5.625Z"})})}function Jc(){return s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-3xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function ed(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M21.333 23L26.333 18L21.333 13",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M14.667 13L9.66699 18L14.667 23",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}function td({file:e,fileType:t}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",fill:"none",className:"h-10 w-10 flex-shrink-0",width:"36",height:"36",children:[s.jsx("rect",{width:"36",height:"36",rx:"6",fill:t.fill}),((null==e?void 0:e.progress)??1)>=1&&s.jsx(s.Fragment,{children:s.jsx(t.paths,{})})]})}function nd({className:e=""}){return s.jsx("svg",{fill:"currentColor",width:"24",height:"24",viewBox:"0 0 24 24",className:e,children:s.jsx("path",{d:"M24 13.5q0 1.242-.475 2.332-.474 1.09-1.289 1.904-.814.815-1.904 1.29-1.09.474-2.332.474-.762 0-1.523-.2-.106.997-.557 1.858-.451.862-1.154 1.494-.704.633-1.606.99-.902.358-1.91.358-1.09 0-2.045-.416-.955-.416-1.664-1.125-.709-.709-1.125-1.664Q6 19.84 6 18.75q0-.188.018-.375.017-.188.04-.375H.997q-.41 0-.703-.293T0 17.004V6.996q0-.41.293-.703T.996 6h3.54q.14-1.277.726-2.373.586-1.096 1.488-1.904Q7.652.914 8.807.457 9.96 0 11.25 0q1.395 0 2.625.533T16.02 1.98q.914.915 1.447 2.145T18 6.75q0 .188-.012.375-.011.188-.035.375 1.242 0 2.344.469 1.101.468 1.928 1.277.826.809 1.3 1.904Q24 12.246 24 13.5zm-12.75-12q-.973 0-1.857.34-.885.34-1.577.943-.691.604-1.154 1.43Q6.2 5.039 6.06 6h4.945q.41 0 .703.293t.293.703v4.945l.21-.035q.212-.75.61-1.424.399-.673.944-1.218.545-.545 1.213-.944.668-.398 1.43-.61.093-.503.093-.96 0-1.09-.416-2.045-.416-.955-1.125-1.664-.709-.709-1.664-1.125Q12.34 1.5 11.25 1.5zM6.117 15.902q.54 0 1.06-.111.522-.111.932-.37.41-.257.662-.679.252-.422.252-1.055 0-.632-.263-1.054-.264-.422-.662-.703-.399-.282-.856-.463l-.855-.34q-.399-.158-.662-.334-.264-.176-.264-.445 0-.2.14-.323.141-.123.335-.193.193-.07.404-.094.21-.023.351-.023.598 0 1.055.152.457.153.95.457V8.543q-.282-.082-.522-.14-.24-.06-.475-.1-.234-.041-.486-.059-.252-.017-.557-.017-.515 0-1.054.117-.54.117-.979.375-.44.258-.715.68-.275.421-.275 1.03 0 .598.263.997.264.398.663.68.398.28.855.474l.856.363q.398.17.662.358.263.187.263.457 0 .222-.123.351-.123.13-.31.2-.188.07-.393.087-.205.018-.369.018-.703 0-1.248-.234-.545-.235-1.107-.621v1.875q1.195.468 2.472.468zM11.25 22.5q.773 0 1.453-.293t1.19-.803q.51-.51.808-1.195.299-.686.299-1.459 0-.668-.223-1.277-.222-.61-.62-1.096-.4-.486-.95-.826-.55-.34-1.207-.48v1.933q0 .41-.293.703t-.703.293H7.57q-.07.375-.07.75 0 .773.293 1.459t.803 1.195q.51.51 1.195.803.686.293 1.459.293zM18 18q.926 0 1.746-.352.82-.351 1.436-.966.615-.616.966-1.43.352-.815.352-1.752 0-.926-.352-1.746-.351-.82-.966-1.436-.616-.615-1.436-.966Q18.926 9 18 9t-1.74.357q-.815.358-1.43.973t-.973 1.43q-.357.814-.357 1.74 0 .129.006.258t.017.258q.551.27 1.02.65t.838.855q.369.475.627 1.026.258.55.387 1.148Q17.18 18 18 18Z"})})}const sd=({user:e,size:t=32,className:a="",alt:r,showDefaultWhenEmpty:o=!0})=>{const i=Hi(e),[l,c]=n.useState(!1),[d,u]=n.useState(!1),m=n.useMemo((()=>(null==e?void 0:e.avatar)||(null==e?void 0:e.username)||(null==e?void 0:e.email)||""),[null==e?void 0:e.avatar,null==e?void 0:e.username,null==e?void 0:e.email]),p=n.useMemo((()=>r||`${(null==e?void 0:e.name)||(null==e?void 0:e.username)||(null==e?void 0:e.email)||""}'s avatar`),[r,null==e?void 0:e.name,null==e?void 0:e.username,null==e?void 0:e.email]),f=n.useMemo((()=>!m||d?"":((null==e?void 0:e.avatar)??"")||i||""),[null==e?void 0:e.avatar,i,m,d]),h=n.useCallback((()=>{c(!0)}),[]),g=n.useCallback((()=>{u(!0),c(!1)}),[]),x=n.useCallback((()=>s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:`${t}px`,height:`${t}px`,boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:`relative flex items-center justify-center rounded-full p-1 text-text-primary ${a}`,"aria-hidden":"true",children:s.jsx(Fc,{})})),[t,a]);return 0===m.length&&o?s.jsx(x,{}):m.length>0&&!d?s.jsxs("div",{className:"relative",style:{width:`${t}px`,height:`${t}px`},children:[!l&&s.jsx(Cl,{className:"rounded-full",style:{width:`${t}px`,height:`${t}px`}}),s.jsx("img",{style:{width:`${t}px`,height:`${t}px`,display:l?"block":"none"},className:`rounded-full ${a}`,src:f,alt:p,onLoad:h,onError:g})]}):d&&o?s.jsx(x,{}):null};hi(".popover-ui {\r\n  display: flex;\r\n  max-height: min(var(--popover-available-height, 1700px), 1700px);\r\n  flex-direction: column;\r\n  overflow: auto;\r\n  overscroll-behavior: contain;\r\n  border-radius: 1rem;\r\n  border-width: 1px;\r\n  border-style: solid;\r\n  border-color: var(--border-light);\r\n  background-color: var(--surface-primary);\r\n  padding: 0.5rem;\r\n  color: var(--text-primary);\r\n  box-shadow:\r\n    0 10px 15px -3px rgb(0 0 0 / 0.1),\r\n    0 4px 6px -4px rgb(0 0 0 / 0.1);\r\n  transform-origin: top;\r\n  opacity: 0;\r\n  transition-property: opacity, scale, translate;\r\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\r\n  transition-duration: 150ms;\r\n  scale: 0.95;\r\n  translate: 0 -0.5rem;\r\n  margin-top: 4px;\r\n  margin-right: -2px;\r\n}\r\n\r\n.popover-animate {\r\n  opacity: 0;\r\n  transform: scale(0.95) translateY(-0.5rem);\r\n  transition:\r\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\r\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\r\n}\r\n.popover-animate[data-enter] {\r\n  opacity: 1;\r\n  transform: scale(1) translateY(0);\r\n}\r\n\r\n.popover-ui:focus-visible,\r\n.popover-ui[data-focus-visible] {\r\n  outline: var(--bg-surface-hover);\r\n  outline-offset: -1px;\r\n}\r\n\r\n.popover-ui:where(.dark, .dark *) {\r\n  background-color: var(--surface-secondary);\r\n  color: var(--text-secondary);\r\n  box-shadow:\r\n    0 10px 15px -3px rgb(0 0 0 / 0.25),\r\n    0 4px 6px -4px rgb(0 0 0 / 0.1);\r\n}\r\n\r\n.select-item {\r\n  display: flex;\r\n  cursor: pointer;\r\n  scroll-margin: 0.5rem;\r\n  align-items: center;\r\n  gap: 0.5rem;\r\n  border-radius: 0.5rem;\r\n  padding: 0.5rem;\r\n  outline: none !important;\r\n}\r\n\r\n.select-item[aria-disabled='true'] {\r\n  opacity: 0.5;\r\n}\r\n\r\n.select-item[data-active-item] {\r\n  background-color: var(--surface-hover);\r\n  color: var(--text-primary);\r\n}\r\n\r\n.popover-ui[data-enter] {\r\n  opacity: 1;\r\n  scale: 1;\r\n  translate: 0;\r\n}\r\n");const ad=e=>"object"==typeof e&&"divider"in e,rd=e=>"object"==typeof e&&"value"in e&&"label"in e,od=({value:e,label:t="",onChange:n,options:a,className:r="",sizeClasses:o,testId:i="dropdown-menu",icon:l,iconOnly:c=!1,renderValue:d,ariaLabel:u,portal:m=!0})=>{const p=P({value:e,setValue:e=>{n(e)}}),f=e=>{if(null!=e&&""!==e)return a.filter((e=>!ad(e))).map((e=>"string"==typeof e?{value:e,label:e}:e)).find((t=>rd(t)&&t.value===e))};return s.jsxs("div",{className:di("relative",r),children:[s.jsxs(L,{store:p,className:di("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary",c?"h-full w-10":"w-fit gap-2",r),"data-testid":i,"aria-label":u,children:[s.jsxs("div",{className:"flex w-full items-center gap-2",children:[l,!c&&s.jsxs("span",{className:"block truncate",children:[t,(()=>{const t=f(e);return t&&d?d(t):(e=>{if(null==e||""===e)return"";const t=f(e);return t?t.label:e})(e)})()]})]}),!c&&s.jsx(Z,{})]}),s.jsx(D,{portal:m,store:p,className:di("popover-ui",o,r,"max-h-[80vh] overflow-y-auto","[pointer-events:auto]"),children:a.map(((t,n)=>{if(ad(t))return s.jsx("div",{className:"my-1 border-t border-border-heavy"},`divider-${n}`);const a="string"==typeof t?{value:t,label:t}:t;return rd(a)?s.jsx($,{value:String(a.value),className:"select-item","data-theme":a.value,children:s.jsxs("div",{className:"flex w-full items-center gap-2",children:[null!=a.icon&&s.jsx("span",{children:a.icon}),s.jsx("span",{className:"block truncate",children:a.label}),e===a.value&&s.jsx("span",{className:"ml-auto pl-2",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block group-hover:hidden",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]})},`option-${n}`):null}))})]})},id=e=>{if("undefined"!=typeof Intl&&"Segmenter"in Intl){const t=new Intl.Segmenter("en",{granularity:"grapheme"}).segment(e);return Array.from(t).map((e=>e.segment))}return[...e]},ld=({text:e="",className:t="",delay:a=100,animationFrom:r={opacity:0,transform:"translate3d(0,40px,0)"},animationTo:o={opacity:1,transform:"translate3d(0,0,0)"},easing:i=(e=>e),threshold:l=.1,rootMargin:c="-100px",textAlign:d="center",onLetterAnimationComplete:u,onLineCountChange:m})=>{const p=e.split(" ").map(id),f=p.flat(),[h,g]=n.useState(!1),x=n.useRef(null),v=n.useRef(0),[b]=Lr(f.length,(e=>({from:r,to:h?async e=>{await e(o),v.current+=1,v.current===f.length&&u&&u()}:r,delay:e*a,config:{easing:i}})),[h,e,a,r,o,i,u]);return n.useEffect((()=>{const e=new IntersectionObserver((([t])=>{t.isIntersecting&&(g(!0),x.current&&e.unobserve(x.current))}),{threshold:l,rootMargin:c});return x.current&&e.observe(x.current),()=>e.disconnect()}),[l,c]),n.useEffect((()=>{if(x.current&&h){const e=x.current;setTimeout((()=>{const t=parseInt(getComputedStyle(e).lineHeight)||1.2*parseInt(getComputedStyle(e).fontSize),n=e.offsetHeight,s=Math.round(n/t);m&&m(s)}),100)}}),[h,e,m]),s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"sr-only",children:e}),s.jsx("p",{ref:x,className:`split-parent inline overflow-hidden ${t}`,style:{textAlign:d,whiteSpace:"normal",wordWrap:"break-word"},"aria-hidden":"true",children:p.map(((e,t)=>s.jsxs("span",{style:{display:"inline-block",whiteSpace:"nowrap"},children:[e.map(((e,n)=>{const a=p.slice(0,t).reduce(((e,t)=>e+t.length),0)+n;return s.jsx(Or.span,{style:b[a],className:"inline-block transform transition-opacity will-change-transform",children:e},a)})),t<p.length-1&&s.jsx("span",{style:{display:"inline-block",width:"0.3em"},children:" "})]},t)))})]})},cd=({value:e,onChange:t,isSearching:n,placeholder:a})=>{const r=!0===n,o=null!=e&&e.length>0;return s.jsxs("div",{className:"relative w-full",children:[s.jsx("div",{className:"relative rounded-lg transition-all duration-500 ease-in-out",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-3 top-1/2 z-50 -translate-y-1/2",children:s.jsx(F,{className:di("h-4 w-4 transition-all duration-500 ease-in-out",r&&o?"text-blue-400":"text-gray-400")})}),s.jsx("input",{type:"text",value:e,onChange:t,placeholder:a,className:"peer relative z-20 w-full rounded-lg bg-surface-secondary px-10 py-2 outline-none ring-0 backdrop-blur-sm transition-all duration-500 ease-in-out placeholder:text-gray-400 focus:outline-none focus:ring-0"}),s.jsx("div",{className:`pointer-events-none absolute inset-0 z-20 rounded-lg bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-blue-500/20 transition-all duration-500 ease-in-out ${r&&o?"opacity-100 blur-sm":"opacity-0 blur-none"} `}),s.jsx("div",{className:`absolute right-3 top-1/2 z-20 -translate-y-1/2 transition-all duration-500 ease-in-out ${r&&o?"scale-100 opacity-100":"scale-0 opacity-0"} `,children:s.jsxs("div",{className:"relative h-2 w-2",children:[s.jsx("div",{className:"absolute inset-0 animate-ping rounded-full bg-blue-500/60"}),s.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-500"})]})})]})}),s.jsx("div",{className:`absolute -inset-8 -z-10 transition-all duration-700 ease-in-out ${r&&o?"scale-105 opacity-100":"scale-100 opacity-0"} `,children:s.jsxs("div",{className:"absolute inset-0",children:[s.jsx("div",{className:`bg-gradient-radial absolute inset-0 from-blue-500/10 to-transparent transition-opacity duration-700 ease-in-out ${r&&o?"animate-pulse-slow opacity-100":"opacity-0"} `}),s.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-purple-500/5 via-blue-500/5 to-purple-500/5 blur-xl transition-all duration-700 ease-in-out ${r&&o?"animate-gradient-x opacity-100":"opacity-0"} `})]})}),s.jsx("div",{className:"absolute inset-0 -z-20 scale-100 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-blue-500/10 opacity-0 blur-xl transition-all duration-500 ease-in-out peer-focus:scale-105 peer-focus:opacity-100"})]})},dd=n.memo((({checked:e,onChange:t,ariaLabel:n})=>s.jsx("div",{role:"button",tabIndex:0,onKeyDown:e=>e.stopPropagation(),className:"flex h-full w-[30px] items-center justify-center",onClick:e=>e.stopPropagation(),children:s.jsx(Ti,{checked:e,onCheckedChange:t,"aria-label":n})})));dd.displayName="SelectionCheckbox";const ud=n.memo((({row:e,isSmallScreen:t,onSelectionChange:a,index:r,isSearching:o})=>{const i=n.useCallback((t=>{e.toggleSelected(t),null==a||a(e.id,t)}),[e,a]);return s.jsx(Rl,{"data-state":e.getIsSelected()?"selected":void 0,className:"motion-safe:animate-fadeIn border-b border-border-light transition-all duration-300 ease-out hover:bg-surface-secondary",style:{animationDelay:20*r+"ms",transform:`translateY(${o?"4px":"0"})`,opacity:o?.5:1},children:e.getVisibleCells().map((n=>"select"===n.column.id?s.jsx(Pl,{className:"px-2 py-1 transition-all duration-300",children:s.jsx(dd,{checked:e.getIsSelected(),onChange:i,ariaLabel:"Select row"})},n.id):s.jsx(Pl,{className:"w-0 max-w-0 px-2 py-1 align-middle text-xs transition-all duration-300 sm:px-4 sm:py-2 sm:text-sm",style:md(n.column.columnDef,t),children:s.jsx("div",{className:"overflow-hidden text-ellipsis",children:ir(n.column.columnDef.cell,n.getContext())})},n.id)))})}));function md(e,t){var n,s,a,r;return{width:t?null==(n=e.meta)?void 0:n.mobileSize:null==(s=e.meta)?void 0:s.size,minWidth:null==(a=e.meta)?void 0:a.minWidth,maxWidth:null==(r=e.meta)?void 0:r.size}}const pd=n.memo((({onDelete:e,isDeleting:t,disabled:n,isSmallScreen:a})=>e?s.jsx(Si,{variant:"outline",onClick:e,disabled:n,className:di("min-w-[40px] transition-all duration-200",a&&"px-2 py-1"),children:t?s.jsx(rc,{className:"size-4"}):s.jsxs(s.Fragment,{children:[s.jsx(Sc,{className:"size-3.5 text-red-400 sm:size-4"}),!a&&s.jsx("span",{className:"ml-2",children:"Delete"})]})}):null));function fd({columns:e,data:t,onDelete:a,filterColumn:r,defaultSort:o=[],className:i="",isFetchingNextPage:l=!1,hasNextPage:c=!1,fetchNextPage:d,enableRowSelection:u=!0,showCheckboxes:m=!0,onFilterChange:p,filterValue:f,isLoading:h,enableSearch:g=!0}){const x=Wi("(max-width: 768px)"),v=n.useRef(null),[b,_]=n.useState(!1),[y,j]=n.useState({}),[w,N]=n.useState(o),[C,k]=n.useState([]),[S,T]=n.useState({}),[E,R]=n.useState(f??""),[I,P]=n.useState(!1),A=n.useMemo((()=>{if(!u||!m)return e;const t={id:"select",header:({table:e})=>s.jsx("div",{className:"flex h-full w-[30px] items-center justify-center",children:s.jsx(Ti,{checked:e.getIsAllPageRowsSelected(),onCheckedChange:t=>e.toggleAllPageRowsSelected(Boolean(t)),"aria-label":"Select all"})}),cell:({row:e})=>s.jsx(dd,{checked:e.getIsSelected(),onChange:t=>e.toggleSelected(t),ariaLabel:"Select row"}),meta:{size:"50px"}};return[t,...e]}),[e,u,m]),M=lr({data:t,columns:A,getCoreRowModel:ur(),getSortedRowModel:dr(),getFilteredRowModel:cr(),enableRowSelection:u,enableMultiRowSelection:!0,state:{sorting:w,columnFilters:C,columnVisibility:S,rowSelection:y},onSortingChange:N,onColumnFiltersChange:k,onColumnVisibilityChange:T,onRowSelectionChange:j}),{rows:L}=M.getRowModel(),O=Ur({count:L.length,getScrollElement:()=>v.current,estimateSize:n.useCallback((()=>48),[]),overscan:10}),D=O.getVirtualItems(),F=O.getTotalSize(),z=D.length>0?D[0].start:0,U=D.length>0?F-D[D.length-1].end:0;n.useEffect((()=>{const e=v.current;if(!e)return;const t=async()=>{if(!c||l)return;const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;if(n-t<=1.5*s)try{await(null==d?void 0:d())}catch(ru){console.error("Unable to fetch next page:",ru)}};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)}),[c,l,d]),n.useEffect((()=>{P(!0);const e=setTimeout((()=>{null==p||p(E),P(!1)}),300);return()=>clearTimeout(e)}),[E,p]);const V=n.useCallback((async()=>{if(a){_(!0);try{const e=M.getFilteredSelectedRowModel().rows.map((e=>e.original));await a(e),j({})}finally{_(!1)}}}),[a,M]),B=Array.from({length:13},((e,t)=>{var n;const a=Math.floor(241*Math.random())+170,r="select"===(null==(n=A[0])?void 0:n.id)?1:0;return s.jsx(Rl,{className:"motion-safe:animate-fadeIn border-b border-border-light",children:A.map(((e,t)=>{const n=md(e,x);return s.jsx(Pl,{className:"px-2 py-1 sm:px-4 sm:py-2",style:n,children:s.jsx(Cl,{className:"h-6",style:t===r?{width:`${a}px`}:{width:"100%"}})},e.id)}))},t)}));return s.jsxs("div",{className:di("flex h-full flex-col gap-4",i),children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[u&&m&&s.jsx(pd,{onDelete:V,isDeleting:b,disabled:!M.getFilteredSelectedRowModel().rows.length||b,isSmallScreen:x}),void 0!==r&&M.getColumn(r)&&g&&s.jsx("div",{className:"relative flex-1",children:s.jsx(cd,{value:E,onChange:e=>R(e.target.value),isSearching:I,placeholder:"Search..."})})]}),s.jsx("div",{ref:v,className:di("relative h-[calc(100vh-20rem)] max-w-full overflow-x-auto overflow-y-auto rounded-md border border-black/10 dark:border-white/10","transition-all duration-300 ease-out",I&&"bg-surface-secondary/50",i),children:s.jsxs(Sl,{className:"w-full min-w-[300px] table-fixed border-separate border-spacing-0",children:[s.jsx(Tl,{className:"sticky top-0 z-50 bg-surface-secondary",children:M.getHeaderGroups().map((e=>s.jsx(Rl,{className:"border-b border-border-light",children:e.headers.map((e=>s.jsx(Il,{className:"whitespace-nowrap bg-surface-secondary px-2 py-2 text-left text-sm font-medium text-text-secondary sm:px-4",style:md(e.column.columnDef,x),onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),s.jsxs(El,{children:[z>0&&s.jsx("tr",{children:s.jsx("td",{style:{height:`${z}px`}})}),h&&B,D.map((e=>{const t=L[e.index];return s.jsx(ud,{row:t,isSmallScreen:x,index:e.index,isSearching:I},t.id)})),!D.length&&s.jsx(Rl,{className:"hover:bg-transparent",children:s.jsx(Pl,{colSpan:e.length,className:"p-4 text-center",children:"No data available"})}),U>0&&s.jsx("tr",{children:s.jsx("td",{style:{height:`${U}px`}})}),(l||c)&&s.jsx(Rl,{className:"hover:bg-transparent",children:s.jsx(Pl,{colSpan:e.length,className:"p-4",children:s.jsx("div",{className:"flex h-full items-center justify-center",children:l?s.jsx(rc,{className:"size-4"}):c&&s.jsx("div",{className:"h-6"})})})})]})]})})]})}function hd({field:e,label:t,labelClass:n,inputClass:a,containerClass:r,labelAdjacent:o,placeholder:i="",type:l="string"}){return s.jsxs("div",{className:di("flex w-full flex-col items-center gap-2",r),children:[s.jsxs("div",{className:"flex w-full items-center justify-start gap-2",children:[s.jsx(ul,{htmlFor:`${e.name}-input`,className:di("text-left text-sm font-semibold text-text-primary",n),children:t}),o]}),s.jsx(cl,{id:`${e.name}-input`,value:e.value??"",onChange:t=>{const n=t.target.value;"number"===l?""===n?e.onChange(n):isNaN(Number(n))||e.onChange(Number(n)):e.onChange(n)},placeholder:i,className:di("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2",a)})]})}class gd{constructor(e,t,n,s,a,r,o,i){this.width=e.width,this.height=e.height,this.ctx=t,this.x=n,this.y=s,this.color=a,this.speed=this.random(.1,.9)*r,this.size=0,this.sizeStep=.4*Math.random(),this.minSize=.5,this.maxSizeInteger=2,this.maxSize=this.random(this.minSize,this.maxSizeInteger),this.delay=o,this.counter=0,this.counterStep=4*Math.random()+.01*(this.width+this.height),this.isIdle=!1,this.isReverse=!1,this.isShimmer=!1,this.activationThreshold=i}random(e,t){return Math.random()*(t-e)+e}draw(){const e=.5*this.maxSizeInteger-.5*this.size;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+e,this.y+e,this.size,this.size)}appear(){this.isIdle=!1,this.counter<=this.delay?this.counter+=this.counterStep:(this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.draw())}appearWithProgress(e){if(e-this.activationThreshold<=0)this.isIdle=!0;else{if(this.counter<=this.delay)return this.counter+=this.counterStep,void(this.isIdle=!1);this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.isIdle=!1,this.draw()}}disappear(){this.isShimmer=!1,this.counter=0,this.size<=0?this.isIdle=!0:(this.size-=.1,this.draw())}shimmer(){this.size>=this.maxSize?this.isReverse=!0:this.size<=this.minSize&&(this.isReverse=!1),this.size+=this.isReverse?-this.speed:this.speed}}const xd=(e,t)=>{const n=parseInt(String(e),10);return n<=0||t?0:n>=100?.1:.001*n},vd=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),bd={default:{gap:5,speed:35,colors:"#f8fafc,#f1f5f9,#cbd5e1",noFocus:!1},blue:{gap:10,speed:25,colors:"#e0f2fe,#7dd3fc,#0ea5e9",noFocus:!1},yellow:{gap:3,speed:20,colors:"#fef08a,#fde047,#eab308",noFocus:!1},pink:{gap:6,speed:80,colors:"#fecdd3,#fda4af,#e11d48",noFocus:!0}};function _d({variant:e="default",gap:t,speed:a,colors:r,noFocus:o,className:i="",progress:l,randomness:c=.3,width:d,height:u}){const m=n.useRef(null),p=n.useRef(null),f=n.useRef([]),h=n.useRef(void 0),g=n.useRef(performance.now()),x=n.useRef(l),v=n.useRef(window.matchMedia("(prefers-reduced-motion: reduce)").matches).current,b=bd[e],_=t??b.gap,y=a??b.speed,j=r??b.colors,w=o??b.noFocus,N=n.useCallback((()=>{if(!p.current)return;if(void 0===x.current)return void(p.current.style.opacity="1");const e=x.current>=.9?1-(x.current-.9)/.1:1;p.current.style.opacity=String(vd(e))}),[]),C=n.useCallback((e=>{var t;h.current=requestAnimationFrame((()=>C(e)));const n=performance.now(),s=n-g.current;if(s<1e3/60)return;g.current=n-s%(1e3/60);const a=null==(t=p.current)?void 0:t.getContext("2d");if(!a||!p.current)return;a.clearRect(0,0,p.current.width,p.current.height);let r=!0;for(const o of f.current)"appearWithProgress"===e?void 0!==x.current?o.appearWithProgress(x.current):o.isIdle=!0:o[e](),o.isIdle||(r=!1);N(),r&&cancelAnimationFrame(h.current)}),[N]),k=n.useCallback((e=>{cancelAnimationFrame(h.current),h.current=requestAnimationFrame((()=>C(e)))}),[C]),S=n.useCallback((()=>{if(!m.current||!p.current)return;const{width:e,height:t}=m.current.getBoundingClientRect(),n=p.current.getContext("2d");p.current.width=Math.floor(e),p.current.height=Math.floor(t);const s=j.split(","),a=[],r=e/2,o=t/2,i=Math.hypot(r,o);for(let l=0;l<e;l+=_)for(let e=0;e<t;e+=_){const t=s[Math.floor(Math.random()*s.length)],d=Math.hypot(l-r,e-o)/i,u=vd(d*(1-c)+Math.random()*c),m=v?0:d*i;n&&a.push(new gd(p.current,n,l,e,t,xd(y,v),m,u))}f.current=a,void 0!==x.current&&k("appearWithProgress")}),[_,j,y,c,v,k]);return n.useEffect((()=>{x.current=l,void 0!==l&&k("appearWithProgress")}),[l,k]),n.useEffect((()=>{void 0===l&&cancelAnimationFrame(h.current)}),[l]),n.useEffect((()=>{S();const e=new ResizeObserver(S);return m.current&&e.observe(m.current),()=>{e.disconnect(),cancelAnimationFrame(h.current)}}),[S]),s.jsx("div",{ref:m,style:{width:d||"100%",height:u||"100%"},children:s.jsx("div",{className:di("relative isolate grid select-none place-items-center overflow-hidden rounded-lg border border-border-light shadow-md transition-colors duration-200 ease-in-out",i),style:{width:"100%",height:"100%",transitionTimingFunction:"cubic-bezier(0.5, 1, 0.89, 1)"},onMouseEnter:()=>void 0===x.current&&k("appear"),onMouseLeave:()=>void 0===x.current&&k("disappear"),onFocus:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==x.current||k("appear")},onBlur:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==x.current||k("disappear")},tabIndex:w?-1:0,children:s.jsx("canvas",{ref:p,className:"pointer-events-none absolute inset-0 block",width:d&&"auto"!==d?parseInt(String(d)):void 0,height:u&&"auto"!==u?parseInt(String(u)):void 0})})})}const yd=n.forwardRef((({children:e,handleFileChange:t},n)=>s.jsxs(s.Fragment,{children:[e,s.jsx("input",{ref:n,multiple:!0,type:"file",style:{display:"none"},onChange:t})]})));function jd(e,t){return 0===e.length?t||"Select...":1===e.length?e[0]:`${e.length} items selected`}function wd({items:e,label:t,placeholder:a="Select...",onSelectedValuesChange:r,renderSelectedValues:o=jd,className:i,selectIcon:l,itemClassName:c,labelClassName:d,selectClassName:u,popoverClassName:m,selectItemsClassName:p,selectedValues:f=[],setSelectedValues:h,renderItemContent:g}){const x=n.useRef(null);return s.jsx("div",{className:i,children:s.jsxs(fe,{value:f,setValue:e=>{h(e),r&&r(e)},children:[t&&s.jsx(M,{className:di("mb-1 block text-sm text-text-primary",d),children:t}),s.jsxs(L,{ref:x,className:di("flex items-center justify-between gap-2 rounded-xl px-3 py-2 text-sm","bg-surface-tertiary text-text-primary shadow-sm hover:cursor-pointer hover:bg-surface-hover","outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75",u,f.length>0&&null!=p&&p),onChange:e=>e.stopPropagation(),children:[l&&s.jsx("span",{children:l}),s.jsx("span",{className:"mr-auto hidden truncate md:block",children:o(f,a)}),s.jsx(Z,{className:"ml-1 hidden stroke-1 text-base opacity-75 md:block"})]}),s.jsx(D,{gutter:4,sameWidth:!0,modal:!0,unmountOnHide:!0,finalFocus:x,className:di("animate-popover z-50 flex max-h-[300px]","flex-col overflow-auto overscroll-contain rounded-xl","bg-surface-secondary px-1.5 py-1 text-text-primary shadow-lg","border border-border-light","outline-none",m),children:e.map((e=>{const t=s.jsxs(s.Fragment,{children:[s.jsx(he,{className:"mr-0.5 text-primary"}),s.jsx("span",{className:"truncate",children:e})]}),n=f.includes(e);return s.jsx($,{value:e,className:di("flex items-center gap-2 rounded-lg px-2 py-1.5 hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 text-sm",c),children:g?g(e,t,n):t},e)}))})]})})}yd.displayName="FileUpload",hi(".animate-popover {\r\n  transform-origin: top;\r\n  opacity: 0;\r\n  transition:\r\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\r\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\r\n  transform: scale(0.95) translateY(-0.5rem);\r\n}\r\n\r\n.animate-popover[data-enter] {\r\n  opacity: 1;\r\n  transform: scale(1) translateY(0);\r\n}\r\n\r\n.animate-popover-left {\r\n  transform-origin: left;\r\n  opacity: 0;\r\n  transition:\r\n    opacity 150ms cubic-bezier(0.4, 0, 0.2, 1),\r\n    transform 150ms cubic-bezier(0.4, 0, 0.2, 1);\r\n  transform: scale(0.95) translateX(-0.5rem);\r\n}\r\n\r\n.animate-popover-left[data-enter] {\r\n  opacity: 1;\r\n  transform: scale(1) translateX(0);\r\n}\r\n");const Nd=({trigger:e,isOpen:t,setIsOpen:n,focusLoop:a,mountByState:r,...o})=>{const i=te({open:t,setOpen:n,focusLoop:a});return s.jsxs(ne,r?{store:i,children:[e,t&&s.jsx(Cd,{...o})]}:{store:i,children:[e,s.jsx(Cd,{...o})]})},Cd=({items:e,menuId:t,keyPrefix:n,className:a,iconClassName:r,itemClassName:o,modal:i,portal:l,sameWidth:c,gutter:d=8,finalFocus:u,unmountOnHide:m,preserveTabOrder:p,...f})=>{const h=te(),g=ae();return s.jsx(re,{id:t,modal:i,gutter:d,portal:l,sameWidth:c,finalFocus:u,unmountOnHide:m,preserveTabOrder:p,className:di("popover-ui z-50",a),...f,children:e.filter((e=>!1!==e.show)).map(((e,a)=>{const{subItems:i}=e;return!0===e.separate?s.jsx(oe,{className:"my-1 h-px bg-white/10"},a):i&&i.length>0?s.jsxs(ne,{store:h,children:[s.jsxs(ie,{className:di("group flex w-full cursor-pointer items-center justify-between gap-2 rounded-lg px-3 py-3.5 text-sm text-text-primary outline-none transition-colors duration-200 hover:bg-surface-hover focus:bg-surface-hover md:px-2.5 md:py-2",o),disabled:e.disabled,id:e.id,render:e.render,ref:e.ref,children:[s.jsxs("span",{className:"flex items-center gap-2",children:[null!=e.icon&&s.jsx("span",{className:di("mr-2 size-4",r),"aria-hidden":"true",children:e.icon}),e.label]}),s.jsx(le,{className:"stroke-1 text-base opacity-75"})]}),s.jsx(Cd,{items:i,menuId:`${t}-${a}`,gutter:12,portal:!0},`${n??""}${a}-${e.id??""}`)]},`${n??""}${a}-${e.id??""}-provider`):s.jsxs(ce,{id:e.id,className:di("group flex w-full cursor-pointer items-center gap-2 rounded-lg px-3 py-3.5 text-sm text-text-primary outline-none transition-colors duration-200 hover:bg-surface-hover focus:bg-surface-hover md:px-2.5 md:py-2",o),disabled:e.disabled,render:e.render,ref:e.ref,hideOnClick:e.hideOnClick,onClick:t=>{t.preventDefault(),e.onClick&&e.onClick(t),!1!==e.hideOnClick&&(null==g||g.hide())},children:[null!=e.icon&&s.jsx("span",{className:di("mr-2 size-4",r),"aria-hidden":"true",children:e.icon}),e.label,null!=e.kbd&&s.jsxs("kbd",{className:"ml-auto hidden font-sans text-xs text-black/50 group-hover:inline group-focus:inline dark:text-white/50",children:["⌘",e.kbd]})]},`${n??""}${a}-${e.id??""}`)}))})},kd=({delay:e,children:t})=>(e=>{const[t,s]=n.useState(!0),a=n.useRef(null);return n.useEffect((()=>{if(t){const t=new Promise((t=>{const n=setTimeout((()=>{s(!1),t()}),e);return()=>{clearTimeout(n)}}));a.current=t}return()=>{a.current=null}}),[e,t]),e=>{if(t&&a.current)throw a.current;return e()}})(e)((()=>t));const Sd=T("color-theme","system",void 0,{getOnInit:!0}),Td=T("theme-colors",void 0,void 0,{getOnInit:!0}),Ed=T("theme-name",void 0,void 0,{getOnInit:!0}),Rd=n.createContext({theme:"system",setTheme:()=>{},setThemeRGB:()=>{},setThemeName:()=>{},resetTheme:()=>{}}),Id=e=>"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===e;function Pd({children:e,themeRGB:t,themeName:a,initialTheme:r}){const[o,i]=ge(Sd),[l,c]=ge(Td),[d,u]=ge(Ed),m=n.useRef(!1);n.useEffect((()=>{m.current||(m.current=!0,r&&i(r),t&&c(t),a&&u(a))}),[r,t,a,i,c,u]);const p=n.useCallback((e=>{const t=window.document.documentElement,n=Id(e);t.classList.remove(n?"light":"dark"),t.classList.add(n?"dark":"light")}),[]);n.useEffect((()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{"system"===o&&p("system")};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}),[o,p]),n.useEffect((()=>{p(o)}),[o,p]),n.useEffect((()=>{l&&function(e){if(!e)return;const t=function(e){const t={};return Object.entries({"rgb-text-primary":"--text-primary","rgb-text-secondary":"--text-secondary","rgb-text-secondary-alt":"--text-secondary-alt","rgb-text-tertiary":"--text-tertiary","rgb-text-warning":"--text-warning","rgb-ring-primary":"--ring-primary","rgb-header-primary":"--header-primary","rgb-header-hover":"--header-hover","rgb-header-button-hover":"--header-button-hover","rgb-surface-active":"--surface-active","rgb-surface-active-alt":"--surface-active-alt","rgb-surface-hover":"--surface-hover","rgb-surface-hover-alt":"--surface-hover-alt","rgb-surface-primary":"--surface-primary","rgb-surface-primary-alt":"--surface-primary-alt","rgb-surface-primary-contrast":"--surface-primary-contrast","rgb-surface-secondary":"--surface-secondary","rgb-surface-secondary-alt":"--surface-secondary-alt","rgb-surface-tertiary":"--surface-tertiary","rgb-surface-tertiary-alt":"--surface-tertiary-alt","rgb-surface-dialog":"--surface-dialog","rgb-surface-submit":"--surface-submit","rgb-surface-submit-hover":"--surface-submit-hover","rgb-surface-destructive":"--surface-destructive","rgb-surface-destructive-hover":"--surface-destructive-hover","rgb-surface-chat":"--surface-chat","rgb-border-light":"--border-light","rgb-border-medium":"--border-medium","rgb-border-medium-alt":"--border-medium-alt","rgb-border-heavy":"--border-heavy","rgb-border-xheavy":"--border-xheavy","rgb-brand-purple":"--brand-purple","rgb-presentation":"--presentation","rgb-background":"--background","rgb-foreground":"--foreground","rgb-primary":"--primary","rgb-primary-foreground":"--primary-foreground","rgb-secondary":"--secondary","rgb-secondary-foreground":"--secondary-foreground","rgb-muted":"--muted","rgb-muted-foreground":"--muted-foreground","rgb-accent":"--accent","rgb-accent-foreground":"--accent-foreground","rgb-destructive-foreground":"--destructive-foreground","rgb-border":"--border","rgb-input":"--input","rgb-ring":"--ring","rgb-card":"--card","rgb-card-foreground":"--card-foreground"}).forEach((([n,s])=>{const a=e[n];a&&(t[s]=a)})),t}(e),n=document.documentElement;Object.entries(t).forEach((([e,t])=>{t&&(function(e){if(!e)return!0;const t=e.match(/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})$/);if(!t)return!1;const[,n,s,a]=t;return[n,s,a].every((e=>{const t=parseInt(e,10);return t>=0&&t<=255}))}(t)?n.style.setProperty(e,`rgb(${t})`):console.error(`Invalid RGB value for ${e}: ${t}`))}))}(l)}),[l]);const f=n.useCallback((()=>{i("system"),c(void 0),u(void 0);const e=document.documentElement;Array.from(e.style).filter((e=>e.startsWith("--"))).forEach((t=>e.style.removeProperty(t)))}),[i,c,u]),h=n.useMemo((()=>({theme:o,setTheme:i,themeRGB:l,setThemeRGB:c,themeName:d,setThemeName:u,resetTheme:f})),[o,i,l,c,d,u,f]);return s.jsx(Rd.Provider,{value:h,children:e})}const Ad=({theme:e,onChange:t})=>{const a={system:s.jsx(Y,{}),dark:s.jsx(Q,{color:"white"}),light:s.jsx(q,{})},r=Id(e)?"light":"dark",o=`Switch to ${r} theme`;return n.useEffect((()=>{const e=e=>{e.ctrlKey&&e.shiftKey&&"t"===e.key.toLowerCase()&&(e.preventDefault(),t(r))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[r,t]),s.jsx("button",{className:"flex items-center gap-2 rounded-lg p-2 transition-colors hover:bg-surface-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","aria-label":o,"aria-keyshortcuts":"Ctrl+Shift+T",onClick:e=>{e.preventDefault(),t(r)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t(r))},children:a[e]})},Md=({returnThemeOnly:e})=>{const{theme:t,setTheme:a}=n.useContext(Rd),[r,o]=n.useState(""),i=n.useCallback((e=>{const t=Date.now();"number"==typeof window.lastThemeChange&&t-window.lastThemeChange<500||(window.lastThemeChange=t,a(e),o(Id(e)?"Dark theme enabled":"Light theme enabled"))}),[a]);return n.useEffect((()=>{if("system"===t){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;a(e?"dark":"light")}}),[t,a]),n.useEffect((()=>{if(r){const e=setTimeout((()=>o("")),1e3);return()=>clearTimeout(e)}}),[r]),!0===e?s.jsx(Ad,{theme:t,onChange:i}):s.jsxs("div",{className:"flex flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[s.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:s.jsx(Ad,{theme:t,onChange:i})}),r&&s.jsx("div",{"aria-live":"polite",className:"sr-only",children:r})]})},Ld=({side:e,text:t})=>s.jsxs(rl,{openDelay:50,children:[s.jsxs(ol,{className:"cursor-help",children:[s.jsx(se,{className:"h-5 w-5 text-text-tertiary"})," "]}),s.jsx(il,{children:s.jsx(ll,{side:e,className:"z-[999] w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:t})})})})]}),Od=n.forwardRef((({icon:e,label:t,setValue:a,className:r,checked:o,defaultChecked:l,isCheckedClassName:c},d)=>{const u=E(),m=i(u,(e=>null==e?void 0:e.value));return n.useEffect((()=>{void 0!==o&&u.setValue(o)}),[o,u]),n.useEffect((()=>{void 0!==l&&void 0===o&&u.setValue(l)}),[l,o,u]),s.jsxs(R,{ref:d,store:u,onChange:e=>{e.stopPropagation(),"boolean"==typeof m&&(null==a||a({e:e,value:!m}))},className:di("group relative inline-flex items-center justify-center gap-1.5","rounded-full border border-border-medium text-sm font-medium","size-9 p-2 transition-all md:w-full md:p-3","bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner",m&&c&&c,r),render:s.jsx("button",{type:"button","aria-label":t}),children:[e&&s.jsx("span",{className:"icon-md text-text-primary",children:e}),s.jsx("span",{className:"hidden truncate md:block",children:t})]})}));Od.displayName="CheckboxButton";const Dd=n.forwardRef(((e,t)=>{const{title:n,description:a,main:r,buttons:o,leftButtons:i,selection:l,className:c,headerClassName:d,footerClassName:u,showCloseButton:m,showCancelButton:p=!0}=e,{selectHandler:f,selectClasses:h,selectText:g}=l||{};return s.jsxs(Ji,{showCloseButton:m,ref:t,className:di("shadow-2xl dark:bg-gray-700",c||""),onClick:e=>e.stopPropagation(),children:[s.jsxs(el,{className:di(d??""),children:[s.jsx(nl,{className:"text-lg font-medium leading-6 text-gray-800 dark:text-gray-200",children:n}),a&&s.jsx(sl,{className:"text-gray-600 dark:text-gray-300",children:a})]}),s.jsx("div",{className:"px-6",children:r||null}),s.jsxs(tl,{className:u,children:[s.jsx("div",{children:i||null}),s.jsxs("div",{className:"flex h-auto gap-3",children:[p&&s.jsx(al,{className:"border-gray-100 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-600",children:"cancel"}),o||null,l?s.jsx(al,{onClick:f,className:`${h||"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} inline-flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm`,children:g}):null]})]})]})}));function Fd({title:e,value:t,disabled:a,setValue:r,availableValues:o,showAbove:i=!1,showLabel:l=!0,emptyTitle:c=!1,iconSide:d="right",optionIconSide:u="left",placeholder:m,containerClassName:p,optionsListClass:f,optionsClass:h,currentValueClass:g,subContainerClassName:x,className:v,renderOption:b,searchClassName:_,searchPlaceholder:y,showOptionIcon:j=!1}){const w={className:"top-full mt-3"};i&&(w.className="bottom-full mb-3");let N=e;c&&(N="");const C=o??[],[k,S]=Gl({availableOptions:C,placeholder:y,getTextKeyOverride:e=>{return(t=e,"string"==typeof t?t:"label"in t?t.label??"":"value"in t?(t.value??"")+"":"").toUpperCase();var t},className:_,disabled:a}),T=null!=S?k:C,E=j&&null!=t&&null!=t.icon,R=n.useRef(null);return s.jsx("div",{className:di("flex items-center justify-center gap-2",p??""),children:s.jsx("div",{className:di("relative w-full",x??""),children:s.jsx(Gr,{value:t,onChange:r,disabled:a,children:({open:e})=>s.jsxs(s.Fragment,{children:[s.jsxs(Kr,{ref:R,"data-testid":"select-dropdown-button",onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),!e&&R.current&&R.current.click())},className:di("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:bg-white dark:border-gray-600 dark:bg-gray-700 sm:text-sm",v??""),children:[l&&s.jsx(Wr,{className:"block text-xs text-gray-700 dark:text-gray-500",id:"headlessui-listbox-label-:r1:","data-headlessui-state":"",children:N}),s.jsx("span",{className:"inline-flex w-full truncate",children:s.jsxs("span",{className:di("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",l?"":"text-xs",g??""),children:[!l&&!c&&s.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[N,":"]}),E&&"right"!==u&&s.jsx("span",{className:"icon-md flex items-center",children:t.icon}),E&&s.jsx("span",{className:"icon-md absolute right-0 mr-8 flex items-center",children:t.icon}),t?"string"!=typeof t?t.label??"":t:s.jsx("span",{className:"text-text-secondary",children:m})]})}),s.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:i?{transform:"scaleY(-1)"}:{},children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),s.jsx(qr,{show:e,as:"div",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",...w,children:s.jsxs(Qr,{className:di("absolute z-10 mt-2 max-h-60 w-full overflow-auto rounded border bg-white text-xs ring-black/10 dark:border-gray-600 dark:bg-gray-700 dark:ring-white/20 md:w-[100%]",f??""),children:[b&&s.jsx(Yr,{value:null,className:di("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-700",h??""),children:b()},"listbox-render-option"),S,T.map(((e,n)=>{if(!e)return null;const a="string"==typeof e?e:e.label??e.value??"",r="string"==typeof e?e:e.value??"",o="string"==typeof e?null:e.icon??null;let i=t;return"string"!=typeof i&&(i=(null==i?void 0:i.value)??""),s.jsx(Yr,{value:e,className:({active:e})=>di("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-600",e?"bg-surface-active text-text-primary":"",h??""),children:s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[s.jsxs("span",{className:di("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",e===t?"font-semibold":"","left"===d?"ml-4":""),children:[null!=o&&s.jsx("span",{className:di("mr-1","right"===u?"absolute right-0 pr-2":""),children:o}),a]}),r===i&&s.jsx("span",{className:di("absolute inset-y-0 flex items-center text-gray-800 dark:text-gray-200","left"===d?"left-0 pl-2":"right-0 pr-3"),children:s.jsx(ic,{})})]})},n)}))]})})]})})})})}var zd=n.memo((function({selectedValue:e,displayValue:t,items:a,setValue:r,ariaLabel:o,searchPlaceholder:i,selectPlaceholder:l,containerClassName:c,isCollapsed:d,SelectIcon:u,showCarat:m,className:p,disabled:f,iconClassName:h,iconSide:g="left",selectId:x}){const[v,b]=n.useState(""),_=n.useRef(null),[y,j]=n.useState(null),w=e=>({id:`item-${e.value}`,value:e.value,label:e.label,icon:e.icon}),N=I({defaultItems:a.map(w),resetValueOnHide:!0,value:v,setValue:b}),C=P({combobox:N,defaultItems:a.map(w),value:e,setValue:r}),k=n.useMemo((()=>A(a,v,{keys:["value","label"],baseSort:(e,t)=>e.index<t.index?-1:1}).map(w)),[v,a]);n.useEffect((()=>{_.current&&!d&&j(_.current.offsetWidth)}),[d]);const S=di("flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",h),T=di("mr-2 flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",h);return s.jsxs("div",{className:di("flex w-full items-center justify-center px-1",c),children:[s.jsx(M,{store:C,className:"sr-only",children:o}),s.jsxs(L,{ref:_,store:C,id:x,disabled:f,className:di("flex items-center justify-center gap-2 rounded-full bg-surface-secondary","text-text-primary hover:bg-surface-tertiary","border border-border-light",d?"h-10 w-10":"h-10 w-full rounded-xl px-3 py-2 text-sm",p),children:[null!=u&&"left"===g&&s.jsx("div",{className:S,children:u}),!d&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"flex-grow truncate text-left",children:null!=t?t||l:e||l}),null!=u&&"right"===g&&s.jsx("div",{className:S,children:u}),m&&s.jsx(O,{className:"h-4 w-4 text-text-secondary"})]})]}),s.jsxs(D,{store:C,gutter:4,portal:!0,className:di("animate-popover z-50 overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-lg"),style:{width:d?"300px":y??"300px"},children:[s.jsx("div",{className:"py-1.5",children:s.jsxs("div",{className:"relative",children:[s.jsx(F,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-text-primary"}),s.jsx(z,{store:N,autoSelect:!0,placeholder:i,className:"w-full rounded-md bg-surface-secondary py-2 pl-9 pr-3 text-sm text-text-primary focus:outline-none"})]})}),s.jsx("div",{className:"max-h-[300px] overflow-auto",children:s.jsx(U,{store:N,children:s.jsx(V,{store:C,items:k,itemSize:36,overscan:5,children:({value:e,icon:t,label:n,...a})=>s.jsxs(B,{...a,className:di("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:s.jsx($,{value:e}),children:[null!=t&&"left"===g&&s.jsx("div",{className:T,children:t}),s.jsx("span",{className:"flex-grow truncate text-left",children:n}),null!=t&&"right"===g&&s.jsx("div",{className:T,children:t})]},a.id)})})})]})]})}));const Ud=n.forwardRef(((e,t)=>{const n=Ki(),{title:a,main:r,buttons:o,selection:i,className:l,leftButtons:c,description:d="",mainClassName:u,headerClassName:m,footerClassName:p,showCloseButton:f,overlayClassName:h,showCancelButton:g=!0}=e,{selectHandler:x,selectClasses:v,selectText:b,isLoading:_}=i||{};return s.jsxs(xl,{overlayClassName:h,showCloseButton:f,ref:t,className:di("w-11/12 border-none bg-background text-foreground",l??""),onClick:e=>e.stopPropagation(),children:[s.jsxs(vl,{className:di(m??""),children:[s.jsx(_l,{children:a}),d&&s.jsx(yl,{className:"items-center justify-center",children:d})]}),s.jsx("div",{className:di("px-0 py-2",u),children:null!=r?r:null}),s.jsxs(bl,{className:p,children:[s.jsx("div",{children:null!=c?s.jsx("div",{className:"mt-3 flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:mt-0 sm:flex-row",children:c}):null}),s.jsxs("div",{className:"flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:flex-row",children:[g&&s.jsx(hl,{asChild:!0,children:s.jsx(Si,{variant:"outline",children:n("com_ui_cancel")})}),null!=o?o:null,i?s.jsx(hl,{onClick:x,disabled:_,className:`${v??"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm disabled:opacity-80 max-sm:order-first max-sm:w-full sm:order-none`,children:!0===_?s.jsx(rc,{className:"size-4 text-white"}):b}):null]})]})]})})),Vd=n.forwardRef((({className:e,options:t,onSelect:a,...r},o)=>{const[i,l]=n.useState(!1),[c,d]=n.useState(r.value||""),[u,m]=n.useState(-1),p=n.useRef(null),f=e=>{d(e),l(!1),m(-1),a&&a(e),r.onChange&&r.onChange({target:{value:e}})};return n.useEffect((()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&(l(!1),m(-1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),s.jsxs("div",{className:"relative",ref:p,children:[s.jsxs("div",{className:"relative",children:[s.jsx(cl,{...r,value:c,onChange:e=>{d(e.target.value),r.onChange&&r.onChange(e)},onKeyDown:e=>{switch(e.key){case"ArrowDown":e.preventDefault(),i?m((e=>e<t.length-1?e+1:e)):l(!0);break;case"ArrowUp":e.preventDefault(),m((e=>e>0?e-1:0));break;case"Enter":e.preventDefault(),i&&-1!==u&&f(t[u]),l(!1);break;case"Escape":l(!1),m(-1)}},"aria-haspopup":"listbox","aria-controls":"dropdown-list",className:di("bg-surface-secondary",e??""),ref:o}),s.jsx("button",{type:"button",className:"text-tertiary absolute inset-y-0 right-0 flex items-center rounded-md px-2 hover:text-secondary focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring-primary",onClick:()=>l(!i),"aria-label":i?"Close dropdown":"Open dropdown",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),i&&s.jsx("ul",{id:"dropdown-list",role:"listbox",className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md border border-border-medium bg-surface-secondary shadow-lg focus:ring-1 focus:ring-inset focus:ring-ring-primary",children:t.map(((e,t)=>s.jsx("li",{role:"option","aria-selected":t===u,className:di("cursor-pointer rounded-md px-3 py-2","focus:bg-surface-tertiary focus:outline-none focus:ring-1 focus:ring-inset focus:ring-ring-primary",t===u?"bg-surface-active text-primary":"text-secondary hover:bg-surface-tertiary"),onClick:()=>f(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),f(e))},tabIndex:0,children:e},t)))})]})}));Vd.displayName="InputWithDropdown";const Bd=n.createContext({showToast:()=>({})});function $d(){return n.useContext(Bd)}function Hd({children:e}){const{showToast:t}=Bi();return s.jsx(Bd.Provider,{value:{showToast:t},children:e})}class Gd{constructor(e){t(this,"mediaSource",new MediaSource),t(this,"audioChunks",[]),t(this,"sourceBuffer"),this.mediaSource.addEventListener("sourceopen",(async()=>{this.sourceBuffer=this.mediaSource.addSourceBuffer(e),this.sourceBuffer.addEventListener("updateend",(()=>{this.tryAppendNextChunk()}))}))}tryAppendNextChunk(){null!=this.sourceBuffer&&!this.sourceBuffer.updating&&this.audioChunks.length>0&&this.sourceBuffer.appendBuffer(this.audioChunks.shift())}addBase64Data(e){this.addData(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))).buffer)}addData(e){this.audioChunks.push(e),this.tryAppendNextChunk()}close(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}get mediaSourceUrl(){return URL.createObjectURL(this.mediaSource)}}const Kd=7e3;var Wd={},qd=function(){return qd=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},qd.apply(this,arguments)};function Qd(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n}function Yd(e,t,n,s){return new(n||(n=Promise))((function(t,a){function r(e){try{i(s.next(e))}catch(t){a(t)}}function o(e){try{i(s.throw(e))}catch(t){a(t)}}function i(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(r,o)}i((s=s.apply(e,[])).next())}))}function Xd(e,t){var n,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&i[0]?s.return:i[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function Zd(e,t,n){if(n||2===arguments.length)for(var s,a=0,r=t.length;a<r;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var Jd,eu,tu,nu,su,au,ru,ou=/^\${(.+)}$/;function iu(e){if(!e)return e;var t=e.trim(),n=t.match(ou);if(n){var s=n[1];return Wd[s]||t}for(var a,r=/\${([^}]+)}/g,o=t,i=[];null!==(a=r.exec(t));)i.push({fullMatch:a[0],varName:a[1],index:a.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(s=c.varName,c.index),m=Wd[s]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}(ru=Jd||(Jd={})).execute_code="execute_code",ru.code_interpreter="code_interpreter",ru.file_search="file_search",ru.web_search="web_search",ru.retrieval="retrieval",ru.function="function",ru.memory="memory",ru.ui_resources="ui_resources",function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.context="context",e.ocr="ocr"}(eu||(eu={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(tu||(tu={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(nu||(nu={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(su||(su={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(au||(au={}));var lu,cu="_action_";!function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(lu||(lu={}));var du,uu={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(du||(du={}));var mu=[{key:"not_matched",label:"com_ui_feedback_tag_not_matched",direction:"thumbsDown",icon:"AlertCircle"},{key:"inaccurate",label:"com_ui_feedback_tag_inaccurate",direction:"thumbsDown",icon:"AlertCircle"},{key:"bad_style",label:"com_ui_feedback_tag_bad_style",direction:"thumbsDown",icon:"PenTool"},{key:"missing_image",label:"com_ui_feedback_tag_missing_image",direction:"thumbsDown",icon:"ImageOff"},{key:"unjustified_refusal",label:"com_ui_feedback_tag_unjustified_refusal",direction:"thumbsDown",icon:"Ban"},{key:"not_helpful",label:"com_ui_feedback_tag_not_helpful",direction:"thumbsDown",icon:"ThumbsDown"},{key:"other",label:"com_ui_feedback_tag_other",direction:"thumbsDown",icon:"HelpCircle"},{key:"accurate_reliable",label:"com_ui_feedback_tag_accurate_reliable",direction:"thumbsUp",icon:"CheckCircle"},{key:"creative_solution",label:"com_ui_feedback_tag_creative_solution",direction:"thumbsUp",icon:"Lightbulb"},{key:"clear_well_written",label:"com_ui_feedback_tag_clear_well_written",direction:"thumbsUp",icon:"PenTool"},{key:"attention_to_detail",label:"com_ui_feedback_tag_attention_to_detail",direction:"thumbsUp",icon:"Search"}];function pu(e){return mu.filter((function(t){return t.direction===e}))}var fu,hu,gu,xu,vu,bu=uo(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),_u=uo(["thumbsUp","thumbsDown"]),yu=mo({rating:_u,tag:bu,text:po().max(1024).optional()});function ju(e){if((null==e?void 0:e.rating)&&(null==e?void 0:e.tag)&&e.tag.key)return{rating:e.rating,tag:e.tag.key,text:e.text}}function wu(e){if(e)return mu.find((function(t){return t.key===e}))}po().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(vu||(vu={}));var Nu,Cu=fo(vu);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock",e.chatGPTBrowser="chatGPTBrowser",e.gptPlugins="gptPlugins"}(Nu||(Nu={}));var ku,Su=new Set([Nu.agents,Nu.openAI,Nu.bedrock,Nu.azureOpenAI,Nu.anthropic,Nu.custom,Nu.google]);!function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(ku||(ku={}));var Tu,Eu,Ru,Iu,Pu,Au=function(e,t){var n=e,s=function(e,t){if(e===Nu.bedrock){var n=t.split("."),s=[n[0],n[1]].find((function(e){return Object.values(ku).includes(e)}));return null!=s?s:n[0]}return t}(n,t);return["".concat(n,"-").concat(s),n]},Mu=function(e){var t=null!=e?e:"";return!!t&&t.toLowerCase().endsWith(Nu.assistants)},Lu=function(e){var t=null!=e?e:"";return!!t&&t===Nu.agents},Ou=function(e,t){return!!Su.has(e)||null!=t&&Su.has(t)};!function(e){e.low="low",e.auto="auto",e.high="high"}(Tu||(Tu={})),function(e){e.none="",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(Eu||(Eu={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(Ru||(Ru={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(Iu||(Iu={})),(fu={})[Tu.low]=0,fu[Tu.auto]=1,fu[Tu.high]=2,Tu.low,Tu.auto,Tu.high;var Du=fo(Tu),Fu=fo(Eu),zu=fo(Ru),Uu=fo(Iu),Vu={assistant:"",id:"",name:"",description:"",instructions:"",conversation_starters:[],model:"",functions:[],code_interpreter:!1,image_vision:!1,retrieval:!1,append_current_datetime:!1},Bu=((hu={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[Jd.execute_code]=!1,hu[Jd.file_search]=!1,hu[Jd.web_search]=!1,hu.category="general",hu.support_contact={name:"",email:""},hu),$u=((gu={type:Jd.function})[Jd.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}},gu),Hu=function(e){var t,n;return"function"===e.type&&(null===(t=e.function)||void 0===t?void 0:t.name)===(null===(n=$u.function)||void 0===n?void 0:n.name)},Gu={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:Tu.auto,min:0,max:2,step:1}},Ku={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32768,step:1,default:-1}},Wu=4096,qu={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:128e3,step:1,default:8192,reset:function(e){return/claude-3[-.]5-sonnet/.test(e)||/claude-3[-.]7/.test(e)?8192:4096},set:function(e,t){return!/claude-3[-.]5-sonnet/.test(t)&&!/claude-3[-.]7/.test(t)&&e>Wu?Wu:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:Wu,step:1,default:Wu}},web_search:{default:!1}},Qu={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:Tu.auto}},Yu=((xu={})[Nu.openAI]=Gu,xu[Nu.google]=Ku,xu[Nu.anthropic]=qu,xu[Nu.agents]=Qu,xu[Nu.bedrock]=Qu,xu),Xu=Yu[Nu.google],Zu=fo(Nu),Ju=ho([Zu,po()]),em=mo({authField:po(),label:po(),description:po()}),tm=mo({name:po(),pluginKey:po(),description:po().optional(),icon:po().optional(),authConfig:xo(em).optional(),authenticated:go().optional(),chatMenu:go().optional(),isButton:go().optional(),toolkit:go().optional()}),nm=mo({input:mo({content:po()}),output:mo({content:po()})});!function(e){e.functions="functions",e.classic="classic"}(Pu||(Pu={}));var sm={default:0},am=(Pu.functions,Pu.functions,Pu.classic,{default:!0});fo(Pu);var rm=mo({agent:po().default(Pu.functions),skipCompletion:go().default(am.default),model:po(),temperature:vo().default(sm.default)}),om=mo({messageId:po(),endpoint:po().optional(),clientId:po().nullable().optional(),conversationId:po().nullable(),parentMessageId:po().nullable(),responseMessageId:po().nullable().optional(),overrideParentMessageId:po().nullable().optional(),bg:po().nullable().optional(),model:po().nullable().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),sender:po().optional(),text:po(),generation:po().nullable().optional(),isCreatedByUser:go(),error:go().optional(),clientTimestamp:po().optional(),createdAt:po().optional().default((function(){return(new Date).toISOString()})),updatedAt:po().optional().default((function(){return(new Date).toISOString()})),current:go().optional(),unfinished:go().optional(),searchResult:go().optional(),finish_reason:po().optional(),thread_id:po().optional(),iconURL:po().nullable().optional(),feedback:yu.optional()}),im=ho([vo(),po()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),lm=_o((function(){return ho([yo(),go(),vo(),po(),xo(_o((function(){return lm}))),jo(_o((function(){return lm})))])})),cm=mo({conversationId:po().nullable(),endpoint:Zu.nullable(),endpointType:Zu.nullable().optional(),isArchived:go().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),user:po().optional(),messages:xo(po()).optional(),tools:ho([xo(tm),xo(po())]).optional(),modelLabel:po().nullable().optional(),userLabel:po().optional(),model:po().nullable().optional(),promptPrefix:po().nullable().optional(),temperature:vo().nullable().optional(),topP:vo().optional(),topK:vo().optional(),top_p:vo().optional(),frequency_penalty:vo().optional(),presence_penalty:vo().optional(),parentMessageId:po().optional(),maxOutputTokens:im.nullable().optional(),maxContextTokens:im.optional(),max_tokens:im.optional(),promptCache:go().optional(),system:po().optional(),thinking:go().optional(),thinkingBudget:im.optional(),stream:go().optional(),artifacts:po().optional(),context:po().nullable().optional(),examples:xo(nm).optional(),tags:xo(po()).optional(),createdAt:po(),updatedAt:po(),resendFiles:go().optional(),file_ids:xo(po()).optional(),imageDetail:Du.optional(),reasoning_effort:Fu.optional().nullable(),reasoning_summary:zu.optional().nullable(),verbosity:Uu.optional().nullable(),useResponsesApi:go().optional(),web_search:go().optional(),disableStreaming:go().optional(),assistant_id:po().optional(),agent_id:po().optional(),region:po().optional(),maxTokens:im.optional(),additionalModelRequestFields:lm.optional(),instructions:po().optional(),additional_instructions:po().optional(),append_current_datetime:go().optional(),presetOverride:jo(wo()).optional(),stop:xo(po()).optional(),greeting:po().optional(),spec:po().nullable().optional(),iconURL:po().nullable().optional(),expiredAt:po().nullable().optional(),fileTokenLimit:im.optional(),resendImages:go().optional(),agentOptions:rm.nullable().optional(),chatGptLabel:po().nullable().optional()}),dm=cm.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(mo({conversationId:po().nullable().optional(),presetId:po().nullable().optional(),title:po().nullable().optional(),defaultPreset:go().optional(),order:vo().optional(),endpoint:Ju.nullable()})),um=cm.merge(mo({endpoint:Ju.nullable(),createdAt:po().optional(),updatedAt:po().optional()})),mm=cm.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(mo({endpoint:Ju.nullable()}));mo({conversationId:po(),shareId:po(),messages:xo(po()),isPublic:go(),title:po(),createdAt:po(),updatedAt:po()}),mo({_id:po(),user:po(),tag:po(),description:po().optional(),createdAt:po(),updatedAt:po(),count:vo(),position:vo()});var pm=cm.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),fm=pm.transform((function(e){return xm(e)})).catch((function(){return{}}));mo({maxOutputTokens:im.optional(),temperature:im.optional(),topP:im.optional(),topK:im.optional(),presencePenalty:im.optional(),frequencyPenalty:im.optional(),stopSequences:xo(po()).optional(),thinkingConfig:mo({includeThoughts:go().optional(),thinkingBudget:im.optional()}).optional(),web_search:go().optional()}).strip().optional();var hm=cm.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,artifacts:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),gm=hm.transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h=qd(qd({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(s=null!==(n=e.chatGptLabel)&&void 0!==n?n:e.modelLabel)&&void 0!==s?s:null,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:.8,top_p:null!==(o=e.top_p)&&void 0!==o?o:1,presence_penalty:null!==(i=e.presence_penalty)&&void 0!==i?i:0,frequency_penalty:null!==(l=e.frequency_penalty)&&void 0!==l?l:0,tools:null!==(c=e.tools)&&void 0!==c?c:[],agentOptions:null!==(d=e.agentOptions)&&void 0!==d?d:{agent:Pu.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,spec:null!==(p=e.spec)&&void 0!==p?p:void 0,maxContextTokens:null!==(f=e.maxContextTokens)&&void 0!==f?f:void 0});return null!=e.modelLabel&&""!==e.modelLabel&&(h.modelLabel=null),h})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:Pu.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:void 0,greeting:void 0,spec:void 0,maxContextTokens:void 0}}));function xm(e,t){var n=qd({},e);return Object.keys(n).forEach((function(e){var s=n[e];null==s&&delete n[e],t&&"string"==typeof s&&""===s&&delete n[e]})),n}var vm,bm,_m,ym=cm.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,s,a,r,o,i,l;return qd(qd({},e),{model:null!==(t=e.model)&&void 0!==t?t:Gu.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(s=e.instructions)&&void 0!==s?s:void 0,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:Gu.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),jm=cm.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return xm(e)})).catch((function(){return{}}));cm.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p;return qd(qd({},e),{model:null!==(t=e.model)&&void 0!==t?t:Qu.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(s=e.temperature)&&void 0!==s?s:1,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:Qu.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:Tu.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:Qu.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:Qu.resendFiles.default,imageDetail:Tu.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}}));var wm=cm.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return xm(e,!0)})).catch((function(){return{}})),Nm=pm.transform((function(e){var t=qd({},e);return t.temperature===Xu.temperature.default&&delete t.temperature,t.maxOutputTokens===Xu.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Xu.topP.default&&delete t.topP,t.topK===Xu.topK.default&&delete t.topK,xm(t)})).catch((function(){return{}})),Cm=cm.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return xm(e)})).catch((function(){return{}})),km=hm.transform((function(e){var t,n=qd({},e);return null===n.modelLabel&&delete n.modelLabel,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&n.agentOptions.agent===Pu.functions&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,xm(n)})).catch((function(){return{}}));mo({bannerId:po(),message:po(),displayFrom:po(),displayTo:po(),createdAt:po(),updatedAt:po(),isPublic:go()});var Sm=cm.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return xm(e)})).catch((function(){return{}})),Tm=mo({name:po(),label:po(),preset:dm,order:vo().optional(),default:go().optional(),description:po().optional(),showIconInMenu:go().optional(),showIconInHeader:go().optional(),iconURL:ho([po(),Zu]).optional(),authType:Cu.optional()}),Em=mo({enforce:go().default(!1),prioritize:go().default(!0),list:xo(Tm).min(1),addedEndpoints:xo(ho([po(),Zu])).optional()}),Rm=((vm={})[Nu.openAI]=!0,vm[Nu.google]=!0,vm[Nu.assistants]=!0,vm[Nu.azureAssistants]=!0,vm[Nu.agents]=!0,vm[Nu.azureOpenAI]=!0,vm[Nu.anthropic]=!0,vm[Nu.custom]=!0,vm[Nu.bedrock]=!0,vm),Im=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];Zd(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip","image/svg","image/svg+xml"],Im,!0),Zd(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],Im,!0);var Pm=/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i,Am=/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,Mm=/^image\/(jpeg|gif|png|webp|heic|heif)$/,Lm=/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|x-m4a|flac|x-flac|webm)$/,Om=[Mm,/^application\/pdf$/,/^application\/vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)$/,/^application\/vnd\.ms-(word|powerpoint|excel)$/,/^application\/epub\+zip$/],Dm=[Lm],Fm=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/,Am,/^(application\/(epub\+zip|csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,Mm,Lm,/^image\/(svg|svg\+xml)$/],zm={c:"text/x-c",cs:"text/x-csharp",cpp:"text/x-c++",h:"text/x-h",md:"text/markdown",php:"text/x-php",py:"text/x-python",rb:"text/x-ruby",tex:"text/x-tex",js:"text/javascript",sh:"application/x-sh",ts:"application/typescript",tar:"application/x-tar",zip:"application/zip",yml:"application/x-yaml",yaml:"application/x-yaml",log:"text/plain",tsv:"text/tab-separated-values"},Um=[/^(text\/(x-c|x-c\+\+|x-h|html|x-java|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|vtt|xml))$/,/^(application\/(json|pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation)))$/],Vm=1048576,Bm=function(e){return e*Vm},$m=Bm(512),Hm={fileLimit:10,fileSizeLimit:$m,totalSizeLimit:$m,supportedMimeTypes:Fm,disabled:!1},Gm={endpoints:(bm={},bm[Nu.assistants]=Hm,bm[Nu.azureAssistants]=Hm,bm[Nu.agents]=Hm,bm.default={fileLimit:10,fileSizeLimit:$m,totalSizeLimit:$m,supportedMimeTypes:Fm,disabled:!1},bm),serverFileSizeLimit:$m,avatarSizeLimit:Bm(2),fileTokenLimit:1e5,clientImageResize:{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},ocr:{supportedMimeTypes:Om},text:{supportedMimeTypes:[/^[\w.-]+\/[\w.-]+$/]},stt:{supportedMimeTypes:Dm},checkType:function(e,t){return void 0===t&&(t=Fm),t.some((function(t){return t.test(e)}))}},Km=xo(No()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),Wm=mo({disabled:go().optional(),fileLimit:vo().min(0).optional(),fileSizeLimit:vo().min(0).optional(),totalSizeLimit:vo().min(0).optional(),supportedMimeTypes:Km.optional()}),qm=mo({endpoints:jo(Wm).optional(),serverFileSizeLimit:vo().min(0).optional(),avatarSizeLimit:vo().min(0).optional(),fileTokenLimit:vo().min(0).optional(),imageGeneration:mo({percentage:vo().min(0).max(100).optional(),px:vo().min(0).optional()}).optional(),clientImageResize:mo({enabled:go().optional(),maxWidth:vo().min(0).optional(),maxHeight:vo().min(0).optional(),quality:vo().min(0).max(1).optional()}).optional(),ocr:mo({supportedMimeTypes:Km.optional()}).optional(),text:mo({supportedMimeTypes:Km.optional()}).optional()}),Qm=function(e){return e.reduce((function(e,t){try{var n=new RegExp(t);e.push(n)}catch(s){console.error('Invalid regex pattern "'.concat(t,'" skipped.'),s)}return e}),[])};function Ym(e){var t,n,s,a=qd(qd({},Gm),{ocr:qd(qd({},Gm.ocr),{supportedMimeTypes:(null===(t=Gm.ocr)||void 0===t?void 0:t.supportedMimeTypes)||[]}),text:qd(qd({},Gm.text),{supportedMimeTypes:(null===(n=Gm.text)||void 0===n?void 0:n.supportedMimeTypes)||[]}),stt:qd(qd({},Gm.stt),{supportedMimeTypes:(null===(s=Gm.stt)||void 0===s?void 0:s.supportedMimeTypes)||[]})});if(!e)return a;if(void 0!==e.serverFileSizeLimit&&(a.serverFileSizeLimit=Bm(e.serverFileSizeLimit)),void 0!==e.avatarSizeLimit&&(a.avatarSizeLimit=Bm(e.avatarSizeLimit)),void 0!==e.fileTokenLimit&&(a.fileTokenLimit=e.fileTokenLimit),void 0!==e.clientImageResize&&(a.clientImageResize=qd(qd({},a.clientImageResize),e.clientImageResize)),void 0!==e.ocr&&(a.ocr=qd(qd({},a.ocr),e.ocr),e.ocr.supportedMimeTypes&&(a.ocr.supportedMimeTypes=Qm(e.ocr.supportedMimeTypes))),void 0!==e.text&&(a.text=qd(qd({},a.text),e.text),e.text.supportedMimeTypes&&(a.text.supportedMimeTypes=Qm(e.text.supportedMimeTypes))),!e.endpoints)return a;var r=function(t){var n=e.endpoints[t];a.endpoints[t]||(a.endpoints[t]={});var s=a.endpoints[t];if(!0===n.disabled)return s.disabled=!0,s.fileLimit=0,s.fileSizeLimit=0,s.totalSizeLimit=0,s.supportedMimeTypes=[],"continue";void 0!==n.fileSizeLimit&&(s.fileSizeLimit=Bm(n.fileSizeLimit)),void 0!==n.totalSizeLimit&&(s.totalSizeLimit=Bm(n.totalSizeLimit)),["fileLimit"].forEach((function(e){void 0!==n[e]&&(s[e]=n[e])})),n.supportedMimeTypes&&(s.supportedMimeTypes=Qm(n.supportedMimeTypes))};for(var o in e.endpoints)r(o);return a}!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(_m||(_m={}));var Xm,Zm,Jm,ep,tp=function(e){return e===_m.openai||e===_m.azure};!function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(Xm||(Xm={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(Zm||(Zm={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(Jm||(Jm={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(ep||(ep={}));var np=mo({startup:go().optional(),iconPath:po().optional(),timeout:vo().optional(),initTimeout:vo().optional(),chatMenu:go().optional(),serverInstructions:ho([go(),po()]).optional(),requiresOAuth:go().optional(),oauth:mo({authorization_url:po().url().optional(),token_url:po().url().optional(),client_id:po().optional(),client_secret:po().optional(),scope:po().optional(),redirect_uri:po().url().optional(),token_exchange_method:fo(ep).optional(),grant_types_supported:xo(po()).optional(),token_endpoint_auth_methods_supported:xo(po()).optional(),response_types_supported:xo(po()).optional(),code_challenge_methods_supported:xo(po()).optional(),revocation_endpoint:po().url().optional(),revocation_endpoint_auth_methods_supported:xo(po()).optional()}).optional(),customUserVars:jo(po(),mo({title:po(),description:po()})).optional()}),sp=np.extend({type:bo("stdio").optional(),command:po(),args:xo(po()),env:jo(po(),po()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,s=Object.entries(e);n<s.length;n++){var a=s[n],r=a[0],o=a[1];t[r]=iu(o)}return t})),stderr:No().optional()}),ap=np.extend({type:bo("websocket").optional(),url:po().transform((function(e){return iu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),rp=np.extend({type:bo("sse").optional(),headers:jo(po(),po()).optional(),url:po().transform((function(e){return iu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),op=np.extend({type:ho([bo("streamable-http"),bo("http")]),headers:jo(po(),po()).optional(),url:po().transform((function(e){return iu(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),ip=ho([sp,ap,rp,op]),lp=jo(po(),ip),cp="";if(void 0===xe||!0===xe.browser){var dp=document.querySelector("base");cp=(null==dp?void 0:dp.getAttribute("href"))||"/"}cp&&cp.endsWith("/")&&(cp=cp.slice(0,-1));var up,mp,pp,fp,hp,gp,xp,vp,bp,_p=function(){return cp},yp=function(e){var t=Object.entries(e).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&");return t?"?".concat(t):""},jp="".concat(cp,"/api/messages"),wp=function(e){var t=e.conversationId,n=e.messageId,s=Qd(e,["conversationId","messageId"]);return t&&n?"".concat(jp,"/").concat(t,"/").concat(n):t?"".concat(jp,"/").concat(t):"".concat(jp).concat(yp(s))},Np=function(e){return"".concat(jp,"/artifacts/").concat(e)},Cp="".concat(cp,"/api/share"),kp=function(e){return"".concat(Cp,"/").concat(e)},Sp=function(e,t,n,s,a,r){return"".concat(Cp,"?pageSize=").concat(e,"&isPublic=").concat(t,"&sortBy=").concat(n,"&sortDirection=").concat(s).concat(a?"&search=".concat(a):"").concat(r?"&cursor=".concat(r):"")},Tp="".concat(cp,"/api/keys"),Ep="".concat(cp,"/api/convos"),Rp=function(e){return"".concat(Ep).concat(yp(e))},Ip=function(){return"".concat(Ep,"/update")},Pp=function(){return"".concat(cp,"/api/presets")},Ap=function(){return"".concat(cp,"/api/prompts")},Mp=function(e){var t=e.path,n=void 0===t?"":t,s=e.options,a=e.version,r=e.endpoint,o=!0===e.isAvatar?"".concat(Fp(),"/assistants"):"".concat(cp,"/api/assistants/v").concat(a);if(n&&""!==n&&(o+="/".concat(n)),r&&(s=qd(qd({},null!=s?s:{}),{endpoint:r})),s&&Object.keys(s).length>0){var i=new URLSearchParams(s).toString();o+="?".concat(i)}return o},Lp=function(e){var t=e.path,n=void 0===t?"":t,s=e.options,a="".concat(cp,"/api/agents");if(n&&""!==n&&(a+="/".concat(n)),s&&Object.keys(s).length>0){var r=new URLSearchParams(s).toString();a+="?".concat(r)}return a},Op={tools:"".concat(cp,"/api/mcp/tools")},Dp=function(){return"".concat(cp,"/api/files")},Fp=function(){return"".concat(Dp(),"/images")},zp=function(){return"".concat(Dp(),"/speech")},Up=function(){return"".concat(zp(),"/tts")},Vp=function(e){return"".concat(Ap(),"/groups/").concat(e)},Bp=function(e){return"".concat(Ap(),"/").concat(e)},$p=Ap,Hp=Vp,Gp=Vp,Kp=function(e){return"".concat("".concat(cp,"/api/roles"),"/").concat(e.toLowerCase())},Wp=function(e){return"".concat(cp,"/api/tags").concat(null!=e&&e?"/".concat(encodeURIComponent(e)):"")},qp=function(){return"".concat(cp,"/api/memories")},Qp=function(e){return"".concat(qp(),"/").concat(encodeURIComponent(e))},Yp=new Set(["conversationId","title","iconURL","greeting","endpoint","endpointType","createdAt","updatedAt","expiredAt","messages","isArchived","tags","user","__v","_id","tools","model","files","spec","disableParams"]);!function(e){e.default="default",e.advanced="advanced"}(bp||(bp={}));var Xp=fo(_m),Zp=mo({default:Xp.optional(),avatar:Xp.optional(),image:Xp.optional(),document:Xp.optional()}).optional();var Jp,ef,tf=mo({deploymentName:po().optional(),version:po().optional(),assistants:go().optional()}).or(go()),nf=mo({apiKey:po(),serverless:go().optional(),instanceName:po().optional(),deploymentName:po().optional(),assistants:go().optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),forcePrompt:go().optional(),version:po().optional(),baseURL:po().optional(),additionalHeaders:jo(No()).optional()}),sf=mo({group:po(),models:jo(po(),tf)}).required().and(nf),af=xo(sf).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(Jp||(Jp={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.context="context",e.tools="tools",e.chain="chain",e.ocr="ocr"}(ef||(ef={}));var rf,of=((up={})[Nu.assistants]=2,up[Nu.azureAssistants]=1,up),lf=mo({streamRate:vo().optional(),baseURL:po().optional(),titlePrompt:po().optional(),titleModel:po().optional(),titleConvo:go().optional(),titleMethod:ho([bo("completion"),bo("functions"),bo("structured")]).optional(),titleEndpoint:po().optional(),titlePromptTemplate:po().optional()});lf.merge(mo({availableRegions:xo(po()).optional()}));var cf=lf.merge(mo({disableBuilder:go().optional(),pollIntervalMs:vo().optional(),timeoutMs:vo().optional(),version:ho([po(),vo()]).default(2),supportedIds:xo(po()).min(1).optional(),excludedIds:xo(po()).min(1).optional(),privateAssistants:go().optional(),retrievalModels:xo(po()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:xo(fo(Jp)).optional().default([Jp.code_interpreter,Jp.image_vision,Jp.retrieval,Jp.actions,Jp.tools]),apiKey:po().optional(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}).optional(),headers:jo(No()).optional()})),df=[ef.execute_code,ef.file_search,ef.web_search,ef.artifacts,ef.actions,ef.context,ef.tools,ef.chain,ef.ocr],uf=lf.merge(mo({recursionLimit:vo().optional(),disableBuilder:go().optional().default(!1),maxRecursionLimit:vo().optional(),maxCitations:vo().min(1).max(50).optional().default(30),maxCitationsPerFile:vo().min(1).max(10).optional().default(7),minRelevanceScore:vo().min(0).max(1).optional().default(.45),allowedProviders:xo(ho([po(),Zu])).optional(),capabilities:xo(fo(ef)).optional().default(df)})).default({disableBuilder:!1,capabilities:df,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),mf=lf.merge(mo({name:po().refine((function(e){return!Zu.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(Nu).join(", "))}),apiKey:po(),baseURL:po(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}),summarize:go().optional(),summaryModel:po().optional(),iconURL:po().optional(),forcePrompt:go().optional(),modelDisplayLabel:po().optional(),headers:jo(No()).optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),customParams:mo({defaultParamsEndpoint:po().default("custom"),paramDefinitions:xo(jo(No())).optional()}).strict(),customOrder:vo().optional(),directEndpoint:go().optional(),titleMessageRole:po().optional()})),pf=mo({groups:af,plugins:go().optional(),assistants:go().optional()}).and(mf.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),ff=mo({url:po().optional(),apiKey:po(),model:po(),voices:xo(po())}),hf=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po(),model:po(),voices:xo(po())}),gf=mo({url:po().optional(),websocketUrl:po().optional(),apiKey:po(),model:po(),voices:xo(po()),voice_settings:mo({similarity_boost:vo().optional(),stability:vo().optional(),style:vo().optional(),use_speaker_boost:go().optional()}).optional(),pronunciation_dictionary_locators:xo(po()).optional()}),xf=mo({url:po(),apiKey:po().optional(),voices:xo(po()),backend:po()}),vf=mo({openai:ff.optional(),azureOpenAI:hf.optional(),elevenlabs:gf.optional(),localai:xf.optional()}),bf=mo({url:po().optional(),apiKey:po(),model:po()}),_f=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po()}),yf=mo({openai:bf.optional(),azureOpenAI:_f.optional()}),jf=mo({conversationMode:go().optional(),advancedMode:go().optional(),speechToText:go().optional().or(mo({engineSTT:po().optional(),languageSTT:po().optional(),autoTranscribeAudio:go().optional(),decibelValue:vo().optional(),autoSendText:vo().optional()})).optional(),textToSpeech:go().optional().or(mo({engineTTS:po().optional(),voice:po().optional(),languageTTS:po().optional(),automaticPlayback:go().optional(),playbackRate:vo().optional(),cacheTTS:go().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(rf||(rf={}));var wf,Nf=mo({fileUploads:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),conversationsImport:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),tts:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),stt:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(wf||(wf={}));var Cf,kf,Sf,Tf,Ef,Rf,If=mo({externalUrl:po().optional(),openNewTab:go().optional(),modalAcceptance:go().optional(),modalTitle:po().optional(),modalContent:po().or(xo(po())).optional()}),Pf=mo({placeholder:po().optional()}),Af=mo({privacyPolicy:mo({externalUrl:po().optional(),openNewTab:go().optional()}).optional(),termsOfService:If.optional(),customWelcome:po().optional(),mcpServers:Pf.optional(),endpointsMenu:go().optional(),modelSelect:go().optional(),parameters:go().optional(),sidePanel:go().optional(),multiConvo:go().optional(),bookmarks:go().optional(),memories:go().optional(),presets:go().optional(),prompts:go().optional(),agents:go().optional(),temporaryChat:go().optional(),temporaryChatRetention:vo().min(1).max(8760).optional(),runCode:go().optional(),webSearch:go().optional(),peoplePicker:mo({users:go().optional(),groups:go().optional(),roles:go().optional()}).optional(),marketplace:mo({use:go().optional()}).optional(),fileSearch:go().optional(),fileCitations:go().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},fileSearch:!0,fileCitations:!0}),Mf=mo({language:po().default("auto"),size:uo(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),Lf=mo({siteKey:po(),options:Mf.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(Cf||(Cf={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}(kf||(kf={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(Sf||(Sf={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(Tf||(Tf={})),function(e){e.JINA="jina",e.COHERE="cohere"}(Ef||(Ef={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(Rf||(Rf={}));var Of,Df,Ff=mo({serperApiKey:po().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:po().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:po().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:po().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:po().optional().default("${FIRECRAWL_API_URL}"),jinaApiKey:po().optional().default("${JINA_API_KEY}"),jinaApiUrl:po().optional().default("${JINA_API_URL}"),cohereApiKey:po().optional().default("${COHERE_API_KEY}"),searchProvider:fo(Sf).optional(),scraperType:fo(Tf).optional(),rerankerType:fo(Ef).optional(),scraperTimeout:vo().optional(),safeSearch:fo(Rf).default(Rf.MODERATE),firecrawlOptions:mo({formats:xo(po()).optional(),includeTags:xo(po()).optional(),excludeTags:xo(po()).optional(),headers:jo(po()).optional(),waitFor:vo().optional(),timeout:vo().optional(),maxAge:vo().optional(),mobile:go().optional(),skipTlsVerification:go().optional(),blockAds:go().optional(),removeBase64Images:go().optional(),parsePDF:go().optional(),storeInCache:go().optional(),zeroDataRetention:go().optional(),location:mo({country:po().optional(),languages:xo(po()).optional()}).optional(),onlyMainContent:go().optional(),changeTrackingOptions:mo({modes:xo(po()).optional(),schema:jo(wo()).optional(),prompt:po().optional(),tag:po().nullable().optional()}).optional()}).optional()}),zf=mo({mistralModel:po().optional(),apiKey:po().optional().default("${OCR_API_KEY}"),baseURL:po().optional().default("${OCR_BASEURL}"),strategy:fo(Cf).default(Cf.MISTRAL_OCR)}),Uf=mo({enabled:go().optional().default(!1),startBalance:vo().optional().default(2e4),autoRefillEnabled:go().optional().default(!1),refillIntervalValue:vo().optional().default(30),refillIntervalUnit:uo(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:vo().optional().default(1e4)}),Vf=mo({enabled:go().optional().default(!0)}),Bf=mo({disabled:go().optional(),validKeys:xo(po()).optional(),tokenLimit:vo().optional(),charLimit:vo().optional().default(1e4),personalize:go().default(!0),messageWindowSize:vo().optional().default(5),agent:ho([mo({id:po()}),mo({provider:po(),model:po(),instructions:po().optional(),model_parameters:jo(No()).optional()})]).optional()}),$f=xo(mf.partial()).optional(),Hf=mo({version:po(),cache:go().default(!0),ocr:zf.optional(),webSearch:Ff.optional(),memory:Bf.optional(),secureImageLinks:go().optional(),imageOutputType:fo(wf).default(wf.PNG),includedTools:xo(po()).optional(),filteredTools:xo(po()).optional(),mcpServers:lp.optional(),interface:Af,turnstile:Lf.optional(),fileStrategy:Xp.default(_m.local),fileStrategies:Zp,actions:mo({allowedDomains:xo(po()).optional()}).optional(),registration:mo({socialLogins:xo(po()).optional(),allowedDomains:xo(po()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:Uf.optional(),transactions:Vf.optional(),speech:mo({tts:vf.optional(),stt:yf.optional(),speechTab:jf.optional()}).optional(),rateLimits:Nf.optional(),fileConfig:qm.optional(),modelSpecs:Em.optional(),endpoints:mo((mp={all:lf.optional()},mp[Nu.openAI]=lf.optional(),mp[Nu.google]=lf.optional(),mp[Nu.anthropic]=lf.optional(),mp[Nu.gptPlugins]=lf.optional(),mp[Nu.azureOpenAI]=pf.optional(),mp[Nu.azureAssistants]=cf.optional(),mp[Nu.assistants]=cf.optional(),mp[Nu.agents]=uf.optional(),mp[Nu.custom]=$f.optional(),mp[Nu.bedrock]=lf.optional(),mp)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),Gf=function(){return e=Hf.shape,t=Object.entries(e).map((function(e){var t=e[0],n=e[1];return n instanceof Co?[t,n._def.defaultValue()]:[t,void 0]})),Object.fromEntries(t);var e,t};!function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.vercel="vercel",e.xai="xai"}(Of||(Of={})),(Df||(Df={})).openrouter="openrouter";var Kf,Wf=[Nu.openAI,Nu.assistants,Nu.azureAssistants,Nu.azureOpenAI,Nu.agents,Nu.chatGPTBrowser,Nu.gptPlugins,Nu.google,Nu.anthropic,Nu.custom,Nu.bedrock],qf=((pp={})[Nu.openAI]="OpenAI",pp[Nu.assistants]="Assistants",pp[Nu.agents]="My Agents",pp[Nu.azureAssistants]="Azure Assistants",pp[Nu.azureOpenAI]="Azure OpenAI",pp[Nu.chatGPTBrowser]="ChatGPT",pp[Nu.gptPlugins]="Plugins",pp[Nu.google]="Google",pp[Nu.anthropic]="Anthropic",pp[Nu.custom]="Custom",pp[Nu.bedrock]="AWS Bedrock",pp[Of.ollama]="Ollama",pp[Of.deepseek]="DeepSeek",pp[Of.xai]="xAI",pp[Of.vercel]="Vercel",pp),Qf=["gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],Yf=((fp={})[Nu.azureAssistants]=Qf,fp[Nu.assistants]=Zd(Zd([],Qf,!0),["chatgpt-4o-latest"],!1),fp[Nu.agents]=Qf,fp[Nu.google]=["gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite","gemini-2.0-flash-001","gemini-2.0-flash-lite"],fp[Nu.anthropic]=["claude-sonnet-4-5","claude-sonnet-4-5-20250929","claude-opus-4-1","claude-opus-4-1-20250805","claude-sonnet-4-20250514","claude-sonnet-4-0","claude-opus-4-20250514","claude-opus-4-0","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],fp[Nu.openAI]=Zd(Zd([],Qf,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),fp[Nu.bedrock]=["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],fp),Xf=Yf[Nu.openAI];(hp={initial:[]})[Nu.openAI]=Xf,hp[Nu.assistants]=Xf.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),hp[Nu.agents]=Xf,hp[Nu.gptPlugins]=Xf,hp[Nu.azureOpenAI]=Xf,hp[Nu.chatGPTBrowser]=["text-davinci-002-render-sha"],hp[Nu.google]=Yf[Nu.google],hp[Nu.anthropic]=Yf[Nu.anthropic],hp[Nu.bedrock]=Yf[Nu.bedrock];var Zf=((gp={})[Nu.assistants]="".concat(_p(),"/api/assistants/v2/chat"),gp[Nu.azureAssistants]="".concat(_p(),"/api/assistants/v1/chat"),gp[Nu.agents]="".concat(_p(),"/api/").concat(Nu.agents,"/chat"),gp),Jf=new Set([Nu.gptPlugins,Nu.anthropic,Nu.google,Nu.openAI,Nu.azureOpenAI,Nu.custom,Nu.agents,Nu.bedrock]);(xp={})[Nu.custom]=!0,xp[Nu.openAI]=!0,xp[Nu.anthropic]=!0,xp[Nu.gptPlugins]=!0,xp[Nu.assistants]=!0,xp[Nu.agents]=!0,xp[Nu.azureAssistants]=!0,xp[Nu.azureOpenAI]=!0,xp[Nu.bedrock]=!0,function(e){e.generative="generative",e.agents="agents"}(Kf||(Kf={}));var eh,th,nh,sh,ah,rh,oh,ih,lh,ch,dh,uh,mh,ph,fh,hh,gh,xh,vh=new Set(["dalle","dall-e","stable-diffusion","flux"]);!function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(eh||(eh={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(th||(th={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.PLUGINS="PLUGINS",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(nh||(nh={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(sh||(sh={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed"}(ah||(ah={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(rh||(rh={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(oh||(oh={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(ih||(ih={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(lh||(lh={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}(ch||(ch={})),function(e){e.VERSION="v0.8.0-rc4",e.CONFIG_VERSION="1.2.9",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_server="sys__server__sys",e.EPHEMERAL_AGENT_ID="ephemeral"}(dh||(dh={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(uh||(uh={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(mh||(mh={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(ph||(ph={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(fh||(fh={})),(vp={})[Nu.openAI]=Nu.openAI,vp[Nu.bedrock]=Nu.bedrock,vp[Nu.anthropic]=Nu.anthropic,vp[Nu.azureOpenAI]=Nu.azureOpenAI;var bh={current_date:!0,current_user:!0,iso_datetime:!0,current_datetime:!0};!function(e){e.TEXT="text",e.THINK="think",e.TEXT_DELTA="text_delta",e.TOOL_CALL="tool_call",e.IMAGE_FILE="image_file",e.IMAGE_URL="image_url",e.AGENT_UPDATE="agent_update",e.ERROR="error"}(hh||(hh={})),function(e){e.TOOL_CALLS="tool_calls",e.MESSAGE_CREATION="message_creation"}(gh||(gh={})),function(e){e.FUNCTION="function",e.RETRIEVAL="retrieval",e.FILE_SEARCH="file_search",e.CODE_INTERPRETER="code_interpreter",e.TOOL_CALL="tool_call"}(xh||(xh={}));var _h=cm.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,maxOutputTokens:!0,maxContextTokens:!0,artifacts:!0,region:!0,system:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).transform((function(e){var t,n;if(null!=(null===(t=e.additionalModelRequestFields)||void 0===t?void 0:t.thinking)){var s=e;e.thinking=!!s.additionalModelRequestFields.thinking,e.thinkingBudget="object"==typeof s.additionalModelRequestFields.thinking?null===(n=s.additionalModelRequestFields.thinking)||void 0===n?void 0:n.budget_tokens:void 0,delete e.additionalModelRequestFields}return xm(e)})).catch((function(){return{}}));cm.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,artifacts:!0,maxOutputTokens:!0,maxContextTokens:!0,region:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).catchall(No()).transform((function(e){var t=["modelLabel","promptPrefix","resendFiles","iconURL","greeting","spec","maxOutputTokens","artifacts","additionalModelRequestFields","region","model","maxTokens","temperature","topP","stop"],n={},s=e;return Object.entries(s).forEach((function(e){var a=e[0],r=e[1];t.includes(a)||("topK"===a?n.top_k=r:n[a]=r,delete s[a])})),"string"==typeof s.model&&(s.model.includes("anthropic.claude-3-7-sonnet")||/anthropic\.claude-(?:[4-9](?:\.\d+)?(?:-\d+)?-(?:sonnet|opus|haiku)|(?:sonnet|opus|haiku)-[4-9])/.test(s.model))?(void 0===n.thinking?n.thinking=!0:!1===n.thinking&&(delete n.thinking,delete n.thinkingBudget),!0===n.thinking&&void 0===n.thinkingBudget&&(n.thinkingBudget=2e3),n.anthropic_beta=["output-128k-2025-02-19"]):null==n.thinking&&null==n.thinkingBudget||(delete n.thinking,delete n.thinkingBudget),Object.keys(n).length>0&&(s.additionalModelRequestFields=qd(qd({},s.additionalModelRequestFields||{}),n)),void 0!==s.maxOutputTokens?s.maxTokens=s.maxOutputTokens:void 0!==s.maxTokens&&(s.maxOutputTokens=s.maxTokens),xm(s)})).catch((function(){return{}}));var yh,jh,wh=((yh={})[Nu.openAI]=wm,yh[Nu.azureOpenAI]=wm,yh[Nu.custom]=wm,yh[Nu.google]=fm,yh[Nu.anthropic]=Cm,yh[Nu.gptPlugins]=gm,yh[Nu.assistants]=ym,yh[Nu.azureAssistants]=ym,yh[Nu.agents]=Sm,yh[Nu.bedrock]=_h,yh);function Nh(e){for(var t,n=0,s=e;n<s.length;n++){var a=s[n];if(a){t=a;break}}return t}function Ch(e){for(var t=0,n=e;t<n.length;t++){var s=n[t];if(s&&""!==s.trim())return s}}var kh,Sh=function(e){var t,n,s=e.endpoint,a=e.endpointType,r=e.conversation,o=e.possibleValues,i=wh[s];if(!i&&!a)throw new Error("Unknown endpoint: ".concat(s));!i&&a&&(i=wh[a]);var l=null==i?void 0:i.parse(r),c=null!=o?o:{},d=c.models,u=c.secondaryModels;return d&&l&&(l.model=null!==(t=Nh(d))&&void 0!==t?t:l.model),u&&(null==l?void 0:l.agentOptions)&&(l.agentOptions.model=null!==(n=Nh(u))&&void 0!==n?n:l.agentOptions.model),l},Th=function(e){var t=e.match(/gpt-(\d+(?:\.\d+)?)([a-z])?/i);if(t){var n=t[1],s=t[2]||"";return"GPT-".concat(n).concat(s)}return""},Eh=function(e){var t=e.match(/\bo(\d+(?:\.\d+)?)\b/i);if(t){var n=t[1];return"o".concat(n)}return""},Rh=function(e){var t,n=e.model,s=e.endpoint,a=e.endpointType,r=e.modelDisplayLabel,o=e.chatGptLabel,i=e.modelLabel,l=s,c=null!=n?n:"",d=null!=r?r:"",u=null!=o?o:"",m=null!=i?i:"";return[Nu.openAI,Nu.bedrock,Nu.gptPlugins,Nu.azureOpenAI,Nu.chatGPTBrowser].includes(l)?u||m||(c&&Eh(c)?Eh(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?Th(c)||"GPT":null!==(t=qf[l])&&void 0!==t?t:"ChatGPT"):l===Nu.anthropic?m||"Claude":l===Nu.bedrock?m||qf[l]:l===Nu.google?m||(!0===(null==c?void 0:c.toLowerCase().includes("gemma"))?"Gemma":"Gemini"):l===Nu.custom||a===Nu.custom?m||u||(c&&Eh(c)?Eh(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?Th(c)||"GPT":d||"AI"):""},Ih=((jh={})[Nu.openAI]=wm,jh[Nu.azureOpenAI]=wm,jh[Nu.custom]=wm,jh[Nu.assistants]=jm,jh[Nu.azureAssistants]=jm,jh[Nu.agents]=Sm,jh[Nu.google]=Nm,jh[Nu.bedrock]=_h,jh[Nu.anthropic]=Cm,jh[Nu.gptPlugins]=km,jh),Ph=function(e){var t,n=e.endpoint,s=e.endpointType,a=e.conversation,r=e.possibleValues;if(!n)throw new Error("undefined endpoint: ".concat(n));var o=Ih[n];if(!o&&!s)throw new Error("Unknown endpoint: ".concat(n));if(!o&&s&&(o=Ih[s]),!o)throw new Error("Unknown endpointType: ".concat(s));var i=o.parse(a),l=(null!=r?r:{}).models;return l&&i&&(i.model=null!==(t=Nh(l))&&void 0!==t?t:i.model),i};function Ah(e,t){void 0===t&&(t=!1);for(var n="",s=0,a=e;s<a.length;s++){var r=a[s];if(r.type)if(r.type===hh.TEXT){var o="string"==typeof r.text?r.text:r.text.value;n.length>0&&o.length>0&&" "!==n[n.length-1]&&" "!==o[0]&&(n+=" "),n+=o}else r.type!==hh.THINK||t||(o="string"==typeof r.think?r.think:"",n.length>0&&o.length>0&&" "!==n[n.length-1]&&" "!==o[0]&&(n+=" "),n+=o)}return n}function Mh(e){var t=e.text,n=e.user,s=t;if(!s)return s;var a=_e().format("YYYY-MM-DD"),r=_e().day(),o="".concat(a," (").concat(r,")");s=s.replace(/{{current_date}}/gi,o);var i=_e().format("YYYY-MM-DD HH:mm:ss");s=s.replace(/{{current_datetime}}/gi,"".concat(i," (").concat(r,")"));var l=_e().toISOString();return s=s.replace(/{{iso_datetime}}/gi,l),n&&n.name&&(s=s.replace(/{{current_user}}/gi,n.name)),s}function Lh(e){var t=e.messages,n=e.fileMap;if(null===t)return null;var s={},a=[],r={};return t.forEach((function(e){var t;if(e){var o=null!==(t=e.parentMessageId)&&void 0!==t?t:"";r[o]=(r[o]||0)+1;var i=qd(qd({},e),{children:[],depth:0,siblingIndex:r[o]-1});e.files&&n&&(i.files=e.files.map((function(e){var t,s;return null!==(s=n[null!==(t=e.file_id)&&void 0!==t?t:""])&&void 0!==s?s:e}))),s[e.messageId]=i;var l=s[o];l?(l.children.push(i),i.depth=l.depth+1):a.push(i)}})),a}!function(e){e.DEFAULT="default",e.SHADCNUI="shadcnui",e.CUSTOM="custom"}(kh||(kh={}));var Oh,Dh,Fh,zh,Uh,Vh,Bh,$h,Hh,Gh,Kh,Wh,qh,Qh,Yh,Xh,Zh,Jh,eg={utils:'\nimport { type ClassValue, clsx } from "clsx"\nimport { twMerge } from "tailwind-merge"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n',accordian:'import * as React from "react"\nimport * as AccordionPrimitive from "@radix-ui/react-accordion"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn("border-b", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = "AccordionItem"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className="flex">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"\n    {...props}\n  >\n    <div className={cn("pb-4 pt-0", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n',alertDialog:'import * as React from "react"\nimport * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-2 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = "AlertDialogHeader"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = "AlertDialogFooter"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn("text-lg font-semibold", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: "outline" }),\n      "mt-2 sm:mt-0",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n',alert:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst alertVariants = cva(\n  "relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role="alert"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = "Alert"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn("mb-1 font-medium leading-none tracking-tight", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = "AlertTitle"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("text-sm [&_p]:leading-relaxed", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = "AlertDescription"\n\nexport { Alert, AlertTitle, AlertDescription }\n\n',avatar:'import * as React from "react"\nimport * as AvatarPrimitive from "@radix-ui/react-avatar"\n\nimport { cn } from "../../lib/utils"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn("aspect-square h-full w-full", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      "flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n\n',badge:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst badgeVariants = cva(\n  "inline-flex items-center rounded-full border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default:\n          "border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",\n        secondary:\n          "border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        destructive:\n          "border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",\n        outline: "text-gray-950 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n\n',breadcrumb:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<"nav"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)\nBreadcrumb.displayName = "Breadcrumb"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<"ol">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      "flex flex-wrap items-center gap-1.5 break-words text-sm text-gray-500 sm:gap-2.5 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = "BreadcrumbList"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<"li">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn("inline-flex items-center gap-1.5", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = "BreadcrumbItem"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<"a"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : "a"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn("transition-colors hover:text-gray-950 dark:hover:text-gray-50", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = "BreadcrumbLink"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<"span">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role="link"\n    aria-disabled="true"\n    aria-current="page"\n    className={cn("font-normal text-gray-950 dark:text-gray-50", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = "BreadcrumbPage"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<"li">) => (\n  <li\n    role="presentation"\n    aria-hidden="true"\n    className={cn("[&>svg]:size-3.5", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = "BreadcrumbSeparator"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    role="presentation"\n    aria-hidden="true"\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = "BreadcrumbElipssis"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n\n',button:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from \'../../lib/utils\';\n\nconst buttonVariants = cva(\n  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default: "bg-gray-900 text-gray-50 hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",\n        destructive:\n          "bg-red-500 text-gray-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",\n        outline:\n          "border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        secondary:\n          "bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        ghost: "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        link: "text-gray-900 underline-offset-4 hover:underline dark:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-4 py-2",\n        sm: "h-9 rounded-md px-3",\n        lg: "h-11 rounded-md px-8",\n        icon: "h-10 w-10",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : "button"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = "Button"\n\nexport { Button, buttonVariants }\n',calendar:'import * as React from "react"\nimport { ChevronLeft, ChevronRight } from "lucide-react"\nimport { DayPicker } from "react-day-picker"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn("p-3", className)}\n      classNames={{\n        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",\n        month: "space-y-4",\n        caption: "flex justify-center pt-1 relative items-center",\n        caption_label: "text-sm font-medium",\n        nav: "space-x-1 flex items-center",\n        nav_button: cn(\n          buttonVariants({ variant: "outline" }),\n          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"\n        ),\n        nav_button_previous: "absolute left-1",\n        nav_button_next: "absolute right-1",\n        table: "w-full border-collapse space-y-1",\n        head_row: "flex",\n        head_cell:\n          "text-gray-500 rounded-md w-9 font-normal text-[0.8rem] dark:text-gray-400",\n        row: "flex w-full mt-2",\n        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-gray-100/50 [&:has([aria-selected])]:bg-gray-100 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20 dark:[&:has([aria-selected].day-outside)]:bg-gray-800/50 dark:[&:has([aria-selected])]:bg-gray-800",\n        day: cn(\n          buttonVariants({ variant: "ghost" }),\n          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"\n        ),\n        day_range_end: "day-range-end",\n        day_selected:\n          "bg-gray-900 text-gray-50 hover:bg-gray-900 hover:text-gray-50 focus:bg-gray-900 focus:text-gray-50 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50 dark:hover:text-gray-900 dark:focus:bg-gray-50 dark:focus:text-gray-900",\n        day_today: "bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-50",\n        day_outside:\n          "day-outside text-gray-500 opacity-50 aria-selected:bg-gray-100/50 aria-selected:text-gray-500 aria-selected:opacity-30 dark:text-gray-400 dark:aria-selected:bg-gray-800/50 dark:aria-selected:text-gray-400",\n        day_disabled: "text-gray-500 opacity-50 dark:text-gray-400",\n        day_range_middle:\n          "aria-selected:bg-gray-100 aria-selected:text-gray-900 dark:aria-selected:bg-gray-800 dark:aria-selected:text-gray-50",\n        day_hidden: "invisible",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,\n        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = "Calendar"\n\nexport { Calendar }\n\n',card:'import * as React from \'react\';\n\nimport { cn } from \'../../lib/utils\';\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      "rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = "Card"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex flex-col space-y-1.5 p-6", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = "CardHeader"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      "text-2xl font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = "CardTitle"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = "CardDescription"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />\n))\nCardContent.displayName = "CardContent"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex items-center p-6 pt-0", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = "CardFooter"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n',carousel:'import * as React from "react"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from "embla-carousel-react"\nimport { ArrowLeft, ArrowRight } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { Button } from "./button"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: "horizontal" | "vertical"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error("useCarousel must be used within a <Carousel />")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = "horizontal",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === "horizontal" ? "x" : "y",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === "ArrowLeft") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === "ArrowRight") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on("reInit", onSelect)\n      api.on("select", onSelect)\n\n      return () => {\n        api?.off("select", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn("relative", className)}\n          role="region"\n          aria-roledescription="carousel"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = "Carousel"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className="overflow-hidden">\n      <div\n        ref={ref}\n        className={cn(\n          "flex",\n          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = "CarouselContent"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role="group"\n      aria-roledescription="slide"\n      className={cn(\n        "min-w-0 shrink-0 grow-0 basis-full",\n        orientation === "horizontal" ? "pl-4" : "pt-4",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = "CarouselItem"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute  h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-left-12 top-1/2 -translate-y-1/2"\n          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className="h-4 w-4" />\n      <span className="sr-only">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = "CarouselPrevious"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-right-12 top-1/2 -translate-y-1/2"\n          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className="h-4 w-4" />\n      <span className="sr-only">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = "CarouselNext"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n\n',checkbox:'import * as React from "react"\nimport * as CheckboxPrimitive from "@radix-ui/react-checkbox"\nimport { Check } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      "peer h-4 w-4 shrink-0 rounded-sm border border-gray-200 dark:border-gray-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=checked]:text-gray-50  dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=checked]:bg-gray-50 dark:data-[state=checked]:text-gray-900",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn("flex items-center justify-center text-current")}\n    >\n      <Check className="h-4 w-4" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n',collapsible:'import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n\n',dialog:'import * as React from "react"\nimport * as DialogPrimitive from "@radix-ui/react-dialog"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500 dark:ring-offset-gray-950 dark:focus:ring-gray-300 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-400">\n        <X className="h-4 w-4" />\n        <span className="sr-only">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-1.5 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = "DialogHeader"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = "DialogFooter"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n\n',drawer:'import * as React from "react"\nimport { Drawer as DrawerPrimitive } from "vaul"\n\nimport { cn } from "../../lib/utils"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = "Drawer"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn("fixed inset-0 z-50 bg-black/80", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-gray-100 dark:bg-gray-800" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = "DrawerContent"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = "DrawerHeader"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("mt-auto flex flex-col gap-2 p-4", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = "DrawerFooter"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n\n',dropdownMenu:'import * as React from "react"\nimport * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-800 dark:data-[state=open]:bg-gray-800",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = "DropdownMenuShortcut"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n\n',input:'import * as React from "react"\nimport { cn } from "../../lib/utils"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          "flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = "Input"\n\nexport { Input }\n',label:"import * as React from 'react';\nimport * as LabelPrimitive from '@radix-ui/react-label';\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nimport { cn } from '../../lib/utils';\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n",menuBar:'\nimport * as React from "react"\nimport * as MenubarPrimitive from "@radix-ui/react-menubar"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "flex h-10 items-center space-x-1 rounded-md border border-gray-200 bg-white p-1 dark:border-gray-800 dark:bg-gray-950",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          "z-50 min-w-[12rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        "ml-auto text-xs tracking-widest text-gray-500 dark:text-gray-400",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = "MenubarShortcut"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n\n',navigationMenu:'import * as React from "react"\nimport * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"\nimport { cva } from "class-variance-authority"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative z-10 flex max-w-max flex-1 items-center justify-center",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      "group flex flex-1 list-none items-center justify-center space-x-1",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-100 hover:text-gray-900 focus:bg-gray-100 focus:text-gray-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-gray-100/50 data-[state=open]:bg-gray-100/50 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[active]:bg-gray-800/50 dark:data-[state=open]:bg-gray-800/50"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), "group", className)}\n    {...props}\n  >\n    {children}{""}\n    <ChevronDown\n      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"\n      aria-hidden="true"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn("absolute left-0 top-full flex justify-center")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)] dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",\n      className\n    )}\n    {...props}\n  >\n    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-gray-200 shadow-md dark:bg-gray-800" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n\n',pagination:'import * as React from "react"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { ButtonProps, buttonVariants } from "./button"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (\n  <nav\n    role="navigation"\n    aria-label="pagination"\n    className={cn("mx-auto flex w-full justify-center", className)}\n    {...props}\n  />\n)\nPagination.displayName = "Pagination"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<"ul">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn("flex flex-row items-center gap-1", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = "PaginationContent"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<"li">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn("", className)} {...props} />\n))\nPaginationItem.displayName = "PaginationItem"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, "size"> &\n  React.ComponentProps<"a">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = "icon",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? "page" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? "outline" : "ghost",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = "PaginationLink"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to previous page"\n    size="default"\n    className={cn("gap-1 pl-2.5", className)}\n    {...props}\n  >\n    <ChevronLeft className="h-4 w-4" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = "PaginationPrevious"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to next page"\n    size="default"\n    className={cn("gap-1 pr-2.5", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className="h-4 w-4" />\n  </PaginationLink>\n)\nPaginationNext.displayName = "PaginationNext"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    aria-hidden\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = "PaginationEllipsis"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n\n',popover:'import * as React from "react"\nimport * as PopoverPrimitive from "@radix-ui/react-popover"\n\nimport { cn } from "../../lib/utils"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 w-72 rounded-md border border-gray-200 bg-white p-4 text-gray-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n\n',progress:'import * as React from "react"\nimport * as ProgressPrimitive from "@radix-ui/react-progress"\n\nimport { cn } from "../../lib/utils"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative h-4 w-full overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className="h-full w-full flex-1 bg-gray-900 transition-all dark:bg-gray-50"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n',radioGroup:'import * as React from "react"\nimport * as RadioGroupPrimitive from "@radix-ui/react-radio-group"\nimport { Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn("grid gap-2", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        "aspect-square h-4 w-4 rounded-full border border-gray-200 dark:border-gray-900 text-gray-900 ring-offset-white focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  dark:text-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">\n        <Circle className="h-2.5 w-2.5 fill-current text-current" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n\n',select:'import * as React from "react"\nimport * as SelectPrimitive from "@radix-ui/react-select"\nimport { Check, ChevronDown, ChevronUp } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-gray-300",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className="h-4 w-4 opacity-50" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className="h-4 w-4" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className="h-4 w-4" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = "popper", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        position === "popper" &&\n          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          "p-1",\n          position === "popper" &&\n            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <SelectPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n\n',separator:'import * as React from "react"\nimport * as SeparatorPrimitive from "@radix-ui/react-separator"\n\nimport { cn } from "../../lib/utils"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = "horizontal", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        "shrink-0 bg-gray-200 dark:bg-gray-800",\n        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n\n',skeleton:'import { cn } from "../../lib/utils"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn("animate-pulse rounded-md bg-gray-100 dark:bg-gray-800", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n',slider:'import * as React from "react"\nimport * as SliderPrimitive from "@radix-ui/react-slider"\n\nimport { cn } from "../../lib/utils"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex w-full touch-none select-none items-center",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800">\n      <SliderPrimitive.Range className="absolute h-full bg-gray-900 dark:bg-gray-50" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-gray-900 bg-white ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-gray-50 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n\n',switchComponent:'import * as React from "react"\nimport * as SwitchPrimitives from "@radix-ui/react-switch"\n\nimport { cn } from "../../lib/utils"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200 dark:focus-visible:ring-gray-300 dark:focus-visible:ring-offset-gray-950 dark:data-[state=checked]:bg-gray-50 dark:data-[state=unchecked]:bg-gray-800",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        "pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:bg-gray-950"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n\n',table:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className="relative w-full overflow-auto">\n    <table\n      ref={ref}\n      className={cn("w-full caption-bottom text-sm", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = "Table"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />\n))\nTableHeader.displayName = "TableHeader"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn("[&_tr:last-child]:border-0", className)}\n    {...props}\n  />\n))\nTableBody.displayName = "TableBody"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      "border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = "TableFooter"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      "border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = "TableRow"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      "h-12 px-4 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = "TableHead"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}\n    {...props}\n  />\n))\nTableCell.displayName = "TableCell"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn("mt-4 text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = "TableCaption"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n\n',tabs:'import * as React from "react"\nimport * as TabsPrimitive from "@radix-ui/react-tabs"\n\nimport { cn } from "../../lib/utils"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n\n',textarea:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          "flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = "Textarea"\n\nexport { Textarea }\n\n',toast:'import * as React from "react"\nimport * as ToastPrimitives from "@radix-ui/react-toast"\nimport { cva, type VariantProps } from "class-variance-authority"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border border-gray-200 p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:border-gray-800",\n  {\n    variants: {\n      variant: {\n        default: "border bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "destructive group border-red-500 bg-red-500 text-gray-50 dark:border-red-900 dark:bg-red-900 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border border-gray-200 bg-transparent px-3 text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-gray-100/40 group-[.destructive]:hover:border-red-500/30 group-[.destructive]:hover:bg-red-500 group-[.destructive]:hover:text-gray-50 group-[.destructive]:focus:ring-red-500 dark:border-gray-800 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:focus:ring-gray-300 dark:group-[.destructive]:border-gray-800/40 dark:group-[.destructive]:hover:border-red-900/30 dark:group-[.destructive]:hover:bg-red-900 dark:group-[.destructive]:hover:text-gray-50 dark:group-[.destructive]:focus:ring-red-900",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      "absolute right-2 top-2 rounded-md p-1 text-gray-950/50 opacity-0 transition-opacity hover:text-gray-950 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-50/50 dark:hover:text-gray-50",\n      className\n    )}\n    toast-close=""\n    {...props}\n  >\n    <X className="h-4 w-4" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn("text-sm font-semibold", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn("text-sm opacity-90", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n\n',toaster:'import {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from "./toast"\nimport { useToast } from "./use-toast"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className="grid gap-1">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n\n',toggleGroup:'import * as React from "react"\nimport * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"\nimport { type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\nimport { toggleVariants } from "./toggle"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: "default",\n  variant: "default",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn("flex items-center justify-center gap-1", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n\n',toggle:'import * as React from "react"\nimport * as TogglePrimitive from "@radix-ui/react-toggle"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst toggleVariants = cva(\n  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 hover:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-gray-100 data-[state=on]:text-gray-900 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-400 dark:focus-visible:ring-gray-300 dark:data-[state=on]:bg-gray-800 dark:data-[state=on]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-transparent",\n        outline:\n          "border border-gray-200 bg-transparent hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-3",\n        sm: "h-9 px-2.5",\n        lg: "h-11 px-5",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n\n',tooltip:'import * as React from "react"\nimport * as TooltipPrimitive from "@radix-ui/react-tooltip"\n\nimport { cn } from "../../lib/utils"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      "z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-950 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n\n',useToast:'import * as React from "react"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from "./toast"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: "ADD_TOAST",\n  UPDATE_TOAST: "UPDATE_TOAST",\n  DISMISS_TOAST: "DISMISS_TOAST",\n  REMOVE_TOAST: "REMOVE_TOAST",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType["ADD_TOAST"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType["UPDATE_TOAST"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType["DISMISS_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n  | {\n      type: ActionType["REMOVE_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: "REMOVE_TOAST",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case "ADD_TOAST":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case "UPDATE_TOAST":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case "DISMISS_TOAST": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I\'ll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case "REMOVE_TOAST":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, "id">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: "UPDATE_TOAST",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })\n\n  dispatch({\n    type: "ADD_TOAST",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),\n  }\n}\n\nexport { useToast, toast }\n'};!function(e){e.Input="input",e.Textarea="textarea",e.Slider="slider",e.Checkbox="checkbox",e.Switch="switch",e.Dropdown="dropdown",e.Combobox="combobox",e.Tags="tags"}(Oh||(Oh={})),function(e){e.Number="number",e.Boolean="boolean",e.String="string",e.Enum="enum",e.Array="array"}(Dh||(Dh={})),function(e){e.Conversation="conversation",e.Model="model",e.Custom="custom"}(Fh||(Fh={})),function(e){e.PROMPTS="PROMPTS",e.BOOKMARKS="BOOKMARKS",e.AGENTS="AGENTS",e.MEMORIES="MEMORIES",e.MULTI_CONVO="MULTI_CONVO",e.TEMPORARY_CHAT="TEMPORARY_CHAT",e.RUN_CODE="RUN_CODE",e.WEB_SEARCH="WEB_SEARCH",e.PEOPLE_PICKER="PEOPLE_PICKER",e.MARKETPLACE="MARKETPLACE",e.FILE_SEARCH="FILE_SEARCH",e.FILE_CITATIONS="FILE_CITATIONS"}(Zh||(Zh={})),function(e){e.SHARED_GLOBAL="SHARED_GLOBAL",e.USE="USE",e.CREATE="CREATE",e.UPDATE="UPDATE",e.READ="READ",e.READ_AUTHOR="READ_AUTHOR",e.SHARE="SHARE",e.OPT_OUT="OPT_OUT",e.VIEW_USERS="VIEW_USERS",e.VIEW_GROUPS="VIEW_GROUPS",e.VIEW_ROLES="VIEW_ROLES"}(Jh||(Jh={}));var tg,ng,sg,ag,rg,og,ig,lg,cg,dg,ug,mg,pg,fg,hg,gg,xg,vg,bg,_g,yg,jg,wg,Ng,Cg,kg,Sg,Tg,Eg,Rg,Ig,Pg,Ag=mo(((zh={})[Jh.SHARED_GLOBAL]=go().default(!1),zh[Jh.USE]=go().default(!0),zh[Jh.CREATE]=go().default(!0),zh)),Mg=mo(((Uh={})[Jh.USE]=go().default(!0),Uh)),Lg=mo(((Vh={})[Jh.USE]=go().default(!0),Vh[Jh.CREATE]=go().default(!0),Vh[Jh.UPDATE]=go().default(!0),Vh[Jh.READ]=go().default(!0),Vh[Jh.OPT_OUT]=go().default(!0),Vh)),Og=mo(((Bh={})[Jh.SHARED_GLOBAL]=go().default(!1),Bh[Jh.USE]=go().default(!0),Bh[Jh.CREATE]=go().default(!0),Bh)),Dg=mo((($h={})[Jh.USE]=go().default(!0),$h)),Fg=mo(((Hh={})[Jh.USE]=go().default(!0),Hh)),zg=mo(((Gh={})[Jh.USE]=go().default(!0),Gh)),Ug=mo(((Kh={})[Jh.USE]=go().default(!0),Kh)),Vg=mo(((Wh={})[Jh.VIEW_USERS]=go().default(!0),Wh[Jh.VIEW_GROUPS]=go().default(!0),Wh[Jh.VIEW_ROLES]=go().default(!0),Wh)),Bg=mo(((qh={})[Jh.USE]=go().default(!1),qh)),$g=mo(((Qh={})[Jh.USE]=go().default(!0),Qh)),Hg=mo(((Yh={})[Jh.USE]=go().default(!0),Yh)),Gg=mo(((Xh={})[Zh.PROMPTS]=Ag,Xh[Zh.BOOKMARKS]=Mg,Xh[Zh.MEMORIES]=Lg,Xh[Zh.AGENTS]=Og,Xh[Zh.MULTI_CONVO]=Dg,Xh[Zh.TEMPORARY_CHAT]=Fg,Xh[Zh.RUN_CODE]=zg,Xh[Zh.WEB_SEARCH]=Ug,Xh[Zh.PEOPLE_PICKER]=Vg,Xh[Zh.MARKETPLACE]=Bg,Xh[Zh.FILE_SEARCH]=$g,Xh[Zh.FILE_CITATIONS]=Hg,Xh));!function(e){e.ADMIN="ADMIN",e.USER="USER"}(Pg||(Pg={}));var Kg,Wg,qg,Qg,Yg,Xg,Zg=mo({name:po(),permissions:Gg}),Jg=mo(((tg={})[Pg.ADMIN]=Zg.extend({name:bo(Pg.ADMIN),permissions:Gg.extend((ng={},ng[Zh.PROMPTS]=Ag.extend((sg={},sg[Jh.SHARED_GLOBAL]=go().default(!0),sg[Jh.USE]=go().default(!0),sg[Jh.CREATE]=go().default(!0),sg)),ng[Zh.BOOKMARKS]=Mg.extend((ag={},ag[Jh.USE]=go().default(!0),ag)),ng[Zh.MEMORIES]=Lg.extend((rg={},rg[Jh.USE]=go().default(!0),rg[Jh.CREATE]=go().default(!0),rg[Jh.UPDATE]=go().default(!0),rg[Jh.READ]=go().default(!0),rg[Jh.OPT_OUT]=go().default(!0),rg)),ng[Zh.AGENTS]=Og.extend((og={},og[Jh.SHARED_GLOBAL]=go().default(!0),og[Jh.USE]=go().default(!0),og[Jh.CREATE]=go().default(!0),og)),ng[Zh.MULTI_CONVO]=Dg.extend((ig={},ig[Jh.USE]=go().default(!0),ig)),ng[Zh.TEMPORARY_CHAT]=Fg.extend((lg={},lg[Jh.USE]=go().default(!0),lg)),ng[Zh.RUN_CODE]=zg.extend((cg={},cg[Jh.USE]=go().default(!0),cg)),ng[Zh.WEB_SEARCH]=Ug.extend((dg={},dg[Jh.USE]=go().default(!0),dg)),ng[Zh.PEOPLE_PICKER]=Vg.extend((ug={},ug[Jh.VIEW_USERS]=go().default(!0),ug[Jh.VIEW_GROUPS]=go().default(!0),ug[Jh.VIEW_ROLES]=go().default(!0),ug)),ng[Zh.MARKETPLACE]=mo((mg={},mg[Jh.USE]=go().default(!1),mg)),ng[Zh.FILE_SEARCH]=$g.extend((pg={},pg[Jh.USE]=go().default(!0),pg)),ng[Zh.FILE_CITATIONS]=Hg.extend((fg={},fg[Jh.USE]=go().default(!0),fg)),ng))}),tg[Pg.USER]=Zg.extend({name:bo(Pg.USER),permissions:Gg}),tg)).parse(((hg={})[Pg.ADMIN]={name:Pg.ADMIN,permissions:(gg={},gg[Zh.PROMPTS]=(xg={},xg[Jh.SHARED_GLOBAL]=!0,xg[Jh.USE]=!0,xg[Jh.CREATE]=!0,xg),gg[Zh.BOOKMARKS]=(vg={},vg[Jh.USE]=!0,vg),gg[Zh.MEMORIES]=(bg={},bg[Jh.USE]=!0,bg[Jh.CREATE]=!0,bg[Jh.UPDATE]=!0,bg[Jh.READ]=!0,bg[Jh.OPT_OUT]=!0,bg),gg[Zh.AGENTS]=(_g={},_g[Jh.SHARED_GLOBAL]=!0,_g[Jh.USE]=!0,_g[Jh.CREATE]=!0,_g),gg[Zh.MULTI_CONVO]=(yg={},yg[Jh.USE]=!0,yg),gg[Zh.TEMPORARY_CHAT]=(jg={},jg[Jh.USE]=!0,jg),gg[Zh.RUN_CODE]=(wg={},wg[Jh.USE]=!0,wg),gg[Zh.WEB_SEARCH]=(Ng={},Ng[Jh.USE]=!0,Ng),gg[Zh.PEOPLE_PICKER]=(Cg={},Cg[Jh.VIEW_USERS]=!0,Cg[Jh.VIEW_GROUPS]=!0,Cg[Jh.VIEW_ROLES]=!0,Cg),gg[Zh.MARKETPLACE]=(kg={},kg[Jh.USE]=!0,kg),gg[Zh.FILE_SEARCH]=(Sg={},Sg[Jh.USE]=!0,Sg),gg[Zh.FILE_CITATIONS]=(Tg={},Tg[Jh.USE]=!0,Tg),gg)},hg[Pg.USER]={name:Pg.USER,permissions:(Eg={},Eg[Zh.PROMPTS]={},Eg[Zh.BOOKMARKS]={},Eg[Zh.MEMORIES]={},Eg[Zh.AGENTS]={},Eg[Zh.MULTI_CONVO]={},Eg[Zh.TEMPORARY_CHAT]={},Eg[Zh.RUN_CODE]={},Eg[Zh.WEB_SEARCH]={},Eg[Zh.PEOPLE_PICKER]=(Rg={},Rg[Jh.VIEW_USERS]=!1,Rg[Jh.VIEW_GROUPS]=!1,Rg[Jh.VIEW_ROLES]=!1,Rg),Eg[Zh.MARKETPLACE]=(Ig={},Ig[Jh.USE]=!1,Ig),Eg[Zh.FILE_SEARCH]={},Eg[Zh.FILE_CITATIONS]={},Eg)},hg));!function(e){e.PAST_HOUR="h",e.PAST_24_HOURS="d",e.PAST_WEEK="w",e.PAST_MONTH="m",e.PAST_YEAR="y"}(Kg||(Kg={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(Wg||(Wg={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(qg||(qg={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup"}(Qg||(Qg={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(Yg||(Yg={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner"}(Xg||(Xg={}));var ex,tx=mo({type:fo(Wg),id:po().optional(),name:po().optional(),email:po().optional(),source:uo(["local","entra"]).optional(),avatar:po().optional(),description:po().optional(),idOnTheSource:po().optional(),accessRoleId:fo(Xg).optional(),memberCount:vo().optional()}),nx=mo({accessRoleId:fo(Xg),name:po(),description:po().optional(),resourceType:fo(Qg).default(Qg.AGENT),permBits:vo()}),sx=mo({id:po(),principalType:fo(Wg),principalId:po().optional(),principalName:po().optional(),role:nx,grantedBy:po(),grantedAt:po(),inheritedFrom:po().optional(),source:uo(["local","entra"]).optional()});mo({resourceType:fo(Qg),resourceId:po(),permissions:xo(sx)}),mo({updated:tx.array(),removed:tx.array(),public:go(),publicAccessRoleId:po().optional()}),mo({message:po(),results:mo({principals:tx.array(),public:go(),publicAccessRoleId:po().optional()})}),mo({resourceType:fo(Qg),resourceId:fo(Xg),principals:xo(tx),public:go(),publicAccessRoleId:fo(Xg).optional()}),mo({permissionBits:vo()}),function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpTools="mcpTools",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken"}(ex||(ex={}));var ax,rx=function(e){return["agentFiles",e]};function ox(e){co.defaults.headers.common.Authorization="Bearer "+e}function ix(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}!function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}(ax||(ax={}));var lx=!1,cx=[],dx=function(e){return ix((t=e,"".concat(cp,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},ux=function(e){ox(e),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},mx=function(e,t){void 0===t&&(t=null),cx.forEach((function(n){e?n.reject(e):n.resolve(t)})),cx=[]};"undefined"!=typeof window&&co.interceptors.response.use((function(e){return e}),(function(e){return Yd(void 0,0,void 0,(function(){var t,n,s,a,r,o,i,l,c;return Xd(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!lx)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){cx.push({resolve:e,reject:t})}))];case 2:return a=d.sent(),t.headers.Authorization="Bearer "+a,[4,co(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:lx=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,dx(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return s=d.sent(),(a=null!==(c=null==s?void 0:s.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+a,ux(a),mx(null,a),[4,co(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href="/login",d.label=10;case 10:return[3,13];case 11:return r=d.sent(),mx(r,null),[2,Promise.reject(r)];case 12:return lx=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var px={get:function(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.get(e,qd({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.get(e,qd({},t))];case 1:return[2,n.sent()]}}))}))},post:ix,postMultiPart:function(e,t,n){return Yd(this,0,void 0,(function(){return Xd(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,qd(qd({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,s.sent().data]}}))}))},postTTS:function(e,t,n){return Yd(this,0,void 0,(function(){return Xd(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,qd(qd({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,s.sent().data]}}))}))},put:function(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return Yd(this,0,void 0,(function(){return Xd(this,(function(t){switch(t.label){case 0:return[4,co.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.delete(e,qd({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return Yd(this,0,void 0,(function(){return Xd(this,(function(n){switch(n.label){case 0:return[4,co.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:dx,dispatchTokenUpdatedEvent:ux},fx=Object.freeze({__proto__:null,acceptTerms:function(){return px.post("".concat(cp,"/api/user/terms/accept"))},addPromptToGroup:function(e,t){return px.post((n=e,"".concat(cp,"/api/prompts/groups/").concat(n,"/prompts")),t);var n},addTagToConversation:function(e,t){return px.put((n=e,"".concat(Wp(),"/convo/").concat(n)),t);var n},archiveConversation:function(e){return px.post(Ip(),{arg:e})},callTool:function(e){var t=e.toolId,n=e.toolParams;return px.post(Lp({path:"tools/".concat(t,"/call")}),n)},cancelMCPOAuth:function(e){return px.post((t=e,"".concat(cp,"/api/mcp/oauth/cancel/").concat(t)),{});var t},clearAllConversations:function(){return px.delete("".concat(Ep,"/all"))},confirmTwoFactor:function(e){return px.post("".concat(cp,"/api/auth/2fa/confirm"),e)},createAgent:function(e){var t=Qd(e,[]);return px.post(Lp({}),t)},createAssistant:function(e){var t=e.version,n=Qd(e,["version"]);return px.post(Mp({version:t}),n)},createConversationTag:function(e){return px.post(Wp(),e)},createMemory:function(e){return px.post(qp(),e)},createPreset:function(e){return px.post(Pp(),e)},createPrompt:function(e){return px.post($p(),e)},createSharedLink:function(e){return px.post((t=e,"".concat(Cp,"/").concat(t)));var t},deleteAction:function(e){var t=e.assistant_id,n=e.action_id,s=e.model,a=e.version,r=e.endpoint;return Yd(void 0,0,void 0,(function(){return Xd(this,(function(e){return[2,px.delete(Mp({path:"actions/".concat(t,"/").concat(n,"/").concat(s),version:a,endpoint:r}))]}))}))},deleteAgent:function(e){var t=e.agent_id;return px.delete(Lp({path:t}))},deleteAgentAction:function(e){var t=e.agent_id,n=e.action_id;return Yd(void 0,0,void 0,(function(){return Xd(this,(function(e){return[2,px.delete(Lp({path:"actions/".concat(t,"/").concat(n)}))]}))}))},deleteAssistant:function(e){var t=e.assistant_id,n=e.model,s=e.endpoint,a=e.version;return px.delete(Mp({path:t,options:{model:n,endpoint:s},version:a}))},deleteConversation:function(e){return px.deleteWithOptions("".concat(Ep),{data:{arg:e}})},deleteConversationTag:function(e){return px.delete(Wp(e))},deleteFiles:function(e){return Yd(void 0,0,void 0,(function(){return Xd(this,(function(t){return[2,px.deleteWithOptions(Dp(),{data:e})]}))}))},deleteMemory:function(e){return px.delete(Qp(e))},deletePreset:function(e){return px.post("".concat(cp,"/api/presets/delete"),e)},deletePrompt:function(e){return px.delete((n=(t=e)._id,s=t.groupId,"".concat(Ap(),"/").concat(n,"?groupId=").concat(s)));var t,n,s},deletePromptGroup:function(e){return px.delete(Gp(e))},deleteSharedLink:function(e){return px.delete(kp(e))},deleteUser:function(){return px.delete("".concat(cp,"/api/user/delete"))},disableTwoFactor:function(e){return px.post("".concat(cp,"/api/auth/2fa/disable"),e)},duplicateAgent:function(e){var t=e.agent_id;return px.post(Lp({path:"".concat(t,"/duplicate")}))},duplicateConversation:function(e){return px.post("".concat(Ep,"/duplicate"),e)},editArtifact:function(e){return Yd(void 0,0,void 0,(function(){var t=e.messageId,n=Qd(e,["messageId"]);return Xd(this,(function(e){return[2,px.post(Np(t),n)]}))}))},enableTwoFactor:function(){return px.get("".concat(cp,"/api/auth/2fa/enable"))},forkConversation:function(e){return px.post("".concat(Ep,"/fork"),e)},genTitle:function(e){return px.post("".concat(Ep,"/gen_title"),e)},getAIEndpoints:function(){return px.get("".concat(cp,"/api/endpoints"))},getAccessRoles:function(e){return px.get((t=e,"".concat(cp,"/api/permissions/").concat(t,"/roles")));var t},getActions:function(){return px.get(Lp({path:"actions"}))},getAgentById:function(e){var t=e.agent_id;return px.get(Lp({path:t}))},getAgentCategories:function(){return px.get(Lp({path:"categories"}))},getAgentFiles:function(e){return px.get((t=e,"".concat(cp,"/api/files/agent/").concat(t)));var t},getAllPromptGroups:function(){return px.get("".concat(Ap(),"/all"))},getAssistantById:function(e){var t=e.endpoint,n=e.assistant_id,s=e.version;return px.get(Mp({path:n,endpoint:t,version:s}))},getAssistantDocs:function(e){var t=e.endpoint,n=e.version;return Mu(t)?px.get(Mp({path:"documents",version:n,options:{endpoint:t},endpoint:t})):Promise.resolve([])},getAvailableAgentTools:function(){return px.get(Lp({path:"tools"}))},getAvailablePlugins:function(){return px.get("".concat(cp,"/api/plugins"))},getAvailableTools:function(e,t){var n="";return n=Mu(e)?Mp({path:"tools",endpoint:e,version:null!=t?t:of[e]}):Lp({path:"tools"}),px.get(n)},getBanner:function(){return px.get("".concat(cp,"/api/banner"))},getCategories:function(){return px.get("".concat(cp,"/api/categories"))},getCodeOutputDownload:function(e){return Yd(void 0,0,void 0,(function(){return Xd(this,(function(t){return[2,px.getResponse(e,{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getConversationById:function(e){return px.get((t=e,"".concat(Ep,"/").concat(t)));var t},getConversationTags:function(){return px.get(Wp())},getConversations:function(e){return px.get(Rp({cursor:e}))},getCustomConfigSpeech:function(){return px.get("".concat(zp(),"/config/get"))},getDomainServerBaseUrl:function(){return"".concat(_p(),"/api")},getEffectivePermissions:function(e,t){return px.get((n=e,s=t,"".concat(cp,"/api/permissions/").concat(n,"/").concat(s,"/effective")));var n,s},getExpandedAgentById:function(e){var t=e.agent_id;return px.get(Lp({path:"".concat(t,"/expanded")}))},getFileConfig:function(){return px.get("".concat(Dp(),"/config"))},getFileDownload:function(e,t){return Yd(void 0,0,void 0,(function(){return Xd(this,(function(n){return[2,px.getResponse("".concat(Dp(),"/download/").concat(e,"/").concat(t),{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getFiles:function(){return px.get(Dp())},getGraphApiToken:function(e){return px.get((t=e.scopes,"".concat(cp,"/api/auth/graph-token?scopes=").concat(encodeURIComponent(t))));var t},getLoginGoogle:function(){return px.get("".concat(cp,"/api/auth/google"))},getMCPAuthValues:function(e){return px.get((t=e,"".concat(cp,"/api/mcp/").concat(t,"/auth-values")));var t},getMCPConnectionStatus:function(){return px.get("".concat(cp,"/api/mcp/connection/status"))},getMCPServerConnectionStatus:function(e){return px.get((t=e,"".concat(cp,"/api/mcp/connection/status/").concat(t)));var t},getMCPTools:function(){return px.get(Op.tools)},getMarketplaceAgents:function(e){return px.get(Lp({options:e}))},getMemories:function(){return px.get(qp())},getMessagesByConvoId:function(e){return e===dh.NEW_CONVO||e===dh.PENDING_CONVO?Promise.resolve([]):px.get(wp({conversationId:e}))},getModels:function(){return Yd(void 0,0,void 0,(function(){return Xd(this,(function(e){return[2,px.get("".concat(cp,"/api/models"))]}))}))},getPresets:function(){return px.get(Pp())},getPrompt:function(e){return px.get(Bp(e))},getPromptGroup:function(e){return px.get(Vp(e))},getPromptGroups:function(e){return px.get(function(e){var t="".concat(Ap(),"/groups"),n=Object.entries(e).reduce((function(e,t){var n=t[0],s=t[1];return null!=s&&""!==s&&(e[n]=s),e}),{});if(Object.keys(n).length>0){var s=new URLSearchParams(n).toString();t+="?".concat(s)}return t}(e))},getPrompts:function(e){return px.get(function(e){var t=Ap();if(Object.keys(e).length>0){var n=new URLSearchParams(e).toString();t+="?".concat(n)}return t}(e))},getRandomPrompts:function(e){return px.get((t=e.limit,n=e.skip,"".concat(Ap(),"/random?limit=").concat(t,"&skip=").concat(n)));var t,n},getResourcePermissions:function(e,t){return px.get((n=e,s=t,"".concat(cp,"/api/permissions/").concat(n,"/").concat(s)));var n,s},getRole:function(e){return px.get(Kp(e))},getSearchEnabled:function(){return px.get("".concat(cp,"/api/search/enable"))},getSharedLink:function(e){return px.get((t=e,"".concat(Cp,"/link/").concat(t)));var t},getSharedMessages:function(e){return px.get(kp(e))},getStartupConfig:function(){return px.get("".concat(cp,"/api/config"))},getToolCalls:function(e){return px.get(Lp({path:"tools/calls",options:e}))},getUser:function(){return px.get("".concat(cp,"/api/user"))},getUserBalance:function(){return px.get("".concat(cp,"/api/balance"))},getUserTerms:function(){return px.get("".concat(cp,"/api/user/terms"))},getVerifyAgentToolAuth:function(e){return px.get(Lp({path:"tools/".concat(e.toolId,"/auth")}))},getVoices:function(){return px.get("".concat(Up(),"/voices"))},healthCheck:function(){return px.get("".concat(cp,"/health"))},importConversationsFile:function(e){return px.postMultiPart("".concat(Ep,"/import"),e)},listAgents:function(e){return px.get(Lp({options:e}))},listAssistants:function(e,t){return px.get(Mp({version:t,options:e}))},listConversations:function(e){return px.get(Rp(null!=e?e:{}))},listMessages:function(e){return px.get(wp(null!=e?e:{}))},listSharedLinks:function(e){return Yd(void 0,0,void 0,(function(){var t,n,s,a,r,o;return Xd(this,(function(i){return t=e.pageSize,n=e.isPublic,s=e.sortBy,a=e.sortDirection,r=e.search,o=e.cursor,[2,px.get(Sp(t,n,s,a,r,o))]}))}))},login:function(e){return px.post("".concat(cp,"/api/auth/login"),e)},logout:function(){return px.post("".concat(cp,"/api/auth/logout"))},makePromptProduction:function(e){return px.patch("".concat(Bp(e),"/tags/production"))},rebuildConversationTags:function(){return px.post(Wp("rebuild"))},regenerateBackupCodes:function(){return px.post("".concat(cp,"/api/auth/2fa/backup/regenerate"))},register:function(e){return px.post("".concat(cp,"/api/auth/register"),e)},reinitializeMCPServer:function(e){return px.post((t=e,"".concat(cp,"/api/mcp/").concat(t,"/reinitialize")));var t},requestPasswordReset:function(e){return px.post("".concat(cp,"/api/auth/requestPasswordReset"),e)},resendVerificationEmail:function(e){return px.post("".concat(cp,"/api/user/verify/resend"),e)},resetPassword:function(e){return px.post("".concat(cp,"/api/auth/resetPassword"),e)},revertAgentVersion:function(e){var t=e.agent_id,n=e.version_index;return px.post("".concat(Lp({path:"".concat(t,"/revert")})),{version_index:n})},revokeAllUserKeys:function(){return px.delete("".concat(Tp,"?all=true"))},revokeUserKey:function(e){return px.delete((t=e,"".concat(Tp,"/").concat(t)));var t},searchPrincipals:function(e){return px.get((n=(t=e).q,s=t.limit,a=t.types,r="".concat(cp,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==s&&(r+="&limit=".concat(s)),a&&a.length>0&&(r+="&types=".concat(a.join(","))),r));var t,n,s,a,r},speechToText:function(e){return px.postMultiPart("".concat(zp(),"/stt"),e)},textToSpeech:function(e){return px.postTTS("".concat(Up(),"/manual"),e)},updateAction:function(e){var t=e.assistant_id,n=e.version,s=Qd(e,["assistant_id","version"]);return px.post(Mp({path:"actions/".concat(t),version:n}),s)},updateAgent:function(e){var t=e.agent_id,n=e.data;return px.patch(Lp({path:t}),n)},updateAgentAction:function(e){var t=e.agent_id,n=Qd(e,["agent_id"]);return px.post(Lp({path:"actions/".concat(t)}),n)},updateAgentPermissions:function(e){return px.put((t=e.roleName,"".concat(Kp(t),"/agents")),e.updates);var t},updateAssistant:function(e){var t=e.assistant_id,n=e.data,s=e.version;return px.patch(Mp({path:t,version:s}),n)},updateConversation:function(e){return px.post(Ip(),{arg:e})},updateConversationTag:function(e,t){return px.put(Wp(e),t)},updateFeedback:function(e,t,n){return px.put((s=e,a=t,"".concat(cp,"/api/messages/").concat(s,"/").concat(a,"/feedback")),n);var s,a},updateMarketplacePermissions:function(e){return px.put((t=e.roleName,"".concat(Kp(t),"/marketplace")),e.updates);var t},updateMemory:function(e,t,n){return px.patch(Qp(n||e),{key:e,value:t})},updateMemoryPermissions:function(e){return px.put((t=e.roleName,"".concat(Kp(t),"/memories")),e.updates);var t},updateMemoryPreferences:function(e){return px.patch("".concat(qp(),"/preferences"),e)},updateMessage:function(e){var t=e.conversationId,n=e.messageId,s=e.text;if(!t)throw new Error("conversationId is required");return px.put(wp({conversationId:t,messageId:n}),{text:s})},updateMessageContent:function(e){var t=e.conversationId,n=e.messageId,s=e.index,a=e.text;if(!t)throw new Error("conversationId is required");return px.put(wp({conversationId:t,messageId:n}),{text:a,index:s})},updatePeoplePickerPermissions:function(e){return px.put((t=e.roleName,"".concat(Kp(t),"/people-picker")),e.updates);var t},updatePreset:function(e){return px.post(Pp(),e)},updatePromptGroup:function(e){return px.patch(Hp(e.id),e.payload)},updatePromptLabels:function(e){return px.patch((t=e.id,"".concat(Bp(t),"/labels")),e.payload);var t},updatePromptPermissions:function(e){return px.put((t=e.roleName,"".concat(Kp(t),"/prompts")),e.updates);var t},updateResourcePermissions:function(e,t,n){return px.put((s=e,a=t,"".concat(cp,"/api/permissions/").concat(s,"/").concat(a)),n);var s,a},updateSharedLink:function(e){return px.patch((t=e,"".concat(Cp,"/").concat(t)));var t},updateTokenCount:function(e){return px.post("".concat(cp,"/api/tokenizer"),{arg:e})},updateUserKey:function(e){if(!e.value)throw new Error("value is required");return px.put(Tp,e)},updateUserPlugins:function(e){return px.post("".concat(cp,"/api/user/plugins"),e)},uploadAgentAvatar:function(e){return px.postMultiPart("".concat(Fp(),"/agents/").concat(e.agent_id,"/avatar"),e.formData)},uploadAssistantAvatar:function(e){return px.postMultiPart(Mp({isAvatar:!0,path:"".concat(e.assistant_id,"/avatar"),options:{model:e.model,endpoint:e.endpoint},version:e.version}),e.formData)},uploadAvatar:function(e){return px.postMultiPart("".concat(Fp(),"/avatar"),e)},uploadFile:function(e,t){var n=t?{signal:t}:void 0;return px.postMultiPart(Dp(),e,n)},uploadImage:function(e,t){var n=t?{signal:t}:void 0;return px.postMultiPart(Fp(),e,n)},userKeyQuery:function(e){return px.get((t=e,"".concat(Tp,"?name=").concat(t)));var t},verifyEmail:function(e){return px.post("".concat(cp,"/api/user/verify"),e)},verifyTwoFactor:function(e){return px.post("".concat(cp,"/api/auth/2fa/verify"),e)},verifyTwoFactorTemp:function(e){return px.post("".concat(cp,"/api/auth/2fa/verify-temp"),e)}});var hx={string:function(e){if(e.enum)return uo(e.enum);var t=po();return void 0!==e.minLength&&(t=t.min(e.minLength)),void 0!==e.maxLength&&(t=t.max(e.maxLength)),t},number:function(e){var t=vo();return void 0!==e.minimum&&(t=t.min(e.minimum)),void 0!==e.maximum&&(t=t.max(e.maximum)),t},integer:function(e){return hx.number(e).int()},boolean:function(){return go()},array:function(e){if(e.items){var t=gx(e.items);return xo(t||wo())}return xo(wo())},object:function(e){var t={};return e.properties&&Object.entries(e.properties).forEach((function(n){var s=n[0],a=n[1],r=gx(a);t[s]=r||wo(),e.required&&e.required.includes(s)?t[s]=t[s].describe(a.description||""):t[s]=t[s].optional().describe(a.description||"")})),mo(t)}};function gx(e){if("object"!==e.type||0!==Object.keys(e.properties||{}).length)return(hx[e.type]||function(){return wo()})(e)}var xx,vx,bx,_x,yx,jx,wx=function(){function e(e,t,n,s){this.name=e,this.description=t,this.parameters=n,this.strict=null!=s&&s}return e.prototype.toObjectTool=function(){var e=qd(qd({},this.parameters),{additionalProperties:!this.strict&&void 0});return{type:Jd.function,function:qd({name:this.name,description:this.description,parameters:e},this.strict?{strict:this.strict}:{})}},e}(),Nx=function(e,t,n,s,a,r,o){this.domain=e,this.basePath=t,this.method=n,this.operation=s,this.isConsequential=a,this.contentType=r,this.parameterLocations=o},Cx=function(){function e(e){this.config=e,this.authHeaders={},this.path=e.basePath}return e.prototype.setParams=function(e){if(this.operationHash=function(e){return ve.createHash("sha1").update(e).digest("hex")}(JSON.stringify(e)),this.params=qd({},e),this.config.parameterLocations)for(var t=0,n=Object.entries(e);t<n.length;t++){var s=n[t],a=s[0],r=s[1];if("path"===this.config.parameterLocations[a]){var o="{".concat(a,"}");this.path.includes(o)&&(this.path=this.path.replace(o,encodeURIComponent(String(r))),delete this.params[a])}}else for(var i=0,l=Object.entries(e);i<l.length;i++){var c=l[i];a=c[0],r=c[1],o="{".concat(a,"}"),this.path.includes(o)&&(this.path=this.path.replace(o,encodeURIComponent(String(r))),delete this.params[a])}return this},e.prototype.setAuth=function(e){return Yd(this,0,void 0,(function(){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h,g,x,v;return Xd(this,(function(b){if(!e.auth)return[2,this];if(t=e.auth,n=t.type,s=t.authorization_type,a=t.custom_auth_header,r=t.authorization_url,o=t.client_url,i=t.scope,l=t.token_exchange_method,c=e.api_key,d=e.oauth_client_id,u=e.oauth_client_secret,m=e.oauth_token_expires_at,p=e.oauth_access_token,f=void 0===p?"":p,h=null!=c&&c.length>0&&n===Zm.ServiceHttp,g=!!(null!=d&&d&&null!=u&&u&&n===Zm.OAuth&&null!=r&&r&&null!=o&&o&&null!=i&&i&&l),h&&s===Jm.Basic)x=ye.from(c).toString("base64"),this.authHeaders.Authorization="Basic ".concat(x);else if(h&&s===Jm.Bearer)this.authHeaders.Authorization="Bearer ".concat(c);else if(h&&s===Jm.Custom&&null!=a&&a)this.authHeaders[a]=c;else if(g){if(v=new Date,!f)throw new Error("No access token found. Please log in first.");if(m&&v>=new Date(m))throw new Error("Access token is expired. Please re-login.");this.authToken=f,this.authHeaders.Authorization="Bearer ".concat(this.authToken)}return[2,this]}))}))},e.prototype.execute=function(){return Yd(this,0,void 0,(function(){var e,t,n,s,a,r,o,i,l,c,d;return Xd(this,(function(u){if(e=function(e,t){var n=e.replace(/\/$/,""),s=t.replace(/^\//,""),a="".concat(n,"/").concat(s);return new je(a).toString()}(this.config.domain,this.path),t=qd(qd({},this.authHeaders),this.config.contentType?{"Content-Type":this.config.contentType}:{}),n=this.config.method.toLowerCase(),s=co.create(),a={},r={},this.config.parameterLocations&&this.params)for(o=0,i=Object.keys(this.params);o<i.length;o++)l=i[o],c=this.config.parameterLocations[l]||("get"===n?"query":"body"),d=this.params[l],"query"===c?a[l]=d:"header"===c?t[l]=String(d):"body"===c&&(r[l]=d);else this.params&&(Object.assign(a,this.params),Object.assign(r,this.params));if("get"===n)return[2,s.get(e,{headers:t,params:a})];if("post"===n)return[2,s.post(e,r,{headers:t,params:a})];if("put"===n)return[2,s.put(e,r,{headers:t,params:a})];if("delete"===n)return[2,s.delete(e,{headers:t,data:r,params:a})];if("patch"===n)return[2,s.patch(e,r,{headers:t,params:a})];throw new Error("Unsupported HTTP method: ".concat(n))}))}))},e.prototype.getConfig=function(){return this.config},e}(),kx=function(){function e(e,t,n,s,a,r,o){this.config=new Nx(e,t,n,s,a,r,o)}return Object.defineProperty(e.prototype,"domain",{get:function(){return this.config.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.config.basePath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this.config.method},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"operation",{get:function(){return this.config.operation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConsequential",{get:function(){return this.config.isConsequential},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this.config.contentType},enumerable:!1,configurable:!0}),e.prototype.createExecutor=function(){return new Cx(this.config)},e.prototype.setParams=function(e){var t=this.createExecutor();return t.setParams(e),t},e.prototype.setAuth=function(e){return Yd(this,0,void 0,(function(){return Xd(this,(function(t){return[2,this.createExecutor().setAuth(e)]}))}))},e.prototype.execute=function(){return Yd(this,0,void 0,(function(){return Xd(this,(function(e){return[2,this.createExecutor().execute()]}))}))},e}();function Sx(e,t){if("$ref"in e&&t){for(var n=t,s=0,a=e.$ref.replace(/^#\/components\//,"").split("/");s<a.length;s++){var r=a[s];if("object"!=typeof n||null===n||!(r in n))throw new Error("Could not resolve reference: ".concat(e.$ref));n=n[r]}return Sx(n,t)}return e}function Tx(e){return e.replace(/[^a-zA-Z0-9_-]/g,"")}function Ex(e,t){var n,s,a,r,o,i,l,c;void 0===t&&(t=!1);for(var d=[],u={},m={},p=null!==(r=null===(a=null===(s=e.servers)||void 0===s?void 0:s[0])||void 0===a?void 0:a.url)&&void 0!==r?r:"",f=0,h=Object.entries(e.paths);f<h.length;f++)for(var g=h[f],x=g[0],v=g[1],b=0,_=Object.entries(v);b<_.length;b++){var y=_[b],j=y[0],w={},N=y[1],C="".concat(j,"_").concat(x),k=N.operationId||Tx(C),S=N.summary||N.description||"",T=null!==(o=N["x-strict"])&&void 0!==o&&o,E={type:"object",properties:{},required:[]};if(N.parameters)for(var R=0,I=null!==(i=N.parameters)&&void 0!==i?i:[];R<I.length;R++){var P=Sx(I[R],e.components),A=P.name;if(A&&P.schema){var M=Sx(P.schema,e.components);E.properties[A]=M,P.required&&E.required.push(A),w[A]="query"===P.in||"path"===P.in||"header"===P.in||"body"===P.in?P.in:"query"}}var L="";if(N.requestBody){var O=N.requestBody.content;L=Object.keys(null!=O?O:{})[0];var D=Sx(U=null===(l=null==O?void 0:O[L])||void 0===l?void 0:l.schema,e.components);if(E.properties=qd(qd({},E.properties),D.properties),D.required&&(n=E.required).push.apply(n,D.required),D.properties)for(var F in D.properties)w[F]="body";L=null!=L?L:"application/json"}var z=new wx(k,S,E,T);d.push(z);var U,V=new kx(p,x,j,k,!(null===(c=N["x-openai-isConsequential"])||void 0===c||!c),L,w);u[k]=V,t&&Object.keys(E.properties).length>0&&(U=gx(E))&&(m[k]=U)}return{functionSignatures:d,requestBuilders:u,zodSchemas:m}}function Rx(e){var t;try{var n=void 0;try{n=JSON.parse(e)}catch(N){n=be(e)}if(!n.servers||!Array.isArray(n.servers)||0===n.servers.length)return{status:!1,message:"Could not find a valid URL in `servers`"};if(!n.servers[0].url)return{status:!1,message:"Could not find a valid URL in `servers`"};var s=n.paths;if(!s||"object"!=typeof s||0===Object.keys(s).length)return{status:!1,message:"No paths found in the OpenAPI spec."};for(var a=(null===(t=n.components)||void 0===t?void 0:t.schemas)||{},r=[],o=0,i=Object.entries(s);o<i.length;o++)for(var l=i[o],c=l[0],d=l[1],u=0,m=Object.entries(d);u<m.length;u++){var p=m[u],f=p[0],h=p[1],g=h.responses;if("object"==typeof h&&g)for(var x=0,v=Object.entries(g);x<v.length;x++){var b=v[x],_=b[0],y=b[1].content;if(y&&y["application/json"]&&y["application/json"].schema){var j=y["application/json"].schema;if("$ref"in j&&"string"==typeof j.$ref){var w=j.$ref.split("/").pop();w&&!a[w]&&r.push("In context=('paths', '".concat(c,"', '").concat(f,"', '").concat(_,"', 'response', 'content', 'application/json', 'schema'), reference to unknown component ").concat(w,"; using empty schema"))}}}}return{status:!0,message:r.join("\n")||"OpenAPI spec is valid.",spec:n}}catch(C){return console.error(C),{status:!1,message:"Error parsing OpenAPI spec."}}}var Ix={model:{key:"model",label:"com_ui_model",labelCode:!0,type:"string",component:"dropdown",optionType:"model",selectPlaceholder:"com_ui_select_model",searchPlaceholder:"com_ui_select_search_model",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:4},temperature:{key:"temperature",label:"com_endpoint_temperature",labelCode:!0,description:"com_endpoint_openai_temp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},topP:{key:"topP",label:"com_endpoint_top_p",labelCode:!0,description:"com_endpoint_anthropic_topp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},stop:{key:"stop",label:"com_endpoint_stop",labelCode:!0,description:"com_endpoint_openai_stop",descriptionCode:!0,placeholder:"com_endpoint_stop_placeholder",placeholderCode:!0,type:"array",default:[],component:"tags",optionType:"conversation",minTags:0,maxTags:4},imageDetail:{key:"imageDetail",label:"com_endpoint_plug_image_detail",labelCode:!0,description:"com_endpoint_openai_detail",descriptionCode:!0,type:"enum",default:Tu.auto,component:"slider",options:[Tu.low,Tu.auto,Tu.high],enumMappings:(xx={},xx[Tu.low]="com_ui_low",xx[Tu.auto]="com_ui_auto",xx[Tu.high]="com_ui_high",xx),optionType:"conversation",columnSpan:2}},Px=function(e,t){return qd(qd({},e),t)},Ax={modelLabel:{key:"modelLabel",label:"com_endpoint_custom_name",labelCode:!0,type:"string",default:"",component:"input",placeholder:"com_endpoint_openai_custom_name_placeholder",placeholderCode:!0,optionType:"conversation"},maxContextTokens:{key:"maxContextTokens",label:"com_endpoint_context_tokens",labelCode:!0,type:"number",component:"input",placeholder:"com_nav_theme_system",placeholderCode:!0,description:"com_endpoint_context_info",descriptionCode:!0,optionType:"model",columnSpan:2},resendFiles:{key:"resendFiles",label:"com_endpoint_plug_resend_files",labelCode:!0,description:"com_endpoint_openai_resend_files",descriptionCode:!0,type:"boolean",default:!0,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},promptPrefix:{key:"promptPrefix",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},fileTokenLimit:{key:"fileTokenLimit",label:"com_ui_file_token_limit",labelCode:!0,description:"com_ui_file_token_limit_desc",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,type:"number",component:"input",columnSpan:2}},Mx={chatGptLabel:qd(qd({},Ax.modelLabel),{key:"chatGptLabel"}),temperature:Px(Ix.temperature,{default:Gu.temperature.default,range:{min:Gu.temperature.min,max:Gu.temperature.max,step:Gu.temperature.step}}),top_p:Px(Ix.topP,{key:"top_p",default:Gu.top_p.default,range:{min:Gu.top_p.min,max:Gu.top_p.max,step:Gu.top_p.step}}),frequency_penalty:{key:"frequency_penalty",label:"com_endpoint_frequency_penalty",labelCode:!0,description:"com_endpoint_openai_freq",descriptionCode:!0,type:"number",default:Gu.frequency_penalty.default,range:{min:Gu.frequency_penalty.min,max:Gu.frequency_penalty.max,step:Gu.frequency_penalty.step},component:"slider",optionType:"model",columnSpan:4},presence_penalty:{key:"presence_penalty",label:"com_endpoint_presence_penalty",labelCode:!0,description:"com_endpoint_openai_pres",descriptionCode:!0,type:"number",default:Gu.presence_penalty.default,range:{min:Gu.presence_penalty.min,max:Gu.presence_penalty.max,step:Gu.presence_penalty.step},component:"slider",optionType:"model",columnSpan:4},max_tokens:{key:"max_tokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_openai_max_tokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},reasoning_effort:{key:"reasoning_effort",label:"com_endpoint_reasoning_effort",labelCode:!0,description:"com_endpoint_openai_reasoning_effort",descriptionCode:!0,type:"enum",default:Eu.none,component:"slider",options:[Eu.none,Eu.minimal,Eu.low,Eu.medium,Eu.high],enumMappings:(vx={},vx[Eu.none]="com_ui_none",vx[Eu.minimal]="com_ui_minimal",vx[Eu.low]="com_ui_low",vx[Eu.medium]="com_ui_medium",vx[Eu.high]="com_ui_high",vx),optionType:"model",columnSpan:4},useResponsesApi:{key:"useResponsesApi",label:"com_endpoint_use_responses_api",labelCode:!0,description:"com_endpoint_openai_use_responses_api",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_openai_use_web_search",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},reasoning_summary:{key:"reasoning_summary",label:"com_endpoint_reasoning_summary",labelCode:!0,description:"com_endpoint_openai_reasoning_summary",descriptionCode:!0,type:"enum",default:Ru.none,component:"slider",options:[Ru.none,Ru.auto,Ru.concise,Ru.detailed],enumMappings:(bx={},bx[Ru.none]="com_ui_none",bx[Ru.auto]="com_ui_auto",bx[Ru.concise]="com_ui_concise",bx[Ru.detailed]="com_ui_detailed",bx),optionType:"model",columnSpan:4},verbosity:{key:"verbosity",label:"com_endpoint_verbosity",labelCode:!0,description:"com_endpoint_openai_verbosity",descriptionCode:!0,type:"enum",default:Iu.none,component:"slider",options:[Iu.none,Iu.low,Iu.medium,Iu.high],enumMappings:(_x={},_x[Iu.none]="com_ui_none",_x[Iu.low]="com_ui_low",_x[Iu.medium]="com_ui_medium",_x[Iu.high]="com_ui_high",_x),optionType:"model",columnSpan:4},disableStreaming:{key:"disableStreaming",label:"com_endpoint_disable_streaming_label",labelCode:!0,description:"com_endpoint_disable_streaming",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},Lx={maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,range:{min:qu.maxOutputTokens.min,max:qu.maxOutputTokens.max,step:qu.maxOutputTokens.step},optionType:"model",columnSpan:2},temperature:Px(Ix.temperature,{default:qu.temperature.default,range:{min:qu.temperature.min,max:qu.temperature.max,step:qu.temperature.step}}),topP:Px(Ix.topP,{default:qu.topP.default,range:{min:qu.topP.min,max:qu.topP.max,step:qu.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_anthropic_topk",descriptionCode:!0,type:"number",default:qu.topK.default,range:{min:qu.topK.min,max:qu.topK.max,step:qu.topK.step},component:"slider",optionType:"model",columnSpan:4},promptCache:{key:"promptCache",label:"com_endpoint_prompt_cache",labelCode:!0,description:"com_endpoint_anthropic_prompt_cache",descriptionCode:!0,type:"boolean",default:qu.promptCache.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_anthropic_thinking",descriptionCode:!0,type:"boolean",default:qu.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_anthropic_thinking_budget",descriptionCode:!0,type:"number",component:"input",default:qu.thinkingBudget.default,range:{min:qu.thinkingBudget.min,max:qu.thinkingBudget.max,step:qu.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_anthropic_use_web_search",descriptionCode:!0,type:"boolean",default:qu.web_search.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2}},Ox={system:{key:"system",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},region:{key:"region",type:"string",label:"com_ui_region",labelCode:!0,component:"combobox",optionType:"conversation",selectPlaceholder:"com_ui_select_region",searchPlaceholder:"com_ui_select_search_region",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:2},maxTokens:{key:"maxTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},temperature:Px(Ix.temperature,{default:1,range:{min:0,max:1,step:.01}}),topK:Px(Lx.topK,{range:{min:0,max:500,step:1}}),topP:Px(Ix.topP,{default:.999,range:{min:0,max:1,step:.01}})},Dx={temperature:Px(Ix.temperature,{default:.7,range:{min:0,max:1,step:.01}}),topP:Px(Ix.topP,{range:{min:0,max:1,step:.01}})},Fx={temperature:Px(Ix.temperature,{default:.3,range:{min:0,max:1,step:.01}}),topP:Px(Ix.topP,{default:.75,range:{min:.01,max:.99,step:.01}})},zx={temperature:Px(Ix.temperature,{default:.5,range:{min:0,max:1,step:.01}}),topP:Px(Ix.topP,{default:.9,range:{min:0,max:1,step:.01}})},Ux={temperature:Px(Ix.temperature,{default:Ku.temperature.default,range:{min:Ku.temperature.min,max:Ku.temperature.max,step:Ku.temperature.step}}),topP:Px(Ix.topP,{default:Ku.topP.default,range:{min:Ku.topP.min,max:Ku.topP.max,step:Ku.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_google_topk",descriptionCode:!0,type:"number",default:Ku.topK.default,range:{min:Ku.topK.min,max:Ku.topK.max,step:Ku.topK.step},component:"slider",optionType:"model",columnSpan:4},maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_google_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,default:Ku.maxOutputTokens.default,range:{min:Ku.maxOutputTokens.min,max:Ku.maxOutputTokens.max,step:Ku.maxOutputTokens.step},optionType:"model",columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_google_thinking",descriptionCode:!0,type:"boolean",default:Ku.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_google_thinking_budget",descriptionCode:!0,placeholder:"com_ui_auto",placeholderCode:!0,type:"number",component:"input",range:{min:Ku.thinkingBudget.min,max:Ku.thinkingBudget.max,step:Ku.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_endpoint_use_search_grounding",labelCode:!0,description:"com_endpoint_google_use_search_grounding",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},Vx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,Ux.maxOutputTokens,Ux.temperature,Ux.topP,Ux.topK,Ax.resendFiles,Ux.thinking,Ux.thinkingBudget,Ux.web_search,Ax.fileTokenLimit],Bx=[Ix.model,Ax.modelLabel,Ax.promptPrefix],$x=[Ax.maxContextTokens,Ux.maxOutputTokens,Ux.temperature,Ux.topP,Ux.topK,Ax.resendFiles,Ux.thinking,Ux.thinkingBudget,Ux.web_search,Ax.fileTokenLimit],Hx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,Mx.max_tokens,Mx.temperature,Mx.top_p,Mx.frequency_penalty,Mx.presence_penalty,Ix.stop,Ax.resendFiles,Ix.imageDetail,Mx.web_search,Mx.reasoning_effort,Mx.useResponsesApi,Mx.reasoning_summary,Mx.verbosity,Mx.disableStreaming,Ax.fileTokenLimit],Gx=[Ix.model,Ax.modelLabel,Ax.promptPrefix],Kx=[Ax.maxContextTokens,Mx.max_tokens,Mx.temperature,Mx.top_p,Mx.frequency_penalty,Mx.presence_penalty,Ix.stop,Ax.resendFiles,Ix.imageDetail,Mx.reasoning_effort,Mx.reasoning_summary,Mx.verbosity,Mx.useResponsesApi,Mx.web_search,Mx.disableStreaming,Ax.fileTokenLimit],Wx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,Lx.maxOutputTokens,Lx.temperature,Lx.topP,Lx.topK,Ax.resendFiles,Lx.promptCache,Lx.thinking,Lx.thinkingBudget,Lx.web_search,Ax.fileTokenLimit],qx=[Ix.model,Ax.modelLabel,Ax.promptPrefix],Qx=[Ax.maxContextTokens,Lx.maxOutputTokens,Lx.temperature,Lx.topP,Lx.topK,Ax.resendFiles,Lx.promptCache,Lx.thinking,Lx.thinkingBudget,Lx.web_search,Ax.fileTokenLimit],Yx=[Ax.modelLabel,Ox.system,Ax.maxContextTokens,Ox.maxTokens,Ox.temperature,Ox.topP,Ox.topK,Ix.stop,Ax.resendFiles,Ox.region,Lx.thinking,Lx.thinkingBudget,Ax.fileTokenLimit],Xx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,Ox.maxTokens,Dx.temperature,Dx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],Zx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,Ox.maxTokens,Fx.temperature,Fx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],Jx=[Ax.modelLabel,Ax.promptPrefix,Ax.maxContextTokens,zx.temperature,zx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],ev=[Ix.model,Ax.modelLabel,Ox.system,Ix.stop],tv=[Ax.maxContextTokens,Ox.maxTokens,Ox.temperature,Ox.topP,Ox.topK,Ax.resendFiles,Ox.region,Lx.thinking,Lx.thinkingBudget,Ax.fileTokenLimit],nv=[Ix.model,Ax.modelLabel,Ax.promptPrefix],sv=[Ax.maxContextTokens,Ox.maxTokens,Dx.temperature,Dx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],av=[Ix.model,Ax.modelLabel,Ax.promptPrefix],rv=[Ax.maxContextTokens,Ox.maxTokens,Fx.temperature,Fx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],ov=[Ix.model,Ax.modelLabel,Ax.promptPrefix],iv=[Ax.maxContextTokens,zx.temperature,zx.topP,Ax.resendFiles,Ox.region,Ax.fileTokenLimit],lv=((yx={})[Nu.openAI]=Hx,yx[Nu.azureOpenAI]=Hx,yx[Nu.custom]=Hx,yx[Nu.anthropic]=Wx,yx["".concat(Nu.bedrock,"-").concat(ku.Anthropic)]=Yx,yx["".concat(Nu.bedrock,"-").concat(ku.MistralAI)]=Xx,yx["".concat(Nu.bedrock,"-").concat(ku.Cohere)]=Zx,yx["".concat(Nu.bedrock,"-").concat(ku.Meta)]=Jx,yx["".concat(Nu.bedrock,"-").concat(ku.AI21)]=Jx,yx["".concat(Nu.bedrock,"-").concat(ku.Amazon)]=Jx,yx["".concat(Nu.bedrock,"-").concat(ku.DeepSeek)]=Jx,yx[Nu.google]=Vx,yx),cv={col1:Gx,col2:Kx},dv={col1:ov,col2:iv},uv=((jx={})[Nu.openAI]=cv,jx[Nu.azureOpenAI]=cv,jx[Nu.custom]=cv,jx[Nu.anthropic]={col1:qx,col2:Qx},jx["".concat(Nu.bedrock,"-").concat(ku.Anthropic)]={col1:ev,col2:tv},jx["".concat(Nu.bedrock,"-").concat(ku.MistralAI)]={col1:nv,col2:sv},jx["".concat(Nu.bedrock,"-").concat(ku.Cohere)]={col1:av,col2:rv},jx["".concat(Nu.bedrock,"-").concat(ku.Meta)]=dv,jx["".concat(Nu.bedrock,"-").concat(ku.AI21)]=dv,jx["".concat(Nu.bedrock,"-").concat(ku.Amazon)]=dv,jx["".concat(Nu.bedrock,"-").concat(ku.DeepSeek)]=dv,jx[Nu.google]={col1:Bx,col2:$x},jx),mv=Object.entries(uv).reduce((function(e,t){var n=t[0],s=t[1];return s&&(e[n]=s.col2),e}),{});function pv(e){return null==e||""===e||e===dh.EPHEMERAL_AGENT_ID}var fv=(e=>(e.SIMPLE="simple",e.ADVANCED="advanced",e))(fv||{}),hv=(e=>(e.browser="browser",e.external="external",e))(hv||{});const gv="prompt-textarea",xv="global-audio";var vv=(e=>(e.landing="landing",e.menuItem="menu-item",e.nav="nav",e.message="message",e))(vv||{}),bv=(e=>(e.advanced="advanced",e.builder="builder",e.actions="actions",e.model="model",e.version="version",e.mcp="mcp",e))(bv||{});const _v=450;var yv=(e=>(e.Top="top",e.Right="right",e.Bottom="bottom",e.Left="left",e))(yv||{}),jv=(e=>(e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e))(jv||{});function wv(e){var t;const n={};for(const s of e){if(null==s)continue;const e=s.toolCallId||"";0!==e.length&&(n[e]||(n[e]=[]),null==(t=n[e])||t.push(s))}return n}function Nv(e){const t={};for(const n of e)t[n.file_id]=n;return t}function Cv(e){const t={};for(const n of e)t[n.id]=n;return t}function kv(e){return e.reduce(((e,t)=>(e[t.pluginKey]=t,e)),{})}const Sv=e=>e?{list:e,map:kv(e)}:{list:[],map:{}};function Tv(e,t){return e.map((e=>"string"==typeof e?null==t?void 0:t[e]:e)).filter((e=>void 0!==e))}function Ev(e){try{JSON.parse(e)}catch(Fi){return!1}return!0}function Rv(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch(Fi){return e}}const Iv=["text/x-"],Pv={paths:function(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19.6663 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V14.6666L19.6663 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M19.667 9.66663V14.6666H24.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M21.3337 18.8334H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M21.3337 22.1666H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M16.3337 15.5H15.5003H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#FF5588",title:"Document"},Av={paths:function(){return s.jsx(s.Fragment,{children:s.jsx("path",{d:"M15.5 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V13.5V18M15.5 10.5H23.8333C24.7538 10.5 25.5 11.2462 25.5 12.1667V13.5V18M15.5 10.5V25.5M15.5 25.5H18H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V18M15.5 25.5H12.1667C11.2462 25.5 10.5 24.7538 10.5 23.8333V18M10.5 18H25.5",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},fill:"#10A37F",title:"Spreadsheet"},Mv={file:{paths:function(){return s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M18.833 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V15.5L18.833 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M18.833 9.66663V15.5H24.6663",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#0000FF",title:"File"},text:Pv,txt:Pv,csv:Av,"application/pdf":Pv,pdf:Pv,"text/x-":{paths:ed,fill:"#FF6E3C",title:"Code"},artifact:{paths:ed,fill:"#2D305C",title:"Code"}},Lv=(e="")=>{if(Mv[e])return Mv[e];if(Am.test(e))return Av;const t=Iv.find((t=>e.includes(t)));if(t&&Mv[t])return Mv[t];const n=e.split("/")[0]||"text";return Mv[n]?Mv[n]:Mv.file};function Ov(e,t=!1){if(!e)return"";const n=new Date(e);if(t)return n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"2-digit"});return`${n.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getFullYear()}`}function Dv(e,t){const n=e.getQueryData([ex.files]);if(!n)return void console.warn("No current files found in cache, skipped updating file query cache");n.findIndex((e=>e.file_id===t.file_id))>-1?console.warn("File already exists in cache, skipped updating file query cache"):e.setQueryData([ex.files],[{...t},...n])}function Fv(e,t=2){if(0===e)return 0;const n=t<0?0:t,s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(n))}const{checkType:zv}=Gm,Uv=/\$\\ce\{/g,Vv=/\$\\pu\{/g,Bv=/\$\\\\ce\{[^}]*\}\$/g,$v=/\$\\\\pu\{[^}]*\}\$/g,Hv=new RegExp("(?<![\\\\$])\\$(?!\\$)(?=\\d+(?:,\\d{3})*(?:\\.\\d+)?(?:[KMBkmb])?(?:\\s|$|[^a-zA-Z\\d]))","g"),Gv=new RegExp("(?<!\\\\)\\$(?!\\$)((?:[^$\\n]|\\\\[$])+?)(?<!\\\\)(?<!`)\\$(?!\\$)","g");function Kv(e,t){let n=0,s=t.length-1;for(;n<=s;){const a=Math.floor((n+s)/2),[r,o]=t[a];if(e>=r&&e<=o)return!0;e<r?s=a-1:n=a+1}return!1}function Wv(e){if(!e.includes("$"))return e;let t=e;(e.includes("\\ce{")||e.includes("\\pu{"))&&(t=function(e){let t=e.replace(Uv,"$\\\\ce{");return t=t.replace(Vv,"$\\\\pu{"),t=t.replace(Bv,(e=>`$${e}$`)),t=t.replace($v,(e=>`$${e}$`)),t}(e));const n=function(e){const t=[];let n=-1,s=-1;for(let a=0;a<e.length;a++){const r=e[a];"`"===r&&a+2<e.length&&"`"===e[a+1]&&"`"===e[a+2]?-1===s?(s=a,a+=2):(t.push([s,a+2]),s=-1,a+=2):"`"===r&&-1===s&&(-1===n?n=a:(t.push([n,a]),n=-1))}return t}(t),s=[];let a,r=0;for(Hv.lastIndex=0;null!==(a=Hv.exec(t));)Kv(a.index,n)||(s.push(t.substring(r,a.index)),s.push("\\$"),r=a.index+1);s.push(t.substring(r)),t=s.join("");const o=[];for(r=0,Gv.lastIndex=0;null!==(a=Gv.exec(t));)Kv(a.index,n)||(o.push(t.substring(r,a.index)),o.push(`$$${a[1]}$$`),r=a.index+a[0].length);return o.push(t.substring(r)),o.join("")}const qv=e=>t=>{t?"string"!=typeof t?t.value&&e(t.value+""):e(t):e("")},Qv=e=>({label:qf[e]??e,value:e}),Yv=()=>({...Bu,model:localStorage.getItem(uh.LAST_AGENT_MODEL)??"",provider:Qv(localStorage.getItem(uh.LAST_AGENT_PROVIDER)??"")}),Xv=({agent:e,fileMap:t})=>{var n,a,r,o,i,l,c,d,u,m,p,f;const h=(null==e?void 0:e.isPublic)??!1,g=(null==(a=null==(n=null==e?void 0:e.tool_resources)?void 0:n.context)?void 0:a.file_ids)??[];(null==(o=null==(r=null==e?void 0:e.tool_resources)?void 0:r.ocr)?void 0:o.file_ids)&&g.push(...e.tool_resources.ocr.file_ids);const x={...e??{},label:(null==e?void 0:e.name)??"",value:(null==e?void 0:e.id)??"",icon:h?s.jsx(we,{className:"icon-md text-green-400"}):null,context_files:g.length>0?[]:void 0,knowledge_files:(null==(l=null==(i=null==e?void 0:e.tool_resources)?void 0:i.file_search)?void 0:l.file_ids)?[]:void 0,code_files:(null==(d=null==(c=null==e?void 0:e.tool_resources)?void 0:c.execute_code)?void 0:d.file_ids)?[]:void 0};if(!t)return x;const v=({file_id:e,tool_resource:n,list:s})=>{const a=t[e],r=n===eu.file_search?_m.vectordb:(null==a?void 0:a.source)??_m.local;a?null==s||s.push([e,{file_id:a.file_id,type:a.type,filepath:a.filepath,filename:a.filename,width:a.width,height:a.height,size:a.bytes,preview:a.filepath,metadata:a.metadata,progress:1,source:r}]):null==s||s.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:Nu.agents,source:r}])};return x.context_files&&g.length>0&&g.forEach((e=>v({file_id:e,list:x.context_files,tool_resource:eu.context}))),x.knowledge_files&&(null==(m=null==(u=null==e?void 0:e.tool_resources)?void 0:u.file_search)?void 0:m.file_ids)&&e.tool_resources.file_search.file_ids.forEach((e=>v({file_id:e,list:x.knowledge_files,tool_resource:eu.file_search}))),x.code_files&&(null==(f=null==(p=null==e?void 0:e.tool_resources)?void 0:p.execute_code)?void 0:f.file_ids)&&e.tool_resources.execute_code.file_ids.forEach((e=>v({file_id:e,list:x.code_files,tool_resource:eu.execute_code}))),x},Zv=(e,t={})=>{const{size:n="md",className:a="",showBorder:r=!0}=t,o=(e=>(null==e?void 0:e.avatar)?"string"==typeof e.avatar?e.avatar:e.avatar&&"object"==typeof e.avatar&&"filepath"in e.avatar?e.avatar.filepath:null:null)(e),i={sm:"h-12 w-12 sm:h-14 sm:w-14",md:"h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24",lg:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28",xl:"h-24 w-24"},l=r?"border-1 border-border-medium":"";return o?s.jsx("div",{className:`flex items-center justify-center ${i[n]} ${a}`,children:s.jsx("img",{src:o,alt:`${(null==e?void 0:e.name)||"Agent"} avatar`,className:`${i[n]} rounded-full object-cover shadow-lg ${l}`,loading:"lazy"})}):s.jsxs("div",{className:`relative flex items-center justify-center ${i[n]} ${a}`,children:[s.jsx("div",{className:"absolute inset-0 rounded-full border border-border-medium bg-surface-secondary"}),s.jsx("div",{className:`relative flex items-center justify-center rounded-full ${{sm:"h-10 w-10 sm:h-12 sm:w-12",md:"h-12 w-12 sm:h-16 sm:w-16 md:h-20 md:w-20",lg:"h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24",xl:"h-20 w-20"}[n]}`,children:s.jsx(Ne,{className:`text-text-primary ${{sm:"h-6 w-6 sm:h-7 sm:w-7",md:"h-6 w-6 sm:h-8 sm:w-8 md:h-10 md:w-10",lg:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12",xl:"h-10 w-10"}[n]}`,strokeWidth:1.5})})]})},Jv=ko((e=>{localStorage.removeItem(`${uh.TEXT_DRAFT}${e??""}`)}),2500),eb=({id:e,value:t})=>{t&&t.length>1?localStorage.setItem(`${uh.TEXT_DRAFT}${e}`,(e=>{try{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))}catch{return""}})(t)):localStorage.removeItem(`${uh.TEXT_DRAFT}${e}`)},tb=e=>(e=>{try{const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return(new TextDecoder).decode(n)}catch{return""}})((localStorage.getItem(`${uh.TEXT_DRAFT}${e??""}`)??"")||""),nb={today:"com_ui_date_today",yesterday:"com_ui_date_yesterday",previous7Days:"com_ui_date_previous_7_days",previous30Days:"com_ui_date_previous_30_days",january:"com_ui_date_january",february:"com_ui_date_february",march:"com_ui_date_march",april:"com_ui_date_april",may:"com_ui_date_may",june:"com_ui_date_june",july:"com_ui_date_july",august:"com_ui_date_august",september:"com_ui_date_september",october:"com_ui_date_october",november:"com_ui_date_november",december:"com_ui_date_december"},sb=new Map([["december",11],["november",10],["october",9],["september",8],["august",7],["july",6],["june",5],["may",4],["april",3],["march",2],["february",1],["january",0]]),ab=Object.fromEntries(Object.entries(nb).map((([e,t])=>[t,e]))),rb=new Set([nb.today,nb.yesterday,nb.previous7Days,nb.previous30Days]),ob=e=>{if(!Array.isArray(e))return[];const t=new Set,n=new Map,s=new Date(Date.now());e.forEach((e=>{if(!e||t.has(e.conversationId))return;let a;t.add(e.conversationId),a=e.updatedAt?Io(e.updatedAt):s;const r=(e=>{const t=new Date(Date.now());if(Po(e))return nb.today;if(Ao(e,{start:Mo(Lo(t,1)),end:t}))return nb.yesterday;if(Ao(e,{start:Lo(t,7),end:t}))return nb.previous7Days;if(Ao(e,{start:Lo(t,30),end:t}))return nb.previous30Days;if(Ao(e,{start:Oo(t),end:t})){const t=Do(e,"MMMM").toLowerCase();return nb[t]}return" "+Fo(e).toString()})(a);n.has(r)||n.set(r,[]),n.get(r).push(e)}));const a=new Map;rb.forEach((e=>{n.has(e)&&a.set(e,n.get(e))}));return Array.from(n.keys()).filter((e=>!rb.has(e))).sort(((e,t)=>{const[n,s]=[parseInt(e.trim()),parseInt(t.trim())];if(n!==s)return s-n;const[a,r]=[ab[e],ab[t]];return(sb.get(r)??-1)-(sb.get(a)??-1)})).forEach((e=>{a.set(e,n.get(e))})),a.forEach((e=>{e.sort(((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))})),Array.from(a,(([e,t])=>[e,t]))};function ib(e,t){if(e)for(const n of e.pages){const e=n.conversations.find((e=>e.conversationId===t));if(e)return e}}function lb(e,t){const n=e.getQueryCache().findAll([ex.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,(e=>e?e.pages.some((e=>e.conversations.some((e=>e.conversationId===t.conversationId))))?e:{...e,pages:[{...e.pages[0],conversations:[t,...e.pages[0].conversations]},...e.pages.slice(1)]}:e))}function cb(e,t,n){const s=e.getQueryCache().findAll([ex.allConversations],{exact:!1});for(const a of s)e.setQueryData(a.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===t?n(e):e))})))}:e))}function db(e,t){const n=e.getQueryCache().findAll([ex.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==t))}))).filter((e=>e.conversations.length>0))}:e))}const ub=(e,t)=>{const{endpoint:n,title:s,model:a,tools:r,promptPrefix:o,chatGptLabel:i,modelLabel:l}=e,c=a??"";let d="",u="";return l&&(u=l),u&&null!=s&&s&&u.toLowerCase().includes(s.toLowerCase())?(d=u+": ",u=""):null!=s&&s&&"New Chat"!==s.trim()&&(d=s+": "),!0===t?`${c}${u?` | ${u}`:""}${null!=o&&o?` | ${o}`:""}${r?` | ${r.map((e=>"string"==typeof e?e:e.pluginKey)).join(", ")}`:""}`:`${d}${c}${u?` (${u})`:""}`.trim()},mb=(e,t)=>{const n={...e};return n.tools&&n.tools.length>0&&(n.tools=n.tools.filter((e=>{let n;return"string"==typeof e?n=e:({pluginKey:n}=e),!!t[n]})).map((e=>"string"==typeof e?e:e.pluginKey))),n},pb=e=>Array.from(e.matchAll(/{{([^{}]+?)}}/gi)).map((e=>e[1].trim().toLowerCase())).some((e=>!bh[e])),fb=e=>`{{${e}}}`;function hb(e,t){if(e.focus(),window.getSelection()&&document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,t);else{console.warn("insertTextAtCursor: document.execCommand is not supported");const n=e.selectionStart,s=e.selectionEnd,a=e.value.substring(0,n),r=e.value.substring(s);e.value=a+t+r,e.selectionStart=e.selectionEnd=n+t.length;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}}const gb=e=>{e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)};function xb(e,t){e.value.endsWith(t)&&(e.value=e.value.slice(0,-1),e.setSelectionRange(e.value.length,e.value.length),e.dispatchEvent(new Event("input",{bubbles:!0}))),e.focus()}const vb=e=>!!e&&e.scrollHeight>e.clientHeight,bb=(e,t)=>{if(!e)return"";if(e.text)return e.text;if(e.content&&e.content.length>0)for(let n=e.content.length-1;n>=0;n--){const s=e.content[n];if(s&&s.type!==hh.TEXT)continue;const a=("string"==typeof(null==s?void 0:s.text)?s.text:null==s?void 0:s.text.value)??"";if(a.length>0)return!0===t?`${a}-${n}`:a}return""},_b=e=>e?e.text?e.text:e.content&&e.content.length>0?e.content.filter((e=>e.type===hh.TEXT)).map((e=>("string"==typeof e.text?e.text:e.text.value)||"")).filter((e=>e.length>0)).join("\n"):"":"",yb=(e,t)=>{if(!e)return"";const n=bb(e,!0);return`${e.messageId??""}${dh.COMMON_DIVIDER}${s=n,"string"!=typeof s||0===s.length?"0":`${s.length}${s.slice(-10)}`}${dh.COMMON_DIVIDER}${e.conversationId??t}`;var s},jb=e=>{const t=document.getElementById("messages-end");t&&(t.scrollIntoView({behavior:"instant"}),e&&e())},wb=["python","javascript","java","go","bash","c","cpp","csharp","css","diff","graphql","json","kotlin","less","lua","makefile","markdown","objectivec","perl","php","php-template","plaintext","python-repl","r","ruby","rust","scss","shell","sql","swift","typescript","vbnet","wasm","xml","yaml"],Nb={c:"c",cpp:"cpp","c++":"cpp",cplusplus:"cpp",d:"d",f90:"f90",fortran:"f90",fortran90:"f90",go:"go",golang:"go",java:"java",js:"js",javascript:"js",node:"js",nodejs:"js",php:"php",py:"py",python:"py",python3:"py",rs:"rs",rust:"rs",ts:"ts",typescript:"ts"};const Cb=e=>{const t={};if(!e)return t;for(const n of Object.keys(e))t[n]=!!e[n];return t},kb=(e,t)=>{var n,s;const a=new Set(Wf),r=[];for(const o in t)(e[o]||(null==(n=t[o])?void 0:n.type)&&a.has(null==(s=t[o])?void 0:s.type))&&r.push(o);return r};function Sb(e,t,n){if(!e||null==t)return;const s=e[t];return s?s[n]:void 0}function Tb(e){const t=Cb(e);return kb(t,e).sort(((t,n)=>{var s,a;return((null==(s=null==e?void 0:e[t])?void 0:s.order)??0)-((null==(a=null==e?void 0:e[n])?void 0:a.order)??0)}))}const Eb=uh.LAST_CONVO_SETUP+"_0";function Rb(e){const{conversation:t,newEndpoint:n,endpointsConfig:s,modularChat:a=!1}=e,r=null==t?void 0:t.endpoint,o={...t,endpoint:n,conversationId:"new"},i=Mu(n)&&Mu(r)&&r===n,l=(null==t?void 0:t.conversationId)??"",c=!(!l||"new"===l),d=Sb(s,r,"type")??r,u=Sb(s,n,"type")??n,m=Jf.has(r??""),p=Jf.has(d??""),f=m||p||i,h=Jf.has(n??""),g=Jf.has(u??"");return{template:o,shouldSwitch:r===n||a||i,isExistingConversation:c,isCurrentModular:f,newEndpointType:u,isNewModular:h||g||i}}function Ib(e){const{modelSpecs:t,interface:n}=e??{},{list:s,prioritize:a}=t??{};if(!s)return;const r=null==s?void 0:s.find((e=>e.default));if(!0===a||!(null==n?void 0:n.modelSelect)){const e=localStorage.getItem(uh.LAST_SPEC),t=null==s?void 0:s.find((t=>t.name===e));return r||t||(null==s?void 0:s[0])}if(r)return r;const o=JSON.parse(localStorage.getItem(uh.LAST_CONVO_SETUP+"_0")??"{}");return o.spec?null==s?void 0:s.find((e=>e.name===o.spec)):void 0}function Pb(e){if(e)return{...e.preset,spec:e.name,iconURL:Ab(e)}}function Ab(e){return e.iconURL??e.preset.iconURL??e.preset.endpoint??""}function Mb({endpointsConfig:e,iconURL:t,endpoint:n}){return((null==e?void 0:e[t??""])?t??n:n)??""}function Lb({endpoint:e,endpointType:t,endpointsConfig:n,endpointIconURL:s}){const a=t??Sb(n,e,"type")??"",r=s??Sb(n,e,"iconURL")??"";return r&&null!=Nu[r]?r:a?"unknown":e??"unknown"}const Ob=({endpoint:e,assistant_id:t,agent_id:n,agentsMap:s,assistantMap:a})=>{var r;const o=Lu(e),i=Mu(e);if(o){return{entity:null==s?void 0:s[n??""],isAgent:o,isAssistant:i}}if(i){return{entity:null==(r=null==a?void 0:a[e??""])?void 0:r[t??""],isAgent:o,isAssistant:i}}return{entity:null,isAgent:o,isAssistant:i}},Db={[Qg.AGENT]:{resourceType:Qg.AGENT,defaultViewerRoleId:Xg.AGENT_VIEWER,defaultEditorRoleId:Xg.AGENT_EDITOR,defaultOwnerRoleId:Xg.AGENT_OWNER,getResourceUrl:e=>`${window.location.origin}/c/new?agent_id=${e}`,getResourceName:e=>e&&""!==e?`"${e}"`:"agent",getShareMessage:e=>e&&""!==e?`"${e}"`:"agent",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"agent"),getCopyUrlMessage:()=>"Agent URL copied"},[Qg.PROMPTGROUP]:{resourceType:Qg.PROMPTGROUP,defaultViewerRoleId:Xg.PROMPTGROUP_VIEWER,defaultEditorRoleId:Xg.PROMPTGROUP_EDITOR,defaultOwnerRoleId:Xg.PROMPTGROUP_OWNER,getResourceName:e=>e&&""!==e?`"${e}"`:"prompt",getShareMessage:e=>e&&""!==e?`"${e}"`:"prompt",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"prompt"),getCopyUrlMessage:()=>"Prompt URL copied"}},Fb={agent_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},agent_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},agent_manager:{name:"com_ui_role_manager",description:"com_ui_role_manager_desc"},agent_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"},promptGroup_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},promptGroup_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},promptGroup_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"}},zb=e=>Fb[e]||{name:"com_ui_unknown",description:"com_ui_unknown"};function Ub(){const e={lastSelectedModel:localStorage.getItem(uh.LAST_MODEL)??"",lastSelectedTools:localStorage.getItem(uh.LAST_TOOLS)??"",lastConversationSetup:localStorage.getItem(uh.LAST_CONVO_SETUP+"_0")??""};return{lastSelectedModel:e.lastSelectedModel?JSON.parse(e.lastSelectedModel):{},lastSelectedTools:e.lastSelectedTools?JSON.parse(e.lastSelectedTools):[],lastConversationSetup:e.lastConversationSetup?JSON.parse(e.lastConversationSetup):{}}}function Vb(){Object.keys(localStorage).forEach((e=>{(e.startsWith(uh.LAST_MCP_)||e.startsWith(uh.LAST_CODE_TOGGLE_)||e.startsWith(uh.TEXT_DRAFT)||e.startsWith(uh.ASST_ID_PREFIX)||e.startsWith(uh.AGENT_ID_PREFIX)||e.startsWith(uh.LAST_CONVO_SETUP))&&localStorage.removeItem(e)}))}function Bb(e,t){for(let n=0;n<e.pages.length;n++){const s=t(e.pages[n]);if(-1!==s)return{pageIndex:n,index:s}}return{pageIndex:-1,index:-1}}const $b=(e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Bb(e,s);return-1!==r&&-1!==o&&(a.pages[r][t].splice(o,1),a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()})),a};const Hb=(e,t)=>((e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Bb(e,s);return-1!==r&&-1!==o?$b(e,t,n,s):(a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()}),a)})(e,eh.PROMPT_GROUPS,t,(e=>e.promptGroups.findIndex((e=>e._id===t._id)))),Gb=(e,t)=>((e,t,n)=>{const s=JSON.parse(JSON.stringify(e)),{pageIndex:a,index:r}=Bb(s,n);return-1!==a&&-1!==r&&s.pages[a][t].splice(r,1),s})(e,eh.PROMPT_GROUPS,(e=>e.promptGroups.findIndex((e=>e._id===t)))),Kb=(e,t,n)=>((e,t,n,s,a)=>{const r=JSON.parse(JSON.stringify(e)),{pageIndex:o,index:i}=Bb(r,(e=>e[n].findIndex((e=>e[s]===t[s]))));if(-1!==o&&-1!==i){const e={...r.pages[o][n].splice(i,1)[0],...t,updatedAt:(new Date).toISOString()};a&&a(e),r.pages[0][n].unshift(e)}return r})(e,t,eh.PROMPT_GROUPS,"_id",n),Wb=(e,t)=>((e,t,n)=>{const{pageIndex:s,index:a}=Bb(e,(e=>e[t].findIndex(n)));if(-1!==s&&-1!==a)return e.pages[s][t][a]})(e,eh.PROMPT_GROUPS,t),qb=(e,t)=>{!function({queryClient:e,queryKey:t,searchProperty:n,updateData:s,searchValue:a}){e.setQueryData(t,(e=>e?e.map((e=>e[n]===a?{...e,...s}:e)):e))}({queryClient:e,queryKey:[ex.allPromptGroups],searchProperty:"_id",updateData:t,searchValue:t._id})},Qb=(e,t)=>{!function(e,t,n,s){e.setQueryData(t,(e=>e?e.filter((e=>e[n]!==s)):e))}(e,[ex.allPromptGroups],"_id",t)},Yb=po().email(),Xb=(e,t)=>{var n;if(!e||""===e.trim())return!0;const s=Yb.safeParse(e);return s.success||t||(null==(n=s.error.errors[0])?void 0:n.message)||"Please enter a valid email address"},Zb="_TIMESTAMP",Jb=1728e5,e_=[uh.LAST_MCP_,uh.LAST_CODE_TOGGLE_,uh.LAST_WEB_SEARCH_TOGGLE_,uh.LAST_FILE_SEARCH_TOGGLE_,uh.LAST_ARTIFACTS_TOGGLE_,uh.PIN_MCP_];function t_(e){localStorage.setItem(`${e}${Zb}`,Date.now().toString())}function n_(e){const t=`${e}${Zb}`,n=localStorage.getItem(t);if(!n)return localStorage.getItem(e);return Date.now()-parseInt(n,10)>Jb?(localStorage.removeItem(e),localStorage.removeItem(t),null):localStorage.getItem(e)}function s_(...e){return a(H(e))}const a_={log:(...e)=>{},dir:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},error:(...e)=>{},debug:(...e)=>{}};function r_({originalWidth:e,originalHeight:t,containerRef:n}){var s;const a=(null==(s=n.current)?void 0:s.offsetWidth)??0;if(0===a||null==e||null==t)return{width:"auto",height:"auto"};const r=e/t,o=Math.min(a,e);return{width:`${o}px`,height:`${o/r}px`}}const o_=e=>{const t="com_auth_error_login";if(!e)return t;switch(!0){case e.includes("429"):return"com_auth_error_login_rl";case e.includes("403"):return"com_auth_error_login_ban";case e.includes("500"):return"com_auth_error_login_server";case e.includes("422"):return"com_auth_error_login_unverified";default:return t}},i_=({preset:e})=>{const{endpoint:t,endpointType:n}=e??{};if(null==t||""===t)return console.error(`Unknown endpoint ${t}`,e),{endpoint:null,presetId:(null==e?void 0:e.presetId)??null,title:(null==e?void 0:e.title)??"New Preset"};const{presetOverride:s={},...a}=e??{},r={...a,...s};r.chatGptLabel&&r.modelLabel?delete r.chatGptLabel:r.chatGptLabel&&!r.modelLabel?(r.modelLabel=r.chatGptLabel,delete r.chatGptLabel):"chatGptLabel"in r&&delete r.chatGptLabel;const o=Sh({endpoint:t,endpointType:n,conversation:r});return{presetId:(null==e?void 0:e.presetId)??null,...o,endpoint:t,endpointType:n,title:(null==e?void 0:e.title)??"New Preset"}},l_=({models:e,conversation:t,endpoint:n=null,lastConversationSetup:s})=>{var a;const{lastSelectedModel:r,lastSelectedTools:o}=Ub(),i=(null==s?void 0:s.endpointType)??t.endpointType;if(!n)return{...t,endpointType:i,endpoint:n};const l=e,c=(null==s?void 0:s.model)??(null==r?void 0:r[n])??"",d=n===Nu.gptPlugins?(null==(a=null==s?void 0:s.agentOptions)?void 0:a.model)??(null==r?void 0:r.secondaryModel)??null:null;let u,m;u=l.includes(c)?[c,...l]:[...l],m=null!=d&&""!==d&&l.includes(d)?[d,...l]:[...l];const p=Sh({endpoint:n,endpointType:i,conversation:s,possibleValues:{models:u,secondaryModels:m}}),f={...t,...p,endpointType:i,endpoint:n},h=(null==p?void 0:p.assistant_id)??(null==t?void 0:t.assistant_id)??"",g=(null==s?void 0:s.assistant_id)??"";Mu(n)&&!g&&h&&(f.assistant_id=h);const x=(null==p?void 0:p.agent_id)??"",v=(null==s?void 0:s.agent_id)??"";return Lu(n)&&!v&&x&&(f.agent_id=x),f.tools=(null==s?void 0:s.tools)??o??f.tools,f},c_=({convoSetup:e,endpointsConfig:t})=>((e,t)=>{let{endpoint:n=""}=e||{};return n=n??"",n&&(null==t?void 0:t[n])?n:(n&&console.warn(`Illegal target endpoint ${n}`,t),null)})(e,t)||(e=>{try{const{lastConversationSetup:t}=Ub(),{endpoint:n}=t??{endpoint:null},s=Object.values(e??{}).every((e=>!e));return s&&n||s&&n||n&&null!=(null==e?void 0:e[n])?n:null}catch(t){return console.error(t),null}})(t)||(e=>Tb(e).find((t=>Object.hasOwn(e??{},t))))(t),d_=Object.keys(mm.shape);var u_={};const m_="",p_="focus:outline-none focus:ring-0 focus:ring-opacity-0 focus:ring-offset-0",f_="transition-colors rounded-md min-w-[75px] border font-normal bg-white hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700 dark:bg-gray-800 text-black dark:text-gray-600 focus:outline-none data-[state=open]:bg-gray-50 dark:data-[state=open]:bg-gray-700",h_="rounded-md border border-gray-200 focus:border-gray-400 focus:bg-gray-50 bg-transparent text-sm shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none focus-within:placeholder:text-text-primary focus:placeholder:text-text-primary placeholder:text-text-secondary focus:outline-none focus:ring-gray-400 focus:ring-opacity-20 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:focus:bg-gray-600 dark:focus:border-gray-600 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:outline-none",g_="p-0 shadow-none text-right pr-1 h-8 border-transparent hover:bg-gray-800/10 dark:hover:bg-white/10 dark:focus:bg-white/10 transition-colors",x_=e=>{const t=document.createRange();t.selectNodeContents(e.target);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))},v_=e=>"string"==typeof e?e:S.isValidElement(e)?v_(e.props.children):Array.isArray(e)?e.map(v_).join(""):"",b_=e=>{const t=e.reduce(((e,t)=>e+t),0);if(Math.abs(t-100)<.01)return e.map((e=>Number(e.toFixed(2))));const n=100/t,s=e.map((e=>Number((e*n).toFixed(2)))),a=s.reduce(((t,n,s)=>s===e.length-1?t:t+n),0);return s[s.length-1]=Number((100-a).toFixed(2)),s},__=Ce({key:"artifactsState",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{a_.log("artifacts","Recoil Effect: Setting artifactsState",{key:t.key,newValue:e})}))}]}),y_=Ce({key:"currentArtifactId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{a_.log("artifacts","Recoil Effect: Setting currentArtifactId",{key:t.key,newValue:e})}))}]}),j_=Ce({key:"artifactsVisibility",default:!0,effects:[({onSet:e,node:t})=>{e((async e=>{a_.log("artifacts","Recoil Effect: Setting artifactsVisibility",{key:t.key,newValue:e})}))}]}),w_=Ce({key:"visibleArtifacts",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{a_.log("artifacts","Recoil Effect: Setting `visibleArtifacts`",{key:t.key,newValue:e})}))}]}),N_=Object.freeze(Object.defineProperty({__proto__:null,artifactsState:__,artifactsVisibility:j_,currentArtifactId:y_,visibleArtifacts:w_},Symbol.toStringTag,{value:"Module"})),C_=n.createContext({}),k_=({children:e})=>{const t=n.useRef(!1);return s.jsx(C_.Provider,{value:t,children:e})},S_=Ce({key:"latestMessageKeys",default:[]}),T_=Ce({key:"submissionKeys",default:[]}),E_=ke({key:"latestMessageByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(dh.COMMON_DIVIDER)[1]);a_.log("Recoil Effect: Setting latestMessage",{key:n,newValue:e})}))}]}),R_=ke({key:"submissionByIndex",default:null}),I_=Se({key:"latestMessageKeysSelector",get:({get:e})=>e(L_).filter((t=>null!==e(E_(t)))),set:({set:e},t)=>{a_.log("setting latestMessageKeys",{newKeys:t}),e(S_,t)}}),P_=Se({key:"submissionKeysSelector",get:({get:e})=>e(L_).filter((t=>null!==e(R_(t)))),set:({set:e},t)=>{a_.log("setting submissionKeysAtom",t),e(T_,t)}}),A_=ke({key:"conversationByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async(e,n)=>{const s=Number(t.key.split("__")[1]);if(a_.log("conversation","Setting conversation:",{index:s,newValue:e,oldValue:n}),null!=(null==e?void 0:e.assistant_id)&&e.assistant_id&&localStorage.setItem(`${uh.ASST_ID_PREFIX}${s}${e.endpoint}`,e.assistant_id),null!=(null==e?void 0:e.agent_id)&&e.agent_id&&localStorage.setItem(`${uh.AGENT_ID_PREFIX}${s}`,e.agent_id),null!=(null==e?void 0:e.spec)&&e.spec&&localStorage.setItem(uh.LAST_SPEC,e.spec),(null==e?void 0:e.tools)&&Array.isArray(e.tools)&&localStorage.setItem(uh.LAST_TOOLS,JSON.stringify(e.tools.filter((e=>!!e)))),!e)return;!function(e){if(!e)return;const{endpoint:t,model:n,agentOptions:s}=e;if(!t)return;const a=JSON.parse(localStorage.getItem(uh.LAST_MODEL)??"{}");a[t]=n,t===Nu.gptPlugins&&(a.secondaryModel=(null==s?void 0:s.model)??n??""),localStorage.setItem(uh.LAST_MODEL,JSON.stringify(a))}(e),localStorage.setItem(`${uh.LAST_CONVO_SETUP}_${s}`,JSON.stringify(e));const a=!0===e.disableParams;if(0===s&&!a&&""===e.createdAt&&JSON.stringify(e)!==JSON.stringify(n)&&(null==n?void 0:n.conversationId)===dh.NEW_CONVO){const t=function(e){if(null==e)return new URLSearchParams;const t=new URLSearchParams;if(e&&"object"==typeof e&&!("endpoint"in e)&&!("model"in e))return Object.entries(e).forEach((([e,n])=>{null!=n&&d_.includes(e)&&t.set(e,n)})),t;const n=e,s=n.endpoint;if(n.spec)return new URLSearchParams({spec:n.spec});if(Lu(s)&&n.agent_id&&!pv(n.agent_id))return new URLSearchParams({agent_id:String(n.agent_id)});if(Mu(s)&&n.assistant_id)return new URLSearchParams({assistant_id:String(n.assistant_id)});if(Lu(s)&&!n.agent_id)return t;if(Mu(s)&&!n.assistant_id)return t;s&&t.set("endpoint",s),n.model&&t.set("model",n.model);const a={};return d_.forEach((e=>{"agent_id"===e&&pv(n.agent_id)||"endpoint"!==e&&"model"!==e&&(a[e]=n[e])})),Object.entries(a).reduce(((e,[t,n])=>(null!=n&&(Array.isArray(n)?e.set(t,"stop"===t?n.join(","):JSON.stringify(n)):e.set(t,String(n))),e)),t)}(e),n=Is(t),s=`${window.location.pathname}?${n.toString()}`;window.history.pushState({},"",s)}}))}]}),M_=ke({key:"filesByIndex",default:new Map}),L_=Ce({key:"conversationKeys",default:[]}),O_=Se({key:"allConversationsSelector",get:({get:e})=>e(L_).map((t=>e(A_(t)))).map((e=>null==e?void 0:e.conversationId))}),D_=ke({key:"presetByIndex",default:null}),F_=ke({key:"textByIndex",default:""}),z_=ke({key:"showStopButtonByIndex",default:!1}),U_=ke({key:"abortScrollByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(dh.COMMON_DIVIDER)[1]);a_.log("message_scrolling","Recoil Effect: Setting abortScrollByIndex",{key:n,newValue:e})}))}]}),V_=ke({key:"isSubmittingByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(dh.COMMON_DIVIDER)[1]);a_.log("message_stream","Recoil Effect: Setting isSubmittingByIndex",{key:n,newValue:e})}))}]}),B_=ke({key:"optionSettingsByIndex",default:{}}),$_=ke({key:"showAgentSettingsByIndex",default:!1}),H_=ke({key:"showPopoverByIndex",default:!1}),G_=ke({key:"activePromptByIndex",default:void 0}),K_=ke({key:"showMentionPopoverByIndex",default:!1}),W_=ke({key:"showPlusPopoverByIndex",default:!1}),q_=ke({key:"showPromptsPopoverByIndex",default:!1}),Q_=ke({key:"globalAudioURLByIndex",default:null}),Y_=ke({key:"globalAudioisFetchingByIndex",default:!1}),X_=ke({key:"globalAudioisPlayingByIndex",default:!1}),Z_=ke({key:"activeRunByIndex",default:null}),J_=ke({key:"audioRunByIndex",default:null}),ey=ke({key:"messagesSiblingIdx",default:0});const ty=Te({key:"conversationByKeySelector",get:e=>({get:t})=>t(A_(e))});const ny=Te({key:"updateConversationSelector",get:()=>()=>null,set:e=>({set:t,get:n},s)=>{if(s instanceof Ee)return;n(L_).forEach((n=>{t(A_(n),(t=>t&&t.conversationId===e?{...t,...s}:t))}))}}),sy={conversationKeysAtom:L_,conversationByIndex:A_,filesByIndex:M_,presetByIndex:D_,submissionByIndex:R_,textByIndex:F_,showStopButtonByIndex:z_,abortScrollFamily:U_,isSubmittingFamily:V_,optionSettingsFamily:B_,showAgentSettingsFamily:$_,showPopoverFamily:H_,latestMessageFamily:E_,messagesSiblingIdxFamily:ey,allConversationsSelector:O_,conversationByKeySelector:ty,useClearConvoState:function(){return Re((({reset:e,snapshot:t})=>async n=>{const s=await t.getPromise(L_);for(const a of s){if(!0===n&&0==a)continue;e(A_(a));await t.getPromise(A_(a))&&e(E_(a))}e(L_)}),[])},useCreateConversationAtom:function(e){const t=n.useContext(C_),[s,a]=Ie(L_),r=Pe(A_(e)),o=Ae(A_(e));return n.useEffect((()=>{s.includes(e)||a([...s,e])}),[e,s,a]),{hasSetConversation:t,conversation:o,setConversation:r}},showMentionPopoverFamily:K_,globalAudioURLFamily:Q_,activeRunFamily:Z_,audioRunFamily:J_,globalAudioPlayingFamily:X_,globalAudioFetchingFamily:Y_,showPlusPopoverFamily:W_,activePromptByIndex:G_,useClearSubmissionState:function(){return Re((({reset:e,set:t,snapshot:n})=>async s=>{const a=await n.getPromise(P_);a_.log("submissionKeys",a);for(const t of a)!0===s&&0==t||(a_.log("resetting submission",t),e(R_(t)));t(P_,[])}),[])},useClearLatestMessages:function(e){return Re((({reset:t,set:n,snapshot:s})=>async a=>{const r=await s.getPromise(I_);a_.log("[clearAllLatestMessages] latestMessageKeys",r),null!=e&&e&&a_.log(`[clearAllLatestMessages] context: ${e}`);for(const e of r)!0===a&&0==e||(a_.log(`[clearAllLatestMessages] resetting latest message; key: ${e}`),t(E_(e)));n(I_,[])}),[])},showPromptsPopoverFamily:q_,updateConversationSelector:ny},ay={[Nu.azureOpenAI]:null,[Nu.azureAssistants]:null,[Nu.assistants]:null,[Nu.agents]:null,[Nu.openAI]:null,[Nu.chatGPTBrowser]:null,[Nu.gptPlugins]:null,[Nu.google]:null,[Nu.anthropic]:null,[Nu.custom]:null},ry=Ce({key:"endpointsConfig",default:ay}),oy=Ce({key:"endpointsQueryEnabled",default:!0}),iy=Se({key:"plugins",get:({get:e})=>{var t;return(null==(t=(e(ry)||{}).gptPlugins)?void 0:t.plugins)||{}}}),ly=Se({key:"endpointsFilter",get:({get:e})=>{const t=e(ry)||{},n={};for(const s of Object.keys(t))n[s]=!!t[s];return n}}),cy={plugins:iy,endpointsConfig:ry,endpointsFilter:ly,defaultConfig:ay,endpointsQueryEnabled:oy},dy={user:Ce({key:"user",default:void 0}),availableTools:Ce({key:"availableTools",default:{}})},uy={text:Ce({key:"text",default:""})},my={toastState:Ce({key:"toastState",default:{open:!1,message:"",severity:jv.SUCCESS,showIcon:!0}})},py={submission:Ce({key:"submission",default:null}),isSubmitting:Ce({key:"isSubmitting",default:!1})},fy={search:Ce({key:"search",default:{enabled:null,query:"",debouncedQuery:"",isSearching:!1,isTyping:!1}})},hy={defaultPreset:Ce({key:"defaultPreset",default:null}),presetModalVisible:Ce({key:"presetModalVisible",default:!1})};function gy(e,t){return Ce({key:e,default:t,effects_UNSTABLE:[({setSelf:n,onSet:s})=>{const a=localStorage.getItem(e);if(null!==a)try{n(JSON.parse(a))}catch(Fi){console.error(`Error parsing localStorage key "${e}", \`savedValue\`: defaultValue, error:`,Fi),localStorage.setItem(e,JSON.stringify(t)),n(t)}s((t=>{localStorage.setItem(e,JSON.stringify(t))}))}]})}const xy={...{promptsName:Ce({key:"promptsName",default:""}),promptsCategory:Ce({key:"promptsCategory",default:""}),promptsPageNumber:Ce({key:"promptsPageNumber",default:1}),promptsPageSize:Ce({key:"promptsPageSize",default:10})},...{autoSendPrompts:gy("autoSendPrompts",!0),alwaysMakeProd:gy("alwaysMakeProd",!0),promptsEditorMode:gy("promptsEditorMode",fv.SIMPLE)}},vy={lang:gy("lang",(()=>{const e=navigator.language||navigator.languages[0];return Me.get("lang")||localStorage.getItem("lang")||e})())},by={...{abortScroll:Ce({key:"abortScroll",default:!1}),showFiles:Ce({key:"showFiles",default:!1}),optionSettings:Ce({key:"optionSettings",default:{}}),showPluginStoreDialog:Ce({key:"showPluginStoreDialog",default:!1}),showAgentSettings:Ce({key:"showAgentSettings",default:!1}),currentSettingsView:Ce({key:"currentSettingsView",default:bp.default}),showPopover:Ce({key:"showPopover",default:!1})},...{autoScroll:gy("autoScroll",!1),hideSidePanel:gy("hideSidePanel",!1),fontSize:gy("fontSize","text-base"),enableUserMsgMarkdown:gy(uh.ENABLE_USER_MSG_MARKDOWN,!0),enterToSend:gy("enterToSend",!0),maximizeChatSpace:gy("maximizeChatSpace",!1),chatDirection:gy("chatDirection","LTR"),showCode:gy(uh.SHOW_ANALYSIS_CODE,!0),saveDrafts:gy("saveDrafts",!0),showScrollButton:gy("showScrollButton",!0),forkSetting:gy("forkSetting",""),splitAtTarget:gy("splitAtTarget",!1),rememberDefaultFork:gy(uh.REMEMBER_FORK_OPTION,!1),showThinking:gy("showThinking",!1),saveBadgesState:gy("saveBadgesState",!1),modularChat:gy("modularChat",!0),LaTeXParsing:gy("LaTeXParsing",!0),centerFormOnLanding:gy("centerFormOnLanding",!0),showFooter:gy("showFooter",!0),atCommand:gy("atCommand",!0),plusCommand:gy("plusCommand",!0),slashCommand:gy("slashCommand",!0),conversationMode:gy("conversationMode",!1),advancedMode:gy("advancedMode",!1),speechToText:gy("speechToText",!0),engineSTT:gy("engineSTT","browser"),languageSTT:gy("languageSTT",""),autoTranscribeAudio:gy("autoTranscribeAudio",!1),decibelValue:gy("decibelValue",-45),autoSendText:gy("autoSendText",-1),textToSpeech:gy("textToSpeech",!0),engineTTS:gy("engineTTS","browser"),voice:gy("voice",void 0),cloudBrowserVoices:gy("cloudBrowserVoices",!1),languageTTS:gy("languageTTS",""),automaticPlayback:gy("automaticPlayback",!1),playbackRate:gy("playbackRate",null),cacheTTS:gy("cacheTTS",!0),UsernameDisplay:gy("UsernameDisplay",!0)}},_y={hideBannerHint:gy("hideBannerHint",[]),messageAttachmentsMap:Ce({key:"messageAttachmentsMap",default:{}}),queriesEnabled:Ce({key:"queriesEnabled",default:!0}),isEditingBadges:Ce({key:"isEditingBadges",default:!1}),chatBadges:gy("chatBadges",[{id:"1"}])},yy={isTemporary:gy("isTemporary",!1)},jy=ke({key:"ephemeralAgentByConvoId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{var n;const s=null==(n=t.key.split("__")[1])?void 0:n.replaceAll('"',"");a_.log("agents","Setting ephemeral agent:",{conversationId:s,newValue:e})}))}]});const wy=Le((e=>{const t=e??dh.NEW_CONVO,n=`${uh.LAST_MCP_}${t}`;return T(n,[],void 0,{getOnInit:!0})})),Ny=T(uh.PIN_MCP_,!0,void 0,{getOnInit:!0}),Cy={...N_,...sy,...cy,...dy,...uy,...my,...py,...fy,...xy,...hy,...vy,...by,..._y,...yy};function ky(e=0){const t=Pe(Cy.audioRunFamily(e)),s=Pe(Cy.activeRunFamily(e)),a=Pe(Cy.globalAudioPlayingFamily(e)),r=Pe(Cy.globalAudioFetchingFamily(e)),[o,i]=Ie(Cy.globalAudioURLFamily(e));return{pauseGlobalAudio:n.useCallback((()=>{if(null!=o&&""!==o){const e=document.getElementById(xv);e&&(console.log("Pausing global audio",o),e.pause(),a(!1)),URL.revokeObjectURL(o),r(!1),i(null),s(null),t(null)}}),[t,s,o,i,a,r])}}const Sy=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.user],(()=>fx.getUser()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Ty=(e={},t)=>{const{scopes:n,enabled:s=!1}=e;return mr({queryKey:[ex.graphToken,n],queryFn:()=>fx.getGraphApiToken({scopes:n}),enabled:s,staleTime:3e6,retry:1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})};function Ey(){const e=Cy.useClearConvoState(),t=Cy.useClearSubmissionState(),n=Cy.useClearLatestMessages();return Re((({reset:s,snapshot:a})=>async r=>{await t(r),await e(r),await n(r);const o=await a.getPromise(Cy.conversationKeysAtom);for(const e of o)!0===r&&0===e||(s(Cy.filesByIndex(e)),s(Cy.presetByIndex(e)),s(Cy.textByIndex(e)),s(Cy.showStopButtonByIndex(e)),s(Cy.abortScrollFamily(e)),s(Cy.isSubmittingFamily(e)),s(Cy.optionSettingsFamily(e)),s(Cy.showAgentSettingsFamily(e)),s(Cy.showPopoverFamily(e)),s(Cy.showMentionPopoverFamily(e)),s(Cy.showPlusPopoverFamily(e)),s(Cy.showPromptsPopoverFamily(e)),s(Cy.activePromptByIndex(e)),s(Cy.globalAudioURLFamily(e)),s(Cy.globalAudioFetchingFamily(e)),s(Cy.globalAudioPlayingFamily(e)),s(Cy.activeRunFamily(e)),s(Cy.audioRunFamily(e)),s(Cy.messagesSiblingIdxFamily(e.toString())));!function(e){Object.keys(localStorage).forEach((t=>{!0===e&&t.endsWith("0")||(t.startsWith(uh.LAST_MCP_)||t.startsWith(uh.LAST_CODE_TOGGLE_)||t.startsWith(uh.ASST_ID_PREFIX)||t.startsWith(uh.AGENT_ID_PREFIX)||t.startsWith(uh.LAST_CONVO_SETUP)||t===uh.LAST_SPEC||t===uh.LAST_TOOLS||t===uh.LAST_MODEL||t===uh.FILES_TO_DELETE)&&localStorage.removeItem(t)}))}(r)}),[])}const Ry={limit:10,requiredPermission:Yg.EDIT},Iy=()=>{const e=pr().getQueryData([ex.endpoints]),t=!!(null==e?void 0:e[Nu.agents]);return mr([ex.tools],(()=>fx.getAvailableAgentTools()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:t})},Py=(e=Ry,t)=>{const n=pr().getQueryData([ex.endpoints]),s=!!(null==n?void 0:n[Nu.agents]);return mr([ex.agents,e],(()=>fx.listAgents(e)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&s:s})},Ay=(e,t)=>{const n=!!e&&!pv(e);return mr([ex.agent,e],(()=>fx.getAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,enabled:n&&!0,...t})},My=(e,t)=>mr([ex.agent,e,"expanded"],(()=>fx.getExpandedAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),Ly=e=>mr([ex.agentCategories],(()=>fx.getAgentCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5,...e}),Oy=[{requiredPermission:Yg.VIEW},{requiredPermission:Yg.EDIT}],Dy=e=>{const t=pr();return fr((e=>fx.createAgent(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return Oy.forEach((r=>{var o;const i=t.getQueryData([ex.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];t.setQueryData([ex.agents,r],{...i,data:l})})),Gy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Fy=e=>{const t=pr();return fr((({agent_id:e,data:t})=>fx.updateAgent({data:t,agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return Oy.forEach((r=>{var o;const i=t.getQueryData([ex.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a);t.setQueryData([ex.agents,r],{...i,data:i.data.map((e=>e.id===s.agent_id?n:e))})})),t.setQueryData([ex.agent,s.agent_id],n),t.setQueryData([ex.agent,s.agent_id,"expanded"],n),Gy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},zy=e=>{const t=pr();return fr((({agent_id:e})=>fx.deleteAgent({agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;const o=(r=>{let o=[];return Oy.forEach((r=>{var i;const l=t.getQueryData([ex.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,s,a);o=l.data.filter((e=>e.id!==s.agent_id)),t.setQueryData([ex.agents,r],{...l,data:o})})),o})();return t.removeQueries([ex.agent,s.agent_id]),t.removeQueries([ex.agent,s.agent_id,"expanded"]),Gy(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,o)}})},Uy=e=>{const t=pr();return fr((e=>fx.duplicateAgent(e)),{onMutate:null==e?void 0:e.onMutate,onError:null==e?void 0:e.onError,onSuccess:({agent:n,actions:s},a,r)=>{var o;Oy.forEach((e=>{const s=t.getQueryData([ex.agents,e]);if(s){const a=[n,...s.data];t.setQueryData([ex.agents,e],{...s,data:a})}}));const i=t.getQueryData([ex.actions])||[];return t.setQueryData([ex.actions],i.concat(s)),Gy(t),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,{agent:n,actions:s},a,r)}})},Vy=e=>fr([ax.agentAvatarUpload],{mutationFn:e=>fx.uploadAgentAvatar(e),...e||{}}),By=e=>{const t=pr();return fr([ax.updateAgentAction],{mutationFn:e=>fx.updateAgentAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;const o=n[0];return Oy.forEach((r=>{var i;const l=t.getQueryData([ex.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,s,a);t.setQueryData([ex.agents,r],{...l,data:l.data.map((e=>e.id===s.agent_id?o:e))})})),t.setQueryData([ex.actions],(e=>e?s.action_id?e.map((e=>e.action_id===s.action_id?n[1]:e)):[...e,n[1]]:[n[1]])),t.setQueryData([ex.agent,s.agent_id],o),t.setQueryData([ex.agent,s.agent_id,"expanded"],o),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},$y=e=>{const t=pr();return fr([ax.deleteAgentAction],{mutationFn:e=>fx.deleteAgentAction({...e}),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";t.setQueryData([ex.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==s.action_id))))),Oy.forEach((e=>{t.setQueryData([ex.agents,e],(e=>e?{...e,data:e.data.map((e=>{var t;return e.id===s.agent_id?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e}))}:e))}));const i=e=>{var t;return e?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e};return t.setQueryData([ex.agent,s.agent_id],i),t.setQueryData([ex.agent,s.agent_id,"expanded"],i),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Hy=e=>{const t=pr();return fr((({agent_id:e,version_index:t})=>fx.revertAgentVersion({agent_id:e,version_index:t})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;return t.setQueryData([ex.agent,s.agent_id],n),Oy.forEach((e=>{const a=t.getQueryData([ex.agents,e]);a&&t.setQueryData([ex.agents,e],{...a,data:a.data.map((e=>e.id===s.agent_id?n:e))})})),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Gy=e=>{e.invalidateQueries([ex.marketplaceAgents])},Ky=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.endpoints],(()=>fx.getAIEndpoints()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Wy=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.startupConfig],(()=>fx.getStartupConfig()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},qy=e=>{const t=pr(),{showToast:n}=$d(),s=Uk(),{onSuccess:a,onError:r,...o}=e||{};return fr([ax.fileDelete],{mutationFn:e=>fx.deleteFiles(e),...o,onError:(e,t,a)=>{var o;if(e&&"object"==typeof e&&"response"in e){403===(null==(o=e.response)?void 0:o.status)&&n({message:s("com_ui_delete_not_allowed"),status:"error"})}null==r||r(e,t,a)},onSuccess:(e,r,o)=>{t.setQueryData([ex.files],(e=>{const{files:t}=r,n=t.reduce(((e,t)=>(e.set(t.file_id,t),e)),new Map);return(e??[]).filter((e=>!n.has(e.file_id)))})),n({message:s("com_ui_delete_success"),status:"success"}),null==a||a(e,r,o),null!=r.agent_id&&r.agent_id&&t.refetchQueries([ex.agent,r.agent_id])}})},Qy=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.files],(()=>fx.getFiles()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Yy=(e,t)=>{const n=Ae(Cy.queriesEnabled);return mr(rx(e??""),(()=>e?fx.getAgentFiles(e):Promise.resolve([])),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:n&&!pv(e)})},Xy=e=>mr([ex.fileConfig],(()=>fx.getFileConfig()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Zy=(e,t)=>{const n=pr();return mr([ex.fileDownload,t],(async()=>{if(!e||!t)return void console.warn("No user ID provided for file download");const s=await fx.getFileDownload(e,t),a=s.data,r=window.URL.createObjectURL(a);try{const e=JSON.parse(s.headers["x-file-metadata"]);if(!e)return console.warn("No metadata found for file download",s.headers),r;Dv(n,e)}catch(Fi){console.error("Error parsing file metadata, skipped updating file query cache",Fi)}return r}),{enabled:!1,retry:!1})},Jy=()=>fr({mutationFn:async({files:e,accessToken:t,onProgress:n})=>{const s=[],a=[];let r=0;const o=[];for(let i=0;i<e.length;i+=3)o.push(e.slice(i,i+3));for(const i of o){const o=i.map((async s=>{try{const o=s.downloadUrl||`https://graph.microsoft.com/v1.0/drives/${s.driveId}/items/${s.itemId}/content`,i=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);const l=await i.blob(),c=i.headers.get("content-type")||ej(s.name),d=new File([l],s.name,{type:c,lastModified:Date.now()});return r++,null==n||n({completed:r,total:e.length,currentFile:s.name,failed:a}),d}catch(o){throw console.error(`Failed to download ${s.name}:`,o),a.push(s.name),r++,null==n||n({completed:r,total:e.length,currentFile:`Error: ${s.name}`,failed:a}),o}}));(await Promise.allSettled(o)).forEach((e=>{"fulfilled"===e.status&&s.push(e.value)}))}return a.length>0&&console.warn(`Failed to download ${a.length} files:`,a),s},retry:1});function ej(e){var t;return{pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",zip:"application/zip",rar:"application/x-rar-compressed",mp4:"video/mp4",mp3:"audio/mpeg",wav:"audio/wav"}[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"application/octet-stream"}const tj=e=>mr([ex.memories],(()=>fx.getMemories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),nj=e=>{const t=pr();return fr([ax.updateMemoryPreferences],(e=>fx.updateMemoryPreferences(e)),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([ex.user]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})},sj=e=>{const t=pr();return fr((({key:e,value:t})=>fx.createMemory({key:e,value:t})),{...e,onSuccess:(n,s,a)=>{var r;t.setQueryData([ex.memories],(e=>{if(!e)return e;const t=[...e.memories,n.memory],s=t.reduce(((e,t)=>e+(t.tokenCount||0)),0),a=e.tokenLimit;let r=e.usagePercentage;return a&&a>0&&(r=Math.min(100,Math.round(s/a*100))),{...e,memories:t,totalTokens:s,usagePercentage:r}})),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},aj=(e,t)=>{const n=De(),s=pr();return mr([ex.messages,e],(async()=>{const t=await fx.getMessagesByConvoId(e);if(!n.pathname.includes("/c/new")&&1===(null==t?void 0:t.length)){const a=s.getQueryData([ex.messages,e]);if(1===(null==a?void 0:a.length))return t;if(a&&(null==a?void 0:a.length)>1)return a_.warn("messages",`Messages query for convo ${e} returned fewer than cache; path: "${n.pathname}"`,t,a),a}return t}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})},rj=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.balance],(()=>fx.getUserBalance()),{refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},oj=e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.searchEnabled],(()=>fx.getSearchEnabled()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},ij=(e,t)=>mr([ex.toolAuth,e.toolId],(()=>fx.getVerifyAgentToolAuth(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t}),lj=(e,t)=>{const{conversationId:n=""}=e;return mr([ex.toolCalls,n],(()=>fx.getToolCalls(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:n.length>0&&n!==dh.NEW_CONVO&&n!==dh.PENDING_CONVO&&n!==dh.SEARCH,...t})},cj=e=>mr([ex.mcpConnectionStatus],(()=>fx.getMCPConnectionStatus()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1e4,...e}),dj=(e,t)=>mr([ex.mcpAuthValues,e],(()=>fx.getMCPAuthValues(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:!!e,...t}),uj=()=>{const e=pr();return{updateTagsInConversation:(t,n)=>{const s=e.getQueryData([ex.conversation,t]);if(!s)return;const a={...s,tags:n};e.setQueryData([ex.conversation,t],a),e.setQueryData([ex.allConversations],(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===(s.conversationId??"")?{...e,tags:a.tags}:e))})))}:e))},replaceTagsInAllConversations:(t,n)=>{const s=e.getQueryData([ex.allConversations]);if(s){const a=JSON.parse(JSON.stringify(s));for(let e=0;e<a.pages.length;e++){const s=a.pages[e];s.conversations=s.conversations.map((e=>{var s;return e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&(null==(s=e.tags)?void 0:s.includes(t))&&(e.tags=e.tags.map((e=>e===t?n:e))),e}))}e.setQueryData([ex.allConversations],a)}const a=[];for(let r=0;r<a.length;r++){const s=a[r],o=e.getQueryData([ex.conversation,s]);if(o&&o.tags){const a={...o,tags:o.tags.map((e=>e===t?n:e))};e.setQueryData([ex.conversation,s],a)}}}}},mj=e=>mr([ex.presets],(()=>fx.getPresets()),{staleTime:1e4,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),pj=(e,t)=>{const{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}=e;return hr({queryKey:[n?ex.archivedConversations:ex.allConversations,{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}],queryFn:({pageParam:e})=>fx.listConversations({isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},fj=(e,t)=>{const{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}=e;return hr({queryKey:[ex.sharedLinks,{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}],queryFn:({pageParam:e})=>fx.listSharedLinks({cursor:null==e?void 0:e.toString(),pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},hj=e=>mr([ex.conversationTags],(()=>fx.getConversationTags()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),gj=(e,t)=>{var n,s;const a=pr(),r=a.getQueryData([ex.endpoints]),o=a.getQueryData([ex.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!Lu(e)||!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??of[e];return mr([ex.tools],(()=>fx.getAvailableTools(e,c)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:l,...t})},xj=(e,t=uu,n)=>{var s,a;const r=pr(),o=r.getQueryData([ex.endpoints]),i=r.getQueryData([ex.name,e]),l=!!!(null==(s=null==o?void 0:o[e])?void 0:s.userProvide)||!!(null==i?void 0:i.expiresAt),c=!!(null==o?void 0:o[e])&&l,d=(null==(a=null==o?void 0:o[e])?void 0:a.version)??of[e];return mr([ex.assistants,e,t],(()=>fx.listAssistants({...t,endpoint:e},d)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...n,enabled:void 0!==(null==n?void 0:n.enabled)?n.enabled&&c:c})},vj=(e,t)=>{var n;const s=pr(),a=s.getQueryData([ex.endpoints]),r=s.getQueryData([ex.name,e]),o=!!!(null==(n=null==a?void 0:a[e])?void 0:n.userProvide)||!!(null==r?void 0:r.expiresAt),i=!!(null==a?void 0:a[e])&&o||e===Nu.agents;return mr([ex.actions],(()=>fx.getActions()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&i:i})},bj=(e,t)=>{var n,s;const a=pr(),r=a.getQueryData([ex.endpoints]),o=a.getQueryData([ex.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??of[e];return mr([ex.assistantDocs,e],(()=>fx.getAssistantDocs({endpoint:e,version:c})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&l:l})},_j=()=>{const e=pr();return fr((e=>fx.genTitle(e)),{onSuccess:(t,n)=>{e.setQueryData([ex.conversation,n.conversationId],(e=>e?{...e,title:t.title}:e)),cb(e,n.conversationId,(e=>({...e,title:t.title}))),document.title=t.title}})},yj=e=>{const t=pr(),n=[ex.allConversations],s=[ex.archivedConversations],{onMutate:a,onError:r,onSuccess:o,...i}=e||{};return fr((e=>fx.archiveConversation(e)),{onMutate:a,onSuccess:(e,n,s)=>{const a=!0===n.isArchived;db(t,n.conversationId);const r=t.getQueryCache().findAll([ex.archivedConversations],{exact:!1});for(const o of r)t.setQueryData(o.queryKey,(t=>t?a?{...t,pages:[{...t.pages[0],conversations:[e,...t.pages[0].conversations]},...t.pages.slice(1)]}:{...t,pages:t.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==n.conversationId))})))}:t));t.setQueryData([ex.conversation,n.conversationId],a?null:e),null==o||o(e,n,s)},onError:r,onSettled:()=>{t.invalidateQueries({queryKey:n,refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:s,refetchPage:(e,t)=>0===t})},...i})},jj=e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((({conversationId:e})=>{if(!e)throw new Error("Conversation ID is required");return fx.createSharedLink(e)}),{onSuccess:(e,s,a)=>{t.setQueryData([ex.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})},wj=e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((({shareId:e})=>{if(!e)throw new Error("Share ID is required");return fx.updateSharedLink(e)}),{onSuccess:(e,s,a)=>{t.setQueryData([ex.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})},Nj=e=>{const t=pr(),{onSuccess:n}=e||{};return fr((e=>fx.deleteSharedLink(e.shareId)),{onMutate:async e=>{await t.cancelQueries({queryKey:[ex.sharedLinks],exact:!1});const n=new Map;return t.getQueryCache().findAll([ex.sharedLinks]).forEach((s=>{const a=t.getQueryData(s.queryKey);n.set(s.queryKey,a),t.setQueryData(s.queryKey,(t=>{if(!(null==t?void 0:t.pages))return t;const n=t.pages.map((t=>({...t,links:t.links.filter((t=>t.shareId!==e.shareId))}))).filter((e=>e.links.length>0));return{...t,pages:n}}))})),{previousQueries:n}},onError:(e,n,s)=>{(null==s?void 0:s.previousQueries)&&s.previousQueries.forEach(((e,n)=>{t.setQueryData(n,e)}))},onSettled:()=>{t.invalidateQueries({queryKey:[ex.sharedLinks],exact:!1})},onSuccess:(e,s)=>{n&&n(e,s),t.refetchQueries({queryKey:[ex.sharedLinks],exact:!0})}})},Cj=({context:e,tag:t,options:n})=>{const s=pr(),{onSuccess:a,...r}=n||{},{updateTagsInConversation:o,replaceTagsInAllConversations:i}=uj();return fr((e=>null!=t?fx.updateConversationTag(t,e):fx.createConversationTag(e)),{onSuccess:(...n)=>{((n,a)=>{if(s.setQueryData([ex.conversationTags],(s=>{if(!s)return[{count:1,position:0,tag:dh.SAVED_TAG,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}];if(void 0===t||!t.length){const t=s.findIndex((e=>e.tag===n.tag));if(-1!==t){a_.log("tag_mutation",`"Created" tag exists, updating from ${e}`,s,n);const a=[...s];return a[t]={...a[t],...n},a.sort(((e,t)=>e.position-t.position))}return a_.log("tag_mutation",`"Created" tag is new, adding from ${e}`,s,n),[...s,n].sort(((e,t)=>e.position-t.position))}return a_.log("tag_mutation",`Updating tag from ${e}`,s,n),((e,t,n,s)=>{if(0===e.length)return[n];const a=e.find((e=>e.tag===s));if(!a)return[e[0],n,...e.slice(1)].map(((e,t)=>({...e,position:t})));const r=a.position,o=n.position,i=e.filter((e=>e.tag!==s));if(void 0===o||r===o)return e.map((e=>e.tag===s?n:e));const l=[...i.slice(0,o),n,...i.slice(o)];if(o>r)for(let c=r;c<o;c++)l[c].position=c;else for(let c=o+1;c<l.length;c++)l[c].position=c;return l})(s,0,n,t)})),!0===a.addToConversation&&null!=a.conversationId&&n.tag){const t=s.getQueryData([ex.conversation,a.conversationId]);if(!t)return;a_.log("tag_mutation",`\`updateTagsInConversation\` Update from ${e}`,t),o(a.conversationId,[...t.tags||[],n.tag])}null!=t&&i(t,n.tag)})(...n),null==a||a(...n)},...r})},kj=e=>{const t=pr(),n=(()=>{const e=pr();return t=>{const n=e.getQueryData([ex.allConversations]);if(!n||!Array.isArray(n.pages)||0===n.pages.length)return;const s=[],a={pageParams:Array.isArray(n.pageParams)?[...n.pageParams]:[],pages:n.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&e.tags.includes(t)?(s.push(e.conversationId),{...e,tags:e.tags.filter((e=>e!==t))}):e))})))};e.setQueryData([ex.allConversations],a);for(let r=0;r<s.length;r++){const n=s[r],a=e.getQueryData([ex.conversation,n]);a&&Array.isArray(a.tags)&&e.setQueryData([ex.conversation,n],{...a,tags:a.tags.filter((e=>e!==t))})}}})(),{onSuccess:s,...a}=e||{};return fr((e=>fx.deleteConversationTag(e)),{onSuccess:(e,a,r)=>{t.setQueryData([ex.conversationTags],(e=>e?e.filter((e=>e.tag!==a)):e)),n(a),null==s||s(e,a,r)},...a})},Sj=e=>{const t=pr();return fr((e=>fx.deleteConversation(e)),{onMutate:async()=>{await t.cancelQueries([ex.allConversations]),await t.cancelQueries([ex.archivedConversations])},onError:()=>{},onSuccess:(n,s,a)=>{var r;s.conversationId&&db(t,s.conversationId);const o=t.getQueryCache().findAll([ex.archivedConversations],{exact:!1});for(const e of o)t.setQueryData(e.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==s.conversationId))}))).filter((e=>e.conversations.length>0))}:e));t.removeQueries({queryKey:[ex.conversation,s.conversationId],exact:!0}),t.invalidateQueries({queryKey:[ex.allConversations],refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:[ex.archivedConversations],refetchPage:(e,t)=>0===t}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},Tj=e=>{const t=pr(),{onSuccess:n,onError:s,onMutate:a}=e||{};return fr({mutationFn:e=>fx.importConversationsFile(e),onSuccess:(e,s,a)=>{t.invalidateQueries([ex.allConversations]),n&&n(e,s,a)},onError:(e,t,n)=>{s&&s(e,t,n)},onMutate:a})},Ej=e=>fr([ax.avatarUpload],{mutationFn:e=>fx.uploadAvatar(e),...e||{}}),Rj=e=>{const t=pr();return fr((e=>fx.createAssistant(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([ex.assistants,s.endpoint,uu]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];return t.setQueryData([ex.assistants,s.endpoint,uu],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Ij=e=>{const t=pr();return fr((({assistant_id:e,data:n})=>{const{endpoint:s}=n,a=t.getQueryData([ex.endpoints]),r=null==a?void 0:a[s],o=(null==r?void 0:r.version)??of[s];return fx.updateAssistant({data:n,version:o,assistant_id:e})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([ex.assistants,s.data.endpoint,uu]);return i?(t.setQueryData([ex.assistantDocs,s.data.endpoint],(e=>e?e.map((e=>e.assistant_id===s.assistant_id?{...e,conversation_starters:n.conversation_starters,append_current_datetime:s.data.append_current_datetime}:e)):e)),t.setQueryData([ex.assistants,s.data.endpoint,uu],{...i,data:i.data.map((e=>e.id===s.assistant_id?n:e))}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)):null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Pj=e=>{const t=pr();return fr((({assistant_id:e,model:n,endpoint:s})=>{var a;const r=t.getQueryData([ex.endpoints]),o=(null==(a=null==r?void 0:r[s])?void 0:a.version)??of[s];return fx.deleteAssistant({assistant_id:e,model:n,version:o,endpoint:s})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([ex.assistants,s.endpoint,uu]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=i.data.filter((e=>e.id!==s.assistant_id));return t.setQueryData([ex.assistants,s.endpoint,uu],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,l)}})},Aj=e=>fr([ax.assistantAvatarUpload],{mutationFn:({postCreation:e,...t})=>fx.uploadAssistantAvatar(t),...e||{}}),Mj=e=>{const t=pr();return fr([ax.updateAction],{mutationFn:e=>fx.updateAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([ex.assistants,s.endpoint,uu]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=n[1];return t.setQueryData([ex.assistants,s.endpoint,uu],{...i,data:i.data.map((e=>e.id===s.assistant_id?l:e))}),t.setQueryData([ex.actions],(e=>null==e?void 0:e.map((e=>e.action_id===s.action_id?n[2]:e)).concat(null!=s.action_id&&s.action_id?[]:[n[2]]))),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Lj=e=>{const t=pr();return fr([ax.deleteAction],{mutationFn:e=>{var n;const{endpoint:s}=e,a=t.getQueryData([ex.endpoints]),r=(null==(n=null==a?void 0:a[s])?void 0:n.version)??of[s];return fx.deleteAction({...e,version:r})},onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";return t.setQueryData([ex.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==s.action_id))))),t.setQueryData([ex.assistants,s.endpoint,uu],(e=>e?{...e,data:e.data.map((e=>e.id===s.assistant_id?{...e,tools:(e.tools??[]).filter((e=>{var t;return!(null==(t=e.function)?void 0:t.name.includes(o??""))}))}:e))}:e)),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Oj=e=>fr({mutationFn:e=>fx.resendVerificationEmail(e),...e||{}}),Dj=e=>{const{onMutate:t,onError:n,onSuccess:s}=e||{},a=pr(),r=Ae(Cy.promptsName),o=Ae(Cy.promptsPageSize),i=Ae(Cy.promptsCategory);return fr({mutationFn:e=>fx.updatePromptGroup(e),onMutate:e=>{const n=a.getQueryData([ex.promptGroup,e.id]),s=n?structuredClone(n):void 0,l=a.getQueryData([ex.promptGroups,r,i,o]),c=l?structuredClone(l):void 0;let d=e.payload;if(d.removeProjectIds&&(null==s?void 0:s.projectIds)&&(d=structuredClone(d),d.projectIds=s.projectIds.filter((e=>{var t;return!(null==(t=d.removeProjectIds)?void 0:t.includes(e))})),delete d.removeProjectIds),l){const t=Kb(l,{_id:e.id,...d},(t=>a.setQueryData([ex.promptGroup,e.id],t)));a.setQueryData([ex.promptGroups,r,i,o],t)}return t&&t(e),{group:s,previousListData:c}},onError:(e,t,s)=>{(null==s?void 0:s.group)&&a.setQueryData([ex.promptGroups,t.id],s.group),(null==s?void 0:s.previousListData)&&a.setQueryData([ex.promptGroups,r,i,o],s.previousListData),n&&n(e,t,s)},onSuccess:(e,t,n)=>{qb(a,{_id:t.id,...e}),s&&s(e,t,n)}})},Fj=e=>{const t=pr(),{onSuccess:n,...s}=e||{},a=Ae(Cy.promptsName),r=Ae(Cy.promptsPageSize),o=Ae(Cy.promptsCategory);return fr({mutationFn:e=>fx.createPrompt(e),...s,onSuccess:(e,s,i)=>{const{prompt:l,group:c}=e;t.setQueryData([ex.prompts,s.prompt.groupId],(e=>[l,...e??[]])),c&&(t.setQueryData([ex.promptGroups,a,o,r],(e=>e?Hb(e,c):e)),((e,t)=>{!function(e,t,n){e.setQueryData(t,(e=>e?[...e,n]:[n]))}(e,[ex.allPromptGroups],t)})(t,c)),n&&n(e,s,i)}})},zj=e=>{const t=pr(),{onSuccess:n,onError:s,onMutate:a}={},r=Ae(Cy.promptsName),o=Ae(Cy.promptsPageSize),i=Ae(Cy.promptsCategory);return fr({mutationFn:e=>fx.makePromptProduction(e.id),onMutate:e=>{const n=JSON.parse(JSON.stringify(t.getQueryData([ex.promptGroup,e.groupId]))),s=t.getQueryData([ex.promptGroups,r,i,o]),l=JSON.parse(JSON.stringify(s));if(s){const n=Kb(s,{_id:e.groupId,productionId:e.id,productionPrompt:e.productionPrompt},(n=>t.setQueryData([ex.promptGroup,e.groupId],n)));t.setQueryData([ex.promptGroups,r,i,o],n)}return a&&a(e),{group:n,previousListData:l}},onError:(e,n,a)=>{(null==a?void 0:a.group)&&t.setQueryData([ex.promptGroups,n.groupId],a.group),(null==a?void 0:a.previousListData)&&t.setQueryData([ex.promptGroups,r,i,o],a.previousListData),s&&s(e,n,a)},onSuccess:(e,s,a)=>{qb(t,{_id:s.groupId,productionId:s.id,productionPrompt:s.productionPrompt}),n&&n(e,s,a)}})},Uj=e=>mr([ex.mcpTools],(()=>fx.getMCPTools()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5,...e}),Vj=(e,t)=>mr([ex.roles,e],(()=>fx.getRole(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t});function Bj({setIsSpeaking:e,audioRef:t,messageId:s,isLast:a,index:r=0}){const o=Uk(),{showToast:i}=$d(),l=Ae(Cy.voice),c=Ae(Cy.cacheTTS),d=Ae(Cy.playbackRate),[u,m]=n.useState(!1),p=n.useRef(null),f=Ae(Cy.globalAudioFetchingFamily(r)),h=Ae(Cy.globalAudioPlayingFamily(r)),g=e=>{const t=document.createElement("a");t.href=e,t.download="audio.mp3",t.click(),m(!1)},{mutate:x,isLoading:v}=(b={onMutate:e=>{(e.get("input")??"").length>=4096&&i({message:o("com_nav_long_audio_warning"),status:"warning"})},onSuccess:async(e,n)=>{try{const s=n.get("input")??"",a=new Blob([e],{type:"audio/mpeg"});if(c&&s){const e=await caches.open("tts-responses"),t=new Request(s),n=new Response(a);e.put(t,n)}const r=URL.createObjectURL(a);u&&g(r),(e=>{const n=new Audio(e);t.current=n})(r)}catch(s){i({message:`Error processing audio: ${s.message}`,status:"error"})}},onError:e=>{i({message:o("com_nav_audio_process_error",{0:e.message}),status:"error"})}},fr([ax.textToSpeech],{mutationFn:e=>fx.textToSpeech(e),...b||{}}));var b;const _=(e,t)=>{const n=((e,t)=>{const n=new FormData;return n.append("input",e),n.append("voice",t),n})(e,l??"");m(t),x(n)},y=async(t,n)=>{const s=await caches.match(t);if(!s)return _(t,n);const a=await s.blob(),r=URL.createObjectURL(a);n?g(r):(t=>{const n=new Audio(t),s=()=>{null!=d&&1!==d&&d>0&&(n.playbackRate=d)};s();const a=()=>n.play().then((()=>e(!0)));a().catch((e=>{if(e.message&&e.message.includes("The play() request was interrupted by a call to pause()"))return console.log("Play request was interrupted by a call to pause()"),s(),a().catch(console.error);console.error(e),i({message:o("com_nav_audio_play_error",{0:e.message}),status:"error"})})),n.onended=()=>{console.log("Cached message audio ended"),URL.revokeObjectURL(t),e(!1)},p.current=n})(r)},j=n.useCallback((()=>{p.current&&(p.current.pause(),p.current.src&&URL.revokeObjectURL(p.current.src),p.current=null,e(!1))}),[e]);n.useEffect((()=>j),[j]);const w=n.useMemo((()=>a&&f&&!h),[f,h,a]),{data:N=[]}=mr([ex.voices],(()=>fx.getVoices()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...C});var C;return{generateSpeechExternal:(e,t)=>{c?y(e,t):_(e,t)},cancelSpeech:()=>{const n=e=>{e&&(e.pause(),e.src&&URL.revokeObjectURL(e.src),t.current=null)};n(document.getElementById(`audio-${s}`)),n(p.current),e(!1)},isLoading:w||v,audioRef:t,voices:N}}function $j({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect((()=>{const n=()=>{e(!1),console.log("message audio ended"),t.current&&URL.revokeObjectURL(t.current.src)},s=()=>{e(!0),console.log("message audio started")},a=()=>{e(!1),console.log("message audio paused")},r=t.current;return t.current&&(t.current.muted=!0,t.current.addEventListener("ended",n),t.current.addEventListener("play",s),t.current.addEventListener("pause",a)),()=>{r&&(r.removeEventListener("ended",n),r.removeEventListener("play",s),r.removeEventListener("pause",a),URL.revokeObjectURL(r.src))}}),[e]),{audioRef:t}}const Hj=e=>{const{messageId:t,content:s,isLast:a=!1,index:r=0}=e??{},o=n.useRef(!1),i=n.useRef(void 0),[l,c]=n.useState(!1),{audioRef:d}=$j({setIsPlaying:c}),{pauseGlobalAudio:u}=ky(r),[m,p]=Ie(Cy.voice),f=Ae(Cy.globalAudioPlayingFamily(r)),h=l||a&&f,{cancelSpeech:g,generateSpeechExternal:x,isLoading:v,voices:b}=Bj({setIsSpeaking:c,audioRef:d,messageId:t,isLast:a,index:r});n.useEffect((()=>{const e=b[0];if(b.length){const t=b.find((e=>e===m));if(null!=t)return a_.log("useTextToSpeech.ts - Effect:",{voices:b,voice:t}),void p(t.toString());a_.log("useTextToSpeech.ts - Effect:",{voices:b,voice:e}),p(e.toString())}}),[p,m,b]);return{handleMouseDown:()=>{o.current=!0,i.current=window.setTimeout((()=>{if(o.current){const e=s??"",t="string"==typeof e?e:Ah(e);x(t,!1)}}),1e3)},handleMouseUp:()=>{o.current=!1,null!=i.current&&window.clearTimeout(i.current)},toggleSpeech:()=>{if(!0===h)g(),u();else{const e=s??"",t="string"==typeof e?e:Ah(e);x(t,!1)}},isSpeaking:h,isLoading:v,audioRef:d,voices:b}};const Gj=e=>{const{content:t,isLast:s=!1,index:a=0}=e??{},r=n.useRef(!1),o=n.useRef(void 0),[i,l]=n.useState(!1),{audioRef:c}=$j({setIsPlaying:l}),{pauseGlobalAudio:d}=ky(a),[u,m]=Ie(Cy.voice),p=Ae(Cy.globalAudioPlayingFamily(a)),f=i||s&&p,{generateSpeechLocal:h,cancelSpeechLocal:g,voices:x}=function({setIsSpeaking:e}){const t=Ae(Cy.voice),[s,a]=n.useState([]),r=Ae(Cy.cloudBrowserVoices),[o,i]=n.useState(!0),l=n.useCallback((()=>{const e=window.speechSynthesis;if(e)try{const t=e.getVoices();if(!Array.isArray(t))return void console.error("getVoices() did not return an array");const n=t.filter((e=>r||!0===e.localService)).map((e=>({value:e.name,label:e.name})));a(n)}catch(t){console.error("Error updating voices:",t),i(!1)}else i(!1)}),[r]);return n.useEffect((()=>{const e=window.speechSynthesis;if(e){try{e.getVoices().length?l():e.onvoiceschanged=l}catch(t){console.error("Error in useEffect:",t),i(!1)}return()=>{e.onvoiceschanged&&(e.onvoiceschanged=null)}}i(!1)}),[l]),{generateSpeechLocal:n=>{if(!o)return void console.warn("Speech synthesis is not supported");const a=window.speechSynthesis,r=s.find((e=>e.value===t));if(r)try{a.cancel();const t=new SpeechSynthesisUtterance(n);t.voice=a.getVoices().find((e=>e.name===r.value))||null,t.onend=()=>{e(!1)},t.onerror=t=>{console.error("Speech synthesis error:",t),e(!1)},e(!0),a.speak(t)}catch(i){console.error("Error generating speech:",i),e(!1)}else console.warn("Selected voice not found")},cancelSpeechLocal:()=>{if(o)try{window.speechSynthesis.cancel()}catch(t){console.error("Error cancelling speech:",t)}finally{e(!1)}},voices:s,isSpeechSynthesisSupported:o}}({setIsSpeaking:l});n.useEffect((()=>{const e=x[0];if(x.length&&"object"==typeof e){const t=x.find((e=>"object"==typeof e?e.value===u:e===u));if(null!=t){const e="object"==typeof t?t.value:t;return a_.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e}),void m(e)}a_.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e.value}),m(e.value)}}),[m,u,x]);return{handleMouseDown:()=>{r.current=!0,o.current=window.setTimeout((()=>{if(r.current){const e=t??"",n="string"==typeof e?e:Ah(e);h(n)}}),1e3)},handleMouseUp:()=>{r.current=!1,null!=o.current&&window.clearTimeout(o.current)},toggleSpeech:()=>{if(!0===f)g(),d();else{const e=t??"",n="string"==typeof e?e:Ah(e);h(n)}},isSpeaking:f,isLoading:!1,audioRef:c,voices:x}};var Kj,Wj,qj,Qj,Yj,Xj,Zj,Jj={},ew=function(){return ew=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ew.apply(this,arguments)};function tw(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n}function nw(e,t,n,s){return new(n||(n=Promise))((function(t,a){function r(e){try{i(s.next(e))}catch(t){a(t)}}function o(e){try{i(s.throw(e))}catch(t){a(t)}}function i(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(r,o)}i((s=s.apply(e,[])).next())}))}function sw(e,t){var n,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,s&&(a=2&i[0]?s.return:i[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,i[1])).done)return a;switch(s=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,s=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){r.label=i[1];break}if(6===i[0]&&r.label<a[1]){r.label=a[1],a=i;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(i);break}a[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],s=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function aw(e,t,n){if(n||2===arguments.length)for(var s,a=0,r=t.length;a<r;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.execute_code="execute_code",e.code_interpreter="code_interpreter",e.file_search="file_search",e.web_search="web_search",e.retrieval="retrieval",e.function="function",e.memory="memory",e.ui_resources="ui_resources"}(Kj||(Kj={})),function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.context="context",e.ocr="ocr"}(Wj||(Wj={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(qj||(qj={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(Qj||(Qj={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(Yj||(Yj={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(Xj||(Xj={})),function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(Zj||(Zj={}));var rw,ow={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(rw||(rw={}));var iw,lw,cw,dw,uw=uo(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),mw=uo(["thumbsUp","thumbsDown"]),pw=mo({rating:mw,tag:uw,text:po().max(1024).optional()});po().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(dw||(dw={}));var fw,hw,gw,xw,vw,bw,_w=fo(dw);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock",e.chatGPTBrowser="chatGPTBrowser",e.gptPlugins="gptPlugins"}(fw||(fw={})),fw.agents,fw.openAI,fw.bedrock,fw.azureOpenAI,fw.anthropic,fw.custom,fw.google,function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(hw||(hw={})),function(e){e.low="low",e.auto="auto",e.high="high"}(gw||(gw={})),function(e){e.none="",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(xw||(xw={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(vw||(vw={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(bw||(bw={})),(iw={})[gw.low]=0,iw[gw.auto]=1,iw[gw.high]=2,gw.low,gw.auto,gw.high;var yw=fo(gw),jw=fo(xw),ww=fo(vw),Nw=fo(bw);(lw={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[Kj.execute_code]=!1,lw[Kj.file_search]=!1,lw[Kj.web_search]=!1,lw.category="general",lw.support_contact={name:"",email:""},{type:Kj.function}[Kj.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}};var Cw,kw={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:gw.auto,min:0,max:2,step:1}},Sw=4096,Tw={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:128e3,step:1,default:8192,reset:function(e){return/claude-3[-.]5-sonnet/.test(e)||/claude-3[-.]7/.test(e)?8192:4096},set:function(e,t){return!/claude-3[-.]5-sonnet/.test(t)&&!/claude-3[-.]7/.test(t)&&e>Sw?Sw:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:Sw,step:1,default:Sw}},web_search:{default:!1}},Ew={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:gw.auto}},Rw=((cw={})[fw.openAI]=kw,cw[fw.google]={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32768,step:1,default:-1}},cw[fw.anthropic]=Tw,cw[fw.agents]=Ew,cw[fw.bedrock]=Ew,cw)[fw.google],Iw=fo(fw),Pw=ho([Iw,po()]),Aw=mo({authField:po(),label:po(),description:po()}),Mw=mo({name:po(),pluginKey:po(),description:po().optional(),icon:po().optional(),authConfig:xo(Aw).optional(),authenticated:go().optional(),chatMenu:go().optional(),isButton:go().optional(),toolkit:go().optional()}),Lw=mo({input:mo({content:po()}),output:mo({content:po()})});!function(e){e.functions="functions",e.classic="classic"}(Cw||(Cw={}));var Ow=(Cw.functions,Cw.functions,Cw.classic,{default:!0});fo(Cw);var Dw=mo({agent:po().default(Cw.functions),skipCompletion:go().default(Ow.default),model:po(),temperature:vo().default(0)});mo({messageId:po(),endpoint:po().optional(),clientId:po().nullable().optional(),conversationId:po().nullable(),parentMessageId:po().nullable(),responseMessageId:po().nullable().optional(),overrideParentMessageId:po().nullable().optional(),bg:po().nullable().optional(),model:po().nullable().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),sender:po().optional(),text:po(),generation:po().nullable().optional(),isCreatedByUser:go(),error:go().optional(),clientTimestamp:po().optional(),createdAt:po().optional().default((function(){return(new Date).toISOString()})),updatedAt:po().optional().default((function(){return(new Date).toISOString()})),current:go().optional(),unfinished:go().optional(),searchResult:go().optional(),finish_reason:po().optional(),thread_id:po().optional(),iconURL:po().nullable().optional(),feedback:pw.optional()});var Fw=ho([vo(),po()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),zw=_o((function(){return ho([yo(),go(),vo(),po(),xo(_o((function(){return zw}))),jo(_o((function(){return zw})))])})),Uw=mo({conversationId:po().nullable(),endpoint:Iw.nullable(),endpointType:Iw.nullable().optional(),isArchived:go().optional(),title:po().nullable().or(bo("New Chat")).default("New Chat"),user:po().optional(),messages:xo(po()).optional(),tools:ho([xo(Mw),xo(po())]).optional(),modelLabel:po().nullable().optional(),userLabel:po().optional(),model:po().nullable().optional(),promptPrefix:po().nullable().optional(),temperature:vo().nullable().optional(),topP:vo().optional(),topK:vo().optional(),top_p:vo().optional(),frequency_penalty:vo().optional(),presence_penalty:vo().optional(),parentMessageId:po().optional(),maxOutputTokens:Fw.nullable().optional(),maxContextTokens:Fw.optional(),max_tokens:Fw.optional(),promptCache:go().optional(),system:po().optional(),thinking:go().optional(),thinkingBudget:Fw.optional(),stream:go().optional(),artifacts:po().optional(),context:po().nullable().optional(),examples:xo(Lw).optional(),tags:xo(po()).optional(),createdAt:po(),updatedAt:po(),resendFiles:go().optional(),file_ids:xo(po()).optional(),imageDetail:yw.optional(),reasoning_effort:jw.optional().nullable(),reasoning_summary:ww.optional().nullable(),verbosity:Nw.optional().nullable(),useResponsesApi:go().optional(),web_search:go().optional(),disableStreaming:go().optional(),assistant_id:po().optional(),agent_id:po().optional(),region:po().optional(),maxTokens:Fw.optional(),additionalModelRequestFields:zw.optional(),instructions:po().optional(),additional_instructions:po().optional(),append_current_datetime:go().optional(),presetOverride:jo(wo()).optional(),stop:xo(po()).optional(),greeting:po().optional(),spec:po().nullable().optional(),iconURL:po().nullable().optional(),expiredAt:po().nullable().optional(),fileTokenLimit:Fw.optional(),resendImages:go().optional(),agentOptions:Dw.nullable().optional(),chatGptLabel:po().nullable().optional()}),Vw=Uw.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(mo({conversationId:po().nullable().optional(),presetId:po().nullable().optional(),title:po().nullable().optional(),defaultPreset:go().optional(),order:vo().optional(),endpoint:Pw.nullable()}));Uw.merge(mo({endpoint:Pw.nullable(),createdAt:po().optional(),updatedAt:po().optional()})),Uw.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(mo({endpoint:Pw.nullable()})),mo({conversationId:po(),shareId:po(),messages:xo(po()),isPublic:go(),title:po(),createdAt:po(),updatedAt:po()}),mo({_id:po(),user:po(),tag:po(),description:po().optional(),createdAt:po(),updatedAt:po(),count:vo(),position:vo()});var Bw=Uw.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0});Bw.transform((function(e){return Hw(e)})).catch((function(){return{}})),mo({maxOutputTokens:Fw.optional(),temperature:Fw.optional(),topP:Fw.optional(),topK:Fw.optional(),presencePenalty:Fw.optional(),frequencyPenalty:Fw.optional(),stopSequences:xo(po()).optional(),thinkingConfig:mo({includeThoughts:go().optional(),thinkingBudget:Fw.optional()}).optional(),web_search:go().optional()}).strip().optional();var $w=Uw.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,artifacts:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0});function Hw(e,t){var n=ew({},e);return Object.keys(n).forEach((function(e){var s=n[e];null==s&&delete n[e],t&&"string"==typeof s&&""===s&&delete n[e]})),n}$w.transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p,f,h=ew(ew({},e),{model:null!==(t=e.model)&&void 0!==t?t:"gpt-3.5-turbo",chatGptLabel:null!==(s=null!==(n=e.chatGptLabel)&&void 0!==n?n:e.modelLabel)&&void 0!==s?s:null,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,temperature:null!==(r=e.temperature)&&void 0!==r?r:.8,top_p:null!==(o=e.top_p)&&void 0!==o?o:1,presence_penalty:null!==(i=e.presence_penalty)&&void 0!==i?i:0,frequency_penalty:null!==(l=e.frequency_penalty)&&void 0!==l?l:0,tools:null!==(c=e.tools)&&void 0!==c?c:[],agentOptions:null!==(d=e.agentOptions)&&void 0!==d?d:{agent:Cw.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,spec:null!==(p=e.spec)&&void 0!==p?p:void 0,maxContextTokens:null!==(f=e.maxContextTokens)&&void 0!==f?f:void 0});return null!=e.modelLabel&&""!==e.modelLabel&&(h.modelLabel=null),h})).catch((function(){return{model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:Cw.functions,skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:void 0,greeting:void 0,spec:void 0,maxContextTokens:void 0}})),Uw.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,s,a,r,o,i,l;return ew(ew({},e),{model:null!==(t=e.model)&&void 0!==t?t:kw.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(s=e.instructions)&&void 0!==s?s:void 0,promptPrefix:null!==(a=e.promptPrefix)&&void 0!==a?a:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:kw.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),Uw.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return Hw(e)})).catch((function(){return{}})),Uw.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,s,a,r,o,i,l,c,d,u,m,p;return ew(ew({},e),{model:null!==(t=e.model)&&void 0!==t?t:Ew.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(s=e.temperature)&&void 0!==s?s:1,top_p:null!==(a=e.top_p)&&void 0!==a?a:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:Ew.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:gw.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:Ew.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:Ew.resendFiles.default,imageDetail:gw.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}})),Uw.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return Hw(e,!0)})).catch((function(){return{}})),Bw.transform((function(e){var t=ew({},e);return t.temperature===Rw.temperature.default&&delete t.temperature,t.maxOutputTokens===Rw.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Rw.topP.default&&delete t.topP,t.topK===Rw.topK.default&&delete t.topK,Hw(t)})).catch((function(){return{}})),Uw.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return Hw(e)})).catch((function(){return{}})),$w.transform((function(e){var t,n=ew({},e);return null===n.modelLabel&&delete n.modelLabel,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null===(t=n.tools)||void 0===t?void 0:t.length)&&delete n.tools,n.agentOptions&&n.agentOptions.agent===Cw.functions&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,Hw(n)})).catch((function(){return{}})),mo({bannerId:po(),message:po(),displayFrom:po(),displayTo:po(),createdAt:po(),updatedAt:po(),isPublic:go()}),Uw.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return Hw(e)})).catch((function(){return{}}));var Gw,Kw,Ww=mo({name:po(),label:po(),preset:Vw,order:vo().optional(),default:go().optional(),description:po().optional(),showIconInMenu:go().optional(),showIconInHeader:go().optional(),iconURL:ho([po(),Iw]).optional(),authType:_w.optional()}),qw=mo({enforce:go().default(!1),prioritize:go().default(!0),list:xo(Ww).min(1),addedEndpoints:xo(ho([po(),Iw])).optional()});(Gw={})[fw.openAI]=!0,Gw[fw.google]=!0,Gw[fw.assistants]=!0,Gw[fw.azureAssistants]=!0,Gw[fw.agents]=!0,Gw[fw.azureOpenAI]=!0,Gw[fw.anthropic]=!0,Gw[fw.custom]=!0,Gw[fw.bedrock]=!0;var Qw=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];aw(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip","image/svg","image/svg+xml"],Qw,!0),aw(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],Qw,!0);var Yw=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/,/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,/^(application\/(epub\+zip|csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,/^image\/(jpeg|gif|png|webp|heic|heif)$/,/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|x-m4a|flac|x-flac|webm)$/,/^image\/(svg|svg\+xml)$/],Xw=536870912,Zw={fileLimit:10,fileSizeLimit:Xw,totalSizeLimit:Xw,supportedMimeTypes:Yw,disabled:!1};(Kw={})[fw.assistants]=Zw,Kw[fw.azureAssistants]=Zw,Kw[fw.agents]=Zw,Kw.default={fileLimit:10,fileSizeLimit:Xw,totalSizeLimit:Xw,supportedMimeTypes:Yw,disabled:!1};var Jw,eN,tN,nN,sN,aN=xo(No()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),rN=mo({disabled:go().optional(),fileLimit:vo().min(0).optional(),fileSizeLimit:vo().min(0).optional(),totalSizeLimit:vo().min(0).optional(),supportedMimeTypes:aN.optional()}),oN=mo({endpoints:jo(rN).optional(),serverFileSizeLimit:vo().min(0).optional(),avatarSizeLimit:vo().min(0).optional(),fileTokenLimit:vo().min(0).optional(),imageGeneration:mo({percentage:vo().min(0).max(100).optional(),px:vo().min(0).optional()}).optional(),clientImageResize:mo({enabled:go().optional(),maxWidth:vo().min(0).optional(),maxHeight:vo().min(0).optional(),quality:vo().min(0).max(1).optional()}).optional(),ocr:mo({supportedMimeTypes:aN.optional()}).optional(),text:mo({supportedMimeTypes:aN.optional()}).optional()});!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(Jw||(Jw={})),function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(eN||(eN={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(tN||(tN={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(nN||(nN={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(sN||(sN={}));var iN=/^\${(.+)}$/;function lN(e){if(!e)return e;var t=e.trim(),n=t.match(iN);if(n){var s=n[1];return Jj[s]||t}for(var a,r=/\${([^}]+)}/g,o=t,i=[];null!==(a=r.exec(t));)i.push({fullMatch:a[0],varName:a[1],index:a.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(s=c.varName,c.index),m=Jj[s]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}var cN=mo({startup:go().optional(),iconPath:po().optional(),timeout:vo().optional(),initTimeout:vo().optional(),chatMenu:go().optional(),serverInstructions:ho([go(),po()]).optional(),requiresOAuth:go().optional(),oauth:mo({authorization_url:po().url().optional(),token_url:po().url().optional(),client_id:po().optional(),client_secret:po().optional(),scope:po().optional(),redirect_uri:po().url().optional(),token_exchange_method:fo(sN).optional(),grant_types_supported:xo(po()).optional(),token_endpoint_auth_methods_supported:xo(po()).optional(),response_types_supported:xo(po()).optional(),code_challenge_methods_supported:xo(po()).optional(),revocation_endpoint:po().url().optional(),revocation_endpoint_auth_methods_supported:xo(po()).optional()}).optional(),customUserVars:jo(po(),mo({title:po(),description:po()})).optional()}),dN=cN.extend({type:bo("stdio").optional(),command:po(),args:xo(po()),env:jo(po(),po()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,s=Object.entries(e);n<s.length;n++){var a=s[n],r=a[0],o=a[1];t[r]=lN(o)}return t})),stderr:No().optional()}),uN=cN.extend({type:bo("websocket").optional(),url:po().transform((function(e){return lN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),mN=cN.extend({type:bo("sse").optional(),headers:jo(po(),po()).optional(),url:po().transform((function(e){return lN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),pN=cN.extend({type:ho([bo("streamable-http"),bo("http")]),headers:jo(po(),po()).optional(),url:po().transform((function(e){return lN(e)})).pipe(po().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),fN=ho([dN,uN,mN,pN]),hN=jo(po(),fN),gN="";if(void 0===xe||!0===xe.browser){var xN=document.querySelector("base");gN=(null==xN?void 0:xN.getAttribute("href"))||"/"}gN&&gN.endsWith("/")&&(gN=gN.slice(0,-1));var vN,bN,_N,yN,jN,wN,NN,CN,kN,SN=function(){return gN},TN="".concat(gN,"/api/messages"),EN=function(e){var t,n,s=e.conversationId,a=e.messageId,r=tw(e,["conversationId","messageId"]);return s&&a?"".concat(TN,"/").concat(s,"/").concat(a):s?"".concat(TN,"/").concat(s):"".concat(TN).concat((t=r,(n=Object.entries(t).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&"))?"?".concat(n):""))},RN="".concat(gN,"/api/share"),IN="".concat(gN,"/api/keys"),PN="".concat(gN,"/api/convos");!function(e){e.default="default",e.advanced="advanced"}(kN||(kN={}));var AN,MN,LN=fo(Jw),ON=mo({default:LN.optional(),avatar:LN.optional(),image:LN.optional(),document:LN.optional()}).optional(),DN=mo({deploymentName:po().optional(),version:po().optional(),assistants:go().optional()}).or(go()),FN=mo({apiKey:po(),serverless:go().optional(),instanceName:po().optional(),deploymentName:po().optional(),assistants:go().optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),forcePrompt:go().optional(),version:po().optional(),baseURL:po().optional(),additionalHeaders:jo(No()).optional()}),zN=mo({group:po(),models:jo(po(),DN)}).required().and(FN),UN=xo(zN).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(AN||(AN={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.context="context",e.tools="tools",e.chain="chain",e.ocr="ocr"}(MN||(MN={})),(vN={})[fw.assistants]=2,vN[fw.azureAssistants]=1;var VN=mo({streamRate:vo().optional(),baseURL:po().optional(),titlePrompt:po().optional(),titleModel:po().optional(),titleConvo:go().optional(),titleMethod:ho([bo("completion"),bo("functions"),bo("structured")]).optional(),titleEndpoint:po().optional(),titlePromptTemplate:po().optional()});VN.merge(mo({availableRegions:xo(po()).optional()}));var BN,$N=VN.merge(mo({disableBuilder:go().optional(),pollIntervalMs:vo().optional(),timeoutMs:vo().optional(),version:ho([po(),vo()]).default(2),supportedIds:xo(po()).min(1).optional(),excludedIds:xo(po()).min(1).optional(),privateAssistants:go().optional(),retrievalModels:xo(po()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:xo(fo(AN)).optional().default([AN.code_interpreter,AN.image_vision,AN.retrieval,AN.actions,AN.tools]),apiKey:po().optional(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}).optional(),headers:jo(No()).optional()})),HN=[MN.execute_code,MN.file_search,MN.web_search,MN.artifacts,MN.actions,MN.context,MN.tools,MN.chain,MN.ocr],GN=VN.merge(mo({recursionLimit:vo().optional(),disableBuilder:go().optional().default(!1),maxRecursionLimit:vo().optional(),maxCitations:vo().min(1).max(50).optional().default(30),maxCitationsPerFile:vo().min(1).max(10).optional().default(7),minRelevanceScore:vo().min(0).max(1).optional().default(.45),allowedProviders:xo(ho([po(),Iw])).optional(),capabilities:xo(fo(MN)).optional().default(HN)})).default({disableBuilder:!1,capabilities:HN,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),KN=VN.merge(mo({name:po().refine((function(e){return!Iw.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(fw).join(", "))}),apiKey:po(),baseURL:po(),models:mo({default:xo(po()).min(1),fetch:go().optional(),userIdQuery:go().optional()}),summarize:go().optional(),summaryModel:po().optional(),iconURL:po().optional(),forcePrompt:go().optional(),modelDisplayLabel:po().optional(),headers:jo(No()).optional(),addParams:jo(No()).optional(),dropParams:xo(po()).optional(),customParams:mo({defaultParamsEndpoint:po().default("custom"),paramDefinitions:xo(jo(No())).optional()}).strict(),customOrder:vo().optional(),directEndpoint:go().optional(),titleMessageRole:po().optional()})),WN=mo({groups:UN,plugins:go().optional(),assistants:go().optional()}).and(KN.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),qN=mo({url:po().optional(),apiKey:po(),model:po(),voices:xo(po())}),QN=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po(),model:po(),voices:xo(po())}),YN=mo({url:po().optional(),websocketUrl:po().optional(),apiKey:po(),model:po(),voices:xo(po()),voice_settings:mo({similarity_boost:vo().optional(),stability:vo().optional(),style:vo().optional(),use_speaker_boost:go().optional()}).optional(),pronunciation_dictionary_locators:xo(po()).optional()}),XN=mo({url:po(),apiKey:po().optional(),voices:xo(po()),backend:po()}),ZN=mo({openai:qN.optional(),azureOpenAI:QN.optional(),elevenlabs:YN.optional(),localai:XN.optional()}),JN=mo({url:po().optional(),apiKey:po(),model:po()}),eC=mo({instanceName:po(),apiKey:po(),deploymentName:po(),apiVersion:po()}),tC=mo({openai:JN.optional(),azureOpenAI:eC.optional()}),nC=mo({conversationMode:go().optional(),advancedMode:go().optional(),speechToText:go().optional().or(mo({engineSTT:po().optional(),languageSTT:po().optional(),autoTranscribeAudio:go().optional(),decibelValue:vo().optional(),autoSendText:vo().optional()})).optional(),textToSpeech:go().optional().or(mo({engineTTS:po().optional(),voice:po().optional(),languageTTS:po().optional(),automaticPlayback:go().optional(),playbackRate:vo().optional(),cacheTTS:go().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(BN||(BN={}));var sC,aC=mo({fileUploads:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),conversationsImport:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),tts:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional(),stt:mo({ipMax:vo().optional(),ipWindowInMinutes:vo().optional(),userMax:vo().optional(),userWindowInMinutes:vo().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(sC||(sC={}));var rC,oC,iC,lC,cC,dC,uC=mo({externalUrl:po().optional(),openNewTab:go().optional(),modalAcceptance:go().optional(),modalTitle:po().optional(),modalContent:po().or(xo(po())).optional()}),mC=mo({placeholder:po().optional()}),pC=mo({privacyPolicy:mo({externalUrl:po().optional(),openNewTab:go().optional()}).optional(),termsOfService:uC.optional(),customWelcome:po().optional(),mcpServers:mC.optional(),endpointsMenu:go().optional(),modelSelect:go().optional(),parameters:go().optional(),sidePanel:go().optional(),multiConvo:go().optional(),bookmarks:go().optional(),memories:go().optional(),presets:go().optional(),prompts:go().optional(),agents:go().optional(),temporaryChat:go().optional(),temporaryChatRetention:vo().min(1).max(8760).optional(),runCode:go().optional(),webSearch:go().optional(),peoplePicker:mo({users:go().optional(),groups:go().optional(),roles:go().optional()}).optional(),marketplace:mo({use:go().optional()}).optional(),fileSearch:go().optional(),fileCitations:go().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},fileSearch:!0,fileCitations:!0}),fC=mo({language:po().default("auto"),size:uo(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),hC=mo({siteKey:po(),options:fC.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(rC||(rC={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}(oC||(oC={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(iC||(iC={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(lC||(lC={})),function(e){e.JINA="jina",e.COHERE="cohere"}(cC||(cC={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(dC||(dC={}));var gC,xC,vC=mo({serperApiKey:po().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:po().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:po().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:po().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:po().optional().default("${FIRECRAWL_API_URL}"),jinaApiKey:po().optional().default("${JINA_API_KEY}"),jinaApiUrl:po().optional().default("${JINA_API_URL}"),cohereApiKey:po().optional().default("${COHERE_API_KEY}"),searchProvider:fo(iC).optional(),scraperType:fo(lC).optional(),rerankerType:fo(cC).optional(),scraperTimeout:vo().optional(),safeSearch:fo(dC).default(dC.MODERATE),firecrawlOptions:mo({formats:xo(po()).optional(),includeTags:xo(po()).optional(),excludeTags:xo(po()).optional(),headers:jo(po()).optional(),waitFor:vo().optional(),timeout:vo().optional(),maxAge:vo().optional(),mobile:go().optional(),skipTlsVerification:go().optional(),blockAds:go().optional(),removeBase64Images:go().optional(),parsePDF:go().optional(),storeInCache:go().optional(),zeroDataRetention:go().optional(),location:mo({country:po().optional(),languages:xo(po()).optional()}).optional(),onlyMainContent:go().optional(),changeTrackingOptions:mo({modes:xo(po()).optional(),schema:jo(wo()).optional(),prompt:po().optional(),tag:po().nullable().optional()}).optional()}).optional()}),bC=mo({mistralModel:po().optional(),apiKey:po().optional().default("${OCR_API_KEY}"),baseURL:po().optional().default("${OCR_BASEURL}"),strategy:fo(rC).default(rC.MISTRAL_OCR)}),_C=mo({enabled:go().optional().default(!1),startBalance:vo().optional().default(2e4),autoRefillEnabled:go().optional().default(!1),refillIntervalValue:vo().optional().default(30),refillIntervalUnit:uo(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:vo().optional().default(1e4)}),yC=mo({enabled:go().optional().default(!0)}),jC=mo({disabled:go().optional(),validKeys:xo(po()).optional(),tokenLimit:vo().optional(),charLimit:vo().optional().default(1e4),personalize:go().default(!0),messageWindowSize:vo().optional().default(5),agent:ho([mo({id:po()}),mo({provider:po(),model:po(),instructions:po().optional(),model_parameters:jo(No()).optional()})]).optional()}),wC=xo(KN.partial()).optional();mo({version:po(),cache:go().default(!0),ocr:bC.optional(),webSearch:vC.optional(),memory:jC.optional(),secureImageLinks:go().optional(),imageOutputType:fo(sC).default(sC.PNG),includedTools:xo(po()).optional(),filteredTools:xo(po()).optional(),mcpServers:hN.optional(),interface:pC,turnstile:hC.optional(),fileStrategy:LN.default(Jw.local),fileStrategies:ON,actions:mo({allowedDomains:xo(po()).optional()}).optional(),registration:mo({socialLogins:xo(po()).optional(),allowedDomains:xo(po()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:_C.optional(),transactions:yC.optional(),speech:mo({tts:ZN.optional(),stt:tC.optional(),speechTab:nC.optional()}).optional(),rateLimits:aC.optional(),fileConfig:oN.optional(),modelSpecs:qw.optional(),endpoints:mo((bN={all:VN.optional()},bN[fw.openAI]=VN.optional(),bN[fw.google]=VN.optional(),bN[fw.anthropic]=VN.optional(),bN[fw.gptPlugins]=VN.optional(),bN[fw.azureOpenAI]=WN.optional(),bN[fw.azureAssistants]=$N.optional(),bN[fw.assistants]=$N.optional(),bN[fw.agents]=GN.optional(),bN[fw.custom]=wC.optional(),bN[fw.bedrock]=VN.optional(),bN)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.vercel="vercel",e.xai="xai"}(gC||(gC={})),(xC||(xC={})).openrouter="openrouter",fw.openAI,fw.assistants,fw.azureAssistants,fw.azureOpenAI,fw.agents,fw.chatGPTBrowser,fw.gptPlugins,fw.google,fw.anthropic,fw.custom,fw.bedrock,(_N={})[fw.openAI]="OpenAI",_N[fw.assistants]="Assistants",_N[fw.agents]="My Agents",_N[fw.azureAssistants]="Azure Assistants",_N[fw.azureOpenAI]="Azure OpenAI",_N[fw.chatGPTBrowser]="ChatGPT",_N[fw.gptPlugins]="Plugins",_N[fw.google]="Google",_N[fw.anthropic]="Anthropic",_N[fw.custom]="Custom",_N[fw.bedrock]="AWS Bedrock",_N[gC.ollama]="Ollama",_N[gC.deepseek]="DeepSeek",_N[gC.xai]="xAI",_N[gC.vercel]="Vercel";var NC,CC,kC,SC,TC,EC,RC,IC,PC,AC,MC,LC,OC,DC,FC,zC,UC=["gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],VC=((yN={})[fw.azureAssistants]=UC,yN[fw.assistants]=aw(aw([],UC,!0),["chatgpt-4o-latest"],!1),yN[fw.agents]=UC,yN[fw.google]=["gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite","gemini-2.0-flash-001","gemini-2.0-flash-lite"],yN[fw.anthropic]=["claude-sonnet-4-5","claude-sonnet-4-5-20250929","claude-opus-4-1","claude-opus-4-1-20250805","claude-sonnet-4-20250514","claude-sonnet-4-0","claude-opus-4-20250514","claude-opus-4-0","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],yN[fw.openAI]=aw(aw([],UC,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),yN[fw.bedrock]=["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],yN),BC=VC[fw.openAI],$C=((jN={initial:[]})[fw.openAI]=BC,jN[fw.assistants]=BC.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),jN[fw.agents]=BC,jN[fw.gptPlugins]=BC,jN[fw.azureOpenAI]=BC,jN[fw.chatGPTBrowser]=["text-davinci-002-render-sha"],jN[fw.google]=VC[fw.google],jN[fw.anthropic]=VC[fw.anthropic],jN[fw.bedrock]=VC[fw.bedrock],jN);function HC(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}(wN={})[fw.assistants]="".concat(SN(),"/api/assistants/v2/chat"),wN[fw.azureAssistants]="".concat(SN(),"/api/assistants/v1/chat"),wN[fw.agents]="".concat(SN(),"/api/").concat(fw.agents,"/chat"),fw.gptPlugins,fw.anthropic,fw.google,fw.openAI,fw.azureOpenAI,fw.custom,fw.agents,fw.bedrock,(NN={})[fw.custom]=!0,NN[fw.openAI]=!0,NN[fw.anthropic]=!0,NN[fw.gptPlugins]=!0,NN[fw.assistants]=!0,NN[fw.agents]=!0,NN[fw.azureAssistants]=!0,NN[fw.azureOpenAI]=!0,NN[fw.bedrock]=!0,function(e){e.generative="generative",e.agents="agents"}(NC||(NC={})),function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(CC||(CC={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(kC||(kC={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.PLUGINS="PLUGINS",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(SC||(SC={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(TC||(TC={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed"}(EC||(EC={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(RC||(RC={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(IC||(IC={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(PC||(PC={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(AC||(AC={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}(MC||(MC={})),function(e){e.VERSION="v0.8.0-rc4",e.CONFIG_VERSION="1.2.9",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_server="sys__server__sys",e.EPHEMERAL_AGENT_ID="ephemeral"}(LC||(LC={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(OC||(OC={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(DC||(DC={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(FC||(FC={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(zC||(zC={})),(CN={})[fw.openAI]=fw.openAI,CN[fw.bedrock]=fw.bedrock,CN[fw.anthropic]=fw.anthropic,CN[fw.azureOpenAI]=fw.azureOpenAI;var GC=!1,KC=[],WC=function(e){return HC((t=e,"".concat(gN,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},qC=function(e){var t;t=e,co.defaults.headers.common.Authorization="Bearer "+t,window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},QC=function(e,t){void 0===t&&(t=null),KC.forEach((function(n){e?n.reject(e):n.resolve(t)})),KC=[]};"undefined"!=typeof window&&co.interceptors.response.use((function(e){return e}),(function(e){return nw(void 0,0,void 0,(function(){var t,n,s,a,r,o,i,l,c;return sw(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!GC)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){KC.push({resolve:e,reject:t})}))];case 2:return a=d.sent(),t.headers.Authorization="Bearer "+a,[4,co(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:GC=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,WC(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return s=d.sent(),(a=null!==(c=null==s?void 0:s.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+a,qC(a),QC(null,a),[4,co(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href="/login",d.label=10;case 10:return[3,13];case 11:return r=d.sent(),QC(r,null),[2,Promise.reject(r)];case 12:return GC=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var YC={get:function(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.get(e,ew({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.get(e,ew({},t))];case 1:return[2,n.sent()]}}))}))},post:HC,postMultiPart:function(e,t,n){return nw(this,0,void 0,(function(){return sw(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,ew(ew({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,s.sent().data]}}))}))},postTTS:function(e,t,n){return nw(this,0,void 0,(function(){return sw(this,(function(s){switch(s.label){case 0:return[4,co.post(e,t,ew(ew({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,s.sent().data]}}))}))},put:function(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return nw(this,0,void 0,(function(){return sw(this,(function(t){switch(t.label){case 0:return[4,co.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.delete(e,ew({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return nw(this,0,void 0,(function(){return sw(this,(function(n){switch(n.label){case 0:return[4,co.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:WC,dispatchTokenUpdatedEvent:qC};var XC,ZC,JC,ek,tk,nk,sk,ak=function(){return YC.get("".concat("".concat("".concat(gN,"/api/files"),"/speech"),"/config/get"))};!function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpTools="mcpTools",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken"}(XC||(XC={})),function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}(ZC||(ZC={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(JC||(JC={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(ek||(ek={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup"}(tk||(tk={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(nk||(nk={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner"}(sk||(sk={}));var rk=mo({type:fo(JC),id:po().optional(),name:po().optional(),email:po().optional(),source:uo(["local","entra"]).optional(),avatar:po().optional(),description:po().optional(),idOnTheSource:po().optional(),accessRoleId:fo(sk).optional(),memberCount:vo().optional()}),ok=mo({accessRoleId:fo(sk),name:po(),description:po().optional(),resourceType:fo(tk).default(tk.AGENT),permBits:vo()}),ik=mo({id:po(),principalType:fo(JC),principalId:po().optional(),principalName:po().optional(),role:ok,grantedBy:po(),grantedAt:po(),inheritedFrom:po().optional(),source:uo(["local","entra"]).optional()});mo({resourceType:fo(tk),resourceId:po(),permissions:xo(ik)}),mo({updated:rk.array(),removed:rk.array(),public:go(),publicAccessRoleId:po().optional()}),mo({message:po(),results:mo({principals:rk.array(),public:go(),publicAccessRoleId:po().optional()})}),mo({resourceType:fo(tk),resourceId:fo(sk),principals:xo(rk),public:go(),publicAccessRoleId:fo(sk).optional()}),mo({permissionBits:vo()});var lk=function(e,t){return mr([XC.sharedMessages,e],(function(){return function(e){return YC.get((t=e,"".concat(RN,"/").concat(t)));var t}(e)}),ew({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},t))},ck=function(e,t){var n=pr();return mr([XC.sharedLinks,e],(function(){return function(e){return YC.get((t=e,"".concat(RN,"/link/").concat(t)));var t}(e)}),ew({enabled:!!e&&e!==LC.NEW_CONVO&&e!==LC.PENDING_CONVO,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,onSuccess:function(t){n.setQueryData([XC.sharedLinks,e],{conversationId:t.conversationId,shareId:t.shareId})}},t))},dk=function(){var e=pr();return fr((function(e){return function(e){if(!e.value)throw new Error("value is required");return YC.put(IN,e)}(e)}),{onSuccess:function(t,n){e.invalidateQueries([XC.name,n.name])}})},uk=function(){var e=pr();return fr((function(){return YC.delete("".concat(PN,"/all"))}),{onSuccess:function(){e.invalidateQueries([XC.allConversations])}})},mk=function(e){var t=pr();return fr((function(){return function(e){return YC.delete((t=e,"".concat(IN,"/").concat(t)));var t}(e)}),{onSuccess:function(){var n,s;t.invalidateQueries([XC.name,e]),(s=null!=(n=e)?n:"")&&s.toLowerCase().endsWith(fw.assistants)&&(t.invalidateQueries([XC.assistants,e,ow]),t.invalidateQueries([XC.assistantDocs]),t.invalidateQueries([XC.assistants]),t.invalidateQueries([XC.assistant]),t.invalidateQueries([XC.mcpTools]),t.invalidateQueries([XC.actions]),t.invalidateQueries([XC.tools]))}})},pk=function(){var e=pr();return fr((function(){return YC.delete("".concat(IN,"?all=true"))}),{onSuccess:function(){e.invalidateQueries([XC.name]),e.invalidateQueries([XC.assistants,fw.assistants,ow]),e.invalidateQueries([XC.assistants,fw.azureAssistants,ow]),e.invalidateQueries([XC.assistantDocs]),e.invalidateQueries([XC.assistants]),e.invalidateQueries([XC.assistant]),e.invalidateQueries([XC.mcpTools]),e.invalidateQueries([XC.actions]),e.invalidateQueries([XC.tools])}})},fk=function(e){return mr([XC.models],(function(){return nw(void 0,0,void 0,(function(){return sw(this,(function(e){return[2,YC.get("".concat(gN,"/api/models"))]}))}))}),ew({initialData:$C,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1/0},e))},hk=function(){var e=pr();return fr((function(e){return function(e){return YC.post("".concat(gN,"/api/presets"),e)}(e)}),{onSuccess:function(){e.invalidateQueries([XC.presets])}})},gk=function(e){var t=pr();return fr((function(e){return function(e){return YC.post("".concat(gN,"/api/auth/register"),e)}(e)}),ew(ew({},e),{onSuccess:function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];t.invalidateQueries([XC.user]),(null==e?void 0:e.onSuccess)&&e.onSuccess.apply(e,n)}}))},xk=function(e,t){return mr([XC.name,e],(function(){return e?function(e){return YC.get((t=e,"".concat(IN,"?name=").concat(t)));var t}(e):Promise.resolve({expiresAt:""})}),ew({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},t))},vk=function(){return fr((function(e){return function(e){return YC.post("".concat(gN,"/api/auth/requestPasswordReset"),e)}(e)}))},bk=function(){return fr((function(e){return function(e){return YC.post("".concat(gN,"/api/auth/resetPassword"),e)}(e)}))},_k=function(e){return mr([XC.availablePlugins],(function(){return YC.get("".concat(gN,"/api/plugins"))}),ew({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},yk=function(e){var t=pr(),n=null!=e?e:{},s=n.onSuccess,a=tw(n,["onSuccess"]);return fr((function(e){return function(e){return YC.post("".concat(gN,"/api/user/plugins"),e)}(e)}),ew(ew({},a),{onSuccess:function(){for(var e,n,a,r,o,i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];if(t.invalidateQueries([XC.user]),null==s||s.apply(void 0,i),"uninstall"===(null===(e=i[1])||void 0===e?void 0:e.action)&&(null===(a=null===(n=i[1])||void 0===n?void 0:n.pluginKey)||void 0===a?void 0:a.startsWith(LC.mcp_prefix))){var c=null===(o=null===(r=i[1])||void 0===r?void 0:r.pluginKey)||void 0===o?void 0:o.substring(LC.mcp_prefix.length);t.invalidateQueries([XC.mcpAuthValues,c])}}}))},jk=function(){var e=pr();return fr((function(e){return function(e){return YC.post((t=e,"".concat(gN,"/api/mcp/").concat(t,"/reinitialize")));var t}(e)}),{onSuccess:function(){e.invalidateQueries([XC.mcpTools])}})},wk=function(){var e=pr();return fr((function(e){return function(e){return YC.post((t=e,"".concat(gN,"/api/mcp/oauth/cancel/").concat(t)),{});var t}(e)}),{onSuccess:function(){e.invalidateQueries([XC.mcpConnectionStatus])}})},Nk=function(e){return mr([XC.customConfigSpeech],(function(){return ak()}),ew({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},Ck=function(e,t){var n=pr();return fr((function(n){return function(e,t,n){return YC.put((s=e,a=t,"".concat(gN,"/api/messages/").concat(s,"/").concat(a,"/feedback")),n);var s,a}(e,t,n)}),{onSuccess:function(){n.invalidateQueries([XC.messages,t])}})},kk=function(e,t){return mr([XC.principalSearch,e],(function(){return function(e){return YC.get((n=(t=e).q,s=t.limit,a=t.types,r="".concat(gN,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==s&&(r+="&limit=".concat(s)),a&&a.length>0&&(r+="&types=".concat(a.join(","))),r));var t,n,s,a,r}(e)}),ew({enabled:!!e.q&&e.q.length>=2,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e4},t))},Sk=function(e,t){return mr([XC.accessRoles,e],(function(){return function(e){return YC.get((t=e,"".concat(gN,"/api/permissions/").concat(t,"/roles")));var t}(e)}),ew({enabled:!!e,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5},t))},Tk=function(e,t,n){return mr([XC.resourcePermissions,e,t],(function(){return function(e,t){return YC.get((n=e,s=t,"".concat(gN,"/api/permissions/").concat(n,"/").concat(s)));var n,s}(e,t)}),ew({enabled:!!e&&!!t,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:12e4},n))},Ek=function(){var e=pr();return fr({mutationFn:function(e){return function(e,t,n){return YC.put((s=e,a=t,"".concat(gN,"/api/permissions/").concat(s,"/").concat(a)),n);var s,a}(e.resourceType,e.resourceId,e.data)},onSuccess:function(t,n){e.invalidateQueries({queryKey:[XC.accessRoles,n.resourceType]}),e.invalidateQueries({queryKey:[XC.resourcePermissions,n.resourceType,n.resourceId]}),e.invalidateQueries({queryKey:[XC.effectivePermissions,n.resourceType,n.resourceId]})}})},Rk=function(e,t,n){return mr(ew({queryKey:[XC.effectivePermissions,e,t],queryFn:function(){return function(e,t){return YC.get((n=e,s=t,"".concat(gN,"/api/permissions/").concat(n,"/").concat(s,"/effective")));var n,s}(e,t)},enabled:!!e&&!!t,refetchOnWindowFocus:!1,staleTime:3e4},n))};const Ik=new Set(["spec","iconURL"]),Pk=()=>{const{data:e={}}=Ky(),{data:t={}}=fk();return({conversation:n,preset:s,cleanInput:a,cleanOutput:r})=>{const o=c_({convoSetup:s,endpointsConfig:e}),i=t[o??""]||[],l={...n};if(!0===a)for(const e in l)Yp.has(e)&&!Ik.has(e)||null!=l[e]&&(l[e]=void 0);const c=l_({conversation:l,endpoint:o,lastConversationSetup:s,models:i});if(!r)return c;for(const e in c)Yp.has(e)&&!Ik.has(e)||null!=c[e]&&(c[e]=void 0);return c}},Ak=n.createContext({}),Mk=()=>n.useContext(Ak),Lk=e=>e.data.map((({id:e,name:t,metadata:n,model:s})=>({id:e,name:t??"",metadata:n,model:s})));function Ok(e=Lk){const{data:t=null}=xj(Nu.assistants,void 0,{select:e}),{data:s=null}=xj(Nu.azureAssistants,void 0,{select:e});return n.useMemo((()=>({[Nu.assistants]:t,[Nu.azureAssistants]:s})),[t,s])}function Dk({isAuthenticated:e}){const{data:t=null}=Py({requiredPermission:Yg.VIEW},{select:e=>function(e){const t={};for(const n of e)t[n.id]=n;return t}(e.data),enabled:e});return n.useMemo((()=>null!==t?t:void 0),[t])}const Fk=n.createContext({}),zk=()=>n.useContext(Fk);function Uk(){const e=Ae(Cy.lang),{t:t,i18n:s}=lo();return n.useEffect((()=>{s.language!==e&&s.changeLanguage(e)}),[e,s]),(e,n)=>t(e,n)}const Vk="",Bk="com_ui_agent_category_general",$k=()=>{const e=Uk(),t=Ly({staleTime:9e5});return{categories:n.useMemo((()=>t.data?t.data.filter((e=>"promoted"!==e.value&&"all"!==e.value)).map((e=>({label:e.label||e.value,value:e.value,className:"w-full"}))):[]),[t.data]),emptyCategory:n.useMemo((()=>({label:e(Bk),value:Vk,className:"w-full"})),[e]),isLoading:t.isLoading,error:t.error}};function Hk(e){const t=n.useMemo((()=>(null==e?void 0:e.includes(ef.tools))??!1),[e]),s=n.useMemo((()=>(null==e?void 0:e.includes(ef.actions))??!1),[e]),a=n.useMemo((()=>(null==e?void 0:e.includes(ef.artifacts))??!1),[e]),r=n.useMemo((()=>(null==e?void 0:e.includes(ef.ocr))??!1),[e]),o=n.useMemo((()=>(null==e?void 0:e.includes(ef.context))??!1),[e]),i=n.useMemo((()=>(null==e?void 0:e.includes(ef.file_search))??!1),[e]),l=n.useMemo((()=>(null==e?void 0:e.includes(ef.web_search))??!1),[e]);return{ocrEnabled:r,codeEnabled:n.useMemo((()=>(null==e?void 0:e.includes(ef.execute_code))??!1),[e]),toolsEnabled:t,actionsEnabled:s,contextEnabled:o,artifactsEnabled:a,webSearchEnabled:l,fileSearchEnabled:i}}function Gk(e){const{endpointsConfig:t}={},{data:s}=Ky({enabled:!t}),a=t||s;return{agentsConfig:n.useMemo((()=>{const e=(null==a?void 0:a[Nu.agents])??null;return e?{...e,capabilities:Array.isArray(e.capabilities)?e.capabilities.map((e=>e)):[]}:null}),[a]),endpointsConfig:a}}const Kk=n.createContext(void 0),Wk=({authConfig:e,children:t})=>{const[a,r]=Ie(Cy.user),[o,i]=n.useState(void 0),[l,c]=n.useState(void 0),[d,u]=n.useState(!1),m=n.useRef(void 0),{data:p=null}=Vj(Pg.USER,{enabled:!(!d||!(null==a?void 0:a.role))}),{data:f=null}=Vj(Pg.ADMIN,{enabled:!(!d||(null==a?void 0:a.role)!==Pg.ADMIN)}),h=Fe(),g=n.useMemo((()=>So.debounce((e=>{const{token:t,isAuthenticated:n,user:s,redirect:a}=e;r(s),i(t),ox(t),u(n);const o=m.current||a;m.current=void 0,null!=o&&(o.startsWith("http://")||o.startsWith("https://")?window.location.href=o:h(o,{replace:!0}))}),50)),[h,r]),x=function({callback:e,delay:t=400}){const s=n.useRef(null);return n.useEffect((()=>()=>{null!==s.current&&clearTimeout(s.current)}),[]),n=>{null!==s.current&&clearTimeout(s.current),null!=n&&n&&(console.log(n),s.current=setTimeout((()=>{e(n)}),t))}}({callback:e=>c(e)}),v=(e=>{const t=pr(),n=Ey(),s=Oe(Cy.defaultPreset),a=Pe(Cy.queriesEnabled);return fr([ax.loginUser],{mutationFn:e=>fx.login(e),...e||{},onMutate:a=>{var r;s(),n(),t.removeQueries(),null==(r=null==e?void 0:e.onMutate)||r.call(e,a)},onSuccess:(...t)=>{var n;a(!0),null==(n=null==e?void 0:e.onSuccess)||n.call(e,...t)}})})({onSuccess:e=>{const{user:t,token:n,twoFAPending:s,tempToken:a}=e;s?h(`/login/2fa?tempToken=${a}`,{replace:!0}):(c(void 0),g({token:n,isAuthenticated:!0,user:t,redirect:"/c/new"}))},onError:e=>{x(e.message),h("/login",{replace:!0})}}),b=(e=>{const t=pr(),n=Ey(),s=Oe(Cy.defaultPreset),a=Pe(Cy.queriesEnabled);return fr([ax.logoutUser],{mutationFn:()=>fx.logout(),...e||{},onSuccess:(...r)=>{var o;a(!1),s(),n(),t.removeQueries(),null==(o=null==e?void 0:e.onSuccess)||o.call(e,...r)}})})({onSuccess:e=>{g({token:void 0,isAuthenticated:!1,user:void 0,redirect:e.redirect??"/login"})},onError:e=>{x(e.message),g({token:void 0,isAuthenticated:!1,user:void 0,redirect:"/login"})}}),_=(e=>{const t=pr();return fr([ax.refreshToken],{mutationFn:()=>px.refreshToken(),onMutate:e=>{t.removeQueries()}})})(),y=n.useCallback((e=>{e&&(m.current=e),b.mutate(void 0)}),[b]),j=Sy({enabled:!!o}),w=e=>{v.mutate(e)},N=n.useCallback((()=>{!0!==(null==e?void 0:e.test)?_.mutate(void 0,{onSuccess:t=>{const{user:n,token:s=""}=t??{};if(s)g({token:s,isAuthenticated:!0,user:n});else{if(console.log("Token is not present. User is not authenticated."),!0===(null==e?void 0:e.test))return;h("/login")}},onError:t=>{console.log("refreshToken mutation error:",t),!0!==(null==e?void 0:e.test)&&h("/login")}}):console.log("Test mode. Skipping silent refresh.")}),[]);n.useEffect((()=>{j.data?r(j.data):j.isError&&(x(j.error.message),h("/login",{replace:!0})),null!=l&&l&&d&&x(void 0),null!=o&&o&&d||N()}),[o,d,j.data,j.isError,j.error,l,r,h,N,g]),n.useEffect((()=>{const e=e=>{console.log("tokenUpdated event received event");const t=e.detail;g({token:t,isAuthenticated:!0,user:a})};return window.addEventListener("tokenUpdated",e),()=>{window.removeEventListener("tokenUpdated",e)}}),[g,a]);const C=n.useMemo((()=>({user:a,token:o,error:l,login:w,logout:y,setError:c,roles:{[Pg.USER]:p,[Pg.ADMIN]:f},isAuthenticated:d})),[a,l,d,o,p,f]);return s.jsx(Kk.Provider,{value:C,children:t})},qk=()=>{const e=n.useContext(Kk);if(void 0===e)throw new Error("useAuthContext should be used inside AuthProvider");return e},Qk=({permissionType:e,permission:t})=>{const s=n.useContext(Kk),a=null==s?void 0:s.user,r=null==s?void 0:s.roles,o=(null==s?void 0:s.isAuthenticated)||!1,i=n.useCallback((({user:e,permissionType:t,permission:n})=>{var a,i,l;return!!s&&(!!(o&&null!=(null==e?void 0:e.role)&&r&&r[e.role])&&!0===(null==(l=null==(i=null==(a=r[e.role])?void 0:a.permissions)?void 0:i[t])?void 0:l[n]))}),[s,o,r]);return n.useMemo((()=>i({user:a,permissionType:e,permission:t})),[a,e,t,i])},Yk=()=>Qk({permissionType:Zh.MARKETPLACE,permission:Jh.USE})?Yg.EDIT:Yg.VIEW;n.createContext({}),n.createContext({});const Xk=n.createContext(void 0);function Zk({children:e,defaultActive:t}){const[a,r]=n.useState(t);return s.jsx(Xk.Provider,{value:{active:a,setActive:e=>{localStorage.setItem("side:active-panel",e),r(e)}},children:e})}const Jk=n.createContext(void 0);function eS(){const e=n.useContext(Jk);if(void 0===e)throw new Error("useAgentPanelContext must be used within an AgentPanelProvider");return e}function tS({children:e}){const t=Uk(),[a,r]=n.useState(void 0),[o,i]=n.useState(void 0),[l,c]=n.useState(void 0),[d,u]=n.useState(bv.builder),[m,p]=n.useState(void 0),{data:f}=Wy(),{data:h}=vj(Nu.agents,{enabled:!pv(m)}),{data:g}=gj(Nu.agents,{enabled:!pv(m)}),{data:x}=Uj({enabled:!pv(m)&&null!=(null==f?void 0:f.mcpServers)}),{agentsConfig:v,endpointsConfig:b}=Gk(),_=n.useMemo((()=>Object.keys((null==f?void 0:f.mcpServers)??{})),[f]),{connectionStatus:y}=HT({enabled:!pv(m)&&_.length>0}),j=n.useMemo((()=>{var e,n;const s=new Set(_),a=new Map;if(null==x?void 0:x.servers)for(const[r,o]of Object.entries(x.servers)){const n={name:r,pluginKey:r,description:`${t("com_ui_tool_collection_prefix")} ${r}`,icon:o.icon||"",authConfig:o.authConfig,authenticated:o.authenticated},i=o.tools.map((e=>({tool_id:e.pluginKey,metadata:{...e,icon:o.icon,authConfig:o.authConfig,authenticated:o.authenticated}})));a.set(r,{serverName:r,tools:i,isConfigured:s.has(r),isConnected:"connected"===(null==(e=null==y?void 0:y[r])?void 0:e.connectionState),metadata:n})}for(const r of _){if(a.has(r))continue;const e={icon:"",name:r,pluginKey:r,description:`${t("com_ui_tool_collection_prefix")} ${r}`};a.set(r,{tools:[],metadata:e,isConfigured:!0,serverName:r,isConnected:"connected"===(null==(n=null==y?void 0:y[r])?void 0:n.connectionState)})}return a}),[x,t,_,y]),w={mcp:a,mcps:o,action:l,setMcp:r,actions:h,setMcps:i,agent_id:m,setAction:c,activePanel:d,regularTools:g,agentsConfig:v,startupConfig:f,mcpServersMap:j,setActivePanel:u,endpointsConfig:b,setCurrentAgentId:p};return s.jsx(Jk.Provider,{value:w,children:e})}const nS=n.createContext({}),sS=n.createContext({}),aS=()=>n.useContext(sS),rS=n.createContext({}),oS=()=>n.useContext(rS),iS=n.createContext(void 0);function lS({children:e}){const[t,a]=n.useState(!1),[r,o]=n.useState();return s.jsx(iS.Provider,{value:{isMutating:t,setIsMutating:a,currentCode:r,setCurrentCode:o},children:e})}function cS(){const e=n.useContext(iS);if(void 0===e)throw new Error("useEditorContext must be used within an EditorProvider");return e}const{CustomFormProvider:dS,useCustomFormContext:uS}=function(){const e=n.createContext(void 0);return{CustomFormProvider:({register:t,control:a,setValue:r,getValues:o,handleSubmit:i,reset:l,children:c})=>{const d=n.useMemo((()=>({register:t,control:a,getValues:o,setValue:r,handleSubmit:i,reset:l})),[t,a,r,o,i,l]);return s.jsx(e.Provider,{value:d,children:c})},useCustomFormContext:()=>{const t=n.useContext(e);if(!t)throw new Error("useCustomFormContext must be used within a CustomFormProvider");return t}}}(),mS=n.createContext({bookmarks:[]}),pS=()=>n.useContext(mS),fS=n.createContext({}),hS=()=>n.useContext(fS),gS=n.createContext({}),xS=()=>n.useContext(gS),vS=n.createContext({}),bS=()=>n.useContext(vS),_S={announceAssertive:()=>console.warn("Announcement failed, LiveAnnouncer context is missing"),announcePolite:()=>console.warn("Announcement failed, LiveAnnouncer context is missing")},yS=S.createContext(_S),jS=()=>S.useContext(yS),wS=n.createContext({});function NS({children:e}){const t=n.useRef(0),a=n.useCallback((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),r=n.useCallback((()=>{t.current=0}),[]);return s.jsx(wS.Provider,{value:{getNextIndex:a,resetCounter:r},children:e})}const CS=n.createContext({});function kS({children:e}){const t=n.useRef(0),a=n.useCallback((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),r=n.useCallback((()=>{t.current=0}),[]);return s.jsx(CS.Provider,{value:{getNextIndex:a,resetCounter:r},children:e})}const SS=n.createContext({});function TS({children:e,conversationId:t}){const a=function({conversationId:e}){const{data:t=null}=lj({conversationId:e},{select:e=>function(e=[]){return e.reduce(((e,t)=>{const n=`${t.messageId}_${t.partIndex??0}_${t.blockIndex??0}_${t.toolId}`,s=e[n]??[];return s.push(t),e[n]=s,e}),{})}(e)}),s=n.useMemo((()=>null!==t?t:void 0),[t]);return a_.log("tools","tool calls map:",s),s}({conversationId:t});return s.jsx(SS.Provider,{value:a,children:e})}const ES=n.createContext({}),RS=()=>n.useContext(ES),IS=n.createContext(void 0);function PS(){const e=n.useContext(IS);if(void 0===e)throw new Error("useBadgeRowContext must be used within a BadgeRowProvider");return e}function AS({children:e,isSubmitting:t,conversationId:a}){const r=n.useRef(""),o=n.useRef(!1),{agentsConfig:i}=Gk(),l=a??dh.NEW_CONVO,c=Pe(jy(l));n.useEffect((()=>{if(!(t||o.current&&r.current===l)){o.current=!0,r.current=l;const e=`${uh.LAST_CODE_TOGGLE_}${l}`,t=`${uh.LAST_WEB_SEARCH_TOGGLE_}${l}`,n=`${uh.LAST_FILE_SEARCH_TOGGLE_}${l}`,s=`${uh.LAST_ARTIFACTS_TOGGLE_}${l}`,a=n_(e),i=n_(t),d=n_(n),u=n_(s),m={};if(null!==a)try{m[Jd.execute_code]=JSON.parse(a)}catch(Fi){console.error("Failed to parse code toggle value:",Fi)}if(null!==i)try{m[Jd.web_search]=JSON.parse(i)}catch(Fi){console.error("Failed to parse web search toggle value:",Fi)}if(null!==d)try{m[Jd.file_search]=JSON.parse(d)}catch(Fi){console.error("Failed to parse file search toggle value:",Fi)}if(null!==u)try{m[ef.artifacts]=JSON.parse(u)}catch(Fi){console.error("Failed to parse artifacts toggle value:",Fi)}const p={[Jd.execute_code]:m[Jd.execute_code]??!1,[Jd.web_search]:m[Jd.web_search]??!1,[Jd.file_search]:m[Jd.file_search]??!1,[ef.artifacts]:m[ef.artifacts]??!1};c((e=>({...e||{},...p}))),Object.entries(p).forEach((([a,r])=>{if(!1!==r){let o=s;a===Jd.execute_code?o=e:a===Jd.web_search?o=t:a===Jd.file_search&&(o=n),localStorage.setItem(o,JSON.stringify(r)),t_(o)}}))}}),[l,t,c]);const d=uE({}),{setIsDialogOpen:u}=d,m=cE({conversationId:a,setIsDialogOpen:u,toolKey:Jd.execute_code,localStorageKey:uh.LAST_CODE_TOGGLE_,authConfig:{toolId:Jd.execute_code,queryOptions:{retry:1}}}),p=pE({}),{setIsDialogOpen:f}=p,h=cE({conversationId:a,toolKey:Jd.web_search,localStorageKey:uh.LAST_WEB_SEARCH_TOGGLE_,setIsDialogOpen:f,authConfig:{toolId:Jd.web_search,queryOptions:{retry:1}}}),g=cE({conversationId:a,toolKey:Jd.file_search,localStorageKey:uh.LAST_FILE_SEARCH_TOGGLE_,isAuthenticated:!0}),x={webSearch:h,artifacts:cE({conversationId:a,toolKey:ef.artifacts,localStorageKey:uh.LAST_ARTIFACTS_TOGGLE_,isAuthenticated:!0}),fileSearch:g,agentsConfig:i,conversationId:a,codeApiKeyForm:d,codeInterpreter:m,searchApiKeyForm:p,mcpServerManager:GT({conversationId:a})};return s.jsx(IS.Provider,{value:x,children:e})}const MS=n.createContext(void 0);function LS({children:e}){const{conversation:t}=Mk(),a=n.useMemo((()=>({endpoint:null==t?void 0:t.endpoint})),[null==t?void 0:t.endpoint]);return s.jsx(MS.Provider,{value:a,children:e})}const OS=n.createContext(void 0);function DS({children:e}){const{conversation:t}=Mk(),a=n.useMemo((()=>({conversationId:null==t?void 0:t.conversationId,agentId:null==t?void 0:t.agent_id})),[null==t?void 0:t.conversationId,null==t?void 0:t.agent_id]);return s.jsx(OS.Provider,{value:a,children:e})}const FS=n.createContext(void 0);function zS({children:e}){const{conversation:t}=Mk(),a=n.useMemo((()=>({conversationId:(null==t?void 0:t.conversationId)??dh.NEW_CONVO})),[null==t?void 0:t.conversationId]);return s.jsx(FS.Provider,{value:a,children:e})}const US=n.createContext(void 0);function VS({children:e}){const{isSubmitting:t,latestMessage:a,conversation:r}=Mk(),o=n.useMemo((()=>bb({messageId:(null==a?void 0:a.messageId)??null,text:(null==a?void 0:a.text)??null,content:(null==a?void 0:a.content)??null})),[null==a?void 0:a.messageId,null==a?void 0:a.text,null==a?void 0:a.content]),i=n.useMemo((()=>({isSubmitting:t,latestMessageText:o,latestMessageId:(null==a?void 0:a.messageId)??null,conversationId:(null==r?void 0:r.conversationId)??null})),[t,null==a?void 0:a.messageId,o,null==r?void 0:r.conversationId]);return s.jsx(US.Provider,{value:i,children:e})}function BS(){const e=n.useContext(US);if(!e)throw new Error("useArtifactsContext must be used within ArtifactsProvider");return e}const $S={misc:He,roleplay:Ye,write:Qe,idea:qe,shop:We,finance:Ue,code:Ve,travel:Ke,teach_or_explain:Ge,general:He,hr:$e,rd:Be,it:Ve,sales:Ue,aftersales:ze},HS={code:"text-red-500",misc:"text-blue-300",shop:"text-purple-400",idea:"text-yellow-500/90 dark:text-yellow-300 ",write:"text-purple-400",travel:"text-yellow-500/90 dark:text-yellow-300 ",finance:"text-orange-400",roleplay:"text-orange-400",teach_or_explain:"text-blue-300",general:"text-blue-500",hr:"text-green-500",rd:"text-purple-500",it:"text-red-500",sales:"text-orange-500",aftersales:"text-yellow-500"};function GS({category:e,className:t=""}){const n=$S[e],a=HS[e]+" "+t;return n?s.jsx(n,{className:s_(a,t),"aria-hidden":"true"}):null}const KS=n.createContext(null),WS=({children:e})=>{const t=Qk({permissionType:Zh.PROMPTS,permission:Jh.USE}),a=function(e=!0){var t,s,a;const[r]=Ie(Cy.promptsPageSize),[o]=Ie(Cy.promptsCategory),[i,l]=Ie(Cy.promptsName),[c,d]=n.useState(0),u=n.useRef([null]),m=n.useRef({name:i,category:o}),p=((e,t)=>{const{name:n,pageSize:s,category:a}=e||{};return hr([ex.promptGroups,n,a,s],(({pageParam:e})=>{const t={name:n,category:a||"",limit:(s||10).toString()};return e&&"string"==typeof e&&(t.cursor=e),fx.getPromptGroups(t)}),{getNextPageParam:e=>e.has_more&&e.after?e.after:void 0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})({name:i,pageSize:r,category:o},{enabled:e}),f=n.useMemo((()=>{var t;if(!e||!(null==(t=p.data)?void 0:t.pages)||0===p.data.pages.length)return null;const n=Math.min(c,p.data.pages.length-1);return p.data.pages[n]}),[e,null==(t=p.data)?void 0:t.pages,c]),h=n.useMemo((()=>(null==f?void 0:f.promptGroups)||[]),[f]),g=n.useMemo((()=>{var e,t;return!!f&&(c<((null==(t=null==(e=p.data)?void 0:e.pages)?void 0:t.length)||0)-1||(f.has_more||!1))}),[f,c,null==(a=null==(s=p.data)?void 0:s.pages)?void 0:a.length]),x=c>0,v=c+1,b=g?v+1:v,_=n.useCallback((async()=>{var t,n,s;if(!e||!g)return;const a=c+1;if(a>=((null==(n=null==(t=p.data)?void 0:t.pages)?void 0:n.length)||0)){const e=await p.fetchNextPage();if(e.isSuccess&&(null==(s=e.data)?void 0:s.pages)){const t=e.data.pages[e.data.pages.length-2];(null==t?void 0:t.after)&&!u.current.includes(t.after)&&u.current.push(t.after)}}d(a)}),[e,c,g,p]),y=n.useCallback((()=>{e&&x&&d(c-1)}),[e,c,x]);return n.useEffect((()=>{if(!e)return;(m.current.name!==i||m.current.category!==o)&&(d(0),u.current=[null],m.current={name:i,category:o})}),[e,i,o]),{promptGroups:e?h:[],groupsQuery:p,currentPage:v,totalPages:b,hasNextPage:e&&g,hasPreviousPage:e&&x,nextPage:_,prevPage:y,isFetching:!!e&&p.isFetching,name:i,setName:l}}(t),{data:r,isLoading:o}=(i={enabled:t,select:e=>{const t=e.map((e=>{var t,n;return{id:e._id??"",type:"prompt",value:e.command??e.name,label:`${null!=e.command&&e.command?`/${e.command} - `:""}${e.name}: ${((null==(t=e.oneliner)?void 0:t.length)??0)>0?e.oneliner:(null==(n=e.productionPrompt)?void 0:n.prompt)??""}`,icon:s.jsx(GS,{category:e.category??"",className:"h-5 w-5"})}}));return{promptsMap:e.reduce(((e,t)=>t._id?(e[t._id]=t,e):e),{}),promptGroups:t}}},mr([ex.allPromptGroups],(()=>fx.getAllPromptGroups()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...i}));var i;const l=n.useMemo((()=>({...a,allPromptGroups:{data:t?r:void 0,isLoading:!!t&&o},hasAccess:t})),[a,r,o,t]);return s.jsx(KS.Provider,{value:l,children:e})},qS=()=>{const e=n.useContext(KS);if(!e)throw new Error("usePromptGroupsContext must be used within a PromptGroupsProvider");return e},QS=n.createContext(void 0);function YS({children:e}){const t=Mk(),a=oS(),{ask:r,index:o,regenerate:i,isSubmitting:l,conversation:c,latestMessage:d,setAbortScroll:u,handleContinue:m,setLatestMessage:p,abortScroll:f,getMessages:h,setMessages:g}=t,{isSubmitting:x}=a,v=n.useMemo((()=>({conversation:c,conversationId:null==c?void 0:c.conversationId})),[c]),b=n.useMemo((()=>({isSubmitting:l,isSubmittingFamily:l||x,abortScroll:f,setAbortScroll:u})),[l,x,f,u]),_=n.useMemo((()=>({ask:r,regenerate:i,getMessages:h,setMessages:g,handleContinue:m})),[r,i,m,h,g]),y=n.useMemo((()=>({index:o,latestMessage:d,setLatestMessage:p})),[o,d,p]),j=n.useMemo((()=>({...v,...b,..._,...y})),[v,b,_,y]);return s.jsx(QS.Provider,{value:j,children:e})}function XS(){const e=n.useContext(QS);if(!e)throw new Error("useMessagesViewContext must be used within MessagesViewProvider");return e}function ZS(){const{conversation:e,conversationId:t}=XS();return n.useMemo((()=>({conversation:e,conversationId:t})),[e,t])}function JS(){const{ask:e,regenerate:t,handleContinue:s,getMessages:a,setMessages:r}=XS();return n.useMemo((()=>({ask:e,regenerate:t,handleContinue:s,getMessages:a,setMessages:r})),[e,t,s,a,r])}function eT(e,t){const s=zk(),a=n.useMemo((()=>null!=e&&""!==e?null==s?void 0:s[e]:void 0),[e,s]),{data:r}=Ay(e),o=n.useMemo((()=>(null==r?void 0:r.tools)||(null==a?void 0:a.tools)),[null==r?void 0:r.tools,null==a?void 0:a.tools]);return{fileSearchAllowedByAgent:n.useMemo((()=>pv(e)?(null==t?void 0:t[eu.file_search])??!1:!!a&&((null==o?void 0:o.includes(Jd.file_search))??!1)),[e,a,o,t]),codeAllowedByAgent:n.useMemo((()=>pv(e)?(null==t?void 0:t[eu.execute_code])??!1:!!a&&((null==o?void 0:o.includes(Jd.execute_code))??!1)),[e,a,o,t]),tools:o}}function tT(){return e=>localStorage.setItem(uh.FILES_TO_DELETE,JSON.stringify(e))}function nT(){const{data:e={}}=Ky();return n.useCallback((t=>{const{modelDisplayLabel:n}=(null==e?void 0:e[t.endpoint??""])??{};return Rh({...t,modelDisplayLabel:n})}),[e])}const sT=e=>{const{data:t}=Ky(),s=null==t?void 0:t[e??""],{azure:a}=s??{};let r=e;a?r=Nu.azureOpenAI:r===Nu.gptPlugins&&(r=Nu.openAI);const o=dk(),i=xk(r),l=n.useCallback((()=>{if(i.data)return i.data.expiresAt||"never"}),[i.data]),c=n.useCallback((()=>{const e=l();if(!e)return!0;return!(new Date(e)<new Date)}),[l]),d=n.useCallback(((e,t)=>{const n=t?new Date(t).toISOString():"";o.mutate({name:r,value:e,expiresAt:n})}),[o,r]);return n.useMemo((()=>({getExpiry:l,checkExpiry:c,saveUserKey:d})),[l,c,d])},aT=e=>{a_.log("=====================================\nAsk function called with:"),a_.dir(e),a_.log("=====================================")};function rT({index:e=0,files:t,setFiles:n,getMessages:s,setMessages:a,isSubmitting:r,latestMessage:o,setSubmission:i,setLatestMessage:l,conversation:c}){const d=Fe(),u=nT(),{user:m}=qk(),p=pr(),f=tT(),h=Re((({snapshot:e})=>t=>(a_.log("agents",`[useGetEphemeralAgent] Getting loadable for ID: ${t}`),e.getLoadable(jy(t)).contents)),[]),g=Ae(Cy.isTemporary),{getExpiry:x}=sT((null==c?void 0:c.endpoint)??""),v=Pe(Cy.showStopButtonByIndex(e)),b=Oe(Cy.latestMessageFamily(e+1)),_=({text:_,overrideConvoId:y,overrideUserMessageId:j,parentMessageId:w=null,conversationId:N=null,messageId:C=null},{editedContent:k=null,editedMessageId:S=null,isRegenerate:T=!1,isContinued:E=!1,isEdited:R=!1,overrideMessages:I,overrideFiles:P}={})=>{var A;if(v(!1),b(),r||""===_)return;const M=So.cloneDeep(c),L=null==M?void 0:M.endpoint;if(null===L)return void console.error("No endpoint available");if("search"==(N=N??(null==M?void 0:M.conversationId)??null))return void console.error("cannot send any message under search view!");if(E&&!o)return void console.error("cannot continue AI message without latestMessage!");const O=h(N??dh.NEW_CONVO),D=R||E;let F=I??s()??[];(null==M?void 0:M.promptPrefix)&&(M.promptPrefix=Mh({text:M.promptPrefix,user:m})),_=_.trim();const z=j??Xe();w=w??(null==o?void 0:o.messageId)??dh.NO_PARENT,aT({index:e,conversation:M,latestMessage:o,conversationId:N,intermediateId:z,parentMessageId:w,currentMessages:F}),N==dh.NEW_CONVO&&(w=dh.NO_PARENT,F=[],N=null,d("/c/new",{state:{focusChat:!0}}));const U=T?C:null==o?void 0:o.parentMessageId,V=F.find((e=>e.messageId===U));let B=(null==V?void 0:V.thread_id)??(null==o?void 0:o.thread_id);null==B&&(B=null==(A=F.find((e=>e.thread_id)))?void 0:A.thread_id);const $=p.getQueryData([ex.endpoints]),H=Sb($,L,"type"),G=Ph({endpoint:L,endpointType:H,conversation:M??{}}),{modelDisplayLabel:K}=(null==$?void 0:$[L??""])??{},W=Object.assign({endpoint:L,endpointType:H,overrideConvoId:y,overrideUserMessageId:j},G);L!==Nu.agents?(W.key=x(),W.thread_id=B,W.modelDisplayLabel=K):W.key=new Date(Date.now()+36e5).toISOString();const q=u({model:null==M?void 0:M.model,...W}),Q={text:_,sender:"User",clientTimestamp:(new Date).toLocaleString("sv").replace(" ","T"),isCreatedByUser:!0,parentMessageId:w,conversationId:N,messageId:E&&null!=C&&C?C:z,thread_id:B,error:!1},Y=P??(null==V?void 0:V.files),X=(T||null!=P&&P.length)&&Y&&Y.length>0;n&&!0===X?(Q.files=[...Y],n(new Map),f({})):n&&t&&t.size>0&&(Q.files=Array.from(t.values()).map((e=>({file_id:e.file_id,filepath:e.filepath,type:e.type??"",height:e.height,width:e.width}))),n(new Map),f({}));const Z=S??((null==o?void 0:o.messageId)&&T?o.messageId.replace(/_+$/,"")+"_":null)??null,J={sender:q,text:"",endpoint:L??"",parentMessageId:T?C:z,messageId:Z??`${T?C:z}`.replace(/_+$/,"")+"_",thread_id:B,conversationId:N,unfinished:!1,isCreatedByUser:!1,iconURL:null==G?void 0:G.iconURL,model:null==G?void 0:G.model,error:!1};if(Mu(L))J.model=(null==M?void 0:M.assistant_id)??"",J.text="",J.content=[{type:hh.TEXT,[hh.TEXT]:{value:""}}];else if(null!=L){if(J.model=Lu(L)?(null==M?void 0:M.agent_id)??"":(null==M?void 0:M.model)??"",J.text="",k&&(null==o?void 0:o.content)){J.content=So.cloneDeep(o.content);const{index:e,type:t,...n}=k;if(J.content&&e>=0&&e<J.content.length){const s=J.content[e];t===hh.THINK&&s.type===hh.THINK?s[hh.THINK]=n[hh.THINK]:t===hh.TEXT&&s.type===hh.TEXT&&(s[hh.TEXT]=n[hh.TEXT])}}else J.content=[{type:hh.TEXT,[hh.TEXT]:{value:""}}];v(!0)}E&&(F=F.filter((e=>e.messageId!==Z))),a_.log("message_state",J);const ee={conversation:{...M,conversationId:N},endpointOption:W,userMessage:{...Q,responseMessageId:Z,overrideParentMessageId:T?C:null},messages:F,isEdited:D,isContinued:E,isRegenerate:T,initialResponse:J,isTemporary:g,ephemeralAgent:O,editedContent:k};a(T?[...ee.messages,J]:[...ee.messages,Q,J]),0===e&&l&&l(J),i(ee),a_.dir("message_stream",ee,{depth:null})};return{ask:_,regenerate:({parentMessageId:e})=>{const t=s(),n=null==t?void 0:t.find((t=>t.messageId==e));n&&n.isCreatedByUser?_({...n},{isRegenerate:!0}):console.error("Failed to regenerate the message: parentMessage not found or not created by user.")}}}const oT=[];function iT(){const e=Uk(),t=Ae(Cy.chatBadges),s=n.useMemo((()=>new Set(t.map((e=>e.id)))),[t]);return n.useMemo((()=>oT.map((t=>({id:t.id,label:e(t.label),icon:t.icon,atom:t.atom,isAvailable:s.has(t.id)})))||[]),[s,e])}const lT=(e=0)=>{const t=Fe(),[s]=Ps(),{data:a}=Wy(),r=Cy.useClearConvoState(),o=Ae(Cy.defaultPreset),{setConversation:i}=Cy.useCreateConversationAtom(e),[l,c]=Ie(Cy.filesByIndex(e)),d=Ae(Cy.saveBadgesState),u=Cy.useClearLatestMessages(`useNewConvo ${e}`),m=Pe(Cy.submissionByIndex(e)),{data:p={}}=Ky(),f=fk(),h=Ok(),{pauseGlobalAudio:g}=ky(e),x=Ae(Cy.saveDrafts),v=Re((({reset:e})=>()=>{oT.forEach((({atom:t})=>e(t))),e(Cy.chatBadges)}),[]),{mutateAsync:b}=qy({onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),_=Re((()=>async(n,a=null,l,c,d,g,x,v)=>{var b,_,y;const j=l??f.data,{endpoint:w=null}=n,N=(null===w||c)??!1,C=!o||a||o.endpoint!==w&&w||!N?a:o,k=v??(null!=(null==C?void 0:C.presetId)&&C.presetId&&C.presetId===(null==o?void 0:o.presetId));if(N){let t=c_({convoSetup:C??n,endpointsConfig:p});t||(t=Object.keys(p??{})[0]);const s=Sb(p,t,"type");!n.endpointType&&s?n.endpointType=s:n.endpointType&&!s&&(n.endpointType=void 0);const a=Mu(t),r=h[t]??[],o=n.assistant_id??"",i=null==(b=h[t])?void 0:b[o];if(o&&!i&&(n.assistant_id=void 0),!o&&a&&(n.assistant_id=localStorage.getItem(`${uh.ASST_ID_PREFIX}${e}${t}`)??(null==(_=r[0])?void 0:_.id)),o&&a&&n.conversationId===dh.NEW_CONVO){const e=r.find((e=>e.id===o));n.model=null==e?void 0:e.model,function({endpoint:e,model:t=""}){if(!t)return;const n=JSON.parse((localStorage.getItem(Eb)??"{}")||"{}");n.endpoint===e&&(n.model=t,localStorage.setItem(Eb,JSON.stringify(n)));const s=JSON.parse((localStorage.getItem(uh.LAST_MODEL)??"{}")||"{}");s[e]=t,localStorage.setItem(uh.LAST_MODEL,JSON.stringify(s))}({endpoint:t,model:n.model})}o&&!a&&(n.assistant_id=void 0);const l=(null==j?void 0:j[t])??[];n=l_({conversation:n,lastConversationSetup:C,endpoint:t,models:l})}!0===k&&(n.disableParams=!0),g||r(!0);const S=null==(y=n.conversationId)?void 0:y.startsWith("_");if(S?(a_.log("conversation","Cancelled conversation, setting to `new` in `useNewConvo`",n),i({...n,conversationId:dh.NEW_CONVO})):(a_.log("conversation","Setting conversation from `useNewConvo`",n),i(n)),m({}),d||u(),S)return;const T=null==s?void 0:s.toString(),E=()=>T?`?${T}`:"";if(n.conversationId===dh.NEW_CONVO&&!l){const e=localStorage.getItem(uh.APP_TITLE)??"";e&&(document.title=e);const n=`/c/${dh.NEW_CONVO}${E()}`;return void t(n,{state:{focusChat:!0}})}const R=`/c/${n.conversationId}${E()}`;t(R,{replace:!0,state:x?{}:{focusChat:!0}})}),[p,o,h,f.data]),y=n.useCallback((function({template:e={},preset:t,modelsData:n,disableFocus:s,buildDefault:r=!0,keepLatestMessage:o=!1,keepAddedConvos:i=!1,disableParams:u}={}){var m,p;g(),d||v();const f=e.conversationId??"",h=!0===(!0===Ou(e.endpoint??"",e.endpointType??"")||Ou((null==t?void 0:t.endpoint)??"",(null==t?void 0:t.endpointType)??""))&&f&&f===dh.NEW_CONVO?{endpoint:e.endpoint}:e,y={conversationId:dh.NEW_CONVO,title:"New Chat",endpoint:null,...h,createdAt:"",updatedAt:""};let j=t;const w=Ib(a);if(j||!a||!0!==(null==(m=a.modelSpecs)?void 0:m.prioritize)&&!0===((null==(p=a.interface)?void 0:p.modelSelect)??!0)||!w||(j=Pb(w)),"new"===y.conversationId&&!n){const e=Array.from(l.values()).filter((e=>null!=e.filepath&&""!==e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,embedded:!!e.embedded,filepath:e.filepath,source:e.source})));c(new Map),localStorage.setItem(uh.FILES_TO_DELETE,JSON.stringify({})),!x&&e.length>0&&b({files:e})}_(y,j,n,r,o,i,s,u)}),[l,c,x,b,v,a,d,g,_]);return{switchToConversation:_,newConversation:y}};function cT(e=0,t){const s=Cy.useClearSubmissionState(),[a,r]=Ie(Cy.filesByIndex(e)),[o,i]=n.useState(!1),l=pr(),{isAuthenticated:c}=qk(),{newConversation:d}=lT(e),{useCreateConversationAtom:u}=Cy,{conversation:m,setConversation:p}=u(e),{conversationId:f}=m??{},h="new"===t?t:f??t??"",{data:g}=aj(f??"",{enabled:c}),x=Oe(Cy.latestMessageFamily(e)),[v,b]=Ie(Cy.isSubmittingFamily(e)),[_,y]=Ie(Cy.latestMessageFamily(e)),j=Pe(Cy.messagesSiblingIdxFamily((null==_?void 0:_.parentMessageId)??null)),w=n.useCallback((e=>{l.setQueryData([ex.messages,h],e),"new"===h&&f&&"new"!==f&&l.setQueryData([ex.messages,f],e)}),[h,l,f]),N=n.useCallback((()=>l.getQueryData([ex.messages,h])),[h,l]),C=Pe(Cy.submissionByIndex(e)),{ask:k,regenerate:S}=rT({index:e,files:a,setFiles:r,getMessages:N,setMessages:w,isSubmitting:v,conversation:m,latestMessage:_,setSubmission:C,setLatestMessage:y}),T=()=>s(),[E,R]=Ie(Cy.showPopoverFamily(e)),[I,P]=Ie(Cy.abortScrollFamily(e)),[A,M]=Ie(Cy.presetByIndex(e)),[L,O]=Ie(Cy.optionSettingsFamily(e)),[D,F]=Ie(Cy.showAgentSettingsFamily(e));return{newConversation:d,conversation:m,setConversation:p,isSubmitting:v,setIsSubmitting:b,getMessages:N,setMessages:w,setSiblingIdx:j,latestMessage:_,setLatestMessage:y,resetLatestMessage:x,ask:k,index:e,regenerate:S,stopGenerating:T,handleStopGenerating:e=>{e.preventDefault(),T()},handleRegenerate:e=>{e.preventDefault();const t=(null==_?void 0:_.parentMessageId)??"";t?S({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleContinue:e=>{e.preventDefault(),(()=>{if(!_)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=N(),t=null==e?void 0:e.find((e=>e.messageId==_.parentMessageId));t&&t.isCreatedByUser?k({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),j(0)},showPopover:E,setShowPopover:R,abortScroll:I,setAbortScroll:P,preset:A,setPreset:M,optionSettings:L,setOptionSettings:O,showAgentSettings:D,setShowAgentSettings:F,files:a,setFiles:r,filesLoading:o,setFilesLoading:i}}function dT({rootIndex:e=0,currentIndex:t,paramId:s}){const a=pr(),r=Cy.useClearSubmissionState(),[o,i]=Ie(Cy.filesByIndex(e)),l=Ae(Cy.latestMessageFamily(e)),c=Pe(Cy.latestMessageFamily(t)),{useCreateConversationAtom:d}=Cy,{conversation:u,setConversation:m}=d(t),[p,f]=Ie(Cy.isSubmittingFamily(t)),h=Pe(Cy.messagesSiblingIdxFamily((null==l?void 0:l.parentMessageId)??null)),g="new"===s?s:(null==u?void 0:u.conversationId)??s??"",x=n.useCallback((e=>{a.setQueryData([ex.messages,g,t],e);const n=e[e.length-1];n&&c({...n,depth:-1})}),[g,a,t,c]),v=n.useCallback((()=>a.getQueryData([ex.messages,g,t])),[g,a,t]),b=Pe(Cy.submissionByIndex(t)),{ask:_,regenerate:y}=rT({index:t,files:o,setFiles:i,getMessages:v,setMessages:x,isSubmitting:p,conversation:u,setSubmission:b,latestMessage:l}),j=()=>r();return{ask:_,regenerate:y,getMessages:v,setMessages:x,conversation:u,isSubmitting:p,setSiblingIdx:h,latestMessage:l,stopGenerating:j,handleContinue:e=>{e.preventDefault(),(()=>{if(!l)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=v(),t=null==e?void 0:e.find((e=>e.messageId==l.parentMessageId));t&&t.isCreatedByUser?_({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),h(0)},setConversation:m,setIsSubmitting:f,handleRegenerate:e=>{e.preventDefault();const t=null==l?void 0:l.parentMessageId;t?y({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleStopGenerating:e=>{e.preventDefault(),j()}}}const uT=({index:e=0,rootIndex:t,setConversation:s})=>{const a=fk(),r=Ok(),{data:o={}}=Ky(),i=n.useRef(),l=Ae(Cy.conversationByKeySelector(t));n.useEffect((()=>{null!=(null==l?void 0:l.conversationId)&&s&&s((e=>{if(!e)return e;const t={...e,conversationId:l.conversationId};return a_.log("conversation","Setting conversation from `useNewConvo`",t),t}))}),[null==l?void 0:l.conversationId,s]);return{generateConversation:n.useCallback((({template:t={},preset:n,modelsData:c}={})=>{var d,u;let m={conversationId:"new",title:"New Chat",endpoint:null,...t,createdAt:"",updatedAt:""};(null==l?void 0:l.conversationId)&&(m.conversationId=l.conversationId);const p=c??a.data,f=c_({convoSetup:n??m,endpointsConfig:o}),h=Sb(o,f,"type");!m.endpointType&&h?m.endpointType=h:m.endpointType&&!h&&(m.endpointType=void 0);const g=Mu(f),x=r[f??""]??[];if(m.assistant_id&&!(null==(d=r[f??""])?void 0:d[m.assistant_id])&&(m.assistant_id=void 0),!m.assistant_id&&g&&(m.assistant_id=localStorage.getItem(`${uh.ASST_ID_PREFIX}${e}${f}`)??(null==(u=x[0])?void 0:u.id)),null!=m.assistant_id&&g&&"new"===m.conversationId){const e=x.find((e=>e.id===m.assistant_id));m.model=null==e?void 0:e.model}null==m.assistant_id||g||(m.assistant_id=void 0);const v=(null==p?void 0:p[f??""])??[];return m=l_({conversation:m,lastConversationSetup:n,endpoint:f??"",models:v}),null!=(null==n?void 0:n.title)&&""!==n.title&&(m.title=n.title),s&&s(m),clearTimeout(i.current),i.current=setTimeout((()=>{const e=document.getElementById(gv);e&&e.focus()}),150),m}),[r,o,e,a.data,l,s])}};const mT={name:"Plugin store",pluginKey:"pluginStore",isButton:!0,description:"",icon:"",authConfig:[],authenticated:!1};function pT({startupConfig:e,user:t}){var s;const a=Pe(Cy.availableTools),[r,o]=Ie(Cy.defaultPreset),{data:i}=_k({enabled:!!(null==t?void 0:t.plugins),select:Sv});!function(e){const{data:t}=Nk({enabled:e}),s=n.useRef({conversationMode:Pe(Cy.conversationMode),advancedMode:Pe(Cy.advancedMode),speechToText:Pe(Cy.speechToText),textToSpeech:Pe(Cy.textToSpeech),cacheTTS:Pe(Cy.cacheTTS),engineSTT:Pe(Cy.engineSTT),languageSTT:Pe(Cy.languageSTT),autoTranscribeAudio:Pe(Cy.autoTranscribeAudio),decibelValue:Pe(Cy.decibelValue),autoSendText:Pe(Cy.autoSendText),engineTTS:Pe(Cy.engineTTS),voice:Pe(Cy.voice),cloudBrowserVoices:Pe(Cy.cloudBrowserVoices),languageTTS:Pe(Cy.languageTTS),automaticPlayback:Pe(Cy.automaticPlayback),playbackRate:Pe(Cy.playbackRate)}).current;n.useEffect((()=>{e&&t&&"not_found"!==t.message&&(a_.log("Initializing speech settings from config:",t),Object.entries(t).forEach((([e,t])=>{if("sttExternal"===e||"ttsExternal"===e)return;if(null!==localStorage.getItem(e))return;const n=s[e];n&&(a_.log(`Setting default speech setting: ${e} = ${t}`),n(t))})))}),[e,t,s])}(!!t),Uj({enabled:!!(null==e?void 0:e.mcpServers)&&!!t}),n.useEffect((()=>{!function(){try{const e=[],t=Date.now();for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s&&(s!==uh.PIN_MCP_&&e_.some((e=>s.startsWith(e)&&!s.includes("pinned")))&&!s.endsWith(Zb))){const n=`${s}${Zb}`,a=localStorage.getItem(n);if(!a){e.push(s);continue}t-parseInt(a,10)>Jb&&(e.push(s),e.push(n))}}e.forEach((e=>localStorage.removeItem(e))),e.length>0&&console.log(`Cleaned up ${e.length} old localStorage entries`)}catch(e){console.error("Error during cleanup of timestamped storage:",e)}}()}),[]),n.useEffect((()=>{const t=(null==e?void 0:e.appTitle)??"";t&&(document.title=t,localStorage.setItem(uh.APP_TITLE,t))}),[e]),n.useEffect((()=>{var t;if(r&&null!=r.spec)return;const n=null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list;if(!n||!n.length)return;const s=n.find((e=>e.default));s&&o({...s.preset,iconURL:s.iconURL,spec:s.name})}),[r,o,null==(s=null==e?void 0:e.modelSpecs)?void 0:s.list]),n.useEffect((()=>{if(!t)return;if(!i)return;const e=t.plugins??[];if(0===e.length)return void a({pluginStore:mT});const n=[...e].map((e=>i.map[e])).filter((e=>void 0!==e)),s=localStorage.getItem(uh.LAST_TOOLS)??"";if(!s)return a({pluginStore:mT,...kv(n)});const r=Tv(JSON.parse(s)??[],i.map).filter((e=>n.some((t=>t.pluginKey===e.pluginKey)))).filter((e=>!!e));localStorage.setItem(uh.LAST_TOOLS,JSON.stringify(r)),a({pluginStore:mT,...kv(n)})}),[i,t,a]),n.useEffect((()=>{if(null!=(null==e?void 0:e.analyticsGtmId)&&void 0===window.google_tag_manager){const t={gtmId:e.analyticsGtmId};Ze.initialize(t)}}),[null==e?void 0:e.analyticsGtmId])}function fT(){const e=Uk(),t=n.useRef(!1),s=pr(),{showToast:a}=$d(),{user:r,isAuthenticated:o}=qk(),i=Ae(Cy.modularChat),l=Ae(Cy.availableTools),c=Pe(Cy.presetModalVisible),[d,u]=Ie(Cy.defaultPreset),m=mj({enabled:!!r&&o}),{preset:p,conversation:f,index:h,setPreset:g}=Mk(),{data:x}=fk(),{newConversation:v}=lT(h);n.useEffect((()=>{if(null==x?void 0:x.initial)return;const{data:e}=m;if(d||!e||t.current)return;if(e&&e.length>0&&r&&e[0].user!==r.id)return void m.refetch();const n=e.find((e=>e.defaultPreset));n?(u(n),(null==f?void 0:f.conversationId)&&"new"!==f.conversationId||v({preset:n,modelsData:x,disableParams:!0}),t.current=!0):t.current=!0}),[m.data,r,x]);const b=n.useCallback((e=>{s.setQueryData([ex.presets],e)}),[s]),_=(y={onMutate:e=>{if(!e)return void b([]);const t=m.data??[];t&&b(t.filter((t=>t.presetId!==e.presetId)))},onSuccess:()=>{s.invalidateQueries([ex.presets])},onError:t=>{s.invalidateQueries([ex.presets]),console.error("Error deleting the preset:",t),a({message:e("com_endpoint_preset_delete_error"),severity:jv.ERROR})}},fr([ax.deletePreset],{mutationFn:e=>fx.deletePreset(e),...y||{}}));var y;const j=hk(),w=(e=>fr([ax.updatePreset],{mutationFn:e=>fx.updatePreset(e),...e||{}}))({onSuccess:(t,n)=>{const r=t.title?`"${t.title}"`:e("com_endpoint_preset_title");let o=`${r} ${e("com_ui_saved")}`;t.defaultPreset&&t.presetId!==(null==d?void 0:d.presetId)?(o=`${r} ${e("com_endpoint_preset_default")}`,u(t),v({preset:t,disableParams:!0})):!1===n.defaultPreset&&(u(null),o=`${r} ${e("com_endpoint_preset_default_removed")}`),a({message:o}),s.invalidateQueries([ex.presets])},onError:t=>{console.error("Error updating the preset:",t),a({message:e("com_endpoint_preset_save_error"),severity:jv.ERROR})}}),N=Pk();return{presetsQuery:m,onSetDefaultPreset:(e,t=!1)=>{w.mutate({...e,defaultPreset:!t})},onFileSelected:t=>{(t=>{j.mutate({...t},{onSuccess:()=>{a({message:e("com_endpoint_preset_import")}),s.invalidateQueries([ex.presets])},onError:t=>{console.error("Error uploading the preset:",t),a({message:e("com_endpoint_preset_import_error"),severity:jv.ERROR})}})})({...i_({preset:t}),presetId:null})},onSelectPreset:t=>{if(!t)return;const n=mb(t,l),r=n.title?`"${n.title}"`:e("com_endpoint_preset_title");a({message:`${r} ${e("com_endpoint_preset_selected_title")}`,showIcon:!1,duration:750});const o=s.getQueryData([ex.endpoints]),{shouldSwitch:c,isNewModular:d,newEndpointType:u,isCurrentModular:m,isExistingConversation:p}=Rb({newEndpoint:n.endpoint??"",modularChat:i,conversation:f,endpointsConfig:o});n.spec=null,n.iconURL=n.iconURL??null,n.modelLabel=n.modelLabel??null;const h=m&&d&&c,g=!0===n.defaultPreset;if(p&&h){const e=N({conversation:{...f??{},spec:null,iconURL:null,modelLabel:null,endpointType:u},preset:{...n,endpointType:u},cleanInput:!0});v({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:g})}else v({preset:n,keepAddedConvos:h,disableParams:g})},onChangePreset:e=>{g(e),c(!0)},clearAllPresets:()=>_.mutate(void 0),onDeletePreset:t=>{confirm(e("com_endpoint_preset_delete_confirm"))&&_.mutate(t)},submitPreset:()=>{p&&w.mutate(i_({preset:p}))},exportPreset:()=>{if(!p)return;const e=Je(p.title||"preset");et({data:i_({preset:p}),fileName:e,exportType:et.types.json})}}}function hT({setOption:e,setter:t,optionKey:s,initialValue:a,delay:r=_v}){const[o,i]=n.useState(a),l=n.useMemo((()=>ko(e&&s?e(s):t||(()=>{}),r)),[e,s,t,r]),c=n.useCallback(((e,t)=>{let n="object"!=typeof e?e:e.target.value;!0===t&&void 0!==n&&""!==n&&(n=Number(n)),i(n),l(n)}),[l]);return[c,o,i]}const gT=(e=0)=>{const t=Fe(),n=pr(),s=Cy.useClearConvoState(),a=Pe(Cy.submissionByIndex(e)),r=Cy.useClearLatestMessages(`useNavigateToConvo ${e}`),{hasSetConversation:o,setConversation:i}=Cy.useCreateConversationAtom(e);return{navigateToConvo:(e,l)=>{if(!e)return void a_.warn("conversation","Conversation not provided to `navigateToConvo`");const{resetLatestMessage:c=!0,currentConvoId:d}=l||{};a_.log("conversation","Navigating to conversation",e),o.current=!0,a(null),c&&r();let u={...e};const m=n.getQueryData([ex.endpoints]);if(!u.endpoint||!(null==m?void 0:m[u.endpoint])){const t=n.getQueryData([ex.models]),s=c_({convoSetup:e,endpointsConfig:m}),a=Sb(m,s,"type");!e.endpointType&&a&&(e.endpointType=a);const r=(null==t?void 0:t[s??""])??[];u=l_({models:r,conversation:e,endpoint:s,lastConversationSetup:e})}s(!0),n.setQueryData([ex.messages,d],[]),u.conversationId!==dh.NEW_CONVO&&u.conversationId?(n.invalidateQueries([ex.conversation,u.conversationId]),(async e=>{const s=null==e?void 0:e.conversationId;if(s)try{const e=await n.fetchQuery([ex.conversation,s],(()=>fx.getConversationById(s)));a_.log("conversation","Fetched fresh conversation data",e),i(e),t(`/c/${s??dh.NEW_CONVO}`,{state:{focusChat:!0}})}catch(a){console.error("Error fetching conversation data on navigation",a),e&&(i(e),t(`/c/${s}`,{state:{focusChat:!0}}))}})(u)):(i(u),t(`/c/${u.conversationId??dh.NEW_CONVO}`,{state:{focusChat:!0}}))}}},xT=(e=!1)=>{const t=Pe(Cy.showPluginStoreDialog),n=Ae(Cy.availableTools),{conversation:s,setConversation:a}=Mk(),r=(e=>{const t=Pe(Cy.showPluginStoreDialog),n=Ae(Cy.availableTools),{preset:s,setPreset:a}=Mk();if(!e)return!1;function r(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find((t=>"string"==typeof t?t===e:t.pluginKey===e))}return{setOption:e=>t=>{const n={};n[e]=t,a((e=>i_({preset:{...e,...n}})))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a((e=>i_({preset:{...e,...o}})))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a((e=>i_({preset:{...e,...t}})))},setOptions:e=>{const t={...e};a((e=>i_({preset:{...e,...t}})))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a((e=>i_({preset:{...e,...t}})));n.pop(),t.examples=n,a((e=>i_({preset:{...e,...t}})))},getConversation:()=>s,checkPluginSelection:r,setAgentOption:t=>n=>{const s=JSON.parse(JSON.stringify(e)),{agentOptions:r}=s;r[t]=n,a((e=>i_({preset:{...e,agentOptions:r}})))},setTools:(e,o)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map((e=>"string"==typeof e?n[e]:e)).filter((e=>!!e)))||[],d=r(e),u=n[e];l.tools=d||o?c.filter((t=>t.pluginKey!==e)):[...c,u],a((e=>i_({preset:{...e,...l}})))}}})(e);if(r&&"boolean"!=typeof r)return r;function o(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find((t=>"string"==typeof t?t===e:t.pluginKey===e))}return{setTools:(e,r)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map((e=>"string"==typeof e?n[e]:e)).filter((e=>!!e)))||[],d=o(e),u=n[e];l.tools=d||r?c.filter((t=>t.pluginKey!==e)):[...c,u],a((e=>um.parse({...e,...l})))},setOption:e=>t=>{const n={};if(n[e]=t,"presetOverride"===e){const e=(null==s?void 0:s.presetOverride)||{};n.presetOverride={...e,...t}}if("web_search"===e&&!0===t){const e=null==s?void 0:s.endpoint;if(e===Nu.openAI||e===Nu.azureOpenAI||e===Nu.custom){((null==s?void 0:s.useResponsesApi)??!1)||(n.useResponsesApi=!0)}}a((e=>um.parse({...e,...n})))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a((e=>um.parse({...e,...o})))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a((e=>um.parse({...e,...t})))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a((e=>um.parse({...e,...t})));n.pop(),t.examples=n,a((e=>um.parse({...e,...t})))},setAgentOption:e=>t=>{const n=JSON.stringify(s),r=JSON.parse(n),{agentOptions:o}=r;o[e]=t,a((e=>um.parse({...e,agentOptions:o})))},checkPluginSelection:o}};function vT({preset:e,settingKey:t,defaultValue:s,conversation:a,inputValue:r,setInputValue:o,preventDelayedUpdate:i=!1}){const l=n.useRef(null),c=n.useRef(null);n.useEffect((()=>{if(i)return;const e=setTimeout((()=>{(null==a?void 0:a[t])!==r&&o(null==a?void 0:a[t])}),1.25*_v);return()=>clearTimeout(e)}),[o,i,a,r,t]),n.useEffect((()=>{const e=(null==a?void 0:a.conversationId)??"";e&&l.current!==e&&(l.current=e,o(s))}),[o,null==a?void 0:a.conversationId,s]),n.useEffect((()=>{const t=(null==e?void 0:e.presetId)??"";t&&c.current!==t&&(c.current=t,o(s))}),[o,null==e?void 0:e.presetId,s])}const bT=n.createContext({}),_T=()=>{const{ref:e}=n.useContext(bT),{theme:t}=n.useContext(Rd);return{screenshotTargetRef:e,captureScreenshot:async()=>{if(e instanceof Function)throw new Error("Ref callback is not supported.");if(null==e?void 0:e.current)return(async e=>{if(!e)throw new Error("You should provide correct html node.");const n=Id(t)?"#171717":"white",s=await tt(e,{backgroundColor:n,imagePlaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="}),a=document.createElement("canvas"),r=a.getContext("2d"),o=s.width,i=s.height;return a.width=o,a.height=i,r.fillStyle=n,r.fillRect(0,0,o,i),r.drawImage(s,0,0),a.toDataURL("image/png",1)})(e.current);throw new Error("Ref is not attached to any element.")}}},yT=({children:e})=>{const t=n.useRef(null);return s.jsx(bT.Provider,{value:{ref:t},children:e})};function jT({conversation:e,filename:t,type:s,includeOptions:a,exportBranches:r,recursive:o}){const i=pr(),{captureScreenshot:l}=_T(),c=function(){const e=Re((({snapshot:e})=>async t=>await e.getPromise(Cy.messagesSiblingIdxFamily(t))),[]),t=async({messageId:n,message:s,messages:a,branches:r=!1,recursive:o=!1})=>{let i=[];if(null!=(null==a?void 0:a.length)&&a.length>0)if(r)for(const e of a)i.push(await t({messageId:null==e?void 0:e.messageId,message:e,messages:(null==e?void 0:e.children)||[],branches:r,recursive:o}));else{let s=a[0];if(a.length>1){const t=await e(n);s=a[a.length-t-1]}i=[await t({messageId:null==s?void 0:s.messageId,message:s,messages:(null==s?void 0:s.children)||[],branches:r,recursive:o})]}if(o&&s)return{...s,children:i};{let e=[];if(s){const t={...s};delete t.children,e=[t]}for(const t of i)e=e.concat(t);return e}};return t}(),{conversationId:d}=nt(),u=n.useCallback((()=>{const t="new"===d?d:(null==e?void 0:e.conversationId)??d??"",n=Lh({messages:i.getQueryData([ex.messages,t])??[]});return 0===(null==n?void 0:n.length)?null:n??null}),[d,null==e?void 0:e.conversationId,i]),m=(e,t="text")=>{if(!e)return"";const n=(e,n)=>"text"===t?`>> ${e}:\n${n}`:`**${e}**\n${n}`;return e.content?e.content.map((t=>p(e.sender||"",t))).map((e=>n(e[0],e[1]))).join("\n\n\n"):n(e.sender||"",e.text||"")},p=(e,t)=>{if(!t)return[];if(t.type===hh.ERROR)return[e,"object"==typeof t[hh.TEXT]?t[hh.TEXT].value??"":t[hh.TEXT]??""];if(t.type===hh.TEXT){const n=t[hh.TEXT];return[e,"string"==typeof n?n:n.value]}if(t.type===hh.TOOL_CALL){const e=t[hh.TOOL_CALL].type;if(e===xh.CODE_INTERPRETER){const e=t[hh.TOOL_CALL][xh.CODE_INTERPRETER];return["Code Interpreter",JSON.stringify(e)]}if(e===xh.RETRIEVAL){const e=t[hh.TOOL_CALL];return["Retrieval",JSON.stringify(e)]}if(e===xh.FUNCTION&&vh.has(t[hh.TOOL_CALL].function.name)){const e=t[hh.TOOL_CALL];return["Tool",JSON.stringify(e)]}if(e===xh.FUNCTION){const e=t[hh.TOOL_CALL];return Hu(e),["Tool",JSON.stringify(e)]}}if(t.type===hh.IMAGE_FILE){const e=t[hh.IMAGE_FILE];return["Image",JSON.stringify(e)]}return[e,JSON.stringify(t)]};return{exportConversation:()=>{"json"===s?(async()=>{const n={conversationId:null==e?void 0:e.conversationId,endpoint:null==e?void 0:e.endpoint,title:null==e?void 0:e.title,exportAt:(new Date).toTimeString(),branches:r,recursive:o};!0===a&&(n.options=i_({preset:e}));const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:Boolean(o)});!0!==o||Array.isArray(s)?n.messages=s:n.messagesTree=s.children,et({data:n,fileName:t,extension:"json",exportType:et.types.json})})():"text"==s?(async()=>{let n=`Conversation\n########################\nconversationId: ${null==e?void 0:e.conversationId}\nendpoint: ${null==e?void 0:e.endpoint}\ntitle: ${null==e?void 0:e.title}\nexportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\nOptions\n########################\n";const t=i_({preset:e});for(const e of Object.keys(t))n+=`${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\nHistory\n########################\n",Array.isArray(s))for(const e of s)n+=`${m(e)}\n`,(null==e?void 0:e.error)&&(n+="(This is an error message)\n"),!0===(null==e?void 0:e.unfinished)&&(n+="(This is an unfinished message)\n"),n+="\n\n";else n+=`${m(s)}\n`,s.error&&(n+="(This is an error message)\n"),!0===s.unfinished&&(n+="(This is an unfinished message)\n");et({data:n,fileName:t,extension:"txt",exportType:et.types.txt})})():"markdown"==s?(async()=>{let n=`# Conversation\n- conversationId: ${null==e?void 0:e.conversationId}\n- endpoint: ${null==e?void 0:e.endpoint}\n- title: ${null==e?void 0:e.title}\n- exportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\n## Options\n";const t=i_({preset:e});for(const e of Object.keys(t))n+=`- ${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\n## History\n",Array.isArray(s))for(const e of s)n+=`${m(e,"md")}\n`,(null==e?void 0:e.error)&&(n+="*(This is an error message)*\n"),!0===(null==e?void 0:e.unfinished)&&(n+="*(This is an unfinished message)*\n"),n+="\n\n";else n+=`${m(s,"md")}\n`,s.error&&(n+="*(This is an error message)*\n"),!0===s.unfinished&&(n+="*(This is an unfinished message)*\n");et({data:n,fileName:t,extension:"md",exportType:et.types.txt})})():"csv"==s?(async()=>{const n=[],s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:!1});if(Array.isArray(s))for(const e of s)e&&n.push(e);else n.push(s);et({data:n,fileName:t,extension:"csv",exportType:et.types.csv,beforeTableEncode:e=>{var t,n,s,a,r,o,i,l;return[{fieldName:"sender",fieldValues:(null==(t=null==e?void 0:e.find((e=>"sender"==e.fieldName)))?void 0:t.fieldValues)??[]},{fieldName:"text",fieldValues:(null==(n=null==e?void 0:e.find((e=>"text"==e.fieldName)))?void 0:n.fieldValues)??[]},{fieldName:"isCreatedByUser",fieldValues:(null==(s=null==e?void 0:e.find((e=>"isCreatedByUser"==e.fieldName)))?void 0:s.fieldValues)??[]},{fieldName:"error",fieldValues:(null==(a=null==e?void 0:e.find((e=>"error"==e.fieldName)))?void 0:a.fieldValues)??[]},{fieldName:"unfinished",fieldValues:(null==(r=null==e?void 0:e.find((e=>"unfinished"==e.fieldName)))?void 0:r.fieldValues)??[]},{fieldName:"messageId",fieldValues:(null==(o=null==e?void 0:e.find((e=>"messageId"==e.fieldName)))?void 0:o.fieldValues)??[]},{fieldName:"parentMessageId",fieldValues:(null==(i=null==e?void 0:e.find((e=>"parentMessageId"==e.fieldName)))?void 0:i.fieldValues)??[]},{fieldName:"createdAt",fieldValues:(null==(l=null==e?void 0:e.find((e=>"createdAt"==e.fieldName)))?void 0:l.fieldValues)??[]}]}})})():"screenshot"==s&&(async()=>{let e;try{e=await l()}catch(n){return console.error("Failed to capture screenshot"),console.error(n)}st(e,`${t}.png`,"image/png")})()}}}function wT({nextCursor:e,isFetchingNext:t,setShowLoading:s,fetchNextPage:a}){const r=n.useRef(null),o=n.useRef(null),i=n.useCallback(To((()=>a?a():Promise.resolve()),750,{leading:!0}),[a]),l=n.useCallback((()=>{if(o.current){const{scrollTop:n,clientHeight:a,scrollHeight:r}=o.current;n+a>=.97*r&&null!=e&&!t?(s(!0),i()):s(!1)}}),[e,t,i,s]);n.useEffect((()=>{const e=o.current;return e&&e.addEventListener("scroll",l),()=>{e&&e.removeEventListener("scroll",l)}}),[l]);const c=n.useCallback((()=>{const e=o.current;e&&(r.current=e.scrollTop)}),[]);return{containerRef:o,moveToTop:c}}function NT(e,t){const s=Fe(),a=De();return n.useCallback((n=>{t&&t(n),0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),s(e,{state:{prevLocation:a}}))}),[s,e,t,a])}const CT=({mutateAsync:e,agent_id:t,assistant_id:s,tool_resource:a})=>{const[r,o]=n.useState([]),i=tT(),l=n.useCallback((({filesToDelete:t,agent_id:n,assistant_id:s,tool_resource:a})=>{const r=xm({agent_id:n,assistant_id:s,tool_resource:a});console.log("Deleting files:",t,r),e({files:t,...r}),o([])}),[e]),c=n.useCallback(ko(l,1e3),[]);n.useEffect((()=>()=>c.cancel()),[c]);return{deleteFile:n.useCallback((({file:e,setFiles:n})=>{const{file_id:r,temp_file_id:l="",filepath:d="",source:u=_m.local,embedded:m,attached:p=!1}=e;if((e.progress??1)<1)return;const f={file_id:r,embedded:m,filepath:d,source:u};n&&n((e=>{const t=new Map(e);t.delete(r),t.delete(l);const n=Object.fromEntries(t);return i(n),t})),p||o((e=>{const n=[...e,f];return c({filesToDelete:n,agent_id:t,assistant_id:s,tool_resource:a}),n}))}),[c,i,t,s,a]),deleteFiles:n.useCallback((({files:e,setFiles:n})=>{const a=[];for(const t of e){const{file_id:e,embedded:n,temp_file_id:s,filepath:r="",source:o=_m.local}=t;a.push({source:o,file_id:e,filepath:r,temp_file_id:s,embedded:n??!1})}n&&n((e=>{const t=new Map(e);a.forEach((e=>{t.delete(e.file_id),e.temp_file_id&&t.delete(e.temp_file_id)}));const n=Object.fromEntries(t);return i(n),t})),o((e=>{const n=[...e,...a];return c({filesToDelete:n,agent_id:t,assistant_id:s}),n}))}),[c,i,t,s])}},kT=()=>{const e=Uk(),{showToast:t}=$d(),[s,a]=n.useState({});return{startUploadTimer:(n,r,o)=>{const i=(e=>5e3+2e3*Math.floor(e/1e6))(o);s[n]&&clearTimeout(s[n]);const l=setTimeout((()=>{const n=e("com_ui_upload_delay",{0:r});t({message:n,status:"warning",duration:1e4})}),i);a((e=>({...e,[n]:l})))},clearUploadTimer:e=>{s[e]&&(clearTimeout(s[e]),a((t=>{const{[e]:n,...s}=t;return s})))}}},ST=async(e,t=.9,n)=>{const s=await(async e=>{try{return await Qo(e)}catch(t){return console.warn("Error checking if file is HEIC:",t),"image/heic"===e.type||"image/heif"===e.type}})(e);return s?(console.log("HEIC file detected, converting to JPEG..."),(async(e,t=.9,n)=>{try{null==n||n(.3);const s=await Yo({blob:e,type:"image/jpeg",quality:t});null==n||n(.8);const a=new File([s],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:e.lastModified});return null==n||n(1),a}catch(s){throw console.error("Error converting HEIC to JPEG:",s),new Error("Failed to convert HEIC image to JPEG")}})(e,t,n)):e},TT={maxWidth:1900,maxHeight:1900,quality:.92,format:"jpeg"};function ET(){try{if("undefined"==typeof HTMLCanvasElement)return!1;if("undefined"==typeof FileReader)return!1;if("undefined"==typeof Image)return!1;const e=document.createElement("canvas"),t=e.getContext("2d");return!!(t&&t.drawImage&&e.toBlob)}catch{return!1}}function RT(e,t={}){return new Promise(((n,s)=>{if(!ET())return void s(new Error("Browser does not support client-side image resizing"));if(!e.type.startsWith("image/"))return void s(new Error("File is not an image"));const a={...TT,...t},r=new FileReader;r.onload=t=>{var r;const o=new Image;o.onload=()=>{try{const t={width:o.width,height:o.height},r=function(e,t,n,s){const{width:a,height:r}={width:e,height:t};if(a<=n&&r<=s)return{width:a,height:r};const o=n/a,i=s/r,l=Math.min(o,i);return{width:Math.round(a*l),height:Math.round(r*l)}}(o.width,o.height,a.maxWidth,a.maxHeight);if(r.width===t.width&&r.height===t.height)return void n({file:e,originalSize:e.size,newSize:e.size,originalDimensions:t,newDimensions:r,compressionRatio:1});const i=document.createElement("canvas"),l=i.getContext("2d");i.width=r.width,i.height=r.height,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(o,0,0,r.width,r.height),i.toBlob((o=>{if(!o)return void s(new Error("Failed to create blob from canvas"));const i="jpeg"===a.format?".jpg":`.${a.format}`,l=e.name.replace(/\.[^/.]+$/,""),c=new File([o],`${l}${i}`,{type:`image/${a.format}`,lastModified:Date.now()});n({file:c,originalSize:e.size,newSize:c.size,originalDimensions:t,newDimensions:r,compressionRatio:c.size/e.size})}),`image/${a.format}`,a.quality)}catch(t){s(t)}},o.onerror=()=>s(new Error("Failed to load image")),o.src=null==(r=t.target)?void 0:r.result},r.onerror=()=>s(new Error("Failed to read file")),r.readAsDataURL(e)}))}function IT(e){const t=tT();return{addFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},replaceFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},updateFileById:(n,s,a=!1)=>{e((e=>{if(!e.has(n))return console.warn(`File with id ${n} not found.`),e;const r=new Map(e),o=r.get(n);if(!o)return console.warn(`File with id ${n} not found.`),e;r.set(n,{...o,...s});if((s.filepath??"")&&1!==s.progress&&!a){const e=Object.fromEntries(r);t(e)}return r}))},deleteFileById:n=>{e((e=>{const s=new Map(e);s.has(n)?s.delete(n):console.warn(`File with id ${n} not found.`);const a=Object.fromEntries(s);return t(a),s}))}}}const PT=e=>{var t,s,a;const r=Uk(),o=pr(),{showToast:i}=$d(),[l,c]=n.useState([]),d=n.useRef(null),{startUploadTimer:u,clearUploadTimer:m}=kT(),{files:p,setFiles:f,setFilesLoading:h,conversation:g}=Mk(),x=Pe(jy((null==g?void 0:g.conversationId)??dh.NEW_CONVO)),v=e=>c((t=>[...t,e])),{addFile:b,replaceFile:_,updateFileById:y,deleteFileById:j}=IT((null==e?void 0:e.fileSetter)??f),{resizeImageIfNeeded:w}=(()=>{const{data:e=null}=Xy({select:e=>Ym(e)}),t=(null==e?void 0:e.clientImageResize)??{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},s=(null==t?void 0:t.enabled)??!1,a=n.useCallback((async(e,n)=>{if(!s)return{file:e,resized:!1};if(!ET())return console.warn("Client-side image resizing not supported in this browser"),{file:e,resized:!1};if(!function(e,t=536870912){return!(e.size<.1*t||!e.type.startsWith("image/")||"image/gif"===e.type)}(e))return{file:e,resized:!1};try{const s={maxWidth:null==t?void 0:t.maxWidth,maxHeight:null==t?void 0:t.maxHeight,quality:null==t?void 0:t.quality,...n},a=await RT(e,s);return{file:a.file,resized:!0,result:a}}catch(a){return console.warn("Client-side image resizing failed:",a),{file:e,resized:!1}}}),[s,t]);return{isEnabled:s,isSupported:ET(),config:t,resizeImageIfNeeded:a}})(),N=(null==(t=null==e?void 0:e.additionalMetadata)?void 0:t.agent_id)??"",C=(null==(s=null==e?void 0:e.additionalMetadata)?void 0:s.assistant_id)??"",{data:k=null}=Xy({select:e=>Ym(e)}),S=n.useMemo((()=>(null==e?void 0:e.overrideEndpoint)??(null==g?void 0:g.endpointType)??(null==g?void 0:g.endpoint)??"default"),[null==e?void 0:e.overrideEndpoint,null==g?void 0:g.endpointType,null==g?void 0:g.endpoint]),T=n.useCallback((()=>{if(l.length>1){const e=Array.from(new Set(l)).map(((e,t)=>`${t>0?"• ":""}${r(e)||e}\n`)).join("");i({message:e,status:"error",duration:5e3})}else if(1===l.length){const e=r(l[0])||l[0];i({message:e,status:"error",duration:5e3})}c([])}),[l,i,r]),E=ko(T,250);n.useEffect((()=>(l.length>0&&E(),()=>E.cancel())),[l,E]);const R=((e,t)=>{const n=pr(),{onSuccess:s,...a}=e||{};return fr([ax.fileUpload],{mutationFn:e=>{const n=e.get("width")??"",s=e.get("height")??"",a=e.get("version")??"",r=e.get("endpoint")??"";return Mu(r)&&"2"===a?fx.uploadFile(e,t):""!==n&&""!==s?fx.uploadImage(e,t):fx.uploadFile(e,t)},...a,onSuccess:(e,t,a)=>{n.setQueryData([ex.files],(t=>[e,...t??[]]));const r=t.get("endpoint"),o=t.get("message_file"),i=t.get("agent_id")??"",l=t.get("assistant_id")??"",c=t.get("tool_resource")??"";"true"!==o?(i&&c&&n.setQueryData([ex.agent,i],(t=>{var n,s;if(!t)return t;const a={},r=t.tool_resources??{},o=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};return o.file_ids||(o.file_ids=[]),o.file_ids.push(e.file_id),a.tool_resources={...r,[c]:o},(null==(s=t.tools)?void 0:s.includes(c))||(a.tools=[...t.tools??[],c]),{...t,...a}})),l?(n.setQueryData([ex.assistants,r,uu],(t=>t?{...t,data:t.data.map((t=>{var n;if(t.id!==l)return t;const s={};if(c||(s.file_ids=[...t.file_ids??[],e.file_id]),c===eu.code_interpreter){const a=t.tool_resources??{},r=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};r.file_ids||(r.file_ids=[]),r.file_ids.push(e.file_id),s.tool_resources={...a,[c]:r}}return{...t,...s}}))}:t)),null==s||s(e,t,a)):null==s||s(e,t,a)):null==s||s(e,t,a)}})})({onSuccess:e=>{m(e.temp_file_id),console.log("upload success",e),N?o.refetchQueries([ex.agent,N]):(y(e.temp_file_id,{progress:.9,filepath:e.filepath},!!C),setTimeout((()=>{y(e.temp_file_id,{progress:1,file_id:e.file_id,temp_file_id:e.temp_file_id,filepath:e.filepath,type:e.type,height:e.height,width:e.width,filename:e.filename,source:e.source,embedded:e.embedded},!!C)}),300))},onError:(e,t)=>{var n,s;const a=e;console.log("upload error",a);const r=t.get("file_id");t.get("tool_resource")===eu.execute_code&&x((e=>({...e,[eu.execute_code]:!1}))),m(r),j(r);let o="com_error_files_upload";"ERR_CANCELED"===(null==a?void 0:a.code)?o="com_error_files_upload_canceled":(null==(s=null==(n=null==a?void 0:a.response)?void 0:n.data)?void 0:s.message)&&(o=a.response.data.message),v(o)}},null==(a=d.current)?void 0:a.signal),I=async t=>{var n,s;const a=(null==(n=t.file)?void 0:n.name)??"File";u(t.file_id,a,t.size);const r=new FormData;r.append("endpoint",S),r.append("original_endpoint",(null==g?void 0:g.endpointType)||(null==g?void 0:g.endpoint)||""),r.append("file",t.file,encodeURIComponent(a)),r.append("file_id",t.file_id);const i=t.width??0,l=t.height??0;i&&r.append("width",i.toString()),l&&r.append("height",l.toString());const c=(null==e?void 0:e.additionalMetadata)??{};if(null==e?void 0:e.additionalMetadata)for(const[e,o=""]of Object.entries(c))o&&r.append(e,o);if(Lu(S)){N||r.append("message_file","true");const e=t.tool_resource;null!=e&&r.append("tool_resource",e),null!=(null==g?void 0:g.agent_id)&&null==r.get("agent_id")&&r.append("agent_id",g.agent_id)}if(!Mu(S))return void R.mutate(r);const d=(null==g?void 0:g.model)??"",m=(null==g?void 0:g.assistant_id)??"";C||r.append("message_file","true");const p=o.getQueryData([ex.endpoints]),f=(null==(s=null==p?void 0:p[S])?void 0:s.version)??of[S];!C&&m&&(r.append("version",f),r.append("model",d),r.append("assistant_id",m));(r.get("version")??"")||r.append("version",f);(r.get("model")??"")||r.append("model",d),R.mutate(r)},P=(e,t)=>{const n=new Image;n.onload=async()=>{e.width=n.width,e.height=n.height,e={...e,progress:.6},_(e),await I(e),URL.revokeObjectURL(t)},n.src=t},A=async(t,n)=>{var s,a,o;d.current=new AbortController;const l=Array.from(t);let c;try{c=(({files:e,fileList:t,setError:n,endpointFileConfig:s,toolResource:a,fileConfig:r})=>{var o,i,l;const{fileLimit:c,fileSizeLimit:d,totalSizeLimit:u,supportedMimeTypes:m}=s,p=Array.from(e.values()),f=t.reduce(((e,t)=>e+t.size),0);if(0===f)return n("com_error_files_empty"),!1;const h=p.reduce(((e,t)=>e+t.size),0);if(c&&t.length+e.size>c)return n(`You can only upload up to ${c} files at a time.`),!1;for(let x=0;x<t.length;x++){let e=t[x],s=e.type;const c=e.name.split(".").pop()??"",u=zm[c];if(!u||s&&s===u||(s=u),!s)return n("Unable to determine file type for: "+e.name),!1;if(e.type!==s){const n=new File([e],e.name,{type:s});e=n,t[x]=n}let p=m;if(a===eu.context&&(p=[...(null==(o=null==r?void 0:r.text)?void 0:o.supportedMimeTypes)||[],...(null==(i=null==r?void 0:r.ocr)?void 0:i.supportedMimeTypes)||[],...(null==(l=null==r?void 0:r.stt)?void 0:l.supportedMimeTypes)||[]]),!zv(e.type,p))return console.log(e),n("Currently, unsupported file type: "+e.type),!1;if(d&&e.size>=d)return n(`File size exceeds ${d/Vm} MB.`),!1}if(u&&h+f>u)return n(`The total size of the files cannot exceed ${u/Vm} MB.`),!1;const g=[...p.map((e=>{var t,n;return`${(null==(t=e.file)?void 0:t.name)??e.filename}-${e.size}-${(null==(n=e.type)?void 0:n.split("/")[0])??"file"}`})),...t.map((e=>`${null==e?void 0:e.name}-${null==e?void 0:e.size}-${(null==e?void 0:e.type.split("/")[0])??"file"}`))];return new Set(g).size===g.length||(n("com_error_files_dupe"),!1)})({files:p,fileList:l,setError:v,endpointFileConfig:(null==e?void 0:e.overrideEndpointFileConfig)??(null==(s=null==k?void 0:k.endpoints)?void 0:s[S])??(null==(a=null==k?void 0:k.endpoints)?void 0:a.default)??Gm.endpoints[S]??Gm.endpoints.default,toolResource:n,fileConfig:k})}catch(u){return console.error("file validation error",u),void v("com_error_files_validation")}if(c)for(const d of l){const t=Xe();try{const s=URL.createObjectURL(d),a={file_id:t,file:d,type:d.type,preview:s,progress:.1,size:d.size};null!=n&&""!==n&&(a.tool_resource=n),b(a);("image/heic"===d.type||"image/heif"===d.type||d.name.toLowerCase().match(/\.(heic|heif)$/))&&i({message:r("com_info_heic_converting"),status:"info",duration:3e3});const l=await ST(d,.9,(e=>{const t=.1+.4*e;_({...a,progress:t})}));let c=l;if(l.type.startsWith("image/"))try{const e=await w(l);if(c=e.file,e.resized&&e.result){const{originalSize:t,newSize:n,compressionRatio:s}=e.result,a=(t/1048576).toFixed(1),r=(n/1048576).toFixed(1),o=Math.round(100*(1-s));i({message:`Image resized: ${a}MB → ${r}MB (${o}% smaller)`,status:"success",duration:3e3})}}catch(m){console.warn("Image resize failed, using original:",m)}if(c!==d){URL.revokeObjectURL(s);const e=URL.createObjectURL(c),t={...a,file:c,type:c.type,preview:e,progress:.5,size:c.size};_(t);if("image"===c.type.split("/")[0]){P(t,e);continue}await I(t)}else{const t="image"===d.type.split("/")[0],n=a.tool_resource??(null==(o=null==e?void 0:e.additionalMetadata)?void 0:o.tool_resource);if(Lu(S)&&!t&&null==n){v("com_error_files_unsupported_capability");continue}const r={...a,progress:.2};if(_(r),t){P(r,s);continue}await I(r)}}catch(u){j(t),console.log("file handling error",u),u instanceof Error&&u.message.includes("HEIC")?v("com_error_heic_conversion"):v("com_error_files_process")}}else h(!1)};return{handleFileChange:(e,t)=>{e.stopPropagation(),e.target.files&&(h(!0),A(e.target.files,t),e.target.value="")},handleFiles:A,abortUpload:()=>{d.current&&(a_.log("files","Aborting upload"),d.current.abort("User aborted upload"),d.current=null)},setFiles:f,files:p}};function AT({enabled:e=!0,purpose:t}){const{user:n}=qk(),{data:s}=Wy(),a=null==s?void 0:s.sharePointBaseUrl,r=null==s?void 0:s.sharePointPickerGraphScope,o=null==s?void 0:s.sharePointPickerSharePointScope,i="openid"===(null==n?void 0:n.provider),l="Pick"===t?o:r,{data:c,isLoading:d,error:u,refetch:m}=Ty({scopes:l,enabled:e&&i&&!!a});return{token:c,isLoading:d,error:u,refetch:m}}function MT(e){const{handleFiles:t}=PT(e),{downloadSharePointFiles:s,isDownloading:a,downloadProgress:r,error:o}=function({onFilesDownloaded:e,onError:t}={}){const{showToast:s}=$d(),[a,r]=n.useState(null),[o,i]=n.useState(null),{token:l,refetch:c}=AT({enabled:!1,purpose:"Download"}),d=Jy();return{downloadSharePointFiles:n.useCallback((async n=>{var a;if(!n||0===n.length)throw new Error("No files provided for download");i(null),r({completed:0,total:n.length,failed:[]});try{let t=null==l?void 0:l.access_token;if(!t&&(s({message:"Getting SharePoint access token...",status:"info",duration:2e3}),t=null==(a=(await c()).data)?void 0:a.access_token,!t))throw new Error("Failed to obtain SharePoint access token");s({message:`Downloading ${n.length} file(s) from SharePoint...`,status:"info",duration:3e3});const o=await d.mutateAsync({files:n,accessToken:t,onProgress:e=>{r(e),n.length>5&&e.completed%3==0&&s({message:`Downloaded ${e.completed}/${e.total} files...`,status:"info",duration:1e3})}});if(o.length>0){const t=n.length-o.length,a=t>0?`Downloaded ${o.length}/${n.length} files from SharePoint (${t} failed)`:`Successfully downloaded ${o.length} file(s) from SharePoint`;s({message:a,status:t>0?"warning":"success",duration:4e3}),e&&await e(o)}return r(null),o}catch(o){const e=o instanceof Error?o.message:"Unknown download error";throw i(e),s({message:`SharePoint download failed: ${e}`,status:"error",duration:5e3}),t&&t(o instanceof Error?o:new Error(e)),r(null),o}}),[l,s,d,e,t,c]),isDownloading:d.isLoading,downloadProgress:a,error:o}}({onFilesDownloaded:async n=>{const s=Array.from(n);await t(s,null==e?void 0:e.toolResource)},onError:e=>{console.error("SharePoint download failed:",e)}});return{handleSharePointFiles:n.useCallback((async e=>{try{await s(e)}catch(t){throw console.error("SharePoint file handling error:",t),t}}),[s]),isProcessing:a,downloadProgress:r,error:o}}function LT(e,t=[],s=300){const a=n.useRef(),r=n.useRef();r.current=n.useCallback(e,t);const o=n.useCallback(ko((()=>{var e;return a.current=null==(e=r.current)?void 0:e.call(r)}),s),[]);n.useEffect(o,t),n.useEffect((()=>()=>a.current instanceof Function?a.current():void 0),[])}function OT({textAreaRef:e,submitButtonRef:t,setIsScrollable:s,disabled:a=!1}){const r=Uk(),o=nT(),i=n.useRef(!1),l=zk(),{handleFiles:c}=PT(),d=bS(),u=(()=>{const e=pr(),t=n.useRef(Date.now());return n.useCallback((()=>{const n=Date.now();n-t.current>th.FIVE_MINUTES&&(a_.log("Checking health on interaction. Time elapsed:",n-t.current),e.invalidateQueries([ex.health]),t.current=n)}),[e])})(),m=Ae(Cy.enterToSend),{index:p,conversation:f,isSubmitting:h,filesLoading:g,latestMessage:x,setFilesLoading:v}=Mk(),[b,_]=Ie(Cy.activePromptByIndex(p)),{endpoint:y=""}=f||{},{entity:j,isAgent:w,isAssistant:N}=Ob({endpoint:y,agentsMap:l,assistantMap:d,agent_id:null==f?void 0:f.agent_id,assistant_id:null==f?void 0:f.assistant_id}),C=(null==j?void 0:j.name)??"",k=(((null==x?void 0:x.unfinished)??!1)&&!h||((null==x?void 0:x.error)??!1))&&!N;n.useEffect((()=>{const t=b??"";t&&e.current&&(hb(e.current,t),gb(e.current),_(void 0))}),[b,_,e]),n.useEffect((()=>{var t,n;if((null==(t=e.current)?void 0:t.value)??"")return;const s=()=>{var e;if(a)return r("com_endpoint_config_placeholder");const t=(null==f?void 0:f.endpoint)??"",n=(null==f?void 0:f.agent_id)??"",s=(null==f?void 0:f.assistant_id)??"";if(!(!w||n&&(null==l?void 0:l[n])))return r("com_endpoint_agent_placeholder");if(N&&(!s||!(null==(e=null==d?void 0:d[t])?void 0:e[s])))return r("com_endpoint_assistant_placeholder");if(k)return r("com_endpoint_message_not_appendable");const i=N||w?(({name:e="",localize:t,isAgent:n})=>e&&e.length>0?e:t(!0===n?"com_ui_agent":"com_ui_assistant"))({name:C,isAgent:w,localize:r}):o(f);return`${r("com_endpoint_message_new",{0:i||r("com_endpoint_ai")})}`},i=s();if((null==(n=e.current)?void 0:n.getAttribute("placeholder"))===i)return;const c=ko((()=>{var t,n;const a=s();(null==(t=e.current)?void 0:t.getAttribute("placeholder"))!==a&&(null==(n=e.current)||n.setAttribute("placeholder",a),gb(e.current))}),80);return c(),()=>c.cancel()}),[w,r,a,o,l,C,e,N,d,f,x,k]);const S=n.useCallback((n=>{var a;if(e.current&&vb(e.current)){const t=vb(e.current);t&&s(t)}if("Enter"===n.key&&h)return;u();const r="Enter"===n.key&&!n.shiftKey,o="Enter"===n.key&&(n.ctrlKey||n.metaKey),l=i.current||"Process"===n.key||229===n.keyCode;if(r&&g&&n.preventDefault(),r&&n.preventDefault(),"Enter"===n.key&&!m&&!o&&e.current&&!l)return n.preventDefault(),hb(e.current,"\n"),void gb(e.current);if((r||o)&&!l){const e=document.getElementById(xv);e&&(console.log("Unmuting global audio"),e.muted=!1),null==(a=t.current)||a.click()}}),[h,u,g,m,s,e,t]),T=n.useCallback((t=>{if(!e.current)return;const n=t.clipboardData;if(n&&n.files.length>0){v(!0);const e=[];for(const t of n.files){const n=new File([t],`clipboard_${+new Date}_${t.name}`,{type:t.type});e.push(n)}c(e)}}),[c,v,e]);return{textAreaRef:e,handlePaste:T,handleKeyDown:S,isNotAppendable:k,handleCompositionEnd:()=>{i.current=!1},handleCompositionStart:()=>{i.current=!0}}}const DT=e=>{const t={};return Object.entries(e).forEach((([e,n])=>{try{const s=mm.shape[e];if(s){const a=(e=>"true"===e||"false"!==e&&(isNaN(Number(e))?e:Number(e)))(n),r=s.parse(a);t[e]=r}}catch(s){console.warn(`Invalid value for setting ${e}:`,s)}})),null!=t.assistant_id&&t.assistant_id&&!Mu(t.endpoint)&&(t.endpoint=Nu.assistants),null!=t.agent_id&&t.agent_id&&!Lu(t.endpoint)&&(t.endpoint=Nu.agents),t};function FT({textAreaRef:e}){const t=n.useRef(0),s=n.useRef(!1),a=n.useRef(!1),r=n.useRef(!1),o=n.useRef(!1),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),d=uS(),[u,m]=Ps(),p=Pk(),f=Ae(Cy.modularChat),h=Ae(Cy.availableTools),{submitMessage:g}=YT(),x=pr(),{conversation:v,newConversation:b}=Mk(),_=u.get("agent_id")||"",{data:y}=Ay(_),j=n.useCallback((e=>{var t;if(!e)return;let n=mb(e,h);if(null!=n.spec&&""!==n.spec){const e=x.getQueryData([ex.startupConfig]),s=((null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list)??[]).find((e=>e.name===n.spec));if(!s)return;const{preset:a}=s;a.iconURL=Ab(s),a.spec=s.name,n=a}let s=n.endpoint??"";const a=x.getQueryData([ex.endpoints]);if(s&&a&&!a[s]){const e=s.toLowerCase();for(const[t,r]of Object.entries(a))if(r&&r.type===Nu.custom&&t.toLowerCase()===e){s=t,n.endpoint=t,n.endpointType=Nu.custom;break}}const{template:r,shouldSwitch:o,isNewModular:i,newEndpointType:l,isCurrentModular:c,isExistingConversation:d}=Rb({newEndpoint:s,modularChat:f,conversation:v,endpointsConfig:a});let u={};null==n.spec&&(r.spec=null,r.iconURL=null,r.modelLabel=null,u={spec:null,iconURL:null,modelLabel:null},n={...n,...u});if(d&&(c&&i&&o)){r.endpointType=l;const e=p({conversation:{...v??{},endpointType:r.endpointType,...u},preset:r,cleanOutput:null!=n.spec&&""!==n.spec});return a_.log("conversation","Switching conversation from query params",e),void b({template:e,preset:n,keepLatestMessage:!0,keepAddedConvos:!0})}b({preset:n,keepAddedConvos:!0})}),[x,f,v,h,b,p]),w=n.useCallback((()=>{if(!l.current||!v)return!1;for(const[e,t]of Object.entries(l.current))if(!["presetOverride","iconURL","spec","modelLabel"].includes(e)&&v[e]!==t)return!1;return!0}),[v]),N=n.useCallback((()=>{!o.current&&a.current&&i.current&&(o.current=!0,a.current=!1,d.setValue("text",i.current,{shouldValidate:!0}),d.handleSubmit((e=>{var t;if(null==(t=e.text)?void 0:t.trim()){g(e);const t=window.location.pathname;window.history.replaceState({},"",t),console.log("Message submitted with conversation state:",v)}}))())}),[d,g,v]);n.useEffect((()=>{const n=setInterval((()=>{if(s.current||t.current>=50)return clearInterval(n),void(t.current>=50&&console.warn("Max attempts reached, failed to process parameters"));if(t.current+=1,!e.current)return;if(!x.getQueryData([ex.startupConfig]))return;const{decodedPrompt:r,validSettings:p,shouldAutoSubmit:f}=(()=>{var e;const t={};u.forEach(((e,n)=>{t[n]=e}));const n=t.prompt||t.q||"",s="true"===(null==(e=t.submit)?void 0:e.toLowerCase());return delete t.prompt,delete t.q,delete t.submit,{decodedPrompt:n,validSettings:DT(t),shouldAutoSubmit:s}})();f||(o.current=!0);Object.keys(p).length>0&&(l.current=p),r&&(i.current=r),f&&r?Object.keys(p).length>0?(a.current=!0,c.current=setTimeout((()=>{!o.current&&a.current&&(console.warn("Settings application timeout reached, proceeding with submission anyway"),N())}),3e3)):(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length),d.handleSubmit((e=>{var t;(null==(t=e.text)?void 0:t.trim())&&g(e)}))()):r?(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length)):o.current=!0,Object.keys(p).length>0&&j(p),(()=>{const e=u.toString(),t=new URLSearchParams(e);if(t.delete("prompt"),t.delete("q"),t.delete("submit"),m(t,{replace:!0}),s.current=!0,console.log("Parameters processed successfully",e),clearInterval(n),!a.current){const e=window.location.pathname;window.history.replaceState({},"",e)}})()}),100);return()=>{clearInterval(n),c.current&&clearTimeout(c.current)}}),[u,d,e,j,b,g,m,x,N]),n.useEffect((()=>{if(!s.current||o.current||r.current||!l.current||!v)return;w()&&(r.current=!0,a.current&&(c.current&&(clearTimeout(c.current),c.current=null),console.log("Settings fully applied, processing submission"),N()))}),[v,N,w]);const{isAuthenticated:C}=qk(),k=Dk({isAuthenticated:C});n.useEffect((()=>{y&&((e,t)=>{const n=[ex.agents,{requiredPermission:Yg.EDIT}],s=e.getQueryData(n);if((null==s?void 0:s.data)&&!s.data.some((e=>e.id===t.id))){const a={...s,data:[t,...s.data]};e.setQueryData(n,a),a_.log("agent","Injected URL agent into cache:",t)}})(x,y)}),[y,x,k])}const zT={Escape:!0,Backspace:!0,Enter:!0},UT=(e,t)=>{var n,s;const a=null==(n=e.current)?void 0:n.value;if("string"!=typeof a||0===a.length||a[0]!==t)return!1;const r=null==(s=e.current)?void 0:s.selectionStart;return"number"==typeof r&&1===r};const VT=()=>{const e=Ae(Cy.engineSTT),t=Ae(Cy.engineTTS),s=e,a=t;return n.useMemo((()=>({speechToTextEndpoint:s,textToSpeechEndpoint:a})),[s,a])},BT=(e,t)=>{const{showToast:s}=$d(),{speechToTextEndpoint:a}=VT(),r="external"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(!1),[m,p]=n.useState(!1),[f,h]=n.useState([]),[g,x]=n.useState(!1),[v,b]=n.useState((()=>T())),[_]=Ie(Cy.decibelValue),[y]=Ie(Cy.autoSendText),[j]=Ie(Cy.languageSTT),[w]=Ie(Cy.speechToText),[N]=Ie(Cy.autoTranscribeAudio),{mutate:C,isLoading:k}=(S={onSuccess:n=>{const s=n.text;e(s),x(!1),y>-1&&w&&s.length>0&&setTimeout((()=>{t(s)}),1e3*y)},onError:()=>{s({message:"An error occurred while processing the audio, maybe the audio was too short",status:"error"}),x(!1)}},fr([ax.speechToText],{mutationFn:e=>fx.speechToText(e),...S||{}}));var S;function T(){const e=["audio/webm","audio/webm;codecs=opus","audio/mp4","audio/ogg;codecs=opus","audio/ogg","audio/wav"];for(const t of e)if("undefined"!=typeof MediaRecorder&&MediaRecorder.isTypeSupported(t))return t;if("undefined"!=typeof navigator){const e=navigator.userAgent.toLowerCase();if(-1!==e.indexOf("safari")&&-1===e.indexOf("chrome"))return"audio/mp4";if(-1!==e.indexOf("firefox"))return"audio/ogg"}return"audio/webm"}const E=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});u(!0),o.current=e??null}catch{u(!1)}},R=()=>{if(f.length>0){const t=new Blob(f,{type:v}),n=(e=v).includes("mp4")?"m4a":e.includes("ogg")?"ogg":e.includes("wav")?"wav":"webm";h([]);const s=new FormData;s.append("audio",t,`audio.${n}`),j&&s.append("language",j),x(!0),c.current&&(c.current.removeEventListener("dataavailable",(e=>{f.push(e.data)})),c.current.removeEventListener("stop",R),c.current=null),C(s)}else s({message:"The audio was too short",status:"warning"});var e},I=async()=>{if(g)s({message:"A request is already being made. Please wait.",status:"warning"});else if(o.current||await E(),o.current)try{h([]);const e=T();b(e),c.current=new MediaRecorder(o.current,{mimeType:v}),c.current.addEventListener("dataavailable",(e=>{f.push(e.data)})),c.current.addEventListener("stop",R),c.current.start(100),!l.current&&N&&w&&((e,t)=>{const n=new AudioContext,s=n.createMediaStreamSource(e),a=n.createAnalyser();a.minDecibels=_,s.connect(a);const r=a.frequencyBinCount,o=new Uint8Array(r);let l=Date.now();const c=()=>{a.getByteFrequencyData(o),o.some((e=>e>0))&&(l=Date.now()),Date.now()-l>3e3?t():i.current=window.requestAnimationFrame(c)};i.current=window.requestAnimationFrame(c)})(o.current,P),p(!0)}catch(e){s({message:`Error starting recording: ${e}`,status:"error"})}else s({message:"Microphone permission not granted",status:"error"})},P=()=>{var e;c.current&&("recording"===c.current.state?(c.current.stop(),null==(e=o.current)||e.getTracks().forEach((e=>e.stop())),o.current=null,null!==i.current&&(window.cancelAnimationFrame(i.current),i.current=null),p(!1)):s({message:"MediaRecorder is not recording",status:"error"}))},A=async e=>{if(e.shiftKey&&e.altKey&&"KeyL"===e.code&&r){if(!window.MediaRecorder)return void s({message:"MediaRecorder is not supported in this browser",status:"error"});!1===d&&await E(),m?P():I(),e.preventDefault()}};return n.useEffect((()=>(window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)})),[m]),{isListening:m,externalStopRecording:()=>{m?P():s({message:"Not currently recording. Please start recording first.",status:"warning"})},externalStartRecording:()=>{m?s({message:"Already listening. Please stop recording first.",status:"warning"}):I()},isLoading:k}},$T=(e,t)=>{const{speechToTextEndpoint:s}=VT(),a="external"===s,{isListening:r,isLoading:o,startRecording:i,stopRecording:l}=((e,t)=>{const{showToast:s}=$d(),{speechToTextEndpoint:a}=VT(),r="browser"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(),[c]=Ie(Cy.autoSendText),[d]=Ie(Cy.languageSTT),[u]=Ie(Cy.autoTranscribeAudio),{listening:m,finalTranscript:p,resetTranscript:f,interimTranscript:h,isMicrophoneAvailable:g,browserSupportsSpeechRecognition:x}=at.useSpeechRecognition(),v=n.useMemo((()=>m),[m]);n.useEffect((()=>{null!=h&&""!==h&&i.current!==h&&(e(h),i.current=h)}),[e,h]),n.useEffect((()=>{if(null!=p&&""!==p&&o.current!==p)return e(p),o.current=p,c>-1&&p.length>0&&(l.current=setTimeout((()=>{t(p),f()}),1e3*c)),()=>{l.current&&clearTimeout(l.current)}}),[e,t,f,p,c]);const b=()=>{x?g?!0===v?rt.stopListening():rt.startListening({language:d,continuous:u}):s({message:"Microphone is not available",status:"error"}):s({message:"Browser does not support SpeechRecognition",status:"error"})};return n.useEffect((()=>{const e=e=>{e.shiftKey&&e.altKey&&"KeyL"===e.code&&!r&&b()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[]),{isListening:v,isLoading:!1,startRecording:b,stopRecording:b}})(e,t),{isListening:c,isLoading:d,externalStartRecording:u,externalStopRecording:m}=BT(e,t);return{isLoading:a?d:o,isListening:a?c:r,stopRecording:a?m:l,startRecording:a?u:i}};function HT({enabled:e}={}){const{data:t}=cj({enabled:e});return{connectionStatus:null==t?void 0:t.connectionStatus}}function GT({conversationId:e}={}){var t,s;const a=Uk(),r=pr(),{showToast:o}=$d(),{data:i}=Wy(),{mcpValues:l,setMCPValues:c,isPinned:d,setIsPinned:u}=function({conversationId:e}){const t=e??dh.NEW_CONVO,[s,a]=ge(Ny),[r,o]=ge(wy(t)),[i,l]=Ie(jy(t));n.useEffect((()=>{(null==i?void 0:i.mcp)&&i.mcp.length>0&&o(i.mcp)}),[null==i?void 0:i.mcp,o]),n.useEffect((()=>{l((e=>Eo(null==e?void 0:e.mcp,r)?e:{...e??{},mcp:r}))}),[r,l]),n.useEffect((()=>{const e=`${uh.LAST_MCP_}${t}`;r.length>0&&t_(e)}),[r,t]);const c=n.useCallback((e=>{Array.isArray(e)&&o(e)}),[o]);return{isPinned:s,mcpValues:r,setIsPinned:a,setMCPValues:c}}({conversationId:e}),[m,p]=n.useState(!1),[f,h]=n.useState(null),g=n.useRef(null),x=n.useRef(l);n.useEffect((()=>{x.current=l}),[l]);const v=n.useMemo((()=>(null==i?void 0:i.mcpServers)?Object.entries(i.mcpServers).filter((([,e])=>!1!==e.chatMenu)).map((([e])=>e)):[]),[null==i?void 0:i.mcpServers]),b=jk(),_=wk(),y=yk({onSuccess:async()=>{o({message:a("com_nav_mcp_vars_updated"),status:"success"}),await Promise.all([r.invalidateQueries([ex.mcpTools]),r.invalidateQueries([ex.mcpAuthValues]),r.invalidateQueries([ex.mcpConnectionStatus])])},onError:e=>{console.error("Error updating MCP auth:",e),o({message:a("com_nav_mcp_vars_update_error"),status:"error"})}}),[j,w]=n.useState((()=>{const e={};return v.forEach((t=>{e[t]={isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null}})),e})),{connectionStatus:N}=HT({enabled:!!(null==i?void 0:i.mcpServers)&&Object.keys(i.mcpServers).length>0}),C=n.useRef(!1);n.useEffect((()=>{if(!N||0===Object.keys(N).length)return;if(!C.current)return void(C.current=!0);if(!(null==l?void 0:l.length))return;const e=l.filter((e=>{var t;return"connected"===(null==(t=N[e])?void 0:t.connectionState)}));e.length!==l.length&&c(e)}),[N,l,c]);const k=n.useCallback(((e,t)=>{w((n=>{const s={...n},a=s[e]||{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null};return s[e]={...a,...t},s}))}),[]),S=n.useCallback((e=>{const t=j[e];(null==t?void 0:t.pollInterval)&&clearTimeout(t.pollInterval),k(e,{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null})}),[j,k]),T=n.useCallback((e=>{const t=j[e];if(null==t?void 0:t.pollInterval)return void console.debug(`[MCP Manager] Polling already active for ${e}, skipping duplicate`);let n=0,s=null;const i=e=>e<12?5e3:e<22?6e3:7500,l=18e4,d=async()=>{try{n++;const t=j[e],u=(null==t?void 0:t.oauthStartTime)?Date.now()-t.oauthStartTime:5e3*n;if(n>30||u>l)return console.warn(`[MCP Manager] OAuth timeout for ${e} after ${(u/1e3).toFixed(0)}s (attempt ${n})`),o({message:a("com_ui_mcp_oauth_timeout",{0:e}),status:"error"}),s&&clearTimeout(s),void S(e);await r.refetchQueries([ex.mcpConnectionStatus]);const m=r.getQueryData([ex.mcpConnectionStatus]),p=((null==m?void 0:m.connectionStatus)||{})[e];if("connected"===(null==p?void 0:p.connectionState)){s&&clearTimeout(s),o({message:a("com_ui_mcp_authenticated_success",{0:e}),status:"success"});const t=x.current??[];return t.includes(e)||c([...t,e]),await r.invalidateQueries([ex.mcpTools]),void setTimeout((()=>{S(e)}),1e3)}if((null==t?void 0:t.oauthStartTime)&&Date.now()-t.oauthStartTime>l)return o({message:a("com_ui_mcp_oauth_timeout",{0:e}),status:"error"}),s&&clearTimeout(s),void S(e);if("error"===(null==p?void 0:p.connectionState))return o({message:a("com_ui_mcp_init_failed"),status:"error"}),s&&clearTimeout(s),void S(e);const f=i(n);(n%5==0||n<=2)&&console.debug(`[MCP Manager] Polling ${e} attempt ${n}/30, next in ${f/1e3}s`),s=setTimeout(d,f),k(e,{pollInterval:s})}catch(t){return console.error(`[MCP Manager] Error polling server ${e}:`,t),s&&clearTimeout(s),void S(e)}};s=setTimeout(d,i(0)),k(e,{pollInterval:s})}),[r,j,o,a,c,S,k]),E=n.useCallback((async(e,t=!0)=>{k(e,{isInitializing:!0});try{const n=await b.mutateAsync(e);if(!n.success)return o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),S(e),n;if(n.oauthRequired&&n.oauthUrl)k(e,{oauthUrl:n.oauthUrl,oauthStartTime:Date.now(),isCancellable:!0,isInitializing:!0}),t&&window.open(n.oauthUrl,"_blank","noopener,noreferrer"),T(e);else{await r.invalidateQueries([ex.mcpConnectionStatus]),o({message:a("com_ui_mcp_initialized_success",{0:e}),status:"success"});const t=l??[];t.includes(e)||c([...t,e]),S(e)}return n}catch(n){console.error(`[MCP Manager] Failed to initialize ${e}:`,n),o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),S(e)}}),[k,b,T,r,o,a,l,S,c]),R=n.useCallback((e=>{_.mutate(e,{onSuccess:()=>{S(e),r.invalidateQueries([ex.mcpConnectionStatus]),o({message:a("com_ui_mcp_oauth_cancelled",{0:e}),status:"warning"})},onError:t=>{console.error(`[MCP Manager] Failed to cancel OAuth for ${e}:`,t),o({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"})}})}),[r,S,o,a,_]),I=n.useCallback((e=>{var t;return(null==(t=j[e])?void 0:t.isInitializing)||!1}),[j]),P=n.useCallback((e=>{var t;return(null==(t=j[e])?void 0:t.isCancellable)||!1}),[j]),A=n.useCallback((e=>{var t;return(null==(t=j[e])?void 0:t.oauthUrl)||null}),[j]),M=n.useMemo((()=>{var e,t;return(null==(t=null==(e=null==i?void 0:i.interface)?void 0:e.mcpServers)?void 0:t.placeholder)||a("com_ui_mcp_servers")}),[null==(s=null==(t=null==i?void 0:i.interface)?void 0:t.mcpServers)?void 0:s.placeholder,a]),L=n.useCallback((e=>{const t=[],n=[];e.forEach((e=>{if(I(e))return;const s=null==N?void 0:N[e];"connected"===(null==s?void 0:s.connectionState)?t.push(e):n.push(e)})),c(t),n.forEach((e=>{E(e)}))}),[N,c,E,I]),O=n.useCallback((e=>{if(I(e))return;const t=l??[];if(t.includes(e)){const n=t.filter((t=>t!==e));c(n)}else{const n=null==N?void 0:N[e];"connected"===(null==n?void 0:n.connectionState)?c([...t,e]):E(e)}}),[l,c,N,E,I]),D=n.useCallback(((e,t)=>{if(f&&f.name===e){const n={pluginKey:`${dh.mcp_prefix}${e}`,action:"install",auth:t};y.mutate(n)}}),[f,y]),F=n.useCallback((e=>{if(f&&f.name===e){const t={pluginKey:`${dh.mcp_prefix}${e}`,action:"uninstall",auth:{}};y.mutate(t);const n=(l??[]).filter((t=>t!==e));c(n)}}),[f,y,l,c]),z=n.useCallback((e=>{f&&D(f.name,e)}),[f,D]),U=n.useCallback((()=>{f&&F(f.name)}),[f,F]),V=n.useCallback((e=>{p(e),!e&&g.current&&setTimeout((()=>{g.current&&"function"==typeof g.current.focus&&g.current.focus(),g.current=null}),0)}),[]),B=n.useCallback((e=>{var t,n;const s=r.getQueryData([ex.mcpTools]),a=null==(t=null==s?void 0:s.servers)?void 0:t[e],o=null==N?void 0:N[e],l=null==(n=null==i?void 0:i.mcpServers)?void 0:n[e],c=(null==l?void 0:l.customUserVars)&&Object.keys(l.customUserVars).length>0;return{serverName:e,serverStatus:o,tool:a?{name:e,pluginKey:`${dh.mcp_prefix}${e}`,icon:a.icon,authenticated:a.authenticated}:void 0,onConfigClick:t=>{t.stopPropagation(),t.preventDefault(),g.current=document.activeElement;const n={name:e,pluginKey:`${dh.mcp_prefix}${e}`,authConfig:(null==a?void 0:a.authConfig)||((null==l?void 0:l.customUserVars)?Object.entries(l.customUserVars).map((([e,t])=>({authField:e,label:t.title,description:t.description}))):[]),authenticated:(null==a?void 0:a.authenticated)??!1};h(n),p(!0)},isInitializing:I(e),canCancel:P(e),onCancel:t=>{t.stopPropagation(),t.preventDefault(),R(e)},hasCustomUserVars:c}}),[r,P,I,R,N,null==i?void 0:i.mcpServers]),$=n.useCallback((()=>{if(!f)return null;const e={};(null==f?void 0:f.authConfig)&&f.authConfig.forEach((t=>{e[t.authField]={title:t.label||t.authField,description:t.description}}));const t={};return(null==f?void 0:f.authConfig)&&f.authConfig.forEach((e=>{t[e.authField]=""})),{serverName:f.name,serverStatus:null==N?void 0:N[f.name],isOpen:m,onOpenChange:V,fieldsSchema:e,initialValues:t,onSave:z,onRevoke:U,isSubmitting:y.isLoading}}),[f,N,m,V,z,U,y.isLoading]);return{configuredServers:v,initializeServer:E,cancelOAuthFlow:R,isInitializing:I,isCancellable:P,getOAuthUrl:A,mcpValues:l,setMCPValues:c,isPinned:d,setIsPinned:u,placeholderText:M,batchToggleServers:L,toggleServerSelection:O,localize:a,isConfigModalOpen:m,handleDialogOpenChange:V,selectedToolForConfig:f,setSelectedToolForConfig:h,handleSave:z,handleRevoke:U,getServerStatusIconProps:B,getConfigDialogProps:$}}function KT(e){const t=Uk(),{showToast:s}=$d(),{getValues:a,setValue:r}=Uo(),o=!1!==(null==e?void 0:e.showToast);return{removeTool:n.useCallback((e=>{if(!e)return;const n=a("tools"),i=(null==n?void 0:n.filter((t=>t!==e&&!t.endsWith(`${dh.mcp_delimiter}${e}`))))||[];r("tools",i,{shouldDirty:!0}),o&&s({message:t("com_ui_delete_tool_save_reminder"),status:"warning"})}),[a,r,s,t,o])}}function WT(e=.01,t=.007,s){const a=n.useCallback((e=>{const n=e?e/1048576:0;return e?n<=1?.1:Math.max(.05/Math.sqrt(n),.002):t}),[t]),r=n.useMemo((()=>a(s)),[s,a]),[o,i]=n.useState(e),l=n.useCallback((e=>r),[r,s]);return n.useEffect((()=>{let t,n;if(!(e>=1&&o>=1))return e>=1&&o<1?(i(.99),t=setTimeout((()=>{i(1)}),200)):n=setInterval((()=>{i((e=>{if(e>=1)return clearInterval(n),1;const t=l(e);return Math.min(e+t,.95)}))}),200),()=>{clearInterval(n),clearTimeout(t)}}),[o,e,r,s,l]),o}function qT({messageId:e,attachments:t}){const s=Ae(Cy.messageAttachmentsMap),a=n.useMemo((()=>t??s[e??""]??[]),[t,s,e]),r=function(e){const t=Uk();return n.useMemo((()=>{const n={};let s=0;return null==e||e.forEach((e=>{if(e.type===Jd.web_search&&e[Jd.web_search]){const t=e[Jd.web_search];t&&"number"==typeof t.turn&&(n[t.turn.toString()]=t)}if(e.type===Jd.file_search&&e[Jd.file_search]){const a=e[Jd.file_search].sources,r=new Map;a.forEach((e=>{const t=e.fileId;if(r.has(t)){const n=r.get(t);if(n){const t=[...n.pages||[],...e.pages||[]],s=[...new Set(t)].sort(((e,t)=>e-t)),a={...n.pageRelevance||{},...e.pageRelevance||{}};n.pages=s,n.relevance=Math.max(n.relevance||0,e.relevance||0),n.pageRelevance=a}}else r.set(t,{fileId:e.fileId,fileName:e.fileName,pages:e.pages||[],relevance:e.relevance||.5,pageRelevance:e.pageRelevance||{},metadata:e.metadata})}));const o={turn:s,organic:[],topStories:[],images:[],references:Array.from(r.values()).map((e=>({title:e.fileName||t("com_file_unknown"),link:`#file-${e.fileId}`,attribution:e.fileName||t("com_file_unknown"),snippet:e.pages&&e.pages.length>0?t("com_file_pages",{pages:e.pages.join(", ")}):"",type:"file",fileId:e.fileId,fileName:e.fileName,pages:e.pages,pageRelevance:e.pageRelevance,metadata:e.metadata})))};n[s.toString()]=o,s++}})),n}),[e,t])}(a);return{attachments:a,searchResults:r}}const QT=(e,t)=>t?`${t}${dh.COMMON_DIVIDER}${e}`:t;function YT(){const{user:e}=qk(),t=uS(),{ask:s,index:a,getMessages:r,setMessages:o,latestMessage:i}=Mk(),{addedIndex:l,ask:c,conversation:d}=oS(),u=Ae(Cy.autoSendPrompts),m=Ae(Cy.allConversationsSelector),p=Pe(Cy.activePromptByIndex(a)),f=n.useCallback((e=>{if(!e)return console.warn("No data provided to submitMessage");const n=r();!(null==n?void 0:n.some((e=>e.messageId===(null==i?void 0:i.messageId))))&&i&&o([...n||[],i]);const a=l&&m[l]&&d,u=a&&m.every((e=>e===dh.NEW_CONVO))&&!(null==n?void 0:n.length)?Xe():void 0,p=a?Xe():void 0,f=l-1,h=(new Date).toISOString();s({text:e.text,overrideConvoId:QT(f,u),overrideUserMessageId:QT(f,p),clientTimestamp:h}),a&&c({text:e.text,overrideConvoId:QT(l,u),overrideUserMessageId:QT(l,p),clientTimestamp:h},{overrideMessages:n}),t.reset()}),[s,t,l,d,o,r,m,c,i]),h=n.useCallback((n=>{const s=Mh({text:n,user:e});if(u)return void f({text:s});const a=t.getValues("text").trim().length>1?`\n${s}`:s;p(a)}),[u,f,p,t,e]);return{submitMessage:f,submitPrompt:h}}const XT=/(\\ue203.*?\\ue204)/g,ZT=/(\\ue200.*?\\ue201)/g,JT=/\\ue202turn(\d+)(search|image|news|video|ref|file)(\d+)/g,eE=/\\ue200|\\ue201|\\ue202|\\ue203|\\ue204|\\ue206/g,tE=/\s*\\ue202turn\d+(search|news|image|video|ref|file)\d+/g,nE={search:"organic",ref:"references",news:"topStories",image:"images",video:"videos"};function sE({text:e,content:t,searchResults:s}){const a=n.useRef(null);n.useEffect((()=>()=>{a.current&&clearTimeout(a.current)}),[]);return n.useCallback((n=>{a.current&&clearTimeout(a.current),n(!0);let r=e??"";if(t&&(r=t.reduce(((e,n,s)=>{if(n.type===hh.TEXT){return e+("string"==typeof n.text?n.text:n.text.value)+(s===t.length-1?"":"\n")}return e}),"")),!s||0===Object.keys(s).length){const e=r.replace(tE,"").replace(eE,"");return ot(e,{format:"text/plain"}),void(a.current=setTimeout((()=>{n(!1)}),3e3))}const o=function(e,t){var n,s;const a=new Map,r=new Map;let o=1,i=e;i=i.replace(XT,(e=>`**${e.replace(/\\ue203|\\ue204/g,"")}**`));const l=[];let c;const d=new RegExp(JT.source,"g");for(;null!==(c=d.exec(i));)l.push({turn:c[1],type:c[2],index:c[3],position:c.index,fullMatch:c[0],isComposite:!1});let u;const m=new RegExp(ZT.source,"g");for(;null!==(u=m.exec(i));){const e=u[0],t=u.index;let n;const s=new RegExp(JT.source,"g");for(;null!==(n=s.exec(e));)l.push({turn:n[1],type:n[2],index:n[3],position:t+n.index,fullMatch:e,isComposite:!0})}l.sort(((e,t)=>e.position-t.position));const p=new Set,f=[],h=new Map;for(const g of l){const{turn:e,type:i,index:l,fullMatch:c,isComposite:d}=g,u=t[e];if(!u)continue;const m=nE[i.toLowerCase()]||i.toLowerCase(),x=parseInt(l,10);if(!u[m]||!u[m][x])continue;const v=u[m][x],b=v.link||"";if(!b)continue;let _=r.get(b);_||(_=`${e}-${m}-${x}`,r.set(b,_));const y={link:b,title:v.title||v.name||"",attribution:v.attribution||v.source||"",type:m,typeIndex:x,citationKey:_};if(d&&p.has(c))continue;let j="",w=a.get(_);if(w||(w={referenceNumber:o++,link:y.link,title:y.title,source:y},a.set(_,w)),w){if(d){if(!p.has(c)){const e=[];let i;const l=new RegExp(JT.source,"g");for(;null!==(i=l.exec(c));){const l=i[1],c=i[2],d=i[3],u=nE[c.toLowerCase()]||c.toLowerCase(),m=null==(s=null==(n=t[l])?void 0:n[u])?void 0:s[parseInt(d,10)];if(m&&m.link){const t=m.link;let n=r.get(t);n||(n=`${l}-${u}-${d}`,r.set(t,n));let s=a.get(n);s||(s={referenceNumber:o++,link:m.link,title:m.title||m.name||"",source:{link:m.link,title:m.title||m.name||"",attribution:m.attribution||m.source||"",type:u,typeIndex:parseInt(d,10),citationKey:n}},a.set(n,s)),s&&e.push(s.referenceNumber)}}const d=[...new Set(e)].sort(((e,t)=>e-t));j=d.length>0?d.map((e=>`[${e}]`)).join(""):"",p.add(c),h.set(c,d),f.push([c,j])}continue}j=`[${w.referenceNumber}]`,f.push([c,j])}}f.sort(((e,t)=>t[0].length-e[0].length));for(const[g,x]of f)i=i.replace(g,x);return i=i.replace(/\n\s*\[\d+\](\[\d+\])*\s*$/g,""),i=i.replace(tE,""),i=i.replace(eE,""),{formattedText:i,citations:a}}(r,s);let i=o.formattedText;if(o.citations.size>0){i+="\n\nCitations:\n";const e=Array.from(o.citations.entries()).sort(((e,t)=>e[1].referenceNumber-t[1].referenceNumber));for(const[t,n]of e)i+=`[${n.referenceNumber}] ${n.link}\n`}ot(i,{format:"text/plain"}),a.current=setTimeout((()=>{n(!1)}),3e3)}),[e,t,s])}function aE(e){const t=Uk(),{user:s}=qk(),a=Ae(Cy.UsernameDisplay),{message:r,currentEditId:o,setCurrentEditId:i,isMultiMessage:l,searchResults:c}=e,{ask:d,index:u,regenerate:m,latestMessage:p,handleContinue:f,setLatestMessage:h,conversation:g,isSubmitting:x}=Mk(),{conversation:v,isSubmitting:b}=oS(),_=n.useMemo((()=>!0===l?v:g),[l,v,g]),y=zk(),j=bS(),{text:w,content:N,messageId:C=null,isCreatedByUser:k}=r??{},S=n.useMemo((()=>C===o),[C,o]),[T,E]=n.useState((()=>{var e,t;if(null==r?void 0:r.feedback){const n=wu(null==(t=null==(e=r.feedback)?void 0:e.tag)?void 0:t.key);return{rating:r.feedback.rating,tag:n,text:r.feedback.text}}})),R=n.useCallback((e=>i&&i(!0===e?-1:C)),[C,i]),I=n.useMemo((()=>{if(!Mu(null==_?void 0:_.endpoint))return;const e=(null==_?void 0:_.endpoint)??"",t=(null==r?void 0:r.model)??"";return(null==j?void 0:j[e])?j[e][t]:void 0}),[null==_?void 0:_.endpoint,null==r?void 0:r.model,j]),P=n.useMemo((()=>{if(!Lu(null==_?void 0:_.endpoint))return;if(!y)return;const e=(null==r?void 0:r.model)??"";if(e)return y[e];const t=(null==_?void 0:_.agent_id)??"";return t?y[t]:void 0}),[y,null==_?void 0:_.agent_id,null==_?void 0:_.endpoint,null==r?void 0:r.model]),A=n.useMemo((()=>!0===l?b:x),[l,b,x]),M=n.useCallback((()=>{A&&!0===k||!r||m(r)}),[A,k,r,m]),L=sE({text:w,content:N,searchResults:c}),O=n.useMemo((()=>!0===(null==r?void 0:r.isCreatedByUser)?a?((null==s?void 0:s.name)??"")||(null==s?void 0:s.username):t("com_user_message"):P?P.name??"Assistant":I?I.name??"Assistant":null==r?void 0:r.sender),[r,P,I,a,s,t]),D=Ck((null==_?void 0:_.conversationId)||"",(null==r?void 0:r.messageId)||""),F=n.useCallback((({feedback:e})=>{const t={feedback:e?ju(e):void 0};D.mutate(t,{onSuccess:e=>{var t;if(e.feedback){const n=wu((null==(t=e.feedback)?void 0:t.tag)??void 0);E({rating:e.feedback.rating,tag:n,text:e.feedback.text})}else E(void 0)},onError:e=>{console.error("Failed to update feedback:",e)}})}),[D]);return{ask:d,edit:S,index:u,agent:P,assistant:I,enterEdit:R,conversation:_,messageLabel:O,isSubmitting:A,latestMessage:p,handleContinue:f,copyToClipboard:L,setLatestMessage:h,regenerateMessage:M,handleFeedback:F,feedback:T}}function rE({message:e}){const t=n.useRef(""),[s,a]=n.useState(null),r=n.useMemo((()=>{var t;return 0===((null==(t=null==e?void 0:e.children)?void 0:t.length)??0)}),[e]),{index:o,conversation:i,latestMessage:l,setAbortScroll:c,setLatestMessage:d,isSubmittingFamily:u}=XS(),m=Ae(Cy.latestMessageFamily(o+1));n.useEffect((()=>{const n=null==i?void 0:i.conversationId;if(n===dh.NEW_CONVO)return;if(!e)return;if(!r)return;const s=yb(e,n),a={textKey:s,"latestText.current":t.current,messageId:e.messageId,convoId:n};s!==t.current||null!=n&&t.current&&n!==t.current.split(dh.COMMON_DIVIDER)[2]?(a_.log("latest_message","[useMessageProcess] Setting latest message; logInfo:",a),t.current=s,d({...e})):a_.log("latest_message","No change in latest message; logInfo",a)}),[r,e,d,null==i?void 0:i.conversationId]);const p=n.useCallback((e=>{To((()=>{a_.log("message_scrolling",`useMessageProcess: setting abort scroll to ${u}, handleScroll event`,e),c(!!u)}),500)()}),[u,c]),f=n.useMemo((()=>{var e;return r&&m&&0===((null==(e=m.children)?void 0:e.length)??0)||!!s}),[r,m,s]);return n.useEffect((()=>{if(r&&m&&m.conversationId===(null==e?void 0:e.conversationId)){const t=Object.assign({},m,{parentMessageId:e.parentMessageId,depth:e.depth});a(t)}}),[r,m,e,a,l]),{showSibling:f,handleScroll:p,conversation:i,siblingMessage:s,setSiblingMessage:a,isSubmittingFamily:u,latestMultiMessage:m}}const oE=.85,iE=150;function lE(e){const t=Ae(Cy.autoScroll),s=n.useRef(null),a=n.useRef(null),[r,o]=n.useState(!1),{conversation:i,conversationId:l}=ZS(),{setAbortScroll:c,isSubmitting:d,abortScroll:u}=function(){const{isSubmitting:e,isSubmittingFamily:t,abortScroll:s,setAbortScroll:a}=XS();return n.useMemo((()=>({isSubmitting:e,isSubmittingFamily:t,abortScroll:s,setAbortScroll:a})),[e,t,s,a])}(),m=n.useRef(),p=n.useCallback((e=>{clearTimeout(m.current),m.current=setTimeout((()=>{o(e)}),iE)}),[]);n.useEffect((()=>{if(!a.current||!s.current)return;const e=new IntersectionObserver((([e])=>{p(!e.isIntersecting)}),{root:s.current,threshold:oE});return e.observe(a.current),()=>{e.disconnect(),clearTimeout(m.current)}}),[a,s,p]);const f=n.useCallback((()=>{if(a.current&&s.current){const e=new IntersectionObserver((([e])=>{p(!e.isIntersecting)}),{root:s.current,threshold:oE});return e.observe(a.current),()=>e.disconnect()}}),[p]),h=()=>p(!1),{scrollToRef:g,handleSmoothToRef:x}=function({targetRef:e,callback:t,smoothCallback:s}){const a=(t,n)=>{var s;null==(s=e.current)||s.scrollIntoView({behavior:t}),n()},r=n.useCallback(To((()=>a("instant",t)),145,{leading:!0}),[e]),o=n.useCallback(To((()=>a("smooth",s)),750,{leading:!0}),[e]);return{scrollToRef:r,handleSmoothToRef:e=>{e.preventDefault(),o()}}}({targetRef:a,callback:h,smoothCallback:()=>{h(),c(!1)}});return n.useEffect((()=>{if(e&&0!==e.length&&a.current&&s.current)return d&&g&&!0!==u&&g(),()=>{!0===u&&g&&g.cancel()}}),[d,e,g,u]),n.useEffect((()=>{a.current&&s.current&&g&&t&&l!==dh.NEW_CONVO&&g()}),[t,l,g]),{conversation:i,scrollableRef:s,messagesEndRef:a,scrollToBottom:g,showScrollButton:r,handleSmoothToRef:x,debouncedHandleScroll:f}}function cE({conversationId:e,toolKey:t,localStorageKey:s,isAuthenticated:a,setIsDialogOpen:r,authConfig:o}){var i;const l=e??dh.NEW_CONVO,[c,d]=Ie(jy(l)),u=ij({toolId:(null==o?void 0:o.toolId)||""},{enabled:!!(null==o?void 0:o.toolId),...null==o?void 0:o.queryOptions}),m=n.useMemo((()=>{var e;return a??(!!o&&((null==(e=null==u?void 0:u.data)?void 0:e.authenticated)??!1))}),[a,o,null==(i=u.data)?void 0:i.authenticated]),p=n.useMemo((()=>t),[t]),f=n.useMemo((()=>`${s}${l}`),[s,l]),h=n.useMemo((()=>(null==c?void 0:c[p])??!1),[c,p]),g=n.useMemo((()=>"string"==typeof h?h.length>0:!0===h),[h]);n.useEffect((()=>{const e=null==c?void 0:c[p];void 0!==e&&(localStorage.setItem(f,JSON.stringify(e)),t_(f))}),[c,p,f]);const[x,v]=function(e,t,s,a){const[r,o]=n.useState(t);n.useEffect((()=>{const n=localStorage.getItem(e);n||localStorage.setItem(e,JSON.stringify(t));const s=n&&"undefined"!==n?JSON.parse(n):t;function a(t){if(t.key!==e)return;const n=localStorage.getItem(e);o(JSON.parse(n??""))}return o(s),window.addEventListener("storage",a),()=>{window.removeEventListener("storage",a)}}),[e,s]);const i=n.useCallback((t=>{try{o(t),a||(localStorage.setItem(e,JSON.stringify(t)),null==window||window.dispatchEvent(new StorageEvent("storage",{key:e}))),null==s||s(t)}catch(Fi){console.error(Fi)}}),[e,s,a]);return[r,i]}(`${s}pinned`,!1),b=n.useCallback((({e:e,value:t})=>{var n;if(void 0!==m&&!m&&r)return r(!0),null==(n=null==e?void 0:e.preventDefault)||n.call(e),void d((e=>({...e||{},[p]:!1})));d((e=>({...e||{},[p]:t})))}),[r,m,d,p]),_=n.useMemo((()=>ko(b,50,{leading:!0})),[b]);return{toggleState:h,handleChange:b,isToolEnabled:g,toolValue:h,setToggleState:e=>b({value:e}),ephemeralAgent:c,debouncedChange:_,setEphemeralAgent:d,authData:null==u?void 0:u.data,isPinned:x,setIsPinned:v}}const dE=e=>{const t=pr(),s=null==e?void 0:e.isEntityTool,a=yk({onMutate:e=>{t.setQueryData([ex.toolAuth,Jd.execute_code],(()=>({authenticated:"install"===e.action,message:vu.USER_PROVIDED})))},onSuccess:()=>{t.invalidateQueries([ex.toolAuth,Jd.execute_code])},onError:()=>{t.invalidateQueries([ex.toolAuth,Jd.execute_code])}}),r=n.useCallback((e=>{a.mutate({pluginKey:Jd.execute_code,action:"install",auth:{LIBRECHAT_CODE_API_KEY:e},isEntityTool:s})}),[a,s]);return{removeTool:n.useCallback((()=>{a.mutate({pluginKey:Jd.execute_code,action:"uninstall",auth:{LIBRECHAT_CODE_API_KEY:null},isEntityTool:s})}),[a,s]),installTool:r}};function uE({onSubmit:e,onRevoke:t}){const s=Vo(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=dE({isEntityTool:!0}),{reset:d}=s,u=n.useCallback((t=>{d(),l(t.apiKey),i(!1),null==e||e()}),[e,d,l]),m=n.useCallback((()=>{d(),c(),i(!1),null==t||t()}),[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}const mE=e=>{const t=pr(),s=null==e?void 0:e.isEntityTool,a=yk({onMutate:e=>{t.setQueryData([ex.toolAuth,Jd.web_search],(()=>({authenticated:"install"===e.action,authTypes:"install"===e.action?[["providers",vu.USER_PROVIDED],["scrapers",vu.USER_PROVIDED],["rerankers",vu.USER_PROVIDED]]:[]})))},onSuccess:()=>{t.invalidateQueries([ex.toolAuth,Jd.web_search])},onError:()=>{t.invalidateQueries([ex.toolAuth,Jd.web_search])}}),r=n.useCallback((e=>{const t=Object.entries({serperApiKey:e.serperApiKey,searxngInstanceUrl:e.searxngInstanceUrl,searxngApiKey:e.searxngApiKey,firecrawlApiKey:e.firecrawlApiKey,firecrawlApiUrl:e.firecrawlApiUrl,jinaApiKey:e.jinaApiKey,jinaApiUrl:e.jinaApiUrl,cohereApiKey:e.cohereApiKey}).reduce(((e,[t,n])=>(n&&(e[t]=n),e)),{});a.mutate({pluginKey:Jd.web_search,action:"install",auth:t,isEntityTool:s})}),[a,s]);return{removeTool:n.useCallback((()=>{a.mutate({pluginKey:Jd.web_search,action:"uninstall",auth:{},isEntityTool:s})}),[a,s]),installTool:r}};function pE({onSubmit:e,onRevoke:t}){const s=Vo(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=mE({isEntityTool:!0}),{reset:d}=s,u=n.useCallback((t=>{l(t),i(!1),null==e||e()}),[e,l]),m=n.useCallback((()=>{d(),c(),i(!1),null==t||t()}),[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}function fE(){const[e,t]=n.useState(1),[s,a]=n.useState(1),[r,o]=n.useState(1),[i,l]=n.useState(!1),[c,d]=n.useState(""),[u,m]=n.useState(!1),[p,f]=n.useState(""),[h,g]=n.useState(!1),[x,v]=n.useState(void 0),b=e=>{const t=e.offsetWidth;let n;t<501?o(8):(n=t<640?2:t<1024?3:4,o(2*n))},_=n.useCallback((e=>{if(null!==e){1===r&&b(e);new ResizeObserver((()=>b(e))).observe(e)}}),[r]);return{maxPage:e,setMaxPage:t,currentPage:s,setCurrentPage:a,itemsPerPage:r,setItemsPerPage:o,searchChanged:i,setSearchChanged:l,searchValue:c,setSearchValue:d,gridRef:_,handleSearch:e=>{d(e.target.value),l(!0)},handleChangePage:e=>{a(e)},error:u,setError:m,errorMessage:p,setErrorMessage:f,showPluginAuthForm:h,setShowPluginAuthForm:g,selectedPlugin:x,setSelectedPlugin:v}}const hE=[{label:"com_ui_loading",value:""}],gE={label:"com_ui_empty_category",value:""},xE=({className:e="",hasAccess:t=!0})=>{const n=Uk(),{data:a=hE}=(r={enabled:t,select:t=>t.map((t=>({label:n(t.label),value:t.value,icon:t.value?s.jsx(GS,{category:t.value,className:e}):null})))},mr([ex.categories],(()=>fx.getCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...r,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled}));var r;return{categories:a,emptyCategory:gE}};const vE=()=>{const e=Qk({permissionType:Zh.PEOPLE_PICKER,permission:Jh.VIEW_USERS}),t=Qk({permissionType:Zh.PEOPLE_PICKER,permission:Jh.VIEW_GROUPS}),s=Qk({permissionType:Zh.PEOPLE_PICKER,permission:Jh.VIEW_ROLES}),a=e||t||s,r=n.useMemo((()=>{const n=[];return e&&n.push(Wg.USER),t&&n.push(Wg.GROUP),s&&n.push(Wg.ROLE),0===n.length||3===n.length?null:n}),[e,t,s]);return{canViewUsers:e,canViewRoles:s,canViewGroups:t,hasPeoplePickerAccess:a,peoplePickerTypeFilter:r}},bE=(e,t,s=!1)=>{var a;const r=(e=>Db[e])(e),o=!!t&&""!==t.trim(),{data:i,isLoading:l,error:c}=Tk(e,t||"",{enabled:o}),d=Ek(),u=(null==(a=null==i?void 0:i.principals)?void 0:a.map((e=>({type:e.type,id:e.id,name:e.name,email:e.email,source:e.source,avatar:e.avatar,description:e.description,accessRoleId:e.accessRoleId,idOnTheSource:e.idOnTheSource}))))||[],m=(null==i?void 0:i.public)??!1,p=(null==i?void 0:i.publicAccessRoleId)||(null==r?void 0:r.defaultViewerRoleId),[f,h]=n.useState(!1),[g,x]=n.useState(null==r?void 0:r.defaultViewerRoleId);return n.useEffect((()=>{i&&s&&(h(m??!1),x(p))}),[i,s,m,p]),{config:r,permissionsData:i,isLoadingPermissions:l,permissionsError:c,updatePermissionsMutation:d,currentShares:u,currentIsPublic:m,currentPublicRole:p,isPublic:f,setIsPublic:h,publicRole:g,setPublicRole:x}};function _E(e){const t=Pe(Cy.messageAttachmentsMap);return({data:n})=>{const{messageId:s}=n;if(e&&(null==n?void 0:n.filepath)&&!n.filepath.includes("/api/files")&&e.setQueryData([ex.files],(e=>[n,...e||[]])),e&&n.type===Jd.memory&&n[Jd.memory]){const t=n[Jd.memory];e.setQueryData([ex.memories],(e=>e&&function({memoryArtifact:e,currentData:t}){const{type:n,key:s,value:a,tokenCount:r=0}=e;if("update"===n&&!a)return;const o=t.memories,i=o.findIndex((e=>e.key===s));if("delete"===n){if(-1===i)return;const e=o[i],n=[...o];n.splice(i,1);const s=t.totalTokens-(e.tokenCount||0),a=t.tokenLimit?Math.min(100,Math.round(s/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:s,usagePercentage:a}}if("update"===n){const e=(new Date).toISOString();let n,l=t.totalTokens;i>=0?(l=l-(o[i].tokenCount||0)+r,n=[...o],n[i]={key:s,value:a,tokenCount:r,updated_at:e}):(l+=r,n=[...o,{key:s,value:a,tokenCount:r,updated_at:e}]);const c=t.tokenLimit?Math.min(100,Math.round(l/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:l,usagePercentage:c}}}({memoryArtifact:t,currentData:e})||e))}t((e=>{const t=e[s]||[];return{...e,[s]:[...t,n]}}))}}const yE=({errorMetadata:e,getMessages:t,submission:n,error:s})=>{const a=t(),r=null==a?void 0:a[a.length-1];let o;const i=n.initialResponse.text.length>45?n.initialResponse.text:"",l=((null==e?void 0:e.text)||i||(null==s?void 0:s.message))??"Error cancelling request",c=(null==r?void 0:r.content)??[];let d=!1;if(c.length>0){const e=c[c.length-1],t=null==e?void 0:e[e.type??""];d=e.type!==hh.TEXT||e.type===hh.TEXT&&"string"==typeof t||""!==(null==t?void 0:t.value)}if((null==r?void 0:r.conversationId)&&(null==r?void 0:r.messageId)&&c&&d){const t=[...c];return t.push({type:hh.ERROR,error:l}),o={...r,...e,error:void 0,text:"",content:t},n.userMessage.messageId&&n.userMessage.messageId!==o.parentMessageId&&(o.parentMessageId=n.userMessage.messageId),o}return e||(o={...n,...n.initialResponse,text:l,unfinished:!!i.length,error:!0},om.parse(o))},jE=({parentId:e,queryClient:t,currentTitle:n,conversationId:s})=>{if(e!==dh.NO_PARENT&&(null==n?void 0:n.toLowerCase().includes("new chat"))){const e=t.getQueryData([ex.conversation,s]);if(null==e?void 0:e.title)return e.title;const n=ib(t.getQueryData([ex.allConversations]),s??"");return(null==n?void 0:n.title)??(null==e?void 0:e.title)??null}return n};function wE({genTitle:e,setMessages:t,getMessages:s,setCompleted:a,isAddedRequest:r=!1,setConversation:o,setIsSubmitting:i,newConversation:l,setShowStopButton:c,resetLatestMessage:d}){const u=pr(),{announcePolite:m}=jS(),p=Re((({snapshot:e,set:t})=>async(n,s=dh.NEW_CONVO,a)=>{const r=s||dh.NEW_CONVO;if(a_.log("agents",`Attempting to apply template from "${r}" to "${n}"`),n!==r)try{const s=a??await e.getPromise(jy(r));s?(a_.log("agents",`Applying agent template to "${n}":`,s),t(jy(n),s)):(a_.warn("agents",`Agent template from "${r}" is null or unset. Setting agent for "${n}" to null.`),t(jy(n),null))}catch(o){a_.error("agents",`Error applying agent template from "${r}" to "${n}":`,o),t(jy(n),null)}else a_.warn("agents",`Attempted to apply template to itself ("${r}"). Skipping.`)}),[]),f=Pe(Cy.abortScroll),h=Fe(),g=De(),x=n.useRef(Date.now()),{conversationId:v}=nt(),{token:b}=qk(),_=function({setMessages:e,getMessages:t}){const s=pr(),a=n.useMemo((()=>new Map),[]);return n.useCallback((({data:n,submission:r})=>{const{type:o,messageId:i,thread_id:l,conversationId:c,index:d}=n,u=t(),m=(null==u?void 0:u.filter((e=>e.messageId!==i)).map((e=>({...e,thread_id:l}))))??[],p=m[m.length-1],{initialResponse:f}=r;let h=a.get(i);h||(h={...f,parentMessageId:(null==p?void 0:p.messageId)??"",conversationId:c,messageId:i,thread_id:l},a.set(i,h));const g=n[hh.TEXT],x=null!=g&&"string"==typeof g?{value:g}:n[o];o===hh.IMAGE_FILE&&Dv(s,x),h.content=[...h.content??[]],h.content[d]={type:o,[o]:x},o!==hh.TEXT&&f.content&&(h.content[h.content.length-1].type===hh.TOOL_CALL&&1===h.content[h.content.length-1][hh.TOOL_CALL].progress||h.content[h.content.length-1].type===hh.IMAGE_FILE)&&h.content.push(f.content[0]),e([...m,h])}),[s,t,a,e])}({setMessages:t,getMessages:s}),{stepHandler:y,clearStepMaps:j}=function({setMessages:e,getMessages:t,setIsSubmitting:s,announcePolite:a,lastAnnouncementTimeRef:r}){const o=n.useRef(new Map),i=n.useRef(new Map),l=n.useRef(new Map),c=(e,t,n,s)=>{var a;if(t.length>0&&(n===hh.TEXT||n===hh.THINK)){const r=e+t.length-1;if((null==(a=null==s?void 0:s[r])?void 0:a.type)===n)return r}return e+t.length},d=(e,t,n,s=!1)=>{const a=n.type??"";if(!a)return console.warn("No content type found in content part"),e;const r=[...e.content||[]];if(r[t]||(r[t]={type:n.type}),a.startsWith(hh.TEXT)&&hh.TEXT in n&&"string"==typeof n.text){const e=r[t],s={type:hh.TEXT,text:(e.text||"")+n.text};null!=n.tool_call_ids&&(s.tool_call_ids=n.tool_call_ids),r[t]=s}else if(a.startsWith(hh.AGENT_UPDATE)&&hh.AGENT_UPDATE in n&&n.agent_update){const e={type:hh.AGENT_UPDATE,agent_update:n.agent_update};r[t]=e}else if(a.startsWith(hh.THINK)&&hh.THINK in n&&"string"==typeof n.think){const e=r[t],s={type:hh.THINK,think:(e.think||"")+n.think};r[t]=s}else if(a===hh.IMAGE_URL&&"image_url"in n){const e=r[t];r[t]={...e}}else if(a===hh.TOOL_CALL&&"tool_call"in n){const e=r[t],a=null==e?void 0:e.tool_call,o=n.tool_call.args,i=s||"object"==typeof(null==a?void 0:a.args)||"object"==typeof o?n.tool_call.args:((null==a?void 0:a.args)??"")+(o??""),l={id:Ch([n.tool_call.id,null==a?void 0:a.id])??"",name:Ch([n.tool_call.name,null==a?void 0:a.name])??"",args:i,type:xh.TOOL_CALL,auth:n.tool_call.auth,expires_at:n.tool_call.expires_at};s&&(l.progress=1,l.output=n.tool_call.output),r[t]={type:hh.TOOL_CALL,tool_call:l}}return{...e,content:r}};return{stepHandler:n.useCallback((({event:n,data:u},m)=>{var p,f,h,g,x,v,b,_,y,j,w,N,C;const k=t()||[],{userMessage:S}=m;s(!0);let T=S.messageId;const E=Date.now();E-r.current>Kd&&(a({message:"composing",isStatus:!0}),r.current=E);let R=[];if(null!=(null==m?void 0:m.editedContent)&&(R=(null==(p=null==m?void 0:m.initialResponse)?void 0:p.content)??R),"on_run_step"===n){const t=u;let n=t.runId??"";if(n===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(n=(null==(f=null==m?void 0:m.initialResponse)?void 0:f.messageId)??"",T=(null==(h=null==m?void 0:m.initialResponse)?void 0:h.parentMessageId)??""),!n)return void console.warn("No message id found in run step event");l.current.set(t.id,t);let s=i.current.get(n);if(s||(s={...k[k.length-1],parentMessageId:T,conversationId:S.conversationId,messageId:n,content:R},i.current.set(n,s),e([...k.slice(0,-1),s])),t.stepDetails.type===gh.TOOL_CALLS){let a={...s};t.stepDetails.tool_calls.forEach((e=>{const n=e.id??"";"id"in e&&n&&o.current.set(t.id,n);const s={type:hh.TOOL_CALL,tool_call:{name:e.name??"",args:e.args,id:n}},r=t.index+R.length;a=d(a,r,s)})),i.current.set(n,a);const r=k.map((e=>e.messageId===n?a:e));e(r)}}else if("on_agent_update"===n){const{agent_update:n}=u;let s=n.runId||"";if(s===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(g=null==m?void 0:m.initialResponse)?void 0:g.messageId)??"",T=(null==(x=null==m?void 0:m.initialResponse)?void 0:x.parentMessageId)??""),!s)return void console.warn("No message id found in agent update event");const a=i.current.get(s);if(a){const r=n.index+R.length,o=d(a,r,u);i.current.set(s,o);const l=t()||[];e([...l.slice(0,-1),o])}}else if("on_message_delta"===n){const n=u,s=l.current.get(n.id);let a=(null==s?void 0:s.runId)??"";if(a===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(v=null==m?void 0:m.initialResponse)?void 0:v.messageId)??"",T=(null==(b=null==m?void 0:m.initialResponse)?void 0:b.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for message delta event");const r=i.current.get(a);if(r&&n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(s.index,R,o.type||"",r.content),u=d(r,l,o);i.current.set(a,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_reasoning_delta"===n){const n=u,s=l.current.get(n.id);let a=(null==s?void 0:s.runId)??"";if(a===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(_=null==m?void 0:m.initialResponse)?void 0:_.messageId)??"",T=(null==(y=null==m?void 0:m.initialResponse)?void 0:y.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for reasoning delta event");const r=i.current.get(a);if(r&&null!=n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(s.index,R,o.type||"",r.content),u=d(r,l,o);i.current.set(a,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_run_step_delta"===n){const t=u,n=l.current.get(t.id);let s=(null==n?void 0:n.runId)??"";if(s===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(j=null==m?void 0:m.initialResponse)?void 0:j.messageId)??"",T=(null==(w=null==m?void 0:m.initialResponse)?void 0:w.parentMessageId)??""),!n||!s)return void console.warn("No run step or runId found for run step delta event");const a=i.current.get(s);if(a&&t.delta.type===gh.TOOL_CALLS&&t.delta.tool_calls){let r={...a};t.delta.tool_calls.forEach((e=>{const s=o.current.get(t.id)??"",a={type:hh.TOOL_CALL,tool_call:{name:e.name??"",args:e.args??"",id:s}};null!=t.delta.auth&&(a.tool_call.auth=t.delta.auth,a.tool_call.expires_at=t.delta.expires_at);const i=n.index+R.length;r=d(r,i,a)})),i.current.set(s,r);const l=k.map((e=>e.messageId===s?r:e));e(l)}}else if("on_run_step_completed"===n){const{result:t}=u,{id:n}=t,s=l.current.get(n);let a=(null==s?void 0:s.runId)??"";if(a===dh.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(N=null==m?void 0:m.initialResponse)?void 0:N.messageId)??"",T=(null==(C=null==m?void 0:m.initialResponse)?void 0:C.parentMessageId)??""),!s||!a)return void console.warn("No run step or runId found for completed tool call event");const r=i.current.get(a);if(r){let n={...r};const o={type:hh.TOOL_CALL,tool_call:t.tool_call},l=s.index+R.length;n=d(n,l,o,!0),i.current.set(a,n);const c=k.map((e=>e.messageId===a?n:e));e(c)}}return()=>{o.current.clear(),i.current.clear(),l.current.clear()}}),[t,s,r,a,e]),clearStepMaps:n.useCallback((()=>{o.current.clear(),i.current.clear(),l.current.clear()}),[])}}({setMessages:t,getMessages:s,announcePolite:m,setIsSubmitting:i,lastAnnouncementTimeRef:x}),w=_E(u),N=n.useCallback(((e,n)=>{const{messages:s,userMessage:a,plugin:r,plugins:o,initialResponse:l,isRegenerate:c=!1}=n,d=e??"";i(!0);const u=Date.now();u-x.current>Kd&&(m({message:"composing",isStatus:!0}),x.current=u),t(c?[...s,{...l,text:d,plugin:r??null,plugins:o??[]}]:[...s,a,{...l,text:d,plugin:r??null,plugins:o??[]}])}),[t,m,i]),C=n.useCallback(((n,s)=>{const{requestMessage:a,responseMessage:l,conversation:c}=n,{messages:d,isRegenerate:m=!1}=s,p=c??s.conversation;if(m){const e=[...d,l].filter((e=>e));t(e)}else{const e=[...d,a,l].filter((e=>e));t(e)}const f=c.conversationId!==s.conversation.conversationId;f&&db(u,s.conversation.conversationId),e&&f&&a.parentMessageId===dh.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:p.conversationId})}),2500),o&&!r&&o((e=>({...e,...p}))),i(!1)}),[t,o,e,r,u,i]),k=n.useCallback(((e,n)=>{const{conversationId:s,thread_id:a,responseMessage:i,requestMessage:l}=e,{initialResponse:p,messages:f,userMessage:h}=n,g=f.filter((e=>e.messageId!==h.messageId));t([...g,l,{...p,...i}]),m({message:"start",isStatus:!0});let x={};o&&!r?(o((e=>{const t=l.parentMessageId,n=jE({parentId:t,queryClient:u,conversationId:s,currentTitle:null==e?void 0:e.title});return x=um.parse({...e,conversationId:s,thread_id:a,title:n,messages:[l.messageId,i.messageId]}),x})),l.parentMessageId===dh.NO_PARENT?lb(u,x):cb(u,x.conversationId,(e=>x))):o&&o((e=>(x=um.parse({...e,conversationId:s,thread_id:a,messages:[l.messageId,i.messageId]}),x))),c(!0),d&&d()}),[u,t,r,m,o,c,d]),S=n.useCallback(((e,n)=>{const{messages:s,userMessage:a,isRegenerate:i=!1,isTemporary:l=!1}=n,c={...n.initialResponse,parentMessageId:a.messageId,messageId:a.messageId+"_"};t(i?[...s,c]:[...s,a,c]);const{conversationId:h,parentMessageId:g}=a;x.current=Date.now(),m({message:"start",isStatus:!0});let v={};o&&!r?(o((e=>{const t=i?a.overrideParentMessageId:g,n=jE({parentId:t,queryClient:u,conversationId:h,currentTitle:null==e?void 0:e.title});return v=um.parse({...e,conversationId:h,title:n}),v})),l||(g===dh.NO_PARENT?lb(u,v):cb(u,v.conversationId,(e=>v)))):o&&o((e=>(v=um.parse({...e,conversationId:h}),v))),h&&p(h,n.conversation.conversationId,n.ephemeralAgent),d&&d(),jb((()=>f(!1)))}),[t,u,f,r,m,o,d,p]),T=n.useCallback(((n,l)=>{var d,f,x,v,b,_,y,j,N,C;const{requestMessage:k,responseMessage:S,conversation:T,runMessages:E}=n,{messages:R,conversation:I,isRegenerate:P=!1,isTemporary:A=!1}=l;(null==S?void 0:S.attachments)&&S.attachments.length>0&&S.attachments.forEach((e=>{const t={...e,messageId:S.messageId};w({data:t,submission:l})})),c(!1),a((e=>new Set(e.add(l.initialResponse.messageId))));const M=s();if(!M||0===M.length)return void i(!1);m({message:"end",isStatus:!0}),m({message:_b(S)});const L=T.conversationId!==I.conversationId,O=(e,n)=>{t(n),u.setQueryData([ex.messages,e],n)},D=(null==(x=null==(f=null==(d=null==S?void 0:S.content)?void 0:d[0])?void 0:f.text)?void 0:x.value)===(null==(y=null==(_=null==(b=null==(v=l.initialResponse)?void 0:v.content)?void 0:b[0])?void 0:_.text)?void 0:y.value)||!!(null==(C=null==(N=null==(j=null==S?void 0:S.content)?void 0:j[0])?void 0:N.tool_call)?void 0:C.auth);if(!T.conversationId&&D){const e=(I.conversationId??T.conversationId)||dh.NEW_CONVO;L&&I.conversationId&&db(u,I.conversationId);const t=g.pathname===`/c/${dh.NEW_CONVO}`&&e===dh.NEW_CONVO;return O(e,t?[]:[...R]),eb({id:e,value:null==k?void 0:k.text}),i(!1),void(t&&h(`/c/${dh.NEW_CONVO}`,{replace:!0,state:{focusChat:!0}}))}let F=[];E?F=[...E]:P&&S?F=[...R,S]:null!=k&&null!=S&&(F=[...R,k,S]),F.length>0?O(T.conversationId,F):!Mu(I.endpoint)||I.conversationId&&I.conversationId!==dh.NEW_CONVO||u.setQueryData([ex.messages,T.conversationId],[...M]),L&&I.conversationId&&db(u,I.conversationId),e&&L&&!A&&k&&k.parentMessageId===dh.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:T.conversationId})}),2500),o&&!0!==r&&(o((e=>{const t={...e,...T};null!=(null==e?void 0:e.model)&&e.model!==I.model&&(t.model=e.model);return u.getQueryData([ex.conversation,T.conversationId])||u.setQueryData([ex.conversation,T.conversationId],t),t})),T.conversationId&&l.ephemeralAgent&&p(T.conversationId,I.conversationId,l.ephemeralAgent),g.pathname===`/c/${dh.NEW_CONVO}`&&h(`/c/${T.conversationId}`,{replace:!0})),i(!1)}),[h,e,s,t,u,a,r,m,o,i,c,g.pathname,p,w]),E=n.useCallback((({data:e,submission:n})=>{var r;const{messages:o,userMessage:c,initialResponse:d}=n;a((e=>new Set(e.add(d.messageId))));const m=c.conversationId??(null==(r=n.conversation)?void 0:r.conversationId)??"",p=(e,n)=>{const s=[...o,c,n];t(s),u.setQueryData([ex.messages,e],s)},f=e=>{const t=e.responseMessage??e,n={...d,...t,error:!0,parentMessageId:c.messageId};return void 0!==n.messageId&&""!==n.messageId||(n.messageId=Xe()),om.parse(n)};if(!e){const e=m||`_${Xe()}`,t=f({text:"Error connecting to server, try refreshing the page.",...n,conversationId:e});return p(e,yE({errorMetadata:t,getMessages:s,submission:n})),l&&l({template:{conversationId:e},preset:dm.parse(n.conversation)}),void i(!1)}const h=e.conversationId??"";if(!m&&!h){const t=`_${Xe()}`;return p(t,f(e)),l&&l({template:{conversationId:t},preset:dm.parse(n.conversation)}),void i(!1)}if(!h){return p(m,f(e)),void i(!1)}p(h,om.parse({...e,error:!0,parentMessageId:c.messageId})),h&&v===dh.NEW_CONVO&&l&&l({template:{conversationId:h},preset:dm.parse(n.conversation)}),i(!1)}),[a,t,v,l,i,s,u]),R=n.useCallback((async(e="",n,a)=>{var r;const o=`${e}:${(null==(r=null==a?void 0:a[a.length-1])?void 0:r.messageId)??""}`,{endpoint:c,endpointType:d}=n.conversation??{},u=d??c;if(Mu(u)||null==(null==a?void 0:a[a.length-1])||null==a[a.length-2]){if(!Mu(u)){const t=e||`_${Xe()}`;return a_.log("conversation","Aborted conversation with minimal messages, ID: "+t),l&&l({template:{conversationId:t},preset:dm.parse(n.conversation)}),void i(!1)}try{const e=await fetch(`${Zf[u??""]}/abort`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({abortKey:o,endpoint:u})}),t=e.headers.get("content-type");if(null!=t&&t.includes("application/json")){const t=await e.json();if(404===e.status)return void i(!1);!0===t.final?T(t,n):C(t,n)}else{if(204!==e.status&&200!==e.status)throw new Error("Unexpected response from server; Status: "+e.status+" "+e.statusText);i(!1)}}catch(m){const a=yE({getMessages:s,submission:n,error:m});t([...n.messages,n.userMessage,a]),l&&l({template:{conversationId:e||a.conversationId||Xe()},preset:dm.parse(n.conversation)}),i(!1)}}else{let t=a[a.length-2];const s=a[a.length-1];if(t.messageId!==s.parentMessageId)for(let e=a.length-3;e>=0;e--)if(a[e].messageId===s.parentMessageId){t=a[e];break}T({conversation:{conversationId:e},requestMessage:t,responseMessage:s},n)}}),[T,l,i,b,C,s,t]);return{clearStepMaps:j,stepHandler:y,syncHandler:k,finalHandler:T,errorHandler:E,messageHandler:N,contentHandler:_,createdHandler:S,attachmentHandler:w,abortConversation:R}}const NE=e=>{e?(localStorage.removeItem(`${uh.TEXT_DRAFT}${e}`),localStorage.removeItem(`${uh.FILES_DRAFT}${e}`)):(localStorage.removeItem(`${uh.TEXT_DRAFT}${dh.NEW_CONVO}`),localStorage.removeItem(`${uh.FILES_DRAFT}${dh.NEW_CONVO}`))};function CE(e,t,s=!1,a=0){var r;const o=_j(),i=Pe(Cy.activeRunFamily(a)),{token:l,isAuthenticated:c}=qk(),[d,u]=n.useState(new Set),m=Pe(Cy.abortScrollFamily(a)),p=Pe(Cy.showStopButtonByIndex(a)),{setMessages:f,getMessages:h,setConversation:g,setIsSubmitting:x,newConversation:v,resetLatestMessage:b}=t,{clearStepMaps:_,stepHandler:y,syncHandler:j,finalHandler:w,errorHandler:N,messageHandler:C,contentHandler:k,createdHandler:S,attachmentHandler:T,abortConversation:E}=wE({genTitle:o,setMessages:f,getMessages:h,setCompleted:u,isAddedRequest:s,setConversation:g,setIsSubmitting:x,newConversation:v,setShowStopButton:p,resetLatestMessage:b}),{data:R}=Wy(),I=rj({enabled:!!c&&(null==(r=null==R?void 0:R.balance)?void 0:r.enabled)});n.useEffect((()=>{if(null==e||0===Object.keys(e).length)return;let{userMessage:t}=e;const n=function(e){var t=e.isEdited,n=e.userMessage,s=e.isContinued,a=e.isTemporary,r=e.isRegenerate,o=e.conversation,i=e.editedContent,l=e.ephemeralAgent,c=e.endpointOption,d=um.parse(o).conversationId,u=c,m=u.endpoint,p=u.endpointType,f=m,h="".concat(Zf[Nu.agents],"/").concat(f);return Mu(f)&&(h=Zf[null!=p?p:f]+(t?"/modify":"")),{server:h,payload:qd(qd(qd({},n),c),{endpoint:f,isTemporary:a,isRegenerate:r,editedContent:i,conversationId:d,isContinued:!(!t||!s),ephemeralAgent:Mu(f)?void 0:l})}}(e);let{payload:s}=n;s=xm(s),_();const a=new it(n.server,{payload:JSON.stringify(s),headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});return a.addEventListener("attachment",(t=>{try{const n=JSON.parse(t.data);T({data:n,submission:e})}catch(n){console.error(n)}})),a.addEventListener("message",(n=>{var s,a;const r=JSON.parse(n.data);if(null!=r.final){NE(null==(s=e.conversation)?void 0:s.conversationId);const{plugins:t}=r;return w(r,{...e,plugins:t}),(null==(a=null==R?void 0:R.balance)?void 0:a.enabled)&&I.refetch(),void console.log("final",r)}if(null!=r.created){const n=Xe();i(n),t={...t,...r.message,overrideParentMessageId:t.overrideParentMessageId},S(r,{...e,userMessage:t})}else if(null!=r.event)y(r,{...e,userMessage:t});else if(null!=r.sync){const n=Xe();i(n),j(r,{...e,userMessage:t})}else if(null!=r.type){const{text:t,index:n}=r;k({data:r,submission:e})}else{const n=r.text??r.response,{plugin:s,plugins:a}=r,o={...e.initialResponse,parentMessageId:r.parentMessageId,messageId:r.messageId};null!=r.message&&C(n,{...e,plugin:s,plugins:a,userMessage:t,initialResponse:o})}})),a.addEventListener("open",(()=>{m(!1),console.log("connection is opened")})),a.addEventListener("cancel",(async()=>{var n,s,a;const r=null==(n=null==e?void 0:e.initialResponse)?void 0:n.messageId;if(d.has(r))return x(!1),void u((e=>(e.delete(r),new Set(e))));u((e=>new Set(e.add(r))));const o=h(),i=null==(s=null==o?void 0:o[o.length-1])?void 0:s.conversationId;return await E(i??t.conversationId??(null==(a=e.conversation)?void 0:a.conversationId)??"",e,o)})),a.addEventListener("error",(async n=>{var s;if(401===n.responseCode)try{const e=await px.refreshToken(),t=(null==e?void 0:e.token)??"";if(!t)throw new Error("Token refresh failed.");return a.headers={"Content-Type":"application/json",Authorization:`Bearer ${t}`},px.dispatchTokenUpdatedEvent(t),void a.stream()}catch(o){console.log(o)}let r;console.log("error in server stream."),(null==(s=null==R?void 0:R.balance)?void 0:s.enabled)&&I.refetch();try{r=JSON.parse(n.data)}catch(o){console.error(o),console.log(n),x(!1)}N({data:r,submission:{...e,userMessage:t}})})),x(!0),a.stream(),()=>{const e=a.readyState<=1;if(a.close(),e){const e=new Event("cancel");a.dispatchEvent(e)}}}),[e])}const kE=S.createContext(void 0),SE=({value:e,children:t})=>{const[a,r]=n.useState(!1);return s.jsx(kE.Provider,{value:e??{error:a,setError:r},children:t})},TE=()=>{const e=S.useContext(kE);if(void 0===e)throw new Error("useApiErrorBoundary must be used inside ApiErrorBoundaryProvider");return e},EE=()=>{const[e,t]=n.useState(!1),[s,a]=n.useState(null),r=n.useCallback(((e,n)=>{n.preventDefault(),n.stopPropagation(),a(e),t(!0)}),[]);return{keyDialogOpen:e,keyDialogEndpoint:s,onOpenChange:e=>{if(!e&&s){const e=document.getElementById(`endpoint-${s}-settings`);e&&setTimeout((()=>{e.focus()}),5)}t(e)},handleOpenKeyDialog:r}},RE={[Of.anyscale]:"assets/anyscale.png",[Of.apipie]:"assets/apipie.png",[Of.cohere]:"assets/cohere.png",[Of.deepseek]:"assets/deepseek.svg",[Of.fireworks]:"assets/fireworks.png",[Of.google]:"assets/google.svg",[Of.groq]:"assets/groq.png",[Of.huggingface]:"assets/huggingface.svg",[Of.mistral]:"assets/mistral.png",[Of.mlx]:"assets/mlx.png",[Of.ollama]:"assets/ollama.png",[Of.openai]:"assets/openai.svg",[Of.openrouter]:"assets/openrouter.png",[Of.perplexity]:"assets/perplexity.png",[Of.qwen]:"assets/qwen.svg",[Of.shuttleai]:"assets/shuttleai.png",[Of["together.ai"]]:"assets/together.png",[Of.unify]:"assets/unify.webp"},IE={[Of.cohere]:{[vv.landing]:"p-2"},[Of.xai]:{[vv.landing]:"p-2"}},PE=({currentEndpoint:e,context:t="",className:n})=>{var s;if(e===Of.openrouter)return n;return s_((null==(s=IE[e])?void 0:s[t])??"",t===vv.landing?"":n)};const AE=n.memo((function({className:e="",endpoint:t,iconURL:n="",context:a}){const r=t??"";if(!r)return s.jsx(cc,{className:e});const o=r.toLowerCase();if(o===Of.xai)return s.jsx(Qc,{className:PE({currentEndpoint:o,context:a,className:e})});if(n)return s.jsx("img",{className:e,src:n,alt:`${r} Icon`});const i=RE[o]??"";return i?s.jsx("img",{className:PE({currentEndpoint:o,context:a,className:e}),src:i,alt:`${o} Icon`}):s.jsx(cc,{className:e})})),ME=({className:e="",assistantName:t="",avatar:n="",context:a,size:r})=>t&&n?s.jsx("img",{src:n,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:t,width:"80",height:"80"}):t?s.jsx(Vc,{className:s_("text-token-secondary",e),size:r}):s.jsx(Bc,{className:s_("landing"===a?"icon-2xl":"",e)}),LE={[Nu.azureOpenAI]:Ec,[Nu.openAI]:ec,[Nu.gptPlugins]:Tc,[Nu.anthropic]:jc,[Nu.chatGPTBrowser]:dc,[Nu.google]:Mc,[Nu.custom]:cc,[Nu.assistants]:ME,[Nu.azureAssistants]:ME,[Nu.agents]:({className:e="",avatar:t="",agentName:n,size:a})=>null!=n&&n&&t?s.jsx("img",{src:t,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:n,width:"80",height:"80"}):s.jsx(lt,{className:s_(""===n?"icon-2xl":"",e),size:a}),[Nu.bedrock]:({className:e=""})=>s.jsx(Kc,{className:s_(e,"h-full w-full")}),unknown:AE},OE=({agents:e,assistantsMap:t,endpointsConfig:s,startupConfig:a})=>{var r;const o=fk(),{data:i=[]}=Ky({select:Tb}),l=(null==a?void 0:a.interface)??{},c=n.useMemo((()=>{var e;return new Set((null==(e=null==a?void 0:a.modelSpecs)?void 0:e.addedEndpoints)??[])}),[null==(r=null==a?void 0:a.modelSpecs)?void 0:r.addedEndpoints]),d=Qk({permissionType:Zh.AGENTS,permission:Jh.USE}),u=n.useMemo((()=>Object.values((null==t?void 0:t[Nu.assistants])??{})),[t]),m=n.useMemo((()=>Object.values((null==t?void 0:t[Nu.azureAssistants])??{})),[t]),p=n.useMemo((()=>{if(!l.modelSelect)return[];const e=[];for(let t=0;t<i.length;t++)(i[t]!==Nu.agents||d)&&(c.size>0&&!c.has(i[t])||e.push(i[t]));return e}),[i,d,c,l.modelSelect]),f=n.useCallback((e=>!!Sb(s,e,"userProvide")),[s]);return{mappedEndpoints:n.useMemo((()=>p.map((t=>{var n,a,r,i,l,c;const d=Sb(s,t,"type"),p=Lb({endpoint:t,endpointsConfig:s,endpointType:d}),f=LE[p],h=Sb(s,t,"iconURL"),g=t===Nu.agents&&((null==e?void 0:e.length)??0)>0||t===Nu.assistants&&(null==u?void 0:u.length)>0||t!==Nu.assistants&&t!==Nu.agents&&((null==(a=null==(n=o.data)?void 0:n[t])?void 0:a.length)??0)>0,x={value:t,label:qf[t]||t,hasModels:g,icon:f?S.createElement(f,{size:20,className:"text-text-primary shrink-0 icon-md",iconURL:h,endpoint:t}):null};return t===Nu.agents&&((null==e?void 0:e.length)??0)>0?(x.models=null==e?void 0:e.map((e=>({name:e.id,isGlobal:e.isPublic??!1}))),x.agentNames=null==e?void 0:e.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=null==e?void 0:e.reduce(((e,t)=>{var n;return e[t.id]=null==(n=null==t?void 0:t.avatar)?void 0:n.filepath,e}),{})):t===Nu.assistants&&u.length>0?(x.models=u.map((e=>({name:e.id,isGlobal:!1}))),x.assistantNames=u.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=u.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t===Nu.azureAssistants&&m.length>0?(x.models=m.map((e=>({name:e.id,isGlobal:!1}))),x.assistantNames=m.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),x.modelIcons=m.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t!==Nu.agents&&t!==Nu.assistants&&((null==(i=null==(r=o.data)?void 0:r[t])?void 0:i.length)??0)>0&&(x.models=null==(c=null==(l=o.data)?void 0:l[t])?void 0:c.map((e=>({name:e,isGlobal:!1})))),x}))),[p,s,o.data,e,u,m]),endpointRequiresUserKey:f}};function DE(e,t){const[s,a]=n.useState(t);n.useEffect((()=>{const n=localStorage.getItem(e);function s(t){if(t.key!==e)return;const n=localStorage.getItem(e);a(JSON.parse(n??""))}return n||localStorage.setItem(e,JSON.stringify(t)),a(n?JSON.parse(n):t),window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}),[]);return[s,t=>{try{a(t),localStorage.setItem(e,JSON.stringify(t)),"undefined"!=typeof window&&window.dispatchEvent(new StorageEvent("storage",{key:e}))}catch(Fi){console.error(Fi)}}]}function FE(e){n.useEffect((()=>{document.title=e}),[e])}const zE=(e,t)=>{const{data:n,isLoading:s}=Rk(e,t);return{hasPermission:e=>!!n&&function(e,t){return(e&t)===t}(n.permissionBits,e),isLoading:s,permissionBits:(null==n?void 0:n.permissionBits)||0}},UE=({statusMessage:e,logMessage:t})=>s.jsxs("div",{className:"sr-only",children:[s.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:e}),s.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:t})]}),VE=({children:e})=>{const[t,a]=n.useState(""),[r,o]=n.useState(""),i=n.useRef(null),l=Uk(),c=n.useMemo((()=>({start:l("com_a11y_start"),end:l("com_a11y_end"),composing:l("com_a11y_ai_composing")})),[l]),d=n.useCallback((e=>{i.current&&clearTimeout(i.current),a(e),i.current=setTimeout((()=>{a("")}),1e3)}),[]),u=n.useCallback((e=>{o(e)}),[]),m=n.useCallback((({message:e,isStatus:t=!1})=>{const n=(c[e]??e).replace(/[*`_]/g,"");t?d(n):u(n)}),[c,d,u]),p={announcePolite:m,announceAssertive:m};return n.useEffect((()=>()=>{i.current&&clearTimeout(i.current)}),[]),s.jsxs(yS.Provider,{value:p,children:[e,s.jsx(UE,{statusMessage:t,logMessage:r})]})},BE=({children:e})=>s.jsx("div",{role:"alert","aria-live":"assertive",className:"relative mt-6 rounded-xl border border-red-500/20 bg-red-50/50 px-6 py-4 text-red-700 shadow-sm transition-all dark:bg-red-950/30 dark:text-red-100",children:e}),$E=({id:e,enabled:t,serverDomain:n,oauthPath:a,Icon:r,label:o})=>t?s.jsx("div",{className:"mt-2 flex gap-x-2",children:s.jsxs("a",{"aria-label":`${o}`,className:"flex w-full items-center space-x-3 rounded-2xl border border-border-light bg-surface-primary px-5 py-3 text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",href:`${n}/oauth/${a}`,"data-testid":e,children:[s.jsx(r,{}),s.jsx("p",{children:o})]})}):null,HE=({onSubmit:e,startupConfig:t,error:a,setError:r})=>{var o,i;const l=Uk(),{theme:c}=n.useContext(Rd),{register:d,getValues:u,handleSubmit:m,formState:{errors:p,isSubmitting:f}}=Vo(),[h,g]=n.useState(!1),[x,v]=n.useState(null),{data:b}=Wy(),_=null==(o=null==b?void 0:b.ldap)?void 0:o.username,y=Id(c)?"dark":"light",j=Boolean(null==(i=t.turnstile)?void 0:i.siteKey);n.useEffect((()=>{a&&a.includes("422")&&!h&&g(!0)}),[a,h]);const w=Oj({onMutate:()=>{r(void 0),g(!1)}});if(!t)return null;const N=e=>{var t;const n=null==(t=p[e])?void 0:t.message;return n?s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:String(n)}):null};return s.jsxs(s.Fragment,{children:[h&&s.jsxs("div",{className:"mt-2 rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",children:[l("com_auth_email_verification_resend_prompt"),s.jsx("button",{type:"button",className:"ml-2 text-blue-600 hover:underline",onClick:()=>{const e=u("email");if(!e)return g(!1);w.mutate({email:e})},disabled:w.isLoading,children:l("com_auth_email_resend_link")})]}),s.jsxs("form",{className:"mt-6","aria-label":"Login form",method:"POST",onSubmit:m((t=>e(t))),children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",id:"email",autoComplete:_?"username":"email","aria-label":l("com_auth_email"),...d("email",{required:l("com_auth_email_required"),maxLength:{value:120,message:l("com_auth_email_max_length")},pattern:{value:_?/\S+/:/\S+@\S+\.\S+/,message:l("com_auth_email_pattern")}}),"aria-invalid":!!p.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"email",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:_?l("com_auth_username").replace(/ \(.*$/,""):l("com_auth_email_address")})]}),N("email")]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":l("com_auth_password"),...d("password",{required:l("com_auth_password_required"),minLength:{value:(null==t?void 0:t.minPasswordLength)||8,message:l("com_auth_password_min_length")},maxLength:{value:128,message:l("com_auth_password_max_length")}}),"aria-invalid":!!p.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:l("com_auth_password")})]}),N("password")]}),t.passwordResetEnabled&&s.jsx("a",{href:"/forgot-password",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_auth_password_forgot")}),j&&s.jsx("div",{className:"my-4 flex justify-center",children:s.jsx(Wo,{siteKey:t.turnstile.siteKey,options:{...t.turnstile.options,theme:y},onSuccess:v,onError:()=>v(null),onExpire:()=>v(null)})}),s.jsx("div",{className:"mt-6",children:s.jsx(Si,{"aria-label":l("com_auth_continue"),"data-testid":"login-button",type:"submit",disabled:j&&!x||f,variant:"submit",className:"h-12 w-full rounded-2xl",children:f?s.jsx(rc,{}):l("com_auth_continue")})})]})]})};function GE(){const e=Uk(),{showToast:t}=$d(),{error:a,setError:r,login:o}=qk(),{startupConfig:i}=ct(),[l,c]=Ps(),d="false"===l.get("redirect"),[u,m]=n.useState(d);n.useEffect((()=>{const n=null==l?void 0:l.get("error");if(n&&n===ah.AUTH_FAILED){t({message:e("com_auth_error_oauth_failed"),status:"error"});const n=new URLSearchParams(l);n.delete("error"),c(n,{replace:!0})}}),[l,c,t,e]),n.useEffect((()=>{if(d){m(!0);const e=new URLSearchParams(l);e.delete("redirect"),c(e,{replace:!0})}}),[d,l,c]);const p=(null==i?void 0:i.openidLoginEnabled)&&(null==i?void 0:i.openidAutoRedirect)&&(null==i?void 0:i.serverDomain)&&!u;return n.useEffect((()=>{p&&(console.log("Auto-redirecting to OpenID provider..."),window.location.href=`${i.serverDomain}/oauth/openid`)}),[p,i]),p?s.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:[s.jsx("p",{className:"text-lg font-semibold",children:e("com_ui_redirecting_to_provider",{0:i.openidLabel})}),s.jsx("div",{className:"mt-4",children:s.jsx($E,{enabled:i.openidLoginEnabled,serverDomain:i.serverDomain,oauthPath:"openid",Icon:()=>i.openidImageUrl?s.jsx("img",{src:i.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):s.jsx(xc,{}),label:i.openidLabel,id:"openid"},"openid")})]}):s.jsxs(s.Fragment,{children:[null!=a&&s.jsx(BE,{children:e(o_(a))}),!0===(null==i?void 0:i.emailLoginEnabled)&&s.jsx(HE,{onSubmit:o,startupConfig:i,error:a,setError:r}),!0===(null==i?void 0:i.registrationEnabled)&&s.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[" ",e("com_auth_no_account")," ",s.jsx("a",{href:"/register",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:e("com_auth_sign_up")})]})]})}const KE=()=>{var e,t;const a=Fe(),r=Uk(),{theme:o}=n.useContext(Rd),{startupConfig:i,startupConfigError:l,isFetching:c}=ct(),{watch:d,register:u,handleSubmit:m,formState:{errors:p}}=Vo({mode:"onChange"}),f=d("password"),[h,g]=n.useState(""),[x,v]=n.useState(!1),[b,_]=n.useState(3),[y,j]=n.useState(null),w=De(),N=new URLSearchParams(w.search).get("token"),C=Id(o)?"dark":"light",k=Boolean(null==(e=null==i?void 0:i.turnstile)?void 0:e.siteKey),S=gk({onMutate:()=>{v(!0)},onSuccess:()=>{v(!1),_(3);const e=setInterval((()=>{_((t=>t<=1?(clearInterval(e),a("/c/new",{replace:!0}),0):t-1))}),1e3)},onError:e=>{var t,n,s,a;v(!1),(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)&&g((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)??"")}}),T=(e,t,n,a)=>{var o;return s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:e,type:n,autoComplete:e,"aria-label":r(t),...u(e,a),"aria-invalid":!!p[e],className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" ","data-testid":e}),s.jsx("label",{htmlFor:e,className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:r(t)})]}),p[e]&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500",children:String(null==(o=p[e])?void 0:o.message)??""})]})};return s.jsxs(s.Fragment,{children:[h&&s.jsxs(BE,{children:[r("com_auth_error_create")," ",h]}),S.isSuccess&&b>0&&s.jsx("div",{className:"rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",role:"alert",children:r((null==i?void 0:i.emailEnabled)?"com_auth_registration_success_generic":"com_auth_registration_success_insecure")+" "+r("com_auth_email_verification_redirecting",{0:b.toString()})}),!l&&!c&&s.jsxs(s.Fragment,{children:[s.jsxs("form",{className:"mt-6","aria-label":"Registration form",method:"POST",onSubmit:m((e=>S.mutate({...e,token:N??void 0}))),children:[T("name","com_auth_full_name","text",{required:r("com_auth_name_required"),minLength:{value:3,message:r("com_auth_name_min_length")},maxLength:{value:80,message:r("com_auth_name_max_length")}}),T("username","com_auth_username","text",{minLength:{value:2,message:r("com_auth_username_min_length")},maxLength:{value:80,message:r("com_auth_username_max_length")}}),T("email","com_auth_email","email",{required:r("com_auth_email_required"),minLength:{value:1,message:r("com_auth_email_min_length")},maxLength:{value:120,message:r("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:r("com_auth_email_pattern")}}),T("password","com_auth_password","password",{required:r("com_auth_password_required"),minLength:{value:(null==i?void 0:i.minPasswordLength)||8,message:r("com_auth_password_min_length")},maxLength:{value:128,message:r("com_auth_password_max_length")}}),T("confirm_password","com_auth_password_confirm","password",{validate:e=>e===f||r("com_auth_password_not_match")}),(null==(t=null==i?void 0:i.turnstile)?void 0:t.siteKey)&&s.jsx("div",{className:"my-4 flex justify-center",children:s.jsx(Wo,{siteKey:i.turnstile.siteKey,options:{...i.turnstile.options,theme:C},onSuccess:e=>j(e),onError:()=>j(null),onExpire:()=>j(null)})}),s.jsx("div",{className:"mt-6",children:s.jsx(Si,{disabled:Object.keys(p).length>0||x||k&&!y,type:"submit","aria-label":"Submit registration",variant:"submit",className:"h-12 w-full rounded-2xl",children:x?s.jsx(rc,{}):r("com_auth_continue")})})]}),s.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[r("com_auth_already_have_account")," ",s.jsx("a",{href:"/login","aria-label":"Login",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:r("com_auth_login")})]})]})]})};function WE(){const e=Uk(),{register:t,handleSubmit:n,watch:a,formState:{errors:r,isSubmitting:o}}=Vo(),i=Fe(),[l]=Ps(),c=a("password"),d=bk(),{setError:u,setHeaderText:m,startupConfig:p}=ct();return d.isSuccess?s.jsx(s.Fragment,{children:s.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsx("p",{children:e("com_auth_login_with_new_password")}),s.jsx(Si,{onClick:()=>i("/login"),"aria-label":e("com_auth_sign_in"),variant:"submit",children:e("com_auth_continue")})]})})}):s.jsxs("form",{className:"mt-6","aria-label":"Password reset form",method:"POST",onSubmit:n((e=>{d.mutate(e,{onError:()=>{u("com_auth_error_invalid_reset_token")},onSuccess:()=>{m("com_auth_reset_password_success")}})})),children:[s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"hidden",id:"token",value:l.get("token")??"",...t("token",{required:"Unable to process: No valid reset token"})}),s.jsx("input",{type:"hidden",id:"userId",value:l.get("userId")??"",...t("userId",{required:"Unable to process: No valid user id"})}),s.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":e("com_auth_password"),...t("password",{required:e("com_auth_password_required"),minLength:{value:(null==p?void 0:p.minPasswordLength)||8,message:e("com_auth_password_min_length")},maxLength:{value:128,message:e("com_auth_password_max_length")}}),"aria-invalid":!!r.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password")})]}),r.password&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.password.message})]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"password",id:"confirm_password","aria-label":e("com_auth_password_confirm"),...t("confirm_password",{validate:t=>t===c||e("com_auth_password_not_match")}),"aria-invalid":!!r.confirm_password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"confirm_password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password_confirm")})]}),r.confirm_password&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.confirm_password.message}),r.token&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.token.message}),r.userId&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:r.userId.message})]}),s.jsx("div",{className:"mt-6",children:s.jsx(Si,{type:"submit","aria-label":e("com_auth_submit_registration"),disabled:!!r.password||!!r.confirm_password||o,variant:"submit",className:"h-12 w-full rounded-2xl",children:o?s.jsx(rc,{}):e("com_auth_continue")})})]})}function qE(){const e=Fe(),t=Uk(),[a]=Ps(),[r,o]=n.useState(3),[i,l]=n.useState(""),[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useMemo((()=>a.get("token")||""),[a]),f=n.useMemo((()=>a.get("email")||""),[a]),h=n.useCallback((()=>{o(3);const t=setInterval((()=>{o((n=>n<=1?(clearInterval(t),e("/c/new",{replace:!0}),0):n-1))}),1e3)}),[e]),g=fr({mutationFn:e=>fx.verifyEmail(e),...{onSuccess:()=>{l(t("com_auth_email_verification_success")+" 🎉"),m(!0),h()},onError:e=>{l(t("com_auth_email_verification_failed")+" 😢"),d(!0),m(!0)}}||{}});const x=Oj({onSuccess:()=>{l(t("com_auth_email_resent_success")+" 📧"),h()},onError:()=>{l(t("com_auth_email_resent_failed")+" 😢")},onMutate:()=>d(!1)}),v=()=>{x.mutate({email:f})};n.useEffect((()=>{u||g.isLoading||(p&&f?g.mutate({email:f,token:p}):(l(f?t("com_auth_email_verification_failed_token_missing")+" 😢":t("com_auth_email_verification_invalid")+" 🤨"),d(!0),m(!0)))}),[p,f,u,g]);const b=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:i}),r>0&&s.jsx("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:t("com_auth_email_verification_redirecting",{0:r.toString()})}),c&&0===r&&s.jsxs("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:[t("com_auth_email_verification_resend_prompt"),s.jsx("button",{className:"ml-2 text-blue-600 hover:underline",onClick:v,disabled:x.isLoading,children:t("com_auth_email_resend_link")})]})]}),_=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:t("com_auth_email_verification_in_progress")}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsx(rc,{className:"h-8 w-8 text-green-500"})})]});return s.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[s.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:s.jsx(Md,{})}),u?s.jsx(b,{}):s.jsx(_,{})]})}const QE=()=>{const{error:e}=TE(),t=Fe();return S.useEffect((()=>{var t;null==(t=null==e?void 0:e.response)||t.status}),[e,t]),null},YE=({children:e})=>s.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:e}),XE=()=>{const e=Uk();return s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsx("p",{children:e("com_auth_reset_password_if_email_exists")}),s.jsx("a",{className:"inline-flex text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",href:"/login",children:e("com_auth_back_to_login")})]})};function ZE(){const e=Uk(),{register:t,handleSubmit:a,formState:{errors:r}}=Vo(),[o,i]=n.useState(void 0),{startupConfig:l,setHeaderText:c}=ct(),d=vk(),{isLoading:u}=d;return o?s.jsx(YE,{children:o}):s.jsxs("form",{className:"mt-8 space-y-6","aria-label":"Password reset form",method:"POST",onSubmit:a((t=>{d.mutate(t,{onSuccess:t=>{t.link&&!(null==l?void 0:l.emailEnabled)?(c("com_auth_reset_password"),i(s.jsxs("span",{children:[e("com_auth_click")," ",s.jsx("a",{className:"text-green-500 hover:underline",href:t.link,children:e("com_auth_here")})," ",e("com_auth_to_reset_your_password")]}))):(c("com_auth_reset_password_link_sent"),i(s.jsx(XE,{})))},onError:()=>{c("com_auth_reset_password_link_sent"),i(s.jsx(XE,{}))}})})),children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"email",id:"email",autoComplete:"off","aria-label":e("com_auth_email"),...t("email",{required:e("com_auth_email_required"),minLength:{value:3,message:e("com_auth_email_min_length")},maxLength:{value:120,message:e("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:e("com_auth_email_pattern")}}),"aria-invalid":!!r.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),s.jsx("label",{htmlFor:"email",className:"absolute -top-2 left-2 z-10 bg-white px-2 text-sm text-gray-600 transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-green-600 dark:bg-gray-900 dark:text-gray-400 dark:peer-focus:text-green-500",children:e("com_auth_email_address")})]}),r.email&&s.jsx("p",{role:"alert",className:"text-sm font-medium text-red-600 dark:text-red-400",children:r.email.message})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(Si,{"aria-label":"Continue with password reset",type:"submit",disabled:!!r.email||u,variant:"submit",className:"h-12 w-full rounded-2xl",children:u?s.jsx(rc,{}):e("com_auth_continue")}),s.jsx("a",{href:"/login",className:"block text-center text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:e("com_auth_back_to_login")})]})]})}const JE=S.memo((()=>{const[e]=Ps(),t=e.get("tempToken"),a=null!==t&&""!==t?t:"",{control:r,handleSubmit:o,formState:{errors:i}}=Vo(),l=Uk(),{showToast:c}=$d(),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{mutate:f}=(e=>{const t=pr();return fr((e=>fx.verifyTwoFactorTemp(e)),{...e||{},onSuccess:(n,...s)=>{var a;t.setQueryData([ex.user,"2fa"],n),null==(a=null==e?void 0:e.onSuccess)||a.call(e,n,...s)}})})({onSuccess:e=>{null!=e.token&&""!==e.token&&(window.location.href="/")},onMutate:()=>{p(!0)},onError:e=>{var t,n;p(!1);const s=e,a="string"==typeof(null==(n=null==(t=s.response)?void 0:t.data)?void 0:n.message)?s.response.data.message:"Error verifying 2FA";c({message:a,status:"error"})}}),h=n.useCallback((e=>{const t={tempToken:a};d&&null!=e.backupCode&&""!==e.backupCode?t.backupCode=e.backupCode:null!=e.token&&""!==e.token&&(t.token=e.token),f(t)}),[a,d,f]),g=n.useCallback((()=>{u(!0)}),[]),x=n.useCallback((()=>{u(!1)}),[]);return s.jsx("div",{className:"mt-4",children:s.jsxs("form",{onSubmit:o(h),children:[s.jsx(ul,{className:"flex justify-center break-keep text-center text-sm text-text-primary",children:l("com_auth_two_factor")}),!d&&s.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[s.jsx(Bo,{name:"token",control:r,render:({field:{onChange:e,value:t}})=>s.jsxs(zl,{maxLength:6,value:null!=t?t:"",onChange:e,pattern:dt,children:[s.jsxs(Ul,{children:[s.jsx(Vl,{index:0}),s.jsx(Vl,{index:1}),s.jsx(Vl,{index:2})]}),s.jsx(Bl,{}),s.jsxs(Ul,{children:[s.jsx(Vl,{index:3}),s.jsx(Vl,{index:4}),s.jsx(Vl,{index:5})]})]})}),i.token&&s.jsx("span",{className:"text-sm text-red-500",children:i.token.message})]}),d&&s.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[s.jsx(Bo,{name:"backupCode",control:r,render:({field:{onChange:e,value:t}})=>s.jsx(zl,{maxLength:8,value:null!=t?t:"",onChange:e,pattern:ut,children:s.jsxs(Ul,{children:[s.jsx(Vl,{index:0}),s.jsx(Vl,{index:1}),s.jsx(Vl,{index:2}),s.jsx(Vl,{index:3}),s.jsx(Vl,{index:4}),s.jsx(Vl,{index:5}),s.jsx(Vl,{index:6}),s.jsx(Vl,{index:7})]})})}),i.backupCode&&s.jsx("span",{className:"text-sm text-red-500",children:i.backupCode.message})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("button",{type:"submit","aria-label":l("com_auth_continue"),"data-testid":"login-button",disabled:m,className:"w-full rounded-2xl bg-green-600 px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-green-700 disabled:opacity-80 dark:bg-green-600 dark:hover:bg-green-700",children:l(m?"com_auth_email_verifying_ellipsis":"com_ui_verify")})}),s.jsx("div",{className:"mt-4 flex justify-center",children:d?s.jsx("button",{type:"button",onClick:x,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_ui_use_2fa_code")}):s.jsx("button",{type:"button",onClick:g,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:l("com_ui_use_backup_code")})})]})})})),eR=({children:e})=>{const t=cT(0,"new");return s.jsx(Ak.Provider,{value:t,children:e})},tR=({control:e,marketplacePerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Bo,{name:t,control:e,render:({field:e})=>s.jsx(kl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),nR=()=>{const e=Uk(),{showToast:t}=$d(),{user:a,roles:r}=qk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Bg.partial().parse(e.updates),fx.updateMarketplacePermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([ex.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update marketplace permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Pg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[Zh.MARKETPLACE]:Jg[d].permissions[Zh.MARKETPLACE]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=Vo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[Zh.MARKETPLACE];p(n||Jg[d].permissions[Zh.MARKETPLACE])}),[r,d,p]),(null==a?void 0:a.role)!==Pg.ADMIN)return null;const b=[{marketplacePerm:Jh.USE,label:e("com_ui_marketplace_allow_use")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Pg.USER,onClick:()=>{u(Pg.USER)}},{label:Pg.ADMIN,onClick:()=>{u(Pg.ADMIN)}}];return s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"outline",className:"relative h-12 rounded-xl border-border-medium font-medium",children:s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"})})}),s.jsxs(xl,{className:"w-11/12 max-w-md border-border-light bg-surface-primary text-text-primary",children:[s.jsx(_l,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_marketplace")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(Nd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({marketplacePerm:e,label:t})=>s.jsx("div",{children:s.jsx(tR,{control:f,marketplacePerm:e,label:t,getValues:g,setValue:h})},e)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})},sR=(e,t,n)=>{if(!n||0===n.length)return!1;if(!t){return 0===n.findIndex((t=>t.name===e.name&&t.instructions===e.instructions&&t.artifacts===e.artifacts))}const s=e.name===t.name,a=e.description===t.description,r=e.instructions===t.instructions,o=e.artifacts===t.artifacts;return s&&a&&r&&o&&(()=>{if(!e.tools&&!t.tools)return!0;if(!e.tools||!t.tools)return!1;if(e.tools.length!==t.tools.length)return!1;const n=[...e.tools].sort(),s=[...t.tools].sort();return n.every(((e,t)=>e===s[t]))})()&&(()=>{if(!e.capabilities&&!t.capabilities)return!0;if(!e.capabilities||!t.capabilities)return!1;if(e.capabilities.length!==t.capabilities.length)return!1;const n=[...e.capabilities].sort(),s=[...t.capabilities].sort();return n.every(((e,t)=>e===s[t]))})()};function aR({version:e,index:t,isActive:n,versionsLength:a,onRestore:r}){const o=Uk();return s.jsxs("div",{className:"rounded-md border border-border-light p-3",children:[s.jsxs("div",{className:"flex items-center justify-between font-medium",children:[s.jsx("span",{children:o("com_ui_agent_version_title",{versionNumber:a-t})}),n&&s.jsx("span",{className:"rounded-full border border-green-600 bg-green-600/20 px-2 py-0.5 text-xs font-medium text-green-700 dark:border-green-500 dark:bg-green-500/30 dark:text-green-300",children:o("com_ui_agent_version_active")})]}),s.jsx("div",{className:"text-sm text-text-secondary",children:(e=>{const t=e.updatedAt||e.createdAt;if(t)try{const e=new Date(t);return isNaN(e.getTime())||"Invalid Date"===e.toString()?o("com_ui_agent_version_unknown_date"):e.toLocaleString()}catch(n){return o("com_ui_agent_version_unknown_date")}return o("com_ui_agent_version_no_date")})(e)}),!n&&s.jsx("button",{className:"mt-2 text-sm text-blue-500 hover:text-blue-600",onClick:()=>{window.confirm(o("com_ui_agent_version_restore_confirm"))&&r(t)},"aria-label":o("com_ui_agent_version_restore"),children:o("com_ui_agent_version_restore")})]})}function rR({selectedAgentId:e,isLoading:t,error:n,versionContext:a,onRestore:r}){const{versions:o,versionIds:i}=a,l=Uk();return e?t?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(rc,{className:"h-6 w-6"})}):n?s.jsx("div",{className:"py-8 text-center text-red-500",children:l("com_ui_agent_version_error")}):i.length>0?s.jsx("div",{className:"flex flex-col gap-2",children:i.map((({id:e,version:t,isActive:n})=>s.jsx(aR,{version:t,index:e,isActive:n,versionsLength:o.length,onRestore:r},e)))}):s.jsx("div",{className:"py-8 text-center text-text-secondary",children:l("com_ui_agent_version_empty")}):s.jsx("div",{className:"py-8 text-center text-text-secondary",children:l("com_ui_agent_version_no_agent")})}function oR(){const e=Uk(),{showToast:t}=$d(),{agent_id:a,setActivePanel:r}=eS(),o=a??"",{data:i,isLoading:l,error:c,refetch:d}=Ay(o),u=Hy({onSuccess:()=>{t({message:e("com_ui_agent_version_restore_success"),status:"success"}),d()},onError:()=>{t({message:e("com_ui_agent_version_restore_error"),status:"error"})}}),m=i,p=n.useMemo((()=>m?{name:m.name,description:m.description,instructions:m.instructions,artifacts:m.artifacts,capabilities:m.capabilities,tools:m.tools}:null),[m]),f=n.useMemo((()=>[...(null==m?void 0:m.versions)||[]].sort(((e,t)=>{const n=e.updatedAt?new Date(e.updatedAt).getTime():0;return(t.updatedAt?new Date(t.updatedAt).getTime():0)-n}))),[null==m?void 0:m.versions]),h=n.useMemo((()=>f.length>0&&f.find((e=>sR(e,p,f)))||null),[f,p]),g=n.useMemo((()=>{if(0===f.length)return[];const e=f.filter((e=>sR(e,p,f))),t=e.length>0?f.findIndex((t=>t===e[0])):-1;return f.map(((e,n)=>{var s;return{id:n,originalIndex:(null==(s=null==m?void 0:m.versions)?void 0:s.findIndex((t=>t.updatedAt===e.updatedAt&&t.createdAt===e.createdAt&&t.name===e.name)))??n,version:e,isActive:n===t}}))}),[f,p,null==m?void 0:m.versions]),x=n.useMemo((()=>({versions:f,versionIds:g,currentAgent:p,selectedAgentId:o,activeVersion:h})),[f,g,p,o,h]),v=n.useCallback((e=>{const t=g.find((t=>t.id===e));if(t){const e=t.originalIndex;u.mutate({agent_id:o,version_index:e})}}),[u,o,g]);return s.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[s.jsxs("div",{className:"version-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{r(bv.builder)},children:s.jsx("div",{className:"version-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_agent_version_history")})]}),s.jsx("div",{className:"flex flex-col gap-4 px-2",children:s.jsx(rR,{selectedAgentId:o,isLoading:l,error:c,versionContext:x,onRestore:v})})]})}function iR({disableOAuth:e}){const t=Uk(),[a,r]=n.useState(!1),{watch:o,setValue:i,trigger:l}=Uo(),c=o("type");return s.jsxs(ml,{open:a,onOpenChange:r,children:[s.jsx(pl,{asChild:!0,children:s.jsxs("div",{className:"relative mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_authentication")})}),s.jsxs("div",{className:"border-token-border-medium flex rounded-lg border text-sm hover:cursor-pointer",children:[s.jsx("div",{className:"h-9 grow px-3 py-2",children:t(cR(c))}),s.jsx("div",{className:"bg-token-border-medium w-px"}),s.jsx("button",{type:"button",color:"neutral",className:"flex items-center gap-2 px-3",children:s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[s.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),s.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]})})]})]})}),s.jsxs(xl,{className:"w-full max-w-md border-none bg-surface-primary text-text-primary",children:[s.jsx(vl,{className:"border-b border-border-light sm:p-3",children:s.jsx(_l,{children:t("com_ui_authentication")})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-0",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_authentication_type")}),s.jsxs(Va,{defaultValue:Zm.None,onValueChange:e=>i("type",e),value:c,role:"radiogroup","aria-required":"false",dir:"ltr",className:"flex gap-4",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rf8:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:Zm.None,id:":rf8:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_none")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfa:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:Zm.ServiceHttp,id:":rfa:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_api_key")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfc:",className:s_("flex items-center gap-1",!0===e?"cursor-not-allowed":"cursor-pointer"),children:[s.jsx(Ba,{type:"button",role:"radio",disabled:e,value:Zm.OAuth,id:":rfc:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary",!0===e?"cursor-not-allowed":""),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_oauth")]})})]})]}),"none"===c?null:"service_http"===c?s.jsx(lR,{}):s.jsx(dR,{}),s.jsxs("div",{className:"mt-5 flex flex-col gap-3 sm:mt-4 sm:flex-row-reverse",children:[s.jsx("button",{className:"btn relative bg-surface-submit text-primary-foreground hover:bg-surface-submit-hover",onClick:async()=>{const e=await l(void 0,{shouldFocus:!0});i("saved_auth_fields",e),r(!e)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-white",children:t("com_ui_save")})}),s.jsx(hl,{className:"btn btn-neutral relative",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_ui_cancel")})})]})]})]})]})}const lR=()=>{const e=Uk(),{register:t,watch:n,setValue:a}=Uo(),r=n("authorization_type"),o=n("type");return s.jsxs(s.Fragment,{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_api_key")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"new-password",autoComplete:"new-password",className:s_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),...t("api_key",{required:o===Zm.ServiceHttp})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_type")}),s.jsxs(Va,{defaultValue:Jm.Basic,onValueChange:e=>a("authorization_type",e),value:r,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-2 flex gap-6 overflow-hidden rounded-lg",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rfu:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:Jm.Basic,id:":rfu:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rg0:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:Jm.Bearer,id:":rg0:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_bearer")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rg2:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:Jm.Custom,id:":rg2:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_custom")]})})]}),r===Jm.Custom&&s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_custom_header_name")}),s.jsx("input",{className:s_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),placeholder:"X-Api-Key",...t("custom_auth_header",{required:r===Jm.Custom})})]})]})};function cR(e){switch(e){case Zm.ServiceHttp:return"com_ui_api_key";case Zm.OAuth:return"com_ui_oauth";default:return"com_ui_none"}}const dR=()=>{const e=Uk(),{register:t,watch:n,setValue:a}=Uo(),r=n("token_exchange_method"),o=n("type"),i=s_("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring");return s.jsxs(s.Fragment,{children:[s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_id")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:i,...t("oauth_client_id",{required:!1})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_secret")}),s.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:i,...t("oauth_client_secret",{required:!1})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_url")}),s.jsx("input",{className:i,...t("authorization_url",{required:o===Zm.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_url")}),s.jsx("input",{className:i,...t("client_url",{required:o===Zm.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_scope")}),s.jsx("input",{className:i,...t("scope",{required:o===Zm.OAuth})}),s.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_exchange_method")}),s.jsxs(Va,{defaultValue:Jm.Basic,onValueChange:e=>a("token_exchange_method",e),value:r,role:"radiogroup","aria-required":"true",dir:"ltr",style:{outline:"none"},children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rj1:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:ep.DefaultPost,id:":rj1:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_default_post_request")]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("label",{htmlFor:":rj3:",className:"flex cursor-pointer items-center gap-1",children:[s.jsx(Ba,{type:"button",role:"radio",value:ep.BasicAuthHeader,id:":rj3:",className:s_("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:s.jsx($a,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic_auth_header")]})})]})]})};function uR({action_id:e}){const t=Uk(),{watch:a}=Uo(),{showToast:r}=$d(),[o,i]=n.useState(!1),l=`${window.location.protocol}//${window.location.host}/api/actions/${e}/oauth/callback`,c=sE({text:l});if(!e)return null;return a("type")!==Zm.OAuth?null:s.jsxs("div",{className:"mb-1.5 flex flex-col space-y-2",children:[s.jsx("label",{className:"font-semibold",children:t("com_ui_callback_url")}),s.jsx("div",{className:"relative flex items-center",children:s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-10 w-full rounded-lg border",children:[s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsx("div",{className:"relative w-full",children:s.jsx("input",{type:"text",readOnly:!0,value:l,className:"w-full border-0 bg-transparent px-3 py-2 pr-12 text-sm text-text-secondary-alt focus:outline-none",style:{direction:"rtl"}})})}),s.jsx("div",{className:"absolute right-0 flex h-full items-center pr-1",children:s.jsx(Si,{size:"sm",variant:"ghost",type:"button",onClick:()=>{o||(r({message:t("com_ui_copied_to_clipboard")}),c(i))},className:s_("h-8 rounded-md px-2",o?"cursor-default":""),"aria-label":t("com_ui_copy_link"),children:o?s.jsx(ft,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})})]})})]})}function mR({columns:e,data:t}){const n=lr({columns:e,data:t,getCoreRowModel:ur()});return s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>s.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>s.jsx("th",{className:"py-1 font-normal text-text-secondary-alt",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},t)))},t)))}),s.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>s.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>s.jsx("td",{className:"py-2",children:ir(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const pR=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],fR=ko(((e,t)=>{t(Rx(e))}),800);function hR({action:e,agent_id:t,setAction:a}){const r=e=>{e.status||(h(null),x(null)),u(e)},o=Uk(),{showToast:i}=$d(),{handleSubmit:l,reset:c}=Uo(),[d,u]=n.useState(null),[m,p]=n.useState(""),[f,h]=n.useState(null),[g,x]=n.useState(null);n.useEffect((()=>{const t=(null==e?void 0:e.metadata.raw_spec)??"";t&&(p(t),fR(t,r))}),[null==e?void 0:e.metadata.raw_spec]),n.useEffect((()=>{if(!d||!d.status||!d.spec)return;const{functionSignatures:e,requestBuilders:t}=Ex(d.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));h(n),u(null),x(e.map((e=>e.toObjectTool())))}),[d]);const v=By({onSuccess(e){i({message:o("com_assistants_update_actions_success"),status:"success"}),c(),a(e[1])},onError(e){i({message:e.message||o("com_assistants_update_actions_error"),status:"error"})}}),b=l((n=>{a_.log("actions","saving action",n);const s=t??"";if(!s)return;if(!g)return;if(!f)return;let{metadata:a={}}=e??{};const r=null==e?void 0:e.action_id;a.raw_spec=m;const o=new URL(f[0].domain).hostname;if(!o)return;a.domain=o;const{type:i,saved_auth_fields:l}=n,c=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};l&&i===Zm.ServiceHttp?a={...a,api_key:n.api_key,auth:{type:i,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:l&&i===Zm.OAuth?a={...a,auth:{type:i,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:l?(c(a),a.auth={type:i}):c(a),v.mutate({action_id:r,metadata:a,functions:g,agent_id:s})}));return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"",children:[s.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[s.jsx("label",{htmlFor:"schemaInput",className:"text-token-text-primary whitespace-nowrap font-medium",children:"Schema"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{onChange:e=>a_.log("actions","selecting example action",e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[s.jsx("option",{value:"label",children:o("com_ui_examples")}),s.jsx("option",{value:"0",children:"Weather (JSON)"}),s.jsx("option",{value:"1",children:"Pet Store (YAML)"}),s.jsx("option",{value:"2",children:"Blank Template"})]})})]}),s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[s.jsx("div",{className:"relative",children:s.jsx("textarea",{id:"schemaInput",value:m,onChange:e=>{const t=e.target.value;if(p(t),!t)return h(null),x(null),u(null);fR(t,r)},spellCheck:"false",placeholder:o("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),d&&"OpenAPI spec is valid."!==d.message&&s.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:d.message.split("\n").map(((e,t)=>s.jsx("div",{children:e},t)))})]})]}),!!f&&s.jsxs("div",{className:"my-2",children:[s.jsx("div",{className:"flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:o("com_assistants_available_actions")})}),s.jsx(mR,{columns:pR,data:f})]}),s.jsxs("div",{className:"relative my-1",children:[s.jsx(uR,{action_id:null==e?void 0:e.action_id}),s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:o("com_ui_privacy_policy_url")})}),s.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:s.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{disabled:!g||!g.length,onClick:b,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:v.isLoading?s.jsx(rc,{className:"icon-md"}):null!=(null==e?void 0:e.action_id)&&e.action_id?o("com_ui_update"):o("com_ui_create")})})]})}function gR(){const e=Uk(),{showToast:t}=$d(),{setActivePanel:a,action:r,setAction:o,agent_id:i}=eS(),l=$y({onSuccess:()=>{t({message:e("com_assistants_delete_actions_success"),status:"success"}),a(bv.builder),o(void 0)},onError(n){t({message:n.message??e("com_assistants_delete_actions_error"),status:"error"})}}),c=Vo({defaultValues:{type:Zm.None,saved_auth_fields:!1,api_key:"",authorization_type:Jm.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:ep.DefaultPost}}),{reset:d}=c;return n.useEffect((()=>{(null==r?void 0:r.metadata.auth)&&d({type:r.metadata.auth.type||Zm.None,saved_auth_fields:!1,api_key:r.metadata.api_key??"",authorization_type:r.metadata.auth.authorization_type||Jm.Basic,oauth_client_id:r.metadata.oauth_client_id??"",oauth_client_secret:r.metadata.oauth_client_secret??"",authorization_url:r.metadata.auth.authorization_url??"",client_url:r.metadata.auth.client_url??"",scope:r.metadata.auth.scope??"",token_exchange_method:r.metadata.auth.token_exchange_method??ep.DefaultPost})}),[r,d]),s.jsx($o,{...c,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{a(bv.builder),o(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!r&&s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:pv(i)||!r.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(Sc,{className:"text-red-500"})})})}),s.jsx(Ud,{showCloseButton:!1,title:e("com_ui_delete_action"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:e("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{if(pv(i))return t({message:e("com_agents_no_agent_id_error"),status:"error"});l.mutate({action_id:r.action_id,agent_id:i||""})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:(r?"Edit":"Add")+" actions"}),s.jsx("div",{className:"text-xs text-text-secondary",children:e("com_assistants_actions_info")})]}),s.jsx(iR,{}),s.jsx(hR,{action:r,agent_id:i,setAction:o})]})})})}function xR(){return s.jsxs("div",{className:"h-auto bg-white dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Cl,{className:"relative h-20 w-20 rounded-full"})}),s.jsx(Cl,{className:"mb-2 h-5 w-1/5 rounded-lg"}),s.jsx(Cl,{className:"mb-1 h-[40px] w-full rounded-lg"}),s.jsx(Cl,{className:"h-3 w-1/4 rounded-lg"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(Cl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Cl,{className:"h-[40px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Cl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Cl,{className:"h-[100px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Cl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Cl,{className:"h-[40px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Cl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Cl,{className:"mb-2 h-5 w-36 rounded-lg"}),s.jsx(Cl,{className:"mb-4 h-[35px] w-full rounded-lg"}),s.jsx(Cl,{className:"mb-2 h-5 w-24 rounded-lg"}),s.jsx(Cl,{className:"h-[35px] w-full rounded-lg"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(Cl,{className:"mb-2 h-5 w-1/4 rounded-lg"}),s.jsx(Cl,{className:"mb-2 h-[35px] w-full rounded-lg"}),s.jsx(Cl,{className:"mb-2 h-[35px] w-full rounded-lg"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(Cl,{className:"h-8 w-1/2 rounded-lg"}),s.jsx(Cl,{className:"h-8 w-1/2 rounded-lg"})]})]}),s.jsx("div",{className:"mb-6",children:s.jsx(Cl,{className:"h-[35px] w-full rounded-lg"})}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Cl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Cl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Cl,{className:"h-[35px] w-16 rounded-lg"}),s.jsx(Cl,{className:"h-[35px] w-full rounded-lg"})]})]})}function vR(){const e=Uk(),t=Uo(),{control:n}=t;return s.jsxs(rl,{openDelay:50,children:[s.jsx(Bo,{name:"recursion_limit",control:n,render:({field:t})=>s.jsx(hd,{field:t,containerClass:"w-1/2",inputClass:"w-full",label:e("com_ui_agent_recursion_limit"),placeholder:e("com_nav_theme_system"),type:"number",labelClass:"w-fit",labelAdjacent:s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})})}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_agent_recursion_limit_info")})})})})]})}function bR(e){const t=(null==e?void 0:e.toLowerCase())??"";return t&&(/\b(o\d)\b/i.test(t)||/\bgpt-[5-9]\b/i.test(t))?"#000000":t.includes("gpt-4")?"#AB68FF":"#19C37D"}function _R(e,t){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?s.jsx(Pc,{size:.75*t}):/gemini|learnlm|gemma/.test((null==e?void 0:e.toLowerCase())??"")?s.jsx(Ac,{size:.7*t}):s.jsx(Ic,{size:.7*t})}function yR(e){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?"Codey":!0===(null==e?void 0:e.toLowerCase().includes("gemini"))||!0===(null==e?void 0:e.toLowerCase().includes("learnlm"))?"Gemini":!0===(null==e?void 0:e.toLowerCase().includes("gemma"))?"Gemma":"PaLM2"}const jR=n.memo((e=>{const{error:t,button:n,iconURL:a="",endpoint:r,size:o=30,model:i="",assistantName:l,agentName:c}=e,d={icon:a?s.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:s.jsx("div",{title:l,style:{width:o,height:o},className:s_("overflow-hidden rounded-full",e.className??""),children:s.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:a,alt:l,style:{height:"80",width:"80"}})})}):s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(Vc,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:r},u={icon:a?s.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:s.jsx("div",{title:c,style:{width:o,height:o},className:s_("overflow-hidden rounded-full",e.className??""),children:s.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:a,alt:c,style:{height:"80",width:"80"}})})}):s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(lt,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:r},m={[Nu.assistants]:d,[Nu.agents]:u,[Nu.azureAssistants]:d,[Nu.azureOpenAI]:{icon:s.jsx(Ec,{size:.5555555555555556*o}),bg:"linear-gradient(0.375turn, #61bde2, #4389d0)",name:"ChatGPT"},[Nu.openAI]:{icon:s.jsx(ec,{size:.5555555555555556*o}),bg:bR(i),name:"ChatGPT"},[Nu.gptPlugins]:{icon:s.jsx(Jl,{size:.7*o}),bg:`rgba(69, 89, 164, ${!0===n?.75:1})`,name:"Plugins"},[Nu.google]:{icon:_R(i,o),name:yR(i)},[Nu.anthropic]:{icon:s.jsx(jc,{size:.5555555555555556*o}),bg:"#d09a74",name:"Claude"},[Nu.bedrock]:{icon:s.jsx(Kc,{className:"icon-xl text-white"}),bg:"#268672",name:qf[Nu.bedrock]},[Nu.custom]:{icon:s.jsx(cc,{size:.7*o}),name:"Custom"},null:{icon:s.jsx(ec,{size:.7*o}),bg:"grey",name:"N/A"},default:{icon:s.jsx("div",{className:"h-6 w-6",children:s.jsx("div",{className:"overflow-hidden rounded-full",children:s.jsx(AE,{iconURL:a,endpoint:r??"",className:"h-full w-full object-contain",context:"message"})})}),name:r}};let{icon:p,bg:f,name:h}=null!=r&&r&&m[r]?m[r]??{}:m.default;return a&&m[a]&&({icon:p,bg:f,name:h}=m[a]),Mu(r)?p:s.jsxs("div",{title:h??"",style:{background:null!=f&&f||"transparent",width:o,height:o},className:s_("relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",e.className??""),children:[p,!0===t&&s.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-3 w-3 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-white",children:"!"})]})})),wR=n.memo((({iconURL:e,altName:t,containerStyle:a={width:20,height:20},imageStyle:r={width:"100%",height:"100%"},className:o="icon-md mr-1 shrink-0 overflow-hidden rounded-full",endpoint:i})=>{const[l,c]=n.useState(!1),d=i&&LE[i]?LE[i]:LE.unknown;return l||!e?s.jsxs("div",{className:"relative",style:{...a,margin:"2px"},children:[s.jsx("div",{className:o,children:s.jsx(d,{endpoint:i,context:"menu-item",size:a.width})}),l&&e&&s.jsx("div",{className:"absolute flex items-center justify-center rounded-full bg-red-500",style:{width:"14px",height:"14px",top:0,right:0},children:s.jsx(gt,{size:10,className:"text-white"})})]}):s.jsx("div",{className:o,style:a,children:s.jsx("img",{src:e,alt:t??"Icon",style:r,className:"object-cover",onError:()=>{c(!0)},loading:"lazy",decoding:"async",width:Number(a.width)||20,height:Number(a.height)||20})})}));wR.displayName="URLIcon";const NR={"menu-item":"relative flex h-full items-center justify-center overflow-hidden rounded-full",message:"icon-md",default:"icon-xl relative flex h-full overflow-hidden rounded-full"},CR={"menu-item":{width:"20px",height:"20px"},default:{width:"100%",height:"100%"}},kR={default:{width:"100%",height:"100%"}},SR=n.memo((({iconURL:e="",modelLabel:t="",endpointIconURL:a,assistantAvatar:r,assistantName:o,agentAvatar:i,agentName:l,context:c})=>{const d=n.useMemo((()=>LE[e]??LE.unknown),[e]);return n.useMemo((()=>!(!e||!e.includes("http")&&!e.startsWith("/images/"))),[e])?s.jsx(wR,{iconURL:e,altName:t,className:NR[c??"default"]??NR.default,containerStyle:CR[c??"default"]??CR.default,imageStyle:kR[c??"default"]??kR.default}):s.jsx("div",{className:"shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white text-black",children:d&&s.jsx(d,{size:41,context:c,className:"h-2/3 w-2/3",agentName:l,iconURL:a,assistantName:o,avatar:r||i})})}));function TR(e){var t,a;const{message:r,conversation:o,assistant:i,agent:l}=e,c=n.useMemo((()=>({...o??{},...{...r,iconURL:(null==r?void 0:r.iconURL)??""}})),[o,r]),d=c.iconURL??"";let u=c.endpoint;u=Mb({endpointsConfig:void 0,iconURL:d,endpoint:u});const m=(i?i.name:"")??"",p=(i?null==(t=i.metadata)?void 0:t.avatar:"")??"",f=(l?l.name:"")??"",h=(l?null==(a=null==l?void 0:l.avatar)?void 0:a.filepath:"")??"",g=n.useMemo((()=>{let e="";return i?e=p:l&&(e=h),e}),[i,l,p,h]);return console.log("MessageIcon",{endpoint:u,iconURL:d,assistantName:m,assistantAvatar:p,agentName:f,agentAvatar:h}),!0!==(null==r?void 0:r.isCreatedByUser)&&d&&d.includes("http")?s.jsx(SR,{iconURL:d,modelLabel:c.chatGptLabel??c.modelLabel??"",context:"message",assistantAvatar:p,assistantName:m,agentAvatar:h,agentName:f}):!0===(null==r?void 0:r.isCreatedByUser)?s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:s.jsx(Fc,{})}):s.jsx(jR,{...c,endpoint:u,iconURL:g,model:(null==r?void 0:r.model)??(null==o?void 0:o.model),assistantName:m,agentName:f,size:28.8})}const ER=({field:e,currentAgentId:t})=>{var a;const r=Uk(),[o,i]=n.useState(""),l=zk()||{},c=e.value||[],d=n.useMemo((()=>Object.values(l)),[l]),u=n.useMemo((()=>d.filter((e=>(null==e?void 0:e.id)!==t)).map((e=>({label:(null==e?void 0:e.name)||"",value:null==e?void 0:e.id,icon:s.jsx(TR,{message:{endpoint:Nu.agents,isCreatedByUser:!1},agent:e})})))),[d,t]),m=n.useCallback((e=>l[e]),[l]);n.useEffect((()=>{o&&c.length<10&&(e.onChange([...c,o]),i(""))}),[o,c,e]);return s.jsxs(rl,{openDelay:50,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"font-semibold text-text-primary",children:r("com_ui_agent_chain")}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsxs("div",{className:"text-xs text-text-secondary",children:[c.length," / ",10]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"flex h-10 items-center justify-between rounded-md border border-border-medium bg-surface-primary-contrast px-3 py-2",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(TR,{message:{endpoint:Nu.agents,isCreatedByUser:!1},agent:t?l[t]:void 0})}),s.jsx("div",{className:"font-medium text-text-primary",children:null==(a=m(t))?void 0:a.name})]})}),s.jsx(xt,{className:"mx-auto text-text-secondary",size:14}),c.map(((t,n)=>{var a;return s.jsxs(S.Fragment,{children:[s.jsxs("div",{className:"flex h-10 items-center gap-2 rounded-md border border-border-medium bg-surface-tertiary pr-2",children:[s.jsx(zd,{isCollapsed:!1,ariaLabel:r("com_ui_agent_var",{0:r("com_ui_select")}),selectedValue:t,setValue:t=>((t,n)=>{const s=[...c];s[t]=n,e.onChange(s)})(n,t),selectPlaceholder:r("com_ui_agent_var",{0:r("com_ui_select")}),searchPlaceholder:r("com_ui_agent_var",{0:r("com_ui_search")}),items:u,displayValue:(null==(a=m(t))?void 0:a.name)??"",SelectIcon:s.jsx(TR,{message:{endpoint:Nu.agents,isCreatedByUser:!1},agent:t?l[t]:void 0}),className:"flex-1 border-border-heavy",containerClassName:"px-0"}),s.jsx("button",{className:"rounded-xl p-1 transition hover:bg-surface-hover",onClick:()=>{return t=n,void e.onChange(c.filter(((e,n)=>n!==t)));var t},children:s.jsx(vt,{size:18,className:"text-text-secondary"})})]}),n<c.length-1&&s.jsx(xt,{className:"mx-auto text-text-secondary",size:14})]},t)})),c.length<10&&s.jsxs(s.Fragment,{children:[c.length>0&&s.jsx(xt,{className:"mx-auto text-text-secondary",size:14}),s.jsx(zd,{isCollapsed:!1,ariaLabel:r("com_ui_agent_var",{0:r("com_ui_add")}),selectedValue:"",setValue:i,selectPlaceholder:r("com_ui_agent_var",{0:r("com_ui_add")}),searchPlaceholder:r("com_ui_agent_var",{0:r("com_ui_search")}),items:u,className:"h-10 w-full border-dashed border-border-heavy text-center text-text-secondary hover:text-text-primary",containerClassName:"px-0",SelectIcon:s.jsx(bt,{size:16,className:"text-text-secondary"})})]}),c.length>=10&&s.jsx("p",{className:"pt-1 text-center text-xs italic text-text-tertiary",children:r("com_ui_agent_chain_max",{0:10})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:r("com_ui_agent_chain_info")})})})})]})};function RR(){const e=Uk(),t=Uo(),{control:a,watch:r}=t,o=r("id"),{agentsConfig:i,setActivePanel:l}=eS(),c=n.useMemo((()=>(null==i?void 0:i.capabilities.includes(ef.chain))??!1),[i]);return s.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[s.jsxs("div",{className:"advanced-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{l(bv.builder)},children:s.jsx("div",{className:"advanced-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_advanced_settings")})]}),s.jsxs("div",{className:"flex flex-col gap-4 px-2",children:[s.jsx(vR,{}),c&&s.jsx(Bo,{name:"agent_ids",control:a,defaultValue:[],render:({field:e})=>s.jsx(ER,{field:e,currentAgentId:o})})]})]})}function IR({name:e,config:t,hasValue:n,control:a,errors:r}){var o;const i=Uk();return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(Dl,{enableHTML:!0,description:t.description||"",render:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ul,{htmlFor:e,className:"text-sm font-medium",children:t.title}),s.jsx(Gc,{className:"h-6 w-6 cursor-help text-text-secondary transition-colors hover:text-text-primary"})]})}),n?s.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),s.jsx("span",{children:i("com_ui_set")})]}):s.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full border border-border-medium"}),s.jsx("span",{children:i("com_ui_unset")})]})]}),s.jsx(Bo,{name:e,control:a,defaultValue:"",render:({field:a})=>s.jsx(cl,{id:e,type:"text",...a,placeholder:n?i("com_ui_mcp_update_var",{0:t.title}):`${i("com_ui_mcp_enter_var",{0:t.title})} ${i("com_ui_optional")}`,className:"w-full rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary placeholder:text-text-secondary focus:outline-none sm:text-sm"})}),r[e]&&s.jsx("p",{className:"text-xs text-red-500",children:null==(o=r[e])?void 0:o.message})]})}function PR({fields:e,onSave:t,onRevoke:a,serverName:r,isSubmitting:o=!1}){const i=Uk(),{data:l}=dj(r,{enabled:!!r}),{reset:c,control:d,handleSubmit:u,formState:{errors:m}}=Vo({defaultValues:n.useMemo((()=>{const t={};return Object.keys(e).forEach((e=>{t[e]=""})),t}),[e])}),p=e=>{t(e)};return e&&0!==Object.keys(e).length?s.jsxs("div",{className:"flex-1 space-y-4",children:[s.jsx("form",{onSubmit:u(p),className:"space-y-4",children:Object.entries(e).map((([e,t])=>{var n;const a=(null==(n=null==l?void 0:l.authValueFlags)?void 0:n[e])||!1;return s.jsx(IR,{name:e,config:t,hasValue:a,control:d,errors:m},e)}))}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(Si,{type:"button",variant:"destructive",disabled:o,onClick:()=>{a(),c()},children:i("com_ui_revoke")}),s.jsx(Si,{type:"button",variant:"submit",disabled:o,onClick:u(p),children:i(o?"com_ui_saving":"com_ui_save")})]})]}):null}const AR=({currentPage:e,maxPage:t,onChangePage:n})=>{const a=Uk(),r=[...Array(t).keys()].map((e=>e+1)),o=e=>{e<1||e>t||n(e)};return s.jsxs("div",{className:"flex gap-2 text-sm text-black/60 dark:text-white/70",children:[s.jsxs("div",{role:"button",tabIndex:0,"aria-label":"Previous page",onClick:()=>o(e-1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e-1)},className:"flex cursor-default items-center text-sm "+(1===e?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})}),a("com_ui_prev")]}),r.map((t=>s.jsx("div",{role:"button",tabIndex:0,className:"flex h-5 w-5 items-center justify-center text-sm "+(e===t?"text-blue-600 hover:text-blue-600 dark:text-blue-600 dark:hover:text-blue-600":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},onClick:()=>n(t),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n(t)},children:t},t))),s.jsxs("div",{role:"button","aria-label":"Next page",tabIndex:0,onClick:()=>o(e+1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e+1)},className:"flex cursor-default items-center text-sm "+(e===t?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[a("com_ui_next"),s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})]})]})};function MR({content:e,position:t}){return s.jsx(il,{children:s.jsx(ll,{side:t,className:"w-80 ",children:s.jsx("div",{className:"space-y-2",children:s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e})})})})}function LR({plugin:e,onSubmit:t,isEntityTool:n}){const{register:a,handleSubmit:r,formState:{errors:o,isDirty:i,isValid:l,isSubmitting:c}}=Vo(),d=Uk(),u=(null==e?void 0:e.authConfig)??[];return s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:s.jsxs("form",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",method:"POST",onSubmit:r((s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n}))),children:[u.map(((e,t)=>{const n=e.authField.split("||")[0];return s.jsxs("div",{className:"flex w-full flex-col gap-1",children:[s.jsx("label",{htmlFor:n,className:"mb-1 text-left text-sm font-medium text-gray-700/70 dark:text-gray-50/70",children:e.label}),s.jsxs(rl,{openDelay:300,children:[s.jsx(ol,{className:"grid w-full items-center gap-2",children:s.jsx("input",{type:"text",autoComplete:"off",id:n,"aria-invalid":!!o[n],"aria-describedby":`${n}-error`,"aria-label":e.label,"aria-required":"true",...a(n,{required:`${e.label} is required.`,minLength:{value:1,message:`${e.label} must be at least 1 character long`}}),className:"flex h-10 max-h-10 w-full resize-none rounded-md border border-gray-200 bg-transparent px-3 py-2 text-sm text-gray-700 shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none placeholder:text-gray-400 focus:border-gray-400 focus:bg-gray-50 focus:outline-none focus:ring-0 focus:ring-gray-400 focus:ring-opacity-0 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:border-gray-400 focus:dark:bg-gray-600 dark:focus:outline-none dark:focus:ring-0 dark:focus:ring-gray-400 dark:focus:ring-offset-0"})}),s.jsx(MR,{content:e.description,position:"right"})]}),o[n]&&s.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-400",children:o[n].message})]},`${n}-${t}`)})),s.jsx("button",{disabled:!i||!l||c,type:"button",className:"btn btn-primary relative",onClick:()=>{r((s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n})))()},children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d("com_ui_save"),s.jsx(_t,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})})})}function OR({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1,isConfiguring:r=!1,isInitializing:o=!1}){var i,l,c;const d=Uk(),u=(null==(i=e.metadata)?void 0:i.name)||e.tool_id,m=(null==(l=e.metadata)?void 0:l.description)||"",p=null==(c=e.metadata)?void 0:c.icon,f=a?{text:d("com_nav_tool_remove"),icon:s.jsx(jt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",disabled:!1}:r?{text:d("com_ui_confirm"),icon:s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative",disabled:!1}:o?{text:d("com_ui_initializing"),icon:s.jsx(yt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative opacity-75 cursor-not-allowed",disabled:!0}:{text:d("com_ui_add"),icon:s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"}),className:"btn btn-primary relative",disabled:!1};return s.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:s.jsxs("div",{className:"relative h-full w-full",children:[p?s.jsx("img",{src:p,alt:d("com_ui_logo",{0:u}),className:"h-full w-full rounded-[5px] bg-white"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:s.jsx(yt,{className:"h-8 w-8 text-text-secondary"})}),s.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),s.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[s.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:u}),s.jsx("button",{className:f.className,"aria-label":`${f.text} ${u}`,onClick:()=>{a?n():t()},disabled:f.disabled,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[f.text,f.icon]})})]})]}),s.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:m})]})}function DR({isOpen:e,agentId:t,setIsOpen:a,mcpServerNames:r}){var o,i;const l=Uk(),c=pr(),{initializeServer:d}=GT(),{getValues:u,setValue:m}=Uo(),{removeTool:p}=KT({showToast:!1}),{mcpServersMap:f,startupConfig:h}=eS(),{refetch:g}=Uj({enabled:f.size>0}),[x,v]=n.useState(!1),[b,_]=n.useState(null),[y,j]=n.useState(null),{maxPage:w,setMaxPage:N,currentPage:C,setCurrentPage:k,itemsPerPage:S,searchChanged:T,setSearchChanged:E,searchValue:R,setSearchValue:I,gridRef:P,handleSearch:A,handleChangePage:M,error:L,setError:O,errorMessage:D,setErrorMessage:F}=fE(),z=yk(),U=e=>{var t,n;O(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&F(s),setTimeout((()=>{O(!1),F("")}),5e3)},V=async(e,t)=>{try{_(e),t&&Object.keys(t).length>0&&(await z.mutateAsync({pluginKey:`${dh.mcp_prefix}${e}`,action:"install",auth:t,isEntityTool:!0}),await c.invalidateQueries([ex.mcpAuthValues,e]),await new Promise((e=>setTimeout(e,500))));const n=f.get(e);if(!(null==n?void 0:n.isConnected)){const t=await d(e);if((null==t?void 0:t.success)&&t.oauthRequired&&t.oauthUrl)return void _(null)}await B(e),_(null)}catch(n){console.error("Error adding MCP server:",n),U(n),_(null)}},B=async e=>{var t;const{data:n}=await g(),s=u("tools")||[],a=[`${dh.mcp_server}${dh.mcp_delimiter}${e}`];if(null==(t=null==n?void 0:n.servers)?void 0:t[e]){n.servers[e].tools.forEach((e=>{a.push(e.pluginKey)}))}const r=a.filter((e=>!s.includes(e)));r.length>0&&m("tools",[...s,...r])},$=n.useMemo((()=>new Set(r)),[r]),H=n.useMemo((()=>Array.from(f.values()).sort(((e,t)=>e.serverName.localeCompare(t.serverName)))),[f]),G=n.useMemo((()=>R?H.filter((e=>e.serverName.toLowerCase().includes(R.toLowerCase()))):H),[H,R]);return n.useEffect((()=>{N(Math.ceil(G.length/S)),T&&(k(1),E(!1))}),[N,S,T,k,E,G.length]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),k(1),I(""),j(null),_(null)},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:l("com_nav_tool_dialog_mcp_server_tools")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:l("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("button",{onClick:()=>{a(!1),k(1),j(null),_(null)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})]}),L&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[l("com_nav_plugin_auth_error")," ",D]}),y&&s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsx("div",{className:"mb-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:l("com_ui_mcp_configure_server_description",{0:y})})}),s.jsx(PR,{serverName:y,isSubmitting:x,fields:(null==(i=null==(o=null==h?void 0:h.mcpServers)?void 0:o[y])?void 0:i.customUserVars)||{},onSave:e=>(async(e,t)=>{try{v(!0);const n={};Object.entries(t).forEach((([e,t])=>{t&&t.trim()&&(n[e]=t.trim())})),await V(e,Object.keys(n).length>0?n:void 0),j(null)}catch(n){console.error("Error saving custom vars:",n),U(n)}finally{v(!1)}})(y,e),onRevoke:()=>{return e=y,v(!0),void z.mutate({pluginKey:`${dh.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{U(e),v(!1)},onSuccess:async()=>{j(null),v(!1)}});var e}})]}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",onClick:()=>j(null),children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:R,onChange:A,placeholder:l("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:P,className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:G.slice((C-1)*S,C*S).map((e=>{const n=$.has(e.serverName),a=y===e.serverName,r=b===e.serverName,o={agent_id:t,tool_id:e.serverName,metadata:{...e.metadata,description:`${l("com_ui_tool_collection_prefix")} ${e.serverName}`}};return s.jsx(OR,{tool:o,isInstalled:n,isConfiguring:a,isInitializing:r,onAddTool:()=>(async e=>{var t;if(y===e)return j(null),void(await V(e));const n=null==(t=null==h?void 0:h.mcpServers)?void 0:t[e];(null==n?void 0:n.customUserVars)&&Object.keys(n.customUserVars).length>0?j(e):await V(e)})(e.serverName),onRemoveTool:()=>p(e.serverName)},e.serverName)}))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:w>0?s.jsx(AR,{currentPage:C,maxPage:w,onChangePage:M}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}function FR({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1}){var r,o,i;const l=Uk(),c=()=>{a?n():t()},d=(null==(r=e.metadata)?void 0:r.name)||e.tool_id||e.name,u=(null==(o=e.metadata)?void 0:o.description)||e.description||"",m=(null==(i=e.metadata)?void 0:i.icon)||e.icon;return s.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:s.jsxs("div",{className:"relative h-full w-full",children:[m?s.jsx("img",{src:m,alt:l("com_ui_logo",{0:d}),className:"h-full w-full rounded-[5px] bg-white"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:s.jsx(yt,{className:"h-8 w-8 text-text-secondary"})}),s.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),s.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[s.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:d}),a?s.jsx("button",{className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",onClick:c,"aria-label":`${l("com_nav_tool_remove")} ${d}`,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l("com_nav_tool_remove"),s.jsx(jt,{className:"flex h-4 w-4 items-center stroke-2"})]})}):s.jsx("button",{className:"btn btn-primary relative","aria-label":`${l("com_ui_add")} ${d}`,onClick:c,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l("com_ui_add"),s.jsx(bt,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})]}),s.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:u})]})}function zR({isOpen:e,endpoint:t,setIsOpen:a}){const r=Uk(),o=Lu(t),{getValues:i,setValue:l}=Uo(),{regularTools:c}=eS(),{maxPage:d,setMaxPage:u,currentPage:m,setCurrentPage:p,itemsPerPage:f,searchChanged:h,setSearchChanged:g,searchValue:x,setSearchValue:v,gridRef:b,handleSearch:_,handleChangePage:y,error:j,setError:w,errorMessage:N,setErrorMessage:C,showPluginAuthForm:k,setShowPluginAuthForm:S,selectedPlugin:T,setSelectedPlugin:E}=fE(),R=yk(),I=e=>{var t,n;w(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&C(s),setTimeout((()=>{w(!1),C("")}),5e3)},P=e=>{const t=()=>{const t=i("tools")||[];t.push(e.pluginKey),l("tools",Array.from(new Set(t)))};if(!e.auth)return t();R.mutate(e,{onError:e=>{I(e)},onSuccess:t}),S(!1)},A=(c||[]).filter((e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes(x.toLowerCase())}));return n.useEffect((()=>{A&&(u(Math.ceil(A.length/f)),h&&(p(1),g(!1)))}),[x,f,A,h,u,p,g]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),p(1),v("")},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:r(o?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:r("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("div",{className:"sm:mt-0",children:s.jsx("button",{onClick:()=>{a(!1),p(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})})]}),j&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[r("com_nav_plugin_auth_error")," ",N]}),k&&s.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:s.jsx(LR,{plugin:T,onSubmit:e=>P(e),isEntityTool:!0})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:x,onChange:_,placeholder:r("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:b,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((m-1)*f,m*f).map(((e,t)=>{var n;return s.jsx(FR,{tool:{tool_id:e.pluginKey,metadata:e},isInstalled:(null==(n=i("tools"))?void 0:n.includes(e.pluginKey))||!1,onAddTool:()=>(e=>{S(!1);const t=null==c?void 0:c.find((t=>t.pluginKey===e));E(t);const{authConfig:n,authenticated:s=!1}=t??{};n&&n.length>0&&!s?S(!0):P({pluginKey:e,action:"install",auth:{}})})(e.pluginKey),onRemoveTool:()=>{return t=e.pluginKey,void R.mutate({pluginKey:t,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>I(e),onSuccess:()=>{var e;const n=(null==(e=i("tools"))?void 0:e.filter((e=>e!==t)))||[];l("tools",n)}});var t}},t)}))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:d>0?s.jsx(AR,{currentPage:m,maxPage:d,onChangePage:y}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}const UR=({className:e})=>{const t=Uk(),a=Uo(),{categories:r}=$k(),o=Ho({name:"id",control:a.control}),{syncCategory:i}=(e=>{const[t,s]=n.useState(!1);return{syncCategory:n=>{t||""!==e||n.value||(n.onChange("general"),s(!0))}}})(o),l=e=>e.label&&e.label.startsWith("com_")?t(e.label):e.label,c=r.map((e=>({label:l(e),value:e.value}))),d=t("com_ui_search_agent_category"),u=t("com_ui_agent_category_selector_aria");return s.jsx(Bo,{name:"category",control:a.control,defaultValue:"general",render:({field:t})=>{i(t);const n=(e=>{var t;const n=c.find((t=>t.value===e));return(null==n?void 0:n.label)||(null==(t=c.find((e=>"general"===e.value)))?void 0:t.label)})(t.value);return s.jsx(zd,{selectedValue:t.value,displayValue:n,searchPlaceholder:d,setValue:e=>{t.onChange(e)},items:c,className:s_(e),ariaLabel:u,isCollapsed:!1,showCarat:!0})}})};function VR({action:e,onClick:t}){const[a,r]=n.useState(!1);return s.jsxs("div",{role:"button",tabIndex:0,onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},className:"group flex w-full rounded-lg border border-border-medium text-sm hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-text-primary",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),"aria-label":`Action for ${e.metadata.domain}`,children:[s.jsx("div",{className:"h-9 grow overflow-hidden text-ellipsis whitespace-nowrap px-3 py-2",style:{wordBreak:"break-all"},children:e.metadata.domain}),s.jsx("div",{className:s_("h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-tertiary focus:outline-none focus:ring-2 focus:ring-text-primary group-focus:flex",a?"flex":"hidden"),"aria-label":"Settings",children:s.jsx(Cc,{className:"icon-sm","aria-hidden":"true"})})]})}const BR=s_(h_,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",m_),$R=Object.keys(bh).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function HR(){const e=n.useId(),t=Uk(),a=Uo(),{control:r,setValue:o,getValues:i}=a,[l,c]=n.useState(!1);return s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"mb-2 flex items-center",children:[s.jsx("label",{className:"text-token-text-primary flex-grow font-medium",htmlFor:"instructions",children:t("com_ui_instructions")}),s.jsx("div",{className:"ml-auto",title:"Add variables to instructions",children:s.jsx(Nd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:l,setIsOpen:c,trigger:s.jsxs(ie,{id:"variables-menu-button","aria-label":"Add variable to instructions",className:"flex h-7 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[s.jsx(bt,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),t("com_ui_variables")]}),items:$R.map((e=>({label:t(e.label)||e.label,onClick:()=>((e,n)=>{const s=i("instructions")||"",a=s.length>0?"\n":"",r=t(e);o("instructions",s+a+r+": "+n),c(!1)})(e.label,e.value)}))),menuId:e,className:"z-30"})})]}),s.jsx(Bo,{name:"instructions",control:r,render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("textarea",{...e,value:e.value??"",className:s_(BR,"min-h-[100px] resize-y"),id:"instructions",placeholder:t("com_agents_instructions_placeholder"),rows:3,"aria-label":"Agent instructions","aria-required":"true","aria-invalid":n?"true":"false"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert",children:t("com_ui_field_required")})]})})]})}function GR(){return s.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const KR=({url:e,progress:t=1})=>{const n=2*Math.PI*55,a=n-t*n;return s.jsx("div",{children:s.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[s.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}},e||"default-key"),t<1&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:a,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function WR({handleFileChange:e}){const t=Uk(),a=n.useRef(null);return s.jsx(Ha,{children:s.jsxs(Ga,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[s.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded-lg p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;a.current&&(a.current.value=""),null==(e=a.current)||e.click()},children:t("com_ui_upload_image")}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:a,tabIndex:-1})]})})}function qR({agent_id:e="",avatar:t,createMutation:a}){const r=pr(),[o,i]=n.useState(!1),[l,c]=n.useState(""),[d,u]=n.useState(1),[m,p]=n.useState(null),f=n.useRef(null),{data:h=Gm}=Xy({select:e=>Ym(e)}),g=Uk(),{showToast:x}=$d(),{mutate:v}=Vy({onMutate:()=>{u(.4)},onSuccess:t=>{var n,s,o;f.current!==(null==(n=a.data)?void 0:n.id)&&(f.current=(null==(s=a.data)?void 0:s.id)??""),x({message:g("com_ui_upload_agent_avatar")}),p(null);const i=(null==(o=t.avatar)?void 0:o.filepath)??"";c(i),Oy.forEach((n=>{const s=r.getQueryData([ex.agents,n]);if(!(null==s?void 0:s.data))return;const a=s.data.map((n=>n.id===e?{...n,...t}:n));r.setQueryData([ex.agents,n],{...s,data:a})})),Gy(r),u(1)},onError:e=>{console.error("Error:",e),p(null),c(""),x({message:g("com_ui_upload_error"),status:"error"}),u(1)}});n.useEffect((()=>{if(m){const e=new FileReader;e.onloadend=()=>{c(e.result)},e.readAsDataURL(m)}}),[m]),n.useEffect((()=>{t&&t.filepath?c(t.filepath):c("")}),[t]),n.useEffect((()=>{const e=!!(a.isSuccess&&m&&l&&l.includes("base64"));if((!e||f.current!==a.data.id)&&e&&a.data.id){const e=new FormData;e.append("file",m,m.name),e.append("agent_id",a.data.id),v({agent_id:a.data.id,formData:e})}}),[a.data,a.isSuccess,m,l,v]);return s.jsxs(Ka,{open:o,onOpenChange:i,children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Wa,{asChild:!0,children:s.jsx("button",{type:"button",className:"h-20 w-20",children:l?s.jsx(KR,{url:l,progress:d}):s.jsx(GR,{})})})}),s.jsx(WR,{handleFileChange:n=>{var s;const a=null==(s=n.target.files)?void 0:s[0],r=h.avatarSizeLimit??0;if(r&&a&&a.size<=r){p(a),i(!1);const n=e??"";if(!n)return;const s=new FormData;s.append("file",a,a.name),s.append("agent_id",n),"object"==typeof t&&s.append("avatar",JSON.stringify(t)),v({agent_id:n,formData:s})}else{const e=r?Fv(r):2;x({message:g("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}i(!1)}})]})}function QR({isOpen:e,onOpenChange:t,onFilesSelected:a,disabled:r=!1,isDownloading:o=!1,downloadProgress:i=null,maxSelectionCount:l}){const[c,d]=n.useState(null),u=Uk(),{openSharePointPicker:m,closeSharePointPicker:p,cleanup:f}=function({containerNode:e,onFilesSelected:t,onClose:s,disabled:a=!1,maxSelectionCount:r=10}){const[o]=Ie(Cy.lang),{user:i}=qk(),{showToast:l}=$d(),c=Uk(),d=n.useRef(null),u=n.useRef(null),m=n.useRef(""),{data:p}=Wy(),f=null==p?void 0:p.sharePointBaseUrl,h="openid"===(null==i?void 0:i.provider),{token:g,isLoading:x,error:v}=AT({enabled:h&&!a&&!!f,purpose:"Pick"}),b=n.useCallback((()=>`sharepoint-picker-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),[]),_=n.useCallback((async e=>{const n=u.current;if(n)try{switch(e.data.type){case"notification":console.log("SharePoint picker notification:",e.data);break;case"command":{n.postMessage({type:"acknowledge",id:e.data.id});const a=e.data.data;switch(console.log("SharePoint picker command:",a),a.command){case"authenticate":console.log("Authentication requested, providing token"),console.log("Command details:",a),console.log("Token available:",!!(null==g?void 0:g.access_token)),(null==g?void 0:g.access_token)?n.postMessage({type:"result",id:e.data.id,data:{result:"token",token:g.access_token}}):(console.error("No token available for authentication"),n.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"noToken",message:"No authentication token available"}}}));break;case"close":console.log("Close command received"),n.postMessage({type:"result",id:e.data.id,data:{result:"success"}}),null==s||s();break;case"pick":{console.log("Files picked from SharePoint:",a);const s=a.items||a.files||[];if(console.log("Extracted items:",s),s&&s.length>0){const e=s.map((e=>{var t,n,s,a,r,o,i,l,c;return{id:e.id||e.shareId||(null==(t=e.driveItem)?void 0:t.id),name:e.name||(null==(n=e.driveItem)?void 0:n.name),size:e.size||(null==(s=e.driveItem)?void 0:s.size),webUrl:e.webUrl||(null==(a=e.driveItem)?void 0:a.webUrl),downloadUrl:e.downloadUrl||(null==(r=e.driveItem)?void 0:r["@microsoft.graph.downloadUrl"]),driveId:e.driveId||(null==(o=e.parentReference)?void 0:o.driveId)||(null==(l=null==(i=e.driveItem)?void 0:i.parentReference)?void 0:l.driveId),itemId:e.id||(null==(c=e.driveItem)?void 0:c.id),sharePointItem:e}}));console.log("Processed SharePoint files:",e),t&&t(e),l({message:`Selected ${e.length} file(s) from SharePoint`,status:"success"})}n.postMessage({type:"result",id:e.data.id,data:{result:"success"}});break}default:console.warn(`Unsupported command: ${a.command}`),n.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"unsupportedCommand",message:a.command}}})}break}default:console.log("Unknown message type:",e.data.type)}}catch(a){console.error("Error processing port message:",a)}else console.error("No port available for communication")}),[g,t,l,s]),y=n.useCallback((e=>{var t;if(console.log("=== SharePoint picker init message received ==="),console.log("Event source:",e.source),console.log("Event data:",e.data),console.log("Expected channelId:",m.current),e.source&&e.source===(null==(t=d.current)?void 0:t.contentWindow)){const t=e.data;"initialize"===t.type&&t.channelId===m.current&&(console.log("Establishing MessagePort communication"),u.current=e.ports[0],u.current?(u.current.addEventListener("message",_),u.current.start(),u.current.postMessage({type:"activate"}),console.log("MessagePort established and activated")):console.error("No MessagePort found in initialize event"))}}),[_]),j=n.useRef(null),w=n.useCallback((()=>{j.current&&(window.removeEventListener("message",j.current),j.current=null),u.current&&(u.current.close(),u.current=null),e&&(e.innerHTML=""),m.current=""}),[e]),N=n.useCallback((()=>{w()}),[w]);return{openSharePointPicker:(null==p?void 0:p.sharePointFilePickerEnabled)&&h&&!v?async()=>{if(g)if(e)try{const t=b();m.current=t,console.log("=== SharePoint File Picker v8 (MessagePort) ==="),console.log("Token available:",{hasToken:!!g.access_token,tokenType:g.token_type,expiresIn:g.expires_in,scopes:g.scope}),console.log("Channel ID:",t);const n={sdk:"8.0",entry:{sharePoint:{}},messaging:{origin:window.location.origin,channelId:t},authentication:{enabled:!1},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0,shared:!0,sharedLibraries:!0,myOrganization:!0,site:!0}},selection:{mode:"multiple",maximumCount:r},title:c("com_files_sharepoint_picker_title"),commands:{upload:{enabled:!1},createFolder:{enabled:!1}},search:{enabled:!0}},s=document.createElement("iframe");s.style.width="100%",s.style.height="100%",s.style.background="#F5F5F5",s.style.border="none",s.title="SharePoint File Picker",s.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"),d.current=s,e.innerHTML="",e.appendChild(s),j.current=y,window.addEventListener("message",y),s.src="about:blank",s.onload=()=>{const e=s.contentWindow;if(!e)return;const t=new URLSearchParams({filePicker:JSON.stringify(n),locale:o||"en-US"}),a=f+`/_layouts/15/FilePicker.aspx?${t}`,r=e.document.createElement("form");r.setAttribute("action",a),r.setAttribute("method","POST");const i=e.document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","access_token"),i.setAttribute("value",g.access_token),r.appendChild(i),e.document.body.appendChild(r),r.submit()}}catch(t){console.error("SharePoint file picker error:",t),l({message:"Failed to open SharePoint file picker.",status:"error"})}else console.error("No container ref provided for SharePoint picker");else l({message:"Unable to access SharePoint. Please ensure you are logged in with Microsoft.",status:"error"})}:()=>{},closeSharePointPicker:N,error:v?"Failed to authenticate with SharePoint":null,cleanup:w,isTokenLoading:x}}({containerNode:c,onFilesSelected:a,disabled:r,onClose:()=>h(!1),maxSelectionCount:l}),h=e=>{e||p(),t(e)},g=S.useCallback((e=>{d(e)}),[]);return n.useEffect((()=>(c&&e&&m(),()=>{e||f()})),[c,e]),s.jsx(ml,{open:e,onOpenChange:h,children:s.jsxs(fl,{children:[s.jsx(gl,{className:"bg-black/50"}),s.jsxs(xl,{className:"sharepoint-picker-bg fixed left-1/2 top-1/2 z-50 h-[680px] max-h-[90vh] max-w-[90vw] -translate-x-1/2 -translate-y-1/2 rounded-lg border bg-surface-primary p-2 shadow-lg focus:outline-none",showCloseButton:!0,children:[s.jsx(_l,{className:"sr-only",children:u("com_files_sharepoint_picker_title")}),s.jsx("div",{ref:g,className:"sharepoint-picker-bg relative flex p-2",children:o&&s.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-lg bg-black/30 backdrop-blur-sm",children:s.jsx("div",{className:"mx-4 w-full max-w-sm rounded-lg bg-surface-primary p-6 shadow-lg",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),s.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:u("com_files_downloading")}),i&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-sm text-text-secondary",children:u("com_files_download_progress",{0:i.completed,1:i.total})}),i.currentFile&&s.jsx("p",{className:"truncate text-xs text-text-tertiary",children:i.currentFile}),s.jsx("div",{className:"h-2 w-full rounded-full bg-surface-tertiary",children:s.jsx("div",{className:"h-2 rounded-full bg-blue-600 transition-all duration-300",style:{width:`${Math.round(i.completed/i.total*100)}%`}})}),s.jsx("p",{className:"text-xs text-text-tertiary",children:u("com_files_download_percent_complete",{0:Math.round(i.completed/i.total*100)})}),i.failed.length>0&&s.jsx("p",{className:"text-xs text-red-500",children:u("com_files_download_failed",{0:i.failed.length})})]}),!i&&s.jsx("p",{className:"text-sm text-text-secondary",children:u("com_files_preparing_download")})]})})})})]})]})})}const YR=n.memo((({size:e,user:t,avatarSrc:a,username:r,className:o})=>{const[i,l]=n.useState(!1);return s.jsx("div",{title:r,style:{width:e,height:e},className:s_("relative flex items-center justify-center",o??""),children:((null==t?void 0:t.avatar)||(null==t?void 0:t.username)&&""!==(null==t?void 0:t.username.trim()))&&!i?s.jsx("img",{className:"rounded-full",src:((null==t?void 0:t.avatar)??"")||a,alt:"avatar",onError:()=>{l(!0)}}):s.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:s.jsx(Fc,{})})})}));YR.displayName="UserAvatar";const XR=n.memo((e=>{const{user:t}=qk(),{size:n=30,isCreatedByUser:a}=e,r=Hi(t),o=Uk();if(a){const a=(null==t?void 0:t.name)??(null==t?void 0:t.username)??o("com_nav_user");return s.jsx(YR,{size:n,user:t,avatarSrc:r,username:a,className:e.className})}return s.jsx(jR,{...e})}));XR.displayName="Icon";const ZR=e=>{const{size:t=30,iconURL:n="",iconClassName:a,error:r}=e;let o="default";"string"==typeof e.endpoint&&(o=e.endpoint);const i={[Nu.azureOpenAI]:{icon:s.jsx(Ec,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Nu.openAI]:{icon:s.jsx(Rc,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Nu.gptPlugins]:{icon:s.jsx(Tc,{}),name:"Plugins"},[Nu.google]:{icon:s.jsx(Mc,{}),name:e.modelLabel??"Google"},[Nu.anthropic]:{icon:s.jsx(jc,{className:"icon-md shrink-0 dark:text-white"}),name:e.modelLabel??"Claude"},[Nu.custom]:{icon:s.jsx(cc,{}),name:"Custom"},[Nu.chatGPTBrowser]:{icon:s.jsx(dc,{}),name:"ChatGPT"},[Nu.assistants]:{icon:s.jsx(Bc,{className:"icon-sm"}),name:"Assistant"},[Nu.azureAssistants]:{icon:s.jsx(Bc,{className:"icon-sm"}),name:"Assistant"},[Nu.agents]:{icon:s.jsx(lt,{className:"icon-sm"}),name:e.modelLabel??qf[Nu.agents]},[Nu.bedrock]:{icon:s.jsx(Kc,{className:"icon-xl text-text-primary"}),name:e.modelLabel??qf[Nu.bedrock]},default:{icon:s.jsx(AE,{iconURL:n,endpoint:o,className:"icon-sm",context:"nav"}),name:o}};let{icon:l,name:c}=i[o]??i.default;return n&&null!=i[n]&&({icon:l,name:c}=i[n]),s.jsxs("div",{"data-testid":"convo-icon",title:c,"aria-hidden":"true",style:{width:t,height:t},className:s_("relative flex items-center justify-center rounded-sm text-text-secondary",e.className??""),children:[l,!0===r&&s.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-4 w-4 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-text-secondary",children:"!"})]})};function JR({conversation:e,endpointsConfig:t,assistantMap:a,agentsMap:r,className:o="",containerClassName:i="",context:l,size:c}){var d,u;const m=(null==e?void 0:e.iconURL)??"";let p=null==e?void 0:e.endpoint;p=Mb({endpointsConfig:t,iconURL:m,endpoint:p});const{entity:f,isAgent:h}=n.useMemo((()=>Ob({endpoint:p,agentsMap:r,assistantMap:a,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id})),[p,null==e?void 0:e.agent_id,null==e?void 0:e.assistant_id,r,a]),g=(null==f?void 0:f.name)??"",x=h?null==(d=null==f?void 0:f.avatar)?void 0:d.filepath:null==(u=null==f?void 0:f.metadata)?void 0:u.avatar,v=Sb(t,p,"iconURL"),b=Lb({endpoint:p,endpointsConfig:t,endpointIconURL:v}),_=LE[b]??null;return s.jsx(s.Fragment,{children:m&&m.includes("http")?s.jsx(SR,{iconURL:m,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",endpointIconURL:v,assistantAvatar:x,assistantName:g,agentAvatar:x,agentName:g,context:l}):s.jsx("div",{className:i,children:p&&null!=_&&s.jsx(_,{size:c,context:l,endpoint:p,className:o,iconURL:v,assistantName:g,agentName:g,avatar:x})})})}function eI({conversation:e,endpointsConfig:t,className:n="mr-0",assistantMap:a,context:r}){var o,i;const l=(null==e?void 0:e.iconURL)??"";let c=null==e?void 0:e.endpoint;c=Mb({endpointsConfig:t,iconURL:l,endpoint:c});const d=Sb(t,c,"type"),u=Sb(t,c,"iconURL"),m=Mu(c)?null==(o=null==a?void 0:a[c])?void 0:o[(null==e?void 0:e.assistant_id)??""]:null,p=m&&(null==(i=m.metadata)?void 0:i.avatar)||"",f=m&&(m.name??""),h=p||l;return h&&(h.includes("http")||h.startsWith("/images/"))?s.jsx(SR,{iconURL:h,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",context:r,endpointIconURL:u,assistantAvatar:p,assistantName:f??""}):s.jsx(ZR,{size:20,iconURL:u,endpoint:c,endpointType:d,model:null==e?void 0:e.model,error:!1,className:n,isCreatedByUser:!1,chatGptLabel:void 0,modelLabel:void 0})}const tI={max:"com_endpoint_openai_max",temp:"com_endpoint_openai_temp",topp:"com_endpoint_openai_topp",freq:"com_endpoint_openai_freq",pres:"com_endpoint_openai_pres",resend:"com_endpoint_openai_resend_files",detail:"com_endpoint_openai_detail"},nI={anthropic:{temp:"com_endpoint_anthropic_temp",topp:"com_endpoint_anthropic_topp",topk:"com_endpoint_anthropic_topk",maxoutputtokens:"com_endpoint_anthropic_maxoutputtokens",resend:tI.resend,promptcache:"com_endpoint_anthropic_prompt_cache"},google:{temp:"com_endpoint_google_temp",topp:"com_endpoint_google_topp",topk:"com_endpoint_google_topk",maxoutputtokens:"com_endpoint_google_maxoutputtokens"},openAI:tI,azureOpenAI:tI,gptPlugins:{func:"com_endpoint_func_hover",skip:"com_endpoint_skip_hover",...tI}};function sI({endpoint:e,type:t,side:n}){var a;const r=Uk(),o=null==(a=nI[e])?void 0:a[t];return o?s.jsx(il,{children:s.jsx(ll,{side:n,className:"z-[999] w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r(o)})})})}):null}function aI({conversation:e,setOption:t,models:a,readonly:r}){const o=Uk(),i=n.useMemo((()=>({label:o("com_endpoint_use_active_assistant"),value:""})),[o]),l=Ok((e=>Cv(e.data))),{model:c,endpoint:d,assistant_id:u,endpointType:m,promptPrefix:p,instructions:f}=e??{},h=n.useMemo((()=>Object.values(l[d??""]??{})),[l,d]),g=n.useMemo((()=>{const e=h.map((({id:e,name:t})=>({label:t,value:e})));return[i,...e].filter(Boolean)}),[h,i]),[v,b]=hT({setOption:t,optionKey:"promptPrefix",initialValue:p}),[_,y]=hT({setOption:t,optionKey:"instructions",initialValue:f}),j=n.useMemo((()=>{var e;return null!=u&&u?null==(e=l[d??""])?void 0:e[u]:null}),[u,l,d]),w=n.useMemo((()=>a.map((e=>({label:e===(null==j?void 0:j.model)?`${e} (${o("com_endpoint_assistant_model")})`:e,value:e})))),[a,j,o]),[N,C]=n.useState(null!=j?{label:j.name??"",value:j.id}:i);if(n.useEffect((()=>{""===N.value&&t("presetOverride")({assistant_id:N.value})}),[N]),!e)return null;const k=t("model"),S=m??d;return s.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[s.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Fd,{value:c??"",title:o("com_ui_model"),setValue:qv(k),availableValues:w,disabled:r,className:s_(h_,"flex w-full resize-none",p_),containerClassName:"flex w-full resize-none"})})}),s.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-3",children:s.jsxs(rl,{openDelay:300,children:[s.jsx(ol,{className:"grid w-full items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Fd,{title:o("com_endpoint_assistant"),value:N,setValue:qv((e=>{var n;if(!e)return void C(i);const s=null==(n=l[d??""])?void 0:n[e];s?(C({label:s.name??"",value:s.id||""}),t("assistant_id")(s.id),s.model&&k(s.model)):C(i)})),availableValues:g,disabled:r,className:s_(h_,"flex w-full resize-none",p_),containerClassName:"flex w-full resize-none"})})}),s.jsx(sI,{endpoint:S??"",type:"temp",side:yv.Left})]})}),s.jsxs("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6",children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[o("com_endpoint_prompt_prefix_assistants")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"promptPrefix",disabled:r,value:b??"",onChange:v,placeholder:o("com_endpoint_prompt_prefix_assistants_placeholder"),className:s_(h_,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"instructions",className:"text-left text-sm font-medium",children:[o("com_endpoint_instructions_assistants")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"instructions",disabled:r,value:y??"",onChange:_,placeholder:o("com_endpoint_instructions_assistants_placeholder"),className:s_(h_,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]})]})]})}function rI({side:e,description:t,disabled:n,langCode:a,sideOffset:r=30,className:o}){const i=Uk();if(n)return null;const l=a?i(t):t;return s.jsx(il,{children:s.jsx(ll,{side:e,className:`z-[999] w-80 ${o}`,sideOffset:r,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"whitespace-pre-wrap text-sm text-text-secondary",children:l})})})})}const oI={[Oh.Slider]:function({label:e="",settingKey:t,defaultValue:a,range:r,description:o="",columnSpan:i,setOption:l,optionType:c,options:d,enumMappings:u,readonly:m=!1,showDefault:p=!1,includeInput:f=!0,labelCode:h=!1,descriptionCode:g=!1,conversation:x}){const v=Uk(),{preset:b}=Mk(),_=n.useMemo((()=>(!r&&d&&d.length>0)??!1),[d,r]),[y,j,w]=hT({optionKey:t,initialValue:c!==Fh.Custom?null==x?void 0:x[t]:a,setter:()=>({}),setOption:l,delay:_?0:_v});vT({preset:b,settingKey:t,defaultValue:a,conversation:x,inputValue:j,setInputValue:w});const N=n.useMemo((()=>_?(null==x?void 0:x[t])??a:j),[x,a,t,j,_]),C=n.useMemo((()=>_&&d?d.reduce(((e,t,n)=>(e[t]=n,e)),{}):{}),[_,d]),k=n.useMemo((()=>_&&d?d.reduce(((e,t,n)=>(e[n]=t,e)),{}):{}),[_,d]),S=n.useCallback((e=>{if(_&&u&&null!=e){const t=String(e);if(t in u){const e=String(u[t]);return e.startsWith("com_")?v(e)??e:e}}return String(null!=e?e:a??"")}),[_,u,a,v]),T=n.useCallback((()=>{if(null!=a&&u){const e=String(a);if(e in u){const t=String(u[e]);return t.startsWith("com_")?v(t)??t:t}}return String(a??"")}),[a,u,v]),E=n.useCallback((e=>{y(_?k[e]:e)}),[_,y,k]),R=n.useMemo((()=>_&&d?d.length-1:r?r.max:0),[_,d,r]);return r||_?s.jsx("div",{className:s_("flex flex-col items-center justify-start gap-2",null!=i?`col-span-${i}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsxs(ul,{htmlFor:`${t}-dynamic-setting`,className:"break-words text-left text-sm font-medium",children:[h?v(e)??e:e||t," ",p&&s.jsxs("small",{className:"opacity-40",children:["(",v("com_endpoint_default"),": ",T(),")"]})]}),f&&!_?s.jsx(dl,{id:`${t}-dynamic-setting-input-number`,disabled:m,value:j??a,onChange:e=>y(Number(e)),max:r?r.max:((null==d?void 0:d.length)??0)-1,min:r?r.min:0,step:r?r.step??1:1,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 py-1 text-xs group-hover/temp:border-gray-200"))}):s.jsx(cl,{id:`${t}-dynamic-setting-input`,disabled:m,value:S(N),onChange:()=>({}),className:s_(h_,s_(g_,"reset-rc-number-input h-auto w-14 border-0 py-1 pl-1 text-center text-xs group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{id:`${t}-dynamic-setting-slider`,disabled:m,value:[_?C[N??""]:j??a],onValueChange:e=>E(e[0]),onDoubleClick:()=>y(a),max:R,min:r?r.min:0,step:r?r.step??1:1,className:"flex h-4 w-full"})]}),o&&s.jsx(rI,{description:g?v(o)??o:o,side:yv.Left})]})}):null},[Oh.Dropdown]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,optionType:l,options:c,readonly:d=!1,showLabel:u=!0,showDefault:m=!1,labelCode:p=!1,descriptionCode:f=!1,placeholder:h="",placeholderCode:g=!1,conversation:x}){const v=Uk(),{preset:b}=Mk(),[_,y]=n.useState(null),j=n.useMemo((()=>l===Fh.Custom?_:(null==x?void 0:x[t])??a),[x,a,l,t,_]);return vT({preset:b,settingKey:t,defaultValue:a,conversation:x,inputValue:_,setInputValue:y,preventDelayedUpdate:!0}),c&&0!==c.length?s.jsx("div",{className:s_("flex flex-col items-center justify-start gap-6",null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[!0===u&&s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-dropdown`,className:"text-left text-sm font-medium",children:[p?v(e)??e:e||t,m&&s.jsxs("small",{className:"opacity-40",children:["(",v("com_endpoint_default"),": ",a,")"]})]})}),s.jsx(Fd,{showLabel:!1,emptyTitle:!0,disabled:d,value:j,setValue:e=>{l!==Fh.Custom?i(t)(e):y(e)},availableValues:c,containerClassName:"w-full",id:`${t}-dynamic-dropdown`,placeholder:g?v(h)??h:h})]}),r&&s.jsx(rI,{description:f?v(r)??r:r,side:yv.Left})]})}):null},[Oh.Switch]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,readonly:l=!1,showDefault:c=!1,labelCode:d=!1,descriptionCode:u=!1,conversation:m}){const p=Uk(),{preset:f}=Mk(),[h,g]=n.useState(!!a);vT({preset:f,settingKey:t,defaultValue:a,conversation:m,inputValue:h,setInputValue:g,preventDelayedUpdate:!0});const x=(null==m?void 0:m[t])??a;return s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-switch`,className:"break-words text-left text-sm font-medium",children:[d?p(e)??e:e||t," ",c&&s.jsxs("small",{className:"opacity-40",children:["(",p("com_endpoint_default"),":"," ",null!=a?"com_ui_on":"com_ui_off",")"]})]})}),s.jsx(kl,{id:`${t}-dynamic-switch`,checked:x,onCheckedChange:e=>{g(e),i(t)(e)},disabled:l,className:"flex"})]}),r&&s.jsx(rI,{description:u?p(r)??r:r,side:yv.Left})]})})},[Oh.Textarea]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:r,setOption:o,optionType:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:f}){const h=Uk(),{preset:g}=Mk(),[x,v,b]=hT({optionKey:t,initialValue:i!==Fh.Custom?null==f?void 0:f[t]:n,setter:()=>({}),setOption:o});return vT({preset:g,settingKey:t,defaultValue:void 0===n?"":n,conversation:f,inputValue:v,setInputValue:b}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-textarea`,className:"text-left text-sm font-medium",children:[u?h(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${h("com_endpoint_default")}: ${n}`:h("com_endpoint_default_blank"),")"]})]})}),s.jsx(Ll,{id:`${t}-dynamic-textarea`,disabled:c,value:v??"",onChange:x,placeholder:p?h(l)??l:l,className:s_("flex max-h-[138px] min-h-[100px] w-full resize-none rounded-lg bg-surface-secondary px-3 py-2 focus:outline-none")})]}),a&&s.jsx(rI,{description:m?h(a)??a:a,side:yv.Left})]})})},[Oh.Input]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:r,setOption:o,optionType:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:f}){const h=Uk(),{preset:g}=Mk(),[x,v,b]=hT({optionKey:t,initialValue:i!==Fh.Custom?null==f?void 0:f[t]:n,setter:()=>({}),setOption:o});vT({preset:g,settingKey:t,defaultValue:void 0===n?"":n,conversation:f,inputValue:v,setInputValue:b});const _=p&&h(l)||l;return s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?h(e)||e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${h("com_endpoint_default")}: ${n}`:h("com_endpoint_default_blank"),")"]})]})}),s.jsx(cl,{id:`${t}-dynamic-input`,disabled:c,value:v??n??"",onChange:e=>{x(e,!isNaN(Number(e.target.value)))},placeholder:_,className:s_("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2")})]}),a&&s.jsx(rI,{description:m&&h(a)||a,side:yv.Left})]})})},[Oh.Checkbox]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,optionType:l,readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,conversation:p}){const f=Uk(),{preset:h}=Mk(),[g,x,v]=hT({optionKey:t,initialValue:l!==Fh.Custom?null==p?void 0:p[t]:a,setter:()=>({}),setOption:i}),b=n.useMemo((()=>(null==p?void 0:p[t])??a),[p,a,t]);return vT({preset:h,settingKey:t,defaultValue:a,conversation:p,inputValue:x,setInputValue:v}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsx(ol,{className:"grid w-full items-center",children:s.jsxs("div",{className:"flex justify-start gap-4",children:[s.jsxs(ul,{htmlFor:`${t}-dynamic-checkbox`,className:"text-left text-sm font-medium",children:[u?f(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",f("com_endpoint_default"),":"," ",f(null!=a?"com_ui_yes":"com_ui_no"),")"]})]}),s.jsx(Ti,{id:`${t}-dynamic-checkbox`,disabled:c,checked:b,onCheckedChange:e=>{g(e),i(t)(e)},className:"mt-[2px] focus:ring-opacity-20 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:focus:ring-gray-600 dark:focus:ring-opacity-50 dark:focus:ring-offset-0"})]})}),r&&s.jsx(rI,{description:m?f(r)??r:r,side:yv.Left})]})})},[Oh.Tags]:function({label:e="",settingKey:t,defaultValue:a=[],description:r="",columnSpan:o,setOption:i,placeholder:l="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,descriptionSide:f=yv.Left,conversation:h,minTags:g,maxTags:x}){const v=Uk(),{preset:b}=Mk(),{showToast:_}=$d(),y=n.useRef(null),[j,w]=n.useState(""),[N,C]=n.useState(a??[]),k=n.useCallback((e=>{C(e),i(t)(e)}),[i,t]),S=n.useCallback((()=>{y.current&&y.current.focus()}),[y]),T=null==h?void 0:h[t],E=n.useMemo((()=>T??a??[]),[T,a]),R=n.useCallback((e=>{if(!E)return;if(null!=g&&E.length<=g)return void _({message:v("com_ui_min_tags",{0:g+""}),status:"warning"});const t=E.filter(((t,n)=>n!==e));k(t)}),[v,g,E,_,k]),I=n.useCallback((()=>{if(!j)return;let e=[...E??[],j];null!=x&&e.length>x&&(_({message:v("com_ui_max_tags",{0:x+""}),status:"warning"}),e=e.slice(-x)),k(e),w("")}),[j,E,k,x,_,v]);return vT({preset:b,settingKey:t,defaultValue:void 0===a?[]:a,inputValue:N,setInputValue:C,preventDelayedUpdate:!0,conversation:h}),s.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?v(e)??e:e||t," ",d&&s.jsxs("small",{className:"opacity-40",children:["(",void 0!==a&&a.length?`${v("com_endpoint_default")}: ${a}`:v("com_endpoint_default_blank"),")"]})]})}),s.jsx("div",{children:s.jsxs("div",{className:"mb-2 flex flex-wrap break-all rounded-lg bg-surface-secondary",children:[E&&E.length>0&&s.jsx("div",{className:"flex w-full gap-1 p-1",children:E.map(((e,t)=>s.jsx(Ml,{label:e,onClick:S,onRemove:()=>{R(t),y.current&&y.current.focus()}},`${e}-${t}`)))}),s.jsx(cl,{ref:y,id:`${t}-dynamic-input`,disabled:c,value:j,onKeyDown:e=>{E&&("Backspace"!==e.key||j||R(E.length-1),"Enter"===e.key&&I())},onChange:e=>w(e.target.value),placeholder:p?v(l)??l:l,className:s_("flex h-10 max-h-10 border-none bg-surface-secondary px-3 py-2")})]})})]}),r&&s.jsx(rI,{description:m?v(r)??r:r,side:f})]})})},[Oh.Combobox]:function({label:e="",settingKey:t,defaultValue:a,description:r="",columnSpan:o,setOption:i,options:l,items:c,showLabel:d=!0,showDefault:u=!1,labelCode:m=!1,descriptionCode:p=!1,searchPlaceholderCode:f=!1,selectPlaceholderCode:h=!1,conversation:g,isCollapsed:x=!1,SelectIcon:v=null,selectPlaceholder:b="",searchPlaceholder:_=""}){const y=Uk(),{preset:j}=Mk(),[w,N]=n.useState(null),C=n.useMemo((()=>(null==g?void 0:g[t])??a),[g,a,t]),k=n.useMemo((()=>null!=c?c:(l??[]).map((e=>({label:e,value:e})))),[l,c]),S=n.useCallback((e=>{N(e),i(t)(e)}),[i,t]);return vT({preset:j,settingKey:t,defaultValue:a,conversation:g,inputValue:w,setInputValue:N,preventDelayedUpdate:!0}),0===(k??l??[]).length?null:s.jsx("div",{className:s_("flex flex-col items-center justify-start gap-6",null!=o?`col-span-${o}`:"col-span-full"),children:s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[!0===d&&s.jsx("div",{className:"flex w-full justify-between",children:s.jsxs(ul,{htmlFor:`${t}-dynamic-combobox`,className:"text-left text-sm font-medium",children:[m?y(e)??e:e||t,u&&s.jsxs("small",{className:"opacity-40",children:["(",y("com_endpoint_default"),": ",a,")"]})]})}),s.jsx(zd,{displayValue:C,selectPlaceholder:!0===h?y(b):b,searchPlaceholder:!0===f?y(_):_,isCollapsed:x,ariaLabel:t,selectedValue:C??"",setValue:S,items:k,SelectIcon:v})]}),r&&s.jsx(rI,{description:p?y(r)??r:r,side:yv.Left})]})})}};function iI({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Au((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return uv[t]??uv[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=oI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})}function lI({conversation:e,setOption:t,models:n,readonly:a}){const r=Uk(),o=Yu[Nu.google],{model:i,modelLabel:l,promptPrefix:c,temperature:d,topP:u,topK:m,maxContextTokens:p,maxOutputTokens:f}=e??{},[h,g]=hT({setOption:t,optionKey:"maxContextTokens",initialValue:p});if(!e)return null;const v=t("model"),b=t("modelLabel"),_=t("promptPrefix"),y=t("temperature"),j=t("topP"),w=t("topK"),N=t("maxOutputTokens");return s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Fd,{title:r("com_ui_model"),value:i??"",setValue:v,availableValues:n,disabled:a,className:s_(h_,"flex w-full resize-none",p_),containerClassName:"flex w-full resize-none"})}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"modelLabel",className:"text-left text-sm font-medium",children:[r("com_endpoint_custom_name")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),s.jsx(cl,{id:"modelLabel",disabled:a,value:l||"",onChange:e=>b(e.target.value??null),placeholder:r("com_endpoint_google_custom_name_placeholder"),className:s_(h_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",m_)})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[r("com_endpoint_prompt_prefix")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:"promptPrefix",disabled:a,value:c||"",onChange:e=>_(e.target.value??null),placeholder:r("com_endpoint_prompt_prefix_placeholder"),className:s_(h_,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2")})]})]}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsxs(rl,{openDelay:300,children:[s.jsx(ol,{className:"grid w-full items-center gap-2",children:s.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[s.jsxs(ul,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[r("com_endpoint_context_tokens")," "]}),s.jsx(dl,{id:"max-context-tokens",stringMode:!1,disabled:a,value:g,onChange:h,placeholder:r("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),s.jsx(rI,{description:"com_endpoint_context_info",langCode:!0,side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default"),": ",o.temperature.default,")"]})]}),s.jsx(dl,{id:"temp-int",disabled:a,value:d,onChange:e=>y(e??o.temperature.default),max:o.temperature.max,min:o.temperature.min,step:o.temperature.step,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:a,value:[d??o.temperature.default],onValueChange:e=>y(e[0]),onDoubleClick:()=>y(o.temperature.default),max:o.temperature.max,min:o.temperature.min,step:o.temperature.step,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"temp",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_top_p")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.topP.default+""}),")"]})]}),s.jsx(dl,{id:"top-p-int",disabled:a,value:u,onChange:e=>j(e??o.topP.default),max:o.topP.max,min:o.topP.min,step:o.topP.step,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:a,value:[u??o.topP.default],onValueChange:e=>j(e[0]),onDoubleClick:()=>j(o.topP.default),max:o.topP.max,min:o.topP.min,step:o.topP.step,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"topp",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"top-k-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_top_k")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.topK.default+""}),")"]})]}),s.jsx(dl,{id:"top-k-int",disabled:a,value:m,onChange:e=>w(e??o.topK.default),max:o.topK.max,min:o.topK.min,step:o.topK.step,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:a,value:[m??o.topK.default],onValueChange:e=>w(e[0]),onDoubleClick:()=>w(o.topK.default),max:o.topK.max,min:o.topK.min,step:o.topK.step,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"topk",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"max-tokens-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_max_output_tokens")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_with_num",{0:o.maxOutputTokens.default+""}),")"]})]}),s.jsx(dl,{id:"max-tokens-int",disabled:a,value:f,onChange:e=>N(Number(e)),max:o.maxOutputTokens.max,min:o.maxOutputTokens.min,step:o.maxOutputTokens.step,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:a,value:[f??o.maxOutputTokens.default],onValueChange:e=>N(e[0]),onDoubleClick:()=>N(o.maxOutputTokens.default),max:o.maxOutputTokens.max,min:o.maxOutputTokens.min,step:o.maxOutputTokens.step,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"maxoutputtokens",side:yv.Left})]})]})]})}function cI({title:e="Plugins",value:t,disabled:a,setSelected:r,availableValues:o,showAbove:i=!1,showLabel:l=!0,containerClassName:c,optionsClassName:d="",labelClassName:u="",isSelected:m,className:p,searchPlaceholder:f,optionValueKey:h="value"}){const[g,x]=n.useState(!1),v=n.useRef(null),b=["select-plugin","plugins-label","selected-plugins"];qi(v,(()=>x(!1)),b);const[_,y]=Gl({availableOptions:o,placeholder:f,getTextKeyOverride:e=>(e.name||"").toUpperCase()}),j=Boolean(y)?_:o,w={className:"top-full mt-3"};i&&(w.className="bottom-full mb-3");const N={open:g};return s.jsx("div",{className:s_("flex items-center justify-center gap-2",c??""),children:s.jsx("div",{className:"relative w-full",children:s.jsx(Gr,{value:t,onChange:e=>{r(e),x(!0)},disabled:a,children:()=>s.jsxs(s.Fragment,{children:[s.jsxs(Kr,{className:s_("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus:outline-none focus:ring-0 focus:ring-offset-0 dark:border-gray-600 dark:border-white/20 dark:bg-gray-800 sm:text-sm",p??""),id:b[0],onClick:()=>x((e=>!e)),...N,children:[" ",l&&s.jsx(Wr,{className:s_("block text-xs text-gray-700 dark:text-gray-500",u),id:b[1],"data-headlessui-state":"",children:e}),s.jsx("span",{className:"inline-flex w-full truncate",id:b[2],children:s.jsxs("span",{className:s_("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",l?"":"text-xs"),children:[!l&&e.length>0&&s.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[e,":"]}),s.jsx("span",{className:"flex h-6 items-center gap-1 truncate",children:s.jsx("div",{className:"flex gap-1",children:t.map(((e,t)=>s.jsxs("div",{className:"relative",style:{width:"16px",height:"16px"},children:[e.icon?s.jsx("img",{src:e.icon,alt:`${e} logo`,className:"h-full w-full rounded-sm bg-white"}):s.jsx(yt,{className:"h-full w-full rounded-sm bg-white"}),s.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]},t)))})})]})}),s.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:i?{transform:"scaleY(-1)"}:{},children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),s.jsx(qr,{show:g,as:S.Fragment,leave:"transition ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",...w,children:s.jsxs(Qr,{ref:v,className:s_("absolute z-50 mt-2 max-h-60 w-full overflow-auto rounded bg-white text-base text-xs ring-1 ring-black/10 focus:outline-none dark:bg-gray-800 dark:ring-white/20 dark:last:border-0 md:w-[100%]",d),children:[y,j.map(((e,t)=>{if(!e)return null;const n=m(e[h]);return s.jsx(Yr,{value:e[h],className:"group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden border-b border-black/10 pl-3 pr-9 text-gray-800 last:border-0 hover:bg-gray-20 dark:border-white/20 dark:text-white dark:hover:bg-gray-700",children:s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[!e.isButton&&s.jsx("span",{className:"h-6 w-6 shrink-0",children:s.jsxs("div",{className:"relative",style:{width:"100%",height:"100%"},children:[e.icon?s.jsx("img",{src:e.icon,alt:`${e.name} logo`,className:"h-full w-full rounded-sm bg-white"}):s.jsx(yt,{className:"h-full w-full rounded-sm bg-white"}),s.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]})}),s.jsx("span",{className:s_("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",n?"font-semibold":""),children:e.name}),e.isButton&&s.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:s.jsx(Nt,{})}),n&&!e.isButton&&s.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:s.jsx(ic,{})})]})},t)}))]})})]})})})})}function dI({conversation:e,setOption:t,setTools:a,checkPluginSelection:r,models:o,readonly:i}){const l=Uk(),c=Ae(Cy.availableTools),{data:d}=_k({select:Sv}),u=n.useMemo((()=>(null==e?void 0:e.tools)?Tv(e.tools,null==d?void 0:d.map):[]),[e,d]),m=n.useMemo((()=>c?Object.values(c):[]),[c]),{model:p,modelLabel:f,chatGptLabel:h,promptPrefix:g,temperature:v,top_p:b,frequency_penalty:_,presence_penalty:y,maxContextTokens:j}=e??{},[w,N]=hT({setOption:t,optionKey:"chatGptLabel",initialValue:f??h}),[C,k]=hT({setOption:t,optionKey:"promptPrefix",initialValue:g}),[S,T]=hT({setOption:t,optionKey:"temperature",initialValue:v}),[E,R]=hT({setOption:t,optionKey:"top_p",initialValue:b}),[I,P]=hT({setOption:t,optionKey:"frequency_penalty",initialValue:_}),[A,M]=hT({setOption:t,optionKey:"presence_penalty",initialValue:y}),[L,O]=hT({setOption:t,optionKey:"maxContextTokens",initialValue:j}),D=t("model");return e?s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Fd,{title:l("com_endpoint_completion_model"),value:p??"",setValue:D,availableValues:o,disabled:i,className:s_(h_,"flex w-full resize-none",p_),containerClassName:"flex w-full resize-none"})}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"chatGptLabel",className:"text-left text-sm font-medium",children:[l("com_endpoint_custom_name")," ",s.jsx("small",{className:"opacity-40",children:l("com_endpoint_default_empty")})]}),s.jsx(cl,{id:"chatGptLabel",disabled:i,value:N||"",onChange:e=>w(e.target.value??null),placeholder:l("com_endpoint_openai_custom_name_placeholder"),className:s_(h_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",m_)})]}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[l("com_endpoint_prompt_prefix")," ",s.jsx("small",{className:"opacity-40",children:l("com_endpoint_default_empty")})]}),s.jsx(x,{id:"promptPrefix",disabled:i,value:k||"",onChange:e=>C(e.target.value??null),placeholder:l("com_endpoint_plug_set_custom_instructions_for_gpt_placeholder"),className:s_(h_,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2")})]})]})]}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsx(cI,{showAbove:!1,showLabel:!1,setSelected:a,value:u,optionValueKey:"pluginKey",availableValues:m,isSelected:r,searchPlaceholder:l("com_ui_select_search_plugin"),className:s_(h_,"flex w-full resize-none",m_),optionsClassName:"w-full max-h-[275px] dark:bg-gray-700 z-10 border dark:border-gray-600",containerClassName:"flex w-full resize-none border border-transparent",labelClassName:"dark:text-white"}),s.jsxs(rl,{openDelay:300,children:[s.jsx(ol,{className:"grid w-full items-center gap-2",children:s.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[s.jsxs(ul,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[l("com_endpoint_context_tokens")," "]}),s.jsx(dl,{id:"max-context-tokens",stringMode:!1,disabled:i,value:O,onChange:L,placeholder:l("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),s.jsx(rI,{description:"com_endpoint_context_info",langCode:!0,side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0.8"}),")"]})]}),s.jsx(dl,{id:"temp-int",disabled:i,value:T,onChange:e=>S(Number(e)),max:2,min:0,step:.01,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:i,value:[T??.8],onValueChange:e=>S(e[0]),onDoubleClick:()=>S(.8),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"temp",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_top_p")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"1"}),")"]})]}),s.jsx(dl,{id:"top-p-int",disabled:i,value:R,onChange:e=>E(Number(e)),max:1,min:0,step:.01,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:i,value:[R??1],onValueChange:e=>E(e[0]),onDoubleClick:()=>E(1),max:1,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"topp",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"freq-penalty-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_frequency_penalty")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0"}),")"]})]}),s.jsx(dl,{id:"freq-penalty-int",disabled:i,value:P,onChange:e=>I(Number(e)),max:2,min:-2,step:.01,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:i,value:[P??0],onValueChange:e=>I(e[0]),onDoubleClick:()=>I(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"freq",side:yv.Left})]}),s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"pres-penalty-int",className:"text-left text-sm font-medium",children:[l("com_endpoint_presence_penalty")," ",s.jsxs("small",{className:"opacity-40",children:["(",l("com_endpoint_default_with_num",{0:"0"}),")"]})]}),s.jsx(dl,{id:"pres-penalty-int",disabled:i,value:M,onChange:e=>A(Number(e)),max:2,min:-2,step:.01,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:i,value:[M??0],onValueChange:e=>A(e[0]),onDoubleClick:()=>A(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"pres",side:yv.Left})]})]})]}):null}function uI({readonly:e,examples:t,setExample:n,addExample:a,removeExample:r}){const o=Uk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"examples-grid",className:"grid gap-6 sm:grid-cols-2",children:t.map(((a,r)=>s.jsxs(S.Fragment,{children:[s.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:`input-${r}`,className:"text-left text-sm font-medium",children:[o("com_ui_input")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:`input-${r}`,disabled:e,value:a.input.content||"",onChange:e=>n(r,"input",e.target.value??null),placeholder:"Set example input. Example is ignored if empty.",className:s_(h_,"flex max-h-[138px] min-h-[75px] w-full resize-none px-3 py-2")})]})}),s.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsxs(ul,{htmlFor:`output-${r}`,className:"text-left text-sm font-medium",children:[o("com_endpoint_output")," ",s.jsxs("small",{className:"opacity-40",children:["(",o("com_endpoint_default_blank"),")"]})]}),s.jsx(x,{id:`output-${r}`,disabled:e,value:a.output.content||"",onChange:e=>n(r,"output",e.target.value??null),placeholder:"Set example output. Example is ignored if empty.",className:s_(h_,"flex max-h-[300px] min-h-[75px] w-full resize-none px-3 py-2")})]})})]},r)))}),s.jsxs("div",{className:"flex justify-center",children:[s.jsx(Si,{type:"button",className:"mr-2 mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:r,children:s.jsx(Ct,{className:"w-[16px]"})}),s.jsx(Si,{type:"button",className:"mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:a,children:s.jsx(kt,{className:"w-[16px]"})})]})]})}function mI({conversation:e,setOption:t,models:n,readonly:a}){const r=Uk();if(!e)return null;const{agent:o,skipCompletion:i,model:l,temperature:c}=e.agentOptions??{},d=t("model"),u=t("temperature"),m=t("agent"),p=t("skipCompletion");return s.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[s.jsx("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(Fd,{title:r("com_endpoint_agent_model"),value:l??"",setValue:d,availableValues:n,disabled:a,className:s_(h_,"flex w-full resize-none",p_),containerClassName:"flex w-full resize-none"})})}),s.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[s.jsxs(rl,{openDelay:300,children:[s.jsxs(ol,{className:"grid w-full items-center gap-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs(ul,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[r("com_endpoint_temperature")," ",s.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default"),": 0)"]})]}),s.jsx(dl,{id:"temp-int",disabled:a,value:c,onChange:e=>u(Number(e)),max:2,min:0,step:.01,controls:!1,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),s.jsx(jl,{disabled:a,value:[c??0],onValueChange:e=>u(e[0]),onDoubleClick:()=>u(1),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"temp",side:yv.Left})]}),s.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-10",children:[s.jsxs(rl,{openDelay:500,children:[s.jsxs(ol,{className:"flex w-[100px] flex-col items-center space-y-4 text-center",children:[s.jsx("label",{htmlFor:"functions-agent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:s.jsx("small",{children:r("com_endpoint_plug_use_functions")})}),s.jsx(kl,{id:"functions-agent",checked:"functions"===o,onCheckedChange:e=>{m(e?"functions":"classic")},disabled:a,className:"ml-4 mt-2"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"func",side:yv.Bottom})]}),s.jsxs(rl,{openDelay:500,children:[s.jsxs(ol,{className:"ml-[-60px] flex w-[100px] flex-col items-center space-y-4 text-center",children:[s.jsx("label",{htmlFor:"skip-completion",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:s.jsx("small",{children:r("com_endpoint_plug_skip_completion")})}),s.jsx(kl,{id:"skip-completion",checked:!0===i,onCheckedChange:e=>{p(e)},disabled:a,className:"ml-4 mt-2"})]}),s.jsx(sI,{endpoint:e.endpoint??"",type:"skip",side:yv.Bottom})]})]})]})]})}function pI({conversation:e,models:t,isPreset:n=!1}){var a,r;const{optionSettings:o}=Mk(),{setOption:i,setExample:l,addExample:c,removeExample:d}=xT(n?e:null);if(!e)return null;const{examples:u,model:m}=e,p=null==(a=null==m?void 0:m.toLowerCase())?void 0:a.includes("gemini"),f=!p&&(null==(r=null==m?void 0:m.toLowerCase())?void 0:r.includes("chat")),h=!p&&!f&&/code|text/.test(m??""),{showExamples:g}=o;return g&&f&&!h?s.jsx(uI,{examples:u??[{input:{content:""},output:{content:""}}],setExample:l,addExample:c,removeExample:d}):s.jsx(lI,{conversation:e,setOption:i,models:t})}function fI({conversation:e,models:t,isPreset:n=!1}){const{showAgentSettings:a}=Mk(),{setOption:r,setTools:o,setAgentOption:i,checkPluginSelection:l}=xT(n?e:null);return e?a?s.jsx(mI,{conversation:e,setOption:i,models:t}):s.jsx(dI,{conversation:e,setOption:r,setTools:o,checkPluginSelection:l,models:t}):null}const hI={[Nu.assistants]:aI,[Nu.azureAssistants]:aI,[Nu.agents]:iI,[Nu.openAI]:iI,[Nu.custom]:iI,[Nu.azureOpenAI]:iI,[Nu.anthropic]:function({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Au((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return uv[t]??uv[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=oI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})},[Nu.bedrock]:function({conversation:e,setOption:t,models:a,readonly:r}){const o=n.useMemo((()=>{const[t,n]=Au((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return uv[t]??uv[n]}),[e]);if(!o)return null;const i=n=>{if(!n)return null;const o=oI[n.component];if(!o)return null;const{key:i,default:l,...c}=n,d={key:i,settingKey:i,defaultValue:l,...c,readonly:r,setOption:t,conversation:e};return"model"===i?s.jsx(o,{...d,options:a}):s.jsx(o,{...d})};return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[s.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:o.col1.map(i)}),s.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:o.col2.map(i)})]})})}};function gI({conversation:e,setOption:t,isPreset:n=!1,className:a=""}){var r;const o=fk(),{data:i}=Ky(),l=Ae(Cy.currentSettingsView),c=Sb(i,(null==e?void 0:e.endpoint)??"","type")??(null==e?void 0:e.endpoint)??"";if(!c||l!==bp.default)return null;const{settings:d,multiViewSettings:u}={settings:hI,multiViewSettings:{[Nu.google]:pI,[Nu.gptPlugins]:fI}},{endpoint:m}=e,p=(null==(r=o.data)?void 0:r[m??""])??[],f=d[c];if(f)return s.jsx("div",{className:s_("h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:s.jsx(f,{conversation:e,setOption:t,models:p,isPreset:n})});const h=u[c];return null==h?null:s.jsx("div",{className:s_("hide-scrollbar h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:s.jsx(h,{conversation:e,models:p,isPreset:n})})}const xI=({open:e,onOpenChange:t,preset:a})=>{const[r,o]=n.useState(a.title??"My Preset"),i=hk(),{showToast:l}=$d(),c=Uk(),d=()=>{const e=i_({preset:{...a,title:r}}),n=e.title?`\`${e.title}\``:c("com_endpoint_preset_title");i.mutate(e,{onSuccess:()=>{l({message:`${n} ${c("com_ui_saved")}`}),t(!1)},onError:()=>{l({message:c("com_endpoint_preset_save_error"),severity:jv.ERROR})}})};n.useEffect((()=>{o(a.title??c("com_endpoint_my_preset"))}),[e]);return s.jsx(ml,{open:e,onOpenChange:t,children:s.jsx(Ud,{title:c("com_endpoint_save_as_preset"),className:"z-[90] w-11/12 sm:w-1/4",overlayClassName:"z-[80]",showCloseButton:!1,main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"preset-custom-name",className:"text-left text-sm font-medium",children:c("com_endpoint_preset_name")}),s.jsx(cl,{id:"preset-custom-name",value:r||"",onChange:e=>o(e.target.value||""),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d())},placeholder:c("com_endpoint_preset_custom_name_placeholder"),"aria-label":c("com_endpoint_preset_name"),className:s_(h_,"flex h-10 max-h-10 w-full resize-none border-border-medium px-3 py-2",m_)})]})}),selection:{selectHandler:d,selectClasses:"bg-green-500 hover:bg-green-600 dark:hover:bg-green-600 text-white",selectText:c("com_ui_save")}})})},vI={[_m.openai]:Nu.openAI,[_m.azure]:Nu.azureOpenAI},bI={[_m.openai]:"bg-white/75 dark:bg-black/65",[_m.azure]:"azure-bg-color",[_m.azure_blob]:"azure-bg-color",[_m.execute_code]:"bg-black text-white opacity-85",[_m.text]:"bg-blue-500 dark:bg-blue-900 opacity-85 text-white",[_m.vectordb]:"bg-yellow-700 dark:bg-yellow-900 opacity-85 text-white"};function _I({source:e,isCodeFile:t,className:n="absolute right-0 bottom-0 rounded-full p-[0.15rem] text-gray-600 transition-colors"}){if(!0===t)return s.jsx("div",{className:s_(n,bI[_m.execute_code]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(St,{className:"h-3 w-3"})})});if(e===_m.text)return s.jsx("div",{className:s_(n,bI[e]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(Tt,{className:"h-3 w-3"})})});if(e===_m.vectordb)return s.jsx("div",{className:s_(n,bI[e]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(Et,{className:"h-3 w-3"})})});const a=vI[e??""];return a?s.jsx("div",{className:s_(n,bI[e??""]??""),children:s.jsx("span",{className:"flex items-center justify-center",children:s.jsx(ZR,{endpoint:a,size:14,isCreatedByUser:!1,iconClassName:"h-3 w-3"})})}):null}const yI=({file:e,fileType:t,className:n=""})=>{var a;return s.jsxs("div",{className:s_("relative size-10 shrink-0 overflow-hidden rounded-xl",n),children:[s.jsx(td,{file:e,fileType:t}),s.jsx(_I,{source:null==e?void 0:e.source,isCodeFile:!!(null==(a=null==e?void 0:e.metadata)?void 0:a.fileIdentifier)}),"number"==typeof(null==e?void 0:e.progress)&&(null==e?void 0:e.progress)<1&&s.jsx(rc,{bgOpacity:.2,color:"white",className:"absolute inset-0 m-2.5 flex items-center justify-center"})]})};function jI({onRemove:e}){const t=Uk();return s.jsx("button",{type:"button",className:"absolute right-1 top-1 -translate-y-1/2 translate-x-1/2 rounded-full bg-surface-secondary p-0.5 transition-colors duration-200 hover:bg-surface-primary",onClick:e,"aria-label":t("com_ui_attach_remove"),children:s.jsx("span",{"aria-hidden":"true",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})}const wI=({file:e,overrideType:t,buttonClassName:n,containerClassName:a,onDelete:r,onClick:o})=>{const i=Lv(t??e.type);return s.jsxs("div",{className:s_("group relative inline-block text-sm text-text-primary",a),children:[s.jsx("button",{type:"button",onClick:o,"aria-label":e.filename,className:s_("relative overflow-hidden rounded-2xl border border-border-light bg-surface-hover-alt",n),children:s.jsx("div",{className:"w-56 p-1.5",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.jsx(yI,{file:e,fileType:i,className:"relative"}),s.jsxs("div",{className:"overflow-hidden",children:[s.jsx("div",{className:"truncate font-medium",title:e.filename,children:e.filename}),s.jsx("div",{className:"truncate text-text-secondary",title:i.title,children:i.title})]})]})})}),r&&s.jsx(jI,{onRemove:r})]})};function NI({circumference:e,offset:t,circleCSSProperties:n}){return s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${e} ${e}`,strokeDashoffset:t,fill:"transparent",r:"55",cx:"60",cy:"60",style:n})]})})}const CI=({imageBase64:e,url:t,progress:a=1,className:r="",source:o,alt:i="Preview image"})=>{const[l,c]=n.useState(!1),[d,u]=n.useState(!1),[m,p]=n.useState(null),f=n.useCallback((()=>{p(document.activeElement),c(!0)}),[]),h=n.useCallback((e=>{c(!1),e.stopPropagation(),e.preventDefault(),m instanceof HTMLElement&&!m.closest('[data-skip-refocus="true"]')&&m.focus()}),[m]),g=n.useCallback((e=>{"Escape"===e.key&&h(e)}),[h]);n.useEffect((()=>{if(l){document.addEventListener("keydown",g),document.body.style.overflow="hidden";const e=document.querySelector('[aria-label="Close full view"]');e&&setTimeout((()=>e.focus()),0)}return()=>{document.removeEventListener("keydown",g),document.body.style.overflow="unset"}}),[l,g]);const x={backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},v=e??t??"",b=v?{...x,backgroundImage:`url(${v})`}:x;if("string"!=typeof b.backgroundImage||0===b.backgroundImage.length)return null;const _=2*Math.PI*55,y=_-a*_;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:s_("relative size-14 rounded-xl",r),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[s.jsx("button",{type:"button",className:"size-full overflow-hidden rounded-xl",style:b,"aria-label":`View ${i} in full size`,"aria-haspopup":"dialog",onClick:e=>{e.preventDefault(),e.stopPropagation(),f()}}),a<1?s.jsx(NI,{circumference:_,offset:y,circleCSSProperties:{transition:"stroke-dashoffset 0.3s linear"},"aria-label":`Loading progress: ${Math.round(100*a)}%`}):s.jsx("div",{className:s_("absolute inset-0 flex transform-gpu cursor-pointer items-center justify-center rounded-xl transition-opacity duration-200 ease-in-out",d?"bg-black/20 opacity-100":"opacity-0"),onClick:e=>{e.stopPropagation(),f()},"aria-hidden":"true",children:s.jsx(Rt,{className:s_("size-5 transform-gpu text-white drop-shadow-lg transition-all duration-200",d?"scale-110":"")})}),s.jsx(_I,{source:o,"aria-label":o?`Source: ${o}`:void 0})]}),s.jsx(ml,{open:l,onOpenChange:c,children:s.jsx(xl,{showCloseButton:!1,className:"w-11/12 overflow-x-auto bg-transparent p-0 sm:w-auto",disableScroll:!1,children:s.jsx("img",{src:v,alt:i,className:"max-w-screen h-full max-h-screen w-full object-contain"})})})]})},kI=({imageBase64:e,url:t,onDelete:n,progress:a=1,source:r=_m.local})=>s.jsxs("div",{className:"group relative inline-block text-sm text-black/70 dark:text-white/90",children:[s.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-600",children:s.jsx(CI,{source:r,imageBase64:e,url:t,progress:a})}),s.jsx(jI,{onRemove:n})]});function SI({files:e,setFiles:t,abortUpload:a,setFilesLoading:r,assistant_id:o,agent_id:i,tool_resource:l,fileFilter:c,isRTL:d=!1,Wrapper:u}){const m=Uk(),{showToast:p}=$d(),f=Array.from((null==e?void 0:e.values())??[]).filter((e=>!c||c(e))),{mutateAsync:h}=qy({onMutate:async()=>a_.log("agents","Deleting files: agent_id, assistant_id, tool_resource",i,o,l),onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),{deleteFile:g}=CT({mutateAsync:h,agent_id:i,assistant_id:o,tool_resource:l});if(n.useEffect((()=>{0!==f.length?f.some((e=>e.progress<1))?r(!0):f.every((e=>1===e.progress))&&r(!1):r(!1)}),[f]),0===f.length)return null;const x=()=>{const e=d?{display:"flex",flexDirection:"row-reverse",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"}:{display:"flex",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"};return s.jsx("div",{style:e,children:f.reduce(((e,t)=>(e.map.has(t.file_id)||(e.map.set(t.file_id,!0),e.uniqueFiles.push(t)),e)),{map:new Map,uniqueFiles:[]}).uniqueFiles.map(((e,n)=>{var r;const o=()=>{p({message:m("com_ui_deleting_file"),status:"info"}),a&&e.progress<1&&a(),g({file:e,setFiles:t})},i=(null==(r=e.type)?void 0:r.startsWith("image"))??!1;return s.jsx("div",{style:{flexBasis:"70px",flexGrow:0,flexShrink:0},children:i?s.jsx(kI,{url:e.preview??e.filepath,onDelete:o,progress:e.progress,source:e.source}):s.jsx(wI,{file:e,onDelete:o})},n)}))})};return u?s.jsx(u,{children:x()}):x()}function TI({agent_id:e,files:t}){const a=Uk(),{setFilesLoading:r}=Mk(),o=n.useRef(null),[i,l]=n.useState(new Map),[c,d]=n.useState(!1),[u,m]=n.useState(!1),{data:p}=Wy(),f=null==p?void 0:p.sharePointFilePickerEnabled,{data:h=Gm}=Xy({select:e=>Ym(e)}),{handleFileChange:g}=PT({overrideEndpoint:Nu.agents,additionalMetadata:{agent_id:e,tool_resource:eu.context},fileSetter:l}),{handleSharePointFiles:x,isProcessing:v,downloadProgress:b}=MT({overrideEndpoint:Nu.agents,additionalMetadata:{agent_id:e,tool_resource:eu.file_search},fileSetter:l});LT((()=>{t&&l(new Map(t))}),[t],750);const _=h.endpoints[Nu.agents];if(_.disabled??!1)return null;const y=()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},j=[{label:a("com_files_upload_local_machine"),onClick:y,icon:s.jsx(It,{className:"icon-md"})},{label:a("com_files_upload_sharepoint"),onClick:()=>m(!0),icon:s.jsx(nd,{className:"icon-md"})}],w=s.jsx(ie,{className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(uc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_context")]})});return s.jsxs("div",{className:"w-full",children:[s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[s.jsx(ol,{asChild:!0,children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-token-text-primary block font-medium",children:a("com_agents_file_context_label")}),s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})]})}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:a("com_agents_file_context_description")})})})})]})}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(SI,{files:i,setFiles:l,setFilesLoading:r,agent_id:e,tool_resource:eu.context,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsxs("div",{children:[f?s.jsx(s.Fragment,{children:s.jsx(Nd,{gutter:2,menuId:"file-search-upload-menu",isOpen:c,setIsOpen:d,trigger:w,items:j,modal:!0,unmountOnHide:!0})}):s.jsx("button",{type:"button",disabled:pv(e),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:y,children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(uc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_context")]})}),s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:pv(e),onChange:g})]}),e?null:s.jsx("div",{className:"text-xs text-text-secondary",children:a("com_agents_file_context_disabled")})]}),s.jsx(QR,{isOpen:u,onOpenChange:m,onFilesSelected:async e=>{try{await x(e),m(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:v,downloadProgress:b,maxSelectionCount:null==_?void 0:_.fileLimit})]})}function EI({title:e,selectedKey:t,onSelectionChange:a,dropdownOptions:r,showDropdown:o,register:i,dropdownOpen:l,setDropdownOpen:c,dropdownKey:d}){const u=Uk(),[m,p]=n.useState({}),f=r.find((e=>e.key===t)),h=r.map((e=>({label:e.label,onClick:()=>a(e.key)})));return s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsx(ul,{className:"text-md w-fit font-medium",children:e}),o?s.jsx(Nd,{menuId:`${d}-dropdown`,items:h,isOpen:l,setIsOpen:c,trigger:s.jsxs(ie,{onClick:()=>c(!l),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[null==f?void 0:f.label,s.jsx(Pt,{className:"ml-1 h-4 w-4"})]})}):s.jsx("div",{className:"text-sm text-text-secondary",children:null==f?void 0:f.label})]}),(null==f?void 0:f.inputs)&&Object.entries(f.inputs).map((([e,t],n)=>s.jsxs("div",{children:[s.jsxs("div",{className:"relative",children:[s.jsx(cl,{type:"text",placeholder:t.placeholder,autoComplete:"password"===t.type?"one-time-code":"off",readOnly:"password"===t.type,onFocus:"password"===t.type?e=>e.target.readOnly=!1:void 0,className:"mb-2 "+("password"===t.type?"pr-10":""),...i(e)}),"password"===t.type&&s.jsx("button",{type:"button",onClick:()=>{return t=e,void p((e=>({...e,[t]:!e[t]})));var t},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary transition-colors hover:text-text-primary","aria-label":m[e]?u("com_ui_hide_password"):u("com_ui_show_password"),children:s.jsx("div",{className:"relative h-4 w-4",children:m[e]?s.jsx(At,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in"}):s.jsx(Mt,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in"})})})]}),t.link&&s.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:s.jsx("a",{href:t.link.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:t.link.text})})]},e)))]})}function RI({isOpen:e,onSubmit:t,onRevoke:a,onOpenChange:r,authTypes:o,isToolAuthenticated:i,register:l,handleSubmit:c,triggerRef:d,triggerRefs:u}){var m,p,f,h,g,x,v,b;const _=Uk(),{data:y}=Wy(),[j,w]=n.useState((null==(m=null==y?void 0:y.webSearch)?void 0:m.searchProvider)||Sf.SERPER),[N,C]=n.useState((null==(p=null==y?void 0:y.webSearch)?void 0:p.rerankerType)||Ef.JINA),[k,S]=n.useState(Tf.FIRECRAWL),T=[{key:Sf.SERPER,label:_("com_ui_web_search_provider_serper"),inputs:{serperApiKey:{placeholder:_("com_ui_enter_api_key"),type:"password",link:{url:"https://serper.dev/api-keys",text:_("com_ui_web_search_provider_serper_key")}}}},{key:Sf.SEARXNG,label:_("com_ui_web_search_provider_searxng"),inputs:{searxngInstanceUrl:{placeholder:_("com_ui_web_search_searxng_instance_url"),type:"text"},searxngApiKey:{placeholder:_("com_ui_web_search_searxng_api_key"),type:"password"}}}],E=[{key:Ef.JINA,label:_("com_ui_web_search_reranker_jina"),inputs:{jinaApiKey:{placeholder:_("com_ui_web_search_jina_key"),type:"password",link:{url:"https://jina.ai/api-dashboard/",text:_("com_ui_web_search_reranker_jina_key")}},jinaApiUrl:{placeholder:_("com_ui_web_search_jina_url"),type:"text",link:{url:"https://api.jina.ai/v1/rerank",text:_("com_ui_web_search_reranker_jina_url_help")}}}},{key:Ef.COHERE,label:_("com_ui_web_search_reranker_cohere"),inputs:{cohereApiKey:{placeholder:_("com_ui_web_search_cohere_key"),type:"password",link:{url:"https://dashboard.cohere.com/welcome/login",text:_("com_ui_web_search_reranker_cohere_key")}}}}],R=[{key:Tf.FIRECRAWL,label:_("com_ui_web_search_scraper_firecrawl"),inputs:{firecrawlApiUrl:{placeholder:_("com_ui_web_search_firecrawl_url"),type:"text"},firecrawlApiKey:{placeholder:_("com_ui_enter_api_key"),type:"password",link:{url:"https://docs.firecrawl.dev/introduction#api-key",text:_("com_ui_web_search_scraper_firecrawl_key")}}}}],[I,P]=n.useState({provider:!1,reranker:!1,scraper:!1}),A=null==(f=o.find((([e])=>e===kf.PROVIDERS)))?void 0:f[1],M=null==(h=o.find((([e])=>e===kf.SCRAPERS)))?void 0:h[1],L=null==(g=o.find((([e])=>e===kf.RERANKERS)))?void 0:g[1];return s.jsx(ml,{open:e,onOpenChange:r,triggerRef:d,triggerRefs:u,children:s.jsx(Ud,{className:"w-11/12 sm:w-[500px]",title:"",main:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-4 text-center font-medium",children:_("com_ui_web_search")}),s.jsxs("form",{onSubmit:c(t),children:[A!==vu.SYSTEM_DEFINED&&s.jsx(EI,{title:_("com_ui_web_search_provider"),selectedKey:j,onSelectionChange:e=>{w(e)},dropdownOptions:T,showDropdown:!(null==(x=null==y?void 0:y.webSearch)?void 0:x.searchProvider),register:l,dropdownOpen:I.provider,setDropdownOpen:e=>P((t=>({...t,provider:e}))),dropdownKey:"provider"}),M!==vu.SYSTEM_DEFINED&&s.jsx(EI,{title:_("com_ui_web_search_scraper"),selectedKey:k,onSelectionChange:e=>{S(e)},dropdownOptions:R,showDropdown:!(null==(v=null==y?void 0:y.webSearch)?void 0:v.scraperType),register:l,dropdownOpen:I.scraper,setDropdownOpen:e=>P((t=>({...t,scraper:e}))),dropdownKey:"scraper"}),L!==vu.SYSTEM_DEFINED&&s.jsx(EI,{title:_("com_ui_web_search_reranker"),selectedKey:N,onSelectionChange:e=>{C(e)},dropdownOptions:E,showDropdown:!(null==(b=null==y?void 0:y.webSearch)?void 0:b.rerankerType),register:l,dropdownOpen:I.reranker,setDropdownOpen:e=>P((t=>({...t,reranker:e}))),dropdownKey:"reranker"})]})]}),selection:{selectHandler:c(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:_("com_ui_save")},buttons:i&&s.jsx(Si,{onClick:a,className:"bg-red-500 text-white hover:bg-red-600",children:_("com_ui_revoke")}),showCancelButton:!0})})}function II({authTypes:e=[],isToolAuthenticated:t=!1}){const n=Uk(),a=Uo(),{control:r,setValue:o,getValues:i}=a,{onSubmit:l,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=pE({onSubmit:()=>{o(ef.web_search,!0,{shouldDirty:!0})},onRevoke:()=>{o(ef.web_search,!1,{shouldDirty:!0})}}),p=Ho({control:r,name:ef.web_search}),f=null==e?void 0:e.some((([,e])=>e===vu.USER_PROVIDED)),h=e=>{t?o(ef.web_search,e,{shouldDirty:!0}):p?o(ef.web_search,!1,{shouldDirty:!0}):d(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:ef.web_search,control:r,render:({field:e})=>s.jsx(Ti,{...e,checked:p||t&&e.value,onCheckedChange:h,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),s.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!i(ef.web_search);h(e)},children:s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:ef.web_search,children:n("com_ui_web_search")})}),s.jsxs("div",{className:"ml-2 flex gap-2",children:[f&&(t||p)&&s.jsx("button",{type:"button",onClick:()=>d(!0),children:s.jsx(Lt,{className:"h-5 w-5 text-text-primary"})}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_search_info")})})})})]})}),s.jsx(RI,{onSubmit:l,authTypes:e,isOpen:c,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit})]})}function PI(){const e=Uk(),{data:t}=ij({toolId:Jd.web_search},{retry:1});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("div",{className:"flex flex-row items-center gap-1",children:s.jsx("div",{className:"flex items-center gap-1",children:s.jsx("span",{className:"text-token-text-primary block font-medium",children:e("com_ui_web_search")})})})}),s.jsx("div",{className:"flex flex-col items-start gap-2",children:s.jsx(II,{authTypes:null==t?void 0:t.authTypes,isToolAuthenticated:null==t?void 0:t.authenticated})})]})}const AI=n.memo((function(){const e=Uk(),t=Uo(),{control:n,setValue:a,getValues:r}=t;return s.jsx(s.Fragment,{children:s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"my-2 flex items-center",children:[s.jsx(Bo,{name:ef.file_search,control:n,render:({field:e})=>s.jsx(Ti,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>a(ef.file_search,!r(ef.file_search),{shouldDirty:!0}),children:[s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:ef.file_search,children:e("com_agents_enable_file_search")}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_agents_file_search_info")})})})})]})})})}));function MI({agent_id:e,files:t}){const a=Uk(),{setFilesLoading:r}=Mk(),{watch:o}=Uo(),i=n.useRef(null),[l,c]=n.useState(new Map),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{data:f}=Wy(),{data:h=Gm}=Xy({select:e=>Ym(e)}),{handleFileChange:g}=PT({overrideEndpoint:Nu.agents,additionalMetadata:{agent_id:e,tool_resource:eu.file_search},fileSetter:c}),{handleSharePointFiles:x,isProcessing:v,downloadProgress:b}=MT({overrideEndpoint:Nu.agents,additionalMetadata:{agent_id:e,tool_resource:eu.file_search},fileSetter:c});LT((()=>{t&&c(new Map(t))}),[t],750);const _=o(ef.file_search),y=h.endpoints[Nu.agents],j=y.disabled??!1,w=null==f?void 0:f.sharePointFilePickerEnabled,N=pv(e)||!1===_;if(j)return null;const C=[{label:a("com_files_upload_local_machine"),onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},icon:s.jsx(It,{className:"icon-md"})},{label:a("com_files_upload_sharepoint"),onClick:()=>p(!0),icon:s.jsx(nd,{className:"icon-md"})}],k=s.jsx(ie,{disabled:N,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(uc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_search")]})});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:a("com_assistants_file_search")})})}),s.jsx(AI,{}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(SI,{files:l,setFiles:c,setFilesLoading:r,agent_id:e,tool_resource:eu.file_search,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsxs("div",{children:[w?s.jsx(Nd,{gutter:2,menuId:"file-search-upload-menu",isOpen:d,setIsOpen:u,trigger:k,items:C,modal:!0,unmountOnHide:!0}):s.jsx("button",{type:"button",disabled:N,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx(uc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_file_search")]})}),s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:N,onChange:g})]}),e?null:s.jsx("div",{className:"text-xs text-text-secondary",children:a("com_agents_file_search_disabled")})]}),s.jsx(QR,{isOpen:m,onOpenChange:p,onFilesSelected:async e=>{try{await x(e),p(!1)}catch(t){console.error("SharePoint file processing error:",t)}},disabled:N,isDownloading:v,downloadProgress:b,maxSelectionCount:null==y?void 0:y.fileLimit})]})}function LI(){const e=Uk(),t=Uo(),{setValue:n,watch:a}=t,r=a(ef.artifacts),o=void 0!==r&&""!==r,i=r===kh.CUSTOM,l=r===kh.SHADCNUI;return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_ui_artifacts")})})}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(OI,{id:"artifacts",label:e("com_ui_artifacts_toggle_agent"),checked:o,onCheckedChange:e=>{n(ef.artifacts,e?kh.DEFAULT:"",{shouldDirty:!0})},hoverCardText:e("com_nav_info_code_artifacts_agent")}),s.jsx(OI,{id:"includeShadcnui",label:e("com_ui_include_shadcnui"),checked:l,onCheckedChange:e=>{n(ef.artifacts,e?kh.SHADCNUI:kh.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_include_shadcnui"),disabled:!o||i}),s.jsx(OI,{id:"customPromptMode",label:e("com_ui_custom_prompt_mode"),checked:i,onCheckedChange:e=>{n(ef.artifacts,e?kh.CUSTOM:kh.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_custom_prompt_mode"),disabled:!o})]})]})}function OI({id:e,label:t,checked:n,onCheckedChange:a,hoverCardText:r,disabled:o=!1}){return s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:o?"text-text-tertiary":"",children:t}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:r})})})}),s.jsx(kl,{id:e,checked:n,onCheckedChange:a,className:"ml-4","data-testid":e,disabled:o})]})})}function DI({tool:e,regularTools:t}){const a=Uk(),{showToast:r}=$d(),o=yk(),{getValues:i,setValue:l}=Uo(),[c,d]=n.useState(!1),[u,m]=n.useState(!1);if(!t)return null;const p=t.find((t=>t.pluginKey===e));if(!p)return null;return s.jsxs(ml,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onFocus:()=>d(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||d(!1)},children:[s.jsxs("div",{className:"flex grow items-center",children:[p.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${p.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:p.name})]}),s.jsx(pl,{asChild:!0,children:s.jsx("button",{type:"button",className:s_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:opacity-100",u||c?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${p.name}`,tabIndex:0,onFocus:()=>d(!0),children:s.jsx(Sc,{className:"h-4 w-4"})})})]}),s.jsx(Ud,{showCloseButton:!1,title:a("com_ui_delete_tool"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex w-full flex-col items-start gap-2 text-sm text-text-secondary",children:[s.jsxs("p",{children:[a("com_ui_delete_tool_confirm")," ",s.jsxs("strong",{children:['"',p.name,'"']}),"?"]}),p.description&&s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(Gc,{className:"h-4 w-4 flex-shrink-0 text-text-secondary"}),s.jsx("p",{className:"text-sm",children:p.description})]})]})}),selection:{selectHandler:()=>{var t;(t=e)&&o.mutate({pluginKey:t,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{r({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{var e;const n=null==(e=i("tools"))?void 0:e.filter((e=>e!==t));l("tools",n),r({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 hover:bg-red-800 dark:bg-red-600 dark:hover:bg-red-800 text-white",selectText:a("com_ui_delete")}})]})}function FI({isOpen:e,onSubmit:t,onRevoke:n,onOpenChange:a,isUserProvided:r,isToolAuthenticated:o,register:i,handleSubmit:l,triggerRef:c,triggerRefs:d}){const u=Uk();return s.jsx(ml,{open:e,onOpenChange:a,triggerRef:c,triggerRefs:d,children:s.jsx(Ud,{className:"w-11/12 sm:w-[450px]",title:"",main:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-4 text-center font-medium",children:u("com_ui_librechat_code_api_title")}),s.jsx("div",{className:"mb-4 text-center text-sm",children:u("com_ui_librechat_code_api_subtitle")}),s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"mx-auto mb-4 flex max-w-[400px] flex-wrap justify-center gap-3",children:["python.svg","nodedotjs.svg","tsnode.svg","rust.svg","go.svg","c.svg","cplusplus.svg","php.svg","fortran.svg","r.svg"].map((e=>s.jsx("div",{className:"h-6 w-6",children:s.jsx("img",{src:`assets/${e}`,alt:"",className:"h-full w-full object-contain opacity-[0.85] dark:invert"})},e)))}),s.jsx("a",{href:"https://code.librechat.ai/pricing",target:"_blank",rel:"noopener noreferrer",className:"block text-center text-[15px] font-medium text-blue-500 underline decoration-1 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:u("com_ui_librechat_code_api_key")})]}),s.jsx("form",{onSubmit:l(t),children:s.jsx(cl,{type:"password",placeholder:u("com_ui_enter_api_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("apiKey",{required:!0})})})]}),selection:{selectHandler:l(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:u("com_ui_save")},buttons:r&&o&&s.jsx(Si,{onClick:n,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",children:u("com_ui_revoke")}),showCancelButton:!0})})}function zI({authType:e="",isToolAuthenticated:t=!1}){const n=Uk(),a=Uo(),{control:r,setValue:o,getValues:i}=a,{onSubmit:l,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=uE({onSubmit:()=>{o(ef.execute_code,!0,{shouldDirty:!0})},onRevoke:()=>{o(ef.execute_code,!1,{shouldDirty:!0})}}),p=Ho({control:r,name:ef.execute_code}),f=e===vu.USER_PROVIDED,h=e=>{t?o(ef.execute_code,e,{shouldDirty:!0}):p?o(ef.execute_code,!1,{shouldDirty:!0}):d(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:ef.execute_code,control:r,render:({field:e})=>s.jsx(Ti,{...e,checked:p||t&&e.value,onCheckedChange:h,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),s.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!i(ef.execute_code);h(e)},children:s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:ef.execute_code,children:n("com_ui_run_code")})}),s.jsxs("div",{className:"ml-2 flex gap-2",children:[f&&(t||p)&&s.jsx("button",{type:"button",onClick:()=>d(!0),children:s.jsx(Lt,{className:"h-5 w-5 text-text-primary"})}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-4 w-4 text-text-tertiary"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_code_interpreter")})})})})]})}),s.jsx(FI,{isOpen:c,onSubmit:l,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit,isUserProvided:e===vu.USER_PROVIDED})]})}const UI=eu.execute_code;function VI({agent_id:e,files:t}){const a=Uk(),{setFilesLoading:r}=Mk(),{watch:o}=Uo(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=Gm}=Xy({select:e=>Ym(e)}),{abortUpload:u,handleFileChange:m}=PT({fileSetter:c,overrideEndpoint:Nu.agents,additionalMetadata:{agent_id:e,tool_resource:UI}});LT((()=>{t&&c(new Map(t))}),[t],750);const p=o(ef.execute_code),f=d.endpoints[Nu.agents];if((null==f?void 0:f.disabled)??!1)return null;return s.jsx("div",{className:"mb-2 w-full",children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:a("com_assistants_code_interpreter_files")}),s.jsx(SI,{files:l,setFiles:c,agent_id:e,abortUpload:u,tool_resource:UI,setFilesLoading:r,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:pv(e)||!1===p,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:pv(e)||!1===p,onChange:m}),s.jsx(uc,{className:"text-token-text-primary h-4 w-4"}),a("com_ui_upload_code_files")]})})})]})})}function BI({agent_id:e,files:t}){const n=Uk(),{data:a}=ij({toolId:Jd.execute_code});return s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("div",{className:"flex flex-row items-center gap-1",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-token-text-primary block font-medium",children:n("com_agents_code_interpreter_title")}),s.jsx("span",{className:"text-xs text-text-secondary",children:n("com_agents_by_librechat")})]})})}),s.jsxs("div",{className:"flex flex-col items-start gap-2",children:[s.jsx(zI,{authType:null==a?void 0:a.message,isToolAuthenticated:null==a?void 0:a.authenticated}),s.jsx(VI,{agent_id:e,files:t})]})]})}let $I;function HI({serverName:e,serverStatus:t,tool:n,onConfigClick:a,isInitializing:r,canCancel:o,onCancel:i,hasCustomUserVars:l=!1}){if($I=Uk(),r)return s.jsx(GI,{serverName:e,onConfigClick:a,onCancel:i,canCancel:o});if(!t)return null;const{connectionState:c,requiresOAuth:d}=t;if("connecting"===c)return s.jsx(KI,{serverName:e,onConfigClick:a});if("disconnected"===c)return d?s.jsx(WI,{serverName:e,onConfigClick:a}):s.jsx(qI,{serverName:e,onConfigClick:a});if("error"===c)return s.jsx(QI,{serverName:e,onConfigClick:a});if("connected"===c){if(l){const t=(null==n?void 0:n.authenticated)||d;return s.jsx(YI,{serverName:e,onConfigClick:a,isAuthenticated:t})}return null}return null}function GI({serverName:e,onCancel:t,canCancel:n}){return n?s.jsx("button",{type:"button",onClick:t,className:"group flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-red-100 dark:hover:bg-red-900/20","aria-label":$I("com_ui_cancel"),title:$I("com_ui_cancel"),children:s.jsxs("div",{className:"relative h-4 w-4",children:[s.jsx(rc,{className:"h-4 w-4 group-hover:opacity-0"}),s.jsx(vt,{className:"absolute inset-0 h-4 w-4 text-red-500 opacity-0 group-hover:opacity-100"})]})}):s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(rc,{className:"h-4 w-4","aria-label":$I("com_nav_mcp_status_connecting",{0:e})})})}function KI({serverName:e}){return s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(rc,{className:"h-4 w-4","aria-label":$I("com_nav_mcp_status_connecting",{0:e})})})}function WI({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":$I("com_nav_mcp_configure_server",{0:e}),children:s.jsx(Lt,{className:"h-4 w-4 text-amber-500"})})}function qI({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":$I("com_nav_mcp_configure_server",{0:e}),children:s.jsx(Ot,{className:"h-4 w-4 text-orange-500"})})}function QI({serverName:e,onConfigClick:t}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":$I("com_nav_mcp_configure_server",{0:e}),children:s.jsx(Dt,{className:"h-4 w-4 text-red-500"})})}function YI({serverName:e,onConfigClick:t,isAuthenticated:n}){return s.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":$I("com_nav_mcp_configure_server",{0:e}),children:s.jsx(ze,{className:"h-4 w-4 "+(n?"text-green-500":"text-gray-400")})})}function XI({serverName:e,requiresOAuth:t,conversationId:n,sidePanel:a=!1,hasCustomUserVars:r=!1}){const o=Uk(),{initializeServer:i,cancelOAuthFlow:l,isInitializing:c,isCancellable:d,getOAuthUrl:u}=GT({conversationId:n}),{data:m}=Wy(),{connectionStatus:p}=HT({enabled:!!(null==m?void 0:m.mcpServers)&&Object.keys(m.mcpServers).length>0}),f=null==p?void 0:p[e],h="connected"===(null==f?void 0:f.connectionState),g=d(e),x=c(e),v=u(e),b=h&&(t||r);if(!b&&!(!h&&!v)&&!v)return null;if(v)return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Si,{onClick:()=>l(e),disabled:!g,variant:"outline",title:g?void 0:"disabled",children:o("com_ui_cancel")}),s.jsx(Si,{variant:"submit",onClick:()=>window.open(v,"_blank","noopener,noreferrer"),className:"flex-1",children:o("com_ui_continue_oauth")})]})});const _=b?"flex justify-start":"flex justify-end",y=b?void 0:"default";let j="";j=o(x?"com_ui_loading":b?"com_ui_reinitialize":t?"com_ui_authenticate":"com_ui_mcp_initialize");const w=x?s.jsx(rc,{className:"h-4 w-4"}):s.jsx(Ft,{className:"h-4 w-4"});return s.jsx("div",{className:_,children:s.jsxs(Si,{variant:y,onClick:()=>i(e,!1),disabled:x,size:a?"sm":"default",className:"w-full",children:[w,j]})})}function ZI({isOpen:e,onOpenChange:t,fieldsSchema:n,onSave:a,isSubmitting:r=!1,onRevoke:o,serverName:i,serverStatus:l,conversationId:c}){const d=Uk(),u=Object.keys(n).length>0?d("com_ui_configure_mcp_variables_for",{0:i}):`${i} MCP Server`;return s.jsx(ml,{open:e,onOpenChange:t,children:s.jsxs(xl,{className:"flex max-h-screen w-11/12 max-w-lg flex-col space-y-2",children:[s.jsx(vl,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(_l,{className:"text-xl",children:u.charAt(0).toUpperCase()+u.slice(1)}),(()=>{if(!l)return null;const{connectionState:e,requiresOAuth:t}=l;return"connecting"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-blue-50 px-2 py-0.5 text-xs font-medium text-blue-600 dark:bg-blue-950 dark:text-blue-400",children:[s.jsx(rc,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_connecting")})]}):"disconnected"===e?t?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-600 dark:bg-amber-950 dark:text-amber-400",children:[s.jsx(Lt,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_oauth")})]}):s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-orange-50 px-2 py-0.5 text-xs font-medium text-orange-600 dark:bg-orange-950 dark:text-orange-400",children:[s.jsx(Ot,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_offline")})]}):"error"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-600 dark:bg-red-950 dark:text-red-400",children:[s.jsx(Dt,{className:"h-3 w-3"}),s.jsx("span",{children:d("com_ui_error")})]}):"connected"===e?s.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700 dark:bg-green-900 dark:text-green-300",children:[s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),s.jsx("span",{children:d("com_ui_active")})]}):null})()]})}),s.jsx(PR,{serverName:i,fields:n,onSave:a,onRevoke:o||(()=>{}),isSubmitting:r}),s.jsx(XI,{serverName:i,conversationId:c,requiresOAuth:(null==l?void 0:l.requiresOAuth)||!1,hasCustomUserVars:n&&Object.keys(n).length>0})]})})}function JI({serverInfo:e}){const t=Uk(),{removeTool:a}=KT(),[r,o]=n.useState(!1),[i,l]=n.useState(!1),{initializeServer:c,isInitializing:d,getServerStatusIconProps:u,getConfigDialogProps:m}=GT();if(!e)return null;const p=e.serverName,f=d(p),h=u(p),g=m(),x=h&&s.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:s.jsx(HI,{...h})});return s.jsxs(ml,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onFocus:()=>o(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||o(!1)},children:[s.jsxs("div",{className:"flex grow cursor-pointer items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",onClick:e=>{e.target.closest("[data-status-icon]")||f||c(p)},role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),f||c(p))},"aria-disabled":f,children:[x&&s.jsx("div",{className:"flex items-center","data-status-icon":!0,children:x}),e.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),s.jsxs("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[p,f&&s.jsx("span",{className:"ml-2 text-xs text-text-secondary",children:t("com_ui_initializing")})]})]}),s.jsx(pl,{asChild:!0,children:s.jsx("button",{type:"button",className:s_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",i||r?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${p}`,tabIndex:0,onFocus:()=>o(!0),children:s.jsx(Sc,{className:"h-4 w-4"})})})]}),s.jsx(Ud,{showCloseButton:!1,title:t("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:t("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>a(p),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:t("com_ui_delete")}}),g&&s.jsx(ZI,{...g})]})}function eP({serverName:e}){const t=Uk(),{removeTool:a}=KT(),[r,o]=n.useState(!1),[i,l]=n.useState(!1);return e?s.jsxs(ml,{children:[s.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),onFocus:()=>o(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||o(!1)},children:[s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:s.jsx(jt,{className:"h-4 w-4 text-red-500"})})}),s.jsx("div",{className:"flex grow cursor-not-allowed items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",children:s.jsxs("div",{className:"grow select-none px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[e,s.jsxs("span",{className:"ml-2 text-xs text-text-secondary",children:[" - ",t("com_ui_unavailable")]})]})}),s.jsx(pl,{asChild:!0,children:s.jsx("button",{type:"button",className:s_("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",i||r?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${e}`,tabIndex:0,onFocus:()=>o(!0),children:s.jsx(Sc,{className:"h-4 w-4"})})})]}),s.jsx(Ud,{showCloseButton:!1,title:t("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:t("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>a(e||""),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:t("com_ui_delete")}})]}):null}function tP({serverInfo:e}){var t,a;const r=Uk(),{removeTool:o}=KT(),{getValues:i,setValue:l}=Uo(),{getServerStatusIconProps:c,getConfigDialogProps:d}=GT(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),[h,g]=n.useState(""),[x,v]=n.useState(null);if(!e)return null;const b=e.serverName,_=t=>{const n=(i("tools")||[]).filter((t=>{var n;return!(null==(n=null==e?void 0:e.tools)?void 0:n.some((e=>e.tool_id===t)))}));l("tools",[...n,...t])},y=(()=>{if(!(null==e?void 0:e.tools))return[];const t=i("tools")||[];return e.tools.filter((e=>t.includes(e.tool_id))).map((e=>e.tool_id))})(),j=h===b,w=c(b),N=d(),C=w&&s.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:s.jsx(HI,{...w})});return s.jsxs(ml,{children:[s.jsx(mi,{type:"single",value:h,onValueChange:g,collapsible:!0,children:s.jsxs(pi,{value:b,className:"group relative w-full border-none",children:[s.jsx("div",{className:"relative flex w-full items-center gap-1 rounded-lg p-1 hover:bg-surface-primary-alt",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),onFocus:()=>m(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||m(!1)},children:s.jsx(Ds,{asChild:!0,children:s.jsxs("div",{className:"flex grow cursor-pointer select-none items-center gap-1 rounded bg-transparent p-0 text-left transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",onClick:()=>g((e=>e?"":b)),children:[C&&s.jsx("div",{className:"flex items-center",children:C}),e.metadata.icon&&s.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:b}),s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"relative flex items-center",children:s.jsx("div",{className:s_("absolute right-0 transition-all duration-300",p||u?"translate-x-0 opacity-100":"translate-x-8 opacity-0"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{"data-checkbox-container":!0,onClick:e=>e.stopPropagation(),className:"mt-1",children:s.jsx(Ti,{id:`select-all-${b}`,checked:y.length===(null==(t=e.tools)?void 0:t.length)&&y.length>0,onCheckedChange:t=>{if(e.tools){const n=t?e.tools.map((e=>e.tool_id)):[`${dh.mcp_server}${dh.mcp_delimiter}${b}`];_(n)}},className:s_("h-4 w-4 rounded border border-border-medium transition-all duration-200 hover:border-border-heavy",j?"visible":"pointer-events-none invisible"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();e.currentTarget.click()}},tabIndex:j?0:-1})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Fs,{asChild:!0,children:s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation()},className:s_("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200 hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",j&&"bg-surface-active-alt"),"aria-hidden":"true",tabIndex:0,onFocus:()=>m(!0),children:s.jsx(Pt,{className:s_("h-4 w-4 transition-transform duration-200",j&&"rotate-180")})})}),s.jsx(pl,{asChild:!0,children:s.jsx("button",{type:"button",className:s_("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200","hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),onClick:e=>e.stopPropagation(),"aria-label":`Delete ${b}`,tabIndex:0,onFocus:()=>m(!0),children:s.jsx(Sc,{className:"h-4 w-4"})})})]})]})})})})]})})}),s.jsx(fi,{className:"relative ml-1 pt-1 before:absolute before:bottom-2 before:left-0 before:top-0 before:w-0.5 before:bg-border-medium",children:s.jsx("div",{className:"space-y-1",children:null==(a=e.tools)?void 0:a.map((e=>s.jsxs("label",{htmlFor:e.tool_id,className:s_("border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2","ml-2 mr-1 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.stopPropagation()},onMouseEnter:()=>v(e.tool_id),onMouseLeave:()=>v(null),children:[s.jsx(Ti,{id:e.tool_id,checked:y.includes(e.tool_id),onCheckedChange:t=>{const n=y.includes(e.tool_id)?y.filter((t=>t!==e.tool_id)):[...y,e.tool_id];_(n)},onKeyDown:e=>{if(e.stopPropagation(),"Enter"===e.key||" "===e.key){e.preventDefault();e.currentTarget.click()}},onClick:e=>e.stopPropagation(),className:s_("relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer rounded border border-border-medium transition-[border-color] duration-200 hover:border-border-heavy focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background")}),s.jsx("span",{className:"text-token-text-primary select-none",children:e.metadata.name}),e.metadata.description&&s.jsxs(zt,{placement:"left-start",children:[s.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center",children:[s.jsx(Ut,{render:s.jsxs(Vt,{className:s_("flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary transition-opacity duration-200",x===e.tool_id?"opacity-100":"opacity-0"),"aria-label":r("com_ui_tool_info"),children:[s.jsx(Gc,{className:"h-4 w-4"}),s.jsx(Bt,{children:r("com_ui_tool_info")})]})}),s.jsxs($t,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":r("com_ui_tool_more_info"),"aria-expanded":x===e.tool_id,"aria-controls":`tool-description-${e.tool_id}`,children:[s.jsx(Bt,{children:r("com_ui_tool_more_info")}),s.jsx(Pt,{className:"h-4 w-4"})]})]}),s.jsx(Ht,{id:`tool-description-${e.tool_id}`,gutter:14,shift:40,flip:!1,className:"z-[999] w-80 scale-95 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary opacity-0 shadow-md transition-all duration-200 data-[enter]:scale-100 data-[leave]:scale-95 data-[enter]:opacity-100 data-[leave]:opacity-0",portal:!0,unmountOnHide:!0,role:"tooltip","aria-label":e.metadata.description,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e.metadata.description})})})]})]},e.tool_id)))})})]})}),s.jsx(Ud,{showCloseButton:!1,title:r("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:r("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>o(b),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:r("com_ui_delete")}}),N&&s.jsx(ZI,{...N})]})}function nP({agentId:e,mcpServerNames:t,setShowMCPToolDialog:n}){const a=Uk(),{mcpServersMap:r}=eS();return s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"text-token-text-primary mb-2 block font-medium",children:a("com_ui_mcp_servers")}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-1",children:null==t?void 0:t.map((t=>{const n=r.get(t);return(null==n?void 0:n.isConfigured)?n?n.isConnected?s.jsx(tP,{serverInfo:n},`${n.serverName}-${e}`):s.jsx(JI,{serverInfo:n},`${n.serverName}-${e}`):null:s.jsx(eP,{serverName:t},`${t}-${e}`)}))}),s.jsx("div",{className:"mt-2",children:s.jsx("button",{type:"button",onClick:()=>n(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:a("com_assistants_add_mcp_server_tools")})})})]})]})}const sP="mb-2 text-token-text-primary block font-medium",aP=s_(h_,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",m_);function rP({createMutation:e}){const t=Uk(),a=aS(),{showToast:r}=$d(),o=Uo(),[i,l]=n.useState(!1),[c,d]=n.useState(!1),{actions:u,setAction:m,regularTools:p,agentsConfig:f,startupConfig:h,mcpServersMap:g,setActivePanel:x,endpointsConfig:v}=eS(),{control:b,formState:{errors:_}}=o,y=Ho({control:b,name:"provider"}),j=Ho({control:b,name:"model"}),w=Ho({control:b,name:"agent"}),N=Ho({control:b,name:"tools"}),C=Ho({control:b,name:"id"}),{data:k=[]}=Yy(C),S=n.useMemo((()=>{const e={...a};return k.forEach((t=>{t.file_id&&(e[t.file_id]=t)})),e}),[a,k]),{codeEnabled:T,toolsEnabled:E,contextEnabled:R,actionsEnabled:I,artifactsEnabled:P,webSearchEnabled:A,fileSearchEnabled:M}=Hk(null==f?void 0:f.capabilities),L=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.context_files)return w.context_files;return Xv({agent:w,fileMap:S}).context_files??[]}),[w,C,S]),O=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.knowledge_files)return w.knowledge_files;return Xv({agent:w,fileMap:S}).knowledge_files??[]}),[w,C,S]),D=n.useMemo((()=>{if("string"==typeof w)return[];if((null==w?void 0:w.id)!==C)return[];if(w.code_files)return w.code_files;return Xv({agent:w,fileMap:S}).code_files??[]}),[w,C,S]),F=n.useCallback((()=>{pv(C)?r({message:t("com_assistants_actions_disabled"),status:"warning"}):x(bv.actions)}),[C,x,r,t]),z="string"==typeof y?y:null==y?void 0:y.value;let U,V,B,$;void 0!==z&&(V=Sb(v,z,"type"),B=Sb(v,z,"iconURL"),$=Lb({endpoint:z,endpointsConfig:v,endpointType:V,endpointIconURL:B}),U=LE[$]);const{toolIds:H,mcpServerNames:G}=function(e,t,s){return n.useMemo((()=>{const n=new Set,a=[];for(const r of e??[])if(r.includes(dh.mcp_delimiter)){const e=r.split(dh.mcp_delimiter)[1];e&&n.add(e)}else s.has(r)?n.add(r):(null==t?void 0:t.some((e=>e.pluginKey===r)))&&a.push(r);return{toolIds:a.sort(((e,t)=>e.localeCompare(t))),mcpServerNames:Array.from(n).sort(((e,t)=>e.localeCompare(t)))}}),[t,s,e])}(N,p,g);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"h-auto bg-white px-4 pt-3 dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(qR,{agent_id:C,createMutation:e,avatar:(null==w?void 0:w.avatar)??null}),s.jsxs("label",{className:sP,htmlFor:"name",children:[t("com_ui_name"),s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Bo,{name:"name",rules:{required:t("com_ui_agent_name_is_required")},control:b,render:({field:e})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",maxLength:256,className:aP,id:"name",type:"text",placeholder:t("com_agents_name_placeholder"),"aria-label":"Agent name"}),s.jsx("div",{className:s_("mt-1 w-56 text-sm text-red-500",_.name?"visible h-auto":"invisible h-0"),children:_.name?_.name.message:" "})]})}),s.jsx(Bo,{name:"id",control:b,render:({field:e})=>s.jsx("p",{className:"h-3 text-xs italic text-text-secondary","aria-live":"polite",children:e.value})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:sP,htmlFor:"description",children:t("com_ui_description")}),s.jsx(Bo,{name:"description",control:b,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",maxLength:512,className:aP,id:"description",type:"text",placeholder:t("com_agents_description_placeholder"),"aria-label":"Agent description"})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:sP,htmlFor:"category-selector",children:[t("com_ui_category")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(UR,{className:"w-full"})]}),s.jsx(HR,{}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:sP,htmlFor:"provider",children:[t("com_ui_model")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("button",{type:"button",onClick:()=>x(bv.model),className:"btn btn-neutral border-token-border-light relative h-10 w-full rounded-lg font-medium","aria-haspopup":"true","aria-expanded":"false",children:s.jsxs("div",{className:"flex w-full items-center gap-2",children:[U&&s.jsx("div",{className:"shadow-stroke relative flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-white text-black dark:bg-white",children:s.jsx(U,{className:"h-2/3 w-2/3",endpoint:z,endpointType:V,iconURL:B})}),s.jsx("span",{children:null!=j&&j?j:t("com_ui_select_model")})]})})]}),(T||M||P||R||A)&&s.jsxs("div",{className:"mb-4 flex w-full flex-col items-start gap-3",children:[s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_assistants_capabilities")}),T&&s.jsx(BI,{agent_id:C,files:D}),A&&s.jsx(PI,{}),R&&s.jsx(TI,{agent_id:C,files:L}),P&&s.jsx(LI,{}),M&&s.jsx(MI,{agent_id:C,files:O})]}),null!=(null==h?void 0:h.mcpServers)&&s.jsx(nP,{agentId:C,mcpServerNames:G,setShowMCPToolDialog:d}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:sP,children:`${!0===E?t("com_ui_tools"):""}\n              ${!0===E&&!0===I?" + ":""}\n              ${!0===I?t("com_assistants_actions"):""}`}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-1",children:H.map(((e,t)=>(null==p?void 0:p.find((t=>t.pluginKey===e)))?s.jsx(DI,{tool:e,regularTools:p,agent_id:C},`${e}-${t}-${C}`):null))}),s.jsx("div",{className:"flex flex-col gap-1",children:(u??[]).filter((e=>e.agent_id===C)).map(((e,t)=>s.jsx(VR,{action:e,onClick:()=>{m(e),x(bv.actions)}},t)))}),s.jsxs("div",{className:"mt-2 flex space-x-2",children:[(E??!1)&&s.jsx("button",{type:"button",onClick:()=>l(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_assistants_add_tools")})}),(I??!1)&&s.jsx("button",{type:"button",disabled:pv(C),onClick:F,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_assistants_add_actions")})})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_support_contact")})})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-name",children:s.jsx("span",{className:"text-sm",children:t("com_ui_support_contact_name")})}),s.jsx(Bo,{name:"support_contact.name",control:b,rules:{minLength:{value:3,message:t("com_ui_support_contact_name_min_length",{minLength:3})}},render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",className:s_(aP,n?"border-2 border-red-500":""),id:"support-contact-name",type:"text",placeholder:t("com_ui_support_contact_name_placeholder"),"aria-label":"Support contact name"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:n.message})]})})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-email",children:s.jsx("span",{className:"text-sm",children:t("com_ui_support_contact_email")})}),s.jsx(Bo,{name:"support_contact.email",control:b,rules:{validate:e=>Xb(e??"",t("com_ui_support_contact_email_invalid"))},render:({field:e,fieldState:{error:n}})=>s.jsxs(s.Fragment,{children:[s.jsx("input",{...e,value:e.value??"",className:s_(aP,n?"border-2 border-red-500":""),id:"support-contact-email",type:"email",placeholder:t("com_ui_support_contact_email_placeholder"),"aria-label":"Support contact email"}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:n.message})]})})]})]})]})]}),s.jsx(zR,{isOpen:i,setIsOpen:l,endpoint:Nu.agents}),null!=(null==h?void 0:h.mcpServers)&&s.jsx(DR,{agentId:C,isOpen:c,mcpServerNames:G,setIsOpen:d,endpoint:Nu.agents})]})}const oP=new Set(Object.keys(Bu));function iP({agentQuery:e,selectedAgentId:t=null,setCurrentAgentId:a,createMutation:r}){const o=Uk(),i=n.useRef(null),{control:l,reset:c}=Uo(),d=Yk(),{data:u=null}=Py({requiredPermission:d},{select:e=>e.data.map((e=>Xv({agent:{...e,name:e.name||e.id}})))}),m=n.useCallback((e=>{const t=e.isPublic??!1,n={...e,provider:Qv(e.provider),label:e.name??"",value:e.id||"",icon:t?s.jsx(we,{className:"icon-lg text-green-400"}):null},a={[ef.web_search]:!1,[ef.file_search]:!1,[ef.execute_code]:!1,[ef.end_after_tools]:!1,[ef.hide_sequential_outputs]:!1},r=[];(e.tools??[]).forEach((e=>{void 0===a[e]?r.push(e):a[e]=!0}));const o={...a,agent:n,model:n.model,tools:r,category:e.category||"general",support_contact:e.support_contact};Object.entries(e).forEach((([e,t])=>{"model_parameters"!==e&&void 0===a[e]?"agent_ids"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))?o[e]=t:oP.has(e)&&("recursion_limit"!==e||"number"!=typeof t?"number"!=typeof t&&"object"!=typeof t&&(o[e]=t):o[e]=t):o[e]=t})),c(o)}),[c]),p=n.useCallback((t=>{const n=!!(t?(u??[]).find((e=>e.id===t)):void 0);if(r.reset(),!n)return a(void 0),c(Yv());a(t);const s=e.data;s?m(s):console.warn("Agent not found")}),[u,r,a,e.data,m,c]);n.useEffect((()=>{e.data&&e.isSuccess&&m(e.data)}),[e.data,e.isSuccess,m]),n.useEffect((()=>{let e=null;if(t!==i.current)return null!=t&&""!==t&&u&&(e=setTimeout((()=>{i.current=t,p(t)}),5)),()=>{e&&clearTimeout(e)}}),[t,u,p]);const f=o("com_ui_create")+" "+o("com_ui_agent");return s.jsx(Bo,{name:"agent",control:l,render:({field:e})=>{var t,n,a,r;return s.jsx(zd,{containerClassName:"px-0",selectedValue:((null==(t=null==e?void 0:e.value)?void 0:t.value)??"")+"",displayValue:(null==(n=null==e?void 0:e.value)?void 0:n.label)??"",selectPlaceholder:(null==(a=null==e?void 0:e.value)?void 0:a.value)??f,iconSide:"right",searchPlaceholder:o("com_agents_search_name"),SelectIcon:null==(r=null==e?void 0:e.value)?void 0:r.icon,setValue:p,items:(null==u?void 0:u.map((e=>({label:e.name??"",value:e.id??"",icon:e.icon}))))??[{label:"Loading...",value:""}],className:s_("z-50 flex h-[40px] w-full flex-none items-center justify-center truncate rounded-md bg-transparent font-bold"),ariaLabel:o("com_ui_agent"),isCollapsed:!1,showCarat:!0})}})}function lP({principal:e,size:t="md",className:n}){const{avatar:a,type:r,name:o}=e,i=o||"Unknown",l={sm:"h-6 w-6",md:"h-8 w-8",lg:"h-10 w-10"}[t],c={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[t],{Icon:d,containerClass:u,iconClass:m}=(()=>{switch(r){case Wg.USER:return{Icon:Gt,containerClass:"bg-blue-100 dark:bg-blue-900",iconClass:"text-blue-600 dark:text-blue-400"};case Wg.GROUP:return{Icon:$e,containerClass:"bg-green-100 dark:bg-green-900",iconClass:"text-green-600 dark:text-green-400"};case Wg.ROLE:return{Icon:Kt,containerClass:"bg-purple-100 dark:bg-purple-900",iconClass:"text-purple-600 dark:text-purple-400"};default:return{Icon:Gt,containerClass:"bg-surface-tertiary",iconClass:"text-text-secondary"}}})();return a?s.jsxs("div",{className:s_("flex-shrink-0",n),children:[s.jsx("img",{src:a,alt:`${i} avatar`,className:s_(l,"rounded-full object-cover"),onError:e=>{var t;const n=e.target;n.style.display="none",null==(t=n.nextElementSibling)||t.classList.remove("hidden")}}),s.jsx("div",{className:s_("hidden",l),children:s.jsx("div",{className:s_(l,"flex items-center justify-center rounded-full",u),children:s.jsx(d,{className:s_(c,m)})})})]}):s.jsx("div",{className:s_("flex-shrink-0",n),children:s.jsx("div",{className:s_(l,"flex items-center justify-center rounded-full",u),children:s.jsx(d,{className:s_(c,m)})})})}function cP({id:e,resourceType:t=Qg.AGENT,selectedRoleId:n=Xg.AGENT_VIEWER,onRoleChange:a,className:r=""}){const o=Uk(),[i,l]=S.useState(!1),{data:c,isLoading:d}=Sk(t),u=e=>{const t=zb(e);return{name:o(t.name),description:o(t.description)}},m=null==c?void 0:c.find((e=>e.accessRoleId===n)),p=m?u(m.accessRoleId):null;if(d||!c)return s.jsx(Cl,{className:"h-10 w-24 rounded-lg"});const f=c.map((e=>{const t=u(e.accessRoleId);return{id:e.accessRoleId,label:t.name,onClick:()=>{a(e.accessRoleId),l(!1)},render:e=>s.jsx("button",{...e,children:s.jsxs("div",{className:"flex flex-col items-start gap-0.5 text-left",children:[s.jsx("span",{className:"font-medium text-text-primary",children:t.name}),s.jsx("span",{className:"text-xs text-text-secondary",children:t.description})]})})}}));return s.jsx("div",{className:r,id:e,children:s.jsx(Nd,{menuId:"access-roles-menu",isOpen:i,setIsOpen:l,trigger:s.jsxs(ie,{"aria-label":(null==p?void 0:p.description)||"Select role",className:s_("flex items-center justify-between gap-2 rounded-xl border border-border-light bg-transparent px-3 py-2 text-sm transition-colors hover:bg-surface-tertiary"),children:[s.jsx("span",{className:"font-medium",children:(null==p?void 0:p.name)||o("com_ui_select")}),s.jsx(Pt,{className:"h-4 w-4 text-text-secondary"})]}),items:f,className:"w-[280px]"})})}const dP={[Qg.AGENT]:"com_ui_agent",[Qg.PROMPTGROUP]:"com_ui_prompt"};function uP({isPublic:e,publicRole:t,onPublicToggle:n,onPublicRoleChange:a,resourceType:r=Qg.AGENT,className:o}){const i=Uk(),l=S.useCallback((e=>{n(e)}),[n]);return s.jsxs("div",{className:s_("space-y-4",o),children:[s.jsx("div",{className:"group relative rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:s_("transition-colors duration-200",e?"text-blue-600 dark:text-blue-500":"text-text-secondary"),children:s.jsx(Wt,{className:"size-5"})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ul,{htmlFor:"share-everyone-toggle",className:"cursor-pointer text-sm font-medium text-text-primary",children:i("com_ui_share_everyone")}),s.jsx(Ld,{side:Oi.Top,text:i("com_ui_share_everyone_description_var",{resource:i(dP[r])||i("com_ui_resource")})})]})]}),s.jsx(kl,{id:"share-everyone-toggle",checked:e,onCheckedChange:l,"aria-label":i("com_ui_share_everyone")})]})}),s.jsx("div",{className:s_("transition-all duration-300 ease-in-out",e?"max-h-32 opacity-100":"max-h-0 opacity-0"),style:{overflow:e?"visible":"hidden"},children:s.jsx("div",{className:s_("rounded-lg transition-all duration-300",e?"bg-surface-secondary/50 translate-y-0":"-translate-y-2"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:s_("transition-all duration-300",e?"scale-100 text-blue-600 dark:text-blue-500":"scale-95 text-text-secondary"),children:s.jsx(Kt,{className:"size-5"})}),s.jsx("div",{className:"flex flex-col gap-0.5",children:s.jsx(ul,{htmlFor:"permission-level",className:"text-sm font-medium text-text-primary",children:i("com_ui_everyone_permission_level")})})]}),s.jsx("div",{className:s_("relative z-50 transition-all duration-300",e?"scale-100 opacity-100":"scale-95 opacity-0"),children:s.jsx(cP,{id:"permission-level",resourceType:r,selectedRoleId:t,onRoleChange:a})})]})})})]})}const mP=n.forwardRef((function({principal:e,className:t,style:n,onClick:a,...r},o){const i=Uk(),{name:l,email:c,type:d}=e,u=l||i("com_ui_unknown"),m=c||`${d} (${e.source||"local"})`,p=(()=>{switch(d){case Wg.USER:return{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",label:i("com_ui_user")};case Wg.GROUP:return{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",label:i("com_ui_group")};case Wg.ROLE:return{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",label:i("com_ui_role")};default:return{className:"bg-surface-tertiary text-text-secondary",label:d}}})();return s.jsxs("div",{...r,ref:o,className:s_("flex items-center gap-3 p-2",t),style:n,onClick:e=>{null==a||a(e)},children:[s.jsx(lP,{principal:e,size:"md"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"truncate text-sm font-medium text-text-primary",children:u}),s.jsx("div",{className:"truncate text-xs text-text-secondary",children:m})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx("span",{className:s_("inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",p.className),children:p.label})})]})}));function pP({options:e,renderOptions:t,onPick:a,onQueryChange:r,query:o,label:i,isSmallScreen:l=!1,placeholder:c,resetValueOnHide:d=!1,isLoading:u=!1,minQueryLengthForNoResults:m=2}){const p=Uk(),[f,h]=n.useState(!1),g=n.useRef(null),[x,v]=n.useState(o),b=I({resetValueOnHide:d});n.useEffect((()=>{v(o)}),[o]);const _=n.useMemo((()=>ko((e=>{r(e)}),500)),[r]);n.useEffect((()=>()=>{_.cancel()}),[_]);return s.jsxs(G,{store:b,children:[s.jsx(K,{className:"mb-2 block font-medium text-text-primary",children:i}),s.jsx(s.Fragment,{children:s.jsxs("div",{className:s_("group relative flex h-10 cursor-pointer items-center gap-2 rounded-lg border-border-medium text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===l?"mb-2 h-14 rounded-2xl":""),children:[u?s.jsx(rc,{className:"absolute left-3 h-4 w-4"}):s.jsx(wt,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),s.jsx(z,{ref:g,onKeyDown:e=>{"Escape"===e.key&&b.getState().open&&(e.preventDefault(),e.stopPropagation(),v(""),r(""),_.cancel(),h(!1))},store:b,setValueOnClick:!1,setValueOnChange:!1,onChange:e=>{const t=e.target.value;v(t),_(t)},value:x,placeholder:c||p("com_ui_select_options"),className:"h-10 w-full rounded-lg bg-transparent pl-10 text-sm leading-tight text-text-primary placeholder-text-secondary placeholder-opacity-100 focus:outline-none focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary"})]})}),s.jsx(W,{portal:!1,gutter:8,sameWidth:!0,open:u||e.length>0||x.trim().length>=m&&!u,store:b,unmountOnHide:!0,autoFocusOnShow:!1,modal:!1,className:s_("animate-popover z-[9999] min-w-64 overflow-hidden rounded-2xl border border-border-light bg-surface-secondary shadow-lg","[pointer-events:auto]"),children:u?s.jsx("div",{className:"space-y-2 p-2",children:Array.from({length:3}).map(((e,t)=>s.jsxs("div",{className:"flex items-center gap-3 px-3 py-2",children:[s.jsx(Cl,{className:"h-8 w-8 rounded-full"}),s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsx(Cl,{className:"h-4 w-3/4"}),s.jsx(Cl,{className:"h-3 w-1/2"})]})]},t)))}):e.length>0?e.map((e=>s.jsx(B,{focusOnHover:!0,value:e.value,selectValueOnClick:!1,onClick:()=>{return t=e,v(""),r(""),a(t),h(!1),void(g.current&&g.current.focus());var t},className:s_("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:t(e)},e.key))):x.trim().length>=m?s.jsx("div",{className:s_("flex items-center justify-center px-4 py-8 text-center","text-sm text-text-secondary"),children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(wt,{className:"h-8 w-8 text-text-tertiary opacity-50"}),s.jsx("div",{className:"font-medium",children:p("com_ui_no_results_found")}),s.jsx("div",{className:"text-xs text-text-tertiary",children:p("com_ui_try_adjusting_search")})]})}):null})]})}function fP({onAddPeople:e,placeholder:t,className:a="",typeFilter:r=null,excludeIds:o=[]}){const i=Uk(),[l,c]=n.useState(""),d=n.useMemo((()=>({q:l,limit:30,...r&&r.length>0&&{types:r}})),[l,r]),{data:u,isLoading:m,error:p}=kk(d,{enabled:l.length>=2}),f=l.length>=2&&m,h=n.useMemo((()=>((null==u?void 0:u.results)||[]).filter((e=>e.idOnTheSource&&!o.includes(e.idOnTheSource)))),[null==u?void 0:u.results,o]);p&&console.error("Principal search error:",p);return s.jsx("div",{className:`${a}`,children:s.jsx(pP,{options:h.map((e=>({...e,id:e.id??void 0,key:e.idOnTheSource||"unknownpicker_key",value:e.idOnTheSource||"Unknown"}))),renderOptions:e=>s.jsx(mP,{principal:e}),placeholder:t||i("com_ui_search_default_placeholder"),query:l,onQueryChange:e=>{c(e)},onPick:t=>{e([t])},isLoading:f,label:""})})}const hP=({control:e,peoplePickerPerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Bo,{name:t,control:e,render:({field:e})=>s.jsx(kl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),gP=()=>{const e=Uk(),{showToast:t}=$d(),{user:a,roles:r}=qk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Vg.partial().parse(e.updates),fx.updatePeoplePickerPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([ex.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update people picker permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Pg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[Zh.PEOPLE_PICKER]:Jg[d].permissions[Zh.PEOPLE_PICKER]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=Vo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[Zh.PEOPLE_PICKER];p(n||Jg[d].permissions[Zh.PEOPLE_PICKER])}),[r,d,p]),(null==a?void 0:a.role)!==Pg.ADMIN)return null;const b=[{peoplePickerPerm:Jh.VIEW_USERS,label:e("com_ui_people_picker_allow_view_users")},{peoplePickerPerm:Jh.VIEW_GROUPS,label:e("com_ui_people_picker_allow_view_groups")},{peoplePickerPerm:Jh.VIEW_ROLES,label:e("com_ui_people_picker_allow_view_roles")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Pg.USER,onClick:()=>{u(Pg.USER)}},{label:Pg.ADMIN,onClick:()=>{u(Pg.ADMIN)}}];return s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{variant:"outline",className:"btn btn-neutral border-token-border-light relative gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(xl,{className:"w-full border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(_l,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_people_picker")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(Nd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({peoplePickerPerm:e,label:t})=>s.jsx("div",{children:s.jsx(hP,{control:f,peoplePickerPerm:e,label:t,getValues:g,setValue:h})},e)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})};function xP({principles:e,onRemoveHandler:t,className:n="",onRoleChange:a,resourceType:r=Qg.AGENT}){const o=Uk(),i=Wi("(max-width: 768px)");return 0===e.length?s.jsx("div",{className:`space-y-3 ${n}`,children:s.jsxs("div",{className:"rounded-lg border border-dashed border-border-medium py-8 text-center text-muted-foreground",children:[s.jsx($e,{className:"mx-auto mb-2 h-8 w-8 opacity-50"}),s.jsx("p",{className:"mt-1 text-xs",children:o("com_ui_search_above_to_add_all")})]})}):s.jsx("div",{className:`space-y-3 ${n}`,children:s.jsx("div",{className:"space-y-2",children:e.map((e=>{const{displayName:n,subtitle:l}={displayName:(c=e).name||o("com_ui_unknown"),subtitle:i?`${c.type} (${c.source||"local"})`:c.email||`${c.type} (${c.source||"local"})`};var c;return s.jsxs("div",{className:"bg-surface flex items-center justify-between rounded-2xl border border-border p-3",children:[s.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[s.jsx(lP,{principal:e,size:"md"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"truncate text-sm font-medium",children:n}),s.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[s.jsx("span",{children:l}),"entra"===e.source&&s.jsxs(s.Fragment,{children:[s.jsx(qt,{className:"h-3 w-3"}),s.jsx("span",{children:o("com_ui_azure_ad")})]})]})]})]}),s.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[!!e.accessRoleId&&!!a&&s.jsx(cP,{resourceType:r,selectedRoleId:e.accessRoleId,onRoleChange:t=>{null==a||a(e.idOnTheSource,t)},className:"min-w-0"}),s.jsx(Si,{variant:"outline",onClick:()=>t(e.idOnTheSource),className:"h-9 w-9 p-0 hover:border-destructive/10 hover:bg-destructive/10 hover:text-destructive","aria-label":o("com_ui_remove_user",{0:n}),children:s.jsx(vt,{className:"h-4 w-4"})})]})]},e.idOnTheSource+"-principalList")}))})})}function vP({resourceName:e,resourceDbId:t,resourceId:a,resourceType:r,onGrantAccess:o,disabled:i=!1,children:l}){const c=Uk(),{showToast:d}=$d(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),{hasPeoplePickerAccess:h,peoplePickerTypeFilter:g}=vE(),{config:x,permissionsData:v,isLoadingPermissions:b,permissionsError:_,updatePermissionsMutation:y,currentShares:j,currentIsPublic:w,currentPublicRole:N,isPublic:C,setIsPublic:k,publicRole:S,setPublicRole:T}=bE(r,t,u),[E,R]=n.useState([]),[I,P]=n.useState(!1),[A,M]=n.useState(null==x?void 0:x.defaultViewerRoleId);n.useEffect((()=>{if(v&&u){const e=v.principals||[];R(e.map((e=>({...e,isExisting:!0})))),P(!1)}}),[v,u]);const L=(null==x?void 0:x.getResourceUrl)?null==x?void 0:x.getResourceUrl(a||""):"",O=sE({text:L});if(!t)return null;if(!x)return console.error(`Unsupported resource type: ${r}`),null;const D=e=>{R(E.filter((t=>t.idOnTheSource!==e))),P(!0)},F=j.length+(w?1:0),z=E.some((e=>e.accessRoleId===(null==x?void 0:x.defaultOwnerRoleId)))||C&&S===(null==x?void 0:x.defaultOwnerRoleId),U=I||(C!==w||S!==N);if(_)return s.jsx("div",{className:"text-sm text-red-600",children:c("com_ui_permissions_failed_load")});const V=l||s.jsx(Si,{size:"sm",variant:"outline","aria-label":c("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)}),type:"button",disabled:i,children:s.jsxs("div",{className:"flex min-w-[32px] items-center justify-center gap-2 text-blue-500",children:[s.jsx("span",{className:"flex h-6 w-6 items-center justify-center",children:s.jsx(Qt,{className:"icon-md h-4 w-4"})}),F>0&&s.jsx(ul,{className:"text-sm font-medium text-text-secondary",children:F})]})});return s.jsxs(ml,{open:u,onOpenChange:m,modal:!0,children:[s.jsx(pl,{asChild:!0,children:V}),s.jsxs(xl,{className:"max-h-[90vh] w-11/12 overflow-y-auto md:max-w-3xl",children:[s.jsx(_l,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($e,{className:"h-5 w-5"}),c("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)})]})}),s.jsxs("div",{className:"space-y-6 p-2",children:[s.jsx("div",{className:"space-y-4",children:h&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-text-primary",children:[s.jsx(Yt,{className:"h-4 w-4"}),c("com_ui_user_group_permissions")," ( ",E.length," )"]}),s.jsx(fP,{onAddPeople:e=>{const t=e.filter((e=>!E.some((t=>t.idOnTheSource===e.idOnTheSource)))).map((e=>({...e,accessRoleId:A||(null==x?void 0:x.defaultViewerRoleId),isExisting:!1})));R((e=>[...e,...t])),P(!0)},placeholder:c("com_ui_search_people_placeholder"),typeFilter:g,excludeIds:E.map((e=>e.idOnTheSource))}),b?s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(Cl,{className:"h-[62px] w-full rounded-lg"}),s.jsx(Cl,{className:"h-[62px] w-full rounded-lg"})]}):0!==E.length||I?s.jsxs("div",{className:"space-y-2",children:[!z&&I&&s.jsx("div",{className:"rounded-lg border border-destructive/30 bg-destructive/10 p-3 text-center",children:s.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-red-600 dark:text-red-400",children:[s.jsx(Xt,{className:"h-4 w-4"}),c("com_ui_at_least_one_owner_required")]})}),s.jsx(xP,{principles:E,onRemoveHandler:D,resourceType:r,onRoleChange:(e,t)=>((e,t)=>{R(E.map((n=>n.idOnTheSource===e?{...n,accessRoleId:t}:n))),P(!0)})(e,t)})]}):s.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border-light p-8 text-center",children:[s.jsx($e,{className:"mx-auto h-8 w-8 text-text-primary"}),s.jsx("p",{className:"mt-2 text-sm text-text-primary",children:c("com_ui_no_individual_access")}),s.jsx("p",{className:"mt-1 text-xs text-text-primary",children:c("com_ui_search_above_to_add_people")})]})]})}),s.jsx("div",{className:"flex border-t border-border-light"}),s.jsx(uP,{isPublic:C,publicRole:S,onPublicToggle:e=>{k(e),P(!0),e||T(null==x?void 0:x.defaultViewerRoleId)},onPublicRoleChange:e=>{T(e),P(!0)},resourceType:r}),s.jsxs("div",{className:"flex justify-between pt-4",children:[s.jsx("div",{className:"flex gap-2",children:a&&L&&s.jsx(Si,{variant:"outline",onClick:()=>{p||(O(f),d({message:c("com_ui_agent_url_copied"),status:"success"}))},disabled:p,className:s_("shrink-0",p?"cursor-default":""),"aria-label":c("com_ui_copy_url_to_clipboard"),title:p?null==x?void 0:x.getCopyUrlMessage():c("com_ui_copy_url_to_clipboard"),children:p?s.jsx(ft,{className:"h-4 w-4"}):s.jsx(Zt,{className:"h-4 w-4"})})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(gP,{}),s.jsx(hl,{asChild:!0,children:s.jsx(Si,{variant:"outline",onClick:()=>{const e=(null==v?void 0:v.principals)||[];R(e.map((e=>({...e,isExisting:!0})))),M(null==x?void 0:x.defaultViewerRoleId),k(w),T(N||(null==x?void 0:x.defaultViewerRoleId)||""),P(!1),m(!1)},children:c("com_ui_cancel")})}),s.jsx(Si,{onClick:async()=>{if(E.length||C||I)try{const e=new Map(j.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),n=new Map(E.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),s=E.filter((t=>{const n=`${t.type}-${t.idOnTheSource}`,s=e.get(n);return!s||s.accessRoleId!==t.accessRoleId})),a=j.filter((e=>{const t=`${e.type}-${e.idOnTheSource}`;return!n.has(t)}));await y.mutateAsync({resourceType:r,resourceId:t,data:{updated:s,removed:a,public:C,publicAccessRoleId:C?S:void 0}}),o&&o(E,C,S),d({message:c("com_ui_permissions_updated_success"),status:"success"}),P(!1)}catch(e){console.error("Error updating permissions:",e),d({message:c("com_ui_permissions_failed_update"),status:"error"})}},disabled:y.isLoading||!U||I&&!z,className:"min-w-[120px]",children:y.isLoading?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(rc,{className:"h-4 w-4"}),c("com_ui_saving")]}):c("com_ui_save_changes")})]})]})]})]})]})}const bP=({setActivePanel:e})=>{const t=Uk();return s.jsxs(Si,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(bv.advanced),children:[s.jsx(Jt,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_advanced")]})},_P=({setActivePanel:e})=>{const t=Uk();return s.jsxs(Si,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(bv.version),children:[s.jsx(en,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_agent_version")]})};function yP({agent_id:e}){const t=Uk(),{showToast:n}=$d(),a=Uy({onSuccess:()=>{n({message:t("com_ui_agent_duplicated"),status:"success"})},onError:e=>{console.error(e),n({message:t("com_ui_agent_duplicate_error"),status:"error"})}});if(pv(e))return null;return s.jsx(Si,{size:"sm",variant:"outline","aria-label":t("com_ui_duplicate")+" "+t("com_ui_agent"),type:"button",onClick:()=>{a.mutate({agent_id:e})},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-primary",children:s.jsx(ht,{className:"size-4"})})})}const jP=({control:e,agentPerm:t,label:n,getValues:a,setValue:r})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[s.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>r(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),s.jsx(Bo,{name:t,control:e,render:({field:e})=>s.jsx(kl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),wP=()=>{const e=Uk(),{showToast:t}=$d(),{user:a,roles:r}=qk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Ag.partial().parse(e.updates),fx.updateAgentPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([ex.roles,n.roleName]),null!=s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),null!=a&&a(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Pg.USER),m=n.useMemo((()=>{var e;const t=null==(e=null==r?void 0:r[d])?void 0:e.permissions;return t?t[Zh.AGENTS]:Jg[d].permissions[Zh.AGENTS]}),[r,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=Vo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t;const n=null==(t=null==(e=null==r?void 0:r[d])?void 0:e.permissions)?void 0:t[Zh.AGENTS];p(n||Jg[d].permissions[Zh.AGENTS])}),[r,d,p]),(null==a?void 0:a.role)!==Pg.ADMIN)return null;const b=[{agentPerm:Jh.SHARED_GLOBAL,label:e("com_ui_agents_allow_share")},{agentPerm:Jh.CREATE,label:e("com_ui_agents_allow_create")},{agentPerm:Jh.USE,label:e("com_ui_agents_allow_use")}],_=e=>{o({roleName:d,updates:e})},y=[{label:Pg.USER,onClick:()=>{u(Pg.USER)}},{label:Pg.ADMIN,onClick:()=>{u(Pg.ADMIN)}}];return s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(xl,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(_l,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_agents")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(Nd,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x(_),children:[s.jsx("div",{className:"py-5",children:b.map((({agentPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(jP,{control:f,agentPerm:t,label:n,getValues:g,setValue:h}),d===Pg.ADMIN&&t===Jh.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"button",onClick:x(_),disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})};function NP({agent_id:e,setCurrentAgentId:t,createMutation:n}){const a=Uk(),{reset:r}=Uo(),{showToast:o}=$d(),{conversation:i}=Mk(),{setOption:l}=xT(),c=zy({onSuccess:(e,s,c)=>{var d;const u=c;if(!u)return;o({message:a("com_ui_agent_deleted"),status:"success"}),(null==(d=n.data)?void 0:d.id)&&(a_.log("agents","resetting createMutation"),n.reset());const m=u[0];if(!m)return t(void 0),r(Yv()),l("agent_id")("");if(s.agent_id===(null==i?void 0:i.agent_id))return l("model")(""),l("agent_id")(m.id);const p=u.find((e=>e.id===(null==i?void 0:i.agent_id)));p&&t(p.id),t(m.id)},onError:e=>{console.error(e),o({message:a("com_ui_agent_delete_error"),status:"error"})}});return pv(e)?null:s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{size:"sm",variant:"outline","aria-label":a("com_ui_delete")+" "+a("com_ui_agent"),type:"button",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:s.jsx(Sc,{})})})}),s.jsx(Ud,{title:a("com_ui_delete")+" "+a("com_ui_agent"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(ul,{htmlFor:"delete-agent",className:"text-left text-sm font-medium",children:a("com_ui_delete_agent_confirm")})})})}),selection:{selectHandler:()=>c.mutate({agent_id:e}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:a("com_ui_delete")}})]})}function CP({activePanel:e,createMutation:t,updateMutation:n,setActivePanel:a,setCurrentAgentId:r}){const o=Uk(),{user:i}=qk(),l=Uo(),{control:c}=l,d=Ho({control:c,name:"agent"}),u=Ho({control:c,name:"id"}),m=Qk({permissionType:Zh.AGENTS,permission:Jh.SHARED_GLOBAL}),{hasPermission:p,isLoading:f}=zE(Qg.AGENT,(null==d?void 0:d._id)||""),h=p(Yg.SHARE),g=p(Yg.DELETE),x=e===bv.builder;return s.jsxs("div",{className:"mb-1 flex w-full flex-col gap-2",children:[x&&s.jsx(bP,{setActivePanel:a}),x&&u&&s.jsx(_P,{setActivePanel:a}),(null==i?void 0:i.role)===Pg.ADMIN&&x&&s.jsx(wP,{}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[((null==d?void 0:d.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===Pg.ADMIN||g)&&!f&&s.jsx(NP,{agent_id:u,setCurrentAgentId:r,createMutation:t}),((null==d?void 0:d.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===Pg.ADMIN||h)&&m&&!f&&s.jsx(vP,{resourceDbId:null==d?void 0:d._id,resourceId:u,resourceName:(null==d?void 0:d.name)??"",resourceType:Qg.AGENT}),d&&d.author===(null==i?void 0:i.id)&&s.jsx(yP,{agent_id:u}),s.jsx("button",{className:"btn btn-primary focus:shadow-outline flex h-9 w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",disabled:t.isLoading||n.isLoading,"aria-busy":t.isLoading||n.isLoading,children:t.isLoading||n.isLoading?s.jsx(rc,{className:"icon-md","aria-hidden":"true"}):o(u?"com_ui_save":"com_ui_create")})]})]})}function kP({providers:e,setActivePanel:t,models:a}){const r=Uk(),{control:o,setValue:i}=Uo(),l=Ho({control:o,name:"model"}),c=Ho({control:o,name:"provider"}),d=Ho({control:o,name:"model_parameters"}),u=n.useMemo((()=>("string"==typeof c?c:null==c?void 0:c.value)??""),[c]),m=n.useMemo((()=>u?a[u]??[]:[]),[a,u]);n.useEffect((()=>{const e=l??"";if(u&&e){if(!m.includes(e)){const e=a[u]??[];i("model",e[0]??"")}localStorage.setItem(uh.LAST_AGENT_MODEL,e),localStorage.setItem(uh.LAST_AGENT_PROVIDER,u)}u&&!e&&i("model",m[0]??"")}),[u,m,a,i,l]);const{data:p={}}=Ky(),f=n.useMemo((()=>{var e;return(null==(e=null==p?void 0:p[u])?void 0:e.availableRegions)??[]}),[p,u]),h=n.useMemo((()=>Sb(p,u,"type")),[u,p]),g=n.useMemo((()=>{var e,t,n;const s=(null==(e=p[u])?void 0:e.customParams)??{},[a,r]=Au(h??u,l??""),o=s.defaultParamsEndpoint??r,i=mv[a]??mv[o]??[],c=(null==(n=null==(t=p[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],d=Ro(c,"key");return i.filter((e=>null!=e)).map((e=>d[e.key]??e))}),[h,p,l,u]),x=e=>t=>{i(`model_parameters.${e}`,t)};return s.jsxs("div",{className:"mx-1 mb-1 flex h-full min-h-[50vh] w-full flex-col gap-2 text-sm",children:[s.jsxs("div",{className:"model-panel relative flex flex-col items-center px-16 py-4 text-center",children:[s.jsx("div",{className:"absolute left-0 top-4",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{t(bv.builder)},children:s.jsx("div",{className:"model-panel-content flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),s.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:r("com_ui_model_parameters")})]}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{id:"provider-label",className:"text-token-text-primary model-panel-label mb-2 block font-medium",htmlFor:"provider",children:[r("com_ui_provider")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Bo,{name:"provider",control:o,rules:{required:!0,minLength:1},render:({field:t,fieldState:{error:n}})=>{var a,o;const i="string"==typeof t.value?t.value:(null==(a=t.value)?void 0:a.value)??"",l="string"==typeof t.value?t.value:(null==(o=t.value)?void 0:o.label)??"";return s.jsxs(s.Fragment,{children:[s.jsx(zd,{selectedValue:i,displayValue:qf[l]??l,selectPlaceholder:r("com_ui_select_provider"),searchPlaceholder:r("com_ui_select_search_provider"),setValue:t.onChange,items:e.map((e=>({label:"string"==typeof e?e:e.label,value:"string"==typeof e?e:e.value}))),className:s_(n?"border-2 border-red-500":""),ariaLabel:r("com_ui_provider"),isCollapsed:!1,showCarat:!0}),n&&s.jsx("span",{className:"model-panel-error text-sm text-red-500 transition duration-300 ease-in-out",children:r("com_ui_field_required")})]})}})]}),s.jsxs("div",{className:"model-panel-section mb-4",children:[s.jsxs("label",{id:"model-label",className:s_("text-token-text-primary model-panel-label mb-2 block font-medium",!u&&"text-gray-500 dark:text-gray-400"),htmlFor:"model",children:[r("com_ui_model")," ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(Bo,{name:"model",control:o,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:t}})=>s.jsxs(s.Fragment,{children:[s.jsx(zd,{selectedValue:e.value||"",selectPlaceholder:r(u?"com_ui_select_model":"com_ui_select_provider_first"),searchPlaceholder:r("com_ui_select_model"),setValue:e.onChange,items:m.map((e=>({label:e,value:e}))),disabled:!u,className:s_("disabled:opacity-50",t?"border-2 border-red-500":""),ariaLabel:r("com_ui_model"),isCollapsed:!1,showCarat:!0}),u&&t&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:r("com_ui_field_required")})]})})]})]}),g&&s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-2",children:s.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.map((e=>{const t=oI[e.component];if(!t)return null;const{key:n,default:a,...r}=e;return"region"===n&&f.length&&(r.options=f),s.jsx(t,{settingKey:n,defaultValue:a,...r,setOption:x,conversation:d},n)}))})}),s.jsxs("button",{type:"button",onClick:()=>{i("model_parameters",{})},className:"btn btn-neutral my-1 flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[s.jsx(tn,{className:"h-4 w-4","aria-hidden":"true"}),r("com_ui_reset_var",{0:r("com_ui_model_parameters")})]})]})}function SP(){var e,t;const a=Uk(),{user:r}=qk(),{showToast:o}=$d(),{activePanel:i,agentsConfig:l,setActivePanel:c,endpointsConfig:d,setCurrentAgentId:u,agent_id:m}=eS(),{onSelect:p}=function(){const e=pr(),t=Pk(),{conversation:s,newConversation:a}=Mk(),r=zk(),[o,i]=n.useState((null==s?void 0:s.agent_id)??null),l=Ay(o),c=n.useCallback(((e,n)=>{if(a_.log("conversation","Updating conversation with agent",e),Mu(null==s?void 0:s.endpoint))return void a({template:{...n},preset:n});const r=t({conversation:{...s??{},agent_id:e.id},preset:n});a({template:r,preset:n,keepLatestMessage:!0})}),[s,t,a]);return{onSelect:n.useCallback((async t=>{const n=null==r?void 0:r[t];if(!n)return;i(n.id);const s={endpoint:Nu.agents,agent_id:n.id,conversationId:dh.NEW_CONVO};c({id:n.id},s);try{await e.invalidateQueries({queryKey:[ex.agent,n.id],exact:!0,refetchType:"active"},{throwOnError:!0});const{data:t}=await l.refetch();t&&c(t,{...s,agent_id:t.id})}catch(a){if(null==a?void 0:a.silent)return void console.warn("Current fetch was cancelled");console.error("Error fetching full agent data:",a),c({},{...s,agent_id:void 0})}}),[r,c,e,l])}}(),f=fk(),h=Ay(m),{hasPermission:g,isLoading:x}=zE(Qg.AGENT,(null==(e=h.data)?void 0:e._id)||""),v=g(Yg.EDIT),b=My(m??"",{enabled:!pv(m)&&v&&!x}),_=v&&b.data?b:h,y=n.useMemo((()=>f.data??{}),[f.data]),j=Vo({defaultValues:Yv(),mode:"onChange"}),{control:w,handleSubmit:N,reset:C}=j,k=Ho({control:w,name:"id"}),S=n.useRef(),T=n.useMemo((()=>new Set(null==l?void 0:l.allowedProviders)),[null==l?void 0:l.allowedProviders]),E=n.useMemo((()=>Object.keys(d??{}).filter((e=>!Mu(e)&&(!(T.size>0)||T.has(e))&&e!==Nu.agents&&e!==Nu.chatGPTBrowser&&e!==Nu.gptPlugins)).map((e=>Qv(e)))),[d,T]),R=Fy({onMutate:()=>{var e;S.current=null==(e=_.data)?void 0:e.version},onSuccess:e=>{void 0!==S.current&&e.version===S.current?o({message:a("com_ui_no_changes"),status:"info"}):o({message:`${a("com_assistants_update_success")} ${e.name??a("com_ui_agent")}`}),S.current=void 0},onError:e=>{const t=e;o({message:`${a("com_agents_update_error")}${t.message?` ${a("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),I=Dy({onSuccess:e=>{u(e.id),o({message:`${a("com_assistants_create_success")} ${e.name??a("com_ui_agent")}`})},onError:e=>{const t=e;o({message:`${a("com_agents_create_error")}${t.message?` ${a("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),P=n.useCallback((e=>{const t=e.tools??[];!0===e.execute_code&&t.push(Jd.execute_code),!0===e.file_search&&t.push(Jd.file_search),!0===e.web_search&&t.push(Jd.web_search);const{name:n,artifacts:s,description:r,instructions:i,model:l,model_parameters:c,provider:d,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}=e,x=l??"",v=("string"==typeof d?d:d.value)??"";if(!k)return v&&x?n?void I.mutate({name:n,artifacts:s,description:r,instructions:i,model:x,tools:t,provider:v,model_parameters:c,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}):o({message:a("com_agents_missing_name"),status:"error"}):o({message:a("com_agents_missing_provider_model"),status:"error"});R.mutate({agent_id:k,data:{name:n,artifacts:s,description:r,instructions:i,model:x,tools:t,provider:v,model_parameters:c,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:f,category:h,support_contact:g}})}),[k,I,R,o,a]),A=n.useCallback((()=>{k&&p(k)}),[k,p]),M=n.useMemo((()=>{var e;return!(null==(e=_.data)?void 0:e.id)||((null==r?void 0:r.role)===Pg.ADMIN||v)}),[null==(t=_.data)?void 0:t.id,null==r?void 0:r.role,v]);return s.jsx($o,{...j,children:s.jsxs("form",{onSubmit:N(P),className:"scrollbar-gutter-stable h-auto w-full flex-shrink-0 overflow-x-hidden","aria-label":"Agent configuration form",children:[s.jsxs("div",{className:"mx-1 mt-2 flex w-full flex-wrap gap-2",children:[s.jsx("div",{className:"w-full",children:s.jsx(iP,{createMutation:I,agentQuery:_,setCurrentAgentId:u,selectedAgentId:_.isInitialLoading?null:m??null})}),k&&s.jsxs("div",{className:"flex w-full gap-2",children:[s.jsxs(Si,{type:"button",variant:"outline",className:"w-full justify-center",onClick:()=>{C(Yv()),u(void 0)},disabled:_.isInitialLoading,children:[s.jsx(kt,{className:"mr-1 h-4 w-4"}),a("com_ui_create")+" "+a("com_ui_new")+" "+a("com_ui_agent")]}),s.jsx(Si,{variant:"submit",disabled:pv(k)||_.isInitialLoading,onClick:e=>{e.preventDefault(),A()},"aria-label":a("com_ui_select")+" "+a("com_ui_agent"),children:a("com_ui_select")})]})]}),_.isInitialLoading&&s.jsx(xR,{}),!M&&!_.isInitialLoading&&s.jsx("div",{className:"flex h-[30vh] w-full items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-token-text-primary m-2 text-xl font-semibold",children:a("com_agents_not_available")}),s.jsx("p",{className:"text-token-text-secondary",children:a("com_agents_no_access")})]})}),M&&!_.isInitialLoading&&i===bv.model&&s.jsx(kP,{models:y,providers:E,setActivePanel:c}),M&&!_.isInitialLoading&&i===bv.builder&&s.jsx(rP,{createMutation:I}),M&&!_.isInitialLoading&&i===bv.advanced&&s.jsx(RR,{}),M&&!_.isInitialLoading&&s.jsx(CP,{createMutation:I,updateMutation:R,activePanel:i,setActivePanel:c,setCurrentAgentId:u})]})})}const TP={type:Zm.None,saved_auth_fields:!1,api_key:"",authorization_type:Jm.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:ep.DefaultPost,name:"",description:"",url:"",tools:[],icon:"",trust:!1};function EP(){const e=Vo({defaultValues:{type:Zm.None,saved_auth_fields:!1,api_key:"",authorization_type:Jm.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:ep.DefaultPost}}),{watch:t,setValue:a}=e,r=t("type");return n.useEffect((()=>{"none"===r&&(a("api_key",""),a("authorization_type",Jm.Basic),a("custom_auth_header",""),a("oauth_client_id",""),a("oauth_client_secret",""),a("authorization_url",""),a("client_url",""),a("scope",""),a("token_exchange_method",ep.DefaultPost))}),[r,a]),s.jsx($o,{...e,children:s.jsx(iR,{})})}function RP({icon:e,onIconChange:t}){const[a,r]=n.useState(""),o=n.useRef(null),i=Uk();n.useEffect((()=>{r(e||"")}),[e]);return s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{onClick:()=>{o.current&&(o.current.value="",o.current.click())},className:"bg-token-surface-secondary dark:bg-token-surface-tertiary border-token-border-medium flex h-16 w-16 shrink-0 cursor-pointer items-center justify-center rounded-[1.5rem] border-2 border-dashed",children:a?s.jsx("img",{src:a,className:"h-full w-full rounded-[1.5rem] object-cover",alt:"MCP Icon",width:"64",height:"64"}):s.jsx(Jc,{})}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("span",{className:"token-text-secondary text-sm",children:[i("com_ui_icon")," ",i("com_ui_optional")]}),s.jsx("span",{className:"token-text-tertiary text-xs",children:i("com_agents_mcp_icon_size")})]}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:t,ref:o})]})}function IP({mcp:e,agent_id:t,setMCP:a}){const r=Uk(),{showToast:o}=$d(),{handleSubmit:i,register:l,formState:{errors:c},control:d}=Uo(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),[h,g]=n.useState([]);n.useEffect((()=>{(null==e?void 0:e.mcp_id)&&e.metadata.tools&&(f(!0),g(e.metadata.tools))}),[e]);const x=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,metadata:s,agent_id:a})=>{try{e(["success",{mcp_id:n,metadata:s,agent_id:a}])}catch(r){t(r)}},isLoading:!1}}({onSuccess(e){o({message:r("com_ui_update_mcp_success"),status:"success"}),a(e[1]),f(!0),g(e[1].metadata.tools??[]),m(!1)},onError(e){o({message:e.message||r("com_ui_update_mcp_error"),status:"error"}),m(!1)}}),v=i((async n=>{m(!0);try{const s=await x.mutate({agent_id:t??"",mcp_id:null==e?void 0:e.mcp_id,metadata:{...n,tools:h}});a(s[1]),o({message:r("com_ui_update_mcp_success"),status:"success"})}catch{o({message:r("com_ui_update_mcp_error"),status:"error"})}finally{m(!1)}}));return s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"mb-4",children:s.jsx(RP,{icon:null==e?void 0:e.metadata.icon,onIconChange:n=>{var s;const r=null==(s=n.target.files)?void 0:s[0];if(r){const n=new FileReader;n.onloadend=()=>{const s=n.result;a({mcp_id:(null==e?void 0:e.mcp_id)??"",agent_id:t??"",metadata:{...null==e?void 0:e.metadata,icon:s}})},n.readAsDataURL(r)}}})}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ul,{htmlFor:"name",children:r("com_ui_name")}),s.jsx("input",{id:"name",...l("name",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:r("com_agents_mcp_name_placeholder")}),c.name&&s.jsx("span",{className:"text-xs text-red-500",children:r("com_ui_field_required")})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs(ul,{htmlFor:"description",children:[r("com_ui_description"),s.jsx("span",{className:"ml-1 text-xs text-text-secondary-alt",children:r("com_ui_optional")})]}),s.jsx("input",{id:"description",...l("description"),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:r("com_agents_mcp_description_placeholder")})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ul,{htmlFor:"url",children:r("com_ui_mcp_url")}),s.jsx("input",{id:"url",...l("url",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:"https://mcp.example.com"}),c.url&&s.jsx("span",{className:"text-xs text-red-500",children:"required"===c.url.type?r("com_ui_field_required"):c.url.message})]}),s.jsx(EP,{}),s.jsxs("div",{className:"my-2 flex items-center gap-2",children:[s.jsx(Bo,{name:"trust",control:d,rules:{required:!0},render:({field:e})=>s.jsx(Ti,{id:"trust",checked:e.value,onCheckedChange:e.onChange})}),s.jsxs(ul,{htmlFor:"trust",className:"flex flex-col",children:[r("com_ui_trust_app"),s.jsx("span",{className:"text-xs text-text-secondary",children:r("com_agents_mcp_trust_subtext")})]})]}),c.trust&&s.jsx("span",{className:"text-xs text-red-500",children:r("com_ui_field_required")})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{onClick:v,disabled:u,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:u?s.jsx(rc,{className:"icon-md"}):(null==e?void 0:e.mcp_id)?r("com_ui_update"):r("com_ui_create")})}),p&&(null==e?void 0:e.metadata.tools)&&s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-token-text-primary block font-medium",children:r("com_ui_available_tools")}),s.jsx("button",{onClick:()=>{var t;h.length===(null==(t=null==e?void 0:e.metadata.tools)?void 0:t.length)?g([]):(null==e?void 0:e.metadata.tools)&&g(e.metadata.tools)},type:"button",className:"btn btn-neutral border-token-border-light relative h-8 rounded-full px-4 font-medium",children:h.length===e.metadata.tools.length?r("com_ui_deselect_all"):r("com_ui_select_all")})]}),s.jsx("div",{className:"flex flex-col gap-2",children:e.metadata.tools.map((e=>s.jsxs("label",{htmlFor:e,className:"border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2",children:[s.jsx(Ti,{id:e,checked:h.includes(e),onCheckedChange:()=>(e=>{g((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))})(e),className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer"}),s.jsx("span",{className:"text-token-text-primary",children:e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")})]},e)))})]})]})}function PP(){const e=Uk(),{showToast:t}=$d(),{mcp:a,setMcp:r,agent_id:o,setActivePanel:i}=eS(),l=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,agent_id:s})=>{try{console.log("Mock delete MCP:",{mcp_id:n,agent_id:s}),e()}catch(a){t(a)}}}}({onSuccess:()=>{t({message:e("com_ui_delete_mcp_success"),status:"success"}),i(bv.builder),r(void 0)},onError(n){t({message:n.message??e("com_ui_delete_mcp_error"),status:"error"})}}),c=Vo({defaultValues:TP,mode:"onChange"}),{reset:d}=c;return n.useEffect((()=>{if(a){const e={icon:a.metadata.icon??"",name:a.metadata.name??"",description:a.metadata.description??"",url:a.metadata.url??"",tools:a.metadata.tools??[],trust:a.metadata.trust??!1};a.metadata.auth&&Object.assign(e,{type:a.metadata.auth.type||Zm.None,saved_auth_fields:!1,api_key:a.metadata.api_key??"",authorization_type:a.metadata.auth.authorization_type||Jm.Basic,oauth_client_id:a.metadata.oauth_client_id??"",oauth_client_secret:a.metadata.oauth_client_secret??"",authorization_url:a.metadata.auth.authorization_url??"",client_url:a.metadata.auth.client_url??"",scope:a.metadata.auth.scope??"",token_exchange_method:a.metadata.auth.token_exchange_method??ep.DefaultPost}),d(e)}}),[a,d]),s.jsx($o,{...c,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{i(bv.builder),r(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!a&&s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:pv(o)||!a.mcp_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(Sc,{className:"text-red-500"})})})}),s.jsx(Ud,{showCloseButton:!1,title:e("com_ui_delete_mcp"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:e("com_ui_delete_mcp_confirm")}),selection:{selectHandler:()=>{if(pv(o))return t({message:e("com_agents_no_agent_id_error"),status:"error"});l.mutate({mcp_id:a.mcp_id,agent_id:o||""})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:e(a?"com_ui_edit_mcp_server":"com_ui_add_mcp_server")}),s.jsx("div",{className:"text-xs text-text-secondary",children:e("com_agents_mcp_info")})]}),s.jsx(IP,{mcp:a,agent_id:o,setMCP:r})]})})})}function AP(){return s.jsx(tS,{children:s.jsx(MP,{})})}function MP(){const{conversation:e}=Mk(),{activePanel:t,setCurrentAgentId:a}=eS();return n.useEffect((()=>{const t=(null==e?void 0:e.agent_id)??"";pv(t)||a(t)}),[a,null==e?void 0:e.agent_id]),t===bv.actions?s.jsx(gR,{}):t===bv.version?s.jsx(oR,{}):t===bv.mcp?s.jsx(PP,{}):s.jsx(SP,{})}const LP=({bookmark:e,tabIndex:t=0,onFocus:a,onBlur:r})=>{const o=Uk(),{showToast:i}=$d(),[l,c]=n.useState(!1),d=kj({onSuccess:()=>{i({message:o("com_ui_bookmarks_delete_success")})},onError:()=>{i({message:o("com_ui_bookmarks_delete_error"),severity:jv.ERROR})}}),u=n.useCallback((async()=>{await d.mutateAsync(e)}),[e,d]);return s.jsx(s.Fragment,{children:s.jsxs(ml,{open:l,onOpenChange:c,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Dl,{description:o("com_ui_delete"),render:s.jsx(Si,{variant:"ghost","aria-label":o("com_ui_bookmarks_delete"),tabIndex:t,onFocus:a,onBlur:r,onClick:()=>c(!l),className:"h-8 w-8 p-0",children:s.jsx(Sc,{})})})}),s.jsx(Ud,{showCloseButton:!1,title:o("com_ui_bookmarks_delete"),className:"w-11/12 max-w-lg",main:s.jsxs(ul,{className:"text-left text-sm font-medium",children:[o("com_ui_bookmark_delete_confirm")," ",e]}),selection:{selectHandler:u,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]})})},OP=({tags:e,bookmark:t,mutation:a,conversationId:r,setOpen:o,formRef:i})=>{const l=Uk(),c=pr(),{showToast:d}=$d(),{bookmarks:u}=pS(),{register:m,handleSubmit:p,setValue:f,getValues:h,control:g,formState:{errors:x}}=Vo({mode:"onBlur",reValidateMode:"onChange",defaultValues:{tag:(null==t?void 0:t.tag)??"",description:(null==t?void 0:t.description)??"",conversationId:r??"",addToConversation:!(null==r||!r)}});n.useEffect((()=>{t&&t.tag&&(f("tag",t.tag),f("description",t.description??""))}),[t,f]);return s.jsx("form",{ref:i,className:"mt-6","aria-label":"Bookmark form",method:"POST",onSubmit:p((n=>{if(a_.log("tag_mutation","BookmarkForm - onSubmit: data",n),a.isLoading)return;if(n.tag===(null==t?void 0:t.tag)&&n.description===(null==t?void 0:t.description))return;if(null!=n.tag&&(e??[]).includes(n.tag))return void d({message:l("com_ui_bookmarks_create_exists"),status:"warning"});(c.getQueryData([ex.conversationTags])??[]).some((e=>e.tag===n.tag))?d({message:l("com_ui_bookmarks_create_exists"),status:"warning"}):(a.mutate(n),o(!1))})),children:s.jsxs("div",{className:"flex w-full flex-col items-center gap-2",children:[s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"bookmark-tag",className:"text-left text-sm font-medium",children:l("com_ui_bookmarks_title")}),s.jsx(cl,{type:"text",id:"bookmark-tag","aria-label":l(t?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),...m("tag",{required:l("com_ui_field_required"),maxLength:{value:128,message:l("com_ui_field_max_length",{field:l("com_ui_bookmarks_title"),length:128})},validate:e=>e===(null==t?void 0:t.tag)||u.every((t=>t.tag!==e))||l("com_ui_bookmarks_tag_exists")}),"aria-invalid":!!x.tag,placeholder:l(t?"com_ui_bookmarks_edit":"com_ui_bookmarks_new")}),x.tag&&s.jsx("span",{className:"text-sm text-red-500",children:x.tag.message})]}),s.jsxs("div",{className:"mt-4 grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"bookmark-description",className:"text-left text-sm font-medium",children:l("com_ui_bookmarks_description")}),s.jsx(Ll,{...m("description",{maxLength:{value:1048,message:l("com_ui_field_max_length",{field:l("com_ui_bookmarks_description"),length:1048})}}),id:"bookmark-description",disabled:!1,className:s_("flex h-10 max-h-[250px] min-h-[100px] w-full resize-none rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background focus-visible:outline-none")})]}),null!=r&&r&&s.jsxs("div",{className:"mt-2 flex w-full items-center",children:[s.jsx(Bo,{name:"addToConversation",control:g,render:({field:e})=>{var t;return s.jsx(Ti,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:null==(t=e.value)?void 0:t.toString()})}}),s.jsx("button",{type:"button","aria-label":l("com_ui_bookmarks_add_to_conversation"),className:"form-check-label w-full cursor-pointer text-text-primary",onClick:()=>f("addToConversation",!h("addToConversation"),{shouldDirty:!0}),children:s.jsx("div",{className:"flex select-none items-center",children:l("com_ui_bookmarks_add_to_conversation")})})]})]})})},DP=({open:e,setOpen:t,tags:a,setTags:r,context:o,bookmark:i,children:l,triggerRef:c,conversationId:d})=>{const u=Uk(),m=n.useRef(null),{showToast:p}=$d(),f=Cj({context:o,tag:null==i?void 0:i.tag,options:{onSuccess:(e,n)=>{if(p({message:u(i?"com_ui_bookmarks_update_success":"com_ui_bookmarks_create_success")}),t(!1),a_.log("tag_mutation","tags before setting",a),r&&!0===n.addToConversation){const e=[...a||[],n.tag].filter((e=>void 0!==e));if(r(e),a_.log("tag_mutation","tags after",e),null==n.tag||""===n.tag)return;setTimeout((()=>{const e=document.getElementById(n.tag??"");console.log("tagElement",e),e&&e.focus()}),5)}},onError:()=>{p({message:u(i?"com_ui_bookmarks_update_error":"com_ui_bookmarks_create_error"),severity:jv.ERROR})}}});return s.jsxs(ml,{open:e,onOpenChange:t,triggerRef:c,children:[l,s.jsx(Ud,{title:u(i?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),showCloseButton:!1,className:"w-11/12 md:max-w-2xl",main:s.jsx(OP,{tags:a,setOpen:t,mutation:f,conversationId:d,bookmark:i,formRef:m}),buttons:s.jsx(Si,{variant:"submit",type:"submit",disabled:f.isLoading,onClick:()=>{m.current&&m.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},className:"text-white",children:f.isLoading?s.jsx(rc,{}):u("com_ui_save")})})]})},FP=({bookmark:e,tabIndex:t=0,onFocus:a,onBlur:r})=>{const o=Uk(),[i,l]=n.useState(!1);return s.jsx(DP,{context:"EditBookmarkButton",bookmark:e,open:i,setOpen:l,children:s.jsx(pl,{asChild:!0,children:s.jsx(Dl,{description:o("com_ui_edit"),render:s.jsx(Si,{variant:"ghost","aria-label":o("com_ui_bookmarks_edit"),tabIndex:t,onFocus:a,onBlur:r,onClick:()=>l(!i),className:"h-8 w-8 p-0",children:s.jsx(tc,{})})})})})},zP=({row:e,moveRow:t,position:a})=>{const r=n.useRef(null),o=Cj({context:"BookmarkTableRow",tag:e.tag}),i=Uk(),{showToast:l}=$d(),[,c]=er({accept:"bookmark",drop:t=>{o.mutate({...e,position:t.index},{onSuccess:()=>{l({message:i("com_ui_bookmarks_update_success"),severity:jv.SUCCESS})},onError:()=>{l({message:i("com_ui_bookmarks_update_error"),severity:jv.ERROR})}})},hover(e){r.current&&e.index!==a&&(t(e.index,a),e.index=a)}}),[{isDragging:d},u]=nr({type:"bookmark",item:{index:a},collect:e=>({isDragging:e.isDragging()})});return u(c(r)),s.jsxs(Rl,{ref:r,className:"cursor-move hover:bg-surface-secondary",style:{opacity:d?.5:1},children:[s.jsx(Pl,{className:"w-[70%] px-4 py-4",children:s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.tag})}),s.jsx(Pl,{className:"w-[10%] px-12 py-4",children:e.count}),s.jsx(Pl,{className:"w-[20%] px-4 py-4",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(FP,{bookmark:e,tabIndex:0}),s.jsx(LP,{bookmark:e.tag,tabIndex:0})]})})]})},UP=()=>{const e=Uk(),[t,a]=n.useState([]),[r,o]=n.useState(0),[i,l]=n.useState(""),[c,d]=n.useState(!1),{bookmarks:u=[]}=pS();n.useEffect((()=>{const e=(e=>{const t=new Set;return e.filter((e=>{const n=t.has(e._id);return t.add(e._id),!n}))})(u).sort(((e,t)=>e.position-t.position));a(e)}),[u]);const m=n.useCallback(((e,t)=>{a((n=>{const s=[...n],[a]=s.splice(e,1);return s.splice(t,0,a),s.map(((e,t)=>({...e,position:t})))}))}),[]),p=n.useCallback((e=>s.jsx(zP,{moveRow:m,row:e,position:e.position},e._id)),[m]),f=t.filter((e=>e.tag&&e.tag.toLowerCase().includes(i.toLowerCase()))),h=f.slice(10*r,10*(r+1));return s.jsx(mS.Provider,{value:{bookmarks:u},children:s.jsxs("div",{role:"region","aria-label":e("com_ui_bookmarks"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(cl,{placeholder:e("com_ui_bookmarks_filter"),value:i,onChange:e=>l(e.target.value),"aria-label":e("com_ui_bookmarks_filter")})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsxs(Sl,{className:"w-full table-fixed",children:[s.jsx(Tl,{children:s.jsxs(Rl,{className:"border-b border-border-light",children:[s.jsx(Il,{className:"w-[70%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_ui_bookmarks_title")})}),s.jsx(Il,{className:"w-[30%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_ui_bookmarks_count")})}),s.jsx(Il,{className:"w-[40%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:e("com_assistants_actions")})})]})}),s.jsx(El,{children:h.length?h.map(p):s.jsx(Rl,{children:s.jsx(Pl,{colSpan:3,className:"h-24 text-center text-sm text-text-secondary",children:e("com_ui_no_bookmarks")})})})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex justify-between gap-2",children:s.jsx(DP,{context:"BookmarkPanel",open:c,setOpen:d,children:s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{variant:"outline",size:"sm",className:"w-full gap-2 text-sm",onClick:()=>d(!c),children:[s.jsx(nn,{className:"size-4"}),s.jsx("div",{className:"break-all",children:e("com_ui_bookmarks_new")})]})})})}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>o((e=>Math.max(e-1,0))),disabled:0===r,"aria-label":e("com_ui_prev"),children:e("com_ui_prev")}),s.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${r+1} / ${Math.ceil(f.length/10)}`}),s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>o((e=>10*(e+1)<f.length?e+1:e)),disabled:10*(r+1)>=f.length,"aria-label":e("com_ui_next"),children:e("com_ui_next")})]})]})]})})},VP=()=>{const{data:e}=hj();return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:s.jsx(mS.Provider,{value:{bookmarks:e||[]},children:s.jsx(UP,{})})})};function BP({open:e,onOpenChange:t,children:a,triggerRef:r}){const o=Uk(),{showToast:i}=$d(),l=Qk({permissionType:Zh.MEMORIES,permission:Jh.CREATE}),{mutate:c,isLoading:d}=sj({onSuccess:()=>{i({message:o("com_ui_memory_created"),status:"success"}),t(!1),m(""),f(""),setTimeout((()=>{var e;null==(e=null==r?void 0:r.current)||e.focus()}),0)},onError:e=>{var t,n,s;let a=o("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const r=e;(null==(n=null==(t=r.response)?void 0:t.data)?void 0:n.error)&&(a=r.response.data.error,409===(null==(s=r.response)?void 0:s.status)||a.includes("already exists")?a=o("com_ui_memory_key_exists"):a.includes("lowercase letters and underscores")&&(a=o("com_ui_memory_key_validation")))}else e.message&&(a=e.message);i({message:a,status:"error"})}}),[u,m]=n.useState(""),[p,f]=n.useState(""),h=()=>{l&&(u.trim()&&p.trim()?c({key:u.trim(),value:p.trim()}):i({message:o("com_ui_field_required"),status:"error"}))},g=e=>{"Enter"===e.key&&e.ctrlKey&&l&&h()};return s.jsxs(ml,{open:e,onOpenChange:t,triggerRef:r,children:[a,s.jsx(Ud,{title:o("com_ui_create_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(ul,{htmlFor:"memory-key",className:"text-sm font-medium",children:o("com_ui_key")}),s.jsx(cl,{id:"memory-key",value:u,onChange:e=>m(e.target.value),onKeyDown:g,placeholder:o("com_ui_enter_key"),className:"w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ul,{htmlFor:"memory-value",className:"text-sm font-medium",children:o("com_ui_value")}),s.jsx("textarea",{id:"memory-value",value:p,onChange:e=>f(e.target.value),onKeyDown:g,placeholder:o("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]})]}),buttons:s.jsx(Si,{type:"button",variant:"submit",onClick:h,disabled:d||!u.trim()||!p.trim(),className:"text-white",children:d?s.jsx(rc,{className:"size-4"}):o("com_ui_create")})})]})}function $P({memory:e,open:t,onOpenChange:a,children:r,triggerRef:o}){const i=Uk(),{showToast:l}=$d(),{data:c}=tj(),d=Qk({permissionType:Zh.MEMORIES,permission:Jh.UPDATE}),{mutate:u,isLoading:m}=(e=>{const t=pr();return fr((({key:e,value:t,originalKey:n})=>fx.updateMemory(e,t,n)),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([ex.memories]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})})({onMutate:()=>{a(!1),setTimeout((()=>{var e;null==(e=null==o?void 0:o.current)||e.focus()}),0)},onSuccess:()=>{l({message:i("com_ui_saved"),status:"success"})},onError:e=>{var t,n,s;let a=i("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const r=e;(null==(n=null==(t=r.response)?void 0:t.data)?void 0:n.error)&&(a=r.response.data.error,409===(null==(s=r.response)?void 0:s.status)||a.includes("already exists")?a=i("com_ui_memory_key_exists"):a.includes("lowercase letters and underscores")&&(a=i("com_ui_memory_key_validation")))}else e.message&&(a=e.message);l({message:a,status:"error"})}}),[p,f]=n.useState(""),[h,g]=n.useState(""),[x,v]=n.useState("");n.useEffect((()=>{e&&(f(e.key),g(e.value),v(e.key))}),[e]);const b=()=>{d&&e&&(p.trim()&&h.trim()?u({key:p.trim(),value:h.trim(),...x!==p.trim()&&{originalKey:x}}):l({message:i("com_ui_field_required"),status:"error"}))},_=e=>{"Enter"===e.key&&e.ctrlKey&&d&&b()};return s.jsxs(ml,{open:t,onOpenChange:a,triggerRef:o,children:[r,s.jsx(Ud,{title:i(d?"com_ui_edit_memory":"com_ui_view_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:s.jsxs("div",{className:"space-y-4",children:[e&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[s.jsxs("div",{children:[i("com_ui_date"),":"," ",new Date(e.updated_at).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),void 0!==e.tokenCount&&s.jsxs("div",{children:[e.tokenCount.toLocaleString(),(null==c?void 0:c.tokenLimit)&&` / ${c.tokenLimit.toLocaleString()}`," ",i(1===e.tokenCount?"com_ui_token":"com_ui_tokens")]})]}),(null==c?void 0:c.tokenLimit)&&null!==(null==c?void 0:c.usagePercentage)&&s.jsxs("div",{className:"text-xs text-text-secondary",children:[i("com_ui_usage"),": ",c.usagePercentage,"%"," "]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ul,{htmlFor:"memory-key",className:"text-sm font-medium",children:i("com_ui_key")}),s.jsx(cl,{id:"memory-key",value:p,onChange:e=>d&&f(e.target.value),onKeyDown:_,placeholder:i("com_ui_enter_key"),className:"w-full",disabled:!d})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(ul,{htmlFor:"memory-value",className:"text-sm font-medium",children:i("com_ui_value")}),s.jsx("textarea",{id:"memory-value",value:h,onChange:e=>d&&g(e.target.value),onKeyDown:_,placeholder:i("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3,disabled:!d})]})]}),buttons:d?s.jsx(Si,{type:"button",variant:"submit",onClick:b,disabled:m||!p.trim()||!h.trim(),className:"text-white",children:m?s.jsx(rc,{className:"size-4"}):i("com_ui_save")}):null})]})}const HP=({control:e,memoryPerm:t,label:n})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,s.jsx(Bo,{name:t,control:e,render:({field:e})=>s.jsx(kl,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),GP=()=>{const e=Uk(),{user:t,roles:a}=qk(),{showToast:r}=$d(),{mutate:o,isLoading:i}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Lg.partial().parse(e.updates),fx.updateMemoryPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([ex.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update memory permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{r({status:"success",message:e("com_ui_saved")})},onError:()=>{r({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[l,c]=n.useState(!1),[d,u]=n.useState(Pg.USER),m=n.useMemo((()=>{var e,t,n;return(null==(e=null==a?void 0:a[d])?void 0:e.permissions)?null==(n=null==(t=null==a?void 0:a[d])?void 0:t.permissions)?void 0:n[Zh.MEMORIES]:Jg[d].permissions[Zh.MEMORIES]}),[a,d]),{reset:p,control:f,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:v}}=Vo({mode:"onChange",defaultValues:m});if(n.useEffect((()=>{var e,t,n,s;(null==(t=null==(e=null==a?void 0:a[d])?void 0:e.permissions)?void 0:t[Zh.MEMORIES])?p(null==(s=null==(n=null==a?void 0:a[d])?void 0:n.permissions)?void 0:s[Zh.MEMORIES]):p(Jg[d].permissions[Zh.MEMORIES])}),[a,d,p]),(null==t?void 0:t.role)!==Pg.ADMIN)return null;const b=[{memoryPerm:Jh.USE,label:e("com_ui_memories_allow_use")},{memoryPerm:Jh.CREATE,label:e("com_ui_memories_allow_create")},{memoryPerm:Jh.UPDATE,label:e("com_ui_memories_allow_update")},{memoryPerm:Jh.READ,label:e("com_ui_memories_allow_read")},{memoryPerm:Jh.OPT_OUT,label:e("com_ui_memories_allow_opt_out")}],_=[{label:Pg.USER,onClick:()=>{u(Pg.USER)}},{label:Pg.ADMIN,onClick:()=>{u(Pg.ADMIN)}}];return s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),s.jsxs(xl,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(_l,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_memories")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(Nd,{unmountOnHide:!0,menuId:"memory-role-dropdown",isOpen:l,setIsOpen:c,trigger:s.jsx(ie,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:_,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:x((e=>{o({roleName:d,updates:e})})),children:[s.jsx("div",{className:"py-5",children:b.map((({memoryPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(HP,{control:f,memoryPerm:t,label:n,getValues:g,setValue:h}),d===Pg.ADMIN&&t===Jh.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx("button",{type:"submit",disabled:v||i,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})},KP=({memory:e})=>{const t=Uk(),[a,r]=n.useState(!1),o=n.useRef(null);return s.jsx($P,{open:a,memory:e,onOpenChange:r,triggerRef:o,children:s.jsx(pl,{asChild:!0,children:s.jsx(Dl,{description:t("com_ui_edit_memory"),render:s.jsx(Si,{variant:"ghost","aria-label":t("com_ui_bookmarks_edit"),onClick:()=>r(!a),className:"h-8 w-8 p-0",children:s.jsx(tc,{})})})})})},WP=({memory:e})=>{const t=Uk(),{showToast:a}=$d(),[r,o]=n.useState(!1),{mutate:i}=(()=>{const e=pr();return fr((e=>fx.deleteMemory(e)),{onSuccess:()=>{e.invalidateQueries([ex.memories])}})})(),[l,c]=n.useState(null);return s.jsxs(ml,{open:r,onOpenChange:o,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Dl,{description:t("com_ui_delete_memory"),render:s.jsx(Si,{variant:"ghost","aria-label":t("com_ui_delete"),onClick:()=>o(!r),className:"h-8 w-8 p-0",children:l===e.key?s.jsx(rc,{className:"size-4 animate-spin"}):s.jsx(Sc,{className:"size-4"})})})}),s.jsx(Ud,{showCloseButton:!1,title:t("com_ui_delete_memory"),className:"w-11/12 max-w-lg",main:s.jsxs(ul,{className:"text-left text-sm font-medium",children:[t("com_ui_delete_confirm"),' "',e.key,'"?']}),selection:{selectHandler:async()=>{c(e.key),i(e.key,{onSuccess:()=>{a({message:t("com_ui_deleted"),status:"success"}),o(!1)},onError:()=>a({message:t("com_ui_error"),status:"error"}),onSettled:()=>c(null)})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:t("com_ui_delete")}})]})},qP=10;function QP(){var e;const t=Uk(),{user:a}=qk(),{data:r}=Sy(),{data:o,isLoading:i}=tj(),{showToast:l}=$d(),[c,d]=n.useState(0),[u,m]=n.useState(""),[p,f]=n.useState(!1),[h,g]=n.useState(!0),x=nj({onSuccess:()=>{l({message:t("com_ui_preferences_updated"),status:"success"})},onError:()=>{l({message:t("com_ui_error_updating_preferences"),status:"error"}),g((e=>!e))}});n.useEffect((()=>{var e;void 0!==(null==(e=null==r?void 0:r.personalization)?void 0:e.memories)&&g(r.personalization.memories)}),[null==(e=null==r?void 0:r.personalization)?void 0:e.memories]);const v=Qk({permissionType:Zh.MEMORIES,permission:Jh.READ}),b=Qk({permissionType:Zh.MEMORIES,permission:Jh.UPDATE}),_=Qk({permissionType:Zh.MEMORIES,permission:Jh.CREATE}),y=Qk({permissionType:Zh.MEMORIES,permission:Jh.OPT_OUT}),j=n.useMemo((()=>(null==o?void 0:o.memories)??[]),[o]),w=n.useMemo((()=>A(j,u,{keys:["key","value"]})),[j,u]),N=n.useMemo((()=>w.slice(c*qP,(c+1)*qP)),[w,c]);return i?s.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:s.jsx(rc,{})}):v?s.jsx("div",{className:"flex h-full w-full flex-col overflow-hidden",children:s.jsxs("div",{role:"region","aria-label":t("com_ui_memories"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(cl,{placeholder:t("com_ui_memories_filter"),value:u,onChange:e=>m(e.target.value),"aria-label":t("com_ui_memories_filter")})}),((null==o?void 0:o.tokenLimit)||y)&&s.jsxs("div",{className:s_("flex items-center rounded-lg",null!=(null==o?void 0:o.tokenLimit)&&y?"justify-between":"justify-end"),children:[(null==o?void 0:o.tokenLimit)&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative size-10",children:[s.jsxs("svg",{className:"size-10 -rotate-90 transform",children:[s.jsx("circle",{cx:"20",cy:"20",r:"16",stroke:"currentColor",strokeWidth:"3",fill:"none",className:"text-gray-200 dark:text-gray-700"}),s.jsx("circle",{cx:"20",cy:"20",r:"16",strokeWidth:"3",fill:"none",strokeDasharray:""+2*Math.PI*16,strokeDashoffset:""+2*Math.PI*16*(1-(o.usagePercentage??0)/100),className:"transition-all "+(C=o.usagePercentage??0,C>90?"stroke-red-500":C>75?"stroke-yellow-500":"stroke-green-500"),strokeLinecap:"round"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-xs font-medium",children:[o.usagePercentage,"%"]})})]}),s.jsx("div",{className:"text-sm text-text-secondary",children:t("com_ui_usage")})]}),y&&s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsx("span",{children:t("com_ui_use_memory")}),s.jsx(kl,{checked:h,onCheckedChange:e=>{g(e),x.mutate({memories:e})},"aria-label":t("com_ui_reference_saved_memories"),disabled:x.isLoading})]})]}),_&&s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(BP,{open:p,onOpenChange:f,children:s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{variant:"outline",className:"w-full bg-transparent",children:[s.jsx(kt,{className:"size-4","aria-hidden":!0}),t("com_ui_create_memory")]})})})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsxs(Sl,{className:"w-full table-fixed",children:[s.jsx(Tl,{children:s.jsxs(Rl,{className:"border-b border-border-light hover:bg-surface-secondary",children:[s.jsx(Il,{className:(b?"w-[75%]":"w-[100%]")+" bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{children:t("com_ui_memory")})}),b&&s.jsx(Il,{className:"w-[25%] bg-surface-secondary py-3 text-center text-sm font-medium text-text-secondary",children:s.jsx("div",{children:t("com_assistants_actions")})})]})}),s.jsx(El,{children:N.length?N.map(((e,t)=>s.jsxs(Rl,{className:"border-b border-border-light hover:bg-surface-secondary",children:[s.jsx(Pl,{className:(b?"w-[75%]":"w-[100%]")+" px-4 py-4",children:s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm text-text-primary",title:e.value,children:e.value})}),b&&s.jsx(Pl,{className:"w-[25%] px-4 py-4",children:s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx(KP,{memory:e}),s.jsx(WP,{memory:e})]})})]},t))):s.jsx(Rl,{children:s.jsx(Pl,{colSpan:b?2:1,className:"h-24 text-center text-sm text-text-secondary",children:t("com_ui_no_memories")})})})]})}),w.length>qP&&s.jsxs("div",{className:"flex items-center justify-end gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>d((e=>Math.max(e-1,0))),disabled:0===c,"aria-label":t("com_ui_prev"),children:t("com_ui_prev")}),s.jsx("div",{className:"text-sm","aria-live":"polite",children:`${c+1} / ${Math.ceil(w.length/qP)}`}),s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>d((e=>(e+1)*qP<w.length?e+1:e)),disabled:(c+1)*qP>=w.length,"aria-label":t("com_ui_next"),children:t("com_ui_next")})]}),(null==a?void 0:a.role)===Pg.ADMIN&&s.jsx("div",{className:"mt-4",children:s.jsx(GP,{})})]})}):s.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-sm text-text-secondary",children:t("com_ui_no_read_access")})})});var C}const YP=({field:e,inputClass:t,labelClass:a})=>{const r=Uk(),o=n.useRef([]),i=n.useRef(null),[l,c]=n.useState(""),d=()=>{if(l.trim()&&e.value.length<dh.MAX_CONVO_STARTERS){const t=[l,...e.value];e.onChange(t),c("")}},u={transition:"opacity 200ms ease-in-out",opacity:0},m={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}},p=e.value.length>=dh.MAX_CONVO_STARTERS;return s.jsxs("div",{className:"relative",children:[s.jsx("label",{className:a,htmlFor:"conversation_starters",children:r("com_assistants_conversation_starters")}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:e=>o.current[0]=e,value:l,maxLength:64,className:`${t} pr-10`,type:"text",placeholder:r(p?"com_assistants_max_starters_reached":"com_assistants_conversation_starters_placeholder"),onChange:e=>c(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(e.preventDefault(),p?((t=e.currentTarget).classList.remove("shake"),t.offsetWidth,t.classList.add("shake"),setTimeout((()=>{t.classList.remove("shake")}),200)):d())}}),s.jsx(Dr,{nodeRef:i,in:e.value.length<dh.MAX_CONVO_STARTERS,timeout:200,unmountOnExit:!0,children:e=>s.jsx("div",{ref:i,style:{...u,...m[e],transition:"entering"===e?"none":u.transition},className:"absolute right-1 top-1",children:s.jsx(Dl,{side:"top",description:r(p?"com_assistants_max_starters_reached":"com_ui_add"),className:"flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:d,disabled:p,children:s.jsx(kt,{className:"size-4"})})})})]}),e.value.map(((n,a)=>s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:e=>o.current[a+1]=e,value:n,onChange:t=>{const n=[...e.value];n[a]=t.target.value,e.onChange(n)},className:`${t} pr-10`,type:"text",maxLength:64}),s.jsx(Dl,{side:"top",description:r("com_ui_delete"),className:"absolute right-1 top-1 flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:()=>(t=>{const n=e.value.filter(((e,n)=>n!==t));e.onChange(n)})(a),children:s.jsx(vt,{className:"size-4"})})]},a)))]})]})};function XP({isOpen:e,endpoint:t,setIsOpen:a}){const r=Uk(),{getValues:o,setValue:i}=Uo(),{data:l}=gj(t),c=Lu(t),{maxPage:d,setMaxPage:u,currentPage:m,setCurrentPage:p,itemsPerPage:f,searchChanged:h,setSearchChanged:g,searchValue:x,setSearchValue:v,gridRef:b,handleSearch:_,handleChangePage:y,error:j,setError:w,errorMessage:N,setErrorMessage:C,showPluginAuthForm:k,setShowPluginAuthForm:S,selectedPlugin:T,setSelectedPlugin:E}=fE(),R=yk(),I=e=>{var t,n;w(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&C(s),setTimeout((()=>{w(!1),C("")}),5e3)},P=e=>{const t=()=>{const t=o("functions").slice();t.push(e.pluginKey),i("functions",t)};if(!e.auth)return t();R.mutate(e,{onError:e=>{I(e)},onSuccess:t}),S(!1)},A=null==l?void 0:l.filter((e=>e.name.toLowerCase().includes(x.toLowerCase())));return n.useEffect((()=>{A&&(u(Math.ceil(A.length/f)),h&&(p(1),g(!1)))}),[l,f,x,A,h,u,p,g]),s.jsxs(Xr,{open:e,onClose:()=>{a(!1),p(1),v("")},className:"relative z-[102]",children:[s.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),s.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:s.jsxs(Zr,{className:"relative w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[s.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"text-center sm:text-left",children:[s.jsx(Jr,{className:"text-lg font-medium leading-6 text-text-primary",children:r(c?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),s.jsx(eo,{className:"text-sm text-text-secondary",children:r("com_nav_tool_dialog_description")})]})}),s.jsx("div",{children:s.jsx("div",{className:"sm:mt-0",children:s.jsx("button",{onClick:()=>{a(!1),p(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:s.jsx(vt,{"aria-hidden":"true"})})})})]}),j&&s.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[r("com_nav_plugin_auth_error")," ",N]}),k&&s.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:s.jsx(LR,{plugin:T,onSubmit:e=>P(e),isEntityTool:!0})}),s.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[s.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[s.jsx(wt,{className:"h-6 w-6 text-text-tertiary"}),s.jsx("input",{type:"text",value:x,onChange:_,placeholder:r("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),s.jsx("div",{ref:b,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((m-1)*f,m*f).map(((e,t)=>s.jsx(FR,{tool:e,isInstalled:o("functions").includes(e.pluginKey),onAddTool:()=>(e=>{S(!1);const t=null==l?void 0:l.find((t=>t.pluginKey===e));E(t);const{authConfig:n,authenticated:s=!1}=t??{};n&&n.length>0&&!s?S(!0):P({pluginKey:e,action:"install",auth:null})})(e.pluginKey),onRemoveTool:()=>(e=>{S(!1),R.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{I(e)},onSuccess:()=>{const t=o("functions").filter((t=>t!==e));i("functions",t)}})})(e.pluginKey)},t)))})]}),s.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:d>0?s.jsx(AR,{currentPage:m,maxPage:d,onChangePage:y}):s.jsx("div",{style:{height:"21px"}})})]})]})})]})}function ZP({control:e,setValue:t}){const n=Uk(),a=e=>{t("append_current_datetime",e,{shouldDirty:!0})};return s.jsx("div",{className:"mb-6",children:s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:"append_current_datetime",control:e,render:({field:e})=>s.jsx(Ti,{...e,id:"append_current_datetime",checked:e.value,onCheckedChange:a,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":"append-date-label"})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("label",{id:"append-date-label",htmlFor:"append_current_datetime",className:"form-check-label text-token-text-primary w-full cursor-pointer",children:n("com_assistants_append_date")}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-5 w-5 text-gray-500","aria-label":n("com_assistants_append_date_tooltip")})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("com_assistants_append_date_tooltip")})})})})]})})})}function JP(){const e=Uk(),t=Uo(),{control:n,setValue:a,getValues:r}=t;return s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:Jp.image_vision,control:n,render:({field:e})=>s.jsx(Ti,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Jp.image_vision,onClick:()=>a(Jp.image_vision,!r(Jp.image_vision),{shouldDirty:!0}),children:s.jsx("div",{className:"flex items-center",children:e("com_assistants_image_vision")})})]})}function eA({version:e,retrievalModels:t}){const a=Uk(),r=Uo(),{control:o,setValue:i,getValues:l}=r,c=Ho({control:o,name:"model"}),d=Ho({control:o,name:"assistant"});n.useMemo((()=>{var e;return"string"==typeof d?[]:null==(e=d.tool_resources)?void 0:e.file_search}),[d]);const u=n.useMemo((()=>!t.has(c)),[c,t]);return n.useEffect((()=>{c&&u&&i(Jp.retrieval,!1)}),[c,i,u]),s.jsx(s.Fragment,{children:s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:Jp.retrieval,control:o,render:({field:e})=>s.jsx(Ti,{...e,checked:e.value,disabled:u,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("label",{className:s_("form-check-label text-token-text-primary w-full select-none",u?"cursor-no-drop opacity-50":"cursor-pointer"),htmlFor:Jp.retrieval,onClick:()=>t.has(c)&&i(Jp.retrieval,!l(Jp.retrieval),{shouldDirty:!0}),children:a(1==e?"com_assistants_retrieval":"com_assistants_file_search")}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,disabled:u,className:"ml-16 w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&a("com_assistants_file_search_info")})})})}),s.jsx(rI,{side:yv.Top,disabled:!u,description:"com_assistants_non_retrieval_model",langCode:!0,sideOffset:20,className:"ml-16"})]})})})}const tA=eu.code_interpreter;function nA({endpoint:e,assistant_id:t,files:a}){const r=Uk(),{setFilesLoading:o}=Mk(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=Gm}=Xy({select:e=>Ym(e)}),{handleFileChange:u}=PT({overrideEndpoint:e,additionalMetadata:{assistant_id:t,tool_resource:tA},fileSetter:c});n.useEffect((()=>{a&&c(new Map(a))}),[a]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return s.jsx("div",{className:"mb-2 w-full",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:r("com_assistants_code_interpreter_files")}),s.jsx(SI,{files:l,setFiles:c,assistant_id:t,tool_resource:tA,setFilesLoading:o,Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:!t,onChange:u}),r("com_ui_upload_files")]})})})]})})}function sA({version:e}){const t=Uk(),n=Uo(),{control:a,setValue:r,getValues:o}=n;return s.jsx(s.Fragment,{children:s.jsx(rl,{openDelay:50,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Bo,{name:Jp.code_interpreter,control:a,render:({field:e})=>s.jsx(Ti,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),s.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>r(Jp.code_interpreter,!o(Jp.code_interpreter),{shouldDirty:!0}),children:[s.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Jp.code_interpreter,children:t("com_assistants_code_interpreter")}),s.jsx(ol,{children:s.jsx(Gc,{className:"h-5 w-5 text-gray-500"})})]}),s.jsx(il,{children:s.jsx(ll,{side:yv.Top,className:"w-80",children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&t("com_assistants_code_interpreter_info")})})})})]})})})}function aA({version:e,endpoint:t,codeEnabled:a,retrievalEnabled:r,assistantsConfig:o}){const i=Uk(),l=Uo(),{control:c}=l,d=Ho({control:c,name:"assistant"}),u=Ho({control:c,name:"id"}),m=n.useMemo((()=>"string"==typeof d?[]:d.code_files),[d]),p=n.useMemo((()=>new Set((null==o?void 0:o.retrievalModels)??[])),[o]),f=n.useMemo((()=>{var e;return null==(e=null==o?void 0:o.capabilities)?void 0:e.includes(Jp.image_vision)}),[o]);return s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:i("com_assistants_capabilities")})})}),s.jsxs("div",{className:"flex flex-col items-start gap-2",children:[a&&s.jsx(sA,{version:e}),r&&s.jsx(eA,{endpoint:t,version:e,retrievalModels:p}),f&&1==e&&s.jsx(JP,{}),a&&e&&s.jsx(nA,{assistant_id:u,version:e,endpoint:t,files:m})]})]})}function rA(){return s.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:s.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const oA=({url:e,progress:t=1})=>{const n=2*Math.PI*55,a=n-t*n;return s.jsx("div",{children:s.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[s.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}}),t<1&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:a,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function iA({handleFileChange:e}){const t=n.useRef(null);return s.jsx(Ha,{children:s.jsxs(Ga,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[s.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;t.current&&(t.current.value=""),null==(e=t.current)||e.click()},children:"Upload Photo"}),s.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:t,tabIndex:-1})]})})}function lA({endpoint:e,version:t,assistant_id:a,metadata:r,createMutation:o}){const i=pr(),l=bS(),[c,d]=n.useState(!1),[u,m]=n.useState(1),[p,f]=n.useState(null),[h,g]=n.useState(null),x=n.useRef(null),{data:v=Gm}=Xy({select:e=>Ym(e)}),b=Uk(),{showToast:_}=$d(),y=n.useMemo((()=>{var t;return(null==(t=null==l?void 0:l[e][a??""])?void 0:t.model)??""}),[l,e,a]),{mutate:j}=Aj({onMutate:()=>{m(.4)},onSuccess:(t,n)=>{var s,r,l;!0!==n.postCreation?_({message:b("com_ui_upload_success")}):x.current!==(null==(s=o.data)?void 0:s.id)&&(x.current=(null==(r=o.data)?void 0:r.id)??""),f(null),g(null==(l=t.metadata)?void 0:l.avatar);const c=i.getQueryData([ex.assistants,e,uu]);if(!(null==c?void 0:c.data)||!c)return;const d=c.data.map((e=>e.id===a?{...e,...t}:e));i.setQueryData([ex.assistants,e,uu],{...c,data:d}),m(1)},onError:e=>{console.error("Error:",e),f(null),g(null),_({message:b("com_ui_upload_error"),status:"error"}),m(1)}});n.useEffect((()=>{if(p){const e=new FileReader;e.onloadend=()=>{g(e.result)},e.readAsDataURL(p)}}),[p]),n.useEffect((()=>{g((null==r?void 0:r.avatar)??null)}),[r]),n.useEffect((()=>{const n=!!(o.isSuccess&&p&&h&&h.includes("base64"));if((!n||x.current!==o.data.id)&&n&&o.data.id){console.log("[AssistantAvatar] Uploading Avatar after Assistant Creation");const n=new FormData;n.append("file",p,p.name),n.append("assistant_id",o.data.id),j({assistant_id:o.data.id,model:y,postCreation:!0,formData:n,endpoint:e,version:t})}}),[o.data,o.isSuccess,p,h,j,y,e,t]);return s.jsxs(Ka,{open:c,onOpenChange:d,children:[s.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:s.jsx(Wa,{asChild:!0,children:s.jsx("button",{type:"button",className:"h-20 w-20",children:h?s.jsx(oA,{url:h,progress:u}):s.jsx(rA,{})})})}),s.jsx(iA,{handleFileChange:n=>{var s;const r=null==(s=n.target.files)?void 0:s[0];if(v.avatarSizeLimit&&r&&r.size<=v.avatarSizeLimit){if(!r)return void console.error("No file selected");if(f(r),d(!1),!a)return void console.log("[AssistantAvatar] No assistant_id, will wait until form submission + upload");const n=new FormData;n.append("file",r,r.name),n.append("assistant_id",a),j({assistant_id:a,model:y,formData:n,endpoint:e,version:t})}else{const e=v.avatarSizeLimit?Fv(v.avatarSizeLimit):2;_({message:b("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}d(!1)}})]})}const cA=new Set(["name","id","description","instructions","conversation_starters","model","append_current_datetime"]);function dA({reset:e,value:t,endpoint:a,documentsMap:r,selectedAssistant:o,setCurrentAssistantId:i,createMutation:l,allTools:c}){const d=Uk(),u=aS(),m=n.useRef(null),[p]=DE(uh.LAST_MODEL,{}),f=n.useMemo((()=>new Set(null==c?void 0:c.filter((e=>!0===e.toolkit)).map((e=>e.pluginKey)))),[c]),h=xj(a,void 0,{select:e=>e.data.map((e=>{var t,n,s,o;const i=a===Nu.assistants?_m.openai:_m.azure,l={...e,label:e.name??"",value:e.id,files:e.file_ids?[]:void 0,code_files:(null==(n=null==(t=e.tool_resources)?void 0:t.code_interpreter)?void 0:n.file_ids)?[]:void 0},c=(e,t)=>{const n=null==u?void 0:u[e];n?null==t||t.push([e,{file_id:n.file_id,type:n.type,filepath:n.filepath,filename:n.filename,width:n.width,height:n.height,size:n.bytes,preview:n.filepath,progress:1,source:i}]):null==t||t.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:a,source:i}])};l.files&&e.file_ids&&e.file_ids.forEach((e=>c(e,l.files))),l.code_files&&(null==(o=null==(s=e.tool_resources)?void 0:s.code_interpreter)?void 0:o.file_ids)&&e.tool_resources.code_interpreter.file_ids.forEach((e=>c(e,l.code_files)));const d=null==r?void 0:r.get(e.id);return d&&(l.conversation_starters||(l.conversation_starters=d.conversation_starters),l.append_current_datetime=d.append_current_datetime??!1),l}))}),g=n.useCallback((t=>{var n;const s=null==(n=h.data)?void 0:n.find((e=>e.id===t));if(l.reset(),!s)return i(void 0),e({...Vu,model:(null==p?void 0:p[a])??""});const r={...s,label:s.name??"",value:s.id||""},o={[Jp.code_interpreter]:!1,[Jp.image_vision]:!1,[Jp.retrieval]:!1};(s.tools??[]).filter((e=>"function"!==e.type||Hu(e))).map((e=>{var t;return((null==(t=e.function)?void 0:t.name)??"")||e.type})).forEach((e=>{e===Jd.file_search&&(o[Jp.retrieval]=!0),o[e]=!0}));const c=new Set,d=(s.tools??[]).filter((e=>"function"===e.type&&!Hu(e))).map((e=>{var t;return(null==(t=e.function)?void 0:t.name)??""})).filter((e=>{const t=e.split("_")[0],n=f.has(t);return n&&c.add(t),!n}));c.size>0&&d.push(...Array.from(c));const u={functions:d,...o,assistant:r,model:r.model};Object.entries(s).forEach((([e,t])=>{cA.has(e)&&("append_current_datetime"!==e?("conversation_starters"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))||"number"!=typeof t&&"object"!=typeof t)&&(u[e]=t):u[e]=!!t)})),e(u),i(s.id)}),[h.data,e,i,l,a,p,f]);n.useEffect((()=>{let e=null;if(o!==m.current)return""!==o&&null!=o&&h.data&&(e=setTimeout((()=>{m.current=o,g(o)}),5)),()=>{e&&clearTimeout(e)}}),[o,h.data,g]);const x=d("com_ui_create")+" "+d("com_ui_assistant");return s.jsx(Fd,{value:t||x,setValue:qv(g),availableValues:h.data??[{label:"Loading...",value:""}],iconSide:"left",showAbove:!1,showLabel:!1,emptyTitle:!0,containerClassName:"flex-grow",searchClassName:"dark:from-gray-850",searchPlaceholder:d("com_assistants_search_name"),optionsClass:"hover:bg-gray-20/50 dark:border-gray-700",optionsListClass:"rounded-lg shadow-lg dark:bg-gray-850 dark:border-gray-700 dark:last:border",currentValueClass:s_("text-md font-semibold text-gray-900 dark:text-white",""===t?"text-gray-500":""),className:s_("mt-1 rounded-md dark:border-gray-700 dark:bg-gray-850","z-50 flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer hover:border-green-500 focus:border-gray-400"),renderOption:()=>s.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[s.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-2 text-gray-800 dark:text-gray-100",children:s.jsx(kt,{className:"w-[16px]"})}),s.jsx("span",{className:s_("ml-4 flex h-6 items-center gap-1 text-gray-800 dark:text-gray-100"),children:x})]})})}function uA({activeModel:e,assistant_id:t,setCurrentAssistantId:n,createMutation:a,endpoint:r}){const o=Uk(),{showToast:i}=$d(),{conversation:l}=Mk(),{setOption:c}=xT(),d=Pj({onSuccess:(e,t,s)=>{var r;const d=s;if(!d)return;i({message:o("com_ui_assistant_deleted"),status:"success"}),void 0!==(null==(r=a.data)?void 0:r.id)&&(console.log("[deleteAssistant] resetting createMutation"),a.reset());const u=d[0];if(!u)return c("assistant_id")("");if(t.assistant_id===(null==l?void 0:l.assistant_id))return c("assistant_id")(u.id);const m=d.find((e=>e.id===(null==l?void 0:l.assistant_id)));m&&n(m.id),n(u.id)},onError:e=>{console.error(e),i({message:o("com_ui_assistant_delete_error"),status:"error"})}});return t?0===(null==e?void 0:e.length)||void 0===e?null:s.jsxs(Qi,{children:[s.jsx(Yi,{asChild:!0,children:s.jsx("button",{className:s_("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",m_),type:"button",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:s.jsx(Sc,{})})})}),s.jsx(Dd,{title:o("com_ui_delete")+" "+o("com_ui_assistant"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(ul,{htmlFor:"delete-assistant",className:"text-left text-sm font-medium",children:o("com_ui_delete_assistant_confirm")})})})}),selection:{selectHandler:()=>d.mutate({assistant_id:t,model:e,endpoint:r}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]}):null}function mA({tool:e,allTools:t,assistant_id:a=""}){const[r,o]=n.useState(!1),i=Uk(),{showToast:l}=$d(),c=yk(),{getValues:d,setValue:u}=Uo(),m=t.find((t=>t.pluginKey===e));return m?s.jsxs(ml,{children:[s.jsxs("div",{className:s_("flex w-full items-center rounded-lg text-sm",a?"":"opacity-40"),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[s.jsxs("div",{className:"flex grow items-center",children:[m.icon&&s.jsx("div",{className:"flex h-9 w-9 items-center justify-center overflow-hidden rounded-full",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${m.icon})`,backgroundSize:"cover"}})}),s.jsx("div",{className:"h-9 grow px-3 py-2",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:m.name})]}),r&&s.jsx(pl,{asChild:!0,children:s.jsx("button",{type:"button",className:"flex h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-gray-200 dark:hover:bg-gray-700",children:s.jsx(Sc,{})})})]}),s.jsx(Ud,{showCloseButton:!1,title:i("com_ui_delete_tool"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:i("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=m.pluginKey)&&c.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{l({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{const t=d("functions").filter((t=>t!==e));u("functions",t),l({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-colors duration-200 text-white",selectText:i("com_ui_delete")}})]}):null}const pA=({children:e})=>{const t=Uk();return s.jsxs("div",{children:[s.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:t("com_assistants_code_interpreter_files")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e})]})};function fA({endpoint:e,assistant_id:t,files:a}){const r=Uk(),{setFilesLoading:o}=Mk(),i=n.useRef(null),[l,c]=n.useState(new Map),{data:d=Gm}=Xy({select:e=>Ym(e)}),{handleFileChange:u}=PT({overrideEndpoint:e,additionalMetadata:{assistant_id:t},fileSetter:c});n.useEffect((()=>{a&&c(new Map(a))}),[a]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("span",{children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:r(t?"com_assistants_knowledge":"com_assistants_knowledge_disabled")})})}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"text-token-text-tertiary rounded-lg",children:t?r("com_assistants_knowledge_info"):""}),s.jsx(SI,{files:l,setFiles:c,setFilesLoading:o,assistant_id:t,fileFilter:e=>Um.some((t=>t.test(e.type??""))),Wrapper:({children:e})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),s.jsx(SI,{files:l,setFiles:c,setFilesLoading:o,assistant_id:t,fileFilter:e=>!Um.some((t=>t.test(e.type??""))),Wrapper:pA}),s.jsx("div",{children:s.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-8 rounded-lg font-medium",onClick:()=>{var e;i.current&&(i.current.value=""),null==(e=i.current)||e.click()},children:s.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[s.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:i,disabled:!t,onChange:u}),r("com_ui_upload_files")]})})})]})]})}const hA="mb-2 text-token-text-primary block font-medium",gA=s_(h_,"flex w-full px-3 py-2 dark:border-gray-800 dark:bg-gray-800 rounded-xl mb-2",m_);function xA({setAction:e,endpoint:t,actions:a=[],setActivePanel:r,documentsMap:o,assistant_id:i,setCurrentAssistantId:l,assistantsConfig:c,version:d}){const u=fk(),m=bS(),{data:p=[]}=Iy(),{onSelect:f}=function(e){const t=Pk(),{conversation:s,newConversation:a}=Mk(),r=Ok((e=>Cv(e.data)));return{onSelect:n.useCallback((n=>{var o;const i=null==(o=r[e])?void 0:o[n];if(!i)return;const l={endpoint:e,assistant_id:i.id,model:i.model,conversationId:"new"};if(a_.log("conversation","Updating conversation with assistant",i),Mu(null==s?void 0:s.endpoint)){const e=t({conversation:{...s??{}},preset:l});a({template:e,preset:l,keepLatestMessage:!0})}else a({template:{...l},preset:l})}),[e,r,s,t,a])}}(t),{showToast:h}=$d(),g=Uk(),x=Vo({defaultValues:Vu}),[v,b]=n.useState(!1),{control:_,handleSubmit:y,reset:j,setValue:w,getValues:N}=x,C=Ho({control:_,name:"assistant"}),k=Ho({control:_,name:"functions"}),S=Ho({control:_,name:"id"}),T=n.useMemo((()=>{var e,n;return null==(n=null==(e=null==m?void 0:m[t])?void 0:e[S])?void 0:n.model}),[m,t,S]),E=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jp.tools)}),[c]),R=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jp.actions)}),[c]),I=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jp.retrieval)}),[c]),P=n.useMemo((()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jp.code_interpreter)}),[c]),A=Ij({onSuccess:e=>{h({message:`${g("com_assistants_update_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_update_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),M=Rj({onSuccess:e=>{l(e.id),h({message:`${g("com_assistants_create_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_create_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),L=n.useMemo((()=>"string"==typeof C?[]:C.files),[C]);let O;return O=M.isLoading||A.isLoading?s.jsx(rc,{className:"icon-md"}):g(S?"com_ui_save":"com_ui_create"),s.jsx($o,{...x,children:s.jsxs("form",{onSubmit:y((e=>{const n=[...k].map((e=>{var n,s;if(!e.includes(cu))return e;{const a=null==(n=null==m?void 0:m[t])?void 0:n[S],r=null==(s=null==a?void 0:a.tools)?void 0:s.find((t=>{var n;return(null==(n=t.function)?void 0:n.name)===e}));if(a&&r)return r}return e}));e.code_interpreter&&n.push({type:Jd.code_interpreter}),e.retrieval&&n.push({type:2==d?Jd.file_search:Jd.retrieval}),e.image_vision&&n.push($u);const{name:s,description:a,instructions:r,conversation_starters:o,model:i,append_current_datetime:l}=e;S?A.mutate({assistant_id:S,data:{name:s,description:a,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,append_current_datetime:l}}):M.mutate({name:s,description:a,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,version:d,append_current_datetime:l})})),className:"h-auto w-full flex-shrink-0 overflow-x-hidden",children:[s.jsxs("div",{className:"flex w-full flex-wrap",children:[s.jsx(Bo,{name:"assistant",control:_,render:({field:e})=>s.jsx(dA,{reset:j,value:e.value,endpoint:t,documentsMap:o,allTools:p,setCurrentAssistantId:l,selectedAssistant:i??null,createMutation:M})}),S&&s.jsx("button",{className:"btn btn-primary focus:shadow-outline mx-2 mt-1 h-[40px] rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0",type:"button",disabled:!S,onClick:e=>{e.preventDefault(),f(S)},children:g("com_ui_select")})]}),s.jsxs("div",{className:"bg-surface-50 h-auto px-4 pb-8 pt-3 dark:bg-transparent",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(lA,{createMutation:M,assistant_id:S,metadata:C.metadata??null,endpoint:t,version:d}),s.jsx("label",{className:hA,htmlFor:"name",children:g("com_ui_name")}),s.jsx(Bo,{name:"name",control:_,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",max:256,className:gA,id:"name",type:"text",placeholder:g("com_assistants_name_placeholder")})}),s.jsx(Bo,{name:"id",control:_,render:({field:e})=>s.jsx("p",{className:"h-3 text-xs italic text-text-secondary",children:e.value})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:hA,htmlFor:"description",children:g("com_ui_description")}),s.jsx(Bo,{name:"description",control:_,render:({field:e})=>s.jsx("input",{...e,value:e.value??"",max:512,className:gA,id:"description",type:"text",placeholder:g("com_assistants_description_placeholder")})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:hA,htmlFor:"instructions",children:g("com_ui_instructions")}),s.jsx(Bo,{name:"instructions",control:_,render:({field:e})=>s.jsx("textarea",{...e,value:e.value??"",max:32768,className:s_(gA,"min-h-[100px] resize-y"),id:"instructions",placeholder:g("com_assistants_instructions_placeholder"),rows:3})})]}),s.jsx(ZP,{control:_,setValue:w,getValues:N}),s.jsx("div",{className:"relative mb-6",children:s.jsx(Bo,{name:"conversation_starters",control:_,defaultValue:[],render:({field:e})=>s.jsx(YP,{field:e,inputClass:gA,labelClass:hA})})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:hA,htmlFor:"model",children:g("com_ui_model")}),s.jsx(Bo,{name:"model",control:_,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:n}})=>{var a;return s.jsxs(s.Fragment,{children:[s.jsx(Fd,{emptyTitle:!0,value:e.value,setValue:e.onChange,availableValues:(null==(a=u.data)?void 0:a[t])??[],showAbove:!1,showLabel:!1,className:s_(f_,"flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer"),containerClassName:s_("rounded-md",n?"border-red-500 border-2":"")}),n&&s.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:g("com_ui_field_required")})]})}})]}),(!0===P||!0===I)&&1==d&&s.jsx(fA,{assistant_id:S,files:L,endpoint:t}),s.jsx(aA,{version:d,endpoint:t,codeEnabled:P,assistantsConfig:c,retrievalEnabled:I}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:hA,children:`${!0===E?g("com_ui_tools"):""}\n              ${!0===E&&!0===R?" + ":""}\n              ${!0===R?g("com_assistants_actions"):""}`}),s.jsxs("div",{className:"space-y-2",children:[k.map(((e,t)=>s.jsx(mA,{tool:e,allTools:p,assistant_id:S},`${e}-${t}-${S}`))),a.filter((e=>e.assistant_id===S)).map(((t,n)=>s.jsx(VR,{action:t,onClick:()=>e(t)},n))),s.jsxs("div",{className:"flex space-x-2",children:[!0===E&&s.jsx("button",{type:"button",onClick:()=>b(!0),className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_tools")})}),!0===R&&s.jsx("button",{type:"button",disabled:!S,onClick:()=>{if(!S)return h({message:g("com_assistants_actions_disabled"),status:"warning"});r(bv.actions)},className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_actions")})})]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(uA,{assistant_id:S,activeModel:T,setCurrentAssistantId:l,createMutation:M,endpoint:t}),s.jsx("button",{className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",children:O})]})]}),s.jsx(XP,{endpoint:t,isOpen:v,setIsOpen:b})]})})}function vA({columns:e,data:t}){const n=lr({columns:e,data:t,getCoreRowModel:ur()});return s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>s.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>s.jsx("th",{className:"py-1 font-normal",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())},t)))},t)))}),s.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>s.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>s.jsx("td",{className:"py-2",children:ir(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const bA=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],_A=ko(((e,t)=>{t(Rx(e))}),800);function yA({action:e,assistant_id:t,endpoint:a,version:r,setAction:o}){var i;const l=e=>{e.status||(b(null),y(null)),h(e)},c=Uk(),{showToast:d}=$d(),u=bS(),{handleSubmit:m,reset:p}=Uo(),[f,h]=n.useState(null),[g,x]=n.useState(""),[v,b]=n.useState(null),[_,y]=n.useState(null);n.useEffect((()=>{var t;const n=(null==(t=null==e?void 0:e.metadata)?void 0:t.raw_spec)??"";n&&(x(n),_A(n,l))}),[null==(i=null==e?void 0:e.metadata)?void 0:i.raw_spec]),n.useEffect((()=>{if(!f||!f.status||!f.spec)return;const{functionSignatures:e,requestBuilders:t}=Ex(f.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));b(n),h(null),y(e.map((e=>e.toObjectTool())))}),[f]);const j=Mj({onSuccess(e){d({message:c("com_assistants_update_actions_success"),status:"success"}),p(),o(e[2])},onError(e){d({message:(null==e?void 0:e.message)??c("com_assistants_update_actions_error"),status:"error"})}}),w=m((n=>{console.log("authFormData",n);const s=t??"";if(!s)return;if(!_)return;if(!v)return;let{metadata:o}=e??{};o||(o={});const i=null==e?void 0:e.action_id;o.raw_spec=g;const l=new URL(v[0].domain).hostname;if(!l)return;o.domain=l;const{type:c,saved_auth_fields:d}=n,m=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};d&&c===Zm.ServiceHttp?o={...o,api_key:n.api_key,auth:{type:c,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:d&&c===Zm.OAuth?o={...o,auth:{type:c,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:d?(m(o),o.auth={type:c}):m(o),j.mutate({action_id:i,metadata:o,functions:_,assistant_id:s,endpoint:a,version:r,model:(null==u?void 0:u[a][s].model)??""})}));return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"",children:[s.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[s.jsx("label",{htmlFor:"example-schema",className:"text-token-text-primary whitespace-nowrap font-medium",children:c("com_ui_schema")}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{id:"example-schema",onChange:e=>console.log(e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[s.jsx("option",{value:"label",children:c("com_ui_examples")}),s.jsx("option",{value:"0",children:"Weather (JSON)"}),s.jsx("option",{value:"1",children:"Pet Store (YAML)"}),s.jsx("option",{value:"2",children:"Blank Template"})]})})]}),s.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[s.jsx("div",{className:"relative",children:s.jsx("textarea",{id:"schemaInput",value:g,onChange:e=>{const t=e.target.value;if(x(t),!t)return b(null),y(null),h(null);_A(t,l)},spellCheck:"false",placeholder:c("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),f&&"OpenAPI spec is valid."!==f.message&&s.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:f.message.split("\n").map(((e,t)=>s.jsx("div",{children:e},t)))})]})]}),!!v&&s.jsxs("div",{className:"my-2",children:[s.jsx("div",{className:"flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_assistants_available_actions")})}),s.jsx(vA,{columns:bA,data:v})]}),s.jsxs("div",{className:"relative my-1",children:[s.jsx(uR,{action_id:null==e?void 0:e.action_id}),s.jsx("div",{className:"mb-1.5 flex items-center",children:s.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_ui_privacy_policy_url")})}),s.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:s.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{disabled:!_||!_.length,onClick:w,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:j.isLoading?s.jsx(rc,{className:"icon-md"}):(null==e?void 0:e.action_id.length)?c("com_ui_update"):c("com_ui_create")})})]})}function jA({action:e,endpoint:t,version:a,setAction:r,assistant_id:o,setActivePanel:i}){const l=Uk(),{showToast:c}=$d(),d=bS(),u=Lj({onSuccess:()=>{c({message:l("com_assistants_delete_actions_success"),status:"success"}),i(bv.builder),r(void 0)},onError(e){c({message:(null==e?void 0:e.message)??l("com_assistants_delete_actions_error"),status:"error"})}}),m=Vo({defaultValues:{type:Zm.None,saved_auth_fields:!1,api_key:"",authorization_type:Jm.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:ep.DefaultPost}}),{reset:p,watch:f}=m;return n.useEffect((()=>{var t;(null==(t=null==e?void 0:e.metadata)?void 0:t.auth)&&p({type:e.metadata.auth.type||Zm.None,saved_auth_fields:!1,api_key:e.metadata.api_key??"",authorization_type:e.metadata.auth.authorization_type||Jm.Basic,oauth_client_id:e.metadata.oauth_client_id??"",oauth_client_secret:e.metadata.oauth_client_secret??"",authorization_url:e.metadata.auth.authorization_url??"",client_url:e.metadata.auth.client_url??"",scope:e.metadata.auth.scope??"",token_exchange_method:e.metadata.auth.token_exchange_method??ep.DefaultPost})}),[e,p]),s.jsx($o,{...m,children:s.jsx("form",{className:"h-full grow overflow-hidden",children:s.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[s.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[s.jsx("div",{className:"absolute left-0 top-6",children:s.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{i(bv.builder),r(void 0)},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(pt,{})})})}),!!e&&s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx("div",{className:"absolute right-0 top-6",children:s.jsx("button",{type:"button",disabled:!o||!e.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:s.jsx(Sc,{className:"text-red-500"})})})}),s.jsx(Ud,{showCloseButton:!1,title:l("com_ui_delete_action"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:l("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{const n=o??"";if(!n)return c({message:"No assistant_id found, is the assistant created?",status:"error"});u.mutate({model:(null==d?void 0:d[t][n].model)??"",action_id:e.action_id,assistant_id:n,endpoint:t})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:l("com_ui_delete")}})]}),s.jsx("div",{className:"text-xl font-medium",children:(e?"Edit":"Add")+" actions"}),s.jsx("div",{className:"text-xs text-text-secondary",children:l("com_assistants_actions_info")})]}),s.jsx(iR,{disableOAuth:!0}),s.jsx(yA,{action:e,assistant_id:o,setAction:r,endpoint:t,version:a})]})})})}function wA(){const{conversation:e,index:t}=Mk(),[a,r]=n.useState(bv.builder),[o,i]=n.useState(void 0),[l,c]=n.useState(null==e?void 0:e.assistant_id),{data:d={}}=Ky(),{data:u=[]}=vj(null==e?void 0:e.endpoint),{data:m=null}=bj((null==e?void 0:e.endpoint)??"",{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),p=n.useMemo((()=>null==d?void 0:d[(null==e?void 0:e.endpoint)??""]),[null==e?void 0:e.endpoint,d]);if(n.useEffect((()=>{const t=(null==e?void 0:e.assistant_id)??"";t&&c(t)}),[null==e?void 0:e.assistant_id]),!(null==e?void 0:e.endpoint))return null;const f=(null==p?void 0:p.version)??of[e.endpoint];return a===bv.actions||o?s.jsx(jA,{index:t,action:o,actions:u,setAction:i,activePanel:a,documentsMap:m,setActivePanel:r,assistant_id:l,setCurrentAssistantId:c,endpoint:e.endpoint,version:f}):a===bv.builder?s.jsx(xA,{index:t,activePanel:a,action:o,actions:u,setAction:i,documentsMap:m,setActivePanel:r,assistant_id:l,setCurrentAssistantId:c,endpoint:e.endpoint,assistantsConfig:p,version:f}):void 0}function NA({className:e}){const t=Uk(),a=Pe(Cy.promptsName),r=Pe(Cy.promptsCategory),o=NT("/d/prompts",n.useCallback((()=>{a(""),r("")}),[a,r]));return s.jsx(Si,{variant:"outline",className:s_(e,"bg-transparent"),onClick:e=>{o(e)},"aria-label":"Manage Prompts",role:"button",children:t("com_ui_manage")})}const CA=n.memo((function({group:e,instanceProjectId:t}){const a=nt(),r=Fe(),o=Uk(),i=n.useRef(null),[l,c]=n.useState(e.name),{hasPermission:d}=zE("promptGroup",e._id||""),u=d(Yg.EDIT),m=d(Yg.DELETE),p=n.useMemo((()=>{var n;return t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e.projectIds,t]),f=Dj({onMutate:()=>{i.current&&clearTimeout(i.current)}}),h=(e=>{const t=pr(),{onSuccess:n,...s}=e||{},a=Ae(Cy.promptsName),r=Ae(Cy.promptsPageSize),o=Ae(Cy.promptsCategory);return fr({mutationFn:e=>fx.deletePromptGroup(e.id),...s,onSuccess:(e,s,i)=>{t.setQueryData([ex.promptGroups,a,o,r],(e=>e?Gb(e,s.id):e)),Qb(t,s.id),n&&n(e,s,i)}})})({onSuccess:(t,n)=>{n.id===e._id&&r("/d/prompts")}}),{isLoading:g}=f,x=n.useCallback((()=>{console.log(e._id??"",{name:l}),f.mutate({id:e._id??"",payload:{name:l}})}),[e._id,l,f]),v=n.useCallback((t=>{"Enter"===t.key&&(t.preventDefault(),r(`/d/prompts/${e._id}`,{replace:!0}))}),[e._id,r]),b=n.useCallback((()=>{h.mutate({id:e._id??""})}),[e._id,h]),_=n.useCallback((()=>{r(`/d/prompts/${e._id}`,{replace:!0})}),[e._id,r]);return s.jsx("div",{className:s_("mx-2 my-2 flex cursor-pointer rounded-lg border border-border-light bg-surface-primary p-3 shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-secondary",a.promptId===e._id&&"bg-surface-hover"),onClick:_,onKeyDown:v,role:"button",tabIndex:0,"aria-label":`${e.name} prompt group`,children:s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 truncate pr-2",children:[s.jsx(GS,{category:e.category??"",className:"icon-lg","aria-hidden":"true"}),s.jsx(ul,{className:"text-md cursor-pointer truncate font-semibold text-text-primary",children:e.name})]}),s.jsxs("div",{className:"flex h-full items-center gap-2",children:[p&&s.jsx(we,{className:"icon-md text-green-500","aria-label":o("com_ui_global_group")}),u&&s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"ghost",onClick:e=>e.stopPropagation(),className:"h-8 w-8 p-0 hover:bg-surface-hover","aria-label":o("com_ui_rename_prompt")+" "+e.name,children:s.jsx(sn,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),s.jsx(Ud,{showCloseButton:!1,title:o("com_ui_rename_prompt"),className:"w-11/12 max-w-lg",main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(cl,{value:l,onChange:e=>c(e.target.value),className:"w-full","aria-label":o("com_ui_rename_prompt")+" "+e.name})})}),selection:{selectHandler:x,selectClasses:"bg-surface-submit hover:bg-surface-submit-hover text-white disabled:hover:bg-surface-submit",selectText:o("com_ui_save"),isLoading:g}})]}),m&&s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:e=>e.stopPropagation(),"aria-label":o("com_ui_delete_prompt")+" "+e.name,children:s.jsx(Sc,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),s.jsx(Ud,{showCloseButton:!1,title:o("com_ui_delete_prompt"),className:"w-11/12 max-w-lg",main:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(ul,{htmlFor:"confirm-delete",className:"text-left text-sm font-medium",children:[o("com_ui_delete_confirm")," ",s.jsx("strong",{children:e.name})]})})}),selection:{selectHandler:b,selectClasses:"bg-red-600 dark:bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:o("com_ui_delete")}})]})]})]})})})),kA=({currentIndex:e,totalCount:t,onPrevious:n,onNext:a})=>t<=1?null:s.jsxs("div",{className:"flex items-center justify-start gap-1 self-center bg-gray-700 pb-2 text-xs",children:[s.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:n,disabled:0===e,children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})})}),s.jsxs("span",{className:"flex-shrink-0 tabular-nums",children:[e+1," / ",t]}),s.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:a,disabled:e===t-1,children:s.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})})]});function SA({isOpen:e,onOpenChange:t,src:a="",downloadImage:r,args:o}){const i=Uk(),[l,c]=n.useState(!1),[d,u]=n.useState(null),[m,p]=n.useState(1),[f,h]=n.useState(0),[g,x]=n.useState(0),[v,b]=n.useState(!1),[_,y]=n.useState({x:0,y:0}),j=n.useRef(null),w=n.useCallback((async e=>{try{const t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(t){const e=parseInt(t,10);return N(e)}const n=await fetch(e),s=await n.blob();return N(s.size)}catch(t){return console.error("Error getting image size:",t),null}}),[]),N=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},C=n.useCallback((()=>{p(1),h(0),x(0)}),[]),k=n.useCallback((()=>{m>1?C():p(2)}),[m,C]),S=n.useCallback((e=>{if(e.preventDefault(),!j.current)return;const t=j.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,a=e.deltaY>0?.9:1.1,r=Math.min(Math.max(m*a,1),5);if(r===m)return;if(1===r)return p(1),h(0),void x(0);const o=t.width/2,i=t.height/2,l=r/m,c=(n-o-f)*(l-1),d=(s-i-g)*(l-1);p(r),h(f-c),x(g-d)}),[m,f,g]),T=n.useCallback((e=>{e.preventDefault(),m<=1||(b(!0),y({x:e.clientX-f,y:e.clientY-g}))}),[m,f,g]),E=n.useCallback((e=>{if(!v||m<=1)return;const t=e.clientX-_.x,n=e.clientY-_.y;h(t),x(n)}),[v,_,m]),R=n.useCallback((()=>{b(!1)}),[]);return n.useEffect((()=>{const e=e=>"Escape"===e.key&&C();return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[C]),n.useEffect((()=>{e&&a&&(w(a).then(u),C())}),[e,a,w,C]),n.useEffect((()=>{1===m&&(h(0),x(0))}),[m]),n.useEffect((()=>{1===m&&(h(0),x(0))}),[l,m]),s.jsx(ml,{open:e,onOpenChange:t,children:s.jsxs(xl,{showCloseButton:!1,className:"h-full w-full rounded-none bg-transparent",disableScroll:!1,overlayClassName:"bg-surface-primary opacity-95 z-50",children:[s.jsxs("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] absolute left-0 top-0 z-10 flex items-center justify-between p-3 transition-all duration-500 sm:p-4 "+(l?"right-0 sm:right-80":"right-0"),children:[s.jsx(Dl,{description:i("com_ui_close"),render:s.jsx(Si,{onClick:()=>t(!1),variant:"ghost",className:"h-10 w-10 p-0 hover:bg-surface-hover",children:s.jsx(vt,{className:"size-7 sm:size-6"})})}),s.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[m>1&&s.jsx(Dl,{description:i("com_ui_reset_zoom"),render:s.jsx(Si,{onClick:C,variant:"ghost",className:"h-10 w-10 p-0",children:s.jsx(tn,{className:"size-6"})})}),s.jsx(Dl,{description:i("com_ui_download"),render:s.jsx(Si,{onClick:()=>r(),variant:"ghost",className:"h-10 w-10 p-0",children:s.jsx(an,{className:"size-6"})})}),s.jsx(Dl,{description:i(l?"com_ui_hide_image_details":"com_ui_show_image_details"),render:s.jsx(Si,{onClick:()=>c(!l),variant:"ghost",className:"h-10 w-10 p-0",children:l?s.jsx(rn,{className:"size-7 sm:size-6"}):s.jsx(on,{className:"size-7 sm:size-6"})})})]})]}),s.jsx("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] flex h-full transition-all duration-500 "+(l?"mr-0 sm:mr-80":"mr-0"),children:s.jsx("div",{ref:j,className:"flex flex-1 items-center justify-center px-2 pb-4 pt-16 sm:px-4 sm:pt-20",onWheel:S,onMouseDown:T,onMouseMove:E,onMouseUp:R,onMouseLeave:R,onDoubleClick:k,style:{cursor:m<=1?"default":v?"grabbing":"grab",overflow:m>1?"hidden":"visible",minHeight:0},children:s.jsx("div",{className:"flex items-center justify-center transition-transform duration-100 ease-out",style:{transform:`translate(${f}px, ${g}px) scale(${m})`,transformOrigin:"center center",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("img",{src:a,alt:"Image",className:"block object-contain",style:{maxHeight:"calc(100vh - 8rem)",maxWidth:l&&window.innerWidth>=640?"calc(100vw - 22rem)":"calc(100vw - 2rem)",width:"auto",height:"auto"}})})})}),s.jsx("div",{className:"sm:shadow-l-lg ease-[cubic-bezier(0.175,0.885,0.32,1.275)] fixed right-0 top-0 z-20 h-full w-full transform border-l border-border-light bg-surface-primary shadow-2xl backdrop-blur-sm transition-transform duration-500 sm:w-80 sm:rounded-l-2xl "+(l?"translate-x-0":"translate-x-full"),children:s.jsxs("div",{className:"h-full overflow-y-auto p-4 sm:p-6",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between sm:hidden",children:[s.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:i("com_ui_image_details")}),s.jsx(Si,{onClick:()=>c(!1),variant:"ghost",className:"h-12 w-12 p-0",children:s.jsx(vt,{className:"size-6"})})]}),s.jsxs("div",{className:"mb-4 hidden sm:block",children:[s.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:i("com_ui_image_details")}),s.jsx("div",{className:"mb-4 h-px bg-border-medium"})]}),s.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-medium text-text-primary",children:i("com_ui_prompt")}),s.jsx("div",{className:"rounded-md bg-surface-tertiary p-3",children:s.jsx("p",{className:"text-sm leading-relaxed text-text-primary",children:(null==o?void 0:o.prompt)||"No prompt available"})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"mb-3 text-sm font-medium text-text-primary",children:i("com_ui_generation_settings")}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_size"),":"]}),s.jsx("span",{className:"text-sm font-medium text-text-primary",children:(null==o?void 0:o.size)||"Unknown"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_quality"),":"]}),s.jsx("span",{className:"rounded px-2 py-1 text-xs font-medium capitalize "+(I=(null==o?void 0:o.quality)||"","high"===I?"bg-green-100 text-green-800":"low"===I?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:(null==o?void 0:o.quality)||"Standard"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm text-text-primary",children:[i("com_ui_file_size"),":"]}),s.jsx("span",{className:"text-sm font-medium text-text-primary",children:d||"Loading..."})]})]})]})]})]})})]})});var I}const TA=({imagePath:e,altText:t,height:a,width:r,placeholderDimensions:o,className:i,args:l})=>{const[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useRef(null),{width:f,height:h}=n.useMemo((()=>{var e,t;return r_({originalWidth:Number((null==(e=null==o?void 0:o.width)?void 0:e.split("px")[0])??r),originalHeight:Number((null==(t=null==o?void 0:o.height)?void 0:t.split("px")[0])??a),containerRef:p})}),[o,a,r]);return s.jsx("div",{ref:p,children:s.jsxs("div",{className:s_("relative mt-1 flex h-auto w-full max-w-lg items-center justify-center overflow-hidden rounded-lg border border-border-light text-text-secondary-alt shadow-md",i),children:[s.jsx("button",{type:"button","aria-label":`View ${t} in dialog`,onClick:()=>d(!0),className:"cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:s.jsx(ln.LazyLoadImage,{alt:t,onLoad:()=>m(!0),visibleByDefault:!0,className:s_("opacity-100 transition-opacity duration-100",u?"opacity-100":"opacity-0"),src:e,style:{width:`${f}`,height:"auto",color:"transparent",display:"block"},placeholder:s.jsx(Cl,{className:s_("h-auto w-full",`h-[${h}] w-[${f}]`),"aria-label":"Loading image","aria-busy":"true"})})}),u&&s.jsx(SA,{isOpen:c,onOpenChange:d,src:e,downloadImage:async()=>{try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch image: ${n.status}`);const s=await n.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=t||"image.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}catch(n){console.error("Download failed:",n);const s=document.createElement("a");s.href=e,s.download=t||"image.png",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},args:l})]})})},EA=({href:e,filename:t})=>{const{showToast:n}=$d(),{refetch:s}=((e="")=>mr([ex.fileDownload,e],(async()=>{if(!e)return void console.warn("No user ID provided for file download");const t=(await fx.getCodeOutputDownload(e)).data;return window.URL.createObjectURL(t)}),{enabled:!1,retry:!1}))(e);return{handleDownload:async e=>{e.preventDefault();try{const e=await s();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void n({status:"error",message:"Error downloading file"});const a=document.createElement("a");a.href=e.data,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e.data)}catch(a){console.error("Error downloading file:",a)}}}},RA=({href:e,filename:t,children:n})=>{const{handleDownload:a}=EA({href:e,filename:t});return s.jsx("a",{href:e,onClick:a,target:"_blank",rel:"noopener noreferrer",className:"!text-blue-400 visited:!text-purple-400 hover:underline",children:n})},IA=n.memo((({attachment:e})=>{var t;const[a,r]=n.useState(!1),{handleDownload:o}=EA({href:e.filepath??"",filename:e.filename??""}),i=null==(t=e.filename)?void 0:t.split(".").pop();return n.useEffect((()=>{const e=setTimeout((()=>r(!0)),50);return()=>clearTimeout(e)}),[]),e.filepath?s.jsx("div",{className:s_("file-attachment-container","transition-all duration-300 ease-out",a?"translate-y-0 opacity-100":"translate-y-2 opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx(wI,{file:e,onClick:o,overrideType:i,containerClassName:"max-w-fit",buttonClassName:"bg-surface-secondary hover:cursor-pointer hover:bg-surface-hover active:bg-surface-secondary focus:bg-surface-hover hover:border-border-heavy active:border-border-heavy"})}):null})),PA=n.memo((({attachment:e})=>{const[t,a]=n.useState(!1),{width:r,height:o,filepath:i=null}=e;return n.useEffect((()=>{a(!1);const e=setTimeout((()=>a(!0)),100);return()=>clearTimeout(e)}),[e]),s.jsx("div",{className:s_("image-attachment-container","transition-all duration-500 ease-out",t?"scale-100 opacity-100":"scale-[0.98] opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx(TA,{altText:e.filename||"attachment image",imagePath:i??"",height:o??0,width:r??0,className:"mb-4"})})}));function AA({attachments:e}){if(!e||0===e.length)return null;const t=[],n=[];return e.forEach((e=>{const{width:s,height:a,filepath:r=null}=e;!!e.filename&&(Pm.test(e.filename)&&null!=s&&null!=a&&null!=r)?n.push(e):e.type!==Jd.web_search&&t.push(e)})),s.jsxs(s.Fragment,{children:[t.length>0&&s.jsx("div",{className:"my-2 flex flex-wrap items-center gap-2.5",children:t.map(((e,t)=>e.filepath?s.jsx(IA,{attachment:e},`file-${t}`):null))}),n.length>0&&s.jsx("div",{className:"mb-2 flex flex-wrap items-center",children:n.map(((e,t)=>s.jsx(PA,{attachment:e},`image-${t}`)))})]})}function MA({progress:e,error:t,toolName:n="image_gen_oai"}){const a=Uk(),r=a(t?"com_ui_error":"image_edit_oai"===n?e>=1?"com_ui_image_edited":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_edit_editing_image":"com_ui_getting_started":e>=1?"com_ui_image_created":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_creating_image":"com_ui_getting_started");return s.jsx("div",{className:s_("progress-text-content pointer-events-none absolute left-0 top-0 inline-flex w-full items-center gap-2 overflow-visible whitespace-nowrap"),children:s.jsx("span",{className:"font-medium "+(e<1?"shimmer":""),children:r})})}function LA({initialProgress:e=.1,isSubmitting:t,toolName:a,args:r="",output:o,attachments:i}){var l,c;const[d,u]=n.useState(e),m=n.useRef(null),p="string"==typeof o&&o.toLowerCase().includes("error processing tool"),f=!t&&e<1||!0===p;let h,g,x,v="high";try{x="string"==typeof r?JSON.parse(r):r}catch(R){console.error("Error parsing args:",R),x={}}try{const e=x;if(e&&"string"==typeof e.size){const[t,n]=e.size.split("x").map((e=>parseInt(e,10)));isNaN(t)||isNaN(n)||(h=t,g=n)}else!e||"string"==typeof e.size&&e.size||(h=void 0,g=void 0);if(e&&"string"==typeof e.quality){const t=e.quality.toLowerCase();"low"!==t&&"medium"!==t&&"high"!==t||(v=t)}}catch(Fi){h=void 0,g=void 0}const b=null==i?void 0:i[0],{width:_,height:y,filepath:j=null,filename:w=""}=b||{};let N=h??_,C=g??y;void 0!==N&&void 0!==C||(N=1024,C=1024);const[k,S]=n.useState({width:"auto",height:"auto"}),T=n.useRef(null),E=n.useCallback((()=>{if(N&&C&&T.current){const e=r_({originalWidth:N,originalHeight:C,containerRef:T});S(e)}}),[N,C]);return n.useEffect((()=>{if(t){u(e),m.current&&clearInterval(m.current);let t=2e4;"low"===v?t=1e4:"high"===v&&(t=5e4);const n=Math.floor(.3*t),s=200,a=(Math.floor(Math.random()*n)+t)/s;let r=0;m.current=setInterval((()=>{if(r++,r>=a)clearInterval(m.current),u(.9);else{const e=r/a;let t;if(e<.8)t=Math.pow(e,1.1);else{const n=(e-.8)/.2;t=.8+.2*(1-Math.pow(1-n,2))}u(.1+.8*t)}}),s)}return()=>{m.current&&clearInterval(m.current)}}),[e,v]),n.useEffect((()=>{(e>=1||f)&&(u(e),m.current&&clearInterval(m.current))}),[e,f]),n.useEffect((()=>{E();const e=new ResizeObserver((()=>{E()}));return T.current&&e.observe(T.current),()=>{e.disconnect()}}),[E]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:s.jsx(MA,{progress:d,error:f,toolName:a})}),s.jsx("div",{className:"relative mb-2 flex w-full justify-start",children:s.jsxs("div",{ref:T,className:"w-full max-w-lg",children:["auto"!==k.width&&d<1&&s.jsx(_d,{variant:"default",progress:d,randomness:.6,width:k.width,height:k.height}),s.jsx(TA,{altText:w,imagePath:j??"",width:Number(null==(l=k.width)?void 0:l.split("px")[0]),height:Number(null==(c=k.height)?void 0:c.split("px")[0]),placeholderDimensions:{width:k.width,height:k.height},args:x})]})})]})}class OA extends S.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Markdown rendering error:",e,t)}componentDidUpdate(e){e.content!==this.props.content&&this.state.hasError&&this.setState({hasError:!1,error:void 0})}render(){if(this.state.hasError){const{content:e,codeExecution:t=!0}=this.props,n=[[Zo,{detect:!0,ignoreMissing:!0,subset:wb}]];return s.jsx(kS,{children:s.jsx(Xo,{remarkPlugins:[Jo,ei],rehypePlugins:n,components:{code:t?IM:PM,a:AM,p:MM},children:e})})}return this.props.children}}const DA=n.memo((({content:e="",codeExecution:t=!0})=>{const n=[[ti],[Zo,{detect:!0,ignoreMissing:!0,subset:wb}]];return s.jsx(OA,{content:e,codeExecution:t,children:s.jsx(NS,{children:s.jsx(kS,{children:s.jsx(Xo,{remarkPlugins:[Jo,ei,[ni,{singleDollarTextMath:!1}]],rehypePlugins:n,components:{code:t?IM:PM,a:AM,p:MM},children:e})})})})}));function FA(e){return`https://www.google.com/s2/favicons?domain=${e}&sz=32`}function zA(e){const t=e.replace(/(^\w+:|^)\/\//,"").split("/")[0];return t.startsWith("www.")?t.substring(4):t}function UA({domain:e,className:t=""}){return s.jsxs("div",{className:s_("relative size-4 flex-shrink-0 overflow-hidden rounded-full",t),children:[s.jsx("div",{className:"absolute inset-0 rounded-full bg-white"}),s.jsx("img",{src:FA(e),alt:e,className:"relative size-full"}),s.jsx("div",{className:"border-border-light/10 absolute inset-0 rounded-full border dark:border-transparent"})]})}function VA({source:e,label:t,onMouseEnter:n,onMouseLeave:a,onClick:r,isFile:o=!1,isLocalFile:i=!1,children:l}){const c=Uk(),d=zA(e.link||"");return s.jsx("span",{className:"relative ml-0.5 inline-block",children:s.jsx(zt,{showTimeout:150,hideTimeout:150,children:s.jsxs("span",{className:"flex items-center",children:[s.jsx(Ut,{render:o?s.jsx("button",{onClick:r,className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium text-blue-600 no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:text-blue-400 dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,title:i?c("com_sources_download_local_unavailable"):void 0,children:t}):s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,children:t})}),s.jsxs($t,{className:"ml-0.5 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(Bt,{children:c("com_citation_more_details",{label:t})}),s.jsx(Pt,{className:"icon-sm"})]}),s.jsxs(Ht,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:[l,!l&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"mb-2 flex items-center",children:[o?s.jsx("div",{className:"mr-2 flex h-4 w-4 items-center justify-center",children:s.jsx(cn,{className:"h-3 w-3 text-text-secondary"})}):s.jsx(UA,{domain:d,className:"mr-2"}),o?s.jsx("button",{onClick:r,className:"line-clamp-2 cursor-pointer overflow-hidden text-left text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||e.title||c("com_file_source")}):s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||d})]}),o?s.jsx(s.Fragment,{children:e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})}):s.jsxs(s.Fragment,{children:[s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]})]})]})]})})})}const BA=n.createContext({hoveredCitationId:null,setHoveredCitationId:()=>{}}),$A={search:"organic",ref:"references",news:"topStories",file:"references"};function HA(e){var t;const a=Uk(),{citations:r,citationId:o}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:i}=n.useContext(BA),[l,c]=n.useState(0),d=function(e){const{searchResults:t}=RS(),n=[];for(const{turn:s,refType:a,index:r}of e){const e=$A[a.toLowerCase()]?$A[a.toLowerCase()]:a;if(!t||!t[s]||!t[s][e])continue;const o=t[s][e][r];o&&n.push({...o,turn:s,refType:a.toLowerCase(),index:r,link:o.link??"",title:o.title??"",snippet:o.snippet??"",attribution:o.attribution??""})}return n}(r||[]);if(!d||0===d.length)return null;const u=d.length,m=null==d?void 0:d[l];return s.jsxs(VA,{source:m,label:(()=>{if(!d||0===d.length)return a("com_citation_source");const e=d[0],t=d.length-1,n=e.attribution||e.title||zA(e.link||"")||a("com_citation_source");return t>0?`${n} +${t}`:n})(),onMouseEnter:()=>i(o||null),onMouseLeave:()=>i(null),children:[u>1&&s.jsxs("span",{className:"mb-2 flex items-center justify-between border-b border-border-heavy pb-2",children:[s.jsxs("span",{className:"flex gap-2",children:[s.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),l>0&&c(l-1)},disabled:0===l,style:{opacity:0===l?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:"←"}),s.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),l<u-1&&c(l+1)},disabled:l===u-1,style:{opacity:l===u-1?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:"→"})]}),s.jsxs("span",{className:"text-xs text-text-tertiary",children:[l+1,"/",u]})]}),s.jsxs("span",{className:"mb-2 flex items-center",children:[s.jsx(UA,{domain:zA(m.link||""),className:"mr-2"}),s.jsx("a",{href:m.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:m.attribution})]}),s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:m.title}),s.jsx("p",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:m.snippet})]})}function GA(e){var t,a;const r=Uk(),o=Ae(Cy.user),{showToast:i}=$d(),{citation:l,citationId:c}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:d}=n.useContext(BA),u=function({turn:e,index:t,refType:n}){const{searchResults:s}=RS();if(!n)return;const a=$A[n.toLowerCase()]?$A[n.toLowerCase()]:n;if(!s||!s[e]||!s[e][a])return;const r=s[e][a][t];return r?{...r,turn:e,refType:n.toLowerCase(),index:t,link:r.link??"",title:r.title??"",snippet:r.snippet??"",attribution:r.attribution??""}:void 0}({turn:(null==l?void 0:l.turn)||0,refType:null==l?void 0:l.refType,index:(null==l?void 0:l.index)||0}),m="file"===(null==u?void 0:u.refType)&&(null==u?void 0:u.fileId),p=m&&"local"===(null==(a=null==u?void 0:u.metadata)?void 0:a.storageType),{refetch:f}=Zy((null==o?void 0:o.id)??"",m&&!p?u.fileId:""),h=n.useCallback((async e=>{if(e.preventDefault(),e.stopPropagation(),m&&(null==u?void 0:u.fileId))if(p)i({status:"error",message:r("com_sources_download_local_unavailable")});else try{const e=await f();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void i({status:"error",message:r("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",u.fileName||"file"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t),i({status:"error",message:r("com_ui_download_error")})}}),[f,m,p,u,r,i]);if(!u)return null;return s.jsx(VA,{source:u,label:u.attribution||u.title||zA(u.link||"")||r("com_citation_source"),onMouseEnter:()=>d(c||null),onMouseLeave:()=>d(null),onClick:m&&!p?h:void 0,isFile:m,isLocalFile:p})}const KA=n.memo((function({children:e,citationId:t}){const a=function(e){const{hoveredCitationId:t}=n.useContext(BA);return e&&t===e}(t);return s.jsx("span",{className:"rounded px-0 py-0.5 transition-colors "+(a?"bg-amber-300/20":""),children:e})})),WA=({artifact:e})=>{const t=Uk(),a=De(),r=Pe(Cy.artifactsVisibility),[o,i]=Ie(Cy.artifactsState),l=Pe(Cy.currentArtifactId),c=Oe(Cy.currentArtifactId),[d,u]=Ie(Cy.visibleArtifacts),m=n.useRef(ko((e=>{a_.log("artifacts_visibility","Setting artifact to visible state from Artifact button",e),u((t=>({...t,[e.id]:e})))}),750));if(n.useEffect((()=>{if(null==e||null==(null==e?void 0:e.id)||""===e.id)return;if(!a.pathname.includes("/c/"))return;const t=m.current;return t(e),()=>{t.cancel()}}),[e,a.pathname]),null==e)return null;const p=Lv("artifact");return s.jsxs("div",{className:"group relative my-4 rounded-xl text-sm text-text-primary",children:[s.jsx("button",{type:"button",onClick:()=>{a.pathname.includes("/c/")&&(c(),r(!0),null==(null==o?void 0:o[e.id])&&i(d),setTimeout((()=>{l(e.id)}),15))},className:"relative overflow-hidden rounded-xl border border-border-medium transition-all duration-300 hover:border-border-xheavy hover:shadow-lg",children:s.jsx("div",{className:"w-fit bg-surface-tertiary p-2",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[s.jsx(yI,{fileType:p,className:"relative"}),s.jsxs("div",{className:"overflow-hidden text-left",children:[s.jsx("div",{className:"truncate font-medium",children:e.title}),s.jsx("div",{className:"truncate text-text-secondary",children:t("com_ui_artifact_click")})]})]})})}),s.jsx("br",{})]})},qA=()=>e=>{dn(e,["textDirective","leafDirective","containerDirective"],((e,t,n)=>{if("textDirective"===e.type){const s=`:${e.name}`;n&&Array.isArray(n.children)&&"number"==typeof t&&(n.children[t]={type:"text",value:s})}if("artifact"===e.name)return e.data={hName:e.name,hProperties:e.attributes,...e.data},e}))},QA="untitled",YA="unknown",XA="lc-no-identifier";function ZA({node:e,...t}){const a=De(),{messageId:r}=hS(),{getNextIndex:o,resetCounter:i}=n.useContext(wS),l=n.useRef(o(!1)).current,c=Pe(__),[d,u]=n.useState(null),m=n.useRef(To((e=>{e()}),25)),p=n.useCallback((()=>{const e=v_(t.children);a_.log("artifacts","updateArtifact: content.length",e.length);const n=t.title??QA,s=t.type??YA,o=t.identifier??XA,i=`${o}_${s}_${n}_${r}`.replace(/\s+/g,"_").toLowerCase();m.current((()=>{const t=Date.now();if(i===`${XA}_${YA}_${QA}_${r}`)return;const d={id:i,identifier:o,title:n,type:s,content:e,messageId:r,index:l,lastUpdateTime:t};if(!a.pathname.includes("/c/"))return u(d);c((t=>{var n;return null!=(null==t?void 0:t[i])&&(null==(n=t[i])?void 0:n.content)===e?t:{...t,[i]:d}})),u(d)}))}),[t.type,t.title,c,t.children,t.identifier,r,l,a.pathname]);return n.useEffect((()=>{i(),p()}),[p,i]),s.jsx(WA,{artifact:d})}function JA(e,t){const n=e.substring(0,t),s=n.lastIndexOf("\\ue200"),a=n.lastIndexOf("\\ue201");return-1===s||-1!==a&&a>s}function eM(e,t){XT.lastIndex=t,ZT.lastIndex=t,JT.lastIndex=t;const n=XT.exec(e),s=ZT.exec(e);let a,r=null;for(JT.lastIndex=t;!r&&null!==(a=JT.exec(e));)JA(e,a.index)&&(r=a);let o=null,i="",l=-1,c=-1;return n&&(!o||n.index<l||-1===l)&&(o=n,i="span",l=n.index,c=0),s&&(!o||s.index<l||-1===l)&&(o=s,i="composite",l=s.index,c=0),r&&(!o||r.index<l||-1===l)&&(o=r,i="standalone",l=r.index,c=0),o?{type:i,match:o,index:c}:null}function tM(){return e=>{!function(e){dn(e,"text",((e,t,n)=>{var s;const a=e,r=n;if("string"!=typeof a.value)return;const o=a.value,i=[];let l=0;const c=new Map,d={span:0,composite:0,standalone:0};for(;l<o.length;){const e=eM(o,l);if(!e){const e=o.substring(l).replace(eE,"");e&&i.push({type:"text",value:e});break}const{type:t,match:n}=e,s=n.index,a=n[0];if(s>l){const e=o.substring(l,s).replace(eE,"");e&&i.push({type:"text",value:e})}const r=`${t}-${d[t]}-${s}`;switch(c.set(s,r),t){case"span":{const e=a.replace(/\\ue203|\\ue204/g,"");let t=null;const n=s+a.length,r=eM(o,n);if(r&&("standalone"===r.type||"composite"===r.type)&&r.match.index-n<5){const e=r.match.index,n=r.type;t=`${n}-${d[n]}-${e}`}i.push({type:"highlighted-text",data:{hName:"highlighted-text",hProperties:{citationId:t}},children:[{type:"text",value:e}]}),d.span++;break}case"composite":{const e=a,t=new RegExp(JT.source,"g");let n;const s=[];for(;null!==(n=t.exec(e));){const e=Number(n[1]),t=n[2],a=Number(n[3]);s.push({turn:e,refType:t,index:a})}s.length>0&&i.push({type:"composite-citation",data:{hName:"composite-citation",hProperties:{citations:s,citationId:r}}}),d.composite++;break}case"standalone":{const e=Number(n[1]),t=n[2],s=Number(n[3]);i.push({type:"citation",data:{hName:"citation",hProperties:{citation:{turn:e,refType:t,index:s},citationType:"standalone",citationId:r}}}),d.standalone++;break}}l=s+a.length}if(i.length>0&&void 0!==t)return null==(s=r.children)||s.splice(t,1,...i),t+i.length;a.value!==a.value.replace(eE,"")&&(a.value=a.value.replace(eE,""))}))}(e)}}const nM=n.memo((({content:e="",isLatestMessage:t})=>{const a=Ae(Cy.LaTeXParsing),r=""===e,o=n.useMemo((()=>r?"":a?Wv(e):e),[e,a,r]),i=n.useMemo((()=>[[ti],[Zo,{detect:!0,ignoreMissing:!0,subset:wb}]]),[]),l=[Jo,ei,si,qA,[ni,{singleDollarTextMath:!1}],tM];return r?s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"relative",children:s.jsx("span",{className:t?"result-thinking":""})})}):s.jsx(OA,{content:e,codeExecution:!0,children:s.jsx(NS,{children:s.jsx(kS,{children:s.jsx(Xo,{remarkPlugins:l,rehypePlugins:i,components:{code:IM,a:AM,p:MM,artifact:ZA,citation:GA,"highlighted-text":KA,"composite-citation":HA},children:o})})})})})),sM=n.memo((({text:e,isCreatedByUser:t,showCursor:a})=>{const{isSubmitting:r=!1,isLatestMessage:o=!1}=hS(),i=Ae(Cy.enableUserMsgMarkdown),l=n.useMemo((()=>a&&r),[a,r]),c=n.useMemo((()=>t?i?s.jsx(DA,{content:e}):s.jsx(s.Fragment,{children:e}):s.jsx(nM,{content:e,isLatestMessage:o})),[t,i,e,o]);return s.jsx("div",{className:s_(r?"submitting":"",l&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!i&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:c})})),aM="group mt-3 flex w-fit items-center justify-center rounded-xl bg-surface-tertiary px-3 py-2 text-xs leading-[18px] animate-thinking-appear",rM="icon-sm ml-1.5 transform-gpu text-text-primary transition-transform duration-200",oM="relative pl-3 text-text-secondary",iM="absolute left-0 h-[calc(100%-10px)] border-l-2 border-border-medium dark:border-border-heavy",lM="absolute left-0 h-[calc(100%)] border-l-2 border-border-medium dark:border-border-heavy",cM="whitespace-pre-wrap leading-[26px]",dM=n.memo((({isPart:e,children:t})=>s.jsxs("div",{className:oM,children:[s.jsx("div",{className:!0===e?lM:iM}),s.jsx("p",{className:cM,children:t})]}))),uM=n.memo((({isExpanded:e,onClick:t,label:n})=>s.jsxs("button",{type:"button",onClick:t,className:aM,children:[s.jsx(un,{size:14,className:"mr-1.5 text-text-secondary"}),n,s.jsx(Pt,{className:`${rM} ${e?"rotate-180":""}`})]}))),mM=n.memo((({children:e})=>{const t=Uk(),a=Ae(Cy.showThinking),[r,o]=n.useState(a),i=n.useCallback((e=>{e.preventDefault(),o((e=>!e))}),[]),l=n.useMemo((()=>t("com_ui_thoughts")),[t]);return null==e?null:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-5",children:s.jsx(uM,{isExpanded:r,onClick:i,label:l})}),s.jsx("div",{className:s_("grid transition-all duration-300 ease-out",r&&"mb-8"),style:{gridTemplateRows:r?"1fr":"0fr"},children:s.jsx("div",{className:"overflow-hidden",children:s.jsx(dM,{isPart:!0,children:e})})})]})}));uM.displayName="ThinkingButton",dM.displayName="ThinkingContent",mM.displayName="Thinking";const pM=n.memo(mM),fM=n.memo((({reasoning:e})=>{const{isExpanded:t,nextType:a}=hS(),r=n.useMemo((()=>e.replace(/^<think>\s*/,"").replace(/\s*<\/think>$/,"").trim()),[e]);return r?s.jsx("div",{className:s_("grid transition-all duration-300 ease-out",a!==hh.THINK&&t&&"mb-8"),style:{gridTemplateRows:t?"1fr":"0fr"},children:s.jsx("div",{className:"overflow-hidden",children:s.jsx(dM,{isPart:!0,children:r})})}):null})),hM=n.memo((()=>s.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:s.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"submitting relative",children:s.jsx("span",{className:"result-thinking"})})})})}))),gM=({output:e="",renderImages:t,attachments:a})=>{const r=Uk(),o=n.useMemo((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]),{imageAttachments:i,nonImageAttachments:l}=n.useMemo((()=>{const e=[],n=[];return null==a||a.forEach((t=>{const{width:s,height:a,filepath:r=null}=t;Pm.test(t.filename)&&null!=s&&null!=a&&null!=r?e.push(t):n.push(t)})),{imageAttachments:!0===t?e:null,nonImageAttachments:n}}),[a,t]),c=e=>{const t=new Date,n="number"==typeof e.expiresAt?new Date(e.expiresAt):null;return!!n&&zo(t,n)?`${e.filename} ${r("com_download_expired")}`:s.jsxs(RA,{href:e.filepath,filename:e.filename,children:["- ",e.filename," ",r("com_click_to_download")]})};return s.jsxs(s.Fragment,{children:[o&&s.jsx("div",{children:o}),l.length>0&&s.jsxs("div",{children:[s.jsx("p",{children:r("com_generated_files")}),l.map(((e,t)=>s.jsxs(S.Fragment,{children:[c(e),t<l.length-1&&", "]},e.filepath)))]}),null==i?void 0:i.map(((e,t)=>{const{width:n,height:a,filepath:r}=e;return s.jsx(TA,{altText:e.filename,imagePath:r,height:a,width:n},t)}))]})};function xM(){return s.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full bg-transparent text-text-secondary",children:s.jsx(vt,{className:"size-4"})})}function vM(){return s.jsx("div",{className:"flex size-4 items-center justify-center rounded-full bg-brand-purple text-white","data-projection-id":"162",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 8",fill:"none",width:"8",height:"8",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.66607 0.376042C8.01072 0.605806 8.10385 1.07146 7.87408 1.4161L3.54075 7.9161C3.40573 8.11863 3.18083 8.24304 2.93752 8.24979C2.69421 8.25654 2.46275 8.1448 2.31671 7.95008L0.150044 5.06119C-0.098484 4.72982 -0.0313267 4.25972 0.300044 4.01119C0.631415 3.76266 1.10152 3.82982 1.35004 4.16119L2.88068 6.20204L6.62601 0.584055C6.85577 0.239408 7.32142 0.146278 7.66607 0.376042Z",fill:"currentColor"})})})}const bM="progress-text-wrapper text-token-text-secondary relative -mt-[0.75px] h-5 w-full leading-5",_M=({popover:e,children:t})=>e?s.jsx("div",{className:bM,children:s.jsx(Wa,{asChild:!0,children:s.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})})}):s.jsx("div",{className:bM,children:s.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})});function yM({progress:e,onClick:t,inProgressText:n,finishedText:a,authText:r,hasInput:o=!0,popover:i=!1,isExpanded:l=!1,error:c=!1}){const d=c?a:e<1?r??n:a,u=c?s.jsx(xM,{}):e<1?s.jsx(rc,{}):s.jsx(vM,{}),m=e<1&&!c;return s.jsx(_M,{popover:i,children:s.jsxs("button",{type:"button",className:s_("inline-flex w-full items-center gap-2",o?"":"pointer-events-none"),disabled:!o,onClick:o?t:void 0,children:[u,s.jsx("span",{className:m?"shimmer":"",children:d}),o&&(l?s.jsx(mn,{className:"size-4 shrink-0 translate-y-[1px]"}):s.jsx(Pt,{className:"size-4 shrink-0 translate-y-[1px]"}))]})})}const jM=({output:e=""})=>{const t=n.useMemo((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]);return t&&s.jsx("pre",{className:"shrink-0",children:s.jsx("div",{className:"text-text-primary",children:t})})};function wM({isSubmitting:e,initialProgress:t=.1,args:a,output:r="",attachments:o}){const i=Uk(),l=r.length>0,c=n.useRef(r),d=n.useRef(null),[u,m]=n.useState(!1),p=Ae(Cy.showCode),[f,h]=n.useState(p),[g,x]=n.useState(0),v=n.useRef(f),{lang:b,code:_}=function(e){return n.useMemo((()=>{let t=e;try{t=JSON.parse(e||"")}catch{}if("object"==typeof t)return t;const n=null==e?void 0:e.match(/"lang"\s*:\s*"(\w+)"/),s=null==e?void 0:e.match(/"code"\s*:\s*"(.+?)(?="\s*,\s*"(session_id|args)"|"\s*})/s);let a="";return s&&(a=s[1],a.endsWith('"}')&&(a=a.slice(0,-2)),a=a.replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\\\/g,"\\")),{lang:n?n[1]:"",code:a}}),[e])}(a)??{},y=WT(t);n.useEffect((()=>{r!==c.current&&(c.current=r,f&&d.current&&setTimeout((()=>{if(d.current){const e=d.current.scrollHeight;x(e)}}),10))}),[r,f]),n.useEffect((()=>{if(f!==v.current)if(v.current=f,f&&d.current)m(!0),requestAnimationFrame((()=>{if(d.current){const e=d.current.scrollHeight;x(e)}const e=setTimeout((()=>{m(!1)}),500);return()=>clearTimeout(e)}));else if(!f){m(!0),x(0);const e=setTimeout((()=>{m(!1)}),500);return()=>clearTimeout(e)}}),[f]),n.useEffect((()=>{if(!d.current)return;const e=new ResizeObserver((e=>{if(f&&!u)for(const t of e)t.target===d.current&&x(t.contentRect.height)}));return e.observe(d.current),()=>{e.disconnect()}}),[f,u]);const j=!e&&y<1;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:s.jsx(yM,{progress:y,onClick:()=>h((e=>!e)),inProgressText:i("com_ui_analyzing"),finishedText:i(j?"com_ui_cancelled":"com_ui_analyzing_finished"),hasInput:!!(null==_?void 0:_.length),isExpanded:f,error:j})}),s.jsx("div",{className:"relative mb-2",style:{height:f?g:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:f?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsxs("div",{className:s_("code-analyze-block mt-0.5 overflow-hidden rounded-xl bg-surface-primary",f&&"shadow-lg"),ref:d,style:{transform:f?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:f?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:[f&&s.jsx("div",{style:{transform:f?"translateY(0)":"translateY(-4px)",opacity:f?1:0,transition:"transform 0.35s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.35s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx(DA,{content:_?`\`\`\`${b}\n${_}\n\`\`\``:"",codeExecution:!1})}),l&&s.jsx("div",{className:s_("bg-surface-tertiary p-4 text-xs",f?"border-t border-surface-primary-contrast":""),style:{transform:f?"translateY(0)":"translateY(-6px)",opacity:f?1:0,transition:"transform 0.45s cubic-bezier(0.16, 1, 0.3, 1) 0.05s, opacity 0.45s cubic-bezier(0.19, 1, 0.22, 1) 0.05s",boxShadow:f?"0 -1px 0 rgba(0,0,0,0.05)":"none"},children:s.jsx("div",{className:"prose flex flex-col-reverse",children:s.jsx(jM,{output:r})})})]})}),o&&o.length>0&&s.jsx(AA,{attachments:o})]})}const NM=({currentAgentId:e})=>{const t=Uk(),a=zk()||{},r=n.useMemo((()=>a[e]),[a,e]);return e?s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-6 flex h-full w-4 items-center justify-center",children:s.jsxs("div",{className:"relative h-full w-4",children:[s.jsx("div",{className:"absolute left-0 top-0 h-1/2 w-px border border-border-medium"}),s.jsx("div",{className:"absolute left-0 top-1/2 h-px w-3 border border-border-medium"})]})}),s.jsxs("div",{className:"my-4 flex items-center gap-2",children:[s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(TR,{message:{endpoint:Nu.agents,isCreatedByUser:!1},agent:r})}),s.jsx("div",{className:"text-base font-medium text-text-primary",children:(null==r?void 0:r.name)||t("com_ui_agent")})]})]}):null},CM=n.memo((({message:e})=>{const t=n.useMemo((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")})))||[]}),[null==e?void 0:e.files]),a=n.useMemo((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return!(!0===(null==(t=e.type)?void 0:t.startsWith("image/")))})))||[]}),[null==e?void 0:e.files]);return s.jsxs(s.Fragment,{children:[a.length>0&&a.map((e=>s.jsx(wI,{file:e},e.file_id))),t.length>0&&t.map((e=>s.jsx(TA,{imagePath:e.preview??e.filepath??"",height:e.height??1920,width:e.width??1080,altText:e.filename??"Uploaded Image",placeholderDimensions:{height:`${e.height??1920}px`,width:`${e.height??1080}px`}},e.file_id)))]})})),kM=({children:e,message:t})=>s.jsxs("div",{className:"text-message flex min-h-[20px] flex-col items-start gap-3 overflow-visible [.text-message+&]:mt-5",dir:"auto",children:[!0===(null==t?void 0:t.isCreatedByUser)&&s.jsx(CM,{message:t}),e]}),SM=({part:e,index:t,messageId:a,isSubmitting:r,enterEdit:o})=>{const i=Uk(),{addedIndex:l}=oS(),{conversation:c}=ZS(),{ask:d,getMessages:u,setMessages:m}=JS(),[p,f]=Ie(Cy.latestMessageFamily(l)),{conversationId:h=""}=c??{},g=n.useMemo((()=>{var e;return null==(e=u())?void 0:e.find((e=>e.messageId===a))}),[u,a]),x=Ae(Cy.chatDirection),v=n.useRef(null),b=function(e){var t=pr();return fr((function(e){return function(e){var t=e.conversationId,n=e.messageId,s=e.index,a=e.text;if(!t)throw new Error("conversationId is required");return YC.put(EN({conversationId:t,messageId:n}),{text:a,index:s})}(e)}),{onSuccess:function(){t.invalidateQueries([XC.messages,e])}})}(h??""),_="rtl"===(null==x?void 0:x.toLowerCase()),{register:y,handleSubmit:j,setValue:w}=Vo({defaultValues:{text:(hh.THINK in e?e.think:e.text)||""}});n.useEffect((()=>{const e=v.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const N=n.useCallback((e=>{"Escape"===e.key&&(e.preventDefault(),o(!0))}),[o]),{ref:C,...k}=y("text",{required:!0,onChange:e=>{w("text",e.target.value,{shouldValidate:!0})}});return s.jsxs(kM,{message:g,children:[s.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:s.jsx(Ll,{...k,ref:e=>{C(e),v.current=e},onKeyDown:N,"data-testid":"message-text-editor",className:s_("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",_?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",p_),dir:_?"rtl":"ltr"})}),s.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[s.jsx("button",{className:"btn btn-primary relative mr-2",disabled:r,onClick:j((n=>{const s=u(),r=null==s?void 0:s.find((e=>e.messageId===(null==g?void 0:g.parentMessageId))),i=e.type===hh.THINK?{index:t,type:hh.THINK,[hh.THINK]:n.text}:{index:t,type:hh.TEXT,[hh.TEXT]:n.text};r&&(d({...r},{editedContent:i,editedMessageId:a,isRegenerate:!0,isEdited:!0}),o(!0))})),children:i("com_ui_save_submit")}),s.jsx("button",{className:"btn btn-secondary relative mr-2",disabled:r,onClick:j((e=>{var n;const s=u();if(!s)return;b.mutate({index:t,conversationId:h??"",text:e.text,messageId:a}),a===(null==p?void 0:p.messageId)&&f({...p,text:e.text});if(!s.some((e=>e.messageId===a)))return o(!0);const r=null==(n=null==g?void 0:g.content)?void 0:n.map(((n,s)=>n.type===hh.TEXT&&s===t?{...n,text:e.text}:n));m(s.map((e=>e.messageId===a?{...e,content:r}:e))),o(!0)})),children:i("com_ui_save")}),s.jsx("button",{className:"btn btn-neutral relative",onClick:()=>o(!0),children:i("com_ui_cancel")})]})]})},TM=S.memo((({lang:e,codeRef:t,blockIndex:a})=>{const r=Uk(),{showToast:o}=$d(),i=((e,t)=>{const n=pr();return fr((t=>fx.callTool({toolId:e,toolParams:t})),{onMutate:e=>{var n;return null==(n=null==t?void 0:t.onMutate)?void 0:n.call(t,e)},onError:(e,n,s)=>{var a;return null==(a=null==t?void 0:t.onError)?void 0:a.call(t,e,n,s)},onSuccess:(e,s,a)=>{var r;return n.setQueryData([ex.toolCalls,s.conversationId],(t=>[...t??[],{user:"",toolId:Jd.execute_code,partIndex:s.partIndex,messageId:s.messageId,blockIndex:s.blockIndex,conversationId:s.conversationId,result:e.result,attachments:e.attachments}])),null==(r=null==t?void 0:t.onSuccess)?void 0:r.call(t,e,s,a)}})})(Jd.execute_code,{onError:()=>{o({message:r("com_ui_run_code_error"),status:"error"})}}),{messageId:l,conversationId:c,partIndex:d}=hS(),u=n.useMemo((()=>function(e){const t=e.toLowerCase().trim(),n=Nb[t];return n||""}(e)),[e]),{data:m}=ij({toolId:Jd.execute_code},{retry:1}),p=n.useMemo((()=>(null==m?void 0:m.message)??!1),[null==m?void 0:m.message]),f=n.useMemo((()=>(null==m?void 0:m.authenticated)??!1),[null==m?void 0:m.authenticated]),{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:v,handleRevokeApiKey:b}=uE({}),_=n.useCallback((async()=>{var e;if(!f)return void v(!0);const n=(null==(e=t.current)?void 0:e.textContent)??"";"string"==typeof n&&0!==n.length&&"string"==typeof u&&0!==u.length&&i.mutate({partIndex:d,messageId:l,blockIndex:a,conversationId:c??"",lang:u,code:n})}),[t,i,d,l,a,c,u,v,f]),y=n.useMemo((()=>ko(_,1e3,{leading:!0})),[_]);return n.useEffect((()=>()=>{y.cancel()}),[y]),"string"!=typeof u||0===u.length?null:s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:s_("ml-auto flex gap-2"),onClick:y,disabled:i.isLoading,children:[i.isLoading?s.jsx(rc,{className:"animate-spin",size:18}):s.jsx(Ve,{size:18}),r("com_ui_run_code")]}),s.jsx(FI,{onSubmit:g,isOpen:x,register:h.register,onRevoke:b,onOpenChange:v,handleSubmit:h.handleSubmit,isToolAuthenticated:f,isUserProvided:p===vu.USER_PROVIDED})]})})),EM=S.memo((({lang:e,error:t,codeRef:a,blockIndex:r,plugin:o=null,allowExecution:i=!0})=>{const l=Uk(),[c,d]=n.useState(!1);return s.jsxs("div",{className:"relative flex items-center justify-between rounded-tl-md rounded-tr-md bg-gray-700 px-4 py-2 font-sans text-xs text-gray-200 dark:bg-gray-700",children:[s.jsx("span",{className:"",children:e}),!0===o?s.jsx(pn,{className:"ml-auto flex h-4 w-4 gap-2 text-white/50"}):s.jsxs("div",{className:"flex items-center justify-center gap-4",children:[!0===i&&s.jsx(TM,{lang:e,codeRef:a,blockIndex:r}),s.jsx("button",{type:"button",className:s_("ml-auto flex gap-2",!0===t?"h-4 w-4 items-start text-white/50":""),onClick:async()=>{var e;const t=null==(e=a.current)?void 0:e.textContent;null!=t&&(d(!0),ot(t.trim(),{format:"text/plain"}),setTimeout((()=>{d(!1)}),3e3))},children:c?s.jsxs(s.Fragment,{children:[s.jsx(ic,{className:"h-[18px] w-[18px]"}),!0===t?"":l("com_ui_copied")]}):s.jsxs(s.Fragment,{children:[s.jsx(oc,{}),!0===t?"":l("com_ui_copy_code")]})})]})]})})),RM=({lang:e,blockIndex:t,codeChildren:a,classProp:r="",allowExecution:o=!0,plugin:i=null,error:l})=>{const c=n.useRef(null),d=n.useContext(SS),{messageId:u,partIndex:m}=hS(),p=o?`${u}_${m??0}_${t??0}_${Jd.execute_code}`:"",[f,h]=n.useState(0),g=null==d?void 0:d[p],[x,v]=n.useState((null==d?void 0:d[p])??null);n.useEffect((()=>{g&&(v(g),h(g.length-1))}),[g]);const b=n.useMemo((()=>null==x?void 0:x[f]),[x,f]),_=!(!0!==i&&!0!==l),y=_?"json":e;return s.jsxs("div",{className:"w-full rounded-md bg-gray-900 text-xs text-white/80",children:[s.jsx(EM,{lang:e,error:l,codeRef:c,blockIndex:t,plugin:!0===i,allowExecution:o}),s.jsx("div",{className:s_(r,"overflow-y-auto p-4"),children:s.jsx("code",{ref:c,className:s_(_?"!whitespace-pre-wrap":`hljs language-${y} !whitespace-pre`),children:a})}),!0===o&&x&&x.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-gray-700 p-4 text-xs",children:s.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:s.jsx("pre",{className:"shrink-0",children:s.jsx(gM,{output:(null==b?void 0:b.result)??"",attachments:(null==b?void 0:b.attachments)??[],renderImages:!0})})})}),x.length>1&&s.jsx(kA,{currentIndex:f,totalCount:x.length,onPrevious:()=>{f>0&&h(f-1)},onNext:()=>{x&&f<x.length-1&&h(f+1)}})]})]})},IM=n.memo((({className:e,children:t})=>{const a=Qk({permissionType:Zh.RUN_CODE,permission:Jh.USE}),r=/language-(\w+)/.exec(e??""),o=r&&r[1],i="math"===o,l="string"==typeof t&&1===t.split("\n").length,{getNextIndex:c,resetCounter:d}=n.useContext(CS),u=n.useRef(c(i||l)).current;return n.useEffect((()=>{d()}),[t,d]),i?s.jsx(s.Fragment,{children:t}):l?s.jsx("code",{onDoubleClick:x_,className:e,children:t}):s.jsx(RM,{lang:o??"text",codeChildren:t,blockIndex:u,allowExecution:a})})),PM=n.memo((({className:e,children:t})=>{const n=/language-(\w+)/.exec(e??""),a=n&&n[1];return"math"===a?t:"string"==typeof t&&1===t.split("\n").length?s.jsx("code",{onDoubleClick:x_,className:e,children:t}):s.jsx(RM,{lang:a??"text",codeChildren:t,allowExecution:!1})})),AM=n.memo((({href:e,children:t})=>{const a=Ae(Cy.user),{showToast:r}=$d(),o=Uk(),{file_id:i="",filename:l="",filepath:c}=n.useMemo((()=>{const t=new RegExp(`(?:files|outputs)/${null==a?void 0:a.id}/([^\\s]+)`),n=e.match(t);if(n&&n[0]){const e=n[0],t=e.split("/"),s=t.pop();return{file_id:t.pop(),filename:s,filepath:e}}return{file_id:"",filename:"",filepath:""}}),[null==a?void 0:a.id,e]),{refetch:d}=Zy((null==a?void 0:a.id)??"",i),u={target:"_new"};if(!i||!l)return s.jsx("a",{href:e,...u,children:t});u.onClick=async e=>{e.preventDefault();try{const e=await d();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void r({status:"error",message:o("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",l),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t)}},u.target="_blank";const m=fx.getDomainServerBaseUrl();return s.jsx("a",{href:(null==c?void 0:c.startsWith("files/"))?`${m}/${c}`:`${m}/files/${c}`,...u,children:t})})),MM=n.memo((({children:e})=>s.jsx("p",{className:"mb-2 whitespace-pre-wrap",children:e}))),LM=/{{(.*?)}}/g,OM=({children:e})=>s.jsx("p",{children:S.Children.map(e,(e=>(e=>"object"==typeof e&&null!==e||"string"!=typeof e?e:e.split(LM).map(((e,t)=>t%2==1?s.jsx("b",{className:"ml-[0.5] rounded-lg bg-amber-100 p-[1px] font-medium text-yellow-800 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90",children:`{{${e}}}`},t):e)))(e)))}),DM=e=>{const t=e.trim();if(t.includes(":")){const[e,n]=t.split(":");if(n&&n.includes("|"))return{variable:e.trim(),type:"select",options:n.split("|").map((e=>e.trim()))}}return{variable:t,type:"text"}};function FM({group:e,onClose:t}){var a;const r=Uk(),{user:o}=qk(),i=n.useMemo((()=>{var t;return Mh({text:(null==(t=e.productionPrompt)?void 0:t.prompt)??"",user:o})}),[null==(a=e.productionPrompt)?void 0:a.prompt,o]),{allVariables:l,uniqueVariables:c,variableIndexMap:d}=n.useMemo((()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=[],a=[],r=new Set,o=new Map,i=new Map;for(;null!==(n=t.exec(e));){const e=n[1];s.push(e);const t=o.get(e)??0;o.set(e,t+1),t>0?r.add(e):(a.push(e),i.set(e,a.length-1))}return{allVariables:s,uniqueVariables:a,repeatedVariables:r,variableIndexMap:i}})(i)),[i]),{submitPrompt:u}=YT(),{control:m,handleSubmit:p}=Vo({defaultValues:{fields:c.map((e=>({variable:fb(e),value:"",config:DM(e)})))}}),{fields:f}=Go({control:m,name:"fields"}),h=Ho({control:m,name:"fields"});if(!c.length)return null;return s.jsx("div",{className:"mx-auto p-1 md:container",children:s.jsxs("form",{onSubmit:p((e=>{let n=i;e.fields.forEach((({variable:e,value:t})=>{if(!t)return;const s=e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),a=new RegExp(s,"g");n=n.replace(a,t)})),u(n),t()})),className:"space-y-4",children:[s.jsx("div",{className:"mb-6 max-h-screen max-w-[90vw] overflow-auto rounded-md bg-surface-tertiary p-4 text-text-secondary dark:bg-surface-primary sm:max-w-full md:max-h-96",children:s.jsx(Xo,{remarkPlugins:[Jo,ei,[ni,{singleDollarTextMath:!1}]],rehypePlugins:[[ti],[Zo,{ignoreMissing:!0}]],components:{code:PM,p:OM},className:"markdown prose dark:prose-invert light my-1 max-h-[50vh] max-w-full break-words dark:text-text-secondary",children:(()=>{let e=i;return l.forEach((t=>{const n=`{{${t}}}`,s=d.get(t),a=h[s].value;if(a===n||""===a||!a)return;const r=""!==a?`**${a}**`:n;e=e.replaceAll(n,r)})),e})()})}),s.jsx("div",{className:"space-y-4",children:f.map(((e,t)=>s.jsx("div",{className:"flex flex-col space-y-2",children:s.jsx(Bo,{name:`fields.${t}.value`,control:m,render:({field:{onChange:n,onBlur:a,value:r,ref:o}})=>"select"===e.config.type?s.jsx(Nl,{options:e.config.options||[],placeholder:e.config.variable,className:s_(h_,"rounded px-3 py-2 focus:bg-surface-tertiary"),value:r,onChange:n,onBlur:a}):s.jsx(Ll,{ref:o,value:r,onChange:n,onBlur:a,id:`fields.${t}.value`,className:s_(h_,"rounded px-3 py-2 focus:bg-surface-tertiary"),placeholder:e.config.variable,maxRows:8})})},e.id)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx(Si,{type:"submit",variant:"submit",children:r("com_ui_submit")})})]})})}const zM=({open:e,onClose:t,group:a})=>{var r;const o=n.useMemo((()=>{var e;return pb((null==(e=null==a?void 0:a.productionPrompt)?void 0:e.prompt)??"")}),[null==(r=null==a?void 0:a.productionPrompt)?void 0:r.prompt]);return a&&o?s.jsx(ml,{open:e,onOpenChange:e=>{e||t()},children:s.jsxs(xl,{className:"max-h-[90vh] max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:max-w-[60vw]",children:[s.jsx(_l,{children:a.name}),s.jsx(FM,{group:a,onClose:t})]})}):null},UM={code:({children:e})=>s.jsx("code",{onDoubleClick:x_,className:"rounded-md bg-surface-primary-alt p-1 text-xs text-text-secondary md:text-sm",children:e})},VM=({promptText:e,showInfo:t=!0})=>{const a=Uk(),r=n.useMemo((()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=new Set;for(;null!==(n=t.exec(e));)s.add(n[1]);return Array.from(s)})(e||"")),[e]);return s.jsxs("div",{className:"rounded-xl border border-border-light bg-transparent p-4 shadow-md",children:[s.jsxs("h3",{className:"flex items-center gap-2 py-2 text-lg font-semibold text-text-primary",children:[s.jsx(fn,{className:"icon-sm","aria-hidden":"true"}),a("com_ui_variables")]}),s.jsxs("div",{className:"flex flex-col space-y-4",children:[r.length?s.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(((e,t)=>s.jsx("span",{className:s_("rounded-full border border-border-light px-3 py-1 text-text-primary",null!=bh[e.toLowerCase()]?"bg-amber-100 text-yellow-800 border-yellow-600 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90":""),children:null!=bh[e.toLowerCase()]?e.toLowerCase():e},t)))}):s.jsx("div",{className:"text-sm text-text-secondary",children:s.jsx(Xo,{components:UM,className:"markdown prose dark:prose-invert",children:a("com_ui_variables_info")})}),s.jsx(wl,{className:"my-3 text-text-primary"}),t&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-text-primary",children:a("com_ui_special_variables")}),s.jsx("span",{className:"text-sm text-text-secondary",children:s.jsx(Xo,{components:UM,className:"markdown prose dark:prose-invert",children:a("com_ui_special_variables_more_info")})})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium text-text-primary",children:a("com_ui_dropdown_variables")}),s.jsx("span",{className:"text-sm text-text-secondary",children:s.jsx(Xo,{components:UM,className:"markdown prose dark:prose-invert",children:a("com_ui_dropdown_variables_info")})})]})]})]})]})},BM=({initialValue:e,onValueChange:t,disabled:a,tabIndex:r})=>{const o=Uk(),[i,l]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect((()=>{l(e||""),d((null==e?void 0:e.length)||0)}),[e]),n.useEffect((()=>{d(i.length)}),[i]);return a&&!i?null:s.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:s.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[s.jsx(pn,{className:"icon-sm","aria-hidden":"true"}),s.jsx(cl,{type:"text",tabIndex:r,disabled:a,placeholder:o("com_ui_description_placeholder"),value:i,onChange:e=>{e.target.value.length<=120&&(l(e.target.value),null==t||t(e.target.value))},className:"border-none"}),!a&&s.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/120`})]})})},$M=({initialValue:e,onValueChange:t,disabled:a,tabIndex:r})=>{const o=Uk(),[i,l]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect((()=>{l(e||""),d((null==e?void 0:e.length)||0)}),[e]),n.useEffect((()=>{d(i.length)}),[i]);return!0!==a||i?s.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:s.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[s.jsx(hn,{className:"icon-sm","aria-hidden":"true"}),s.jsx(cl,{type:"text",tabIndex:r,disabled:a,placeholder:o("com_ui_command_placeholder"),value:i,onChange:e=>{let n=e.target.value.toLowerCase();n=n.replace(/\s/g,"-").replace(/[^a-z0-9-]/g,""),n.length<=dh.COMMANDS_MAX_LENGTH&&(l(n),null==t||t(n))},className:"border-none"}),!0!==a&&s.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/${dh.COMMANDS_MAX_LENGTH}`})]})}):null},HM=({group:e})=>{var t,a;const r=Uk(),{user:o}=qk(),i=n.useMemo((()=>{var t;return Mh({text:(null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt)??"",user:o})}),[null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt,o]);return e?s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col items-center justify-between p-4 text-text-primary sm:flex-row",children:s.jsx("div",{className:"mb-1 flex flex-row items-center font-bold sm:text-xl md:mb-0 md:text-2xl",children:s.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[s.jsx("div",{className:"rounded pr-2",children:((null==(a=e.category)?void 0:a.length)??0)>0?s.jsx(GS,{category:e.category??""}):null}),s.jsx(ul,{className:"text-2xl font-bold",children:e.name})]})})}),s.jsx("div",{className:"flex h-full max-h-screen flex-col overflow-y-auto md:flex-row",children:s.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-0 md:max-h-[calc(100vh-150px)] md:p-2",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-light py-2 pl-4 text-base font-semibold text-text-primary",children:r("com_ui_prompt_text")}),s.jsx("div",{className:"group relative min-h-32 rounded-b-lg border border-border-light p-4 transition-all duration-150",children:s.jsx(Xo,{remarkPlugins:[Jo,ei,[ni,{singleDollarTextMath:!1}]],rehypePlugins:[[ti],[Zo,{ignoreMissing:!0}]],components:{p:OM,code:PM},className:"markdown prose dark:prose-invert light dark:text-gray-70 my-1 break-words",children:i})})]}),s.jsx(VM,{promptText:i,showInfo:!1}),s.jsx(BM,{initialValue:e.oneliner,disabled:!0}),s.jsx($M,{initialValue:e.command,disabled:!0})]})})]}):null},GM=({group:e,open:t,onOpenChange:n})=>s.jsx(ml,{open:t,onOpenChange:n,children:s.jsx(xl,{className:"max-h-[90vh] w-11/12 max-w-full overflow-y-auto md:max-w-[60vw]",children:s.jsx("div",{className:"p-2",children:s.jsx(HM,{group:e})})})});function KM({category:e,name:t,snippet:n,onClick:a,children:r}){return s.jsxs("div",{onClick:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null==a||a(e))},className:"relative my-2 flex w-full cursor-pointer flex-col gap-2 rounded-xl border border-border-light px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-tertiary hover:shadow-lg",role:"button",tabIndex:0,"aria-labelledby":`card-title-${t}`,"aria-describedby":`card-snippet-${t}`,"aria-label":`Card for ${t}`,children:[s.jsxs("div",{className:"flex w-full justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-row gap-2",children:[s.jsx(GS,{category:e,className:"icon-md","aria-hidden":"true"}),s.jsx(ul,{id:`card-title-${t}`,className:"break-word select-none text-balance text-sm font-semibold text-text-primary",title:t,children:t})]}),s.jsx("div",{children:r})]}),s.jsx("div",{id:`card-snippet-${t}`,className:"ellipsis max-w-full select-none text-balance text-sm text-text-secondary",children:n})]})}const WM=n.memo((function({group:e,instanceProjectId:t}){var a;const r=Uk(),{submitPrompt:o}=YT(),[i,l]=n.useState(!1),[c,d]=n.useState(!1),u=NT(`/d/prompts/${e._id}`),m=n.useMemo((()=>{var n;return null!=t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e,t]),{hasPermission:p}=zE("promptGroup",e._id||""),f=p(Yg.EDIT);return s.jsxs(s.Fragment,{children:[s.jsx(KM,{name:e.name,category:e.category??"",onClick:()=>{var t;const n=null==(t=e.productionPrompt)?void 0:t.prompt;(null==n?void 0:n.trim())&&(pb(n)?d(!0):o(n))},snippet:"string"==typeof e.oneliner&&e.oneliner.length>0?e.oneliner:(null==(a=e.productionPrompt)?void 0:a.prompt)??"",children:s.jsxs("div",{className:"flex flex-row items-center gap-2",children:[!0===m&&s.jsx(we,{className:"icon-md text-green-400","aria-label":"Global prompt group"}),s.jsxs(Ei,{modal:!1,children:[s.jsx(Ri,{asChild:!0,children:s.jsxs("button",{id:`prompt-actions-${e._id}`,"aria-label":`${e.name} - Actions Menu`,"aria-expanded":"false","aria-controls":`prompt-menu-${e._id}`,"aria-haspopup":"menu",onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"z-50 inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:[s.jsx(gn,{className:"icon-md text-text-secondary","aria-hidden":"true"}),s.jsx("span",{className:"sr-only",children:r("com_ui_sr_actions_menu",{0:e.name})+" "+r("com_ui_prompt")})]})}),s.jsxs(Pi,{id:`prompt-menu-${e._id}`,"aria-label":`Available actions for ${e.name}`,className:"z-50 w-fit rounded-xl",collisionPadding:2,align:"end",children:[s.jsxs(Ai,{role:"menuitem",onClick:e=>{e.stopPropagation(),l(!0)},className:"w-full cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",children:[s.jsx(xn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),s.jsx("span",{children:r("com_ui_preview")})]}),f&&s.jsx(Ii,{children:s.jsxs(Ai,{disabled:!f,className:"cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",onClick:e=>{e.stopPropagation(),u(e)},children:[s.jsx(vn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),s.jsx("span",{children:r("com_ui_edit")})]})})]})]})]})}),s.jsx(GM,{group:e,open:i,onOpenChange:l}),s.jsx(zM,{open:c,onClose:()=>d(!1),group:e})]})}));function qM({groups:e=[],isChatRoute:t,isLoading:n}){const a=Fe(),r=Uk(),{data:o={}}=Wy(),{instanceProjectId:i}=o,l=Qk({permissionType:Zh.PROMPTS,permission:Jh.CREATE});return s.jsxs("div",{className:"flex h-full flex-col",children:[l&&s.jsx("div",{className:"flex w-full justify-end",children:s.jsxs(Si,{variant:"outline",className:"w-full bg-transparent "+(t?"":"mx-2"),onClick:()=>a("/d/prompts/new"),children:[s.jsx(kt,{className:"size-4","aria-hidden":!0}),r("com_ui_create_prompt")]})}),s.jsx("div",{className:"flex-grow overflow-y-auto",children:s.jsxs("div",{className:"overflow-y-auto overflow-x-hidden",children:[n&&t&&s.jsx(Cl,{className:"my-2 flex h-[84px] w-full rounded-2xl border-0 px-3 pb-4 pt-3"}),n&&!t&&Array.from({length:10}).map(((e,t)=>s.jsx(Cl,{className:"w-100 mx-2 my-2 flex h-14 rounded-lg border-0 p-4"},t))),!n&&0===e.length&&t&&s.jsx("div",{className:"my-2 flex h-[84px] w-full items-center justify-center rounded-2xl border border-border-light bg-transparent px-3 pb-4 pt-3 text-text-primary",children:r("com_ui_nothing_found")}),!n&&0===e.length&&!t&&s.jsx("div",{className:"my-12 flex w-full items-center justify-center text-lg font-semibold text-text-primary",children:r("com_ui_nothing_found")}),e.map((e=>t?s.jsx(WM,{group:e,instanceProjectId:i},e._id):s.jsx(CA,{group:e,instanceProjectId:i},e._id)))]})})]})}const QM=n.memo((function({onPrevious:e,onNext:t,hasNextPage:n,hasPreviousPage:a,isLoading:r,isChatRoute:o,children:i}){const l=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex gap-2",children:[!o&&s.jsx(Md,{returnThemeOnly:!0}),i]}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(Si,{variant:"outline",size:"sm",onClick:e,disabled:!a||r,"aria-label":l("com_ui_prev"),children:l("com_ui_prev")}),s.jsx(Si,{variant:"outline",size:"sm",onClick:t,disabled:!n||r,"aria-label":l("com_ui_next"),children:l("com_ui_next")})]})]})}));function YM({children:e,isDetailView:t,className:a=""}){const r=De(),o=Wi("(max-width: 1024px)"),i=n.useMemo((()=>{var e;return null==(e=r.pathname)?void 0:e.startsWith("/c/")}),[r.pathname]),{promptGroups:l,groupsQuery:c,nextPage:d,prevPage:u,hasNextPage:m,hasPreviousPage:p}=qS();return s.jsxs("div",{className:s_("flex h-full w-full flex-col gap-2 md:mr-2 md:w-auto md:min-w-72 lg:w-1/4 xl:w-1/4",!0===t&&o?"hidden":"",a),children:[e,s.jsx("div",{className:s_("flex-grow overflow-y-auto",i?"":"px-2 md:px-0"),children:s.jsx(qM,{groups:l,isChatRoute:i,isLoading:!!c.isLoading})}),s.jsx("div",{className:s_(i?"":"px-2 pb-3 pt-2 md:px-0"),children:s.jsx(QM,{onPrevious:u,onNext:d,hasNextPage:m,hasPreviousPage:p,isLoading:c.isFetching,isChatRoute:i,children:i&&s.jsx(NA,{className:"select-none"})})})]})}function XM({onCheckedChange:e,className:t=""}){const[n,a]=Ie(Cy.autoSendPrompts),r=Uk();return s.jsxs("div",{className:s_("flex select-none items-center justify-end gap-2 text-right text-sm",t),children:[s.jsxs("div",{children:[" ",r("com_nav_auto_send_prompts")," "]}),s.jsx(kl,{"aria-label":"toggle-auto-send-prompts",id:"autoSendPrompts",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"autoSendPrompts"})]})}function ZM({className:e=""}){const t=Uk(),{name:a,setName:r,hasAccess:o}=qS(),{categories:i}=xE({className:"h-4 w-4",hasAccess:o}),[l,c]=n.useState(a||""),[d,u]=n.useState(!1),[m,p]=Ie(Cy.promptsCategory),f=n.useMemo((()=>[...[{value:fh.ALL,label:t("com_ui_all_proper"),icon:s.jsx(bn,{className:"h-4 w-4 text-text-primary"})},{value:fh.MY_PROMPTS,label:t("com_ui_my_prompts"),icon:s.jsx(Gt,{className:"h-4 w-4 text-text-primary"})},{value:fh.SHARED_PROMPTS,label:t("com_ui_shared_prompts"),icon:s.jsx(Qt,{className:"h-4 w-4 text-text-primary"})},{divider:!0,value:null}],...i?[...i]:[{value:fh.NO_CATEGORY,label:t("com_ui_no_category")}]]),[i,t]),h=n.useCallback((e=>{e===fh.ALL?p(""):p(e)}),[p]);return n.useEffect((()=>{c(a||"")}),[a]),n.useEffect((()=>{if(""===l)return r(""),void u(!1);u(!0);const e=setTimeout((()=>{u(!1),r(l)}),500);return()=>clearTimeout(e)}),[l,r]),s.jsxs("div",{className:s_("flex w-full gap-2 text-text-primary",e),children:[s.jsx(od,{value:m||fh.ALL,onChange:h,options:f,className:"bg-transparent",icon:s.jsx(bn,{className:"h-4 w-4"}),label:"Filter: ",ariaLabel:t("com_ui_filter_prompts"),iconOnly:!0}),s.jsx(cd,{value:l,onChange:e=>{c(e.target.value)},isSearching:d,placeholder:t("com_ui_filter_prompts_name")})]})}function JM(){const e=qS();return s.jsx("div",{className:"flex h-full w-full flex-col",children:s.jsxs(YM,{className:"mt-2 space-y-2 lg:w-full xl:w-full",...e,children:[s.jsx(ZM,{className:"items-center justify-center"}),s.jsx("div",{className:"flex w-full flex-row items-center justify-end",children:s.jsx(XM,{className:"text-xs dark:text-white"})})]})})}function eL(){const e=Uk(),{conversation:t,setConversation:a}=Mk(),{setOption:r}=xT(),[o,i]=n.useState(!1),[l,c]=n.useState(null),{data:d={}}=Ky(),u=(null==t?void 0:t.endpoint)??"",m=(null==t?void 0:t.model)??"",p=n.useMemo((()=>{var e;return(null==(e=null==d?void 0:d[(null==t?void 0:t.endpoint)??""])?void 0:e.availableRegions)??[]}),[d,null==t?void 0:t.endpoint]),f=n.useMemo((()=>Sb(d,null==t?void 0:t.endpoint,"type")),[null==t?void 0:t.endpoint,d]),h=n.useMemo((()=>{var e,t,n;const s=(null==(e=d[u])?void 0:e.customParams)??{},[a,r]=Au(f??u,m),o=s.defaultParamsEndpoint??r,i=lv[a]??lv[o]??[],l=(null==(n=null==(t=d[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],c=Ro(l,"key");return i.filter((e=>null!=e)).map((e=>c[e.key]??e))}),[f,d,m,u]);n.useEffect((()=>{if(!h)return;const e=new Set(h.filter((e=>null!=e)).map((e=>e.key)));a((t=>{if(!t)return t;const n={...t},s=Object.keys(n),a=[];return s.forEach((s=>{e.has(s)||Yp.has(s)||null!=t[s]&&(a.push(s),delete n[s])})),a_.log("parameters","parameters effect, updated keys:",a),n}))}),[h,a]);const g=n.useCallback((()=>{a((e=>{if(!e)return e;const t={...e},n=[];return Object.keys(t).forEach((e=>{Yp.has(e)||void 0!==t[e]&&(n.push(e),delete t[e])})),a_.log("parameters","parameters reset, affected keys:",n),t}))}),[a]),x=n.useCallback((()=>{const e=um.parse({...t});c(e),i(!0)}),[t]);return h?s.jsxs("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",h.map((e=>{const n=oI[e.component];if(!n)return null;const{key:a,default:o,...i}=e;return"region"===a&&p.length&&(i.options=p),s.jsx(n,{settingKey:a,defaultValue:o,...i,setOption:r,conversation:t},a)}))]}),s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsxs("button",{type:"button",onClick:g,className:"btn btn-neutral flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[s.jsx(tn,{className:"h-4 w-4","aria-hidden":"true"}),e("com_ui_reset_var",{0:e("com_ui_model_parameters")})]})}),s.jsx("div",{className:"mt-2 flex justify-center",children:s.jsx("button",{onClick:x,className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"button",children:e("com_endpoint_save_as_preset")})}),l&&s.jsx(xI,{open:o,onOpenChange:i,preset:l})]}):null}function tL({row:e}){var t;const n=e.original;return s.jsxs("div",{className:"flex w-full items-center gap-2",children:[!0===(null==(t=null==n?void 0:n.type)?void 0:t.startsWith("image"))?s.jsx(CI,{url:n.filepath,className:"h-10 w-10 flex-shrink-0",source:n.source,alt:n.filename}):s.jsx(yI,{fileType:Lv(null==n?void 0:n.type),file:n}),s.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:s.jsx("span",{className:"block w-full overflow-hidden truncate text-ellipsis whitespace-nowrap text-xs",children:null==n?void 0:n.filename})})]})}const nL=[{accessorKey:"filename",header:({column:e})=>{const t=Uk();return s.jsxs(Si,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_name"),s.jsx(_n,{className:"ml-2 h-4 w-4"})]})},meta:{size:"150px"},cell:({row:e})=>s.jsx(tL,{row:e})},{accessorKey:"updatedAt",meta:{size:"10%"},header:({column:e})=>{const t=Uk();return s.jsxs(Si,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_date"),s.jsx(_n,{className:"ml-2 h-4 w-4"})]})},cell:({row:e})=>{var t,n;return s.jsx("span",{className:"flex justify-end text-xs",children:Ov((null==(n=null==(t=e.original)?void 0:t.updatedAt)?void 0:n.toString())??"")})}}];function sL({columns:e,data:t}){var a;const r=Uk(),[o,i]=n.useState([]),[l,c]=n.useState([]),[d,u]=n.useState({}),[{pageIndex:m,pageSize:p},f]=n.useState({pageIndex:0,pageSize:10}),h=Pe(Cy.showFiles),g=n.useMemo((()=>({pageIndex:m,pageSize:p})),[m,p]),x=lr({data:t,columns:e,state:{sorting:o,columnFilters:l,columnVisibility:d,pagination:g},onSortingChange:i,onPaginationChange:f,getCoreRowModel:ur(),getSortedRowModel:dr(),onColumnFiltersChange:c,getFilteredRowModel:cr(),onColumnVisibilityChange:u,getPaginationRowModel:gr(),defaultColumn:{minSize:0,size:10,maxSize:10,enableResizing:!0}}),v=aS(),{showToast:b}=$d(),{setFiles:_,conversation:y}=Mk(),{data:j=Gm}=Xy({select:e=>Ym(e)}),{addFile:w}=IT(_),N=n.useCallback((e=>{if(!(null==v?void 0:v[e.file_id])||!(null==y?void 0:y.endpoint))return void b({message:r("com_ui_attach_error"),status:"error"});const t=v[e.file_id],n=y.endpoint;if(!t.source)return;const s=tp(t.source),a=Mu(n);if(s&&!a)return void b({message:r("com_ui_attach_error_openai"),status:"error"});!s&&a&&b({message:r("com_ui_attach_warn_endpoint"),status:"warning"});const{fileSizeLimit:o,supportedMimeTypes:i}=j.endpoints[n]??j.endpoints.default;t.bytes>o?b({message:`${r("com_ui_attach_error_size")} ${o/Vm} MB (${n})`,status:"error"}):Gm.checkType(e.type,i)?w({progress:1,attached:!0,file_id:t.file_id,filepath:t.filepath,preview:t.filepath,type:t.type,height:t.height,width:t.width,filename:t.filename,source:t.source,size:t.bytes,metadata:t.metadata}):b({message:`${r("com_ui_attach_error_type")} ${e.type} (${n})`,status:"error"})}),[w,v,y,r,b,j.endpoints]),C=null==(a=x.getColumn("filename"))?void 0:a.getFilterValue();return s.jsxs("div",{role:"region","aria-label":r("com_files_table"),className:"mt-2 space-y-2",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsx(cl,{placeholder:r("com_files_filter"),value:C??"",onChange:e=>{var t;return null==(t=x.getColumn("filename"))?void 0:t.setFilterValue(e.target.value)},"aria-label":r("com_files_filter")})}),s.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(Sl,{children:[s.jsx(Tl,{children:x.getHeaderGroups().map((e=>s.jsx(Rl,{className:"border-b border-border-light",children:e.headers.map(((e,t)=>s.jsx(Il,{style:{width:0===t?"75%":"25%"},className:"bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:s.jsx("div",{className:"px-4",children:e.isPlaceholder?null:ir(e.column.columnDef.header,e.getContext())})},e.id)))},e.id)))}),s.jsx(El,{children:x.getRowModel().rows.length?x.getRowModel().rows.map((e=>s.jsx(Rl,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border-light transition-colors hover:bg-surface-secondary [&:last-child]:border-0",children:e.getVisibleCells().map((t=>{const n="filename"===t.column.id;return s.jsx(Pl,{style:{width:"150px",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"data-skip-refocus":"true",role:n?"button":void 0,tabIndex:n?0:void 0,onClick:t=>{if(n){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),N(e.original))}},onKeyDown:t=>{if(n&&("Enter"===t.key||" "===t.key)){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),N(e.original))}},children:ir(t.column.columnDef.cell,t.getContext())},t.id)}))},e.id))):s.jsx(Rl,{children:s.jsx(Pl,{colSpan:e.length,className:"h-24 text-center text-sm text-text-secondary",children:r("com_files_no_results")})})})]})})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(Si,{variant:"outline",size:"sm",onClick:()=>h(!0),"aria-label":r("com_sidepanel_manage_files"),children:[s.jsx(yn,{className:"h-4 w-4","aria-hidden":"true"}),s.jsx("span",{className:"ml-2",children:r("com_sidepanel_manage_files")})]}),s.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>x.previousPage(),disabled:!x.getCanPreviousPage(),"aria-label":r("com_ui_prev"),children:r("com_ui_prev")}),s.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${m+1} / ${x.getPageCount()}`}),s.jsx(Si,{variant:"outline",size:"sm",onClick:()=>x.nextPage(),disabled:!x.getCanNextPage(),"aria-label":r("com_ui_next"),children:r("com_ui_next")})]})]})]})}function aL(){const{data:e=[]}=Qy();return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:s.jsx(sL,{columns:nL,data:e})})}function rL(){return s.jsx("div",{className:"space-y-6 p-2",children:[1,2].map((e=>s.jsxs("div",{className:"space-y-4",children:[s.jsx(Cl,{className:"h-6 w-1/3 rounded-lg"})," ",[1,2].map((e=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(Cl,{className:"h-5 w-1/4 rounded-lg"})," ",s.jsx(Cl,{className:"h-8 w-full rounded-lg"})," ",s.jsx(Cl,{className:"h-4 w-2/3 rounded-lg"})," "]},e)))]},e)))})}function oL(){const e=Uk(),t=pr(),{showToast:a}=$d(),{conversationId:r}=function(){const e=n.useContext(FS);if(!e)throw new Error("useMCPPanelContext must be used within MCPPanelProvider");return e}(),{data:o,isLoading:i}=Wy(),{connectionStatus:l}=HT({enabled:!!(null==o?void 0:o.mcpServers)&&Object.keys(o.mcpServers).length>0}),[c,d]=n.useState(null),u=yk({onSuccess:async()=>{a({message:e("com_nav_mcp_vars_updated"),status:"success"}),await Promise.all([t.invalidateQueries([ex.mcpTools]),t.invalidateQueries([ex.mcpAuthValues]),t.invalidateQueries([ex.mcpConnectionStatus])])},onError:t=>{console.error("Error updating MCP auth:",t),a({message:e("com_nav_mcp_vars_update_error"),status:"error"})}}),m=n.useMemo((()=>(null==o?void 0:o.mcpServers)?Object.entries(o.mcpServers).map((([e,t])=>({serverName:e,iconPath:null,config:{...t,customUserVars:t.customUserVars??{}}}))):[]),[null==o?void 0:o.mcpServers]),p=()=>{d(null)},f=n.useCallback(((e,t)=>{console.log(`[MCP Panel] Saving config for ${e}, pluginKey: ${dh.mcp_prefix}${e}`);const n={pluginKey:`${dh.mcp_prefix}${e}`,action:"install",auth:t};u.mutate(n)}),[u]),h=n.useCallback((e=>{const t={pluginKey:`${dh.mcp_prefix}${e}`,action:"uninstall",auth:{}};u.mutate(t)}),[u]);if(i)return s.jsx(rL,{});if(0===m.length)return s.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:e("com_sidepanel_mcp_no_servers_with_vars")});if(c){const t=m.find((e=>e.serverName===c));if(!t)return d(null),s.jsxs("div",{className:"p-4 text-center text-sm text-gray-500",children:[e("com_ui_error"),": ",e("com_ui_mcp_server_not_found")]});const n=null==l?void 0:l[c],a="connected"===(null==n?void 0:n.connectionState);return s.jsxs("div",{className:"h-auto max-w-full space-y-4 overflow-x-hidden py-2",children:[s.jsxs(Si,{variant:"outline",onClick:p,size:"sm",children:[s.jsx(pt,{className:"mr-1 h-4 w-4"}),e("com_ui_back")]}),s.jsx("div",{className:"mb-4",children:s.jsx(PR,{serverName:c,fields:t.config.customUserVars,onSave:e=>{c&&f(c,e)},onRevoke:()=>{c&&h(c)},isSubmitting:u.isLoading})}),s.jsx(XI,{sidePanel:!0,conversationId:r,serverName:c,requiresOAuth:(null==n?void 0:n.requiresOAuth)||!1,hasCustomUserVars:t.config.customUserVars&&Object.keys(t.config.customUserVars).length>0}),(null==n?void 0:n.requiresOAuth)&&a&&s.jsxs(Si,{className:"w-full",size:"sm",variant:"destructive",onClick:()=>h(c),children:[s.jsx(jn,{className:"h-4 w-4"}),e("com_ui_oauth_revoke")]})]})}return s.jsx("div",{className:"h-auto max-w-full overflow-x-hidden py-2",children:s.jsx("div",{className:"space-y-2",children:m.map((e=>{const t=null==l?void 0:l[e.serverName],n="connected"===(null==t?void 0:t.connectionState);return s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(Si,{variant:"outline",className:"flex-1 justify-start dark:hover:bg-gray-700",onClick:()=>{return t=e.serverName,void d(t);var t},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:e.serverName}),t&&s.jsx("span",{className:"rounded-xl px-2 py-0.5 text-xs "+(n?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"),children:t.connectionState})]})})},e.serverName)}))})})}function iL(){return s.jsx(zS,{children:s.jsx(oL,{})})}function lL({onToggle:e,navVisible:t,isHovering:n,setIsHovering:a,side:r="left",className:o="",translateX:i=!0}){const l=Uk(),c={transition:"transform 0.3s ease, opacity 0.2s ease"},d=n||!t?"15deg":"0deg",u="right"===r?`-${d}`:d,m="right"===r?d:`-${d}`;return s.jsx("div",{className:s_(o,"-translate-y-1/2 transition-transform",t?"rotate-0":"rotate-180",t&&i?"translate-x-[260px]":"translate-x-0"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:s.jsx(Dl,{side:"right"===r?"left":"right","aria-label":l("left"===r?"com_ui_chat_history":"com_ui_controls"),"aria-expanded":t,"aria-controls":"left"===r?"chat-history-nav":"controls-nav",id:`toggle-${r}-nav`,onClick:e,role:"button",description:l(t?"com_nav_close_sidebar":"com_nav_open_sidebar"),className:"flex items-center justify-center",tabIndex:0,children:s.jsx("span",{className:"","data-state":"closed",children:s.jsx("div",{className:"flex h-[72px] w-8 items-center justify-center",style:{...c,opacity:n?1:.25},children:s.jsxs("div",{className:"flex h-6 w-6 flex-col items-center",children:[s.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(0.15rem) rotate(${u}) translateZ(0px)`}}),s.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(-0.15rem) rotate(${m}) translateZ(0px)`}})]})})})})})}function cL({links:e,isCollapsed:t,resize:a}){const r=Uk(),{active:o,setActive:i}=function(){const e=n.useContext(Xk);if(void 0===e)throw new Error("useActivePanel must be used within an ActivePanelProvider");return e}();return s.jsx("div",{"data-collapsed":t,className:"bg-token-sidebar-surface-primary hide-scrollbar group flex-shrink-0 overflow-x-hidden",children:s.jsx("div",{className:"h-full",children:s.jsx("div",{className:"flex h-full min-h-0 flex-col",children:s.jsx("div",{className:"flex h-full min-h-0 flex-col opacity-100 transition-opacity",children:s.jsx("div",{className:"scrollbar-trigger relative h-full w-full flex-1 items-start border-white/20",children:s.jsx("div",{className:"flex h-full w-full flex-col gap-1 px-3 py-2.5 group-[[data-collapsed=true]]:items-center group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:e.map(((e,n)=>{const l=(e=>e.id===o?"default":"ghost")(e);return t?s.jsx(Dl,{description:r(e.title),side:"left",render:s.jsxs(Si,{variant:"ghost",size:"icon",onClick:t=>{if(e.onClick)return e.onClick(t),void i("");i(e.id),a&&a(25)},children:[s.jsx(e.icon,{className:"h-4 w-4 text-text-secondary"}),s.jsx("span",{className:"sr-only",children:r(e.title)})]})},`nav-link-${n}`):s.jsx(mi,{type:"single",value:o,onValueChange:i,collapsible:!0,children:s.jsxs(pi,{value:e.id,className:"w-full border-none",children:[s.jsx(Ds,{asChild:!0,children:s.jsx(Fs,{asChild:!0,children:s.jsxs(Si,{variant:"outline",size:"sm",className:"w-full justify-start bg-transparent text-text-secondary data-[state=open]:bg-surface-secondary data-[state=open]:text-text-primary",onClick:t=>{e.onClick&&(e.onClick(t),i(""))},children:[s.jsx(e.icon,{className:"mr-2 h-4 w-4"}),r(e.title),null!=e.label&&e.label&&s.jsx("span",{className:s_("ml-auto opacity-100 transition-all duration-300 ease-in-out","default"===l?"text-text-primary":""),children:e.label})]})})}),s.jsx(fi,{className:"w-full text-text-primary",children:e.Component&&s.jsx(e.Component,{})})]})},n)}))})})})})})})}function dL({links:e,isCollapsed:t,resize:n,defaultActive:a}){return s.jsx(Zk,{defaultActive:a,children:s.jsx(cL,{links:e,isCollapsed:t,resize:n})})}const uL=n.memo((({defaultSize:e,panelRef:t,navCollapsedSize:a=3,hasArtifacts:r,minSize:o,setMinSize:i,collapsedSize:l,setCollapsedSize:c,isCollapsed:d,setIsCollapsed:u,fullCollapse:m,setFullCollapse:p,interfaceConfig:f})=>{var h;const g=Uk(),{endpoint:x}=function(){const e=n.useContext(MS);if(!e)throw new Error("useSidePanelContext must be used within SidePanelProvider");return e}(),[v,b]=n.useState(!1),[_,y]=DE("newUser",!0),{data:j={}}=Ky(),w=Wi("(max-width: 767px)"),{data:N={expiresAt:void 0}}=xk(x??""),C=n.useMemo((()=>{const e=localStorage.getItem("side:active-panel");return"string"==typeof e?e:void 0}),[]),k=n.useMemo((()=>Sb(j,x,"type")),[x,j]),S=n.useMemo((()=>{var e;return!!(null==(e=null==j?void 0:j[x??""])?void 0:e.userProvide)}),[j,x]),T=n.useMemo((()=>!S||!!N.expiresAt),[N.expiresAt,S]),E=n.useCallback((()=>{var e;u(!0),c(0),i(20),p(!0),localStorage.setItem("fullPanelCollapse","true"),null==(e=t.current)||e.collapse()}),[t,i,u,p,c]),R=function({hidePanel:e,keyProvided:t,endpoint:s,endpointType:a,interfaceConfig:r,endpointsConfig:o}){const i=Qk({permissionType:Zh.PROMPTS,permission:Jh.USE}),l=Qk({permissionType:Zh.BOOKMARKS,permission:Jh.USE}),c=Qk({permissionType:Zh.MEMORIES,permission:Jh.USE}),d=Qk({permissionType:Zh.MEMORIES,permission:Jh.READ}),u=Qk({permissionType:Zh.AGENTS,permission:Jh.USE}),m=Qk({permissionType:Zh.AGENTS,permission:Jh.CREATE}),{data:p}=Wy();return n.useMemo((()=>{const n=[];return Mu(s)&&(s===Nu.assistants&&(null==o?void 0:o[Nu.assistants])&&!0!==o[Nu.assistants].disableBuilder||s===Nu.azureAssistants&&(null==o?void 0:o[Nu.azureAssistants])&&!0!==o[Nu.azureAssistants].disableBuilder)&&t&&n.push({title:"com_sidepanel_assistant_builder",label:"",icon:Zl,id:Nu.assistants,Component:wA}),(null==o?void 0:o[Nu.agents])&&u&&m&&!0!==o[Nu.agents].disableBuilder&&n.push({title:"com_sidepanel_agent_builder",label:"",icon:Zl,id:Nu.agents,Component:AP}),i&&n.push({title:"com_ui_prompts",label:"",icon:wn,id:"prompts",Component:JM}),c&&d&&n.push({title:"com_ui_memories",label:"",icon:Et,id:"memories",Component:QP}),!0===r.parameters&&!0===Ou(s??"",a??"")&&!Lu(s)&&t&&n.push({title:"com_sidepanel_parameters",label:"",icon:Jt,id:"parameters",Component:eL}),n.push({title:"com_sidepanel_attach_files",label:"",icon:uc,id:"files",Component:aL}),l&&n.push({title:"com_sidepanel_conversation_tags",label:"",icon:Nn,id:"bookmarks",Component:VP}),(null==p?void 0:p.mcpServers)&&Object.values(p.mcpServers).some((e=>e.customUserVars&&Object.keys(e.customUserVars).length>0||e.isOAuth||!1===e.startup))&&n.push({title:"com_nav_setting_mcp",label:"",icon:Xc,id:"mcp-settings",Component:iL}),n.push({title:"com_sidepanel_hide_panel",label:"",icon:Cn,onClick:e,id:"hide-panel"}),n}),[o,r.parameters,t,a,s,u,i,c,d,l,m,e,p])}({endpoint:x,hidePanel:E,keyProvided:T,endpointType:k,interfaceConfig:f,endpointsConfig:j}),I=n.useCallback((()=>{var e,n;_&&y(!1),u((e=>(e&&(i(20),c(a),p(!1),localStorage.setItem("fullPanelCollapse","false")),!e))),d?null==(n=t.current)||n.expand():null==(e=t.current)||e.collapse()}),[_,t,y,i,d,u,p,c,a]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),className:"relative flex w-px items-center justify-center",children:s.jsx(lL,{navVisible:!d,isHovering:v,onToggle:I,setIsHovering:b,className:s_("fixed top-1/2",d&&(0===o||0===l)||m?"mr-9":"mr-16"),translateX:!1,side:"right"})}),(!d||o>0)&&!w&&!m&&s.jsx(ql,{withHandle:!0,className:"bg-transparent text-text-primary"}),s.jsx(Wl,{tagName:"nav",id:"controls-nav",order:r?3:2,"aria-label":g("com_ui_controls"),role:"navigation",collapsedSize:l,defaultSize:e,collapsible:!0,minSize:o,maxSize:40,ref:t,style:{overflowY:"auto",transition:"width 0.2s ease, visibility 0s linear 0.2s"},onExpand:()=>{u(!1),localStorage.setItem("react-resizable-panels:collapsed","false")},onCollapse:()=>{u(!0),localStorage.setItem("react-resizable-panels:collapsed","true")},className:s_("sidenav hide-scrollbar border-l border-border-light bg-background py-1 transition-opacity",d?"min-w-[50px]":"min-w-[340px] sm:min-w-[352px]",w&&d&&(0===o||0===l)||m?"hidden min-w-0":"opacity-100"),children:s.jsx(dL,{resize:null==(h=t.current)?void 0:h.resize,isCollapsed:d,defaultActive:C,links:R})})]})})),mL=Gf().interface,pL=n.memo((({defaultLayout:e=[97,3],defaultCollapsed:t=!1,fullPanelCollapse:a=!1,navCollapsedSize:r=3,artifacts:o,children:i})=>{const{data:l}=Wy(),c=n.useMemo((()=>(null==l?void 0:l.interface)??mL),[l]),d=n.useRef(null),[u,m]=n.useState(20),[p,f]=n.useState(t),[h,g]=n.useState(a),[x,v]=n.useState(r),b=Wi("(max-width: 767px)"),_=Ae(Cy.hideSidePanel),y=n.useCallback((()=>{if(null==o){const t=2===e.length?e[1]:e[2];return[100-t,t]}{const e=0,t=100-e,n=Math.floor(t/2);return[n,t-n,e]}}),[o,e]),j=n.useMemo((()=>b_(y())),[y]),w=n.useMemo((()=>To((e=>{const t=b_(e);localStorage.setItem("react-resizable-panels:layout",JSON.stringify(t))}),350)),[]);n.useEffect((()=>{var e;if(b)return f(!0),v(0),m(20),g(!0),localStorage.setItem("fullPanelCollapse","true"),void(null==(e=d.current)||e.collapse());f(t),v(r),m(20)}),[b,t,r,a]);const N=n.useMemo((()=>null!=o?15:30),[o]),C=n.useCallback((()=>{var e;f((()=>(localStorage.setItem("fullPanelCollapse","true"),g(!0),v(0),m(0),!1))),null==(e=d.current)||e.collapse()}),[]);return s.jsxs(s.Fragment,{children:[s.jsxs(Kl,{direction:"horizontal",onLayout:e=>w(e),className:"transition-width relative h-full w-full flex-1 overflow-auto bg-presentation",children:[s.jsx(Wl,{defaultSize:j[0],minSize:N,order:1,id:"messages-view",children:i}),null!=o&&s.jsxs(s.Fragment,{children:[s.jsx(ql,{withHandle:!0,className:"ml-3 bg-border-medium text-text-primary"}),s.jsx(Wl,{defaultSize:j[1],minSize:N,order:2,id:"artifacts-panel",children:o})]}),!_&&!0===c.sidePanel&&s.jsx(uL,{panelRef:d,minSize:u,setMinSize:m,isCollapsed:p,setIsCollapsed:f,collapsedSize:x,setCollapsedSize:v,fullCollapse:h,setFullCollapse:g,defaultSize:j[j.length-1],hasArtifacts:null!=o,interfaceConfig:c})]}),s.jsx("button",{"aria-label":"Close right side panel",className:"nav-mask "+(p?"":"active"),onClick:C})]})}));function fL({buttonClass:e,iconClass:t="",endpoint:n,endpointType:a,model:r}){const{conversation:o,optionSettings:i,setOptionSettings:l,showAgentSettings:c,setShowAgentSettings:d}=Mk(),u=Uk(),[m,p]=Ie(Cy.currentSettingsView),{model:f,endpoint:h,endpointType:g}=o??{},x=a??n??g??h??"",v=r??f,b=/gemini|learnlm|gemma/.test(v??"")??!1,_=(!b&&(null==v?void 0:v.toLowerCase().includes("chat")))??!1,y=!b&&!_&&/code|text/.test(v??""),{showExamples:j}=i,w=!b&&!y&&_,N={[Nu.google]:[{label:u(!0===j?"com_hide_examples":"com_show_examples"),buttonClass:!0===b||y?"disabled":"",handler:()=>{p(bp.default),l((e=>({...e,showExamples:!e.showExamples})))},icon:s.jsx(mc,{className:s_("mr-1 w-[14px]",t)})}],[Nu.gptPlugins]:[{label:u(c?"com_show_completion_settings":"com_show_agent_settings"),buttonClass:"",handler:()=>{p(bp.default),d((e=>!e))},icon:s.jsx(ec,{className:s_("mr-1 w-[14px]",t),size:24})}]};if(!x)return null;if(x===Nu.google&&!w)return null;bp.default,s_("mr-1 h-6 w-[14px]",t),bp.advanced,s_("mr-1 h-6 w-[14px]",t);const C=N[x]??[];return s.jsxs("div",{className:"flex w-full justify-between",children:[s.jsx("div",{className:"flex items-center justify-start",children:C.map(((t,n)=>s.jsxs(Si,{type:"button",className:s_(t.buttonClass,"border border-gray-300/50 focus:ring-1 focus:ring-green-500/90 dark:border-gray-500/50 dark:focus:ring-green-500","ml-1 h-full bg-transparent px-2 py-1 text-xs font-normal text-black hover:bg-gray-100 hover:text-black dark:bg-transparent dark:text-white dark:hover:bg-gray-600 dark:hover:text-white",e??""),onClick:t.handler,children:[t.icon,t.label]},`button-${n}`)))}),null]})}pL.displayName="SidePanelGroup";const hL=({exportPreset:e,submitPreset:t})=>{const a=Uk(),r=pr(),{preset:o,setPreset:i}=Mk(),{setOption:l,setOptions:c,setAgentOption:d}=xT(o),[u,m]=hT({setOption:l,optionKey:"title",initialValue:null==o?void 0:o.title}),[p,f]=Ie(Cy.presetModalVisible),{data:h=[]}=Ky({select:Tb}),g=n.useMemo((()=>h.filter((e=>!Lu(e)))),[h]);n.useEffect((()=>{var e,t;if(!o)return;if(Lu(o.endpoint))return;const n=o.endpoint??"";if(!n)return;const s=r.getQueryData([ex.models]);if(!s)return;const a=s[n];a&&a.length&&o.model!==a[0]&&(a.includes(o.model??"")||(console.log("setting model",a[0]),l("model")(a[0])),(null==(e=o.agentOptions)?void 0:e.model)!==a[0]&&null!=(null==(t=o.agentOptions)?void 0:t.model)&&o.agentOptions.model&&!a.includes(o.agentOptions.model)&&(console.log("setting agent model",a[0]),d("model")(a[0])))}),[o,r,l,d]);const x=n.useCallback((e=>{if(!c)return console.warn("setOptions is not defined");const{newEndpointType:t}=Rb({newEndpoint:e,modularChat:!0,conversation:null,endpointsConfig:r.getQueryData([ex.endpoints])??{}});c({endpoint:e,endpointType:t})}),[r,c]),{endpoint:v,endpointType:b,model:_}=o||{},y=v??"";return y?Lu(y)?null:s.jsx(ml,{open:p,onOpenChange:e=>{f(e),e||i(null)},children:s.jsxs(xl,{className:"h-[100dvh] max-h-[100dvh] w-full max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:h-auto md:max-h-[90vh] md:max-w-[75vw] md:rounded-lg lg:max-w-[950px]",children:[s.jsx(_l,{children:`${a("com_ui_edit")} ${a("com_endpoint_preset")} - ${null==o?void 0:o.title}`}),s.jsxs("div",{className:"flex w-full flex-col gap-2 px-1 pb-4 md:gap-4",children:[s.jsxs("div",{className:"grid w-full gap-2 md:grid-cols-2 md:gap-4",children:[s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx(ul,{htmlFor:"preset-name",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint_preset_name")}),s.jsx(cl,{id:"preset-name",value:m??"",onChange:u,placeholder:a("com_endpoint_set_custom_name"),className:s_(h_,"flex h-10 max-h-10 w-full resize-none px-3 py-2",m_)})]}),s.jsxs("div",{className:"flex w-full flex-col",children:[s.jsx(ul,{htmlFor:"endpoint",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint")}),s.jsx(Fd,{value:y||"",setValue:x,showLabel:!1,emptyTitle:!0,searchPlaceholder:a("com_endpoint_search"),availableValues:g})]})]}),s.jsx("div",{className:"flex w-full",children:s.jsx(fL,{buttonClass:"ml-0 w-full border border-border-medium p-2 h-[40px] justify-center mt-0",iconClass:"hidden lg:block w-4",endpoint:y,endpointType:b,model:_})}),s.jsx("div",{className:"w-full border-t border-border-medium"}),s.jsx("div",{className:"w-full flex-1",children:s.jsx(gI,{conversation:o,setOption:l,isPreset:!0,className:"text-text-primary"})}),s.jsxs("div",{className:"flex justify-end gap-2 border-t border-border-medium pt-2 md:pt-4",children:[s.jsx("button",{onClick:e,className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 md:px-4",children:a("com_endpoint_export")}),s.jsx("button",{onClick:t,className:"rounded-md bg-green-500 px-3 py-2 text-sm font-medium text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 md:px-4",children:a("com_ui_save")})]})]})]})}):null},gL=({onFileSelected:e,className:t="",containerClassName:a="",successText:r=null,invalidText:o=null,validator:i=null,text:l=null,id:c="1"})=>{const[d,u]=n.useState("text-gray-600"),[m,p]=n.useState(null),f=Uk();let h;return h=m?"success"===m?r??f("com_ui_upload_success"):o??f("com_ui_upload_invalid"):l??f("com_ui_import"),s.jsxs("label",{htmlFor:`file-upload-${c}`,className:s_("mr-1 flex h-auto cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-normal transition-colors hover:bg-gray-100 hover:text-green-600 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-green-500",d,a),children:[s.jsx(kn,{className:"mr-1 flex w-[22px] items-center stroke-1"}),s.jsx("span",{className:"flex text-xs",children:h}),s.jsx("input",{id:`file-upload-${c}`,value:"",type:"file",className:s_("hidden",t),accept:".json",onChange:t=>{var n;const s=null==(n=t.target.files)?void 0:n[0];if(!s)return;const a=new FileReader;a.onload=t=>{var n;const s=JSON.parse(null==(n=t.target)?void 0:n.result);if(i&&!i(s))return p("invalid"),void u("text-red-600");i&&(p("success"),u("text-green-500 dark:text-green-500")),e(s)},a.readAsText(s)}})]})},xL=({title:e,description:t,selected:n,icon:a,className:r="",textClassName:o="",children:i,onClick:l,...c})=>s.jsx("div",{id:n?"selected-endpoint":void 0,role:"option","aria-selected":n,"aria-label":e,"data-testid":"chat-menu-item",className:s_("group m-1.5 flex cursor-pointer gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 hover:bg-black/5 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-600 md:min-w-[240px]",r||""),tabIndex:0,onClick:l,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l&&l())},...c,children:s.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[s.jsx("div",{children:s.jsxs("div",{className:s_("flex items-center gap-1 "),children:[null!=a?a:null,s.jsxs("div",{className:s_("truncate",o),children:[e,s.jsx("div",{className:"text-token-text-tertiary",children:t})]})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[i,n&&s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block ",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})}),vL=()=>s.jsx("div",{role:"separator","aria-orientation":"horizontal",className:"my-1.5 border-b bg-gray-200 dark:border-gray-700"}),bL=({presets:e,onSetDefaultPreset:t,onSelectPreset:n,onChangePreset:a,onDeletePreset:r,clearAllPresets:o,onFileSelected:i})=>{const{data:l}=Ky(),c=Ae(Cy.defaultPreset),d=Uk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:s.jsxs("div",{className:"flex h-full grow items-center justify-end gap-2",children:[s.jsx("label",{htmlFor:"default-preset",className:"w-40 truncate rounded bg-transparent py-1 text-xs font-medium text-gray-600 transition-colors dark:bg-transparent dark:text-gray-300 sm:w-72",children:c?`${d("com_endpoint_preset_default_item")} ${c.title}`:d("com_endpoint_preset_default_none")}),s.jsxs(Qi,{children:[s.jsx(Yi,{asChild:!0,children:s.jsxs("label",{htmlFor:"file-upload",className:"mr-1 flex h-[32px] cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100 hover:text-red-700 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-red-700",children:[s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"mr-1 flex w-[22px] items-center",children:s.jsx("path",{d:"M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"})}),d("com_ui_clear")," ",d("com_ui_all")]})}),s.jsx(Dd,{showCloseButton:!1,title:`${d("com_ui_clear")} ${d("com_endpoint_presets")}`,className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(ul,{htmlFor:"preset-item-clear-all",className:"text-left text-sm font-medium",children:d("com_endpoint_presets_clear_warning")})})})}),selection:{selectHandler:o,selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-600 text-white",selectText:d("com_ui_clear")}}),s.jsx(gL,{onFileSelected:i})]})]})}),e&&0===e.length&&s.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:s.jsx("div",{className:"flex h-full grow items-center justify-end gap-2 text-gray-600 dark:text-gray-300",children:d("com_endpoint_no_presets")})}),s.jsx(sr,{flipKey:null==e?void 0:e.map((e=>null==e?void 0:e.presetId)).filter((e=>e)).join("."),children:e&&e.length>0&&e.map(((o,i)=>{const d=(null==o?void 0:o.presetId)??"";if(!o||!d)return null;const u=Lb({endpoint:o.endpoint,endpointsConfig:l}),m=LE[u];return s.jsx(qa,{asChild:!0,children:s.jsxs("div",{children:[s.jsx(ar,{flipId:d,children:s.jsx(xL,{textClassName:"text-xs max-w-[150px] sm:max-w-[200px] truncate md:max-w-full ",title:ub(o),onClick:()=>n(o),icon:null!=m&&s.jsx(m,{context:"menu-item",iconURL:Sb(l,o.endpoint,"iconURL"),className:"icon-md mr-1 dark:text-white",endpoint:o.endpoint}),selected:!1,"data-testid":`preset-item-${o}`,children:s.jsxs("div",{className:"flex h-full items-center justify-end gap-1",children:[s.jsx("button",{className:s_("m-0 h-full rounded-md bg-transparent p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",(null==c?void 0:c.presetId)===d?"":"sm:invisible sm:group-hover:visible"),onClick:e=>{e.preventDefault(),e.stopPropagation(),t(o,(null==c?void 0:c.presetId)===d)},children:s.jsx(kc,{unpin:(null==c?void 0:c.presetId)===d})}),s.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(o)},children:s.jsx(tc,{})}),s.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(o)},children:s.jsx(Sc,{})})]})},`preset-item-${d}`)}),i!==e.length-1&&s.jsx(vL,{})]},`preset-${d}`)},`preset-${d}`)}))})]})},_L=()=>{const e=Uk(),{presetsQuery:t,onSetDefaultPreset:n,onFileSelected:a,onSelectPreset:r,onChangePreset:o,clearAllPresets:i,onDeletePreset:l,submitPreset:c,exportPreset:d}=fT(),{preset:u}=Mk();return s.jsxs(Ka,{children:[s.jsx(Wa,{asChild:!0,children:s.jsx(Dl,{id:"presets-button","aria-label":e("com_endpoint_examples"),description:e("com_endpoint_examples"),tabIndex:0,role:"button","data-testid":"presets-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(Sn,{size:16,"aria-label":"Preset Icon"})})}),s.jsx(Ha,{children:s.jsx("div",{style:{position:"fixed",left:"0px",top:"0px",transform:"translate3d(268px, 50px, 0px)",minWidth:"max-content",zIndex:"auto"},children:s.jsx(Ga,{side:"bottom",align:"center",className:"mt-2 max-h-[495px] overflow-x-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-700 dark:text-white md:min-w-[400px]",children:s.jsx(bL,{presets:t.data,onSetDefaultPreset:n,onSelectPreset:r,onChangePreset:o,onDeletePreset:l,clearAllPresets:i,onFileSelected:a})})})}),u&&s.jsx(hL,{submitPreset:c,exportPreset:d})]})};function yL({setNavVisible:e,className:t}){const n=Uk();return s.jsx(Dl,{description:n("com_nav_open_sidebar"),render:s.jsx(Si,{size:"icon",variant:"outline","data-testid":"open-sidebar-button","aria-label":n("com_nav_open_sidebar"),className:s_("rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover",t),onClick:()=>e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),children:s.jsx(sc,{})})})}function jL(){const e=Uk(),t=pr(),{conversation:n,newConversation:a}=Mk();return s.jsx(Dl,{description:e("com_ui_new_chat"),render:s.jsx(Si,{size:"icon",variant:"outline","data-testid":"wide-header-new-chat-button","aria-label":e("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(t.setQueryData([ex.messages,(null==n?void 0:n.conversationId)??dh.NEW_CONVO],[]),t.invalidateQueries([ex.messages]),a()):window.open("/c/new","_blank")},children:s.jsx(zc,{})})})}const wL=({isLoading:e,hasData:t,delay:a=150,loadingComponent:r,children:o,className:i=""})=>{const[l,c]=n.useState(!1);return n.useEffect((()=>{let n;return e&&!t?n=setTimeout((()=>{c(!0)}),a):c(!1),()=>{n&&clearTimeout(n)}}),[e,t,a]),l?s.jsx("div",{className:i,children:r}):s.jsx("div",{className:i,children:o})},NL=({categories:e,activeTab:t,isLoading:n,onChange:a})=>{const r=Uk(),o=Wi("(max-width: 768px)"),i=e=>"promoted"===e.value?r("com_agents_top_picks"):"all"===e.value?r("com_agents_all_category"):e.label&&e.label.startsWith("com_")?r(e.label):e.label||e.value.charAt(0).toUpperCase()+e.value.slice(1),l=s.jsx("div",{className:"w-full pb-2",children:s.jsx("div",{className:"flex flex-wrap justify-center gap-1.5 px-4",children:[...Array(6)].map(((e,t)=>s.jsx("div",{className:"h-[36px] min-w-[80px] animate-pulse rounded-lg bg-surface-tertiary"},t)))})});if(!(n||e&&0!==e.length))return s.jsx("div",{className:"text-center text-text-secondary",children:r("com_ui_no_categories")});const c=s.jsx("div",{className:"w-full pb-2",children:s.jsx("div",{className:s_("px-4",o?"scrollbar-hide flex gap-2 overflow-x-auto scroll-smooth":"flex flex-wrap justify-center gap-1.5"),role:"tablist","aria-label":r("com_agents_category_tabs_label"),"aria-orientation":"horizontal",style:o?{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"}:void 0,children:e.map(((n,l)=>s.jsxs("button",{id:`category-tab-${n.value}`,onClick:()=>a(n.value),onKeyDown:t=>((t,n)=>{const s=e.findIndex((e=>e.value===n));let r=s;switch(t.key){case"ArrowLeft":t.preventDefault(),r=s>0?s-1:e.length-1;break;case"ArrowRight":t.preventDefault(),r=s<e.length-1?s+1:0;break;case"ArrowUp":t.preventDefault(),r=Math.max(0,s-5);break;case"ArrowDown":t.preventDefault(),r=Math.min(e.length-1,s+5);break;case"Home":t.preventDefault(),r=0;break;case"End":t.preventDefault(),r=e.length-1;break;default:return}const o=e[r];o&&(a(o.value),setTimeout((()=>{const e=document.getElementById(`category-tab-${o.value}`);e&&e.focus()}),0))})(t,n.value),className:s_("relative cursor-pointer select-none whitespace-nowrap px-3 py-2 transition-all duration-200",o?"min-w-fit flex-shrink-0":"",t===n.value?"rounded-t-lg bg-surface-hover text-text-primary":"rounded-lg bg-surface-secondary text-text-secondary hover:bg-surface-hover hover:text-text-primary active:scale-95"),role:"tab","aria-selected":t===n.value,"aria-controls":`tabpanel-${n.value}`,tabIndex:t===n.value?0:-1,"aria-label":r("com_agents_category_tab_label",{category:i(n),position:l+1,total:e.length}),children:[i(n),t===n.value&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-text-primary","aria-hidden":"true"})]},n.value)))})});return s.jsx(wL,{isLoading:n,hasData:(null==e?void 0:e.length)>0,delay:100,loadingComponent:l,children:c})},CL=({agent:e,isOpen:t,onClose:a})=>{const r=Uk(),o=pr(),{showToast:i}=$d(),l=n.useRef(null),c=Pk(),{conversation:d,newConversation:u}=Mk(),m=()=>{if(!(null==e?void 0:e.support_contact))return null;const{name:t,email:n}=e.support_contact;return t&&n?s.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:t}):n?s.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:n}):t?s.jsx("span",{children:t}):null};return s.jsx(ml,{open:t,onOpenChange:e=>!e&&a(),children:s.jsxs(xl,{ref:l,className:"max-h-[90vh] w-11/12 max-w-lg overflow-y-auto",children:[s.jsx(Si,{variant:"ghost",size:"icon",className:"absolute right-11 top-4 h-4 w-4 rounded-sm p-0 opacity-70 ring-ring-primary ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":r("com_agents_copy_link"),onClick:()=>{const t=`${new URL(window.location.origin).origin}/c/new?agent_id=${e.id}`;navigator.clipboard.writeText(t).then((()=>{i({message:r("com_agents_link_copied")})})).catch((()=>{i({message:r("com_agents_link_copy_failed")})}))},title:r("com_agents_copy_link"),children:s.jsx(Zt,{})}),s.jsx("div",{className:"mt-6 flex justify-center",children:Zv(e,{size:"xl"})}),s.jsx("div",{className:"mt-3 text-center",children:s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:(null==e?void 0:e.name)||r("com_agents_loading")})}),(null==e?void 0:e.support_contact)&&m()&&s.jsxs("div",{className:"mt-1 text-center text-sm text-text-secondary",children:[r("com_agents_contact"),": ",m()]}),s.jsx("div",{className:"mt-4 whitespace-pre-wrap px-6 text-center text-base text-text-primary",children:null==e?void 0:e.description}),s.jsx("div",{className:"mb-4 mt-6 flex justify-center",children:s.jsx(Si,{className:"w-full max-w-xs",onClick:()=>{if(e){const t=[ex.agents,{requiredPermission:Yg.EDIT}],n=o.getQueryData(t);if(null!=n&&!n.data.some((t=>t.id===e.id))){const s=[e,...JSON.parse(JSON.stringify(n.data))];o.setQueryData(t,{...n,data:s})}localStorage.setItem(`${uh.AGENT_ID_PREFIX}0`,e.id),o.setQueryData([ex.messages,(null==d?void 0:d.conversationId)??dh.NEW_CONVO],[]),o.invalidateQueries([ex.messages]);const s={conversationId:dh.NEW_CONVO,endpoint:Nu.agents,agent_id:e.id,title:r("com_agents_chat_with",{name:e.name||r("com_ui_agent")})},a=c({conversation:{...d??{},...s},preset:s});u({template:a,preset:s})}},disabled:!e,children:r("com_agents_start_chat")})})]})})},kL=({value:e,onSearch:t,className:a=""})=>{const r=Uk(),[o,i]=n.useState(e),l=function(e,t){const[s,a]=n.useState(e);return n.useEffect((()=>{const n=setTimeout((()=>{a(e)}),t);return()=>{clearTimeout(n)}}),[e,t]),s}(o,300);n.useEffect((()=>{i(e)}),[e]),n.useEffect((()=>{l!==e&&l===o&&t(l)}),[l,t,e,o]);const c=n.useCallback((()=>{t(""),i("")}),[t]);return s.jsxs("div",{className:`relative w-full max-w-4xl ${a}`,role:"search",children:[s.jsx("label",{htmlFor:"agent-search",className:"sr-only",children:r("com_agents_search_instructions")}),s.jsx(cl,{id:"agent-search",type:"text",value:o,onChange:e=>{i(e.target.value)},placeholder:r("com_agents_search_placeholder"),className:"h-12 rounded-xl border-border-medium bg-transparent pl-12 pr-12 text-lg text-text-primary shadow-md transition-[border-color,box-shadow] duration-200 placeholder:text-text-secondary focus:border-border-heavy focus:shadow-lg focus:ring-0","aria-label":r("com_agents_search_aria"),"aria-describedby":"search-instructions search-results-count",autoComplete:"off",spellCheck:"false"}),s.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-4","aria-hidden":"true",children:s.jsx(wt,{className:"size-5 text-text-secondary"})}),s.jsx("div",{id:"search-instructions",className:"sr-only",children:r("com_agents_search_instructions")}),o&&s.jsx("button",{type:"button",onClick:c,className:"group absolute right-4 top-1/2 flex size-5 -translate-y-1/2 items-center justify-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":r("com_agents_clear_search"),title:r("com_agents_clear_search"),children:s.jsx(vt,{className:"size-5 text-text-secondary transition-colors duration-200 group-hover:text-text-primary",strokeWidth:2.5})})]})},SL=({error:e,onRetry:t,context:n})=>{const a=Uk(),r=e=>"object"==typeof e&&null!==e&&!(e instanceof Error),o=e=>e instanceof Error,i=()=>(null==n?void 0:n.searchQuery)?a("com_agents_error_search_title"):(null==n?void 0:n.category)?a("com_agents_error_category_title"):a("com_agents_error_title"),l=()=>(null==n?void 0:n.searchQuery)?a("com_agents_search_no_results",{query:n.searchQuery}):(null==n?void 0:n.category)&&"all"!==n.category?a("com_agents_category_empty",{category:n.category}):a("com_agents_error_not_found_message"),{title:c,message:d,suggestion:u}=(()=>{var t,n;let s;s="string"==typeof e?{message:e}:o(e)?{message:e.message}:r(e)&&((null==(t=null==e?void 0:e.response)?void 0:t.data)||(null==e?void 0:e.data))||e;let c="";(o(e)||r(e)&&(null==e?void 0:e.message))&&(c=e.message);const d=r(e)?null==e?void 0:e.code:"";if("ECONNABORTED"===d||(null==c?void 0:c.includes("timeout")))return{title:a("com_agents_error_timeout_title"),message:a("com_agents_error_timeout_message"),suggestion:a("com_agents_error_timeout_suggestion")};if("NETWORK_ERROR"===d||(null==c?void 0:c.includes("Network Error")))return{title:a("com_agents_error_network_title"),message:a("com_agents_error_network_message"),suggestion:a("com_agents_error_network_suggestion")};const u=r(e)?null==(n=null==e?void 0:e.response)?void 0:n.status:null;if(u){if(404===u)return{title:a("com_agents_error_not_found_title"),message:l(),suggestion:a("com_agents_error_not_found_suggestion")};if(400===u)return{title:a("com_agents_error_invalid_request"),message:(null==s?void 0:s.userMessage)||a("com_agents_error_bad_request_message"),suggestion:(null==s?void 0:s.suggestion)||a("com_agents_error_bad_request_suggestion")};if(u>=500)return{title:a("com_agents_error_server_title"),message:a("com_agents_error_server_message"),suggestion:a("com_agents_error_server_suggestion")}}return s&&"object"==typeof s&&(null==s?void 0:s.userMessage)?{title:i(),message:s.userMessage,suggestion:s.suggestion||a("com_agents_error_suggestion_generic")}:{title:i(),message:a("com_agents_error_generic"),suggestion:a("com_agents_error_suggestion_generic")}})();return s.jsx("div",{className:"py-12 text-center",role:"alert","aria-live":"assertive","aria-atomic":"true",children:s.jsxs("div",{className:"mx-auto max-w-md space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:s_("flex h-12 w-12 items-center justify-center rounded-full","bg-red-100 dark:bg-red-900/20"),children:s.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",role:"img","aria-label":"Error icon",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})})}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",id:"error-title",children:c}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",id:"error-message","aria-describedby":"error-title",children:d}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500",id:"error-suggestion",role:"note","aria-label":`Suggestion: ${u}`,children:["💡 ",u]})]}),t&&s.jsx("div",{className:"pt-2",children:s.jsx(Si,{onClick:t,variant:"outline",size:"sm",className:s_("border-red-300 text-red-700 hover:bg-red-50 focus:ring-2 focus:ring-red-500","dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 dark:focus:ring-red-400"),"aria-describedby":"error-message error-suggestion","aria-label":`Retry action. ${d}`,children:a("com_agents_error_retry")})})]})})},TL=({agent:e,onClick:t,className:a=""})=>{const r=Uk(),{categories:o}=$k(),i=n.useMemo((()=>{if(!e.category)return"";const t=o.find((t=>t.value===e.category));return t?t.label&&t.label.startsWith("com_")?r(t.label):t.label:e.category.charAt(0).toUpperCase()+e.category.slice(1)}),[e.category,o,r]);return s.jsx("div",{className:s_("group relative h-40 overflow-hidden rounded-xl border border-border-light","cursor-pointer shadow-sm transition-all duration-200 hover:border-border-medium hover:shadow-lg","bg-surface-tertiary hover:bg-surface-hover","space-y-3 p-4",a),onClick:t,"aria-label":r("com_agents_agent_card_label",{name:e.name,description:e.description??""}),"aria-describedby":`agent-${e.id}-description`,tabIndex:0,role:"button",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())},children:s.jsxs("div",{className:"flex h-full items-start gap-3",children:[s.jsxs("div",{className:"flex h-full flex-shrink-0 flex-col justify-between space-y-4",children:[s.jsx("div",{className:"flex-shrink-0",children:Zv(e,{size:"sm"})}),e.category&&s.jsx("div",{className:"inline-flex items-center rounded-md border-border-xheavy bg-surface-active-alt px-2 py-1 text-xs font-medium",children:s.jsx(ul,{className:"line-clamp-1 font-normal",children:i})})]}),s.jsxs("div",{className:"flex h-full min-w-0 flex-1 flex-col justify-between space-y-1",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx(ul,{className:"mb-1 line-clamp-1 text-xl font-semibold text-text-primary",children:e.name}),s.jsx("p",{id:`agent-${e.id}-description`,className:"line-clamp-3 text-sm leading-relaxed text-text-primary",...e.description?{"aria-label":`Description: ${e.description}`}:{},children:e.description??""})]}),(()=>{const t=(e=>{var t,n;if(!e)return null;const s=null==(t=e.support_contact)?void 0:t.name,a=null==(n=e.support_contact)?void 0:n.email,r=e.authorName;return s||r||a||null})(e);return t?s.jsx("div",{className:"flex justify-end",children:s.jsx("div",{className:"flex items-center text-sm text-text-secondary",children:s.jsx(ul,{children:t})})}):null})()]})]})})},EL=({category:e,searchQuery:t,onSelectAgent:a,scrollElementRef:r})=>{var o;const i=Uk(),{categories:l}=$k(),c=n.useMemo((()=>{const n={requiredPermission:Yg.VIEW,limit:6};return t?(n.search=t,"all"!==e&&"promoted"!==e&&(n.category=e)):"promoted"===e?n.promoted=1:"all"!==e&&(n.category=e),n}),[e,t]),{data:d,isLoading:u,error:m,isFetching:p,fetchNextPage:f,hasNextPage:h,refetch:g,isFetchingNextPage:x}=(v=c,hr({queryKey:[ex.marketplaceAgents,v],queryFn:({pageParam:e})=>{const t={...v};return e&&(t.cursor=e.toString()),fx.getMarketplaceAgents(t)},getNextPageParam:e=>(null==e?void 0:e.after)??void 0,enabled:!!v.requiredPermission,keepPreviousData:!0,staleTime:12e4,cacheTime:6e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...b}));var v,b;const _=n.useMemo((()=>(null==d?void 0:d.pages)?d.pages.flatMap((e=>e.data||[])):[]),[null==d?void 0:d.pages]),y=(e=>{if(!e)return!1;if("object"==typeof e&&null!==e){if("agents"in e){const t=e.agents;return Array.isArray(t)&&t.length>0}if("id"in e||"name"in e)return!0}return!!Array.isArray(e)&&e.length>0})(null==(o=null==d?void 0:d.pages)?void 0:o[0]),{setScrollElement:j}=(({hasNextPage:e=!1,isLoading:t=!1,fetchNextPage:s,threshold:a=.8,throttleMs:r=200})=>{const o=n.useRef(null),[i,l]=n.useState(null),c=n.useCallback((()=>{if(!i)return;const{scrollTop:n,scrollHeight:r,clientHeight:o}=i;(n+o)/r>=a&&e&&!t&&s()}),[i,e,t,s,a]),d=n.useMemo((()=>So.throttle(c,r)),[c,r]);return n.useEffect((()=>()=>{var e;null==(e=d.cancel)||e.call(d)}),[d]),n.useEffect((()=>{if(!1===t&&i){const e=requestAnimationFrame((()=>{d()}));return()=>cancelAnimationFrame(e)}}),[t,i,d]),n.useEffect((()=>{const e=i;if(e)return e.addEventListener("scroll",d,{passive:!0}),o.current&&o.current.disconnect(),o.current=new ResizeObserver((()=>{d()})),o.current.observe(e),d(),()=>{e.removeEventListener("scroll",d),o.current&&(o.current.disconnect(),o.current=null)}}),[i,d]),{setScrollElement:n.useCallback((e=>{l(e)}),[])}})({hasNextPage:h,isLoading:p||x,fetchNextPage:()=>{h&&!p&&f()},threshold:.8,throttleMs:200});n.useEffect((()=>{const e=null==r?void 0:r.current;e&&j(e)}),[r,j]);const w=e=>{const t=l.find((t=>t.value===e));return t?t.label:"promoted"===e?i("com_agents_top_picks"):"all"===e?"All":e.charAt(0).toUpperCase()+e.slice(1)},N=s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(rc,{className:"h-8 w-8 text-primary"})});if(m)return s.jsx(SL,{error:m||"Unknown error occurred",onRetry:()=>g(),context:{searchQuery:t,category:e}});const C=s.jsx("div",{className:"space-y-6",role:"tabpanel",id:`category-panel-${e}`,"aria-labelledby":`category-tab-${e}`,"aria-live":"polite","aria-busy":u&&!y,children:_&&0!==_.length||u||p?s.jsxs(s.Fragment,{children:[s.jsx("div",{id:"search-results-count",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:i("com_agents_grid_announcement",{count:(null==_?void 0:_.length)||0,category:w(e)})}),_&&_.length>0&&s.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",role:"grid","aria-label":i("com_agents_grid_announcement",{count:_.length,category:w(e)}),children:_.map(((e,t)=>s.jsx("div",{role:"gridcell",children:s.jsx(TL,{agent:e,onClick:()=>a(e)})},`${e.id}-${t}`)))}),x&&s.jsxs("div",{className:"flex justify-center py-8",role:"status","aria-live":"polite","aria-label":i("com_agents_loading"),children:[s.jsx(rc,{className:"h-6 w-6 text-primary"}),s.jsx("span",{className:"sr-only",children:i("com_agents_loading")})]}),!h&&_&&_.length>0&&s.jsx("div",{className:"mt-8 text-center",children:s.jsx("p",{className:"text-sm text-text-secondary",children:i("com_agents_no_more_results")})})]}):s.jsx("div",{className:"py-12 text-center text-text-secondary",role:"status","aria-live":"polite","aria-label":i(t?"com_agents_search_empty_heading":"com_agents_empty_state_heading"),children:s.jsx("h3",{className:"mb-2 text-lg font-medium",children:i("com_agents_empty_state_heading")})})});return u||p&&!x?N:C},RL=({className:e=""})=>{const t=Uk(),a=Fe(),{category:r}=nt(),o=pr(),[i,l]=Ps(),{conversation:c,newConversation:d}=Mk(),u=Wi("(max-width: 768px)"),{navVisible:m,setNavVisible:p}=ct(),[f,h]=Ie(Cy.hideSidePanel),g=i.get("q")||"",x=i.get("agent_id")||"",[v,b]=n.useState(r||"all"),[_,y]=n.useState(null),[j,w]=n.useState(!1),[N,C]=n.useState("right"),k=n.useRef(null),[S,T]=n.useState(!1),[E,R]=n.useState(null);FE(`${t("com_agents_marketplace")} | LibreChat`),n.useEffect((()=>{h(!1),localStorage.setItem("hideSidePanel","false"),localStorage.setItem("fullPanelCollapse","false")}),[h,f]),Ky();const I=Ly({staleTime:9e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1});n.useEffect((()=>{if(!r&&"/agents"===window.location.pathname&&I.data&&"all"===v){I.data.some((e=>"promoted"===e.value))&&b("promoted")}}),[r,I.data,v]);const P=e=>{const t=new URLSearchParams(i);t.set("agent_id",e.id),l(t),R(e),T(!0)},A=n.useMemo((()=>{const e=(I.data||[]).map((e=>e.value)),t=new Set(e);return Array.from(t)}),[I.data]),M=n.useCallback((e=>{const t=A.indexOf(e);return t>=0?t:0}),[A]);n.useEffect((()=>{r&&r!==v&&!j&&b(r)}),[r,v,j]);n.useEffect((()=>{T(!!x)}),[x]);const L=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),O=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),D=n.useMemo((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]),F=Qk({permissionType:Zh.MARKETPLACE,permission:Jh.USE});return n.useEffect((()=>{let e;return F||(e=setTimeout((()=>{a("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[F,a]),F?s.jsx("div",{className:`relative flex w-full grow overflow-hidden bg-presentation ${e}`,children:s.jsx(LS,{children:s.jsx(pL,{defaultLayout:L,fullPanelCollapse:D,defaultCollapsed:O,children:s.jsx("main",{className:"flex h-full flex-col overflow-hidden",role:"main",children:s.jsxs("div",{ref:k,className:"scrollbar-gutter-stable relative flex h-full flex-col overflow-y-auto overflow-x-hidden",children:[!u&&s.jsx("div",{className:"sticky top-0 z-20 flex items-center justify-between bg-surface-secondary p-2 font-semibold text-text-primary md:h-14",children:s.jsx("div",{className:"mx-1 flex items-center gap-2",children:m?s.jsx("div",{className:"h-10 w-10"}):s.jsxs(s.Fragment,{children:[s.jsx(yL,{setNavVisible:p}),s.jsx(Dl,{description:t("com_ui_new_chat"),render:s.jsx(Si,{size:"icon",variant:"outline","data-testid":"agents-new-chat-button","aria-label":t("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(o.setQueryData([ex.messages,(null==c?void 0:c.conversationId)??dh.NEW_CONVO],[]),o.invalidateQueries([ex.messages]),d()):window.open("/c/new","_blank")},children:s.jsx(zc,{})})})]})})}),!u&&s.jsx("div",{className:"container mx-auto max-w-4xl",children:s.jsxs("div",{className:s_("mb-8 text-center","mt-12"),children:[s.jsx("h1",{className:"mb-3 text-3xl font-bold tracking-tight text-text-primary md:text-5xl",children:t("com_agents_marketplace")}),s.jsx("p",{className:"mx-auto mb-6 max-w-2xl text-lg text-text-secondary",children:t("com_agents_marketplace_subtitle")})]})}),s.jsx("div",{className:s_("sticky z-10 bg-presentation pb-4",u?"top-0":"top-14"),children:s.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[s.jsxs("div",{className:"mx-auto flex max-w-2xl gap-2 pb-6",children:[s.jsx(kL,{value:g,onSearch:e=>{const t=new URLSearchParams(i),n=v;e.trim()?t.set("q",e.trim()):t.delete("q"),a("promoted"===n?"/agents"+(t.toString()?`?${t.toString()}`:""):`/agents/${n}${t.toString()?`?${t.toString()}`:""}`)}}),s.jsx(nR,{})]}),s.jsx(NL,{categories:I.data||[],activeTab:v,isLoading:I.isLoading,onChange:e=>{if(e===v||j)return;const t=M(v),n=M(e);C(n>t?"right":"left"),y(e),w(!0);const s=i.toString(),r=s?`?${s}`:"";a("promoted"===e?`/agents${r}`:`/agents/${e}${r}`),window.setTimeout((()=>{b(e),y(null),w(!1)}),300)}})]})}),s.jsx("div",{className:"container mx-auto max-w-4xl px-4 pb-8",children:s.jsxs("div",{className:"relative overflow-hidden",children:[s.jsxs("div",{className:s_(j&&("right"===N?"motion-safe:animate-slide-out-left":"motion-safe:animate-slide-out-right")),children:[!g&&s.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,s;if("promoted"===v)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===v)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const a=null==(e=I.data)?void 0:e.find((e=>e.value===v));return a?{name:(null==(n=a.label)?void 0:n.startsWith("com_"))?t(a.label):a.label,description:(null==(s=a.description)?void 0:s.startsWith("com_"))?t(a.description):a.description||""}:{name:v.charAt(0).toUpperCase()+v.slice(1),description:""}})();return s.jsxs("div",{className:"text-left",children:[s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&s.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),s.jsx(EL,{category:v,searchQuery:g,onSelectAgent:P,scrollElementRef:k},`grid-${v}`)]},`pane-current-${v}`),j&&_&&s.jsxs("div",{className:s_("absolute inset-0","right"===N?"motion-safe:animate-slide-in-right":"motion-safe:animate-slide-in-left"),children:[!g&&s.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,s;if("promoted"===_)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===_)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const a=null==(e=I.data)?void 0:e.find((e=>e.value===_));return a?{name:(null==(n=a.label)?void 0:n.startsWith("com_"))?t(a.label):a.label,description:(null==(s=a.description)?void 0:s.startsWith("com_"))?t(a.description):a.description||""}:{name:(_||"").charAt(0).toUpperCase()+(_||"").slice(1),description:""}})();return s.jsxs("div",{className:"text-left",children:[s.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&s.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),s.jsx(EL,{category:_,searchQuery:g,onSelectAgent:P,scrollElementRef:k},`grid-${_}`)]},`pane-next-${_}-${N}`)]})}),S&&E&&s.jsx(CL,{agent:E,isOpen:S,onClose:()=>{const e=new URLSearchParams(i);e.delete("agent_id"),l(e),R(null),T(!1)}})]})})})})}):null};function IL(){const e=Uk(),[t]=Ps(),[a,r]=n.useState(3),o=t.get("serverName");return n.useEffect((()=>{const e=setInterval((()=>{r((t=>t<=1?(clearInterval(e),window.close(),0):t-1))}),1e3);return()=>clearInterval(e)}),[]),s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:s.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[s.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_success_title")||"Authentication Successful"}),s.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:[e("com_ui_oauth_success_description")||"Your authentication was successful. This window will close in"," ",s.jsx("span",{className:"font-medium text-indigo-500",children:a})," ",e("com_ui_seconds")||"seconds","."]}),o&&s.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:[e("com_ui_oauth_connected_to")||"Connected to",":"," ",s.jsx("span",{className:"font-medium",children:o})]})]})})}function PL(){const e=Uk(),[t]=Ps(),n=t.get("error")||"unknown_error";return s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:s.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[s.jsx("div",{className:"mb-4 flex justify-center",children:s.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:s.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),s.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_error_title")||"Authentication Failed"}),s.jsx("p",{className:"mb-6 text-sm text-gray-600",children:(t=>{switch(t){case"missing_code":return e("com_ui_oauth_error_missing_code")||"Authorization code is missing. Please try again.";case"missing_state":return e("com_ui_oauth_error_missing_state")||"State parameter is missing. Please try again.";case"invalid_state":return e("com_ui_oauth_error_invalid_state")||"Invalid state parameter. Please try again.";case"callback_failed":return e("com_ui_oauth_error_callback_failed")||"Authentication callback failed. Please try again.";default:return e("com_ui_oauth_error_generic")||t.replace(/_/g," ")}})(n)}),s.jsx("button",{onClick:()=>window.close(),className:"rounded-md bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2","aria-label":e("com_ui_close_window")||"Close Window",children:e("com_ui_close_window")||"Close Window"})]})})}const AL=e=>e.split("\n").map((e=>e.trim())).filter(Boolean).map(((e,t)=>({number:t+1,content:e}))),ML=async()=>{const e=await(async()=>{if("userAgentData"in navigator)try{const e=navigator.userAgentData,t=await e.getHighEntropyValues(["platform","platformVersion"]);return{os:t.platform,version:t.platformVersion}}catch(Fi){a_.warn("Failed to get high entropy values"),a_.error(Fi)}const e=navigator.userAgent.toLowerCase();return e.includes("mac")?{os:"macOS"}:e.includes("win")?{os:"Windows"}:e.includes("linux")?{os:"Linux"}:e.includes("android")?{os:"Android"}:e.includes("ios")||e.includes("iphone")||e.includes("ipad")?{os:"iOS"}:{os:"Unknown"}})();return{userAgent:navigator.userAgent,platform:e.os,platformVersion:e.version,language:navigator.language,windowSize:`${window.innerWidth}x${window.innerHeight}`}};function LL(){const e=Tn(),t={message:e.message??"An unexpected error occurred",stack:e.stack,status:e.status,statusText:e.statusText,data:e.data};return s.jsx("div",{role:"alert",className:"flex min-h-screen flex-col items-center justify-center bg-surface-primary bg-gradient-to-br",children:s.jsxs("div",{className:"bg-surface-primary/60 mx-4 w-11/12 max-w-4xl rounded-2xl border border-border-light p-8 shadow-2xl backdrop-blur-xl",children:[s.jsx("h2",{className:"mb-6 text-center text-3xl font-medium tracking-tight text-text-primary",children:"Oops! Something Unexpected Occurred"}),s.jsxs("div",{className:"mb-4 rounded-xl border border-red-500/20 bg-red-500/5 p-4 text-sm text-gray-600 dark:text-gray-200",children:[s.jsx("h3",{className:"mb-2 font-medium",children:"Error Message:"}),s.jsx("pre",{className:"whitespace-pre-wrap text-sm font-light leading-relaxed text-text-primary",children:t.message})]}),("number"==typeof t.status||"string"==typeof t.statusText)&&s.jsxs("div",{className:"mb-4 rounded-xl border border-yellow-500/20 bg-yellow-500/5 p-4 text-sm text-text-primary",children:[s.jsx("h3",{className:"mb-2 font-medium",children:"Status:"}),s.jsxs("p",{className:"text-text-primary",children:["number"==typeof t.status&&`${t.status} `,"string"==typeof t.statusText&&t.statusText]})]}),null!=t.stack&&""!==t.stack.trim()&&s.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[s.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[s.jsx("span",{children:"Stack Trace"}),s.jsx("div",{className:"flex items-center",children:s.jsx(Si,{variant:"outline",size:"sm",onClick:async()=>{null!=t.stack&&""!==t.stack&&await navigator.clipboard.writeText(t.stack)},className:"ml-2 px-2 py-1 text-xs",children:"Copy"})})]}),s.jsx("div",{className:"overflow-x-auto rounded-lg bg-black/5 p-4 dark:bg-white/5",children:AL(t.stack).map((({number:e,content:t})=>s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"select-none pr-4 font-mono text-xs text-text-secondary",children:String(e).padStart(3,"0")}),s.jsx("pre",{className:"flex-1 font-mono text-xs leading-relaxed text-text-primary",children:t})]},e)))})]}),null!=t.data&&s.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[s.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[s.jsx("span",{children:"Additional Details"}),s.jsx("span",{className:"transition-transform group-open:rotate-90",children:">"})]}),s.jsx("pre",{className:"whitespace-pre-wrap text-xs font-light leading-relaxed text-text-primary",children:JSON.stringify(t.data,null,2)})]}),s.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[s.jsx("p",{className:"text-sm font-light text-text-secondary",children:"Please try one of the following:"}),s.jsxs("ul",{className:"list-inside list-disc text-sm text-text-secondary",children:[s.jsx("li",{children:"Refresh the page"}),s.jsx("li",{children:"Clear your browser cache"}),s.jsx("li",{children:"Check your internet connection"}),s.jsx("li",{children:"Contact the Admin if the issue persists"})]}),s.jsxs("div",{className:"mt-4 flex flex-col items-center gap-4 sm:flex-row sm:justify-center",children:[s.jsx(Si,{variant:"submit",onClick:()=>window.location.reload(),className:"w-full sm:w-auto",children:"Refresh Page"}),s.jsx(Si,{variant:"outline",onClick:async()=>{try{const e=await ML(),n={timestamp:(new Date).toISOString(),browser:e,error:{...t,stack:null!=t.stack&&""!==t.stack.trim()?AL(t.stack):void 0}},s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`error-log-${(new Date).toISOString()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}catch(Fi){a_.warn("Failed to download error logs:"),a_.error(Fi)}},className:"w-full sm:w-auto",children:"Download Error Logs"})]})]})]})})}function OL({startupConfig:e}){var t;const n=Uk();if(!e)return null;const a={discord:e.discordLoginEnabled&&s.jsx($E,{enabled:e.discordLoginEnabled,serverDomain:e.serverDomain,oauthPath:"discord",Icon:bc,label:n("com_auth_discord_login"),id:"discord"},"discord"),facebook:e.facebookLoginEnabled&&s.jsx($E,{enabled:e.facebookLoginEnabled,serverDomain:e.serverDomain,oauthPath:"facebook",Icon:gc,label:n("com_auth_facebook_login"),id:"facebook"},"facebook"),github:e.githubLoginEnabled&&s.jsx($E,{enabled:e.githubLoginEnabled,serverDomain:e.serverDomain,oauthPath:"github",Icon:vc,label:n("com_auth_github_login"),id:"github"},"github"),google:e.googleLoginEnabled&&s.jsx($E,{enabled:e.googleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"google",Icon:hc,label:n("com_auth_google_login"),id:"google"},"google"),apple:e.appleLoginEnabled&&s.jsx($E,{enabled:e.appleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"apple",Icon:_c,label:n("com_auth_apple_login"),id:"apple"},"apple"),openid:e.openidLoginEnabled&&s.jsx($E,{enabled:e.openidLoginEnabled,serverDomain:e.serverDomain,oauthPath:"openid",Icon:()=>e.openidImageUrl?s.jsx("img",{src:e.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):s.jsx(xc,{}),label:e.openidLabel,id:"openid"},"openid"),saml:e.samlLoginEnabled&&s.jsx($E,{enabled:e.samlLoginEnabled,serverDomain:e.serverDomain,oauthPath:"saml",Icon:()=>e.samlImageUrl?s.jsx("img",{src:e.samlImageUrl,alt:"SAML Logo",className:"h-5 w-5"}):s.jsx(yc,{}),label:e.samlLabel?e.samlLabel:n("com_auth_saml_login"),id:"saml"},"saml")};return e.socialLoginEnabled&&s.jsxs(s.Fragment,{children:[e.emailLoginEnabled&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative mt-6 flex w-full items-center justify-center border border-t border-gray-300 uppercase dark:border-gray-600",children:s.jsx("div",{className:"absolute bg-white px-3 text-xs text-black dark:bg-gray-900 dark:text-white",children:"Or"})}),s.jsx("div",{className:"mt-8"})]}),s.jsx("div",{className:"mt-2",children:null==(t=e.socialLogins)?void 0:t.map((e=>a[e]||null))})]})}const DL=({active:e,children:t})=>e?s.jsxs(s.Fragment,{children:[s.jsx("style",{children:"\n  @keyframes blink-animation {\n    0%,\n    100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }"}),s.jsx("div",{style:{animation:"blink-animation 3s infinite"},children:t})]}):s.jsx(s.Fragment,{children:t}),FL=({onHeightChange:e})=>{const{data:t}=(e=>{const t=Ae(Cy.queriesEnabled);return mr([ex.banner],(()=>fx.getBanner()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:t})})(),[a,r]=Ie(Cy.hideBannerHint),o=n.useRef(null);if(n.useEffect((()=>{e&&o.current&&e(o.current.offsetHeight)}),[t,a,e]),!t||t.bannerId&&a.includes(t.bannerId))return null;return s.jsxs("div",{ref:o,className:"sticky top-0 z-20 flex items-center bg-neutral-900 from-gray-700 to-gray-900 px-2 py-1 text-slate-50 dark:bg-gradient-to-r dark:text-white md:relative",children:[s.jsx("div",{className:"w-full truncate px-4 text-center text-sm",dangerouslySetInnerHTML:{__html:t.message}}),s.jsx("button",{type:"button","aria-label":"Dismiss banner",className:"h-8 w-8 opacity-80 hover:opacity-100",onClick:()=>{r([...a,t.bannerId]),e&&e(0)},children:s.jsx(vt,{className:"mx-auto h-4 w-4"})})]})};function zL({startupConfig:e}){var t,n;const a=Uk();if(!e)return null;const r=null==(t=e.interface)?void 0:t.privacyPolicy,o=null==(n=e.interface)?void 0:n.termsOfService,i=(null==r?void 0:r.externalUrl)&&s.jsx("a",{className:"text-sm text-green-500",href:r.externalUrl,target:r.openNewTab?"_blank":void 0,rel:"noreferrer",children:a("com_ui_privacy_policy")}),l=(null==o?void 0:o.externalUrl)&&s.jsx("a",{className:"text-sm text-green-500",href:o.externalUrl,target:o.openNewTab?"_blank":void 0,rel:"noreferrer",children:a("com_ui_terms_of_service")});return s.jsxs("div",{className:"align-end m-4 flex justify-center gap-2",role:"contentinfo",children:[i,i&&l&&s.jsx("div",{className:"border-r-[1px] border-gray-300 dark:border-gray-600"}),l]})}function UL({children:e,header:t,isFetching:n,startupConfig:a,startupConfigError:r,pathname:o,error:i}){const l=Uk(),c=null!=r,d=()=>c?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsx(BE,{children:l("com_auth_error_login_server")})}):"com_auth_error_invalid_reset_token"===i?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsxs(BE,{children:[l("com_auth_error_invalid_reset_token")," ",s.jsx("a",{className:"font-semibold text-green-600 hover:underline",href:"/forgot-password",children:l("com_auth_click_here")})," ",l("com_auth_to_try_again")]})}):null!=i&&i?s.jsx("div",{className:"mx-auto sm:max-w-sm",children:s.jsx(BE,{children:l(i)})}):null;return s.jsxs("div",{className:"relative flex min-h-screen flex-col bg-white dark:bg-gray-900",children:[s.jsx(FL,{}),s.jsx(DL,{active:n,children:s.jsx("div",{className:"mt-6 h-10 w-full bg-cover",children:s.jsx("img",{src:"assets/logo.png",className:"h-full w-full object-contain",alt:l("com_ui_logo",{0:(null==a?void 0:a.appTitle)??"LibreChat"})})})}),s.jsx(d,{}),s.jsx("div",{className:"absolute bottom-0 left-0 md:m-4",children:s.jsx(Md,{})}),s.jsx("div",{className:"flex flex-grow items-center justify-center",children:s.jsxs("div",{className:"w-authPageWidth overflow-hidden bg-white px-6 py-4 dark:bg-gray-900 sm:max-w-md sm:rounded-lg",children:[!c&&!n&&s.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",style:{userSelect:"none"},children:t}),e,!o.includes("2fa")&&(o.includes("login")||o.includes("register"))&&s.jsx(OL,{startupConfig:a})]})}),s.jsx(zL,{startupConfig:a})]})}const VL={"/login":"com_auth_welcome_back","/register":"com_auth_create_account","/forgot-password":"com_auth_reset_password","/reset-password":"com_auth_reset_password","/login/2fa":"com_auth_verify_your_identity"};function BL({isAuthenticated:e}){const[t,a]=n.useState(null),[r,o]=n.useState(null),[i,l]=n.useState(null),{data:c,isFetching:d,error:u}=Wy({enabled:!e||null===i}),m=Uk(),p=Fe(),f=De();n.useEffect((()=>{e&&p("/c/new",{replace:!0}),c&&l(c)}),[e,p,c]),n.useEffect((()=>{document.title=(null==i?void 0:i.appTitle)||"LibreChat"}),[null==i?void 0:i.appTitle]),n.useEffect((()=>{a(null),o(null)}),[f.pathname]);const h={error:t,setError:a,headerText:r,setHeaderText:o,startupConfigError:u,startupConfig:i,isFetching:d};return s.jsx(UL,{header:m(r||VL[f.pathname]),isFetching:d,startupConfig:i,startupConfigError:u,pathname:f.pathname,error:t,children:s.jsx(En,{context:h})})}function $L(){const{isAuthenticated:e}=qk(),[t,a]=Ie(Cy.queriesEnabled);return n.useEffect((()=>{if(t)return;const e=setTimeout((()=>{a(!0)}),500);return()=>{clearTimeout(e)}}),[t,a]),s.jsx(BL,{isAuthenticated:e})}const HL=({name:e,onSave:t})=>{const a=n.useRef(null),r=n.useRef(),[o,i]=n.useState(!1),[l,c]=n.useState(e),d=()=>{const e=null==l?void 0:l.trim();t(e||""),i(!1)};return n.useEffect((()=>{var e;o&&(null==(e=a.current)||e.focus())}),[o]),n.useEffect((()=>{c(e)}),[e]),s.jsx("div",{className:"flex items-center",children:s.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center"},className:"gap-2",children:o?s.jsxs(s.Fragment,{children:[s.jsx(cl,{type:"text",value:l??"",onChange:e=>{c(e.target.value)},onKeyDown:t=>{"Escape"===t.key&&(i(!1),c(e)),"Enter"===t.key&&d()},ref:a,className:"flex w-full max-w-none rounded-lg text-2xl font-bold transition duration-200",style:{whiteSpace:"nowrap",textOverflow:"ellipsis"}}),s.jsx(Si,{onClick:()=>{d(),clearTimeout(r.current)},variant:"ghost",size:"sm",className:"h-10 flex-shrink-0","aria-label":"Save prompt name",children:s.jsx(Hc,{className:"icon-md"})})]}):s.jsxs(s.Fragment,{children:[s.jsx(ul,{className:"text-2xl font-bold",style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:l}),s.jsx(Si,{onClick:()=>{i(!0)},variant:"ghost",size:"sm","aria-label":"Edit prompt name",className:"h-10 flex-shrink-0",children:s.jsx(tc,{className:"icon-md"})})]})})})},{promptsEditorMode:GL,alwaysMakeProd:KL}=Cy,WL=()=>{const e=Uk(),[t,n]=Ie(GL),a=Pe(KL);return s.jsx("div",{className:"relative flex h-10 items-center justify-center rounded-xl border border-border-light bg-surface-primary transition-all duration-300",children:s.jsxs("div",{className:"relative flex w-48 items-stretch md:w-64",children:[s.jsx("div",{className:"absolute rounded-lg bg-surface-hover shadow-lg transition-all duration-300 ease-in-out",style:{top:"1px",left:t===fv.SIMPLE?"2px":"calc(50% + 2px)",width:"calc(50% - 4px)",height:"calc(100% - 2px)"}}),s.jsx("button",{type:"button",onClick:()=>{a(!0),n(fv.SIMPLE)},className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===fv.SIMPLE?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:s.jsx("span",{className:"relative",children:e("com_ui_simple")})}),s.jsx("button",{type:"button",onClick:()=>n(fv.ADVANCED),className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===fv.ADVANCED?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:s.jsx("span",{className:"relative",children:e("com_ui_advanced")})})]})})},qL=({control:e,promptPerm:t,label:n,confirmChange:a})=>s.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,s.jsx(Bo,{name:t,control:e,render:({field:e})=>s.jsx(kl,{...e,checked:e.value,onCheckedChange:t=>{!1===t&&a?a(t,e.onChange):e.onChange(t)},value:e.value.toString()})})]}),QL=()=>{const e=Uk(),{user:t,roles:a}=qk(),{showToast:r}=$d(),[o,i]=n.useState(null),{mutate:l,isLoading:c}=(e=>{const t=pr(),{onMutate:n,onSuccess:s,onError:a}=e??{};return fr((e=>(Ag.partial().parse(e.updates),fx.updatePromptPermissions(e))),{onSuccess:(e,n,a)=>{t.invalidateQueries([ex.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{r({status:"success",message:e("com_ui_saved")})},onError:()=>{r({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[d,u]=n.useState(!1),[m,p]=n.useState(Pg.USER),f=n.useMemo((()=>{var e,t;return(null==(e=null==a?void 0:a[m])?void 0:e.permissions)?null==(t=a[m])?void 0:t.permissions[Zh.PROMPTS]:Jg[m].permissions[Zh.PROMPTS]}),[a,m]),{reset:h,control:g,setValue:x,getValues:v,handleSubmit:b,formState:{isSubmitting:_}}=Vo({mode:"onChange",defaultValues:f});if(n.useEffect((()=>{var e,t;h(null==(t=null==(e=null==a?void 0:a[m])?void 0:e.permissions)?void 0:t[Zh.PROMPTS])}),[a,m,h]),(null==t?void 0:t.role)!==Pg.ADMIN)return null;const y=[{promptPerm:Jh.SHARED_GLOBAL,label:e("com_ui_prompts_allow_share")},{promptPerm:Jh.CREATE,label:e("com_ui_prompts_allow_create")},{promptPerm:Jh.USE,label:e("com_ui_prompts_allow_use")}],j=[{label:Pg.USER,onClick:()=>{p(Pg.USER)}},{label:Pg.ADMIN,onClick:()=>{p(Pg.ADMIN)}}];return s.jsxs(s.Fragment,{children:[s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsxs(Si,{size:"sm",variant:"outline",className:"mr-2 h-10 w-fit gap-1 border transition-all dark:bg-transparent dark:hover:bg-surface-tertiary sm:m-0",children:[s.jsx(mt,{className:"cursor-pointer","aria-hidden":"true"}),s.jsx("span",{className:"hidden sm:flex",children:e("com_ui_admin")})]})}),s.jsxs(xl,{className:"max-w-lg border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[s.jsx(_l,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_prompts")}`}),s.jsxs("div",{className:"p-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),s.jsx(Nd,{unmountOnHide:!0,menuId:"prompt-role-dropdown",isOpen:d,setIsOpen:u,trigger:s.jsx(ie,{className:"inline-flex w-1/5 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:m}),items:j,itemClassName:"items-center justify-center",sameWidth:!0})]}),s.jsxs("form",{onSubmit:b((e=>{l({roleName:m,updates:e})})),children:[s.jsx("div",{className:"py-5",children:y.map((({promptPerm:t,label:n})=>s.jsxs("div",{children:[s.jsx(qL,{control:g,promptPerm:t,label:n,getValues:v,setValue:x,...m===Pg.ADMIN&&t===Jh.USE?{confirmChange:(e,t)=>i({newValue:e,callback:t})}:{}}),m===Pg.ADMIN&&t===Jh.USE&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[s.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",s.jsxs("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-blue-500 underline",children:[e("com_ui_more_info"),s.jsx(qt,{size:16,className:"ml-1"})]})]})})]},t)))}),s.jsx("div",{className:"flex justify-end",children:s.jsx(Si,{type:"submit",disabled:_||c,variant:"submit",children:e("com_ui_save")})})]})]})]})]}),s.jsx(ml,{open:null!==o,onOpenChange:e=>{e||i(null)},children:s.jsx(Ud,{showCloseButton:!0,title:e("com_ui_confirm_change"),className:"w-11/12 max-w-lg",main:s.jsx("p",{className:"mb-4",children:e("com_ui_confirm_admin_use_change")}),selection:{selectHandler:()=>{o&&o.callback(o.newValue),i(null)},selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover text-white transition-colors duration-200",selectText:e("com_ui_confirm_action"),isLoading:!1}})})]})},YL=/prompts\/(?!new(?:\/|$)).*$/,XL=e=>{if(!e||e.includes("/d/"))return"new";const t=e.split("/");return t[t.length-1]};function ZL(){const e=De(),t=Uk(),{user:a}=qk(),{prevLocationPath:r}=xS(),o=n.useMemo((()=>XL(r)),[r]),i=Pe(Cy.promptsName),l=Pe(Cy.promptsCategory);Ae(Cy.promptsEditorMode);const c=NT("/c/"+o,n.useCallback((()=>{i(""),l("")}),[i,l])),d=NT("/d/prompts"),u=n.useMemo((()=>YL.test(e.pathname)),[e.pathname]);return s.jsxs("div",{className:"mr-2 mt-2 flex h-10 items-center justify-between",children:[s.jsx(yi,{className:"mt-1 px-2 dark:text-gray-200",children:s.jsxs(ji,{children:[s.jsx(wi,{className:"hover:dark:text-white",children:s.jsxs(Ni,{href:"/",className:"flex flex-row items-center gap-1",onClick:c,children:[s.jsx(Rn,{className:"icon-xs","aria-hidden":"true"}),s.jsx("span",{className:"hidden md:flex",children:t("com_ui_back_to_chat")}),s.jsx("span",{className:"flex md:hidden",children:t("com_ui_chat")})]})}),s.jsx(Ci,{}),s.jsx(wi,{className:"hover:dark:text-white",children:s.jsxs(Ni,{href:"/d/prompts",className:"flex flex-row items-center gap-1",onClick:d,children:[s.jsx(wn,{className:"h-4 w-4 dark:text-gray-300","aria-hidden":"true"}),t("com_ui_prompts")]})})]})}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u&&s.jsx(WL,{}),(null==a?void 0:a.role)===Pg.ADMIN&&s.jsx(QL,{})]})]})}function JL(){const e=nt(),t=Fe(),a=n.useMemo((()=>!(!e.promptId&&"new"!==e["*"])),[e]),r=Qk({permissionType:Zh.PROMPTS,permission:Jh.USE});return n.useEffect((()=>{let e;return r||(e=setTimeout((()=>{t("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[r,t]),r?s.jsx(WS,{children:s.jsxs("div",{className:"flex h-screen w-full flex-col bg-surface-primary p-0 lg:p-2",children:[s.jsx(ZL,{}),s.jsxs("div",{className:"flex w-full flex-grow flex-row divide-x overflow-hidden dark:divide-gray-600",children:[s.jsx(YM,{isDetailView:a,children:s.jsx("div",{className:"mt-1 flex flex-row items-center justify-between px-2 md:px-2",children:s.jsx(ZM,{})})}),s.jsx("div",{className:s_("scrollbar-gutter-stable w-full overflow-y-auto lg:w-3/4 xl:w-3/4",a?"block":"hidden md:block"),children:s.jsx(En,{})})]})]})}):null}function eO({onCheckedChange:e,className:t=""}){const[n,a]=Ie(Cy.alwaysMakeProd),r=Uk();return s.jsxs("div",{className:s_("flex select-none items-center justify-end gap-2 text-xs",t),children:[s.jsx(kl,{id:"alwaysMakeProd",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"alwaysMakeProd","aria-label":"Always make prompt production"}),s.jsxs("div",{children:[r("com_nav_always_make_prod")," "]})]})}const tO=Object.keys(bh).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function nO({fieldName:e="prompt",className:t=""}){const a=n.useId(),r=Uk(),o=Uo(),{setValue:i,getValues:l}=o,[c,d]=n.useState(!1);return s.jsx("div",{className:t,title:`${r("com_ui_add")} ${r("com_ui_special_variables")}`,children:s.jsx(Nd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:c,setIsOpen:d,trigger:s.jsxs(ie,{id:"variables-menu-button","aria-label":`${r("com_ui_add")} ${r("com_ui_special_variables")}`,className:"flex h-8 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[s.jsx(bt,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),r("com_ui_special_variables")]}),items:tO.map((t=>({label:r(t.label)||t.label,onClick:()=>((t,n)=>{const s=l(e)||"",a=s.length>0?"\n\n":"",o=r(t);i(e,s+a+o+": "+n),d(!1)})(t.label,t.value)}))),menuId:a,className:"z-30"})})}const{promptsEditorMode:sO}=Cy,aO=n.memo((({name:e,isEditing:t,setIsEditing:a})=>{const r=Uk(),{control:o}=Uo(),i=Ae(sO),{dirtyFields:l}=Ko({control:o}),{prompt:c}=l,d=n.useMemo((()=>t&&null==(null==c?void 0:c.length)?lc:t?Hc:vn),[t,c]),u=[[ti],[Zo,{detect:!0,ignoreMissing:!0,subset:wb}]];return s.jsxs("div",{className:"flex max-h-[85vh] flex-col sm:max-h-[85vh]",children:[s.jsxs("h2",{className:"flex items-center justify-between rounded-t-xl border border-border-light py-1.5 pl-3 text-sm font-semibold text-text-primary sm:py-2 sm:pl-4 sm:text-base",children:[s.jsx("span",{className:"max-w-[200px] truncate sm:max-w-none",children:r("com_ui_prompt_text")}),s.jsxs("div",{className:"flex flex-shrink-0 flex-row items-center gap-3 sm:gap-6",children:[i===fv.ADVANCED&&s.jsx(eO,{className:"hidden sm:flex"}),s.jsx(nO,{fieldName:e}),s.jsx("button",{type:"button",onClick:()=>a((e=>!e)),"aria-label":r(t?"com_ui_save":"com_ui_edit"),className:"mr-1 rounded-lg p-1.5 sm:mr-2 sm:p-1",children:s.jsx(d,{className:s_("h-5 w-5 sm:h-6 sm:w-6",t?"p-[0.05rem]":"text-secondary-alt hover:text-text-primary")})})]})]}),s.jsxs("div",{role:"button",className:s_("w-full flex-1 overflow-auto rounded-b-xl border border-border-light p-2 shadow-md transition-all duration-150 sm:p-4",{"cursor-pointer bg-surface-primary hover:bg-surface-secondary active:bg-surface-tertiary":!t}),onClick:()=>!t&&a(!0),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!t&&a(!0)},tabIndex:0,children:[!t&&s.jsx(vn,{className:"icon-xl absolute inset-0 m-auto hidden h-6 w-6 text-text-primary opacity-25 group-hover:block sm:h-8 sm:w-8"}),s.jsx(Bo,{name:e,control:o,render:({field:e})=>t?s.jsx(Ll,{...e,autoFocus:!0,className:"w-full resize-none overflow-y-auto rounded bg-transparent text-sm text-text-primary focus:outline-none sm:text-base",minRows:3,maxRows:14,onBlur:()=>a(!1),onKeyDown:e=>{"Escape"===e.key&&(e.preventDefault(),a(!1))}}):s.jsx("div",{className:s_("overflow-y-auto text-sm sm:text-base"),style:{minHeight:"4.5em",maxHeight:"21em",overflow:"auto"},children:s.jsx(Xo,{remarkPlugins:[Jo,ei,[ni,{singleDollarTextMath:!1}]],rehypePlugins:u,components:{p:OM,code:PM},className:"markdown prose dark:prose-invert light my-1 w-full break-words text-text-primary",children:e.value})})})]})]})})),rO=({currentCategory:e,onValueChange:t,className:a=""})=>{const{t:r}=lo(),o=Uo(),[i,l]=n.useState(!1),{hasAccess:c}=qS(),{categories:d,emptyCategory:u}=xE({hasAccess:c}),m=null==o?void 0:o.control,p=null==o?void 0:o.watch,f=null==o?void 0:o.setValue,h=p?p("category"):e,g=n.useMemo((()=>(d??[]).find((t=>t.value===(h??e)))??u),[h,d,e,u]),x=n.useMemo((()=>g.value||"icon"in g?g:{...g,icon:s.jsx("span",{className:"i-heroicons-tag"}),label:g.label||r("com_ui_empty_category")}),[g,r]),v=n.useMemo((()=>d?d.map((e=>({id:e.value,label:e.label,icon:"icon"in e?e.icon:void 0,onClick:()=>{const n=e.value||"";o&&f&&f("category",n,{shouldDirty:!1}),localStorage.setItem(uh.LAST_PROMPT_CATEGORY,n),null==t||t(n),l(!1)}}))):[]),[d,o,f,t]),b=s.jsxs(ie,{className:s_("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary","w-fit gap-2",a),onClick:()=>l(!i),"aria-label":"Prompt's category selector","aria-labelledby":"category-selector-label",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:["icon"in x&&null!=x.icon&&s.jsx("span",{children:x.icon}),s.jsx("span",{children:x.value?x.label:r("com_ui_category")})]}),s.jsx(le,{})]});return o?s.jsx(Bo,{name:"category",control:m,render:()=>s.jsx(Nd,{trigger:b,items:v,isOpen:i,setIsOpen:l,menuId:"category-selector-menu",className:"mt-2",portal:!0})}):s.jsx(Nd,{trigger:b,items:v,isOpen:i,setIsOpen:l,menuId:"category-selector-menu",className:"mt-2",portal:!0})};function oO(){const e=Fe(),t=Uk();return s.jsx("div",{className:"relative min-h-full w-full px-4",children:s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("div",{className:"text-center font-bold dark:text-gray-200",children:[s.jsx("h1",{className:"text-lg font-bold dark:text-gray-200 md:text-2xl",children:t("com_ui_prompt_preview_not_shared")}),s.jsx(Si,{className:"mt-4",onClick:()=>{e("/d/prompts")},children:t("com_ui_back_to_prompts")})]})})})}const iO=({description:e})=>s.jsx(Dl,{description:e,"aria-label":e,render:s.jsx("div",{className:"flex items-center justify-center",children:s.jsx(An,{className:"h-4 w-4 text-amber-500"})})}),lO=({tags:e})=>{const t=Uk();return e.includes("latest")&&e.includes("production")?s.jsx("span",{className:"absolute bottom-3 right-3",children:s.jsx(iO,{description:t("com_ui_latest_production_version")})}):s.jsx("span",{className:"flex gap-1 text-sm",children:e.map(((e,n)=>s.jsx(Dl,{description:t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),"aria-label":t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),render:s.jsx(Ml,{label:e,className:s_("w-24 justify-center border border-transparent","production"===e?"bg-green-100 text-green-500 dark:border-green-500 dark:bg-transparent dark:text-green-500":"bg-blue-100 text-blue-500 dark:border-blue-500 dark:bg-transparent dark:text-blue-500"),labelClassName:"flex items-center m-0 justify-center gap-1",LabelNode:"production"===e?s.jsx("div",{className:"flex items-center",children:s.jsx("span",{className:"slow-pulse size-2 rounded-full bg-green-400"})}):"latest"===e?s.jsx("div",{className:"flex items-center",children:s.jsx(Pn,{className:"size-4"})}):null})},`${e}-${n}`)))})},cO=({prompt:e,index:t,isSelected:n,totalVersions:a,onClick:r,authorName:o,tags:i})=>{const l=Uk();return s.jsx("button",{type:"button",className:s_("group relative w-full rounded-lg border border-border-light p-4 transition-all duration-300",n?"bg-surface-hover shadow-xl":"bg-surface-primary shadow-sm hover:bg-surface-secondary"),onClick:r,"aria-selected":n,role:"tab","aria-label":l("com_ui_version_var",{0:""+(a-t)}),children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-start justify-between lg:flex-col xl:flex-row",children:[s.jsx("h3",{className:"font-bold text-text-primary",children:l("com_ui_version_var",{0:""+(a-t)})}),s.jsx("time",{className:"text-xs text-text-secondary",dateTime:e.createdAt,children:Do(new Date(e.createdAt),"yyyy-MM-dd HH:mm")})]}),s.jsxs("div",{className:"flex items-center gap-1 lg:flex-col xl:flex-row",children:[o&&s.jsxs(ul,{className:"text-left text-xs text-text-secondary",children:["by ",o]}),i.length>0&&s.jsx(lO,{tags:i})]})]})})},dO=({prompts:e,group:t,selectionIndex:n,setSelectionIndex:a})=>{const r=Uk();return s.jsxs("section",{className:"my-6","aria-label":"Prompt Versions",children:[s.jsx("header",{className:"mb-6",children:s.jsxs("h2",{className:"flex items-center gap-2 text-base font-semibold text-text-primary",children:[s.jsx(In,{className:"h-5 w-5 text-green-500"}),r("com_ui_versions")]})}),s.jsx("div",{className:"flex flex-col gap-3",role:"tablist","aria-label":"Version history",children:e.map(((r,o)=>{const i=[];return 0===o&&i.push("latest"),r._id===(null==t?void 0:t.productionId)&&i.push("production"),s.jsx(cO,{prompt:r,index:o,isSelected:o===n,totalVersions:e.length,onClick:()=>a(o),authorName:null==t?void 0:t.authorName,tags:i},r._id)}))})]})},uO=({name:e,disabled:t,selectHandler:n})=>{const a=Uk();return s.jsxs(ml,{children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"destructive",size:"sm","aria-label":"Delete version",className:"h-10 w-10 p-0.5",disabled:t,onClick:e=>{e.stopPropagation()},children:s.jsx(jn,{className:"size-5 cursor-pointer text-white"})})}),s.jsx(Ud,{showCloseButton:!1,title:a("com_ui_delete_prompt"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsx(ul,{htmlFor:"dialog-delete-confirm-prompt",className:"text-left text-sm font-medium",children:a("com_ui_delete_confirm_prompt_version_var",{0:e})})})})}),selection:{selectHandler:n,selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover transition-colors duration-200 text-white",selectText:a("com_ui_delete")}})]})},mO=S.memo((({promptId:e,groupId:t,promptName:a,disabled:r})=>{const o=(e=>{const t=pr(),{onSuccess:n,...s}={},a=Ae(Cy.promptsName),r=Ae(Cy.promptsPageSize),o=Ae(Cy.promptsCategory);return fr({mutationFn:e=>fx.deletePrompt(e),...s,onSuccess:(e,s,i)=>{if(e.promptGroup){const n=e.promptGroup.id;t.setQueryData([ex.promptGroups,a,o,r],(e=>e?Gb(e,n):e)),Qb(t,n)}else t.setQueryData([ex.prompts,s.groupId],(e=>{const n=e?e.filter((e=>e._id!==s._id)):[];return t.setQueryData([ex.promptGroup,s.groupId],(e=>{if(!e)return e;e.productionId===s._id&&(e.productionId=n[0]._id,e.productionPrompt=n[0])})),n}));n&&n(e,s,i)}})})(),i=n.useCallback((()=>{e?o.mutate({_id:e,groupId:t}):console.warn("No prompt ID provided for deletion")}),[e,t,o]);return e?s.jsx(uO,{name:a,disabled:r||!e,selectHandler:i}):null}));function pO(){return s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col items-center justify-between px-4 dark:text-gray-200 sm:flex-row",children:s.jsx(Cl,{className:"mb-1 flex h-10 w-32 flex-row items-center font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"})}),s.jsx("div",{className:"flex h-full w-full flex-col md:flex-row",children:s.jsx("div",{className:"flex-1 overflow-y-auto border-border-medium-alt p-4 md:max-h-[calc(100vh-150px)] md:border-r",children:s.jsx(Cl,{className:"h-96"})})})]})}mO.displayName="DeletePrompt";const fO=S.memo((({group:e,disabled:t})=>{const{user:n}=qk(),a=Qk({permissionType:Zh.PROMPTS,permission:Jh.SHARED_GLOBAL}),r=(null==e?void 0:e._id)||"",{hasPermission:o,isLoading:i}=zE(Qg.PROMPTGROUP,r);if(!e||!r)return null;const l=o(Yg.SHARE);return(e.author===(null==n?void 0:n.id)||(null==n?void 0:n.role)===Pg.ADMIN||l)&&a&&!i?s.jsx(vP,{resourceDbId:r,resourceName:e.name,resourceType:Qg.PROMPTGROUP,disabled:t,children:s.jsx(Si,{variant:"default",size:"sm","aria-label":"Share prompt",className:"h-10 w-10 border border-transparent bg-blue-500/90 p-0.5 transition-all hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-800",disabled:t,children:s.jsx(Qt,{className:"size-5 cursor-pointer text-white"})})}):null}));fO.displayName="SharePrompt";const hO=S.memo((({group:e,prompts:t,selectedPrompt:n,selectedPromptId:a,isLoadingPrompts:r,canEdit:o,selectionIndex:i,setSelectionIndex:l})=>{const c=Uk(),{showToast:d}=$d(),u=Ae(Cy.promptsEditorMode),m=Qk({permissionType:Zh.PROMPTS,permission:Jh.SHARED_GLOBAL}),p=Dj({onError:()=>{d({status:"error",message:c("com_ui_prompt_update_error")})}}),f=zj(),h=(null==e?void 0:e._id)||"",g=(null==e?void 0:e.name)||"",x=(null==e?void 0:e.category)||"",v=!e;return s.jsxs("div",{className:"h-full w-full overflow-y-auto bg-surface-primary px-4",style:{maxHeight:"calc(100vh - 100px)"},children:[s.jsxs("div",{className:"mb-2 flex flex-col lg:flex-row lg:items-center lg:justify-center lg:gap-x-2 xl:flex-row xl:space-y-0",children:[s.jsx(rO,{currentCategory:x,onValueChange:o?e=>p.mutate({id:h,payload:{name:g,category:e}}):void 0}),s.jsxs("div",{className:"mt-2 flex flex-row items-center justify-center gap-x-2 lg:mt-0",children:[m&&s.jsx(fO,{group:e,disabled:v}),u===fv.ADVANCED&&o&&s.jsx(Si,{variant:"submit",size:"sm","aria-label":"Make prompt production",className:"h-10 w-10 border border-transparent p-0.5 transition-all",onClick:()=>{if(!n)return void console.warn("No prompt is selected");const{_id:e="",prompt:t}=n;f.mutate({id:e,groupId:h,productionPrompt:{prompt:t}})},disabled:v||!n||n._id===(null==e?void 0:e.productionId)||f.isLoading||!o,children:s.jsx(Mn,{className:"size-5 cursor-pointer text-white"})}),s.jsx(mO,{promptId:a,groupId:h,promptName:g,disabled:v})]})]}),u===fv.ADVANCED&&(r?Array.from({length:6}).map(((e,t)=>s.jsx("div",{className:"my-2",children:s.jsx(Cl,{className:"h-[72px] w-full"})},t))):t.length>0&&s.jsx(dO,{group:e,prompts:t,selectionIndex:i,setSelectionIndex:l}))]})}));hO.displayName="RightPanel";const gO=()=>{const e=nt(),t=Uk(),{showToast:a}=$d(),{hasAccess:r}=qS(),o=Ae(Cy.alwaysMakeProd),i=e.promptId||"",l=Ae(Cy.promptsEditorMode),[c,d]=n.useState(0),u=n.useRef(!1),[m,p]=n.useState(!1),[f,h]=n.useState(!0),[g,x]=n.useState(!1),v="320px",{data:b,isLoading:_}=(y=i,j={enabled:r&&!!i},mr([ex.promptGroup,y],(()=>fx.getPromptGroup(y)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...j,enabled:void 0===(null==j?void 0:j.enabled)||j.enabled}));var y,j;const{data:w=[],isLoading:N}=((e,t)=>mr([ex.prompts,e.groupId??""],(()=>fx.getPrompts(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0===(null==t?void 0:t.enabled)||t.enabled}))({groupId:i},{enabled:r&&!!i}),{hasPermission:C,isLoading:k}=zE(Qg.PROMPTGROUP,(null==b?void 0:b._id)||""),S=C(Yg.EDIT),T=C(Yg.VIEW),E=Vo({defaultValues:{prompt:"",promptName:b?b.name:"",category:b?b.category:""}}),{handleSubmit:R,setValue:I,reset:P,watch:A}=E,M=A("prompt"),L=n.useMemo((()=>w.length>0?w[c]:void 0),[w,c]),O=n.useMemo((()=>null==L?void 0:L._id),[null==L?void 0:L._id]),{groupsQuery:D}=qS(),F=Dj({onError:()=>{a({status:"error",message:t("com_ui_prompt_update_error")})}}),z=zj(),U=(e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr({mutationFn:({groupId:e,...t})=>fx.addPromptToGroup(e,t),...s,onSuccess:(e,s,a)=>{const{prompt:r}=e;t.setQueryData([ex.prompts,s.prompt.groupId],(e=>[r,...e??[]])),n&&n(e,s,a)}})})({onMutate:e=>{P({prompt:e.prompt.prompt,category:(null==b?void 0:b.category)||""},{keepDirtyValues:!0})},onSuccess(e){o&&null!=e.prompt._id&&e.prompt._id&&e.prompt.groupId&&z.mutate({id:e.prompt._id,groupId:e.prompt.groupId,productionPrompt:{prompt:e.prompt.prompt}}),P({prompt:e.prompt.prompt,promptName:(null==b?void 0:b.name)||"",category:(null==b?void 0:b.category)||""})}}),V=n.useCallback((e=>{if(!S)return;if(!e)return;if(!L)return;const t=L.groupId||(null==b?void 0:b._id);if(!t)return void console.error("No groupId available");const n={prompt:{type:L.type??"text",groupId:t,prompt:e}};e!==L.prompt&&U.mutate({...n,groupId:t})}),[L,b,U,S]),B=n.useCallback((()=>{_||N||h(!1)}),[_,N]);n.useEffect((()=>{u.current&&!m&&S&&R((e=>V(e.prompt)))(),u.current=m}),[m,V,R,S]),n.useEffect((()=>{B()}),[e.promptId,l,null==b?void 0:b.productionId,w,B]),n.useEffect((()=>{I("prompt",L?L.prompt:"",{shouldDirty:!1}),I("category",b?b.category:"",{shouldDirty:!1})}),[L,b,I]),n.useEffect((()=>{const e=()=>{window.matchMedia("(min-width: 1022px)").matches&&x(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const $=n.useMemo((()=>ko(((e,t,n)=>{n({id:e,payload:{oneliner:t}})}),950)),[]),H=n.useMemo((()=>ko(((e,t,n)=>{n({id:e,payload:{command:t}})}),950)),[]),G=n.useCallback((e=>{if(!b||!b._id)return console.warn("Group not found");$(b._id,e,F.mutate)}),[b,F.mutate,$]),K=n.useCallback((e=>{if(!b||!b._id)return console.warn("Group not found");H(b._id,e,F.mutate)}),[b,F.mutate,H]);if(f)return s.jsx(pO,{});if(!S&&!k&&D.data){const t=Wb(D.data,(t=>t._id===e.promptId));if(!t&&!T)return s.jsx(oO,{});if(t||b)return s.jsx(HM,{group:t||b})}if(!b||null==b._id)return null;const W=b.name;return s.jsx($o,{...E,children:s.jsx("form",{className:"mt-4 flex w-full",onSubmit:R((e=>V(e.prompt))),children:s.jsxs("div",{className:"relative w-full",children:[s.jsx("div",{className:"h-full w-full",style:{transform:`translateX(${g?`-${v}`:"0"})`,transition:"transform 0.3s ease-in-out"},children:s.jsxs("div",{className:"flex h-full",children:[s.jsxs("div",{className:"flex-1 overflow-hidden px-4",children:[s.jsx("div",{className:"mb-4 flex items-center gap-2 text-text-primary",children:_?s.jsx(Cl,{className:"mb-1 flex h-10 w-32 font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"}):s.jsxs(s.Fragment,{children:[s.jsx(HL,{name:W,onSave:e=>{S&&b._id&&F.mutate({id:b._id,payload:{name:e}})}}),s.jsx("div",{className:"flex-1"}),s.jsx(Si,{type:"button",variant:"ghost",className:"h-10 w-10 border border-border-light p-0 lg:hidden",onClick:()=>x(!0),"aria-label":t("com_endpoint_open_menu"),children:s.jsx(gn,{className:"size-5"})}),s.jsx("div",{className:"hidden lg:block",children:l===fv.SIMPLE&&s.jsx(hO,{group:b,prompts:w,selectedPrompt:L,selectionIndex:c,selectedPromptId:O,isLoadingPrompts:N,canEdit:S,setSelectionIndex:d})})]})}),N?s.jsx(Cl,{className:"h-96","aria-live":"polite"}):s.jsxs("div",{className:"mb-2 flex h-full flex-col gap-4",children:[s.jsx(aO,{name:"prompt",isEditing:m,setIsEditing:e=>S&&p(e)}),s.jsx(VM,{promptText:M}),s.jsx(BM,{initialValue:b.oneliner??"",onValueChange:S?G:void 0,disabled:!S}),s.jsx($M,{initialValue:b.command??"",onValueChange:S?K:void 0,disabled:!S})]})]}),l===fv.ADVANCED&&s.jsx("div",{className:"hidden w-1/4 border-l border-border-light lg:block",children:s.jsx(hO,{group:b,prompts:w,selectionIndex:c,selectedPrompt:L,selectedPromptId:O,isLoadingPrompts:N,canEdit:S,setSelectionIndex:d})})]})}),s.jsx("button",{type:"button",className:s_("absolute inset-0 z-40 cursor-default",g?"opacity-100":"pointer-events-none opacity-0"),style:{transition:"opacity 0.3s ease-in-out"},onClick:()=>x(!1),"aria-hidden":!g,tabIndex:g?0:-1,"aria-label":t("com_ui_close_menu")}),s.jsx("div",{className:"absolute inset-y-0 right-0 z-50 lg:hidden",style:{width:v,transform:`translateX(${g?"0":"100%"})`,transition:"transform 0.3s ease-in-out"},role:"dialog","aria-modal":"true","aria-label":"Mobile navigation panel",children:s.jsx("div",{className:"h-full",children:s.jsx("div",{className:"h-full overflow-auto",children:s.jsx(hO,{group:b,prompts:w,selectionIndex:c,selectedPrompt:L,selectedPromptId:O,isLoadingPrompts:N,canEdit:S,setSelectionIndex:d})})})})]})})})};function xO(){const e=Uk();return s.jsx("div",{className:"h-full w-full content-center text-center font-bold text-text-secondary",children:e("com_ui_select_or_create_prompt")})}const vO={name:"",prompt:"",type:"text",category:"",oneliner:void 0,command:void 0},bO=({defaultValues:e=vO})=>{const t=Uk(),a=Fe(),{hasAccess:r}=qS(),o=Qk({permissionType:Zh.PROMPTS,permission:Jh.CREATE}),i=r&&o;n.useEffect((()=>{let e;return i||(e=setTimeout((()=>{a("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[i,a]);const l=Vo({defaultValues:{...e,category:localStorage.getItem(uh.LAST_PROMPT_CATEGORY)??""}}),{watch:c,control:d,handleSubmit:u,formState:{isDirty:m,isSubmitting:p,errors:f,isValid:h}}=l,g=Fj({onSuccess:e=>{a(`/d/prompts/${e.prompt.groupId}`,{replace:!0})}}),x=c("prompt");return i?s.jsx($o,{...l,children:s.jsxs("form",{onSubmit:u((e=>{const{name:t,category:n,oneliner:s,command:a,...r}=e,o={name:t,category:n};((null==s?void 0:s.length)??0)>0&&(o.oneliner=s),((null==a?void 0:a.length)??0)>0&&(o.command=a),g.mutate({prompt:r,group:o})})),className:"w-full px-4 py-2",children:[s.jsx("div",{className:"mb-1 flex flex-col items-center justify-between font-bold sm:text-xl md:mb-0 md:text-2xl",children:s.jsxs("div",{className:"flex w-full flex-col items-center justify-between sm:flex-row",children:[s.jsx(Bo,{name:"name",control:d,rules:{required:t("com_ui_prompt_name_required")},render:({field:e})=>s.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[s.jsx(cl,{...e,type:"text",className:"mr-2 w-full border border-border-medium p-2 text-2xl text-text-primary placeholder:text-text-tertiary dark:placeholder:text-text-secondary",placeholder:`${t("com_ui_prompt_name")}*`,tabIndex:0}),s.jsx("div",{className:s_("mt-1 w-56 text-sm text-red-500",f.name?"visible h-auto":"invisible h-0"),children:f.name?f.name.message:" "})]})}),s.jsx(rO,{})]})}),s.jsxs("div",{className:"flex w-full flex-col gap-4 md:mt-[1.075rem]",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-medium py-2 pl-4 pr-1 text-base font-semibold dark:text-gray-200",children:[s.jsxs("span",{children:[t("com_ui_prompt_text"),"*"]}),s.jsx(nO,{fieldName:"prompt",className:"mr-2"})]}),s.jsx("div",{className:"min-h-32 rounded-b-lg border border-border-medium p-4 transition-all duration-150",children:s.jsx(Bo,{name:"prompt",control:d,rules:{required:t("com_ui_prompt_text_required")},render:({field:e})=>s.jsxs("div",{children:[s.jsx(Ll,{...e,className:"w-full rounded border border-border-medium px-2 py-1 focus:outline-none dark:bg-transparent dark:text-gray-200",minRows:6,tabIndex:0}),s.jsx("div",{className:"mt-1 text-sm text-red-500 "+(f.prompt?"visible h-auto":"invisible h-0"),children:f.prompt?f.prompt.message:" "})]})})})]}),s.jsx(VM,{promptText:x}),s.jsx(BM,{onValueChange:e=>l.setValue("oneliner",e),tabIndex:0}),s.jsx($M,{onValueChange:e=>l.setValue("command",e),tabIndex:0}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx(Si,{"aria-label":t("com_ui_create_prompt"),tabIndex:0,type:"submit",disabled:!m||p||!h,children:t("com_ui_create_prompt")})})]})]})}):null};function _O(){const e=pr(),{isAuthenticated:t}=qk(),a=(()=>{const e=De(),t=n.useRef();return n.useEffect((()=>{var n;t.current=null==(n=e.state)?void 0:n.prevLocation}),[e]),t})(),r=Cy.useClearConvoState(),[o,i]=n.useState("");return n.useEffect((()=>{var e;i((null==(e=a.current)?void 0:e.pathname)||"")}),[a]),n.useEffect((()=>{e.removeQueries([ex.messages,"new"]),r()}),[e,r]),t?s.jsx(gS.Provider,{value:{prevLocationPath:o},children:s.jsx("div",{className:"h-screen w-full",children:s.jsx(En,{})})}):null}const yO={path:"d/*",element:s.jsx(_O,{}),children:[{path:"prompts/*",element:s.jsx(JL,{}),children:[{index:!0,element:s.jsx(xO,{})},{path:"new",element:s.jsx(bO,{})},{path:":promptId",element:s.jsx(gO,{})}]},{path:"*",element:s.jsx(Ln,{to:"/d/files",replace:!0})}]};function jO({message:e,searchResults:t}){const a=Uk(),[r,o]=n.useState(!1),i=sE({text:e.text,content:e.content,searchResults:t});return s.jsx("div",{className:"visible mt-0 flex justify-center gap-1 self-end text-gray-400 lg:justify-start",children:s.jsx("button",{className:"ml-0 flex items-center gap-1.5 rounded-md p-1 text-xs hover:text-gray-900 dark:text-gray-400/70 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400 md:group-hover:visible md:group-[.final-completion]:visible",onClick:()=>i(o),type:"button",title:a(r?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),children:r?s.jsx(ic,{className:"h-[18px] w-[18px]"}):s.jsx(oc,{})})})}const wO={[ah.MODERATION]:"com_error_moderation",[ah.NO_USER_KEY]:"com_error_no_user_key",[ah.INVALID_USER_KEY]:"com_error_invalid_user_key",[ah.NO_BASE_URL]:"com_error_no_base_url",[ah.INVALID_ACTION]:`com_error_${ah.INVALID_ACTION}`,[ah.INVALID_REQUEST]:`com_error_${ah.INVALID_REQUEST}`,[ah.MISSING_MODEL]:(e,t)=>{const{info:n}=e;return t("com_error_missing_model",{0:qf[n??""]??n??"unknown"})},[ah.MODELS_NOT_LOADED]:"com_error_models_not_loaded",[ah.ENDPOINT_MODELS_NOT_LOADED]:(e,t)=>{const{info:n}=e;return t("com_error_endpoint_models_not_loaded",{0:qf[n??""]??n??"unknown"})},[ah.NO_SYSTEM_MESSAGES]:`com_error_${ah.NO_SYSTEM_MESSAGES}`,[ah.EXPIRED_USER_KEY]:(e,t)=>{const{expiredAt:n,endpoint:s}=e;return t("com_error_expired_user_key",{0:s,1:n})},[ah.INPUT_LENGTH]:(e,t)=>{const{info:n}=e;return t("com_error_input_length",{0:n})},[ah.INVALID_AGENT_PROVIDER]:(e,t)=>{const{info:n}=e;return t("com_error_invalid_agent_provider",{0:qf[n]??n})},[ah.GOOGLE_ERROR]:e=>{const{info:t}=e;return t},[ah.GOOGLE_TOOL_CONFLICT]:"com_error_google_tool_conflict",[sh.BAN]:"Your account has been temporarily banned due to violations of our service.",[sh.ILLEGAL_MODEL_REQUEST]:(e,t)=>{const{info:n}=e,[s,a="unknown"]=(null==n?void 0:n.split("|"))??[];return t("com_error_illegal_model_request",{0:a,1:qf[s??""]??s??"unknown"})},invalid_api_key:'Invalid API key. Please check your API key and try again. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',insufficient_quota:'We apologize for any inconvenience caused. The default API key has reached its limit. To continue using this service, please set up your own API key. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',concurrent:e=>{const{limit:t}=e;return`Only ${t} message${t>1?"s":""} at a time. Please allow any other responses to complete before sending another message, or wait one minute.`},message_limit:e=>{const{max:t,windowInMinutes:n}=e;return`You hit the message limit. You have a cap of ${t} message${t>1?"s":""} per ${n>1?`${n} minutes`:"minute"}.`},token_balance:e=>{const{balance:t,tokenCost:n,promptTokens:a,generations:r}=e,o=`Insufficient Funds! Balance: ${t}. Prompt tokens: ${a}. Cost: ${n}.`;return s.jsxs(s.Fragment,{children:[o,r&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("br",{})]}),r&&s.jsx(RM,{lang:"Generations",error:!0,codeChildren:Rv(JSON.stringify(r))})]})}},NO=({text:e})=>{const t=Uk(),n=function(e){let t=0,n=-1;for(let s=0;s<e.length;s++)if("{"===e[s])0===t&&(n=s),t++;else if("}"===e[s]&&(t--,0===t&&-1!==n))return e.slice(n,s+1);return""}(e),s=`Something went wrong. Here's the specific error message we encountered: ${e.length>512&&!n?e.slice(0,512)+"...":e}`;if(!Ev(n))return s;const a=JSON.parse(n),r=a.code||a.type,o=r&&wO[r];return o&&"function"==typeof wO[r]?wO[r](a,t):o&&o.startsWith("com_error")?t(wO[r]):o?wO[r]:s},CO=({text:e,message:t,isSubmitting:a,ask:r,enterEdit:o,siblingIdx:i,setSiblingIdx:l})=>{const{addedIndex:c}=oS(),d=n.useRef(null),u=n.useRef(null),{conversation:m}=ZS(),{getMessages:p,setMessages:f}=JS(),[h,g]=Ie(Cy.latestMessageFamily(c)),x=n.useRef(null),{conversationId:v,parentMessageId:b,messageId:_}=t,y=function(e){var t=pr();return fr((function(e){return function(e){var t=e.conversationId,n=e.messageId,s=e.text;if(!t)throw new Error("conversationId is required");return YC.put(EN({conversationId:t,messageId:n}),{text:s})}(e)}),{onSuccess:function(){t.invalidateQueries([XC.messages,e])}})}(v??""),j=Uk(),w="rtl"===Ae(Cy.chatDirection).toLowerCase(),{register:N,handleSubmit:C,setValue:k}=Vo({defaultValues:{text:e??""}});n.useEffect((()=>{const e=x.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const S=n.useCallback((e=>{var t,n;"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(t=u.current)||t.click()),"s"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(n=d.current)||n.click()),"Escape"===e.key&&(e.preventDefault(),o(!0))}),[o]),{ref:T,...E}=N("text",{required:!0,onChange:e=>{k("text",e.target.value,{shouldValidate:!0})}});return s.jsxs(kM,{message:t,children:[s.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:s.jsx(Ll,{...E,ref:e=>{T(e),x.current=e},onKeyDown:S,"data-testid":"message-text-editor",className:s_("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",w?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",p_),dir:w?"rtl":"ltr"})}),s.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[s.jsx(Dl,{description:"Ctrl + Enter / ⌘ + Enter",render:s.jsx("button",{ref:u,className:"btn btn-primary relative mr-2",disabled:a,onClick:C((e=>{if(t.isCreatedByUser)r({text:e.text,parentMessageId:b,conversationId:v},{overrideFiles:t.files}),l((i??0)-1);else{const t=p(),n=null==t?void 0:t.find((e=>e.messageId===b));if(!n)return;r({...n},{editedText:e.text,editedMessageId:_,isRegenerate:!0,isEdited:!0}),l((i??0)-1)}o(!0)})),children:j("com_ui_save_submit")})}),s.jsx(Dl,{description:"Shift + Enter",render:s.jsx("button",{ref:d,className:"btn btn-secondary relative mr-2",disabled:a,onClick:C((e=>{const n=p();if(!n)return;y.mutate({conversationId:v??"",model:(null==m?void 0:m.model)??"gpt-3.5-turbo",text:e.text,messageId:_}),t.messageId===(null==h?void 0:h.messageId)&&g({...h,text:e.text});n.some((e=>e.messageId===_))?f(n.map((t=>t.messageId===_?{...t,text:e.text}:t))):t.text=e.text,o(!0)})),children:j("com_ui_save")})}),s.jsx(Dl,{description:"Esc",render:s.jsx("button",{className:"btn btn-neutral relative",onClick:()=>o(!0),children:j("com_ui_cancel")})})]})]})},kO=({text:e,message:t,className:a=""})=>{const r=Uk();return"Error connecting to server, try refreshing the page."===e?(console.log("error message",t),s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:s.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:s.jsx("div",{className:"absolute",children:s.jsx("p",{className:"submitting relative",children:s.jsx("span",{className:"result-thinking"})})})})}),children:s.jsx(kd,{delay:5500,children:s.jsx(kM,{message:t,children:s.jsx("div",{className:s_("rounded-md border border-red-500 bg-red-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",a),children:r("com_ui_error_connection")})})})})):s.jsx(kM,{message:t,children:s.jsx("div",{role:"alert","aria-live":"assertive",className:s_("rounded-xl border border-red-500/20 bg-red-500/5 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",a),children:s.jsx(NO,{text:e})})})},SO=({text:e,isCreatedByUser:t,message:a,showCursor:r})=>{const{isSubmitting:o=!1,isLatestMessage:i=!1}=hS(),l=Ae(Cy.enableUserMsgMarkdown),c=n.useMemo((()=>!0===r&&o),[r,o]);let d;return d=t?l?s.jsx(DA,{content:e}):s.jsx(s.Fragment,{children:e}):s.jsx(nM,{content:e,isLatestMessage:i}),s.jsx(kM,{message:a,children:s.jsx("div",{className:s_(o?"submitting":"",c&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!l&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:d})})},TO=({message:e})=>s.jsx(kO,{message:e,text:"The response is incomplete; it's either still processing, was cancelled, or censored. Refresh or try a different prompt."}),EO=n.memo((({text:e,edit:t,error:a,unfinished:r,isSubmitting:o,isLast:i,...l})=>{const{message:c}=l,{messageId:d}=c,{thinkingContent:u,regularContent:m}=n.useMemo((()=>{const t=e.match(/:::thinking([\s\S]*?):::/);return{thinkingContent:t?t[1].trim():"",regularContent:t?e.replace(/:::thinking[\s\S]*?:::/,"").trim():e}}),[e]),p=n.useMemo((()=>i&&o),[i,o]),f=n.useMemo((()=>!o&&r?s.jsx(n.Suspense,{children:s.jsx(kd,{delay:250,children:s.jsx(TO,{message:c})})}):null),[o,r,c]);return a?s.jsx(kO,{message:l.message,text:e}):t?s.jsx(CO,{text:e,isSubmitting:o,...l}):s.jsxs(s.Fragment,{children:[u.length>0&&s.jsx(pM,{children:u},`thinking-${d}`),s.jsx(SO,{showCursor:p,text:m,...l},`display-${d}`),f]})}));class RO extends n.Component{constructor(){super(...arguments),t(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){var n,s;console.error("Sources error:",e),null==(s=(n=this.props).onError)||s.call(n,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:s.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[s.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:"Sources temporarily unavailable"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":"Reload the page",children:"Refresh"})]}):this.props.children}}function IO({source:e,expanded:t=!1}){const n=Uk(),a=zA(e.link);return t?s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(UA,{domain:a}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("span",{className:"mt-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet})]})]}):s.jsx("span",{className:"not-prose relative inline-block h-full w-full",children:s.jsx(zt,{showTimeout:150,hideTimeout:150,children:s.jsxs("div",{className:"flex h-full items-center",children:[s.jsx(Ut,{render:s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(UA,{domain:a}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),s.jsx("div",{className:"mt-1",children:s.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link})})]})}),s.jsxs($t,{className:"absolute right-2 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(Bt,{children:n("com_citation_more_details",{label:a})}),s.jsx(Pt,{className:"icon-sm"})]}),s.jsx(Ht,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"mb-2 flex items-center",children:[s.jsx(UA,{domain:a,className:"mr-2"}),s.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||a})]}),s.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]}),"imageUrl"in e&&e.imageUrl&&s.jsx("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md",children:s.jsx("img",{src:e.imageUrl,alt:e.title||n("com_sources_image_alt"),className:"h-full w-full object-cover"})})]})})]})})})}function PO({image:e}){const t=Uk();return s.jsx("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"group overflow-hidden rounded-lg bg-surface-secondary transition-all duration-300 hover:bg-surface-tertiary",children:e.imageUrl&&s.jsxs("div",{className:"relative aspect-square w-full overflow-hidden",children:[s.jsx("img",{src:e.imageUrl,alt:e.title||t("com_sources_image_alt"),className:"size-full object-cover"}),e.title&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 w-full border-none bg-gray-900/80 p-1 text-xs font-medium text-white backdrop-blur-sm",children:s.jsx("span",{className:"truncate",children:e.title})})]})})}function AO(e,t){return t&&0!==Object.keys(t).length?[...e].sort(((e,n)=>{const s=t[e]||0;return(t[n]||0)-s})):e}const MO=S.memo((function({file:e,messageId:t,conversationId:a,expanded:r=!1}){var o;const i=Uk(),l=Ae(Cy.user),{showToast:c}=$d(),{refetch:d}=Zy((null==l?void 0:l.id)??"",e.file_id);n.useCallback((e=>{var t,n,s,a,r;const o=JSON.stringify(e),l=e,c=(null==(t=null==e?void 0:e.message)?void 0:t.includes("local files"))||(null==(a=null==(s=null==(n=null==l?void 0:l.response)?void 0:n.data)?void 0:s.error)?void 0:a.includes("local files"))||403===(null==(r=null==l?void 0:l.response)?void 0:r.status)||o.includes("local files")||o.includes("403");return i(c?"com_sources_download_local_unavailable":"com_sources_download_failed")}),[i]);const u="local"===(null==(o=e.metadata)?void 0:o.storageType),m=n.useCallback((async t=>{if(t.preventDefault(),t.stopPropagation(),!u)try{const t=await d();if(null==t.data||""===t.data)return console.error("Error downloading file: No data found"),void c({status:"error",message:i("com_ui_download_error")});const n=document.createElement("a");n.href=t.data,n.setAttribute("download",e.filename),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t.data)}catch(n){console.error("Error downloading file:",n)}}),[d,e.filename,u,i,c]),p=n.useMemo((()=>{var t;const n=(null==(t=e.type)?void 0:t.toLowerCase())||"";return n.includes("pdf")?"📄":n.includes("image")?"🖼️":n.includes("text")?"📝":n.includes("word")||n.includes("doc")?"📄":n.includes("excel")||n.includes("sheet")?"📊":n.includes("powerpoint")||n.includes("presentation")?"📈":"📎"}),[e.type]),f=i("com_sources_download_aria_label",{filename:e.filename,status:""});return r?s.jsxs("button",{onClick:u?void 0:m,disabled:false,className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(u?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":u?i("com_sources_download_local_unavailable"):f,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-base",children:p}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:i("com_sources_agent_file")}),!u&&s.jsx(On,{className:"ml-auto h-3 w-3"})]}),s.jsxs("div",{className:"mt-1 min-w-0",children:[s.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[i("com_sources_pages"),":"," ",AO(e.pages,e.pageRelevance).join(", ")]}),e.bytes&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-xs text-text-secondary",children:[(e.bytes/1024).toFixed(1)," KB"]})]}),null]}):s.jsxs("button",{onClick:u?void 0:m,disabled:false,className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(u?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":u?i("com_sources_download_local_unavailable"):f,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-base",children:p}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:i("com_sources_agent_file")}),!u&&s.jsx(On,{className:"ml-auto h-3 w-3"})]}),s.jsxs("div",{className:"mt-1 min-w-0",children:[s.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&s.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[i("com_sources_pages"),":"," ",AO(e.pages,e.pageRelevance).join(", ")]})]}),null]})}));function LO({sources:e,start:t=0,end:n=3}){let a=[t,n];return t<0&&(a=[t]),s.jsx("div",{className:"relative flex",children:e.slice(...a).map(((e,t)=>s.jsx(UA,{domain:zA(e.link),className:t>0?"ml-[-6px]":""},`icon-${t}`)))})}const OO=S.memo((function({sources:e,limit:t=3}){const a=Uk(),{visibleSources:r,remainingSources:o,hasMoreSources:i}=n.useMemo((()=>{const n=e.slice(0,t),s=e.slice(t);return{visibleSources:n,remainingSources:s,hasMoreSources:s.length>0}}),[e,t]);return s.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:s.jsxs(ml,{children:[r.map(((e,t)=>s.jsx("div",{className:"w-full min-w-[120px]",children:s.jsx(IO,{source:e})},`source-${t}`))),i&&s.jsx(pl,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(LO,{sources:o}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a("com_sources_more_sources",{count:o.length})})]})}),s.jsxs(xl,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[s.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[s.jsx(_l,{className:"text-base font-medium",children:a("com_sources_title")}),s.jsx(hl,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":a("com_ui_close"),children:s.jsx(vt,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:s.jsx("div",{className:"flex flex-col gap-2",children:[...r,...o].map(((e,t)=>s.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex gap-2 rounded-lg px-2 py-2 transition-colors hover:bg-surface-tertiary",children:[s.jsx(UA,{domain:zA(e.link),className:"h-5 w-5 flex-shrink-0"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h3",{className:"mb-0.5 truncate text-sm font-medium text-text-primary",children:e.title||e.link}),"snippet"in e&&e.snippet&&s.jsx("p",{className:"mb-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet}),s.jsx("span",{className:"text-xs text-text-secondary-alt",children:zA(e.link)})]}),"imageUrl"in e&&e.imageUrl&&s.jsx("div",{className:"hidden h-12 w-12 flex-shrink-0 overflow-hidden rounded-md sm:block",children:s.jsx("img",{src:e.imageUrl,alt:e.title||a("com_sources_image_alt"),className:"h-full w-full object-cover"})})]},`more-source-${t}`)))})})]})]})})}));function DO({files:e,messageId:t,conversationId:n,limit:a=3}){const r=Uk(),o=e.length<=a+1?e.length:a,i=e.slice(0,o),l=e.slice(o),c=l.length>0;return s.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:s.jsxs(ml,{children:[i.map(((e,a)=>s.jsx("div",{className:"w-full min-w-[120px]",children:s.jsx(MO,{file:e,messageId:t,conversationId:n})},`file-${a}`))),c&&s.jsx(pl,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"relative flex",children:l.slice(0,3).map(((e,t)=>s.jsx(zn,{className:"h-4 w-4 "+(t>0?"ml-[-6px]":"")},`file-icon-${t}`)))}),s.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:r("com_sources_more_files",{count:l.length})})]})}),s.jsxs(xl,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[s.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[s.jsx(_l,{className:"text-base font-medium",children:r("com_sources_agent_files")}),s.jsx(hl,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":r("com_ui_close"),children:s.jsx(vt,{className:"h-4 w-4"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:s.jsx("div",{className:"flex flex-col gap-2",children:[...i,...l].map(((e,a)=>s.jsx(MO,{file:e,messageId:t,conversationId:n,expanded:!0},`more-file-${a}`)))})})]})]})})}function FO({label:e,icon:t}){return s.jsxs("div",{className:"flex items-center gap-2 rounded-md px-3 py-1 text-sm transition-colors hover:bg-surface-tertiary hover:text-text-primary",children:[S.cloneElement(t,{size:14}),s.jsx("span",{children:e})]})}function zO({messageId:e,conversationId:t}={}){const a=Uk(),{searchResults:r}=RS(),{organicSources:o,topStories:i,images:l,hasAnswerBox:c,agentFiles:d}=n.useMemo((()=>{var t,n,s,a;const o=new Map,i=new Map,l=new Map,c=new Map;let d=!1;if(!r)return{organicSources:[],topStories:[],images:[],hasAnswerBox:!1,agentFiles:[]};for(const u of Object.values(r))u&&(null==(t=u.organic)||t.forEach((e=>{e.link&&o.set(e.link,e)})),null==(n=u.references)||n.forEach((t=>{if("image"===t.type)l.set(t.link,{...t,imageUrl:t.link});else if("file"===t.type){const n=t.fileId||"unknown",s=t.title||"Unknown File",a=`${n}_${s}`;if(c.has(a)){const e=c.get(a),n=e.pages||[],s=t.pages||[],r=[...new Set([...n,...s])].sort(((e,t)=>e-t));e.pages=r,e.relevance=Math.max(e.relevance||0,t.relevance||0),e.pageRelevance={...e.pageRelevance,...t.pageRelevance}}else{const r={type:Jd.file_search,file_id:n,filename:s,bytes:void 0,metadata:t.metadata,pages:t.pages,relevance:t.relevance,pageRelevance:t.pageRelevance,messageId:e||"",toolCallId:"file_search_results"};c.set(a,r)}}else t.link&&o.set(t.link,t)})),null==(s=u.topStories)||s.forEach((e=>{e.link&&i.set(e.link,e)})),null==(a=u.images)||a.forEach((e=>{e.imageUrl&&l.set(e.imageUrl,e)})),u.answerBox&&(d=!0));return{organicSources:Array.from(o.values()),topStories:Array.from(i.values()),images:Array.from(l.values()),hasAnswerBox:d,agentFiles:Array.from(c.values())}}),[r,e]),u=n.useMemo((()=>{const n=[];return(o.length||i.length||c)&&n.push({label:s.jsx(FO,{label:a("com_sources_tab_all"),icon:s.jsx(Wt,{})}),content:s.jsx(OO,{sources:[...o,...i]})}),i.length&&n.push({label:s.jsx(FO,{label:a("com_sources_tab_news"),icon:s.jsx(Dn,{})}),content:s.jsx(OO,{sources:i,limit:3})}),l.length&&n.push({label:s.jsx(FO,{label:a("com_sources_tab_images"),icon:s.jsx(Fn,{})}),content:s.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:l.map(((e,t)=>s.jsx(PO,{image:e},`image-${t}`)))})}),d.length&&e&&t&&n.push({label:s.jsx(FO,{label:a("com_sources_tab_files"),icon:s.jsx(zn,{})}),content:s.jsx(DO,{files:d,messageId:e,conversationId:t,limit:3})}),n}),[o,i,l,c,d,e,t,a]);return u.length?s.jsx("div",{role:"region","aria-label":a("com_sources_region_label"),children:s.jsx(vi,{tabs:u,containerClassName:"flex min-w-full mb-4",tabListClassName:"flex items-center mb-2 border-b border-border-light overflow-x-auto",tabPanelClassName:"w-full overflow-x-auto scrollbar-none md:mx-0 md:px-0",tabClassName:"flex items-center whitespace-nowrap text-xs font-medium text-token-text-secondary px-1 pt-2 pb-1 border-b-2 border-transparent data-[state=active]:text-text-primary outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"})}):null}function UO(e){const t=Uk(),n=s.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[s.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:t("com_sources_error_fallback")}),s.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":t("com_sources_reload_page"),children:t("com_ui_refresh")})]});return s.jsx(RO,{onError:(e,t)=>{console.error("Sources component error:",{error:e,errorInfo:t})},fallback:n,showDetails:!1,children:s.jsx(zO,{...e})})}function VO({radius:e,circumference:t,offset:n}){return s.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",children:[s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-brand-purple/25 dark:stroke-brand-purple/50",strokeWidth:"7.826086956521739",fill:"transparent",r:e,cx:"60",cy:"60"}),s.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"7.826086956521739",strokeDasharray:`${t} ${t}`,strokeDashoffset:n,fill:"transparent",r:e,cx:"60",cy:"60"})]})}function BO({error:e,isSubmitting:t,progress:n,children:a}){return!t&&n<1||!0===e?s.jsx(xM,{}):s.jsx(s.Fragment,{children:a})}function $O(){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[s.jsxs("defs",{children:[s.jsx("clipPath",{id:"__lottie_element_258",children:s.jsx("rect",{width:"20",height:"20",x:"0",y:"0"})}),s.jsx("clipPath",{id:"__lottie_element_263",children:s.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})}),s.jsx("clipPath",{id:"__lottie_element_270",children:s.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})})]}),s.jsx("g",{clipPath:"url(#__lottie_element_258)",children:s.jsxs("g",{clipPath:"url(#__lottie_element_263)",style:{display:"block"},transform:"matrix(0.9999999403953552,0,0,0.9999999403953552,-10000,-10000)",opacity:"1",children:[s.jsxs("g",{clipPath:"url(#__lottie_element_270)",style:{display:"block"},transform:"matrix(0.9999988675117493,0,0,0.9999988675117493,10.01171875,10.01171875)",opacity:"1",children:[s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,-2.125)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357900083065033 0.3357900083065033,8.881784197001252e-16 0.75,8.881784197001252e-16 C2.4166667461395264,8.881784197001252e-16 4.083333492279053,8.881784197001252e-16 5.75,8.881784197001252e-16 C6.1641998291015625,8.881784197001252e-16 6.5,0.3357900083065033 6.5,0.75 C6.5,1.1642099618911743 6.1641998291015625,1.5 5.75,1.5 C4.083333492279053,1.5 2.4166667461395264,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.1642099618911743 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})}),s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,0.625)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357999920845032 0.3357900083065033,0 0.75,0 C1.9166666269302368,0 3.0833332538604736,0 4.25,0 C4.6641998291015625,0 5,0.3357999920845032 5,0.75 C5,1.164199948310852 4.6641998291015625,1.5 4.25,1.5 C3.0833332538604736,1.5 1.9166666269302368,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.164199948310852 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})})]}),s.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:s.jsxs("g",{opacity:"1",transform:"matrix(1,0,0,1,10,10)",children:[s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M-3.13,-5.25 C-3.09,-5.25 -3.04,-5.25 -3,-5.25 C-2.59,-5.25 -2.25,-4.91 -2.25,-4.5 C-2.25,-4.09 -2.59,-3.75 -3,-3.75 C-3.03,-3.75 -3.07,-3.75 -3.1,-3.75 C-3.53,-3.75 -3.81,-3.75 -4.02,-3.73 C-4.23,-3.72 -4.3,-3.69 -4.34,-3.67 C-4.48,-3.6 -4.6,-3.48 -4.67,-3.34 C-4.69,-3.3 -4.72,-3.23 -4.73,-3.02 C-4.75,-2.81 -4.75,-2.53 -4.75,-2.1 C-4.75,-2.07 -4.75,-2.03 -4.75,-2 C-4.75,-1.59 -5.09,-1.25 -5.5,-1.25 C-5.91,-1.25 -6.25,-1.59 -6.25,-2 C-6.25,-2.04 -6.25,-2.09 -6.25,-2.13 C-6.25,-2.52 -6.25,-2.87 -6.23,-3.15 C-6.2,-3.44 -6.15,-3.74 -6,-4.02 C-5.79,-4.44 -5.44,-4.79 -5.02,-5 C-4.74,-5.15 -4.44,-5.2 -4.15,-5.23 C-3.87,-5.25 -3.52,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 M6.25,-2.13 C6.25,-2.09 6.25,-2.04 6.25,-2 C6.25,-1.59 5.91,-1.25 5.5,-1.25 C5.09,-1.25 4.75,-1.59 4.75,-2 C4.75,-2.03 4.75,-2.07 4.75,-2.1 C4.75,-2.53 4.75,-2.81 4.73,-3.02 C4.72,-3.23 4.69,-3.3 4.67,-3.34 C4.6,-3.48 4.48,-3.6 4.34,-3.67 C4.3,-3.69 4.23,-3.72 4.02,-3.73 C3.81,-3.75 3.53,-3.75 3.1,-3.75 C3.07,-3.75 3.03,-3.75 3,-3.75 C2.59,-3.75 2.25,-4.09 2.25,-4.5 C2.25,-4.91 2.59,-5.25 3,-5.25 C3.04,-5.25 3.09,-5.25 3.13,-5.25 C3.52,-5.25 3.87,-5.25 4.15,-5.23 C4.44,-5.2 4.74,-5.15 5.02,-5 C5.44,-4.79 5.79,-4.44 6,-4.02 C6.15,-3.74 6.2,-3.44 6.23,-3.15 C6.25,-2.87 6.25,-2.52 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 M-3.13,5.25 C-3.09,5.25 -3.04,5.25 -3,5.25 C-2.59,5.25 -2.25,4.91 -2.25,4.5 C-2.25,4.09 -2.59,3.75 -3,3.75 C-3.03,3.75 -3.07,3.75 -3.1,3.75 C-3.53,3.75 -3.81,3.75 -4.02,3.73 C-4.23,3.72 -4.3,3.69 -4.34,3.67 C-4.48,3.6 -4.6,3.48 -4.67,3.34 C-4.69,3.3 -4.72,3.23 -4.73,3.02 C-4.75,2.81 -4.75,2.53 -4.75,2.1 C-4.75,2.07 -4.75,2.03 -4.75,2 C-4.75,1.59 -5.09,1.25 -5.5,1.25 C-5.91,1.25 -6.25,1.59 -6.25,2 C-6.25,2.04 -6.25,2.09 -6.25,2.13 C-6.25,2.52 -6.25,2.87 -6.23,3.15 C-6.2,3.44 -6.15,3.74 -6,4.02 C-5.79,4.44 -5.44,4.79 -5.02,5 C-4.74,5.15 -4.44,5.2 -4.15,5.23 C-3.87,5.25 -3.52,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 M6.25,2.13 C6.25,2.09 6.25,2.04 6.25,2 C6.25,1.59 5.91,1.25 5.5,1.25 C5.09,1.25 4.75,1.59 4.75,2 C4.75,2.03 4.75,2.07 4.75,2.1 C4.75,2.53 4.75,2.81 4.73,3.02 C4.72,3.23 4.69,3.3 4.67,3.34 C4.6,3.48 4.48,3.6 4.34,3.67 C4.3,3.69 4.23,3.72 4.02,3.73 C3.81,3.75 3.53,3.75 3.1,3.75 C3.07,3.75 3.03,3.75 3,3.75 C2.59,3.75 2.25,4.09 2.25,4.5 C2.25,4.91 2.59,5.25 3,5.25 C3.04,5.25 3.09,5.25 3.13,5.25 C3.52,5.25 3.87,5.25 4.15,5.23 C4.44,5.2 4.74,5.15 5.02,5 C5.44,4.79 5.79,4.44 6,4.02 C6.15,3.74 6.2,3.44 6.23,3.15 C6.25,2.87 6.25,2.52 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13"}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,-5.250000476837158)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,-5.250000476837158)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,1.25)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,1.25)",children:s.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})})]})})]})})]})}function HO({initialProgress:e=.1,isSubmitting:t}){const n=WT(e),a=56.08695652173913,r=2*Math.PI*a,o=r-n*r,i=n>=2;return s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:n<1?s.jsx(BO,{progress:n,isSubmitting:t,error:i,children:s.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},children:[s.jsx("div",{children:s.jsx($O,{})}),s.jsx(VO,{radius:a,circumference:r,offset:o})]})}):i?s.jsx(xM,{}):s.jsx(vM,{})}),s.jsx(yM,{progress:n,onClick:()=>({}),inProgressText:"Searching my knowledge",finishedText:"Used Retrieval",hasInput:!1,popover:!1})]})}function GO({initialProgress:e=.1,code:t,outputs:a=[]}){const r=Uk(),o=WT(e),i=Ae(Cy.showCode),[l,c]=n.useState(i),d=a.reduce(((e,t)=>t.logs?e+t.logs+"\n":e),"");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-2.5 flex items-center gap-2.5",children:s.jsx(yM,{progress:o,onClick:()=>c((e=>!e)),inProgressText:r("com_ui_analyzing"),finishedText:r("com_ui_analyzing_finished"),hasInput:!!t.length,isExpanded:l})}),l&&s.jsxs("div",{className:"code-analyze-block mb-3 mt-0.5 overflow-hidden rounded-xl bg-black",children:[s.jsx(DA,{content:t?`\`\`\`python\n${t}\n\`\`\``:""}),d&&s.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[s.jsx("div",{className:"mb-1 text-gray-400",children:r("com_ui_result")}),s.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:s.jsx("pre",{className:"shrink-0",children:d})})]})]})]})}function KO({initialProgress:e=.1,isSubmitting:t,isLast:a,output:r}){const o=Uk(),{searchResults:i}=RS(),l="string"==typeof r&&r.toLowerCase().includes("error processing"),c=!t&&e<1||!0===l,d=!a&&1===e,u=t&&a&&1===e,m=n.useMemo((()=>{if(d&&!u)return[];if(!i)return[];const e=Object.values(i),t=e[e.length-1];return t?u?[...t.organic||[],...t.topStories||[]]:[...t.organic||[],...t.topStories||[]].filter((e=>!0===e.processed)):[]}),[i,d,u]),p=n.useMemo((()=>i?Object.values(i).length:0),[i]),f=n.useMemo((()=>Math.min(e,.99)),[e]),h=m.length>0,g=n.useMemo((()=>{let e=p>1?"com_ui_web_searching_again":"com_ui_web_searching";return h&&(e="com_ui_web_search_processing"),u&&(e="com_ui_web_search_reading"),o(e)}),[p,o,h,u]);return d||c?null:s.jsx(s.Fragment,{children:s.jsxs("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:[h&&s.jsx("div",{className:"mr-2",children:s.jsx(LO,{sources:m,start:-5})}),s.jsx(yM,{finishedText:"",hasInput:!1,error:c,isExpanded:!1,progress:f,inProgressText:g})]})})}const WO=S.memo((({uiResources:e})=>{const[t,a]=n.useState(!1),[r,o]=n.useState(!0),[i,l]=n.useState(!1),c=S.useRef(null),d=S.useCallback((()=>{if(!c.current)return;const{scrollLeft:e,scrollWidth:t,clientWidth:n}=c.current;a(e>0),o(e<t-n-10)}),[]),u=S.useCallback((e=>{if(!c.current)return;const t=c.current.clientWidth,n=Math.floor(.9*t),s=c.current.scrollLeft,a="left"===e?s-n:s+n;c.current.scrollTo({left:a,behavior:"smooth"})}),[]);return S.useEffect((()=>{const e=c.current;if(e)return e.addEventListener("scroll",d),d(),()=>e.removeEventListener("scroll",d)}),[d]),0===e.length?null:s.jsxs("div",{className:"relative mb-4 pt-3",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[s.jsx("div",{className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-24 bg-gradient-to-r from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(t?"opacity-100":"opacity-0")}),s.jsx("div",{className:"pointer-events-none absolute right-0 top-0 z-10 h-full w-24 bg-gradient-to-l from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(r?"opacity-100":"opacity-0")}),t&&s.jsx("button",{type:"button",onClick:()=>u("left"),className:"absolute left-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll left",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("div",{ref:c,className:"hide-scrollbar flex gap-4 overflow-x-auto scroll-smooth",children:e.map(((e,t)=>s.jsx("div",{className:"flex-shrink-0 transform-gpu transition-all duration-300 ease-out animate-in fade-in-0 slide-in-from-bottom-5",style:{width:"230px",minHeight:"360px",animationDelay:100*t+"ms"},children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsx(Un,{resource:{uri:e.uri,mimeType:e.mimeType,text:e.text},onUIAction:async e=>{console.log("Action:",e)},htmlProps:{autoResizeIframe:{width:!0,height:!0}}})})},t)))}),r&&s.jsx("button",{type:"button",onClick:()=>u("right"),className:"absolute right-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll right",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}));function qO({text:e,maxHeight:t=320}){return s.jsx("div",{className:"rounded-lg bg-surface-tertiary p-2 text-xs text-text-primary",style:{position:"relative",maxHeight:t,overflow:"auto"},children:s.jsx("pre",{className:"m-0 whitespace-pre-wrap break-words",style:{overflowWrap:"break-word"},children:s.jsx("code",{children:e})})})}function QO({input:e,output:t,domain:n,function_name:a,pendingAuth:r,attachments:o}){const i=Uk(),l=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}};let c=null!=n&&n?i("com_assistants_domain_info",{0:n}):i("com_assistants_function_use",{0:a});!0===r&&(c=null!=n&&n?i("com_assistants_action_attempt",{0:n}):i("com_assistants_attempt_info"));const d=(null==o?void 0:o.filter((e=>e.type===Jd.ui_resources)).flatMap((e=>e[Jd.ui_resources])))??[];return s.jsx("div",{className:"w-full p-2",children:s.jsxs("div",{style:{opacity:1},children:[s.jsx("div",{className:"mb-2 text-sm font-medium text-text-primary",children:c}),s.jsx("div",{children:s.jsx(qO,{text:l(e),maxHeight:250})}),t&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:i("com_ui_result")}),s.jsx("div",{children:s.jsx(qO,{text:l(t),maxHeight:250})}),d.length>0&&s.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:i("com_ui_ui_resources")}),s.jsxs("div",{children:[d.length>1&&s.jsx(WO,{uiResources:d}),1===d.length&&s.jsx(Un,{resource:d[0],onUIAction:async e=>{console.log("Action:",e)},htmlProps:{autoResizeIframe:{width:!0,height:!0}}})]})]})]})})}function YO({initialProgress:e=.1,isSubmitting:t,name:a,args:r="",output:o,attachments:i,auth:l}){const c=Uk(),[d,u]=n.useState(!1),m=n.useRef(null),[p,f]=n.useState(0),[h,g]=n.useState(!1),x=n.useRef(d),{function_name:v,domain:b,isMCPToolCall:_}=n.useMemo((()=>{if("string"!=typeof a)return{function_name:"",domain:null,isMCPToolCall:!1};if(a.includes(dh.mcp_delimiter)){const[e,t]=a.split(dh.mcp_delimiter);return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!0}}const[e,t]=a.includes(cu)?a.split(cu):[a,""];return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!1}}),[a]),y="string"==typeof o&&o.toLowerCase().includes("error processing tool"),j=n.useMemo((()=>{if("string"==typeof r)return r;try{return JSON.stringify(r,null,2)}catch(Fi){return a_.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to stringify args",Fi),""}}),[r]),w=n.useMemo((()=>((null==j?void 0:j.length)??0)>0||((null==o?void 0:o.length)??0)>0),[j,o]),N=n.useMemo((()=>{const e=l??"";if(!e)return"";try{return new URL(e).hostname}catch(Fi){return a_.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to parse auth URL",Fi),""}}),[l]),C=WT(e),k=!t&&C<1||!0===y;return n.useLayoutEffect((()=>{if(d!==x.current){x.current=d,g(!0),d&&m.current?requestAnimationFrame((()=>{if(m.current){const e=m.current.scrollHeight;f(e+4)}})):f(0);const e=setTimeout((()=>{g(!1)}),400);return()=>clearTimeout(e)}}),[d]),n.useEffect((()=>{if(!m.current)return;const e=new ResizeObserver((e=>{if(d&&!h)for(const t of e)t.target===m.current&&f(t.contentRect.height+4)}));return e.observe(m.current),()=>{e.disconnect()}}),[d,h]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative my-2.5 flex h-5 shrink-0 items-center gap-2.5",children:s.jsx(yM,{progress:C,onClick:()=>u((e=>!e)),inProgressText:v?c("com_assistants_running_var",{0:v}):c("com_assistants_running_action"),authText:!k&&N.length>0?c("com_ui_requires_auth"):void 0,finishedText:k?c("com_ui_cancelled"):!0===_?c("com_assistants_completed_function",{0:v}):null!=b&&b&&b.length!==dh.ENCODED_DOMAIN_LENGTH?c("com_assistants_completed_action",{0:b}):c("com_assistants_completed_function",{0:v}),hasInput:w,isExpanded:d,error:k})}),s.jsx("div",{className:"relative",style:{height:d?p:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:d?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx("div",{className:s_("overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-md",d&&"shadow-lg"),style:{transform:d?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:d?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx("div",{ref:m,children:d&&w&&s.jsx(QO,{input:j??"",output:o,domain:N||(b??""),function_name:v,pendingAuth:N.length>0&&!k&&C<1,attachments:i},"tool-call-info")})})}),null!=l&&l&&C<1&&!k&&s.jsxs("div",{className:"flex w-full flex-col gap-2.5",children:[s.jsx("div",{className:"mb-1 mt-2",children:s.jsx(Si,{className:"font-mediu inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm",variant:"default",rel:"noopener noreferrer",onClick:()=>window.open(l,"_blank","noopener,noreferrer"),children:c("com_ui_sign_in_to_domain",{0:N})})}),s.jsxs("p",{className:"flex items-center text-xs text-text-warning",children:[s.jsx(Dt,{className:"mr-1.5 inline-block h-4 w-4"}),c("com_assistants_allow_sites_you_trust")]})]}),i&&i.length>0&&s.jsx(AA,{attachments:i})]})}function XO({initialProgress:e=.1,args:t=""}){const a=WT(e),r=56.08695652173913,o=2*Math.PI*r,i=o-a*o,[l,c]=n.useState(!1);return s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},"data-projection-id":"106",children:[s.jsx("div",{children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[s.jsx("g",{className:"move-up",children:s.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:"M11.812616,5.914505C11.535567,5.360465,10.744857,5.360465,10.467807,5.914505C9.369731,8.110632,8.271654,10.306758,7.173676,12.502885C6.923041,13.002725,7.286122,13.590845,7.844972,13.590845C10.041112,13.590845,12.237252,13.590845,14.433392,13.590845C14.992292,13.590845,15.355792,13.002725,15.105892,12.502885C14.007888,10.306758,12.909805,8.110632,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505M7.216073,8.914505C6.939024,8.360465,6.148304,8.360465,5.871264,8.914505C5.274365,10.10828,4.677499,11.302055,4.080601,12.495835C3.83003,12.99568,4.193122,13.58379,4.751975,13.58379C5.946767,13.58379,7.14156,13.58379,8.336353,13.58379C8.895213,13.58379,9.258683,12.99568,9.008763,12.495835C8.411867,11.302055,7.81497,10.10828,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505"})}),s.jsx("g",{style:{display:"block"},transform:"matrix(-1,0,0,-1,10,10)",opacity:"1",className:"moon-rise",children:s.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,3.75,5.5)",children:s.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:" M2.660290002822876,2.2502501010894775 C2.7567598819732666,2.2502501010894775 2.850860118865967,2.241950035095215 2.9425699710845947,2.225330114364624 C3.034290075302124,2.208709955215454 3.1081299781799316,2.1867599487304688 3.164109945297241,2.1594600677490234 C3.239150047302246,2.120300054550171 3.305850028991699,2.100709915161133 3.364219903945923,2.100709915161133 C3.405900001525879,2.100709915161133 3.438659906387329,2.113770008087158 3.462480068206787,2.1398799419403076 C3.487489938735962,2.165990114212036 3.5,2.2009999752044678 3.5,2.2449100017547607 C3.5,2.2698400020599365 3.4958300590515137,2.2983200550079346 3.487489938735962,2.3303699493408203 C3.4803500175476074,2.362410068511963 3.468440055847168,2.3968300819396973 3.4517600536346436,2.433619976043701 C3.3803000450134277,2.5950300693511963 3.287990093231201,2.7410099506378174 3.1748299598693848,2.871570110321045 C3.0628700256347656,3.002120018005371 2.9348299503326416,3.1142799854278564 2.790709972381592,3.2080399990081787 C2.646589994430542,3.3029799461364746 2.4905600547790527,3.375380039215088 2.3226099014282227,3.425230026245117 C2.15585994720459,3.4750800132751465 1.9825600385665894,3.5 1.8027100563049316,3.5 C1.5430500507354736,3.5 1.3036400079727173,3.4554901123046875 1.0844800472259521,3.3664801120758057 C0.8653200268745422,3.2786500453948975 0.6741499900817871,3.1540400981903076 0.5109699964523315,2.9926199913024902 C0.34898999333381653,2.831209897994995 0.22333000600337982,2.641319990158081 0.1340000033378601,2.4229400157928467 C0.04467000067234039,2.2045600414276123 0,1.9660099744796753 0,1.7072700262069702 C0,1.4639699459075928 0.04645000025629997,1.2325400114059448 0.1393599957227707,1.012969970703125 C0.23226000368595123,0.7922199964523315 0.3626900017261505,0.5975800156593323 0.5306299924850464,0.4290440082550049 C0.6997600197792053,0.2593249976634979 0.8968899846076965,0.12877200543880463 1.121999979019165,0.03738600015640259 C1.1541600227355957,0.024329999461770058 1.1833399534225464,0.01483600027859211 1.2095500230789185,0.008901000022888184 C1.2369400262832642,0.0029670000076293945 1.2631399631500244,2.220446049250313e-16 1.288159966468811,2.220446049250313e-16 C1.335800051689148,2.220446049250313e-16 1.3733199834823608,0.014241999946534634 1.4007099866867065,0.042725998908281326 C1.4292999505996704,0.07121100276708603 1.4435900449752808,0.10681600123643875 1.4435900449752808,0.14954200387001038 C1.4435900449752808,0.1780260056257248 1.438230037689209,0.2076980024576187 1.4275100231170654,0.23855499923229218 C1.41798996925354,0.2682270109653473 1.404289960861206,0.2996779978275299 1.3864200115203857,0.3329089879989624 C1.3625999689102173,0.3768230080604553 1.3423500061035156,0.4302310049533844 1.3256800174713135,0.493133008480072 C1.309000015258789,0.5548499822616577 1.296489953994751,0.6225000023841858 1.288159966468811,0.6960800290107727 C1.2798199653625488,0.7684800028800964 1.2756500244140625,0.8414700031280518 1.2756500244140625,0.9150599837303162 C1.2756500244140625,1.1215699911117554 1.3072099685668945,1.3073099851608276 1.3703399896621704,1.4722800254821777 C1.4346599578857422,1.6372499465942383 1.5269700288772583,1.7778899669647217 1.6472699642181396,1.8941999673843384 C1.7675700187683105,2.0093300342559814 1.9128799438476562,2.097749948501587 2.083209991455078,2.1594600677490234 C2.2547199726104736,2.2199900150299072 2.44707989692688,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775"})})})]})}),s.jsx(VO,{radius:r,circumference:o,offset:i})]})}),s.jsx(yM,{progress:a,onClick:()=>c((e=>!e)),inProgressText:"Creating Image",finishedText:"Finished.",hasInput:!1})]})}const ZO=n.memo((({part:e,isSubmitting:t,attachments:n,isLast:a,showCursor:r,isCreatedByUser:o})=>{var i,l;if(!e)return null;if(e.type===hh.ERROR)return s.jsx(kO,{text:e[hh.ERROR]??("string"==typeof e[hh.TEXT]?e[hh.TEXT]:null==(i=e.text)?void 0:i.value)??"",className:"my-2"});if(e.type===hh.AGENT_UPDATE)return s.jsxs(s.Fragment,{children:[s.jsx(NM,{currentAgentId:null==(l=e[hh.AGENT_UPDATE])?void 0:l.agentId}),a&&r&&s.jsx(kM,{children:s.jsx(hM,{})})]});if(e.type===hh.TEXT){const t="string"==typeof e.text?e.text:e.text.value;return"string"!=typeof t?null:null==e.tool_call_ids||t?s.jsx(kM,{children:s.jsx(sM,{text:t,isCreatedByUser:o,showCursor:r})}):null}if(e.type===hh.THINK){const t="string"==typeof e.think?e.think:e.think.value;return"string"!=typeof t?null:s.jsx(fM,{reasoning:t})}if(e.type===hh.TOOL_CALL){const i=e[hh.TOOL_CALL];if(!i)return null;const l="args"in i&&(!i.type||i.type===xh.TOOL_CALL);if(l&&i.name===Jd.execute_code)return s.jsx(wM,{attachments:n,isSubmitting:t,output:i.output??"",initialProgress:i.progress??.1,args:"string"==typeof i.args?i.args:""});if(l&&("image_gen_oai"===i.name||"image_edit_oai"===i.name))return s.jsx(LA,{initialProgress:i.progress??.1,isSubmitting:t,toolName:i.name,args:"string"==typeof i.args?i.args:"",output:i.output??"",attachments:n});if(l&&i.name===Jd.web_search)return s.jsx(KO,{output:i.output??"",initialProgress:i.progress??.1,isSubmitting:t,attachments:n,isLast:a});if(l)return s.jsx(YO,{args:i.args??"",name:i.name||"",output:i.output??"",initialProgress:i.progress??.1,isSubmitting:t,attachments:n,auth:i.auth,expires_at:i.expires_at});if(i.type===xh.CODE_INTERPRETER){const e=i[xh.CODE_INTERPRETER];return s.jsx(GO,{initialProgress:i.progress??.1,code:e.input,outputs:e.outputs??[]})}if(i.type===xh.RETRIEVAL||i.type===xh.FILE_SEARCH)return s.jsx(HO,{initialProgress:i.progress??.1,isSubmitting:t});if(i.type===xh.FUNCTION&&xh.FUNCTION in i&&vh.has(i.function.name))return s.jsx(XO,{initialProgress:i.progress??.1,args:i.function.arguments});if(i.type===xh.FUNCTION&&xh.FUNCTION in i)return Hu(i)?t&&r?s.jsx(kM,{children:s.jsx(sM,{text:"",isCreatedByUser:o,showCursor:r})}):null:s.jsx(YO,{initialProgress:i.progress??.1,isSubmitting:t,args:i.function.arguments,name:i.function.name,output:i.function.output})}else if(e.type===hh.IMAGE_FILE){const t=e[hh.IMAGE_FILE],n=t.height??1920,a=t.width??1080;return s.jsx(TA,{imagePath:t.filepath,height:n,width:a,altText:t.filename??"Uploaded Image",placeholderDimensions:{height:n+"px",width:a+"px"}})}return null})),JO=({message:e,attachments:t,searchResults:a})=>{const r=Ae(Cy.enableUserMsgMarkdown),{messageId:o}=e,i=n.useMemo((()=>wv(t??[])),[t]);return Array.isArray(e.content)&&e.content.length>0?s.jsxs(ES.Provider,{value:{searchResults:a},children:[s.jsx(UO,{}),e.content.filter((e=>e)).map(((t,n)=>{var a;if(!t)return null;const r=(null==(a=null==t?void 0:t[hh.TOOL_CALL])?void 0:a.id)??"",l=i[r];return s.jsx(ZO,{showCursor:!1,isSubmitting:!1,isCreatedByUser:e.isCreatedByUser,attachments:l,part:t},`display-${o}-${n}`)})),!0===e.unfinished&&s.jsx(n.Suspense,{children:s.jsx(kd,{delay:250,children:s.jsx(TO,{message:e},`unfinished-${o}`)})})]}):s.jsx("div",{className:s_("markdown prose dark:prose-invert light w-full break-words",e.isCreatedByUser&&!r&&"whitespace-pre-wrap",e.isCreatedByUser?"dark:text-gray-20":"dark:text-gray-70"),dir:"auto",children:s.jsx(DA,{content:e.text||""})})};function eD({siblingIdx:e,siblingCount:t,setSiblingIdx:n}){if(void 0===e)return null;if(void 0===t)return null;const a=s_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none");return t>1?s.jsxs("nav",{className:"visible flex items-center justify-center gap-2 self-center pt-0 text-xs","aria-label":"Sibling message navigation",children:[s.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e-1)},disabled:0==e,"aria-label":"Previous sibling message","aria-disabled":0==e,children:s.jsx(pt,{size:"19","aria-hidden":"true"})}),s.jsxs("span",{className:"flex-shrink-0 flex-grow tabular-nums","aria-live":"polite","aria-atomic":"true",role:"status",children:[e+1," / ",t]}),s.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e+1)},disabled:e==t-1,"aria-label":"Next sibling message","aria-disabled":e==t-1,children:s.jsx(Vn,{size:"19","aria-hidden":"true"})})]}):null}function tD(e){var t;let n="";for(let s=0;s<e.length;s++){n+=Rv(`${(null==(t=e[s])?void 0:t.inputStr)??e[s]}`),e.length>1&&s!==e.length-1&&(n+=",\n")}return n}const nD=n.memo((({plugin:e})=>{const{isSharedConvo:t}=n.useContext(nS),{data:a={}}=Ky({enabled:!t,select:e=>{var t;return null==(t=null==e?void 0:e.gptPlugins)?void 0:t.plugins}}),r=n.useCallback((e=>e?"n/a"===e||"self reflection"===e?e:a[e]??"self reflection":null),[a]);if(!e||!e.latest)return null;const o=r(e.latest);if(!o||o&&"n/a"===o)return null;return s.jsx("div",{className:"my-2 flex flex-col items-start",children:s.jsx(to,{children:({open:t})=>{const n={className:s_(t?"rotate-180 transform":"","h-4 w-4")};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:s_(e.loading?"bg-green-100":"bg-gray-20","my-1 flex items-center rounded p-3 text-xs text-gray-800"),children:[s.jsx("div",{children:s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("div",{children:e.loading||"self reflection"!==o?"self reflection"===o?"I'm  thinking...":s.jsxs(s.Fragment,{children:[e.loading?"Using":"Used"," ",s.jsx("b",{children:o}),e.loading?"...":""]}):"Finished"})})}),e.loading&&s.jsx(rc,{className:"ml-1 text-black"}),s.jsx(no,{className:"ml-12 flex items-center gap-2",children:s.jsx(Pt,{...n})})]}),s.jsxs(so,{className:"mt-3 flex max-w-full flex-col gap-3",children:[s.jsx(RM,{lang:o?`REQUEST TO ${o.toUpperCase()}`:"REQUEST",codeChildren:tD(e.inputs??[]),plugin:!0,classProp:"max-h-[450px]"}),e.outputs&&e.outputs.length>0&&s.jsx(RM,{lang:o?`RESPONSE FROM ${o.toUpperCase()}`:"RESPONSE",codeChildren:Rv(e.outputs??""),plugin:!0,classProp:"max-h-[450px]"})]})]})}})})}));function sD({children:e,classes:t="",onClick:n}){return s.jsx("div",{className:s_("mt-1 flex justify-start gap-3 empty:hidden lg:flex",t),onClick:n,children:e})}function aD(e){const t=Ae(Cy.fontSize),{message:n,siblingIdx:a,siblingCount:r,conversation:o,setSiblingIdx:i,currentEditId:l,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=qT({messageId:null==n?void 0:n.messageId,attachments:null==n?void 0:n.attachments});if(!n)return null;const{text:m="",children:p,error:f=!1,messageId:h="",unfinished:g=!1,isCreatedByUser:x=!0}=n;let v="";return v=x?"anonymous":n.sender??"",s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",children:s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:s.jsx("div",{children:s.jsx("div",{className:"pt-0.5",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(TR,{message:n,conversation:o})})})})}),s.jsxs("div",{className:s_("relative flex w-11/12 flex-col",x?"":"agent-turn"),children:[s.jsx("div",{className:s_("select-none font-semibold",t),children:v}),s.jsx("div",{className:"flex-col gap-1 md:gap-3",children:s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsxs(fS.Provider,{value:{messageId:h,isExpanded:!1,conversationId:null==o?void 0:o.conversationId,isSubmitting:!1,isLatestMessage:!1},children:[n.plugin&&s.jsx(nD,{plugin:n.plugin}),n.content?s.jsx(JO,{message:n,attachments:d,searchResults:u}):s.jsx(EO,{edit:!1,error:f,isLast:!1,ask:()=>({}),text:m||"",message:n,isSubmitting:!1,enterEdit:()=>({}),unfinished:g,siblingIdx:a??0,isCreatedByUser:x,setSiblingIdx:i??(()=>({}))})]})})}),s.jsxs(sD,{classes:"text-xs",children:[s.jsx(eD,{siblingIdx:a,siblingCount:r,setSiblingIdx:i}),s.jsx(jO,{message:n,searchResults:u})]})]})]})})}),s.jsx(rD,{messageId:h,messagesTree:p??[],currentEditId:l,setCurrentEditId:c},h)]})}function rD({messageId:e,messagesTree:t,currentEditId:a,setCurrentEditId:r}){const[o,i]=Ie(Cy.messagesSiblingIdxFamily(e));if(n.useEffect((()=>{i(0)}),[null==t?void 0:t.length]),n.useEffect((()=>{null!=(null==t?void 0:t.length)&&o>=t.length&&i(0)}),[o,null==t?void 0:t.length,i]),!t||!t.length)return null;const l=t[t.length-o-1];return l?s.jsx(aD,{message:l,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:e=>{i(((null==t?void 0:t.length)??0)-e-1)}},l.messageId):null}function oD({messagesTree:e,conversationId:t}){const a=Uk(),[r,o]=n.useState(-1);return s.jsx("div",{className:"flex-1 pb-[50px]",children:s.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:s.jsx("div",{style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e&&0==e.length||null===e?s.jsx("div",{className:"flex w-full items-center justify-center gap-1 bg-gray-50 p-3 text-sm text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:a("com_ui_nothing_found")}):s.jsx(s.Fragment,{children:s.jsx("div",{children:s.jsx(rD,{messagesTree:e,messageId:t??null,setCurrentEditId:o,currentEditId:r??null},t)})}),s.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})}function iD({className:e}){var t,a;const{data:r}=Wy(),o=Uk(),i=null==(t=null==r?void 0:r.interface)?void 0:t.privacyPolicy,l=null==(a=null==r?void 0:r.interface)?void 0:a.termsOfService,c=null!=(null==i?void 0:i.externalUrl)&&s.jsx("a",{className:"text-text-secondary underline",href:i.externalUrl,target:!0===i.openNewTab?"_blank":void 0,rel:"noreferrer",children:o("com_ui_privacy_policy")}),d=null!=(null==l?void 0:l.externalUrl)&&s.jsx("a",{className:"text-text-secondary underline",href:l.externalUrl,target:!0===l.openNewTab?"_blank":void 0,rel:"noreferrer",children:o("com_ui_terms_of_service")}),u=("string"==typeof(null==r?void 0:r.customFooter)?r.customFooter:"[LibreChat "+dh.VERSION+"](https://librechat.ai) - "+o("com_ui_latest_footer")).split("|");n.useEffect((()=>{if(null!=(null==r?void 0:r.analyticsGtmId)&&void 0===window.google_tag_manager){const e={gtmId:r.analyticsGtmId};Ze.initialize(e)}}),[null==r?void 0:r.analyticsGtmId]);const m=[...u.map(((e,t)=>s.jsx(S.Fragment,{children:s.jsx(Xo,{components:{a:({node:e,href:t,children:n,...a})=>s.jsx("a",{className:"text-text-secondary underline",href:t,target:"_blank",rel:"noreferrer",...a,children:n}),p:({node:e,...t})=>s.jsx("span",{...t})},children:e.trim()})},`main-content-part-${t}`))),c,d].filter(Boolean);return s.jsx("div",{className:"relative w-full",children:s.jsx("div",{className:e??"absolute bottom-0 left-0 right-0 hidden items-center justify-center gap-2 px-2 py-2 text-center text-xs text-text-primary sm:flex md:px-[60px]",role:"contentinfo",children:m.map(((e,t)=>{const n=t===m.length-1;return s.jsxs(S.Fragment,{children:[e,!n&&s.jsx("div",{className:"h-2 border-r-[1px] border-border-medium"},`separator-${t}`)]},`footer-element-${t}`)}))})})}const lD=n.memo((function(){const e=Uk(),{data:t}=Wy(),{shareId:n}=nt(),{data:a,isLoading:r}=lk(n??""),o=a&&Lh({messages:a.messages}),i=0===(null==o?void 0:o.length)?null:o??null;let l,c="";return c=null!=(null==t?void 0:t.appTitle)&&null!=(null==a?void 0:a.title)?`${a.title} | ${t.appTitle}`:(null==a?void 0:a.title)??(null==t?void 0:t.appTitle)??document.title,FE(c),l=r?s.jsx("div",{className:"flex h-screen items-center justify-center",children:s.jsx(rc,{className:""})}):a&&i&&0!==i.length?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"final-completion group mx-auto flex min-w-[40rem] flex-col gap-3 pb-6 pt-4 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[s.jsx("h1",{className:"text-4xl font-bold",children:a.title}),s.jsx("div",{className:"border-b border-border-medium pb-6 text-base text-text-secondary",children:new Date(a.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),s.jsx(oD,{messagesTree:i,conversationId:a.conversationId})]}):s.jsx("div",{className:"flex h-screen items-center justify-center",children:e("com_ui_shared_link_not_found")}),s.jsx(nS.Provider,{value:{isSharedConvo:!0},children:s.jsx("main",{className:"relative flex w-full grow overflow-hidden dark:bg-surface-secondary",style:{paddingBottom:"50px"},children:s.jsx("div",{className:"transition-width relative flex h-full w-full flex-1 flex-col items-stretch overflow-hidden pt-0 dark:bg-surface-secondary",children:s.jsxs("div",{className:"flex h-full flex-col text-text-primary",role:"presentation",children:[l,s.jsx("div",{className:"w-full border-t-0 pl-0 pt-2 md:w-[calc(100%-.5rem)] md:border-t-0 md:border-transparent md:pl-0 md:pt-0 md:dark:border-transparent",children:s.jsx(iD,{className:"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-center gap-2 bg-gradient-to-t from-surface-secondary to-transparent px-2 pb-2 pt-8 text-xs text-text-secondary md:px-[60px]"})})]})})})})}));function cD(){return s.jsx(lD,{})}const dD=()=>{const{conversation:e}=Mk(),t=zk(),a=bS(),{data:r}=Ky(),o=n.useMemo((()=>{let t=(null==e?void 0:e.endpoint)??"";return[Nu.chatGPTBrowser,Nu.azureOpenAI,Nu.gptPlugins].includes(t)&&(t=Nu.openAI),Mb({endpointsConfig:r,iconURL:null==e?void 0:e.iconURL,endpoint:t})}),[null==e?void 0:e.endpoint,null==e?void 0:e.iconURL,r]),{data:i=new Map}=bj(o,{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),{entity:l,isAgent:c}=Ob({endpoint:o,agentsMap:t,assistantMap:a,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id}),d=n.useMemo((()=>{var e,t;return(null==(e=null==l?void 0:l.conversation_starters)?void 0:e.length)?l.conversation_starters:c?[]:(null==(t=i.get((null==l?void 0:l.id)??""))?void 0:t.conversation_starters)??[]}),[i,c,l]),{submitMessage:u}=YT(),m=n.useCallback((e=>u({text:e})),[u]);return d.length?s.jsx("div",{className:"mt-8 flex flex-wrap justify-center gap-3 px-4",children:d.slice(0,dh.MAX_CONVO_STARTERS).map(((e,t)=>s.jsx("button",{onClick:()=>m(e),className:"relative flex w-40 cursor-pointer flex-col gap-2 rounded-2xl border border-border-medium px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] transition-colors duration-300 ease-in-out fade-in hover:bg-surface-tertiary",children:s.jsx("p",{className:"break-word line-clamp-3 overflow-hidden text-balance break-all text-text-secondary",children:e})},t)))}):null};function uD({scrollHandler:e}){return s.jsx("button",{onClick:e,className:"premium-scroll-button absolute bottom-5 right-1/2 cursor-pointer border border-border-light bg-surface-secondary","aria-label":"Scroll to bottom",children:s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-text-secondary",children:s.jsx("path",{d:"M17 13L12 18L7 13M12 6L12 17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}function mD({memoryArtifacts:e}){const t=Uk(),{updatedMemories:a,deletedMemories:r,errorMessages:o}=n.useMemo((()=>({updatedMemories:e.filter((e=>"update"===e.type)),deletedMemories:e.filter((e=>"delete"===e.type)),errorMessages:e.filter((e=>"error"===e.type)).map((e=>{try{const n=JSON.parse(e.value);return"already_exceeded"===n.errorType?t("com_ui_memory_already_exceeded",{tokens:n.tokenCount}):"would_exceed"===n.errorType?t("com_ui_memory_would_exceed",{tokens:n.tokenCount}):t("com_ui_memory_error")}catch{return t("com_ui_memory_error")}}))})),[e,t]);return 0===e.length||0===a.length&&0===r.length&&0===o.length?null:s.jsxs("div",{className:"space-y-4 p-4",children:[a.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_updated_items")}),s.jsx("div",{className:"space-y-2",children:a.map((e=>s.jsxs("div",{className:"rounded-lg p-3",children:[s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),s.jsx("div",{className:"whitespace-pre-wrap text-sm text-text-primary",children:e.value})]},`update-${e.key}`)))})]}),r.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_deleted_items")}),s.jsx("div",{className:"space-y-2",children:r.map((e=>s.jsxs("div",{className:"rounded-lg p-3 opacity-60",children:[s.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),s.jsx("div",{className:"text-sm italic text-text-secondary",children:t("com_ui_memory_deleted")})]},`delete-${e.key}`)))})]}),o.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"mb-2 text-sm font-semibold text-red-500",children:t("com_ui_memory_storage_full")}),s.jsx("div",{className:"space-y-2",children:o.map((e=>s.jsx("div",{className:"rounded-md bg-red-50 p-3 text-sm text-red-800 dark:bg-red-900/20 dark:text-red-400",children:e},e)))})]})]})}function pD({attachments:e}){const t=Uk(),[a,r]=n.useState(!1),o=n.useRef(null),[i,l]=n.useState(0),[c,d]=n.useState(!1),u=n.useRef(a),{hasErrors:m,memoryArtifacts:p}=n.useMemo((()=>{let t=!1;const n=[];if(!e||0===e.length)return{hasErrors:t,memoryArtifacts:n};for(const s of e)null!=(null==s?void 0:s[Jd.memory])&&(n.push(s[Jd.memory]),t||"error"!==s[Jd.memory].type||(t=!0));return{hasErrors:t,memoryArtifacts:n}}),[e]);return n.useLayoutEffect((()=>{if(a!==u.current){u.current=a,d(!0),a&&o.current?requestAnimationFrame((()=>{if(o.current){const e=o.current.scrollHeight;l(e+4)}})):l(0);const e=setTimeout((()=>{d(!1)}),400);return()=>clearTimeout(e)}}),[a]),n.useEffect((()=>{if(!o.current)return;const e=new ResizeObserver((e=>{if(a&&!c)for(const t of e)t.target===o.current&&l(t.contentRect.height+4)}));return e.observe(o.current),()=>{e.disconnect()}}),[a,c]),p&&0!==p.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex items-center",children:s.jsx("div",{className:"inline-block",children:s.jsxs("button",{className:s_("outline-hidden my-1 flex items-center gap-1 text-sm font-semibold transition-colors",m?"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500":"text-text-secondary-alt hover:text-text-primary"),type:"button",onClick:()=>r((e=>!e)),"aria-expanded":a,"aria-label":t("com_ui_memory_updated"),children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mb-[-1px]",children:[s.jsx("path",{d:"M6 3C4.89543 3 4 3.89543 4 5V13C4 14.1046 4.89543 15 6 15L6 3Z",fill:"currentColor"}),s.jsx("path",{d:"M7 3V15H8.18037L8.4899 13.4523C8.54798 13.1619 8.69071 12.8952 8.90012 12.6858L12.2931 9.29289C12.7644 8.82153 13.3822 8.58583 14 8.58578V3.5C14 3.22386 13.7761 3 13.5 3H7Z",fill:"currentColor"}),s.jsx("path",{d:"M11.3512 15.5297L9.73505 15.8529C9.38519 15.9229 9.07673 15.6144 9.14671 15.2646L9.46993 13.6484C9.48929 13.5517 9.53687 13.4628 9.60667 13.393L12.9996 10C13.5519 9.44771 14.4473 9.44771 14.9996 10C15.5519 10.5523 15.5519 11.4477 14.9996 12L11.6067 15.393C11.5369 15.4628 11.448 15.5103 11.3512 15.5297Z",fill:"currentColor"})]}),t(m?"com_ui_memory_error":"com_ui_memory_updated")]})})}),s.jsx("div",{className:"relative",style:{height:a?i:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:a?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:s.jsx("div",{className:s_("overflow-hidden rounded-xl border border-border-light bg-surface-primary-alt shadow-md",a&&"shadow-lg"),style:{transform:a?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:a?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:s.jsx("div",{ref:o,children:a&&s.jsx(mD,{memoryArtifacts:p},"memory-info")})})})]}):null}const fD=n.memo((({content:e,messageId:t,conversationId:a,attachments:r,searchResults:o,isCreatedByUser:i,isLast:l,isSubmitting:c,isLatestMessage:d,edit:u,enterEdit:m,siblingIdx:p,setSiblingIdx:f})=>{const h=Uk(),[g,x]=Ie(Cy.showThinking),[v,b]=n.useState(g),_=n.useMemo((()=>wv(r??[])),[r]),y=!!d&&c,j=n.useMemo((()=>{const t=(null==e?void 0:e.some((e=>(null==e?void 0:e.type)===hh.THINK)))??!1,n=(null==e?void 0:e.every((e=>{if((null==e?void 0:e.type)!==hh.THINK)return!0;if("string"==typeof e.think){return e.think.replace(/<\/?think>/g,"").trim().length>0}return!1})))??!1;return t&&n}),[e]);return e?!0===u&&m&&f?s.jsx(s.Fragment,{children:e.map(((e,n)=>{if(!e)return null;const a=(null==e?void 0:e.type)===hh.TEXT||"string"!=typeof(null==e?void 0:e.text),r=(null==e?void 0:e.type)===hh.THINK||"string"!=typeof(null==e?void 0:e.think);if(!a&&!r)return null;return e.type===hh.TOOL_CALL||null!=e.tool_call_ids?null:s.jsx(SM,{index:n,part:e,messageId:t,isSubmitting:c,enterEdit:m,siblingIdx:p??null,setSiblingIdx:f},`edit-${t}-${n}`)}))}):s.jsx(s.Fragment,{children:s.jsxs(ES.Provider,{value:{searchResults:o},children:[s.jsx(pD,{attachments:r}),s.jsx(UO,{messageId:t,conversationId:a||void 0}),j&&s.jsx("div",{className:"mb-5",children:s.jsx(uM,{isExpanded:v,onClick:()=>b((e=>{const t=!e;return x(t),t})),label:h(y&&l?"com_ui_thinking":"com_ui_thoughts")})}),e.filter((e=>e)).map(((n,r)=>{var o,c;const u=(null==(o=null==n?void 0:n[hh.TOOL_CALL])?void 0:o.id)??"",m=_[u];return s.jsx(fS.Provider,{value:{messageId:t,isExpanded:v,conversationId:a,partIndex:r,nextType:null==(c=e[r+1])?void 0:c.type,isSubmitting:y,isLatestMessage:d},children:s.jsx(ZO,{part:n,attachments:m,isSubmitting:y,isCreatedByUser:i,isLast:r===e.length-1,showCursor:r===e.length-1&&l},`part-${t}-${r}`)},`provider-${t}-${r}`)}))]})}):null})),hD=n.memo((({isCard:e})=>e?s.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):null)),gD={[mh.DIRECT_PATH]:"com_ui_fork_visible",[mh.INCLUDE_BRANCHES]:"com_ui_fork_branches",[mh.TARGET_LEVEL]:"com_ui_fork_all_target",[mh.DEFAULT]:"com_ui_fork_from_message"},xD=s.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"})}),vD=({children:e,setting:t,onClick:n,setActiveSetting:a,timeoutRef:r,hoverInfo:o,hoverTitle:i,hoverDescription:l,label:c})=>{const d=Uk();return s.jsx(zt,{placement:"right-start",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(Ut,{render:s.jsxs(Vt,{onClick:()=>n(t),onMouseEnter:()=>{r.current&&(clearTimeout(r.current),r.current=null),a(gD[t])},onMouseLeave:()=>{r.current&&clearTimeout(r.current),r.current=setTimeout((()=>{a(gD[mh.DEFAULT])}),175)},className:"mx-0.5 w-14 flex-1 rounded-xl border-2 border-border-medium bg-surface-secondary text-text-secondary transition duration-200 ease-in-out hover:bg-surface-hover hover:text-text-primary","aria-label":c,children:[e,s.jsx(Bt,{children:c})]})}),s.jsxs($t,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(Bt,{children:d("com_ui_fork_more_details_about",{0:c})}),xD]}),(null!=o&&""!==o||null!=i&&""!==i||null!=l&&""!==l)&&s.jsx(Ht,{gutter:16,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsx("div",{className:"space-y-2",children:s.jsxs("p",{className:"flex flex-col gap-2 text-sm text-text-secondary",children:[o&&o,i&&s.jsx("span",{className:"flex flex-wrap gap-1 font-bold",children:i}),l&&l]})})})]})})},bD=({id:e,checked:t,onToggle:n,labelKey:a,infoKey:r,showToastOnCheck:o=!1})=>{const i=Uk(),{showToast:l}=$d();return s.jsxs(zt,{placement:"right-start",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex h-6 w-full select-none items-center justify-start rounded-md text-sm text-text-secondary hover:text-text-primary",children:s.jsx(Ut,{render:s.jsxs("div",{children:[s.jsx(R,{id:e,checked:t,onChange:e=>{const t=e.target.checked;t&&o&&l({message:i("com_ui_fork_remember_checked"),status:"info"}),n(t)},className:"h-4 w-4 rounded-sm border border-primary ring-offset-background transition duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground","aria-label":i(a)}),s.jsx("label",{htmlFor:e,className:"ml-2 cursor-pointer",children:i(a)})]})})}),s.jsxs($t,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(Bt,{children:i(r)}),xD]})]}),s.jsx(Ht,{gutter:14,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsx("div",{className:"space-y-2",children:s.jsx("p",{className:"text-sm text-text-secondary",children:i(r)})})})]})};function _D({messageId:e,conversationId:t,forkingSupported:a=!1,latestMessageId:r,isLast:o=!1}){const i=Uk(),{showToast:l}=$d(),[c,d]=n.useState(!1),{navigateToConvo:u}=gT(),[m,p]=n.useState(!1),f=n.useRef(null),[h,g]=Ie(Cy.forkSetting),[x,v]=n.useState(gD.default),[b,_]=Ie(Cy.splitAtTarget),[y,j]=Ie(Cy.rememberDefaultFork),w=Bn({placement:"bottom"}),N=s_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!o&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",m&&"active text-text-primary bg-surface-hover"),C=(e=>{const t=pr(),{onSuccess:n,...s}=e||{};return fr((e=>fx.forkConversation(e)),{onSuccess:(e,s,a)=>{if(!s.conversationId)return;const r=e.conversation,o=r.conversationId;o&&(t.setQueryData([ex.conversation,o],r),lb(t,r),t.setQueryData([ex.messages,o],e.messages),t.invalidateQueries({queryKey:[ex.allConversations],refetchPage:(e,t)=>0===t}),r.tags&&r.tags.length>0&&t.setQueryData([ex.conversationTags],(e=>e?e.map((e=>{var t;return(null==(t=r.tags)?void 0:t.includes(e.tag))?{...e,count:e.count+1}:e})):e)),null==n||n(e,s,a))},...s})})({onSuccess:e=>{u(e.conversation),l({message:i("com_ui_fork_success"),status:"success"})},onMutate:()=>{l({message:i("com_ui_fork_processing"),status:"info"})},onError:e=>{var t;const n=429===(null==(t=null==e?void 0:e.response)?void 0:t.status)||429===(null==e?void 0:e.status)||429===(null==e?void 0:e.statusCode);l({message:i(n?"com_ui_fork_error_rate_limit":"com_ui_fork_error"),status:"error"})}}),k=t??"";if(!a||!k||!e)return null;const S=t=>{c&&(j(!0),g(t)),C.mutate({messageId:e,conversationId:k,option:t,splitAtTarget:b,latestMessageId:r})},T=[{setting:mh.DIRECT_PATH,label:i(gD[mh.DIRECT_PATH]),icon:s.jsx($n,{className:"h-full w-full rotate-90 p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx($n,{className:"h-5 w-5 rotate-90"}),i(gD[mh.DIRECT_PATH])]}),hoverDescription:i("com_ui_fork_info_visible")},{setting:mh.INCLUDE_BRANCHES,label:i(gD[mh.INCLUDE_BRANCHES]),icon:s.jsx(Hn,{className:"h-full w-full rotate-180 p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx(Hn,{className:"h-4 w-4 rotate-180"}),i(gD[mh.INCLUDE_BRANCHES])]}),hoverDescription:i("com_ui_fork_info_branches")},{setting:mh.TARGET_LEVEL,label:i(gD[mh.TARGET_LEVEL]),icon:s.jsx(Gn,{className:"h-full w-full p-2"}),hoverTitle:s.jsxs(s.Fragment,{children:[s.jsx(Gn,{className:"h-5 w-5"}),`${i(gD[mh.TARGET_LEVEL])} (${i("com_endpoint_default")})`]}),hoverDescription:i("com_ui_fork_info_target")}];return s.jsxs(s.Fragment,{children:[s.jsx(Kn,{store:w,render:s.jsx("button",{className:N,onClick:t=>{y?(t.preventDefault(),C.mutate({messageId:e,splitAtTarget:b,conversationId:k,option:h,latestMessageId:r})):(w.toggle(),p(w.getState().open))},type:"button","aria-label":i("com_ui_fork"),children:s.jsx(Wn,{size:"19"})})}),s.jsxs(qn,{store:w,gutter:10,className:`popover-animate ${m?"open":""} flex w-60 flex-col gap-3 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-2 px-4 shadow-lg`,style:{outline:"none",pointerEvents:"auto",zIndex:50},portal:!0,unmountOnHide:!0,onClose:()=>p(!1),children:[s.jsxs("div",{className:"flex h-8 w-full items-center justify-center text-sm text-text-primary",children:[i(x),s.jsxs(zt,{placement:"right-start",children:[s.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center gap-1",children:[s.jsx(Ut,{render:s.jsx("button",{className:"flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary","aria-label":i("com_ui_fork_info_button_label"),children:s.jsx(pn,{})})}),s.jsxs($t,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[s.jsx(Bt,{children:i("com_ui_fork_more_info_options")}),xD]})]}),s.jsx(Ht,{gutter:19,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:s.jsxs("div",{className:"flex flex-col gap-2 space-y-2 text-sm text-text-secondary",children:[s.jsx("span",{children:i("com_ui_fork_info_1")}),s.jsx("span",{children:i("com_ui_fork_info_2")}),s.jsx("span",{children:i("com_ui_fork_info_3",{0:i("com_ui_fork_split_target")})})]})})]})]}),s.jsx("div",{className:"flex h-full w-full items-center justify-center gap-1",children:T.map((e=>s.jsx(vD,{setActiveSetting:v,timeoutRef:f,onClick:S,setting:e.setting,label:e.label,hoverTitle:e.hoverTitle,hoverDescription:e.hoverDescription,children:e.icon},e.setting)))}),s.jsx(bD,{id:"split-target-checkbox",checked:b,onToggle:_,labelKey:"com_ui_fork_split_target",infoKey:"com_ui_fork_info_start"}),s.jsx(bD,{id:"remember-checkbox",checked:c,onToggle:e=>{e&&l({message:i("com_ui_fork_remember_checked"),status:"info"}),d(e)},labelKey:"com_ui_fork_remember",infoKey:"com_ui_fork_info_remember",showToastOnCheck:!0})]})]})}function yD({setShowDeleteDialog:e,conversationId:t,setMenuOpen:a,retainView:r,title:o}){const i=Uk(),l=Fe(),c=pr(),{showToast:d}=$d(),{newConversation:u}=lT(),{conversationId:m}=nt(),p=Sj({onSuccess:()=>{e(!1),m!==t&&"new"!==m||(u(),l("/c/new",{replace:!0})),null==a||a(!1),r()},onError:()=>{d({message:i("com_ui_convo_delete_error"),severity:jv.ERROR,showIcon:!0})}}),f=n.useCallback((()=>{var e,n;const s=c.getQueryData([ex.messages,t]),a=null==(e=null==s?void 0:s[s.length-1])?void 0:e.thread_id,r=null==(n=null==s?void 0:s[s.length-1])?void 0:n.endpoint;p.mutate({conversationId:t,thread_id:a,endpoint:r,source:"button"})}),[t,p,c]);return s.jsxs(xl,{title:i("com_ui_delete_confirm")+" "+o,className:"w-11/12 max-w-md",showCloseButton:!1,children:[s.jsx(vl,{children:s.jsx(_l,{children:i("com_ui_delete_conversation")})}),s.jsxs("div",{children:[i("com_ui_delete_confirm")," ",s.jsx("strong",{children:o})," ?"]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[s.jsx(Si,{"aria-label":"cancel",variant:"outline",onClick:()=>e(!1),children:i("com_ui_cancel")}),s.jsx(Si,{variant:"destructive",onClick:f,disabled:p.isLoading,children:p.isLoading?s.jsx(rc,{}):i("com_ui_delete")})]})]})}function jD({conversationId:e,retainView:t,title:n,setMenuOpen:a,showDeleteDialog:r,setShowDeleteDialog:o,triggerRef:i}){return void 0===r||void 0===o?null:e?s.jsx(ml,{open:r,onOpenChange:o,triggerRef:i,children:s.jsx(yD,{setShowDeleteDialog:o,conversationId:e,setMenuOpen:a,retainView:t,title:n})}):null}function wD({share:e,conversationId:t,setShareDialogOpen:a,showQR:r,setShowQR:o,setSharedLink:i}){const l=Uk(),{showToast:c}=$d(),[d,u]=n.useState(!1),m=(null==e?void 0:e.shareId)??"",{mutateAsync:p,isLoading:f}=jj({onError:()=>{c({message:l("com_ui_share_error"),severity:jv.ERROR,showIcon:!0})}}),{mutateAsync:h,isLoading:g}=wj({onError:()=>{c({message:l("com_ui_share_error"),severity:jv.ERROR,showIcon:!0})}}),x=Nj({onSuccess:async()=>{u(!1),a(!1)}}),v=n.useCallback((e=>`${window.location.protocol}//${window.location.host}/share/${e}`),[]);return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex gap-2",children:[!m&&s.jsxs(Si,{disabled:f,variant:"submit",onClick:async()=>{const e=await p({conversationId:t}),n=v(e.shareId);i(n)},children:[!f&&l("com_ui_create_link"),f&&s.jsx(rc,{className:"size-4"})]}),m&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Dl,{description:l("com_ui_refresh_link"),render:e=>s.jsx(Si,{...e,onClick:()=>(async()=>{if(!m)return;const e=await h({shareId:m}),t=v(e.shareId);i(t)})(),variant:"outline",disabled:g,children:g?s.jsx(rc,{className:"size-4"}):s.jsx(Qn,{className:"size-4"})})}),s.jsx(Dl,{description:l(r?"com_ui_hide_qr":"com_ui_show_qr"),render:e=>s.jsx(Si,{...e,onClick:()=>o(!r),variant:"outline",children:s.jsx(Yn,{className:"size-4"})})}),s.jsx(Dl,{description:l("com_ui_delete"),render:e=>s.jsx(Si,{...e,onClick:()=>u(!0),variant:"destructive",children:s.jsx(jn,{className:"size-4"})})})]}),s.jsx(ml,{open:d,onOpenChange:u,children:s.jsx(Ud,{showCloseButton:!1,title:l("com_ui_delete_shared_link"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(ul,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[l("com_ui_delete_confirm")," ",s.jsxs("strong",{children:['"',m,'"']})]})})})}),selection:{selectHandler:async()=>{if(m)try{await x.mutateAsync({shareId:m}),c({message:l("com_ui_shared_link_delete_success"),severity:jv.SUCCESS})}catch(e){console.error("Failed to delete shared link:",e),c({message:l("com_ui_share_delete_error"),severity:jv.ERROR})}},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:l("com_ui_delete")}})})]})})}function ND({conversationId:e,open:t,onOpenChange:a,triggerRef:r,children:o}){const i=Uk(),[l,c]=n.useState(!1),[d,u]=n.useState(""),[m,p]=n.useState(!1),{data:f,isLoading:h}=ck(e),g=sE({text:d});n.useEffect((()=>{if(void 0!==(null==f?void 0:f.shareId)){const e=`${window.location.protocol}//${window.location.host}/share/${f.shareId}`;u(e)}}),[f]);const x=!0===h?null:s.jsx(wD,{share:f,conversationId:e,setShareDialogOpen:a,showQR:l,setShowQR:c,setSharedLink:u}),v=(null==f?void 0:f.shareId)??"";return s.jsxs(ml,{open:t,onOpenChange:a,triggerRef:r,children:[o,s.jsx(Ud,{buttons:x,showCloseButton:!0,showCancelButton:!1,title:i("com_ui_share_link_to_chat"),className:"max-w-[550px]",main:s.jsxs("div",{children:[s.jsx("div",{className:"h-full py-2 text-text-primary",children:!0===h?s.jsx(rc,{className:"m-auto h-14 animate-spin"}):!0===(null==f?void 0:f.success)?i("com_ui_share_update_message"):i("com_ui_share_create_message")}),s.jsxs("div",{className:"relative items-center rounded-lg p-2",children:[l&&s.jsx("div",{className:"mb-4 flex flex-col items-center",children:s.jsx(qo,{value:d,size:200,marginSize:2,className:"rounded-2xl"})}),v&&s.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-surface-secondary p-2",children:[s.jsx("div",{className:"flex-1 break-all text-sm text-text-secondary",children:d}),s.jsx(Si,{size:"sm",variant:"outline",onClick:()=>{m||g(p)},className:s_("shrink-0",m?"cursor-default":""),children:m?s.jsx(ft,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})]})]})]})})]})}const CD=n.memo((function({conversationId:e,title:t,retainView:a,renameHandler:r,isPopoverActive:o,setIsPopoverActive:i,isActiveConvo:l}){const c=Uk(),{index:d}=Mk(),{data:u}=Wy(),{navigateToConvo:m}=gT(d),{showToast:p}=$d(),f=Fe(),{conversationId:h}=nt(),{newConversation:g}=lT(),x=n.useRef(null),v=n.useRef(null),[b,_]=n.useState(!1),[y,j]=n.useState(!1),w=yj(),N=(e=>{const t=pr(),{onSuccess:n,...s}=e??{};return fr((e=>fx.duplicateConversation(e)),{onSuccess:(e,s,a)=>{const r=e.conversation;(null==r?void 0:r.conversationId)&&(t.setQueryData([ex.conversation,r.conversationId],r),lb(t,r),t.setQueryData([ex.messages,r.conversationId],e.messages),t.invalidateQueries({queryKey:[ex.allConversations],refetchPage:(e,t)=>0===t}),r.tags&&r.tags.length>0&&t.setQueryData([ex.conversationTags],(e=>e?e.map((e=>{var t;return(null==(t=r.tags)?void 0:t.includes(e.tag))?{...e,count:e.count+1}:e})):e)),null==n||n(e,s,a))},...s})})({onSuccess:e=>{m(e.conversation),p({message:c("com_ui_duplication_success"),status:"success"}),i(!1)},onMutate:()=>{p({message:c("com_ui_duplication_processing"),status:"info"})},onError:()=>{p({message:c("com_ui_duplication_error"),status:"error"})}}),C=N.isLoading,k=w.isLoading,S=n.useCallback((()=>{_(!0)}),[]),T=n.useCallback((()=>{j(!0)}),[]),E=n.useCallback((async()=>{const t=e??"";t&&w.mutate({conversationId:t,isArchived:!0},{onSuccess:()=>{h!==t&&"new"!==h||(g(),f("/c/new",{replace:!0})),a(),i(!1)},onError:()=>{p({message:c("com_ui_archive_error"),severity:jv.ERROR,showIcon:!0})}})}),[e,h,w,f,g,a,i,p,c]),R=n.useCallback((()=>{N.mutate({conversationId:e??""})}),[e,N]),I=n.useMemo((()=>[{label:c("com_ui_share"),onClick:S,icon:s.jsx(Qt,{className:"icon-sm mr-2 text-text-primary"}),show:u&&u.sharedLinksEnabled,hideOnClick:!1,ref:x,render:e=>s.jsx("button",{...e})},{label:c("com_ui_rename"),onClick:r,icon:s.jsx(sn,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_duplicate"),onClick:R,hideOnClick:!1,icon:C?s.jsx(rc,{className:"size-4"}):s.jsx(ht,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_archive"),onClick:E,hideOnClick:!1,icon:k?s.jsx(rc,{className:"size-4"}):s.jsx(Xn,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_delete"),onClick:T,icon:s.jsx(Zn,{className:"icon-sm mr-2 text-text-primary"}),hideOnClick:!1,ref:v,render:e=>s.jsx("button",{...e})}]),[c,S,u,r,R,C,E,k,T]),P=n.useId();return s.jsxs(s.Fragment,{children:[s.jsx(Nd,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:o,setIsOpen:i,trigger:s.jsx(ie,{id:`conversation-menu-${e}`,"aria-label":c("com_nav_convo_menu_options"),className:s_("inline-flex h-7 w-7 items-center justify-center gap-2 rounded-md border-none p-0 text-sm font-medium ring-ring-primary transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50",!0===l||o?"opacity-100":"opacity-0 focus:opacity-100 group-focus-within:opacity-100 group-hover:opacity-100 data-[open]:opacity-100"),onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},children:s.jsx(Jn,{className:"icon-md text-text-secondary","aria-hidden":!0})}),items:I,menuId:P,className:"z-30"}),b&&s.jsx(ND,{conversationId:e??"",open:b,onOpenChange:_,triggerRef:x}),y&&s.jsx(jD,{title:t??"",retainView:a,triggerRef:v,setMenuOpen:i,showDeleteDialog:y,conversationId:e??"",setShowDeleteDialog:j})]})}),((e,t)=>e.conversationId===t.conversationId&&e.title===t.title&&e.isPopoverActive===t.isPopoverActive&&e.isActiveConvo===t.isActiveConvo)),kD=({titleInput:e,setTitleInput:t,onSubmit:a,onCancel:r,localize:o})=>{const i=n.useRef(null);n.useEffect((()=>{i.current&&(i.current.focus(),i.current.select())}),[]);return s.jsxs("div",{className:"absolute inset-0 z-20 flex w-full items-center rounded-lg bg-surface-active-alt p-1.5",role:"form","aria-label":o("com_ui_rename_conversation"),children:[s.jsx("input",{ref:i,type:"text",className:"w-full rounded bg-transparent p-0.5 text-sm leading-tight focus-visible:outline-none",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{switch(t.key){case"Escape":r();break;case"Enter":a(e)}},onBlur:()=>a(e),maxLength:100,"aria-label":o("com_ui_new_conversation_title")}),s.jsxs("div",{className:"flex gap-1",role:"toolbar",children:[s.jsx("button",{onClick:()=>r(),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":o("com_ui_cancel"),children:s.jsx(vt,{className:"h-4 w-4","aria-hidden":"true"})}),s.jsx("button",{onClick:()=>a(e),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":o("com_ui_save"),children:s.jsx(es,{className:"h-4 w-4","aria-hidden":"true"})})]})]})},SD=({isActiveConvo:e,title:t,onRename:n,isSmallScreen:a,localize:r,children:o})=>s.jsxs("div",{className:s_("flex grow items-center gap-2 overflow-hidden rounded-lg px-2",e?"bg-surface-active-alt":""),title:t??void 0,"aria-current":e?"page":void 0,style:{width:"100%"},children:[o,s.jsx("div",{className:"relative flex-1 grow overflow-hidden whitespace-nowrap",style:{textOverflow:"clip"},onDoubleClick:e=>{a||(e.preventDefault(),e.stopPropagation(),n())},role:"button","aria-label":a?void 0:t||r("com_ui_untitled"),children:t||r("com_ui_untitled")}),s.jsx("div",{className:s_("absolute bottom-0 right-0 top-0 w-20 rounded-r-lg bg-gradient-to-l",e?"from-surface-active-alt":"from-surface-primary-alt from-0% to-transparent group-hover:from-surface-active-alt group-hover:from-40%"),"aria-hidden":"true"})]});function TD({conversation:e,retainView:t,toggleNav:a}){const r=nt(),o=Uk(),{showToast:i}=$d(),{navigateToConvo:l}=gT(),{data:c}=Ky(),d=n.useMemo((()=>r.conversationId),[r.conversationId]),u=(e=>{const t=pr();return fr((e=>fx.updateConversation(e)),{onSuccess:(n,s)=>{const a=s.conversationId||e;t.setQueryData([ex.conversation,a],n),cb(t,a,(()=>n))}})})(d??""),m=Ae(Cy.allConversationsSelector),p=Wi("(max-width: 768px)"),{conversationId:f,title:h=""}=e,[g,x]=n.useState(h||""),[v,b]=n.useState(!1),[_,y]=n.useState(!1),j=n.useRef(h);n.useEffect((()=>{h!==j.current&&(x(h),j.current=h)}),[h]);const w=n.useMemo((()=>{if(f===dh.NEW_CONVO)return d===dh.NEW_CONVO;if(d!==dh.NEW_CONVO)return d===f;return(null==m?void 0:m[0])===f}),[d,f,m]),N=()=>{y(!1),x(h),b(!0)},C=t=>{if(t){a();const e=window.location.origin,t=`/c/${f}`;window.open(e+t,"_blank")}else d===f||_||(a(),"string"==typeof h&&h.length>0&&(document.title=h),l(e,{currentConvoId:d,resetLatestMessage:!f||f===dh.NEW_CONVO}))},k={title:h,retainView:t,renameHandler:N,isActiveConvo:w,conversationId:f,isPopoverActive:_,setIsPopoverActive:y};return s.jsxs("div",{className:s_("group relative flex h-12 w-full items-center rounded-lg transition-colors duration-200 md:h-9",w?"bg-surface-active-alt":"hover:bg-surface-active-alt"),role:"listitem",tabIndex:0,onClick:e=>{v||0===e.button&&C(e.ctrlKey||e.metaKey)},onKeyDown:e=>{v||"Enter"===e.key&&C(!1)},style:{cursor:v?"default":"pointer"},"data-testid":"convo-item",children:[v?s.jsx(kD,{titleInput:g,setTitleInput:x,onSubmit:async e=>{if(f&&e!==h)try{await u.mutateAsync({conversationId:f,title:e.trim()||o("com_ui_untitled")}),b(!1)}catch(t){a_.error("Error renaming conversation",t),x(h),i({message:o("com_ui_rename_failed"),severity:jv.ERROR,showIcon:!0}),b(!1)}else b(!1)},onCancel:()=>{x(h),b(!1)},localize:o}):s.jsx(SD,{isActiveConvo:w,title:h,onRename:N,isSmallScreen:p,localize:o,children:s.jsx(eI,{conversation:e,endpointsConfig:c,size:20,context:"menu-item"})}),s.jsx("div",{className:s_("mr-2 flex origin-left",_||w?"pointer-events-auto max-w-[28px] scale-x-100 opacity-100":"pointer-events-none max-w-0 scale-x-0 opacity-0 group-focus-within:pointer-events-auto group-focus-within:max-w-[28px] group-focus-within:scale-x-100 group-focus-within:opacity-100 group-hover:pointer-events-auto group-hover:max-w-[28px] group-hover:scale-x-100 group-hover:opacity-100"),"aria-hidden":!(_||w),children:!v&&s.jsx(CD,{...k})})]})}const ED=n.memo((()=>{const e=Uk();return s.jsxs("div",{className:"mx-auto mt-2 flex items-center justify-center gap-2",children:[s.jsx(rc,{className:"text-text-primary"}),s.jsx("span",{className:"animate-pulse text-text-primary",children:e("com_ui_loading")})]})})),RD=n.memo((({groupName:e})=>{const t=Uk();return s.jsx("div",{className:"mt-2 pl-2 pt-1 text-text-secondary",style:{fontSize:"0.7rem"},children:t(e)||e})}));RD.displayName="DateLabel";const ID=n.memo((({conversation:e,retainView:t,toggleNav:n})=>s.jsx(TD,{conversation:e,retainView:t,toggleNav:n})),((e,t)=>e.conversation.conversationId===t.conversation.conversationId&&e.conversation.title===t.conversation.title&&e.conversation.endpoint===t.conversation.endpoint)),PD=n.memo((({conversations:e,moveToTop:t,toggleNav:a,containerRef:r,loadMoreConversations:o,isLoading:i,isSearchLoading:l})=>{const c=Wi("(max-width: 768px)")?44:34,d=n.useMemo((()=>e.filter(Boolean)),[e]),u=n.useMemo((()=>ob(d)),[d]),m=n.useMemo((()=>{const e=[];return u.forEach((([t,n])=>{e.push({type:"header",groupName:t}),e.push(...n.map((e=>({type:"convo",convo:e}))))})),i&&e.push({type:"loading"}),e}),[u,i]),p=n.useMemo((()=>new Vr({fixedWidth:!0,defaultHeight:c,keyMapper:e=>{const t=m[e];return"header"===t.type?`header-${e}`:"convo"===t.type?`convo-${t.convo.conversationId}`:"loading"===t.type?`loading-${e}`:`unknown-${e}`}})),[m,c]),f=n.useCallback((({index:e,key:n,parent:r,style:o})=>{const i=m[e];if("loading"===i.type)return s.jsx(Br,{cache:p,columnIndex:0,parent:r,rowIndex:e,children:({registerChild:e})=>s.jsx("div",{ref:e,style:o,children:s.jsx(ED,{})})},n);let l;return"header"===i.type?l=s.jsx(RD,{groupName:i.groupName}):"convo"===i.type&&(l=s.jsx(ID,{conversation:i.convo,retainView:t,toggleNav:a})),s.jsx(Br,{cache:p,columnIndex:0,parent:r,rowIndex:e,children:({registerChild:e})=>s.jsx("div",{ref:e,style:o,children:l})},n)}),[p,m,t,a]),h=n.useCallback((({index:e})=>p.getHeight(e,0)),[p]),g=n.useMemo((()=>To(o,300)),[o]),x=n.useCallback((({stopIndex:e})=>{e>=m.length-8&&g()}),[m.length,g]);return s.jsx("div",{className:"relative flex h-full flex-col pb-2 text-sm text-text-primary",children:l?s.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[s.jsx(rc,{className:"text-text-primary"}),s.jsx("span",{className:"ml-2 text-text-primary",children:"Loading..."})]}):s.jsx("div",{className:"flex-1",children:s.jsx($r,{children:({width:e,height:t})=>s.jsx(Hr,{ref:r,width:e,height:t,deferredMeasurementCache:p,rowCount:m.length,rowHeight:h,rowRenderer:f,overscanRowCount:10,className:"outline-none",style:{outline:"none"},role:"list","aria-label":"Conversations",onRowsRendered:x,tabIndex:-1})})})})}));function AD({isLast:e,index:t,messageId:a,content:r,className:o,renderButton:i}){var l,c;const d=Uk(),u=Ae(Cy.playbackRate),{toggleSpeech:m,isSpeaking:p,audioRef:f}=Gj({isLast:e,index:t,content:r}),h=()=>!0===p?s.jsx(Dc,{className:"icon-md-heavy h-[18px] w-[18px]"}):s.jsx(Oc,{className:"icon-md-heavy h-[18px] w-[18px]"});n.useEffect((()=>{const e=document.getElementById(`audio-${a}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)}),[f,p,u,a]),a_.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(l=f.current)?void 0:l.src,f.current);const g=()=>{f.current&&(f.current.muted=!1),m()},x=d(!0===p?"com_ui_stop":"com_ui_read_aloud");return s.jsxs(s.Fragment,{children:[i?i({onClick:g,title:x,icon:h(),isActive:p,className:o}):s.jsx("button",{className:o,onClickCapture:g,type:"button",title:x,children:h()}),s.jsx("audio",{ref:f,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=f.current)?void 0:c.src,onError:e=>{a_.error("Error fetching audio:",e)},id:`audio-${a}`,autoPlay:!0})]})}function MD({isLast:e,index:t,messageId:a,content:r,className:o,renderButton:i}){var l,c;const d=Uk(),u=Ae(Cy.playbackRate),{toggleSpeech:m,isSpeaking:p,isLoading:f,audioRef:h}=Hj({isLast:e,index:t,messageId:a,content:r}),g=()=>!0===f?s.jsx(rc,{className:"icon-md-heavy h-[18px] w-[18px]"}):!0===p?s.jsx(Dc,{className:"icon-md-heavy h-[18px] w-[18px]"}):s.jsx(Oc,{className:"icon-md-heavy h-[18px] w-[18px]"});return n.useEffect((()=>{const e=document.getElementById(`audio-${a}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)}),[h,p,u,a]),a_.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(l=h.current)?void 0:l.src,h.current),s.jsxs(s.Fragment,{children:[i?i({onClick:()=>{h.current&&(h.current.muted=!1),m()},title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),icon:g(),isActive:p,className:o}):s.jsx("button",{onClickCapture:()=>{h.current&&(h.current.muted=!1),m()},type:"button",title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),children:g()}),s.jsx("audio",{ref:h,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=h.current)?void 0:c.src,onError:e=>{a_.error("Error fetching audio:",e)},id:`audio-${a}`,autoPlay:!0})]})}const LD=n.memo((function(e){const t=Ae(Cy.engineTTS),n={[hv.browser]:AD,[hv.external]:MD}[t];return n?s.jsx(n,{...e}):null})),OD={AlertCircle:gt,PenTool:rs,ImageOff:as,Ban:ss,HelpCircle:ns,CheckCircle:ts,Lightbulb:qe,Search:wt,ThumbsUp:Wc,ThumbsDown:qc};function DD({tag:e,active:t,onClick:n}){const a=Uk(),r=OD[e.icon]||gt,o=a(e.label);return s.jsxs("button",{className:s_("flex w-full items-center gap-3 rounded-xl p-2 text-text-secondary transition-colors duration-200 hover:bg-surface-hover hover:text-text-primary",t&&"bg-surface-hover font-semibold text-text-primary"),onClick:n,type:"button","aria-label":o,"aria-pressed":t,children:[s.jsx(r,{size:"19",bold:t}),s.jsx("span",{children:o})]})}function FD({isLast:e,feedback:t,onFeedback:a,onOther:r}){var o,i;const l=Uk(),c=Bn({placement:"bottom"}),d=Bn({placement:"bottom"}),u=n.useMemo((()=>pu("thumbsUp")),[]),m=n.useMemo((()=>pu("thumbsDown")),[]),p="thumbsUp"===(null==t?void 0:t.rating)?null==(o=t.tag)?void 0:o.key:void 0,f="thumbsDown"===(null==t?void 0:t.rating)?null==(i=t.tag)?void 0:i.key:void 0,h=n.useCallback((e=>{e.preventDefault(),"thumbsUp"===(null==t?void 0:t.rating)?a(void 0):c.toggle()}),[t,a,c]),g=n.useCallback((e=>t=>{t.preventDefault(),c.hide(),a({rating:"thumbsUp",tag:e}),"other"===e.key&&(null==r||r())}),[a,r,c]),x=n.useCallback((e=>{e.preventDefault(),"thumbsDown"===(null==t?void 0:t.rating)?null==r||r():d.toggle()}),[t,r,d]),v=n.useCallback((e=>t=>{t.preventDefault(),d.hide(),a({rating:"thumbsDown",tag:e}),"other"===e.key&&(null==r||r())}),[a,r,d]);return s.jsxs(s.Fragment,{children:[s.jsx(Kn,{store:c,render:s.jsx("button",{className:zD("thumbsUp"===(null==t?void 0:t.rating),e),onClick:h,type:"button",title:l("com_ui_feedback_positive"),"aria-pressed":"thumbsUp"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:s.jsx(Wc,{size:"19",bold:"thumbsUp"===(null==t?void 0:t.rating)})})}),s.jsx(qn,{store:c,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:s.jsx("div",{className:"flex flex-col items-stretch justify-center",children:u.map((e=>s.jsx(DD,{tag:e,active:p===e.key,onClick:g(e)},e.key)))})}),s.jsx(Kn,{store:d,render:s.jsx("button",{className:zD("thumbsDown"===(null==t?void 0:t.rating),e),onClick:x,type:"button",title:l("com_ui_feedback_negative"),"aria-pressed":"thumbsDown"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:s.jsx(qc,{size:"19",bold:"thumbsDown"===(null==t?void 0:t.rating)})})}),s.jsx(qn,{store:d,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:s.jsx("div",{className:"flex flex-col items-stretch justify-center",children:m.map((e=>s.jsx(DD,{tag:e,active:f===e.key,onClick:v(e)},e.key)))})})]})}function zD(e,t){return s_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!t&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",e&&"active text-text-primary bg-surface-hover")}function UD({isLast:e=!1,handleFeedback:t,feedback:a}){var r;const o=Uk(),[i,l]=n.useState(!1),[c,d]=n.useState(a);n.useEffect((()=>{d(a)}),[a]);const u=n.useCallback((e=>{d(e),t({feedback:e})}),[t]),m=n.useCallback((e=>{var t;"other"===(null==(t=null==e?void 0:e.tag)?void 0:t.key)?l(!0):l(!1),u(e)}),[u]),p=n.useCallback((()=>l(!0)),[]),f=n.useCallback((()=>{var e,t;("other"!==(null==(e=null==c?void 0:c.tag)?void 0:e.key)||(null==(t=null==c?void 0:c.text)?void 0:t.trim()))&&(u(c),l(!1))}),[c,u]),h=n.useCallback((()=>{d(void 0),t({feedback:void 0}),l(!1)}),[t]);return s.jsxs(s.Fragment,{children:[c?(()=>{if(!c)return null;const t="thumbsUp"===c.rating,n=t?Wc:qc,a=o(t?"com_ui_feedback_positive":"com_ui_feedback_negative");return s.jsx("button",{className:zD(!0,e),onClick:()=>{t?m(void 0):l(!0)},type:"button",title:a,"aria-pressed":"true",children:s.jsx(n,{size:"19",bold:!0})})})():s.jsx(FD,{isLast:e,feedback:c,onFeedback:m,onOther:p}),s.jsx(ml,{open:i,onOpenChange:l,children:s.jsxs(xl,{className:"w-11/12 max-w-lg",children:[s.jsx(_l,{className:"text-token-text-primary text-lg font-semibold leading-6",children:o("com_ui_feedback_more_information")}),s.jsx("textarea",{className:"w-full rounded-xl border border-border-light bg-transparent p-2 text-text-primary",value:(null==c?void 0:c.text)||"",onChange:e=>{d((t=>t?{...t,text:e.target.value}:void 0))},rows:4,placeholder:o("com_ui_feedback_placeholder"),maxLength:500}),s.jsxs("div",{className:"mt-4 flex items-end justify-end gap-2",children:[s.jsx(Si,{variant:"destructive",onClick:h,children:o("com_ui_delete")}),s.jsx(Si,{variant:"submit",onClick:f,disabled:!(null==(r=null==c?void 0:c.text)?void 0:r.trim()),children:o("com_ui_save")})]})]})})]})}const VD=e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.map((e=>{if("string"==typeof e)return e;if("text"in e)return e.text||"";if("think"in e){const t=e.think;return"string"==typeof t?t:t&&"text"in t&&t.text||""}return""})).join(""):e.text||"",BD=n.memo((({id:e,onClick:t,title:n,icon:a,isActive:r=!1,isVisible:o=!0,isDisabled:i=!1,isLast:l=!1,className:c=""})=>{const d=s_("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!l&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100",!o&&"opacity-0","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",r&&o&&"active text-text-primary bg-surface-hover",c);return s.jsx("button",{id:e,className:d,onClick:t,type:"button",title:n,disabled:i,children:a})}));BD.displayName="HoverButton";const $D=n.memo((({index:e,isEditing:t,enterEdit:a,copyToClipboard:r,conversation:o,isSubmitting:i,message:l,regenerate:c,handleContinue:d,latestMessage:u,isLast:m,handleFeedback:p})=>{const f=Uk(),[h,g]=n.useState(!1),[x]=Ie(Cy.textToSpeech),v=n.useMemo((()=>o?o.endpointType??o.endpoint:""),[o]),b=function({error:e=!1,endpoint:t,messageId:n,isEditing:s=!1,isSubmitting:a,searchResult:r=!1,finish_reason:o="",latestMessageId:i,isCreatedByUser:l=!1}){const c=Boolean([Nu.openAI,Nu.custom,Nu.google,Nu.agents,Nu.bedrock,Nu.anthropic,Nu.gptPlugins,Nu.azureOpenAI].find((e=>e===t))),d=i===n&&o&&"stop"!==o&&!s&&!r&&c,u=Boolean([Nu.azureOpenAI,Nu.openAI,Nu.custom,Nu.agents,Nu.bedrock,Nu.chatGPTBrowser,Nu.google,Nu.gptPlugins,Nu.anthropic].find((e=>e===t))),m=!l&&!r&&!s&&!a&&u,p=a||e||r||!u||!c&&!l;return{forkingSupported:!Mu(t)&&!r,continueSupported:d,regenerateEnabled:m,isEditableEndpoint:c,hideEditButton:p}}({isEditing:t,isSubmitting:i,error:l.error,endpoint:v??"",messageId:l.messageId,searchResult:l.searchResult,finish_reason:l.finish_reason,isCreatedByUser:l.isCreatedByUser,latestMessageId:null==u?void 0:u.messageId}),{hideEditButton:_,regenerateEnabled:y,continueSupported:j,forkingSupported:w,isEditableEndpoint:N}=b;if(!o)return null;const{isCreatedByUser:C,error:k}=l;if(!0===k)return s.jsx("div",{className:"visible flex justify-center self-end lg:justify-start",children:y&&s.jsx(BD,{onClick:c,title:f("com_ui_regenerate"),icon:s.jsx(pc,{size:"19"}),isLast:m})});return s.jsxs("div",{className:"group visible flex justify-center gap-0.5 self-end focus-within:outline-none lg:justify-start",children:[x&&s.jsx(LD,{index:e,isLast:m,messageId:l.messageId,content:VD(l),renderButton:e=>s.jsx(BD,{onClick:e.onClick,title:e.title,icon:e.icon,isActive:e.isActive,isLast:m})}),s.jsx(BD,{onClick:()=>r(g),title:f(h?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),icon:h?s.jsx(ic,{className:"h-[18px] w-[18px]"}):s.jsx(oc,{size:"19"}),isLast:m,className:"ml-0 flex items-center gap-1.5 text-xs "+(i&&C?"md:opacity-0 md:group-hover:opacity-100":"")}),N&&s.jsx(BD,{id:`edit-${l.messageId}`,onClick:()=>{if(t)return a(!0);a()},title:f("com_ui_edit"),icon:s.jsx(tc,{size:"19"}),isActive:t,isVisible:!_,isDisabled:_,isLast:m,className:C?"":"active"}),s.jsx(_D,{messageId:l.messageId,conversationId:o.conversationId,forkingSupported:w,latestMessageId:null==u?void 0:u.messageId,isLast:m}),!C&&null!=p&&s.jsx(UD,{handleFeedback:p,feedback:l.feedback,isLast:m}),y&&s.jsx(BD,{onClick:c,title:f("com_ui_regenerate"),icon:s.jsx(pc,{size:"19"}),isLast:m,className:"active"}),j&&s.jsx(BD,{onClick:e=>e&&d(e),title:f("com_ui_continue"),icon:s.jsx(fc,{className:"w-19 h-19 -rotate-180"}),isLast:m,className:"active"})]})})),HD=n.memo((({iconData:e,assistant:t,agent:a})=>{a_.log("icon_data",e,t,a);const{data:r}=Ky(),o=n.useMemo((()=>(null==a?void 0:a.name)??""),[a]),i=n.useMemo((()=>{var e;return(null==(e=null==a?void 0:a.avatar)?void 0:e.filepath)??""}),[a]),l=n.useMemo((()=>(null==t?void 0:t.name)??""),[t]),c=n.useMemo((()=>{var e;return(null==(e=null==t?void 0:t.metadata)?void 0:e.avatar)??""}),[t]),d=n.useMemo((()=>{let e="";return t?e=c:a&&(e=i),e}),[t,a,c,i]),u=null==e?void 0:e.iconURL,m=n.useMemo((()=>Mb({endpointsConfig:r,iconURL:u,endpoint:null==e?void 0:e.endpoint})),[r,u,null==e?void 0:e.endpoint]),p=n.useMemo((()=>Sb(r,m,"iconURL")),[r,m]);return!0!==(null==e?void 0:e.isCreatedByUser)&&null!=u&&u.includes("http")?s.jsx(SR,{iconURL:u,modelLabel:null==e?void 0:e.modelLabel,context:"message",assistantAvatar:c,agentAvatar:i,endpointIconURL:p,assistantName:l,agentName:o}):s.jsx(XR,{isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1,endpoint:m,iconURL:d||p,model:null==e?void 0:e.model,assistantName:l,agentName:o,size:28.8})}));HD.displayName="MessageIcon";const GD=n.memo((({message:e,isCard:t=!1,siblingIdx:a,siblingCount:r,setSiblingIdx:o,currentEditId:i,isMultiMessage:l=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{attachments:m,searchResults:p}=qT({messageId:null==e?void 0:e.messageId,attachments:null==e?void 0:e.attachments}),{edit:f,index:h,agent:g,assistant:x,enterEdit:v,conversation:b,messageLabel:_,isSubmitting:y,latestMessage:j,handleContinue:w,copyToClipboard:N,setLatestMessage:C,regenerateMessage:k,handleFeedback:S}=aE({message:e,searchResults:p,currentEditId:i,isMultiMessage:l,setCurrentEditId:c}),T=Ae(Cy.maximizeChatSpace),E=Ae(Cy.fontSize),R=n.useCallback((()=>k()),[k]),I=n.useMemo((()=>{var t;return!(null==(t=null==e?void 0:e.children)?void 0:t.length)&&((null==e?void 0:e.depth)===(null==j?void 0:j.depth)||-1===(null==e?void 0:e.depth))}),[null==e?void 0:e.children,null==e?void 0:e.depth,null==j?void 0:j.depth]),P=(null==e?void 0:e.messageId)===(null==j?void 0:j.messageId),A=I&&!d&&t,M=t&&!d&&P,L=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==b?void 0:b.endpoint),model:(null==e?void 0:e.model)??(null==b?void 0:b.model),iconURL:null==e?void 0:e.iconURL,modelLabel:_,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[_,null==b?void 0:b.endpoint,null==b?void 0:b.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),O=n.useMemo((()=>A&&!P?()=>{a_.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),a_.dir(e),C(e)}:void 0),[A,P,e,C]);if(!e)return null;const D={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:T?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},F={latestCard:M?"bg-surface-secondary":"",cardRender:A?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return s.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:s_(D.common,t?D.card:D.chat,F.latestCard,F.cardRender,F.focus,"message-render"),onClick:O,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!O||O()},role:A?"button":void 0,tabIndex:A?0:void 0,children:[M&&s.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(HD,{iconData:L,assistant:x,agent:g})})}),s.jsxs("div",{className:s_("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:s_("select-none font-semibold",E),children:_}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsx(fD,{edit:f,isLast:I,enterEdit:v,siblingIdx:a,messageId:e.messageId,attachments:m,isSubmitting:y,searchResults:p,setSiblingIdx:o,isLatestMessage:P,isCreatedByUser:e.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,content:e.content})}),!d&&!y||(null==(u=e.children)?void 0:u.length)?s.jsxs(sD,{classes:"text-xs",children:[s.jsx(eD,{siblingIdx:a,siblingCount:r,setSiblingIdx:o}),s.jsx($D,{index:h,isEditing:f,message:e,enterEdit:v,isSubmitting:y,conversation:b??null,regenerate:R,copyToClipboard:N,handleContinue:w,latestMessage:j,handleFeedback:S,isLast:I})]}):s.jsx(hD,{isCard:t})]})]})]})})),KD=S.memo((({handleScroll:e,children:t})=>s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function WD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:r,latestMultiMessage:o,isSubmittingFamily:i}=rE({message:e.message}),{message:l,currentEditId:c,setCurrentEditId:d}=e;if(!l||"object"!=typeof l)return null;const{children:u,messageId:m=null}=l;return s.jsxs(s.Fragment,{children:[s.jsx(KD,{handleScroll:a,children:t?s.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"flex w-full flex-row flex-wrap justify-between gap-1 md:max-w-5xl md:flex-nowrap md:gap-2 lg:max-w-5xl xl:max-w-6xl",children:[s.jsx(GD,{...e,message:l,isSubmittingFamily:i,isCard:!0}),s.jsx(GD,{...e,isMultiMessage:!0,isCard:!0,message:r??o??void 0,isSubmittingFamily:i})]})}):s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6 ",children:s.jsx(GD,{...e})})}),s.jsx(ZD,{messageId:m,conversation:n,messagesTree:u??[],currentEditId:c,setCurrentEditId:d},m)]})}function qD(e){const t=Uk(),{message:a,siblingIdx:r,siblingCount:o,setSiblingIdx:i,currentEditId:l,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=qT({messageId:null==a?void 0:a.messageId,attachments:null==a?void 0:a.attachments}),{edit:m,index:p,agent:f,isLast:h,enterEdit:g,assistant:x,handleScroll:v,conversation:b,isSubmitting:_,latestMessage:y,handleContinue:j,copyToClipboard:w,regenerateMessage:N}=function(e){const t=n.useRef(""),{message:s,currentEditId:a,setCurrentEditId:r}=e,{ask:o,index:i,regenerate:l,isSubmitting:c,conversation:d,latestMessage:u,setAbortScroll:m,handleContinue:p,setLatestMessage:f}=XS(),h=zk(),g=bS(),{text:x,content:v,children:b,messageId:_=null,isCreatedByUser:y}=s??{},j=_===a,w=0===(null==b?void 0:b.length)||void 0===(null==b?void 0:b.length);n.useEffect((()=>{const e=null==d?void 0:d.conversationId;if(e===dh.NEW_CONVO)return;if(!s)return;if(!w)return;const n=yb(s,e),a={textKey:n,"latestText.current":t.current,messageId:s.messageId,convoId:e};n!==t.current||t.current&&e!==t.current.split(dh.COMMON_DIVIDER)[2]?(a_.log("[useMessageHelpers] Setting latest message: ",a),t.current=n,f({...s})):a_.log("No change in latest message",a)}),[w,s,f,null==d?void 0:d.conversationId]);const N=n.useCallback((e=>r&&r(!0===e?-1:_)),[_,r]),C=n.useCallback((e=>{To((()=>{a_.log("message_scrolling",`useMessageHelpers: setting abort scroll to ${c}, handleScroll event`,e),m(!!c)}),500)()}),[c,m]),k=n.useMemo((()=>{if(!Mu(null==d?void 0:d.endpoint))return;const e=(null==d?void 0:d.endpoint)??"",t=(null==s?void 0:s.model)??"";return(null==g?void 0:g[e])?g[e][t]:void 0}),[null==d?void 0:d.endpoint,null==s?void 0:s.model,g]),S=n.useMemo((()=>{if(!Lu(null==d?void 0:d.endpoint))return;const e=(null==s?void 0:s.model)??"";return h?h[e]:void 0}),[h,null==d?void 0:d.endpoint,null==s?void 0:s.model]),T=sE({text:x,content:v});return{ask:o,edit:j,agent:S,index:i,isLast:w,assistant:k,enterEdit:N,conversation:d,isSubmitting:c,handleScroll:C,latestMessage:u,handleContinue:p,copyToClipboard:T,regenerateMessage:()=>{c&&!0===y||!s||l(s)}}}(e),C=Ae(Cy.fontSize),k=Ae(Cy.maximizeChatSpace),{children:S,messageId:T=null,isCreatedByUser:E}=a??{},R=n.useMemo((()=>{let e="";return!0===E?e=t("com_user_message"):x?e=x.name??t("com_ui_assistant"):f&&(e=f.name??t("com_ui_agent")),e}),[x,f,E,t]),I=n.useMemo((()=>({endpoint:(null==a?void 0:a.endpoint)??(null==b?void 0:b.endpoint),model:(null==a?void 0:a.model)??(null==b?void 0:b.model),iconURL:(null==a?void 0:a.iconURL)??(null==b?void 0:b.iconURL),modelLabel:R,isCreatedByUser:null==a?void 0:a.isCreatedByUser})),[R,null==b?void 0:b.endpoint,null==b?void 0:b.iconURL,null==b?void 0:b.model,null==a?void 0:a.model,null==a?void 0:a.iconURL,null==a?void 0:a.endpoint,null==a?void 0:a.isCreatedByUser]);if(!a)return null;const P={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu",chat:k?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:v,onTouchMove:v,children:s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{id:T??"","aria-label":`message-${a.depth}-${T}`,className:s_(P.common,P.chat,"message-render"),children:[s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full pt-0.5",children:s.jsx(HD,{iconData:I,assistant:x,agent:f})})}),s.jsxs("div",{className:s_("relative flex w-11/12 flex-col",E?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:s_("select-none font-semibold text-text-primary",C),children:R}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsx(fD,{edit:m,isLast:h,enterEdit:g,siblingIdx:r,attachments:d,isSubmitting:_,searchResults:u,messageId:a.messageId,setSiblingIdx:i,isCreatedByUser:a.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,isLatestMessage:T===(null==y?void 0:y.messageId),content:a.content})}),h&&_?s.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):s.jsxs(sD,{classes:"text-xs",children:[s.jsx(eD,{siblingIdx:r,siblingCount:o,setSiblingIdx:i}),s.jsx($D,{index:p,isEditing:m,message:a,enterEdit:g,isSubmitting:_,conversation:b??null,regenerate:()=>N(),copyToClipboard:w,handleContinue:j,latestMessage:y,isLast:h})]})]})]})]})})}),s.jsx(ZD,{messageId:T,conversation:b,messagesTree:S??[],currentEditId:l,setCurrentEditId:c},T)]})}const QD=n.memo((({message:e,isCard:t=!1,siblingIdx:a,siblingCount:r,setSiblingIdx:o,currentEditId:i,isMultiMessage:l=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{ask:m,edit:p,index:f,agent:h,assistant:g,enterEdit:x,conversation:v,messageLabel:b,isSubmitting:_,latestMessage:y,handleContinue:j,copyToClipboard:w,setLatestMessage:N,regenerateMessage:C,handleFeedback:k}=aE({message:e,currentEditId:i,isMultiMessage:l,setCurrentEditId:c}),S=Ae(Cy.maximizeChatSpace),T=Ae(Cy.fontSize),E=n.useCallback((()=>C()),[C]),R=!(null==(u=null==e?void 0:e.children)?void 0:u.length),I=n.useMemo((()=>R&&((null==e?void 0:e.depth)===(null==y?void 0:y.depth)||-1===(null==e?void 0:e.depth))),[R,null==e?void 0:e.depth,null==y?void 0:y.depth]),P=(null==e?void 0:e.messageId)===(null==y?void 0:y.messageId),A=I&&!d&&t,M=t&&!d&&P,L=!!P&&_,O=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==v?void 0:v.endpoint),model:(null==e?void 0:e.model)??(null==v?void 0:v.model),iconURL:null==e?void 0:e.iconURL,modelLabel:b,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[b,null==v?void 0:v.endpoint,null==v?void 0:v.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),D=n.useMemo((()=>A&&!P?()=>{a_.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),a_.dir(e),N(e)}:void 0),[A,P,e,N]);if(!e)return null;const F={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:S?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},z={latestCard:M?"bg-surface-secondary":"",cardRender:A?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return s.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:s_(F.common,t?F.card:F.chat,z.latestCard,z.cardRender,z.focus,"message-render"),onClick:D,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!D||D()},role:A?"button":void 0,tabIndex:A?0:void 0,children:[M&&s.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(HD,{iconData:O,assistant:g,agent:h})})}),s.jsxs("div",{className:s_("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[s.jsx("h2",{className:s_("select-none font-semibold",T),children:b}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:s.jsxs(fS.Provider,{value:{messageId:e.messageId,conversationId:null==v?void 0:v.conversationId,isExpanded:!1,isSubmitting:L,isLatestMessage:P},children:[e.plugin&&s.jsx(nD,{plugin:e.plugin}),s.jsx(EO,{ask:m,edit:p,isLast:I,text:e.text||"",message:e,enterEdit:x,error:!!e.error,isSubmitting:L,unfinished:e.unfinished??!1,isCreatedByUser:e.isCreatedByUser??!0,siblingIdx:a??0,setSiblingIdx:o??(()=>({}))})]})}),R&&(!0===d||L)?s.jsx(hD,{isCard:t}):s.jsxs(sD,{classes:"text-xs",children:[s.jsx(eD,{siblingIdx:a,siblingCount:r,setSiblingIdx:o}),s.jsx($D,{index:f,isEditing:p,message:e,enterEdit:x,isSubmitting:_,conversation:v??null,regenerate:E,copyToClipboard:w,handleContinue:j,latestMessage:y,handleFeedback:k,isLast:I})]})]})]})]})})),YD=S.memo((({handleScroll:e,children:t})=>s.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function XD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:r,latestMultiMessage:o,isSubmittingFamily:i}=rE({message:e.message}),{message:l,currentEditId:c,setCurrentEditId:d}=e,u=Ae(Cy.maximizeChatSpace);if(!l||"object"!=typeof l)return null;const{children:m,messageId:p=null}=l;return s.jsxs(s.Fragment,{children:[s.jsx(YD,{handleScroll:a,children:t?s.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:s.jsxs("div",{className:s_("flex w-full flex-row flex-wrap justify-between gap-1 md:flex-nowrap md:gap-2",u?"w-full max-w-full":"md:max-w-5xl xl:max-w-6xl"),children:[s.jsx(QD,{...e,message:l,isSubmittingFamily:i,isCard:!0}),s.jsx(QD,{...e,isMultiMessage:!0,isCard:!0,message:r??o??void 0,isSubmittingFamily:i})]})}):s.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:s.jsx(QD,{...e})})}),s.jsx(ZD,{messageId:p,conversation:n,messagesTree:m??[],currentEditId:c,setCurrentEditId:d},p)]})}function ZD({messageId:e,messagesTree:t,currentEditId:a,setCurrentEditId:r}){const[o,i]=Ie(Cy.messagesSiblingIdxFamily(e)),l=n.useCallback((e=>{i(((null==t?void 0:t.length)??0)-e-1)}),[null==t?void 0:t.length,i]);if(n.useEffect((()=>{i(0)}),[null==t?void 0:t.length,i]),n.useEffect((()=>{(null==t?void 0:t.length)&&o>=t.length&&i(0)}),[o,null==t?void 0:t.length,i]),!t||!t.length)return null;const c=t[t.length-o-1];return c?Mu(c.endpoint)&&c.content?s.jsx(qD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):c.content?s.jsx(WD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):s.jsx(XD,{message:c,currentEditId:a,setCurrentEditId:r,siblingIdx:t.length-o-1,siblingCount:t.length,setSiblingIdx:l},c.messageId):null}function JD({messagesTree:e}){const t=Uk(),a=Ae(Cy.fontSize),{screenshotTargetRef:r}=_T(),o=Ae(Cy.showScrollButton),[i,l]=n.useState(-1),{conversation:c,scrollableRef:d,messagesEndRef:u,showScrollButton:m,handleSmoothToRef:p,debouncedHandleScroll:f}=lE(e),{conversationId:h}=c??{};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:"scrollbar-gutter-stable",onScroll:f,ref:d,style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 dark:bg-transparent",children:[e&&0==e.length||null===e?s.jsx("div",{className:s_("flex w-full items-center justify-center p-3 text-text-secondary",a),children:t("com_ui_nothing_found")}):s.jsx(s.Fragment,{children:s.jsx("div",{ref:r,children:s.jsx(ZD,{messagesTree:e,messageId:h??null,setCurrentEditId:l,currentEditId:i??null},h)})}),s.jsx("div",{id:"messages-end",className:"group h-0 w-full flex-shrink-0",ref:u})]})}),s.jsx(Fr,{in:m&&o,timeout:{enter:550,exit:700},classNames:"scroll-animation",unmountOnExit:!0,appear:!0,children:s.jsx(uD,{scrollHandler:p})})]})})})}function eF({messagesTree:e}){return s.jsx(YS,{children:s.jsx(JD,{messagesTree:e})})}const tF=n.memo((({isActive:e})=>{const t=Uk();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`fixed inset-0 z-[9998] transition-opacity duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{backgroundColor:"rgba(0, 0, 0, 0.4)",willChange:"opacity"}}),s.jsx("div",{className:`fixed inset-0 z-[9999] flex flex-col items-center justify-center gap-2 text-text-primary transition-all duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{transform:e?"scale(1)":"scale(0.95)",willChange:"opacity, transform"},children:s.jsxs("div",{className:"bg-surface-primary/95 flex flex-col items-center rounded-lg p-8 shadow-xl",children:[s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 132 108",fill:"none",width:"132",height:"108",style:{transform:e?"translateY(0)":"translateY(-10px)",transition:"transform 0.2s ease-in-out"},children:[s.jsx("g",{clipPath:"url(#clip0_3605_64419)",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.2025 29.3514C10.778 33.2165 8.51524 37.1357 11.8281 49.4995L13.4846 55.6814C16.7975 68.0453 20.7166 70.308 35.1411 66.443L43.3837 64.2344C57.8082 60.3694 60.0709 56.4502 56.758 44.0864L55.1016 37.9044C51.7887 25.5406 47.8695 23.2778 33.445 27.1428L29.3237 28.2471L25.2025 29.3514ZM18.1944 42.7244C18.8572 41.5764 20.325 41.1831 21.4729 41.8459L27.3517 45.24C28.4996 45.9027 28.8929 47.3706 28.2301 48.5185L24.836 54.3972C24.1733 55.5451 22.7054 55.9384 21.5575 55.2757C20.4096 54.613 20.0163 53.1451 20.6791 51.9972L22.8732 48.1969L19.0729 46.0028C17.925 45.3401 17.5317 43.8723 18.1944 42.7244ZM29.4091 56.3843C29.066 55.104 29.8258 53.7879 31.1062 53.4449L40.3791 50.9602C41.6594 50.6172 42.9754 51.377 43.3184 52.6573C43.6615 53.9376 42.9017 55.2536 41.6214 55.5967L32.3485 58.0813C31.0682 58.4244 29.7522 57.6646 29.4091 56.3843Z",fill:"#AFC1FF"})}),s.jsx("g",{clipPath:"url(#clip1_3605_64419)",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M86.8124 13.4036C81.0973 11.8722 78.5673 13.2649 77.0144 19.0603L68.7322 49.97C67.1793 55.7656 68.5935 58.2151 74.4696 59.7895L97.4908 65.958C103.367 67.5326 105.816 66.1184 107.406 60.1848L115.393 30.379C115.536 29.8456 115.217 29.2959 114.681 29.16C113.478 28.8544 112.435 28.6195 111.542 28.4183C106.243 27.2253 106.22 27.2201 109.449 20.7159C109.73 20.1507 109.426 19.4638 108.816 19.3004L86.8124 13.4036ZM87.2582 28.4311C86.234 28.1567 85.1812 28.7645 84.9067 29.7888C84.6323 30.813 85.2401 31.8658 86.2644 32.1403L101.101 36.1158C102.125 36.3902 103.178 35.7824 103.453 34.7581C103.727 33.7339 103.119 32.681 102.095 32.4066L87.2582 28.4311ZM82.9189 37.2074C83.1934 36.1831 84.2462 35.5753 85.2704 35.8497L100.107 39.8252C101.131 40.0996 101.739 41.1524 101.465 42.1767C101.19 43.201 100.137 43.8088 99.1132 43.5343L84.2766 39.5589C83.2523 39.2844 82.6445 38.2316 82.9189 37.2074ZM83.2826 43.2683C82.2584 42.9939 81.2056 43.6017 80.9311 44.626C80.6567 45.6502 81.2645 46.703 82.2888 46.9775L89.7071 48.9652C90.7313 49.2396 91.7841 48.6318 92.0586 47.6076C92.333 46.5833 91.7252 45.5305 90.7009 45.256L83.2826 43.2683Z",fill:"#7989FF"})}),s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M40.4004 71.8426C40.4004 57.2141 44.0575 53.5569 61.1242 53.5569H66.0004H70.8766C87.9432 53.5569 91.6004 57.2141 91.6004 71.8426V79.1569C91.6004 93.7855 87.9432 97.4426 70.8766 97.4426H61.1242C44.0575 97.4426 40.4004 93.7855 40.4004 79.1569V71.8426ZM78.8002 67.4995C78.8002 70.1504 76.6512 72.2995 74.0002 72.2995C71.3492 72.2995 69.2002 70.1504 69.2002 67.4995C69.2002 64.8485 71.3492 62.6995 74.0002 62.6995C76.6512 62.6995 78.8002 64.8485 78.8002 67.4995ZM60.7204 70.8597C60.2672 70.2553 59.5559 69.8997 58.8004 69.8997C58.045 69.8997 57.3337 70.2553 56.8804 70.8597L47.2804 83.6597C46.4851 84.72 46.7 86.2244 47.7604 87.0197C48.8208 87.8149 50.3251 87.6 51.1204 86.5397L58.8004 76.2997L66.4804 86.5397C66.8979 87.0962 67.5363 87.4443 68.2303 87.4936C68.9243 87.5429 69.6055 87.2887 70.0975 86.7967L74.8004 82.0938L79.5034 86.7967C80.4406 87.734 81.9602 87.734 82.8975 86.7967C83.8347 85.8595 83.8347 84.3399 82.8975 83.4026L76.4975 77.0026C75.5602 76.0653 74.0406 76.0653 73.1034 77.0026L68.6601 81.4459L60.7204 70.8597Z",fill:"#3C46FF"}),s.jsxs("defs",{children:[s.jsx("clipPath",{id:"clip0_3605_64419",children:s.jsx("rect",{width:"56",height:"56",fill:"white",transform:"translate(0 26.9939) rotate(-15)"})}),s.jsx("clipPath",{id:"clip1_3605_64419",children:s.jsx("rect",{width:"64",height:"64",fill:"white",transform:"translate(69.5645 0.5) rotate(15)"})})]})]}),s.jsx("h3",{className:"mt-4 text-lg font-semibold",children:t("com_ui_upload_files")}),s.jsx("h4",{className:"text-sm text-text-secondary",children:t("com_ui_drag_drop")})]})})]})}));tF.displayName="DragDropOverlay";const nF=({onOptionSelect:e,setShowModal:t,files:a,isVisible:r})=>{const o=Uk(),{agentsConfig:i}=Gk(),l=Hk((null==i?void 0:i.capabilities)??df),{conversationId:c,agentId:d}=function(){const e=n.useContext(OS);if(!e)throw new Error("useDragDropContext must be used within DragDropProvider");return e}(),u=Ae(jy(c??"")),{fileSearchAllowedByAgent:m,codeAllowedByAgent:p}=eT(d,u),f=n.useMemo((()=>{const e=[{label:o("com_ui_upload_image_input"),value:void 0,icon:s.jsx(os,{className:"icon-md"}),condition:a.every((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))}];return l.fileSearchEnabled&&m&&e.push({label:o("com_ui_upload_file_search"),value:eu.file_search,icon:s.jsx(is,{className:"icon-md"})}),l.codeEnabled&&p&&e.push({label:o("com_ui_upload_code_files"),value:eu.execute_code,icon:s.jsx(Ve,{className:"icon-md"})}),l.contextEnabled&&e.push({label:o("com_ui_upload_ocr_text"),value:eu.context,icon:s.jsx(ls,{className:"icon-md"})}),e}),[l,a,o,m,p]);return r?s.jsx(ml,{open:r,onOpenChange:t,children:s.jsx(Ud,{title:o("com_ui_upload_type"),className:"w-11/12 sm:w-[440px] md:w-[400px] lg:w-[360px]",main:s.jsx("div",{className:"flex flex-col gap-2",children:f.map(((t,n)=>!1!==t.condition&&s.jsxs("button",{onClick:()=>e(t.value),className:"flex items-center gap-2 rounded-lg p-2 hover:bg-surface-active-alt",children:[t.icon,s.jsx("span",{children:t.label})]},n)))})})}):null};function sF({children:e,className:t}){const{isOver:a,canDrop:r,drop:o,showModal:i,setShowModal:l,draggedFiles:c,handleOptionSelect:d}=function(){const e=pr(),[t,s]=n.useState(!1),[a,r]=n.useState([]),o=Ae(Cy.conversationByIndex(0))||void 0,i=Pe(jy((null==o?void 0:o.conversationId)??dh.NEW_CONVO)),l=n.useMemo((()=>Mu(null==o?void 0:o.endpoint)),[null==o?void 0:o.endpoint]),{handleFiles:c}=PT({overrideEndpoint:l?void 0:Nu.agents}),d=n.useCallback((e=>{e&&e!==eu.file_search&&i((t=>({...t,[e]:!0}))),c(a,e),s(!1),r([])}),[a,c,i]),u=n.useRef(c),m=n.useRef(o);u.current=c,m.current=o;const p=n.useCallback((t=>{var n;if(l)return void u.current(t.files);const a=e.getQueryData([ex.endpoints]),o=null==a?void 0:a[Nu.agents],i=(null==o?void 0:o.capabilities)??df,c=!0===i.includes(ef.file_search),d=!0===i.includes(ef.execute_code),p=!0===i.includes(ef.context),f=null==(n=m.current)?void 0:n.agent_id;let h=!0,g=!0;if(f&&!pv(f)){const t=e.getQueryData([ex.agent,f]);if(t){const e=t.tools;h=(null==e?void 0:e.includes(Jd.file_search))??!1,g=(null==e?void 0:e.includes(Jd.execute_code))??!1}else h=!1,g=!1}t.files.every((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))||c&&h||d&&g||p?(r(t.files),s(!0)):u.current(t.files)}),[l,e]),[{canDrop:f,isOver:h},g]=er((()=>({accept:[tr],drop:p,canDrop:()=>!0,collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})})),[p]);return{canDrop:f,isOver:h,drop:g,showModal:t,setShowModal:s,draggedFiles:a,handleOptionSelect:d}}(),u=r&&a;return s.jsxs("div",{ref:o,className:s_("relative flex h-full w-full",t),children:[e,s.jsx(tF,{isActive:u}),s.jsx(DS,{children:s.jsx(nF,{files:c,isVisible:i,setShowModal:l,onOptionSelect:d})})]})}var aF,rF=Object.freeze,oF=Object.defineProperty;const iF={"application/vnd.mermaid":"App.tsx","application/vnd.react":"App.tsx","text/html":"index.html","application/vnd.code-html":"index.html",default:"index.html"},lF={"text/html":"static","application/vnd.react":"react-ts","application/vnd.mermaid":"react-ts","application/vnd.code-html":"static",default:"static"};function cF(e,t){return`${e}${((null==t?void 0:t.length)??0)>0?`-${t}`:""}`}const dF={three:"^0.167.1","lucide-react":"^0.394.0","react-router-dom":"^6.11.2","class-variance-authority":"^0.6.0",clsx:"^1.2.1","date-fns":"^3.3.1","tailwind-merge":"^1.9.1","tailwindcss-animate":"^1.0.5",recharts:"2.12.7","@radix-ui/react-accordion":"^1.1.2","@radix-ui/react-alert-dialog":"^1.0.2","@radix-ui/react-aspect-ratio":"^1.1.0","@radix-ui/react-avatar":"^1.1.0","@radix-ui/react-checkbox":"^1.0.3","@radix-ui/react-collapsible":"^1.0.3","@radix-ui/react-dialog":"^1.0.2","@radix-ui/react-dropdown-menu":"^2.1.1","@radix-ui/react-hover-card":"^1.0.5","@radix-ui/react-label":"^2.0.0","@radix-ui/react-menubar":"^1.1.1","@radix-ui/react-navigation-menu":"^1.2.0","@radix-ui/react-popover":"^1.0.7","@radix-ui/react-progress":"^1.1.0","@radix-ui/react-radio-group":"^1.1.3","@radix-ui/react-select":"^2.0.0","@radix-ui/react-separator":"^1.0.3","@radix-ui/react-slider":"^1.1.1","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-tabs":"^1.0.3","@radix-ui/react-toast":"^1.1.5","@radix-ui/react-slot":"^1.1.0","@radix-ui/react-toggle":"^1.1.0","@radix-ui/react-toggle-group":"^1.1.0","embla-carousel-react":"^8.2.0","react-day-picker":"^9.0.8","dat.gui":"^0.7.9",vaul:"^0.9.1"},uF={"application/vnd.mermaid":Object.assign({mermaid:"^11.4.1","react-zoom-pan-pinch":"^3.6.1"},dF),"application/vnd.react":dF,"text/html":dF,"application/vnd.code-html":dF,default:dF};function mF(e){return uF[e]??dF}const pF={externalResources:["https://unpkg.com/@tailwindcss/ui/dist/tailwind-ui.min.css"]},fF={"/lib/utils.ts":eg.utils,"/components/ui/accordion.tsx":eg.accordian,"/components/ui/alert-dialog.tsx":eg.alertDialog,"/components/ui/alert.tsx":eg.alert,"/components/ui/avatar.tsx":eg.avatar,"/components/ui/badge.tsx":eg.badge,"/components/ui/breadcrumb.tsx":eg.breadcrumb,"/components/ui/button.tsx":eg.button,"/components/ui/calendar.tsx":eg.calendar,"/components/ui/card.tsx":eg.card,"/components/ui/carousel.tsx":eg.carousel,"/components/ui/checkbox.tsx":eg.checkbox,"/components/ui/collapsible.tsx":eg.collapsible,"/components/ui/dialog.tsx":eg.dialog,"/components/ui/drawer.tsx":eg.drawer,"/components/ui/dropdown-menu.tsx":eg.dropdownMenu,"/components/ui/input.tsx":eg.input,"/components/ui/label.tsx":eg.label,"/components/ui/menubar.tsx":eg.menuBar,"/components/ui/navigation-menu.tsx":eg.navigationMenu,"/components/ui/pagination.tsx":eg.pagination,"/components/ui/popover.tsx":eg.popover,"/components/ui/progress.tsx":eg.progress,"/components/ui/radio-group.tsx":eg.radioGroup,"/components/ui/select.tsx":eg.select,"/components/ui/separator.tsx":eg.separator,"/components/ui/skeleton.tsx":eg.skeleton,"/components/ui/slider.tsx":eg.slider,"/components/ui/switch.tsx":eg.switchComponent,"/components/ui/table.tsx":eg.table,"/components/ui/tabs.tsx":eg.tabs,"/components/ui/textarea.tsx":eg.textarea,"/components/ui/toast.tsx":eg.toast,"/components/ui/toaster.tsx":eg.toaster,"/components/ui/toggle-group.tsx":eg.toggleGroup,"/components/ui/toggle.tsx":eg.toggle,"/components/ui/tooltip.tsx":eg.tooltip,"/components/ui/use-toast.tsx":eg.useToast,"/public/index.html":cs(aF||(hF=['\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Document</title>\n        <script src="https://cdn.tailwindcss.com"><\/script>\n      </head>\n      <body>\n        <div id="root"></div>\n      </body>\n    </html>\n  '],aF=rF(oF(hF,"raw",{value:rF(hF.slice())}))))};var hF;const gF=cs('import React, { useEffect, useRef, useState } from "react";\nimport {\n  TransformWrapper,\n  TransformComponent,\n  ReactZoomPanPinchRef,\n} from "react-zoom-pan-pinch";\nimport mermaid from "mermaid";\nimport { ZoomIn, ZoomOut, RefreshCw } from "lucide-react";\nimport { Button } from "/components/ui/button";\n\ninterface MermaidDiagramProps {\n  content: string;\n}\n\nconst MermaidDiagram: React.FC<MermaidDiagramProps> = ({ content }) => {\n  const mermaidRef = useRef<HTMLDivElement>(null);\n  const transformRef = useRef<ReactZoomPanPinchRef>(null);\n  const [isRendered, setIsRendered] = useState(false);\n\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: false,\n      theme: "base",\n      themeVariables: {\n        background: "#282C34",\n        primaryColor: "#333842",\n        secondaryColor: "#333842",\n        tertiaryColor: "#333842",\n        primaryTextColor: "#ABB2BF",\n        secondaryTextColor: "#ABB2BF",\n        lineColor: "#636D83",\n        fontSize: "16px",\n        nodeBorder: "#636D83",\n        mainBkg: \'#282C34\',\n        altBackground: \'#282C34\',\n        textColor: \'#ABB2BF\',\n        edgeLabelBackground: \'#282C34\',\n        clusterBkg: \'#282C34\',\n        clusterBorder: "#636D83",\n        labelBoxBkgColor: "#333842",\n        labelBoxBorderColor: "#636D83",\n        labelTextColor: "#ABB2BF",\n      },\n      flowchart: {\n        curve: "basis",\n        nodeSpacing: 50,\n        rankSpacing: 50,\n        diagramPadding: 8,\n        htmlLabels: true,\n        useMaxWidth: true,\n        padding: 15,\n        wrappingWidth: 200,\n      },\n    });\n\n    const renderDiagram = async () => {\n      if (mermaidRef.current) {\n        try {\n          const { svg } = await mermaid.render("mermaid-diagram", content);\n          mermaidRef.current.innerHTML = svg;\n\n          const svgElement = mermaidRef.current.querySelector("svg");\n          if (svgElement) {\n            svgElement.style.width = "100%";\n            svgElement.style.height = "100%";\n\n            const pathElements = svgElement.querySelectorAll("path");\n            pathElements.forEach((path) => {\n              path.style.strokeWidth = "1.5px";\n            });\n\n            const rectElements = svgElement.querySelectorAll("rect");\n            rectElements.forEach((rect) => {\n              const parent = rect.parentElement;\n              if (parent && parent.classList.contains("node")) {\n                rect.style.stroke = "#636D83";\n                rect.style.strokeWidth = "1px";\n              } else {\n                rect.style.stroke = "none";\n              }\n            });\n          }\n          setIsRendered(true);\n        } catch (error) {\n          console.error("Mermaid rendering error:", error);\n          mermaidRef.current.innerHTML = "Error rendering diagram";\n        }\n      }\n    };\n\n    renderDiagram();\n  }, [content]);\n\n  const centerAndFitDiagram = () => {\n    if (transformRef.current && mermaidRef.current) {\n      const { centerView, zoomToElement } = transformRef.current;\n      zoomToElement(mermaidRef.current as HTMLElement);\n      centerView(1, 0);\n    }\n  };\n\n  useEffect(() => {\n    if (isRendered) {\n      centerAndFitDiagram();\n    }\n  }, [isRendered]);\n\n  const handlePanning = () => {\n    if (transformRef.current) {\n      const { state, instance } = transformRef.current;\n      if (!state) {\n        return;\n      }\n      const { scale, positionX, positionY } = state;\n      const { wrapperComponent, contentComponent } = instance;\n\n      if (wrapperComponent && contentComponent) {\n        const wrapperRect = wrapperComponent.getBoundingClientRect();\n        const contentRect = contentComponent.getBoundingClientRect();\n        const maxX = wrapperRect.width - contentRect.width * scale;\n        const maxY = wrapperRect.height - contentRect.height * scale;\n\n        let newX = positionX;\n        let newY = positionY;\n\n        if (newX > 0) {\n          newX = 0;\n        }\n        if (newY > 0) {\n          newY = 0;\n        }\n        if (newX < maxX) {\n          newX = maxX;\n        }\n        if (newY < maxY) {\n          newY = maxY;\n        }\n\n        if (newX !== positionX || newY !== positionY) {\n          instance.setTransformState(scale, newX, newY);\n        }\n      }\n    }\n  };\n\n  return (\n    <div className="relative h-screen w-screen cursor-move bg-[#282C34] p-5">\n      <TransformWrapper\n        ref={transformRef}\n        initialScale={1}\n        minScale={0.1}\n        maxScale={10}\n        limitToBounds={false}\n        centerOnInit={true}\n        initialPositionY={0}\n        wheel={{ step: 0.1 }}\n        panning={{ velocityDisabled: true }}\n        alignmentAnimation={{ disabled: true }}\n        onPanning={handlePanning}\n      >\n        {({ zoomIn, zoomOut }) => (\n          <>\n            <TransformComponent\n              wrapperStyle={{\n                width: "100%",\n                height: "100%",\n                overflow: "hidden",\n              }}\n            >\n              <div\n                ref={mermaidRef}\n                style={{\n                  width: "auto",\n                  height: "auto",\n                  minWidth: "100%",\n                  minHeight: "100%",\n                }}\n              />\n            </TransformComponent>\n            <div className="absolute bottom-2 right-2 flex space-x-2">\n              <Button onClick={() => zoomIn(0.1)} variant="outline" size="icon">\n                <ZoomIn className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={() => zoomOut(0.1)}\n                variant="outline"\n                size="icon"\n              >\n                <ZoomOut className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={centerAndFitDiagram}\n                variant="outline"\n                size="icon"\n              >\n                <RefreshCw className="h-4 w-4" />\n              </Button>\n            </div>\n          </>\n        )}\n      </TransformWrapper>\n    </div>\n  );\n};\n\nexport default MermaidDiagram;'),xF=e=>cs(`import React from 'react';\nimport MermaidDiagram from '/components/ui/MermaidDiagram';\n\nexport default App = () => (\n  <MermaidDiagram content={\`${e}\`} />\n);\n`),vF=e=>({"App.tsx":xF(e),"index.tsx":cs('import React, { StrictMode } from "react";\nimport { createRoot } from "react-dom/client";\nimport "./styles.css";\n\nimport App from "./App";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n;'),"/components/ui/MermaidDiagram.tsx":gF});function bF({artifact:e}){const[t,s]=n.useMemo((()=>{if(cF(e.type??"",e.language).includes("mermaid"))return["App.tsx",vF(e.content??"")];const t=function(e,t){const n=cF(e,t);return iF[n]??iF.default}(e.type??"",e.language);return[t,xm({[t]:e.content})]}),[e.type,e.content,e.language]);return{files:s,fileKey:t,template:n.useMemo((()=>function(e,t){const n=cF(e,t);return lF[n]??lF.default}(e.type??"",e.language)),[e.type,e.language]),sharedProps:n.useMemo((()=>({customSetup:{dependencies:mF(e.type??"")}})),[e.type])}}const _F=({artifact:e,className:t=""})=>{const a=Uk(),{currentCode:r}=cS(),[o,i]=n.useState(!1),{fileKey:l}=bF({artifact:e});return s.jsx("button",{className:`mr-2 text-text-secondary ${t}`,onClick:()=>{try{const t=r??e.content??"";if(!t)return;const n=new Blob([t],{type:"text/plain"}),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=l,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),i(!0),setTimeout((()=>i(!1)),3e3)}catch(t){console.error("Download failed:",t)}},"aria-label":a("com_ui_download_artifact"),children:o?s.jsx(ic,{className:"h-4 w-4"}):s.jsx(On,{className:"h-4 w-4"})})},yF=({ref:e,content:t,isSubmitting:s})=>{const[a,r]=n.useState(!1);return n.useEffect((()=>{const t=e.current;if(!t)return;const n=()=>{const{scrollTop:e,scrollHeight:n,clientHeight:s}=t;r(!(n-e-s<50))};return t.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",n)}}),[e]),n.useEffect((()=>{const t=e.current;t&&s&&!a&&(t.scrollTop=t.scrollHeight)}),[t,s,a,e]),{userScrolled:a}},jF=({fileKey:e,readOnly:t,artifact:a,editorRef:r})=>{const{sandpack:o}=ri(),[i,l]=n.useState(null),{isMutating:c,setIsMutating:d,setCurrentCode:u}=cS(),m=(e=>{const t=pr(),{onSuccess:n,...s}=e??{};return fr({mutationFn:e=>fx.editArtifact(e),onSuccess:(e,s,a)=>{let r=!0;const o=n=>{n&&t.setQueryData([ex.messages,n],(t=>{if(!t)return t;const n=[...t];let a;for(let e=n.length-1;e>=0;e--)if(n[e].messageId===s.messageId){a=e,r=!1;break}return null==a?t:(n[a]={...n[a],content:e.content,text:e.text},n)}))};o(e.conversationId),r&&(console.warn("Edited Artifact Message not found in cache, trying `new` as `conversationId`"),o(dh.NEW_CONVO)),null==n||n(e,s,a)},...s})})({onMutate:e=>{d(!0),l(e.updated)},onSuccess:()=>{d(!1),l(null)},onError:()=>{d(!1)}}),p=n.useCallback((e=>{m.mutate(e)}),[m]),f=n.useMemo((()=>ko(p,500)),[p]);return n.useEffect((()=>{var n;if(t)return;if(c)return;if(null==a.index)return;const s=null==(n=o.files["/"+e])?void 0:n.code,r=s&&null!=a.content&&s.trim()!==a.content.trim(),l=null==i||null!=s&&s.trim()!==i.trim();return a.content&&r&&l&&(u(s),f({index:a.index,messageId:a.messageId??"",original:a.content,updated:s})),()=>{f.cancel()}}),[e,a.index,a.content,a.messageId,t,c,i,d,o.files,u,f]),s.jsx(oi,{ref:r,showTabs:!1,showRunButton:!1,showLineNumbers:!0,showInlineErrors:!0,readOnly:!0===t,className:"hljs language-javascript bg-black"})},wF=function({files:e,fileKey:t,template:a,artifact:r,editorRef:o,sharedProps:i}){const{data:l}=Wy(),{isSubmitting:c}=BS(),d=n.useMemo((()=>l?{...pF,bundlerURL:"static"===a?l.staticBundlerURL:l.bundlerURL}:pF),[l,a]),[u,m]=n.useState(c??!1);return n.useEffect((()=>{m(c??!1)}),[c]),0===Object.keys(e).length?null:s.jsx(ai,{theme:"dark",files:{...e,...fF},options:d,...i,template:a,children:s.jsx(jF,{fileKey:t,artifact:r,editorRef:o,readOnly:u})})},NF=n.memo((function({files:e,fileKey:t,template:a,isMermaid:r,sharedProps:o,previewRef:i,currentCode:l,startupConfig:c}){const d=n.useMemo((()=>{if(0===Object.keys(e).length)return e;const n=l??"";return n?{...e,[t]:{code:n}}:e}),[l,e,t]),u=n.useMemo((()=>{if(!c)return pF;return{...pF,bundlerURL:"static"===a?c.staticBundlerURL:c.bundlerURL}}),[c,a]),m=n.useMemo((()=>{if(r)return{backgroundColor:"#282C34"}}),[r]);return 0===Object.keys(d).length?null:s.jsx(ii,{files:{...d,...fF},options:u,...o,template:a,children:s.jsx(li,{showOpenInCodeSandbox:!1,showRefreshButton:!1,tabIndex:0,ref:i,style:m})})})),CF=n.memo((({inline:e,className:t,children:n})=>{const a=/language-(\w+)/.exec(t??""),r=a&&a[1];return e?s.jsx("code",{onDoubleClick:x_,className:t,children:n}):s.jsx("code",{className:`hljs language-${r} !whitespace-pre`,children:n})})),kF=n.memo((({content:e="",isSubmitting:t})=>{const a=n.useRef(null),[r,o]=n.useState(!1),i=e,l=[[ti],[Zo,{detect:!0,ignoreMissing:!0,subset:wb}]];return n.useEffect((()=>{const e=a.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;o(!(n-t-s<50))};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}}),[]),n.useEffect((()=>{const e=a.current;e&&t&&!r&&(e.scrollTop=e.scrollHeight)}),[e,t,r]),s.jsx("div",{ref:a,className:"max-h-full overflow-y-auto",children:s.jsx(Xo,{rehypePlugins:l,components:{code:CF},children:i})})})),SF=({content:e})=>{const t=Uk(),[a,r]=n.useState(!1);return s.jsx("button",{className:"mr-2 text-text-secondary",onClick:()=>{ot(e,{format:"text/plain"}),r(!0),setTimeout((()=>r(!1)),3e3)},"aria-label":t(a?"com_ui_copied":"com_ui_copy_code"),children:a?s.jsx(ic,{className:"h-[18px] w-[18px]"}):s.jsx(oc,{})})};function TF({content:e,isSubmitting:t}){return s.jsx(kF,{content:`\`\`\`mermaid\n${e}\`\`\``,isSubmitting:t})}function EF({artifact:e,isMermaid:t,editorRef:a,previewRef:r}){const{isSubmitting:o}=BS(),{currentCode:i,setCurrentCode:l}=cS(),{data:c}=Wy(),d=n.useRef(null);n.useEffect((()=>{e.id!==d.current&&l(void 0),d.current=e.id}),[l,e.id]);const u=e.content??"",m=n.useRef(null);yF({ref:m,content:u,isSubmitting:o});const{files:p,fileKey:f,template:h,sharedProps:g}=bF({artifact:e});return s.jsxs(s.Fragment,{children:[s.jsx(Na,{ref:m,value:"code",id:"artifacts-code",className:s_("flex-grow overflow-auto"),children:t?s.jsx(TF,{content:u,isSubmitting:o}):s.jsx(wF,{files:p,fileKey:f,template:h,artifact:e,editorRef:a,sharedProps:g})}),s.jsx(Na,{value:"preview",className:"flex-grow overflow-auto",children:s.jsx(NF,{files:p,fileKey:f,template:h,isMermaid:t,previewRef:r,sharedProps:g,currentCode:i,startupConfig:c})})]})}function RF(){const e=Uk(),{isMutating:t}=cS(),a=n.useRef(),r=n.useRef(),[o,i]=n.useState(!1),[l,c]=n.useState(!1),d=Pe(Cy.artifactsVisibility);n.useEffect((()=>{i(!0)}),[]);const{activeTab:u,isMermaid:m,setActiveTab:p,currentIndex:f,cycleArtifact:h,currentArtifact:g,orderedArtifactIds:x}=function(){const[e,t]=n.useState("preview"),{isSubmitting:s,latestMessageId:a,latestMessageText:r,conversationId:o}=BS(),i=Ae(Cy.artifactsState),l=Oe(Cy.artifactsState),c=Oe(Cy.currentArtifactId),[d,u]=Ie(Cy.currentArtifactId),m=n.useMemo((()=>Object.keys(i??{}).sort(((e,t)=>{var n,s;return((null==(n=null==i?void 0:i[e])?void 0:n.lastUpdateTime)??0)-((null==(s=null==i?void 0:i[t])?void 0:s.lastUpdateTime)??0)}))),[i]),p=n.useRef(null),f=n.useRef(!1),h=n.useRef(!1),g=n.useRef(null),x=n.useRef(null);n.useEffect((()=>{const e=()=>{l(),c(),x.current=o,g.current=null,p.current=null,f.current=!1};return(o!==x.current&&null!=x.current||o===dh.NEW_CONVO)&&e(),x.current=o,()=>{a_.log("artifacts_visibility","Unmounting artifacts"),e()}}),[o,l,c]),n.useEffect((()=>{if(m.length>0){const e=m[m.length-1];u(e)}}),[u,m]),n.useEffect((()=>{var e;if(!s)return;if(0===m.length)return;if(null==a)return;const n=m[m.length-1],o=null==i?void 0:i[n];if((null==o?void 0:o.content)!==p.current)if(u(n),p.current=(null==o?void 0:o.content)??null,/:::artifact(?:\{[^}]*\})?(?:\s|\n)*(?:```[\s\S]*?```(?:\s|\n)*)?:::/m.test(r.trim())&&!f.current)t("preview"),f.current=!0,h.current=!1;else if(!f.current&&!h.current){const n=(null==(e=null==o?void 0:o.content)?void 0:e.slice(0,50))??"";n.length>0&&r.includes(n)&&(t("code"),h.current=!0)}}),[i,s,a,r,m,u]),n.useEffect((()=>{a!==g.current&&(g.current=a,f.current=!1,h.current=!1)}),[a]);const v=null!=d?null==i?void 0:i[d]:null,b=m.indexOf(d??"");return{activeTab:e,isMermaid:n.useMemo((()=>null!=(null==v?void 0:v.type)&&cF(v.type,v.language).includes("mermaid")),[null==v?void 0:v.type,null==v?void 0:v.language]),setActiveTab:t,currentIndex:b,cycleArtifact:e=>{let t;t="next"===e?(b+1)%m.length:(b-1+m.length)%m.length,u(m[t])},currentArtifact:v,orderedArtifactIds:m}}();if(null==g)return null;const v=()=>{i(!1),setTimeout((()=>d(!1)),300)};return s.jsx(Qa,{value:u,onValueChange:p,asChild:!0,children:s.jsx("div",{className:"flex h-full w-full items-center justify-center",children:s.jsxs("div",{className:s_("flex h-full w-full flex-col overflow-hidden border border-border-medium bg-surface-primary text-xl text-text-primary shadow-xl transition-all duration-500 ease-in-out",o?"scale-100 opacity-100 blur-0":"scale-105 opacity-0 blur-sm"),children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-border-medium bg-surface-primary-alt p-2",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{className:"mr-2 text-text-secondary",onClick:v,children:s.jsx(Rn,{className:"h-4 w-4"})}),s.jsx("h3",{className:"truncate text-sm text-text-primary",children:g.title})]}),s.jsxs("div",{className:"flex items-center",children:["preview"===u&&s.jsx("button",{className:s_("mr-2 text-text-secondary transition-transform duration-500 ease-in-out",l?"rotate-180":""),onClick:()=>{var e;c(!0);const t=null==(e=r.current)?void 0:e.getClient();null!=t&&t.dispatch({type:"refresh"}),setTimeout((()=>c(!1)),750)},disabled:l,"aria-label":"Refresh",children:s.jsx(Ft,{size:16,className:s_("transform",l?"animate-spin":"")})}),"preview"!==u&&t&&s.jsx(Ft,{size:16,className:"mr-2 animate-spin text-text-secondary"}),s.jsxs(ja,{className:"mr-2 inline-flex h-7 rounded-full border border-border-medium bg-surface-tertiary",children:[s.jsx(wa,{value:"preview",disabled:t,className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_preview")}),s.jsx(wa,{value:"code",className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_code")})]}),s.jsx("button",{className:"text-text-secondary",onClick:v,children:s.jsx(vt,{className:"h-4 w-4"})})]})]}),s.jsx(EF,{isMermaid:m,artifact:g,editorRef:a,previewRef:r}),s.jsxs("div",{className:"flex items-center justify-between border-t border-border-medium bg-surface-primary-alt p-2 text-sm text-text-secondary",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("button",{onClick:()=>h("prev"),className:"mr-2 text-text-secondary",children:s.jsx(pt,{className:"h-4 w-4"})}),s.jsx("span",{className:"text-xs",children:`${f+1} / ${x.length}`}),s.jsx("button",{onClick:()=>h("next"),className:"ml-2 text-text-secondary",children:s.jsx(Vn,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(SF,{content:g.content??""}),s.jsx(_F,{artifact:g})]})]})]})})})}function IF({children:e}){const t=Ae(Cy.artifactsState),a=Ae(Cy.artifactsVisibility),r=tT(),{mutateAsync:o}=qy({onSuccess:()=>{console.log("Temporary Files deleted"),r({})},onError:e=>{console.log("Error deleting temporary files:",e)}});n.useEffect((()=>{const e=localStorage.getItem(uh.FILES_TO_DELETE),t=JSON.parse(e??"{}"),n=Object.values(t).filter((e=>null!=e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,filepath:e.filepath,source:e.source,embedded:!!e.embedded})));0!==n.length&&o({files:n})}),[o]);const i=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),l=n.useMemo((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),c=n.useMemo((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]);return s.jsx(sF,{className:"relative flex w-full grow overflow-hidden bg-presentation",children:s.jsx(LS,{children:s.jsx(pL,{defaultLayout:i,fullPanelCollapse:c,defaultCollapsed:l,artifacts:!0===a&&Object.keys(t??{}).length>0?s.jsx(VS,{children:s.jsx(lS,{children:s.jsx(RF,{})})}):null,children:s.jsx("main",{className:"flex h-full flex-col overflow-y-auto",role:"main",children:e})})})})}const PF=S.memo((({agentId:e,disabled:t,conversationId:a,endpointFileConfig:r})=>{const o=Uk(),i=t??!1,l=n.useRef(null),[c,d]=n.useState(!1),[u,m]=Ie(jy(a)),[p,f]=n.useState(),{handleFileChange:h}=PT({overrideEndpoint:Nu.agents,overrideEndpointFileConfig:r}),{handleSharePointFiles:g,isProcessing:x,downloadProgress:v}=MT({overrideEndpoint:Nu.agents,overrideEndpointFileConfig:r,toolResource:p}),{data:b}=Wy(),_=null==b?void 0:b.sharePointFilePickerEnabled,[y,j]=n.useState(!1),{agentsConfig:w}=Gk(),N=Hk((null==w?void 0:w.capabilities)??df),{fileSearchAllowedByAgent:C,codeAllowedByAgent:k}=eT(e,u),S=e=>{l.current&&(l.current.value="",l.current.accept=!0===e?"image/*":"",l.current.click(),l.current.accept="")},T=n.useMemo((()=>{const e=e=>{const t=[{label:o("com_ui_upload_image_input"),onClick:()=>{f(void 0),e(!0)},icon:s.jsx(os,{className:"icon-md"})}];return N.contextEnabled&&t.push({label:o("com_ui_upload_ocr_text"),onClick:()=>{f(eu.context),e()},icon:s.jsx(ls,{className:"icon-md"})}),N.fileSearchEnabled&&C&&t.push({label:o("com_ui_upload_file_search"),onClick:()=>{f(eu.file_search),m((e=>({...e,[eu.file_search]:!0}))),e()},icon:s.jsx(is,{className:"icon-md"})}),N.codeEnabled&&k&&t.push({label:o("com_ui_upload_code_files"),onClick:()=>{f(eu.execute_code),m((e=>({...e,[eu.execute_code]:!0}))),e()},icon:s.jsx(Ve,{className:"icon-md"})}),t},t=e(S);if(_){const n=e((()=>{j(!0)}));return t.push({label:o("com_files_upload_sharepoint"),onClick:()=>{},icon:s.jsx(nd,{className:"icon-md"}),subItems:n}),t}return t}),[N,o,f,m,_,k,C,j]),E=s.jsx(Dl,{render:s.jsx(ie,{disabled:i,id:"attach-file-menu-button","aria-label":"Attach File Options",className:s_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(uc,{})})}),id:"attach-file-menu-button",description:o("com_sidepanel_attach_files"),disabled:i});return s.jsxs(s.Fragment,{children:[s.jsx(yd,{ref:l,handleFileChange:e=>{h(e,p)},children:s.jsx(Nd,{menuId:"attach-file-menu",className:"overflow-visible",isOpen:c,setIsOpen:d,modal:!0,unmountOnHide:!0,trigger:E,items:T,iconClassName:"mr-0"})}),s.jsx(QR,{isOpen:y,onOpenChange:j,onFilesSelected:async e=>{try{await g(e),j(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:x,downloadProgress:v,maxSelectionCount:null==r?void 0:r.fileLimit})]})})),AF=S.memo((({disabled:e})=>{const t=Uk(),a=n.useRef(null),r=e??!1,{handleFileChange:o}=PT();return s.jsx(yd,{ref:a,handleFileChange:o,children:s.jsx(Dl,{description:t("com_sidepanel_attach_files"),id:"attach-file",disabled:r,render:s.jsx("button",{type:"button","aria-label":t("com_sidepanel_attach_files"),disabled:r,className:s_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),onKeyDownCapture:e=>{a.current&&("Enter"!==e.key&&" "!==e.key||(a.current.value="",a.current.click()))},onClick:()=>{a.current&&(a.current.value="",a.current.click())},children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(uc,{})})})})})}));const MF=n.memo((function({disableInputs:e,conversation:t}){const a=(null==t?void 0:t.conversationId)??dh.NEW_CONVO,{endpoint:r,endpointType:o}=t??{endpoint:null},i=n.useMemo((()=>Lu(r)),[r]),l=n.useMemo((()=>Mu(r)),[r]),{data:c=Gm}=Xy({select:e=>Ym(e)}),d=c.endpoints[r??""],u=Rm[o??r??""]??!1,m=(e||(null==d?void 0:d.disabled))??!1;return l&&u&&!m?s.jsx(AF,{disabled:e}):i||u&&!m?s.jsx(PF,{disabled:e,conversationId:a,agentId:null==t?void 0:t.agent_id,endpointFileConfig:d}):null}));const LF=n.memo((function({conversation:e}){const{files:t,setFiles:n,setFilesLoading:a}=Mk(),r=Ae(Cy.chatDirection).toLowerCase(),{endpoint:o}=e??{endpoint:null},{abortUpload:i}=PT(),l="rtl"===r;return s.jsx(s.Fragment,{children:s.jsx(SI,{files:t,setFiles:n,abortUpload:i,setFilesLoading:a,isRTL:l,Wrapper:({children:e})=>s.jsx("div",{className:"mx-2 mt-2 flex flex-wrap gap-2",children:e})})})}));function OF({addedConvo:e,setAddedConvo:t}){const a=nT(),{data:r}=Ky(),o=n.useMemo((()=>`+ ${a(e)}: ${ub(e)}`),[e,a]);return e?s.jsxs("div",{className:"flex items-start gap-4 py-2.5 pl-3 pr-1.5 text-sm",children:[s.jsx("span",{className:"mt-0 flex h-6 w-6 flex-shrink-0 items-center justify-center",children:s.jsx("div",{className:"icon-md",children:s.jsx(eI,{conversation:e,endpointsConfig:r,containerClassName:"shadow-stroke overflow-hidden rounded-full",context:"menu-item",size:20})})}),s.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:o}),s.jsx("button",{className:"text-token-text-secondary flex-shrink-0",type:"button","aria-label":"Close added conversation",onClick:()=>t(null),children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",className:"icon-lg","aria-hidden":"true",children:s.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.293 7.293a1 1 0 0 1 1.414 0L12 10.586l3.293-3.293a1 1 0 1 1 1.414 1.414L13.414 12l3.293 3.293a1 1 0 0 1-1.414 1.414L12 13.414l-3.293 3.293a1 1 0 0 1-1.414-1.414L10.586 12 7.293 8.707a1 1 0 0 1 0-1.414",clipRule:"evenodd"})})})]}):null}function DF({addedConvo:e,setAddedConvo:t}){return e?s.jsx("div",{className:"m-1.5 flex flex-col divide-y overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:s.jsx(OF,{addedConvo:e,setAddedConvo:t})}):null}function FF({name:e,onClick:t,index:n,icon:a,isActive:r,description:o,style:i,type:l="mention"}){return s.jsx("button",{tabIndex:n,onClick:t,id:`${l}-item-${n}`,className:"w-full",style:i,children:s.jsxs("div",{className:s_("text-token-text-primary bg-token-main-surface-secondary group flex h-10 items-center gap-2 rounded-lg px-2 text-sm font-medium hover:bg-surface-secondary",!0===r?"bg-surface-active":"bg-transparent"),children:[s.jsx("div",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center",children:a}),s.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[s.jsxs("div",{className:"truncate",children:[s.jsx("span",{className:"font-medium",children:e}),null!=o&&o?s.jsx("span",{className:"text-token-text-tertiary ml-2 text-sm font-light",children:o}):null]}),s.jsx(ds,{size:16,className:"ml-2 flex-shrink-0"})]})]})})}const zF=n.memo((({index:e,children:t,isVariableDialogOpen:n,variableGroup:a,setVariableDialogOpen:r})=>{const o=Ae(Cy.showPromptsPopoverFamily(e));return s.jsxs(s.Fragment,{children:[o?t:null,s.jsx(zM,{open:n,onClose:()=>r(!1),group:a})]})}));const UF=n.memo((function({index:e,textAreaRef:t,submitPrompt:a}){const r=Uk(),{allPromptGroups:o,hasAccess:i}=qS(),{data:l,isLoading:c}=o,[d,u]=n.useState(0),m=n.useRef(null),p=n.useRef(null),[f,h]=n.useState(!1),[g,x]=n.useState(null),v=Pe(Cy.showPromptsPopoverFamily(e)),b=n.useMemo((()=>null==l?void 0:l.promptGroups),[l]),_=n.useMemo((()=>null==l?void 0:l.promptsMap),[l]),{open:y,setOpen:j,searchValue:w,setSearchValue:N,matches:C}=Gi({value:"",options:b??[]}),k=n.useCallback(((e,n)=>{var s,r;if(!e)return;N(""),j(!1),v(!1),t.current&&xb(t.current,"/");const o=null==_?void 0:_[e.id];if(!o)return;if(pb((null==(s=o.productionPrompt)?void 0:s.prompt)??""))return n&&"Tab"===n.key&&n.preventDefault(),x(o),void h(!0);a((null==(r=o.productionPrompt)?void 0:r.prompt)??"")}),[N,j,v,t,_,a]);if(n.useEffect((()=>{y?x(null):u(0)}),[y]),n.useEffect((()=>()=>{m.current&&clearTimeout(m.current)}),[]),n.useEffect((()=>{const e=document.getElementById(`prompt-item-${d}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[d]),!i)return null;const S=({index:e,key:t,style:n})=>{const a=C[e];return s.jsx(FF,{index:e,type:"prompt",style:n,onClick:()=>{m.current&&clearTimeout(m.current),m.current=null,k(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===d},t)};return s.jsx(zF,{index:e,isVariableDialogOpen:f,variableGroup:g,setVariableDialogOpen:h,children:s.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:s.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-surface-tertiary-alt p-2 shadow-lg",children:[s.jsx("input",{autoFocus:!0,ref:p,placeholder:r("com_ui_command_usage_placeholder"),className:"mb-1 w-full border-0 bg-surface-tertiary-alt p-2 text-sm focus:outline-none dark:text-gray-200",autoComplete:"off",value:w,onKeyDown:e=>{var n,s;"Escape"===e.key&&(j(!1),v(!1),null==(n=t.current)||n.focus()),"ArrowDown"===e.key?u((e=>(e+1)%C.length)):"ArrowUp"===e.key?u((e=>(e-1+C.length)%C.length)):"Enter"===e.key||"Tab"===e.key?("Enter"===e.key&&e.preventDefault(),k(C[d],e)):"Backspace"===e.key&&""===w&&(j(!1),v(!1),null==(s=t.current)||s.focus())},onChange:e=>N(e.target.value),onFocus:()=>j(!0),onBlur:()=>{m.current=setTimeout((()=>{j(!1),v(!1)}),150)}}),s.jsx("div",{className:"max-h-40 overflow-y-auto",children:c&&y?s.jsx("div",{className:"flex h-32 items-center justify-center text-text-primary",children:s.jsx(rc,{})}):!c&&y?s.jsx("div",{className:"max-h-40",children:s.jsx($r,{disableHeight:!0,children:({width:e})=>s.jsx(Hr,{width:e,overscanRowCount:5,rowHeight:40,rowCount:C.length,rowRenderer:S,scrollToIndex:d,height:Math.min(40*C.length,160)})})}):null})]})})})})),VF=e=>"external"===e;function BF({disabled:e,ask:t,methods:a,textAreaRef:r,isSubmitting:o}){const{setValue:i,reset:l,getValues:c}=a,d=Uk(),{showToast:u}=$d(),{speechToTextEndpoint:m}=VT(),p=n.useRef(""),f=n.useCallback((e=>{if(o)u({message:d("com_ui_speech_while_submitting"),status:"error"});else if(e){const n=document.getElementById(xv);n&&(console.log("Unmuting global audio"),n.muted=!1);const s=VF(m)&&p.current?`${p.current} ${e}`:e;t({text:s}),l({text:""}),p.current=""}}),[t,l,u,d,o,m]),h=n.useCallback((e=>{let t=e;t=(VF(m),p.current?`${p.current} ${e}`:e),i("text",t,{shouldValidate:!0})}),[i,m]),{isListening:g,isLoading:x,startRecording:v,stopRecording:b}=$T(h,f);if(!r.current)return null;return s.jsx(Dl,{description:d("com_ui_use_micrphone"),render:s.jsx("button",{id:"audio-recorder",type:"button","aria-label":d("com_ui_use_micrphone"),onClick:!0===g?async()=>{b(),VF(m)||(p.current="")}:async()=>{p.current=c("text")||"",v()},disabled:e,className:s_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover"),title:d("com_ui_use_micrphone"),"aria-pressed":g,children:!0===g?s.jsx(Lc,{className:"stroke-red-500"}):!0===x?s.jsx(rc,{className:"stroke-text-secondary"}):s.jsx(Lc,{className:"stroke-text-secondary"})})})}const $F=({isScrollable:e,isCollapsed:t,setIsCollapsed:n})=>{const a=Uk();if(!e)return null;const r=a(t?"com_ui_expand_chat":"com_ui_collapse_chat");return s.jsx("div",{className:"relative ml-auto items-end justify-end",children:s.jsx(Dl,{description:r,render:s.jsx("button",{"aria-label":r,onClick:e=>{e.preventDefault(),e.stopPropagation(),n((e=>!e))},className:s_("z-10 size-5 rounded-full transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-opacity-50"),children:t?s.jsx(mn,{className:"h-full w-full"}):s.jsx(Pt,{className:"h-full w-full"})})})})};function HF(e,t){return new Promise(((n,s)=>setTimeout((()=>s(new Error(t))),e)))}const GF="Reader promise timed out";function KF({index:e=0}){const{token:t}=qk(),a=Ae(Cy.cacheTTS),r=Ae(Cy.playbackRate),o=Ae(Cy.voice),i=Ae(Cy.activeRunFamily(e)),l=Ae(Cy.automaticPlayback),c=Ae(Cy.isSubmittingFamily(e)),d=Ae(Cy.latestMessageFamily(e)),u=Pe(Cy.globalAudioPlayingFamily(e)),[m,p]=Ie(Cy.audioRunFamily(e)),[f,h]=Ie(Cy.globalAudioFetchingFamily(e)),[g,x]=Ie(Cy.globalAudioURLFamily(e)),{audioRef:v}=function({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect((()=>{let n=null,s=0;const a=()=>{e(!1),console.log("global audio ended"),t.current&&(t.current.customEnded=!0,URL.revokeObjectURL(t.current.src))},r=()=>{e(!0),console.log("global audio started"),t.current&&(t.current.customStarted=!0)},o=()=>{console.log("global audio paused"),t.current&&(t.current.customPaused=!0)},i=()=>{if(t.current){const e=t.current.currentTime;e===n?s+=1:s=0,n=e,s>=1&&(console.log("Detected end of audio based on time update"),t.current.pause(),a())}},l=t.current;return t.current&&(t.current.addEventListener("ended",a),t.current.addEventListener("play",r),t.current.addEventListener("pause",o),t.current.addEventListener("timeupdate",i),t.current.customProps={customStarted:!1,customEnded:!1,customPaused:!1}),()=>{l&&(l.removeEventListener("ended",a),l.removeEventListener("play",r),l.removeEventListener("pause",o),l.removeEventListener("timeupdate",i),URL.revokeObjectURL(l.src))}}),[e]),{audioRef:t}}({setIsPlaying:u}),{pauseGlobalAudio:b}=ky(),{conversationId:_}=nt(),y="new"===_?_:(null==d?void 0:d.conversationId)??_??"",j=pr(),w=n.useCallback((()=>j.getQueryData([ex.messages,y])),[y,j]);return n.useEffect((()=>{const e=bb(d);!(null==t||!l||c||!d||d.isCreatedByUser||!e||!d.messageId||d.messageId.includes("_")||f||null==i||i===m)&&async function(){h(!0);try{v.current&&(v.current.pause(),URL.revokeObjectURL(v.current.src),x(null));let e=(null==d?void 0:d.text)??"";const n=await caches.open("tts-responses"),s=await n.match(e);if(p(i),s){a_.log("Audio found in cache");const e=await s.blob(),t=URL.createObjectURL(e);return x(t),void h(!1)}a_.log("Fetching audio...",navigator.userAgent);const r=await fetch("/api/files/speech/tts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({messageId:null==d?void 0:d.messageId,runId:i,voice:o})});if(!r.ok)throw new Error("Failed to fetch audio");if(!r.body)throw new Error("Null Response body");const l=r.body.getReader(),c="audio/mpeg",u="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(c);let m;u&&(m=new Gd(c),x(m.mediaSourceUrl));let f=!1;const g=[];for(;!f;){const e=l.read(),{value:t,done:n}=await Promise.race([e,HF(15e3,GF)]);a&&t&&g.push(t),t&&m&&m.addData(t),f=n}if(g.length){a_.log("Adding audio to cache");const t=(w()??[]).find((e=>e.messageId===(null==d?void 0:d.messageId)));if(e=(null==t?void 0:t.text)??"",!e)throw new Error("Cache key not found");const s=new Blob(g,{type:c}),a=new Response(s);if(await n.put(e,a),!u){const t=await n.match(e);if(!t)throw new Error("Failed to fetch audio from cache");const s=await t.blob(),a=URL.createObjectURL(s);x(a)}h(!1)}a_.log("Audio stream reading ended")}catch(e){if((null==e?void 0:e.message)!==GF)return void a_.log(GF);a_.error("Error fetching audio:",e),h(!1),x(null)}finally{h(!1)}}()}),[l,x,p,h,d,c,i,w,f,m,a,v,o,t]),n.useEffect((()=>{null!=r&&null!=g&&r>0&&v.current&&v.current.playbackRate!==r&&(v.current.playbackRate=r)}),[v,g,r]),n.useEffect((()=>{b()}),[_]),a_.log("StreamAudio.tsx - globalAudioURL:",g),s.jsx("audio",{ref:v,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:g??void 0,id:xv,autoPlay:!0})}function WF({stop:e,setShowStopButton:t}){const n=Uk();return s.jsx(Dl,{description:n("com_nav_stop_generating"),render:s.jsx("button",{type:"button",className:s_("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"aria-label":n("com_nav_stop_generating"),onClick:n=>{t(!1),e(n)},children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-lg text-surface-primary",children:s.jsx("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1.25",fill:"currentColor"})})})})}const qF=S.memo(n.forwardRef(((e,t)=>{const n=Uk();return s.jsx(Dl,{description:n("com_nav_send_message"),render:s.jsx("button",{ref:t,"aria-label":n("com_nav_send_message"),id:"send-button",disabled:e.disabled,className:s_("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"data-testid":"send-button",type:"submit",children:s.jsx("span",{className:"","data-state":"closed",children:s.jsx(wc,{size:24})})})})}))),QF=S.memo(n.forwardRef(((e,t)=>{const n=Ho({control:e.control});return s.jsx(qF,{ref:t,disabled:e.disabled||!n.text})}))),YF=S.memo((({isEditingChatBadges:e,handleCancelBadges:t,handleSaveBadges:a,setBadges:r})=>{const o=Uk(),i=(iT()||[]).filter((e=>!e.isAvailable)),l=n.useCallback((e=>{r((t=>[...t,{id:e}]))}),[r]);return e?s.jsxs("div",{className:"m-1.5 flex flex-col overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:[s.jsxs("div",{className:"flex items-center gap-4 py-2 pl-3 pr-1.5 text-sm",children:[s.jsx("span",{className:"mt-0 flex size-6 flex-shrink-0 items-center justify-center",children:s.jsx("div",{className:"icon-md",children:s.jsx(Qe,{className:"icon-md","aria-hidden":"true"})})}),s.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:o("com_ui_save_badge_changes")}),s.jsxs("div",{className:"flex h-8 gap-2",children:[s.jsx(Si,{size:"sm",variant:"destructive","aria-label":"Cancel",onClick:t,className:"h-8",children:s.jsx(vt,{className:"icon-md","aria-hidden":"true"})}),s.jsx(Si,{size:"sm",variant:"submit","aria-label":"Save changes",onClick:a,className:"h-8 rounded-b-lg rounded-tr-xl",children:s.jsx(es,{className:"icon-md","aria-hidden":"true"})})]})]}),i&&i.length>0&&s.jsx("div",{className:"flex flex-wrap items-center gap-2 p-2",children:i.map((e=>s.jsx("div",{className:"badge-icon",children:s.jsx(Xl,{icon:e.icon,label:e.label,isAvailable:!1,isEditing:!0,onBadgeAction:()=>l(e.id)})},e.id)))})]}):null}));const XF=n.memo((function(){const e=Uk(),{codeInterpreter:t,codeApiKeyForm:n}=PS(),{toggleState:a,debouncedChange:r,isPinned:o}=t,{badgeTriggerRef:i}=n;return Qk({permissionType:Zh.RUN_CODE,permission:Jh.USE})?(a||o)&&s.jsx(Od,{ref:i,className:"max-w-fit",checked:a,setValue:r,label:e("com_assistants_code_interpreter"),isCheckedClassName:"border-purple-600/40 bg-purple-500/10 hover:bg-purple-700/10",icon:s.jsx(Ve,{className:"icon-md"})}):null})),ZF=S.forwardRef((({isArtifactsPinned:e,setIsArtifactsPinned:t,artifactsMode:n,handleArtifactsToggle:a,handleShadcnToggle:r,handleCustomToggle:o,...i},l)=>{const c=Uk(),d=te({focusLoop:!0,showTimeout:100,placement:"right"}),u=""!==n&&void 0!==n,m=n===kh.SHADCNUI,p=n===kh.CUSTOM;return s.jsx("div",{ref:l,children:s.jsxs(ne,{store:d,children:[s.jsxs(ce,{...i,hideOnClick:!1,render:s.jsx(ie,{onClick:e=>{e.stopPropagation(),a()},onMouseEnter:()=>{u&&d.show()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(us,{className:"icon-md"}),s.jsx("span",{children:c("com_ui_artifacts")}),u&&s.jsx(Vn,{className:"ml-auto h-3 w-3"})]}),s.jsx("button",{type:"button",onClick:n=>{n.stopPropagation(),t(!e)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!e&&"text-text-secondary hover:text-text-primary"),"aria-label":e?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(kc,{unpin:e})})})]}),u&&s.jsx(re,{portal:!0,unmountOnHide:!0,className:s_("animate-popover-left z-50 ml-3 flex min-w-[250px] flex-col rounded-xl","border border-border-light bg-surface-secondary px-1.5 py-1 shadow-lg"),children:s.jsxs("div",{className:"px-2 py-1.5",children:[s.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:c("com_ui_artifacts_options")}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},disabled:p,className:s_("mb-1 flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer text-text-primary outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10",p&&"cursor-not-allowed opacity-50"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:m}),s.jsx("span",{className:"text-sm",children:c("com_ui_include_shadcnui")})]})}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),o()},className:s_("flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer text-text-primary outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:p}),s.jsx("span",{className:"text-sm",children:c("com_ui_custom_prompt_mode")})]})})]})})]})})}));ZF.displayName="ArtifactsSubMenu";const JF=S.memo(ZF),ez=S.forwardRef((({placeholder:e,...t},n)=>{const{mcpServerManager:a}=PS(),{isPinned:r,mcpValues:o,setIsPinned:i,isInitializing:l,placeholderText:c,configuredServers:d,getConfigDialogProps:u,toggleServerSelection:m,getServerStatusIconProps:p}=a,f=te({focusLoop:!0,showTimeout:100,placement:"right"});if(!d||0===d.length)return null;const h=u();return s.jsxs("div",{ref:n,children:[s.jsxs(ne,{store:f,children:[s.jsxs(ce,{...t,render:s.jsx(ie,{onClick:e=>{e.stopPropagation(),f.toggle()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Xc,{className:"icon-md"}),s.jsx("span",{children:e||c}),s.jsx(Vn,{className:"ml-auto h-3 w-3"})]}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),i(!r)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!r&&"text-text-secondary hover:text-text-primary"),"aria-label":r?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(kc,{unpin:r})})})]}),s.jsx(re,{portal:!0,unmountOnHide:!0,className:s_("animate-popover-left z-50 ml-3 flex min-w-[200px] flex-col rounded-xl","border border-border-light bg-surface-secondary p-1 shadow-lg"),children:d.map((e=>{const t=p(e),n=(null==o?void 0:o.includes(e))??!1,a=l(e),r=t&&s.jsx(HI,{...t});return s.jsxs(ce,{onClick:t=>{t.preventDefault(),m(e)},disabled:a,className:s_("flex items-center gap-2 rounded-lg px-2 py-1.5 text-text-primary hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 justify-between text-sm",a&&"opacity-50 hover:bg-transparent dark:hover:bg-transparent"),children:[s.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[s.jsx(ms,{checked:n}),s.jsx("span",{children:e})]}),r&&s.jsx("div",{className:"ml-2 flex items-center",children:r})]},e)}))})]}),h&&s.jsx(ZI,{...h})]})}));ez.displayName="MCPSubMenu";const tz=S.memo(ez),nz=S.memo((({disabled:e})=>{var t,a;const r=Uk(),o=e??!1,[i,l]=n.useState(!1),{webSearch:c,artifacts:d,fileSearch:u,agentsConfig:m,mcpServerManager:p,codeApiKeyForm:f,codeInterpreter:h,searchApiKeyForm:g}=PS(),{data:x}=Wy(),{codeEnabled:v,webSearchEnabled:b,artifactsEnabled:_,fileSearchEnabled:y}=Hk((null==m?void 0:m.capabilities)??df),{setIsDialogOpen:j,menuTriggerRef:w}=f,{setIsDialogOpen:N,menuTriggerRef:C}=g,{isPinned:k,setIsPinned:S,authData:T}=c,{isPinned:E,setIsPinned:R,authData:I}=h,{isPinned:P,setIsPinned:A}=u,{isPinned:M,setIsPinned:L}=d,O=Qk({permissionType:Zh.WEB_SEARCH,permission:Jh.USE}),D=Qk({permissionType:Zh.RUN_CODE,permission:Jh.USE}),F=Qk({permissionType:Zh.FILE_SEARCH,permission:Jh.USE}),z=n.useMemo((()=>{const e=(null==T?void 0:T.authTypes)??[];return 0===e.length||!e.every((([,e])=>e===vu.SYSTEM_DEFINED))}),[null==T?void 0:T.authTypes]),U=n.useMemo((()=>(null==I?void 0:I.message)!==vu.SYSTEM_DEFINED),[null==I?void 0:I.message]),V=n.useCallback((()=>{const e=!c.toggleState;c.debouncedChange({value:e})}),[c]),B=n.useCallback((()=>{const e=!h.toggleState;h.debouncedChange({value:e})}),[h]),$=n.useCallback((()=>{const e=!u.toggleState;u.debouncedChange({value:e})}),[u]),H=n.useCallback((()=>{const e=d.toggleState;e&&""!==e?d.debouncedChange({value:""}):d.debouncedChange({value:kh.DEFAULT})}),[d]),G=n.useCallback((()=>{d.toggleState===kh.SHADCNUI?d.debouncedChange({value:kh.DEFAULT}):d.debouncedChange({value:kh.SHADCNUI})}),[d]),K=n.useCallback((()=>{d.toggleState===kh.CUSTOM?d.debouncedChange({value:kh.DEFAULT}):d.debouncedChange({value:kh.CUSTOM})}),[d]),W=null==(a=null==(t=null==x?void 0:x.interface)?void 0:t.mcpServers)?void 0:a.placeholder,q=[];y&&F&&q.push({onClick:$,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Zc,{className:"icon-md"}),s.jsx("span",{children:r("com_assistants_file_search")})]}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),A(!P)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!P&&"text-text-secondary hover:text-text-primary"),"aria-label":P?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(kc,{unpin:P})})})]})}),O&&b&&q.push({onClick:V,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Wt,{className:"icon-md"}),s.jsx("span",{children:r("com_ui_web_search")})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[z&&s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),N(!0)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure web search",ref:C,children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(ze,{className:"h-4 w-4"})})}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),S(!k)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!k&&"text-text-secondary hover:text-text-primary"),"aria-label":k?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(kc,{unpin:k})})})]})]})}),D&&v&&q.push({onClick:B,hideOnClick:!1,render:e=>s.jsxs("div",{...e,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ve,{className:"icon-md"}),s.jsx("span",{children:r("com_assistants_code_interpreter")})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[U&&s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),j(!0)},ref:w,className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure code interpreter",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(ze,{className:"h-4 w-4"})})}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),R(!E)},className:s_("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!E&&"text-text-primary hover:text-text-primary"),"aria-label":E?"Unpin":"Pin",children:s.jsx("div",{className:"h-4 w-4",children:s.jsx(kc,{unpin:E})})})]})]})}),_&&q.push({hideOnClick:!1,render:e=>s.jsx(JF,{...e,isArtifactsPinned:M,setIsArtifactsPinned:L,artifactsMode:d.toggleState,handleArtifactsToggle:H,handleShadcnToggle:G,handleCustomToggle:K})});const{configuredServers:Q}=p;if(Q&&Q.length>0&&q.push({hideOnClick:!1,render:e=>s.jsx(tz,{...e,placeholder:W})}),0===q.length)return null;const Y=s.jsx(Dl,{render:s.jsx(ie,{disabled:o,id:"tools-dropdown-button","aria-label":"Tools Options",className:s_("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:s.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:s.jsx(Jt,{className:"icon-md"})})}),id:"tools-dropdown-button",description:r("com_ui_tools"),disabled:o});return s.jsx(Nd,{itemClassName:"flex w-full cursor-pointer rounded-lg items-center justify-between hover:bg-surface-hover gap-5",menuId:"tools-dropdown-menu",isOpen:i,setIsOpen:l,modal:!0,unmountOnHide:!0,trigger:Y,items:q,iconClassName:"mr-0"})}));function sz(){const{webSearch:e,codeInterpreter:t,searchApiKeyForm:a,codeApiKeyForm:r}=PS(),{authData:o}=e,{authData:i}=t,{methods:l,onSubmit:c,isDialogOpen:d,setIsDialogOpen:u,handleRevokeApiKey:m,badgeTriggerRef:p,menuTriggerRef:f}=a,{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:v,handleRevokeApiKey:b,badgeTriggerRef:_,menuTriggerRef:y}=r,j=n.useMemo((()=>(null==o?void 0:o.authTypes)??[]),[null==o?void 0:o.authTypes]),w=n.useMemo((()=>(null==i?void 0:i.message)??!1),[null==i?void 0:i.message]);return s.jsxs(s.Fragment,{children:[s.jsx(RI,{onSubmit:c,authTypes:j,isOpen:d,onRevoke:m,register:l.register,onOpenChange:u,handleSubmit:l.handleSubmit,triggerRefs:[f,p],isToolAuthenticated:(null==o?void 0:o.authenticated)??!1}),s.jsx(FI,{onSubmit:g,isOpen:x,onRevoke:b,register:h.register,onOpenChange:v,handleSubmit:h.handleSubmit,triggerRefs:[y,_],isUserProvided:w===vu.USER_PROVIDED,isToolAuthenticated:(null==i?void 0:i.authenticated)??!1})]})}const az=n.memo((function(){const e=Uk(),{fileSearch:t}=PS(),{toggleState:n,debouncedChange:a,isPinned:r}=t;return Qk({permissionType:Zh.FILE_SEARCH,permission:Jh.USE})?s.jsx(s.Fragment,{children:(n||r)&&s.jsx(Od,{className:"max-w-fit",checked:n,setValue:a,label:e("com_assistants_file_search"),isCheckedClassName:"border-green-600/40 bg-green-500/10 hover:bg-green-700/10",icon:s.jsx(Zc,{className:"icon-md"})})}):null}));const rz=n.memo((function(){const e=Uk(),{artifacts:t}=PS(),{toggleState:a,debouncedChange:r,isPinned:o}=t,[i,l]=n.useState(!1),c=n.useMemo((()=>"string"==typeof a&&a?{enabled:!0,mode:a}:{enabled:!1,mode:""}),[a]),d=c.enabled,u=c.mode===kh.SHADCNUI,m=c.mode===kh.CUSTOM,p=n.useCallback((()=>{r(d?{value:""}:{value:kh.DEFAULT})}),[d,r]),f=n.useCallback((()=>{r(u?{value:kh.DEFAULT}:{value:kh.SHADCNUI})}),[u,r]),h=n.useCallback((()=>{r(m?{value:kh.DEFAULT}:{value:kh.CUSTOM})}),[m,r]);return d||o?s.jsxs("div",{className:"flex",children:[s.jsx(Od,{className:s_("max-w-fit",d&&"rounded-r-none border-r-0"),checked:d,setValue:p,label:e("com_ui_artifacts"),isCheckedClassName:"border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10",icon:s.jsx(us,{className:"icon-md"})}),d&&s.jsxs(ne,{open:i,setOpen:l,children:[s.jsx(ie,{className:s_("w-7 rounded-l-none rounded-r-full border-b border-l-0 border-r border-t border-border-light md:w-6","border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10","transition-colors"),onClick:e=>e.stopPropagation(),children:s.jsx(Pt,{className:"ml-1 h-4 w-4 text-text-secondary md:ml-0"})}),s.jsx(re,{gutter:8,className:s_("animate-popover z-50 flex max-h-[300px]","flex-col overflow-auto overscroll-contain rounded-xl","bg-surface-secondary px-1.5 py-1 text-text-primary shadow-lg","border border-border-light","min-w-[250px] outline-none"),portal:!0,children:s.jsxs("div",{className:"px-2 py-1.5",children:[s.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:e("com_ui_artifacts_options")}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),f()},disabled:m,className:s_("mb-1 flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10",m&&"cursor-not-allowed opacity-50"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:u}),s.jsx("span",{className:"text-sm",children:e("com_ui_include_shadcnui")})]})}),s.jsx(ce,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),h()},className:s_("flex items-center justify-between rounded-lg px-2 py-2","cursor-pointer outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ms,{checked:m}),s.jsx("span",{className:"text-sm",children:e("com_ui_custom_prompt_mode")})]})})]})})]})]}):null}));function oz(){const{conversationId:e,mcpServerManager:t}=PS(),{localize:a,isPinned:r,mcpValues:o,isInitializing:i,placeholderText:l,configuredServers:c,batchToggleServers:d,getConfigDialogProps:u,getServerStatusIconProps:m}=t,p=n.useCallback(((e,t)=>0===e.length?t||a("com_ui_select")+"...":1===e.length?e[0]:a("com_ui_x_selected",{0:e.length})),[a]),f=n.useCallback(((e,t)=>{const n=m(e),a=i(e),r=s.jsx("button",{type:"button",className:"flex flex-grow items-center rounded bg-transparent p-0 text-left transition-colors focus:outline-none "+(a?"opacity-50":""),tabIndex:0,disabled:a,children:t}),o=n&&s.jsx(HI,{...n});return o?s.jsxs("div",{className:"flex w-full items-center justify-between",children:[r,s.jsx("div",{className:"ml-2 flex items-center",children:o})]}):r}),[m,i]);if(!r&&0===(null==o?void 0:o.length))return null;const h=u();return s.jsxs(s.Fragment,{children:[s.jsx(wd,{items:c,selectedValues:o??[],setSelectedValues:d,renderSelectedValues:p,renderItemContent:f,placeholder:l,popoverClassName:"min-w-fit",className:"badge-icon min-w-fit",selectIcon:s.jsx(Xc,{className:"icon-md text-text-primary"}),selectItemsClassName:"border border-blue-600/50 bg-blue-500/10 hover:bg-blue-700/10",selectClassName:"group relative inline-flex items-center justify-center md:justify-start gap-1.5 rounded-full border border-border-medium text-sm font-medium transition-all md:w-full size-9 p-2 md:p-3 bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner"}),h&&s.jsx(ZI,{...h,conversationId:e})]})}const iz=n.memo((function(){const{mcpServerManager:e}=PS(),{configuredServers:t}=e;return t&&0!==t.length?s.jsx(oz,{}):null}));const lz=n.memo((function(){const e=Uk(),{webSearch:t,searchApiKeyForm:n}=PS(),{toggleState:a,debouncedChange:r,isPinned:o,authData:i}=t,{badgeTriggerRef:l}=n;return Qk({permissionType:Zh.WEB_SEARCH,permission:Jh.USE})?(o||a&&(null==i?void 0:i.authenticated))&&s.jsx(Od,{ref:l,className:"max-w-fit",checked:a,setValue:r,label:e("com_ui_search"),isCheckedClassName:"border-blue-600/40 bg-blue-500/10 hover:bg-blue-700/10",icon:s.jsx(Wt,{className:"icon-md"})}):null})),cz=S.memo(n.forwardRef((({badge:e,isEditing:t,isInChat:n,onToggle:a,onDelete:r,onMouseDown:o,badgeRefs:i},l)=>{const c=Ae(e.atom),d=!!e.atom&&c;return s.jsx("div",{ref:t=>{t&&(i.current[e.id]=t),"function"==typeof l?l(t):l&&(l.current=t)},onMouseDown:t=>o(t,e,d),className:t?"ios-wiggle badge-icon h-full":"badge-icon h-full",children:s.jsx(Xl,{id:e.id,icon:e.icon,label:e.label,isActive:d,isEditing:t,isAvailable:e.isAvailable,isInChat:n,onToggle:()=>a(e),onBadgeAction:()=>r(e.id)})})})),((e,t)=>e.badge.id===t.badge.id&&e.isEditing===t.isEditing&&e.isInChat===t.isInChat&&e.onToggle===t.onToggle&&e.onDelete===t.onDelete&&e.onMouseDown===t.onMouseDown&&e.badgeRefs===t.badgeRefs));cz.displayName="BadgeWrapper";const dz=(e,t)=>{switch(t.type){case"START_DRAG":return{draggedBadge:t.badge,mouseX:t.mouseX,offsetX:t.offsetX,insertIndex:t.insertIndex,draggedBadgeActive:t.isActive};case"UPDATE_POSITION":return{...e,mouseX:t.mouseX,insertIndex:t.insertIndex};case"END_DRAG":return{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1};default:return e}};const uz=n.memo((function({showEphemeralBadges:e,conversationId:t,isSubmitting:a,onChange:r,onToggle:o,isInChat:i}){var l;const[c,d]=n.useState([]),[u,m]=n.useReducer(dz,{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1}),p=n.useRef({}),f=n.useRef(null),h=n.useRef(null),g=n.useRef(null),x=iT(),v=Ae(Cy.isEditingBadges),b=n.useMemo((()=>x.filter((e=>!1!==e.isAvailable))),[x]),_=Re((({snapshot:e,set:t})=>async n=>{const s=await e.getPromise(n);t(n,!s)}),[]);n.useEffect((()=>{d((e=>{const t=new Set(e.map((e=>e.id))),n=b.filter((e=>!t.has(e.id)));return n.length>0?[...e,...n]:e}))}),[b]);const y=u.draggedBadge?c.filter((e=>{var t;return e.id!==(null==(t=u.draggedBadge)?void 0:t.id)})):c,j=u.draggedBadge||null,w=n.useCallback((e=>{if(!u.draggedBadge||!f.current||!g.current)return 0;const t=e-g.current.left,n=y.map((e=>p.current[e.id])).filter(Boolean);if(0===n.length)return 0;let s=0;for(let a=0;a<n.length;a++){const e=n[a].getBoundingClientRect();if(t<e.left-g.current.left+e.width/2)break;s=a+1}return s}),[u.draggedBadge,y]),N=n.useCallback(((e,t,n)=>{if(!v||!f.current)return;const s=p.current[t.id];if(!s)return;const a=s.getBoundingClientRect(),r=e.clientX-a.left,o=e.clientX,i=c.findIndex((e=>e.id===t.id));g.current=f.current.getBoundingClientRect(),m({type:"START_DRAG",badge:t,mouseX:o,offsetX:r,insertIndex:i,isActive:n})}),[v,c]),C=n.useCallback((e=>{u.draggedBadge&&(h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame((()=>{const t=e.clientX,n=w(t);n!==u.insertIndex?m({type:"UPDATE_POSITION",mouseX:t,insertIndex:n}):m({type:"UPDATE_POSITION",mouseX:t,insertIndex:u.insertIndex})})))}),[u.draggedBadge,u.insertIndex,w]),k=n.useCallback((()=>{if(u.draggedBadge&&null!==u.insertIndex){const e=c.filter((e=>{var t;return e.id!==(null==(t=u.draggedBadge)?void 0:t.id)})),t=[...e.slice(0,u.insertIndex),u.draggedBadge,...e.slice(u.insertIndex)];d(t),r(t.map((e=>({id:e.id}))))}m({type:"END_DRAG"}),g.current=null}),[u.draggedBadge,u.insertIndex,c,r]),T=n.useCallback((e=>{const t=c.filter((t=>t.id!==e));d(t),r(t.map((e=>({id:e.id}))))}),[c,r]),E=n.useCallback((e=>{e.atom&&_(e.atom),o&&o(e.id,!!e.atom)}),[_,o]);return n.useEffect((()=>{if(u.draggedBadge)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",k),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",k),h.current&&(cancelAnimationFrame(h.current),h.current=null)}}),[u.draggedBadge,C,k]),s.jsxs(AS,{conversationId:t,isSubmitting:a,children:[s.jsxs("div",{ref:f,className:"relative flex flex-wrap items-center gap-2",children:[!0===e&&s.jsx(nz,{}),y.map(((e,t)=>s.jsxs(S.Fragment,{children:[u.draggedBadge&&u.insertIndex===t&&j&&s.jsx("div",{className:"badge-icon h-full",children:s.jsx(Xl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isEditing:v,isAvailable:j.isAvailable,isInChat:i})}),s.jsx(cz,{badge:e,isEditing:v,isInChat:i,onToggle:E,onDelete:T,onMouseDown:N,badgeRefs:p})]},e.id))),u.draggedBadge&&u.insertIndex===y.length&&j&&s.jsx("div",{className:"badge-icon h-full",children:s.jsx(Xl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isEditing:v,isAvailable:j.isAvailable,isInChat:i})}),!0===e&&s.jsxs(s.Fragment,{children:[s.jsx(lz,{}),s.jsx(XF,{}),s.jsx(az,{}),s.jsx(rz,{}),s.jsx(iz,{})]}),j&&s.jsx("div",{className:"ghost-badge h-full",style:{position:"absolute",top:0,left:0,transform:`translateX(${u.mouseX-u.offsetX-((null==(l=g.current)?void 0:l.left)||0)}px)`,zIndex:10,pointerEvents:"none"},children:s.jsx(Xl,{id:j.id,icon:j.icon,label:j.label,isActive:u.draggedBadgeActive,isAvailable:j.isAvailable,isInChat:i,isEditing:!0,isDragging:!0})})]}),s.jsx(sz,{})]})}));function mz({presets:e,modelSpecs:t,assistantsMap:s,endpointsConfig:a,newConversation:r,returnHandlers:o}){const{conversation:i}=Mk(),l=Pk(),c=Ae(Cy.modularChat),d=Ae(Cy.availableTools),u=n.useCallback((e=>{var t,n;if(!e)return;const{preset:o}=e;o.iconURL=Ab(e),o.spec=e.name;const{endpoint:d}=o,u=d??"";if(!u)return;const{template:m,shouldSwitch:p,isNewModular:f,newEndpointType:h,isCurrentModular:g,isExistingConversation:x}=Rb({newEndpoint:u,modularChat:c,conversation:i,endpointsConfig:a});h&&(o.endpointType=h),Mu(u)&&null!=o.assistant_id&&!o.model&&(o.model=null==(n=null==(t=null==s?void 0:s[u])?void 0:t[o.assistant_id])?void 0:n.model);const v=g&&f&&p;if(x&&v){m.endpointType=h;const e=l({conversation:{...i??{},endpointType:m.endpointType},preset:m,cleanOutput:!0});return a_.info("conversation","Switching conversation to new spec (modular)",i),void r({template:e,preset:o,keepLatestMessage:!0,keepAddedConvos:!0})}a_.info("conversation","Switching conversation to new spec",i),r({template:{...m},preset:o,keepAddedConvos:v})}),[i,l,c,r,a,s]),m=n.useCallback(((e,t={})=>{const n=e??"";if(!n)return;const{shouldSwitch:s,isNewModular:o,isCurrentModular:d,isExistingConversation:u,newEndpointType:m,template:p}=Rb({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a}),f=t.model??"";f&&(p.model=f);const h=t.assistant_id??"";h&&(p.assistant_id=h);const g=t.agent_id??"";if(g&&(p.agent_id=g),p.spec=null,p.iconURL=null,p.modelLabel=null,u&&d&&o&&s){p.endpointType=m;const e=l({conversation:{...i??{},spec:null,iconURL:null,modelLabel:null,endpointType:p.endpointType},preset:p});return a_.info("conversation","Switching conversation to new endpoint/model (modular)",e),void r({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0})}a_.info("conversation","Switching conversation to new endpoint/model",p),r({template:{...p},preset:{...t,spec:null,iconURL:null,modelLabel:null,endpoint:n},keepAddedConvos:o})}),[i,l,c,r,a]),p=n.useCallback((e=>{if(!e)return;const t=mb(e,d),n=t.endpoint??"",{template:s,shouldSwitch:o,isNewModular:u,newEndpointType:m,isCurrentModular:p,isExistingConversation:f}=Rb({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a});t.spec=null,t.iconURL=t.iconURL??null,t.modelLabel=t.modelLabel??null;const h=p&&u&&o,g=!0===t.defaultPreset;if(f&&h){s.endpointType=m,s.spec=null,s.iconURL=null,s.modelLabel=null;const e=l({conversation:{...i??{},endpointType:s.endpointType},preset:s,cleanInput:!0});return a_.info("conversation","Switching conversation to new preset (modular)",e),void r({template:e,preset:t,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:g})}a_.info("conversation","Switching conversation to new preset",s),r({preset:t,keepAddedConvos:h,disableParams:g})}),[c,i,d,r,a,l]),f=n.useCallback((n=>{var a,r;const o=n.value;if("preset"===n.type){const t=null==e?void 0:e.find((e=>e.presetId===o));p(t)}else if("modelSpec"===n.type){const e=t.find((e=>e.name===o));u(e)}else"model"===n.type?m(o,{model:n.label}):"endpoint"===n.type?m(o):Mu(n.type)?m(n.type,{assistant_id:o,model:(null==(r=null==(a=null==s?void 0:s[n.type])?void 0:a[o])?void 0:r.model)??""}):Lu(n.type)&&m(n.type,{agent_id:o})}),[t,m,p,u,e,s]);return o?{onSelectSpec:u,onSelectEndpoint:m}:{onSelectMention:f}}const pz=Gf().interface,fz=({endpoint:e,assistantMap:t,endpointsConfig:n})=>({id:s,name:a,description:r})=>({type:e,label:a??"",value:s,description:r??"",icon:eI({conversation:{assistant_id:s,endpoint:e},endpointsConfig:n,context:"menu-item",assistantMap:t})});function hz({setShowMentionPopover:e,newConversation:t,textAreaRef:a,commandChar:r="@",placeholder:o="com_ui_mention",includeAssistants:i=!0}){const l=Uk(),c=bS(),{options:d,presets:u,modelSpecs:m,agentsList:p,modelsConfig:f,endpointsConfig:h,assistantListMap:g}=function({assistantMap:e,includeAssistants:t}){const s=Qk({permissionType:Zh.AGENTS,permission:Jh.USE}),a=zk(),{data:r}=mj(),{data:o}=fk(),{data:i}=Wy(),{data:l}=Ky(),{data:c=[]}=Ky({select:Tb}),d=Ok((e=>e.data.map((({id:e,name:t,description:n})=>({id:e,name:t,description:n}))))),u=n.useMemo((()=>(null==i?void 0:i.interface)??pz),[null==i?void 0:i.interface]),{data:m=null}=Py({requiredPermission:Yg.VIEW},{enabled:s&&!0===u.modelSelect,select:e=>{const{data:t}=e;return t.map((({id:e,name:t,avatar:n})=>({value:e,label:t??"",type:Nu.agents,icon:eI({conversation:{endpoint:Nu.agents,iconURL:null==n?void 0:n.filepath},endpointsConfig:l,context:"menu-item"})})))}}),p=n.useMemo((()=>{var t,n;return{[Nu.assistants]:null==(t=d[Nu.assistants])?void 0:t.map(fz({endpoint:Nu.assistants,assistantMap:e,endpointsConfig:l})).filter(Boolean),[Nu.azureAssistants]:null==(n=d[Nu.azureAssistants])?void 0:n.map(fz({endpoint:Nu.azureAssistants,assistantMap:e,endpointsConfig:l})).filter(Boolean)}}),[d,e,l]),f=n.useMemo((()=>{var e;const t=(null==(e=null==i?void 0:i.modelSpecs)?void 0:e.list)??[];return a?t.filter((e=>{var t,n;return(null==(t=e.preset)?void 0:t.endpoint)!==Nu.agents||!(null==(n=e.preset)?void 0:n.agent_id)||e.preset.agent_id in a})):t}),[i,a]);return{options:n.useMemo((()=>{var n;let s=c;t||(s=c.filter((e=>!Mu(e))));const a=s.flatMap((e=>Mu(e)||Lu(e)||!0!==u.modelSelect?[]:((null==o?void 0:o[e])??[]).map((t=>({value:e,label:t,type:"model",icon:eI({conversation:{endpoint:e,model:t},endpointsConfig:l,context:"menu-item"})})))));return[...(f.length>0?f:[]).map((e=>({value:e.name,label:e.label,description:e.description,icon:eI({conversation:{...e.preset,iconURL:e.iconURL},endpointsConfig:l,context:"menu-item"}),type:"modelSpec"}))),...(!0===u.modelSelect?s:[]).map((e=>({value:e,label:qf[e]??e??"",type:"endpoint",icon:eI({conversation:{endpoint:e},endpointsConfig:l,context:"menu-item"})}))),...!0===u.modelSelect?m??[]:[],...(null==l?void 0:l[Nu.assistants])&&t&&!0===u.modelSelect&&p[Nu.assistants]||[],...(null==l?void 0:l[Nu.azureAssistants])&&t&&!0===u.modelSelect&&p[Nu.azureAssistants]||[],...(null==(n=!0===u.modelSelect&&!0===u.presets?r:[])?void 0:n.map(((t,n)=>({value:t.presetId??`preset-${n}`,label:t.title??t.modelLabel??t.chatGptLabel??"",description:ub(t,!0),icon:eI({conversation:t,endpointsConfig:l,context:"menu-item",assistantMap:e}),type:"preset"}))))??[],...a]}),[r,c,f,m,e,o,l,p,t,u.presets,u.modelSelect]),presets:r,modelSpecs:f,agentsList:m,modelsConfig:o,endpointsConfig:l,assistantListMap:p}}({assistantMap:c||{},includeAssistants:i}),{onSelectMention:x}=mz({presets:u,modelSpecs:m,assistantsMap:c,endpointsConfig:h,newConversation:t}),[v,b]=n.useState(0),_=n.useRef(null),y=n.useRef(null),[j,w]=n.useState(d),{open:N,setOpen:C,searchValue:k,setSearchValue:S,matches:T}=Gi({value:"",options:j}),E=t=>{var n,s,o,i;if(!t)return;if("endpoint"===t.type&&t.value===Nu.agents)S(""),w(p??[]),b(0),null==(n=y.current)||n.focus();else if("endpoint"===t.type&&t.value===Nu.assistants)S(""),w(g[Nu.assistants]??[]),b(0),null==(s=y.current)||s.focus();else if("endpoint"===t.type&&t.value===Nu.azureAssistants)S(""),w(g[Nu.azureAssistants]??[]),b(0),null==(o=y.current)||o.focus();else if("endpoint"===t.type){const e=((null==f?void 0:f[t.value||""])??[]).map((e=>({value:t.value,label:e,type:"model"})));b(0),S(""),w(e),null==(i=y.current)||i.focus()}else S(""),C(!1),e(!1),null==x||x(t),a.current&&xb(a.current,r)};n.useEffect((()=>{N||(w(d),b(0))}),[N,d]),n.useEffect((()=>()=>{_.current&&clearTimeout(_.current)}),[]);const R="@"!==r?"add-convo":"mention";n.useEffect((()=>{const e=document.getElementById(`${R}-item-${v}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[R,v]);const I=({index:e,key:t,style:n})=>{const a=T[e];return s.jsx(FF,{type:R,index:e,style:n,onClick:e=>{e.preventDefault(),e.stopPropagation(),_.current&&clearTimeout(_.current),_.current=null,E(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===v},t)};return s.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:s.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-white p-2 shadow-lg dark:bg-gray-700",children:[s.jsx("input",{autoFocus:!0,ref:y,placeholder:l(o),className:"mb-1 w-full border-0 bg-white p-2 text-sm focus:outline-none dark:bg-gray-700 dark:text-gray-200",autoComplete:"off",value:k,onKeyDown:t=>{var n,s;if("Escape"===t.key&&(C(!1),e(!1),null==(n=a.current)||n.focus()),"ArrowDown"===t.key)b((e=>(e+1)%T.length));else if("ArrowUp"===t.key)b((e=>(e-1+T.length)%T.length));else if("Enter"===t.key||"Tab"===t.key){const e=T[v];("endpoint"===(null==e?void 0:e.type)||"Enter"===t.key)&&t.preventDefault(),E(T[v])}else"Backspace"===t.key&&""===k&&(C(!1),e(!1),null==(s=a.current)||s.focus())},onChange:e=>S(e.target.value),onFocus:()=>C(!0),onBlur:()=>{_.current=setTimeout((()=>{C(!1),e(!1)}),150)}}),N&&s.jsx("div",{className:"max-h-40",children:s.jsx($r,{disableHeight:!0,children:({width:e})=>s.jsx(Hr,{width:e,overscanRowCount:5,rowHeight:40,rowCount:T.length,rowRenderer:I,scrollToIndex:v,height:Math.min(40*T.length,160)})})})]})})}const gz=n.memo((({index:e=0})=>{var t;const a=n.useRef(null),r=n.useRef(null);!function(e){var t;const s=De(),a=Fe();n.useEffect((()=>{var t,n,r;(null==e?void 0:e.current)&&(null==(t=s.state)?void 0:t.focusChat)&&(a_.log("conversation",`Focusing textarea on location state change: ${s.pathname}`),(null==(n=window.matchMedia)?void 0:n.call(window,"(pointer: coarse)").matches)||null==(r=e.current)||r.focus(),a(`${s.pathname}${window.location.search??""}`,{replace:!0,state:{}}))}),[a,e,s.pathname,null==(t=s.state)?void 0:t.focusChat])}(r);const[o,i]=n.useState(!1),[,l]=n.useState(!1),[c,d]=n.useState(1),[u,m]=n.useState(!1),[p,f]=n.useState([]),h=Ae(Cy.speechToText),g=Ae(Cy.textToSpeech),x=Ae(Cy.chatDirection),v=Ae(Cy.automaticPlayback),b=Ae(Cy.maximizeChatSpace),_=Ae(Cy.centerFormOnLanding),y=Ae(Cy.isTemporary),[j,w]=Ie(Cy.chatBadges),[N,C]=Ie(Cy.isEditingBadges),[k,S]=Ie(Cy.showStopButtonByIndex(e)),[T,E]=Ie(Cy.showPlusPopoverFamily(e)),[R,I]=Ie(Cy.showMentionPopoverFamily(e)),{requiresKey:P}=function(){const{conversation:e}=Mk(),{data:t}=Ky(),{endpoint:n}=e||{},s=Sb(t,n,"userProvide"),{getExpiry:a}=sT(n??"");return{requiresKey:!a()&&s}}(),A=uS(),{files:M,setFiles:L,conversation:O,isSubmitting:D,filesLoading:F,newConversation:z,handleStopGenerating:U}=Mk(),{addedIndex:V,generateConversation:B,conversation:$,setConversation:H,isSubmitting:G}=oS(),K=bS(),W=Ae(Cy.showStopButtonByIndex(V)),q=n.useMemo((()=>(null==O?void 0:O.endpointType)??(null==O?void 0:O.endpoint)),[null==O?void 0:O.endpointType,null==O?void 0:O.endpoint]),Q=n.useMemo((()=>(null==O?void 0:O.conversationId)??dh.NEW_CONVO),[null==O?void 0:O.conversationId]),Y=n.useMemo((()=>null!=x&&"rtl"===(null==x?void 0:x.toLowerCase())),[x]),X=n.useMemo((()=>{var e;return Mu(q)&&(!(null==O?void 0:O.assistant_id)||!(null==(e=null==K?void 0:K[q??""])?void 0:e[(null==O?void 0:O.assistant_id)??""]))}),[null==O?void 0:O.assistant_id,q,K]),Z=n.useMemo((()=>P||X),[P,X]),J=n.useCallback((()=>{var e,t;(null==(e=window.matchMedia)?void 0:e.call(window,"(pointer: coarse)").matches)||null==(t=r.current)||t.focus()}),[]),ee=n.useCallback((()=>{o&&i(!1)}),[o]);(({isSubmitting:e,conversationId:t,textAreaRef:s,setFiles:a,files:r})=>{const{setValue:o}=uS(),i=Ae(Cy.saveDrafts),l=e?dh.PENDING_CONVO:t,[c,d]=n.useState(null),u=n.useMemo((()=>Array.from(r.keys())),[r]),{data:m}=Qy(),p=n.useCallback((e=>{const t=JSON.parse((localStorage.getItem(`${uh.FILES_DRAFT}${e}`)??"")||"[]");0!==t.length?t.forEach((e=>{const t=null==m?void 0:m.find((t=>t.file_id===e)),n=null==m?void 0:m.find((t=>t.temp_file_id===e)),{fileToRecover:s,fileIdToRecover:r}=t?{fileToRecover:t,fileIdToRecover:e}:{fileToRecover:n,fileIdToRecover:((null==n?void 0:n.temp_file_id)??"")||e};s&&a((e=>{const t=new Map(e);return t.set(r,{...s,progress:1,attached:!0,size:s.bytes}),t}))})):a(new Map)}),[m,a]),f=n.useCallback((e=>{const t=tb(e);t&&o("text",t)}),[o]),h=n.useCallback((e=>{(null==s?void 0:s.current)&&(""===s.current.value||1===s.current.value.length?Jv(e):eb({id:e,value:s.current.value}))}),[s]);n.useEffect((()=>{if(!i||null==l||""===l)return;const e=ko((e=>eb({id:l,value:e})),65),t=ko((e=>eb({id:l,value:e})),850),n=n=>{const s=n.target.value;e.cancel(),t.cancel(),""===s?t(s):e(s)},a=null==s?void 0:s.current;return a&&a.addEventListener("input",n),()=>{a&&a.removeEventListener("input",n),e.cancel(),t.cancel()}}),[l,i,s]);const g=n.useRef(null);n.useEffect((()=>{var e;if(i&&null!=l&&""!==l&&l!==c){a(new Map);try{if(g.current===dh.PENDING_CONVO&&l!==dh.PENDING_CONVO&&l.length>3){const t=localStorage.getItem(`${uh.TEXT_DRAFT}${dh.PENDING_CONVO}`);localStorage.removeItem(`${uh.TEXT_DRAFT}${dh.PENDING_CONVO}`),t?localStorage.setItem(`${uh.TEXT_DRAFT}${l}`,t):(null==(e=null==s?void 0:s.current)?void 0:e.value)&&eb({id:l,value:s.current.value});const n=localStorage.getItem(`${uh.FILES_DRAFT}${dh.PENDING_CONVO}`);n&&(localStorage.setItem(`${uh.FILES_DRAFT}${l}`,n),localStorage.removeItem(`${uh.FILES_DRAFT}${dh.PENDING_CONVO}`),JSON.parse(n||"[]").length>0&&p(l))}else null!=c&&c&&h(c);f(l),p(l)}catch(Fi){console.error(Fi)}g.current=l,d(l)}}),[c,l,p,s,f,i,h,a]),n.useEffect((()=>{i&&null!=l&&""!==l&&c===l&&(0===u.length?localStorage.removeItem(`${uh.FILES_DRAFT}${l}`):localStorage.setItem(`${uh.FILES_DRAFT}${l}`,JSON.stringify(u)))}),[r,l,i,c,u])})({files:M,setFiles:L,textAreaRef:r,conversationId:Q,isSubmitting:D||G});const{submitMessage:te,submitPrompt:ne}=YT(),se=(({index:e,textAreaRef:t,setShowPlusPopover:s,setShowMentionPopover:a})=>{const r=Qk({permissionType:Zh.PROMPTS,permission:Jh.USE}),o=Qk({permissionType:Zh.MULTI_CONVO,permission:Jh.USE}),i=Ae(Cy.latestMessageFamily(e)),l=Pe(Cy.showPromptsPopoverFamily(e)),c=Ae(Cy.atCommand),d=Ae(Cy.plusCommand),u=Ae(Cy.slashCommand),m=n.useCallback((()=>{c&&UT(t,"@")&&a(!0)}),[t,a,c]),p=n.useCallback((()=>{o&&d&&UT(t,"+")&&s(!0)}),[t,s,d,o]),f=n.useCallback((()=>{r&&u&&UT(t,"/")&&l(!0)}),[t,r,l,u]),h=n.useMemo((()=>({"@":m,"+":p,"/":f})),[m,p,f]),g=n.useCallback((e=>{if(!i)return;const t=document.getElementById(`edit-${i.parentMessageId}`);t&&(e.preventDefault(),t.click())}),[i]);return n.useCallback((e=>{var n;const s=null==(n=t.current)?void 0:n.value;if("ArrowUp"===e.key&&0===(null==s?void 0:s.length))return void g(e);if("string"!=typeof s||0===s.length)return;if(zT[e.key])return;const a=s[0],r=h[a];"function"==typeof r&&r()}),[t,h,g])})({index:e,textAreaRef:r,setShowPlusPopover:E,setShowMentionPopover:I}),{isNotAppendable:ae,handlePaste:re,handleKeyDown:oe,handleCompositionStart:ie,handleCompositionEnd:le}=OT({textAreaRef:r,submitButtonRef:a,setIsScrollable:l,disabled:Z});FT({textAreaRef:r});const{ref:ce,...de}=A.register("text",{required:!0,onChange:n.useCallback((e=>A.setValue("text",e.target.value,{shouldValidate:!0})),[A])}),ue=Ho({control:A.control,name:"text"});n.useEffect((()=>{if(r.current){const e=window.getComputedStyle(r.current),t=parseFloat(e.lineHeight);d(Math.floor(r.current.scrollHeight/t))}}),[ue]),n.useEffect((()=>{N&&0===p.length&&f([...j])}),[N,j,p.length]);const me=n.useCallback((()=>{C(!1),f([])}),[C,f]),pe=n.useCallback((()=>{p.length>0&&w([...p]),C(!1),f([])}),[p,w,C]),fe=c>3,he=n.useMemo((()=>s_("md:py-3.5 m-0 w-full resize-none py-[13px] placeholder-black/50 bg-transparent dark:placeholder-white/50 [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",o?"max-h-[52px]":"max-h-[45vh] md:max-h-[55vh]",fe?"pl-5":"px-5")),[o,fe]);return s.jsx("form",{onSubmit:A.handleSubmit(te),className:s_("mx-auto flex w-full flex-row gap-3 transition-[max-width] duration-300 sm:px-2",b?"max-w-full":"md:max-w-3xl xl:max-w-4xl",!_||null!=Q&&Q!==dh.NEW_CONVO||D||0!==(null==(t=null==O?void 0:O.messages)?void 0:t.length)?"sm:mb-10":"transition-all duration-200 sm:mb-28"),children:s.jsx("div",{className:"relative flex h-full flex-1 items-stretch md:flex-col",children:s.jsxs("div",{className:s_("flex w-full items-center",Y&&"flex-row-reverse"),children:[T&&!Mu(q)&&s.jsx(hz,{setShowMentionPopover:E,newConversation:B,textAreaRef:r,commandChar:"+",placeholder:"com_ui_add_model_preset",includeAssistants:!1}),R&&s.jsx(hz,{setShowMentionPopover:I,newConversation:z,textAreaRef:r}),s.jsx(UF,{index:e,textAreaRef:r,submitPrompt:ne}),s.jsxs("div",{onClick:J,className:s_("relative flex w-full flex-grow flex-col overflow-hidden rounded-t-3xl border pb-4 text-text-primary transition-all duration-200 sm:rounded-3xl sm:pb-0",u?"shadow-lg":"shadow-md",y?"border-violet-800/60 bg-violet-950/10":"border-border-light bg-surface-chat"),children:[s.jsx(DF,{addedConvo:$,setAddedConvo:H}),s.jsx(YF,{isEditingChatBadges:N,handleCancelBadges:pe,handleSaveBadges:me,setBadges:w}),s.jsx(LF,{conversation:O}),q&&s.jsxs("div",{className:s_("flex",Y?"flex-row-reverse":"flex-row"),children:[s.jsx(Ll,{...de,ref:e=>{ce(e),r.current=e},disabled:Z||ae,onPaste:re,onKeyDown:oe,onKeyUp:se,onCompositionStart:ie,onCompositionEnd:le,id:gv,tabIndex:0,"data-testid":"text-input",rows:1,onFocus:()=>{ee(),m(!0)},onBlur:m.bind(null,!1),onClick:ee,style:{height:44,overflowY:"auto"},className:s_(he,p_,"transition-[max-height] duration-200 disabled:cursor-not-allowed")}),s.jsx("div",{className:"flex flex-col items-start justify-start pt-1.5",children:s.jsx($F,{isCollapsed:o,isScrollable:fe,setIsCollapsed:i})})]}),s.jsxs("div",{className:s_("items-between flex gap-2 pb-2",Y?"flex-row-reverse":"flex-row"),children:[s.jsx("div",{className:""+(Y?"mr-2":"ml-2"),children:s.jsx(MF,{conversation:O,disableInputs:Z})}),s.jsx(uz,{showEphemeralBadges:!Lu(q)&&!Mu(q),isSubmitting:D||G,conversationId:Q,onChange:w,isInChat:Array.isArray(null==O?void 0:O.messages)&&O.messages.length>=1}),s.jsx("div",{className:"mx-auto flex"}),h&&s.jsx(BF,{methods:A,ask:te,textAreaRef:r,disabled:Z||ae,isSubmitting:D}),s.jsx("div",{className:""+(Y?"ml-2":"mr-2"),children:(D||G)&&(k||W)?s.jsx(WF,{stop:U,setShowStopButton:S}):q&&s.jsx(QF,{ref:a,control:A.control,disabled:F||D||Z||ae})})]}),g&&v&&s.jsx(KF,{index:e})]})]})})})})),xz="shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white dark:bg-presentation dark:text-white text-black dark:after:shadow-none ";function vz(e){return e?e.length<40?"text-2xl sm:text-4xl":e.length<70?"text-xl sm:text-2xl":"text-lg sm:text-md":"text-xl sm:text-2xl"}function bz({centerFormOnLanding:e}){var t,a;const{conversation:r}=Mk(),o=zk(),i=bS(),{data:l}=Wy(),{data:c}=Ky(),{user:d}=qk(),u=Uk(),[m,p]=n.useState(!1),[f,h]=n.useState(1),[g,x]=n.useState(0),v=n.useRef(null),b=n.useMemo((()=>{let e=(null==r?void 0:r.endpoint)??"";return[Nu.chatGPTBrowser,Nu.azureOpenAI,Nu.gptPlugins].includes(e)&&(e=Nu.openAI),Mb({endpointsConfig:c,iconURL:null==r?void 0:r.iconURL,endpoint:e})}),[null==r?void 0:r.endpoint,null==r?void 0:r.iconURL,c]),{entity:_,isAgent:y,isAssistant:j}=Ob({endpoint:b,agentsMap:o,assistantMap:i,agent_id:null==r?void 0:r.agent_id,assistant_id:null==r?void 0:r.assistant_id}),w=(null==_?void 0:_.name)??"",N=((null==_?void 0:_.description)||(null==r?void 0:r.greeting))??"",C=n.useCallback((()=>{var e;if("string"==typeof(null==(e=null==l?void 0:l.interface)?void 0:e.customWelcome)){const e=l.interface.customWelcome;return(null==d?void 0:d.name)&&e.includes("{{user.name}}")?e.replace(/{{user.name}}/g,d.name):e}const t=new Date,n=t.getHours(),s=t.getDay();return u(n>=0&&n<5?"com_ui_late_night":n<12?0===s||6===s?"com_ui_weekend_morning":"com_ui_good_morning":n<17?"com_ui_good_afternoon":"com_ui_good_evening")}),[u,null==(t=null==l?void 0:l.interface)?void 0:t.customWelcome,null==d?void 0:d.name]),k=n.useCallback((e=>{p(e>1),h(e)}),[]);n.useEffect((()=>{v.current&&x(v.current.offsetHeight)}),[f,N]);const S=n.useMemo((()=>{let e="mb-0";return f>2||N&&N.length>100?e="mb-10":f>1||N&&N.length>0?e="mb-6":m&&(e="mb-4"),g>200?e="mb-16":g>150&&(e="mb-12"),e}),[f,N,m,g]),T="string"==typeof(null==(a=null==l?void 0:l.interface)?void 0:a.customWelcome)?C():C()+((null==d?void 0:d.name)?", "+d.name:"");return s.jsx("div",{className:`flex h-full transform-gpu flex-col items-center justify-center pb-16 transition-all duration-200 ${e?"max-h-full sm:max-h-0":"max-h-full"} ${S}`,children:s.jsxs("div",{ref:v,className:"flex flex-col items-center gap-0 p-2",children:[s.jsxs("div",{className:`flex ${m?"flex-col":"flex-col md:flex-row"} items-center justify-center gap-2`,children:[s.jsxs("div",{className:"relative size-10 justify-center "+(m?"mb-2":""),children:[s.jsx(JR,{agentsMap:o,assistantMap:i,conversation:r,endpointsConfig:c,containerClassName:xz,context:"landing",className:"h-2/3 w-2/3 text-black dark:text-white",size:41}),(null==l?void 0:l.showBirthdayIcon)&&s.jsx(Dl,{className:"absolute bottom-[27px] right-2",description:u("com_ui_happy_birthday"),children:s.jsx(Uc,{})})]}),(y||j)&&w||w?s.jsx("div",{className:"flex flex-col items-center gap-0 p-2",children:s.jsx(ld,{text:w,className:`${vz(w)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:zr.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${w}`)}):s.jsx(ld,{text:T,className:`${vz(T)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:zr.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${T}${(null==d?void 0:d.name)?"-user":""}`)]}),N&&s.jsx("div",{className:"animate-fadeIn mt-4 max-w-md text-center text-sm font-normal text-text-primary",children:N})]})})}const _z=n.createContext(void 0);function yz({children:e}){const{conversation:t,newConversation:a}=Mk(),r=n.useMemo((()=>({endpoint:null==t?void 0:t.endpoint,model:null==t?void 0:t.model,spec:null==t?void 0:t.spec,agent_id:null==t?void 0:t.agent_id,assistant_id:null==t?void 0:t.assistant_id,newConversation:a})),[null==t?void 0:t.endpoint,null==t?void 0:t.model,null==t?void 0:t.spec,null==t?void 0:t.agent_id,null==t?void 0:t.assistant_id,a]);return s.jsx(_z.Provider,{value:r,children:e})}const jz=n.memo((({currentSpec:e,endpointsConfig:t})=>{const n=Ab(e),{endpoint:a}=e.preset,r=Sb(t,a,"iconURL"),o=Lb({endpoint:a,endpointsConfig:t,endpointIconURL:r});let i;if(n.includes("http")){if(n)return s.jsx(wR,{iconURL:n,altName:e.name,containerStyle:{width:20,height:20},className:"icon-md shrink-0 overflow-hidden rounded-full",endpoint:a||void 0});i=LE[a??""]??LE[o]??LE.unknown}else i=LE[n]??LE[o]??LE.unknown;return s.jsx(i,{size:20,endpoint:a,context:"menu-item",iconURL:r,className:"icon-md shrink-0 text-text-primary"})}));const wz=({localize:e,mappedEndpoints:t,selectedValues:n,modelSpecs:s,agentsMap:a})=>{if(n.modelSpec){const t=s.find((e=>e.name===n.modelSpec));return(null==t?void 0:t.label)||(null==t?void 0:t.name)||e("com_ui_select_model")}if(n.model&&n.endpoint){const s=t.find((e=>e.value===n.endpoint));if(!s)return e("com_ui_select_model");if(Lu(s.value)&&s.agentNames&&s.agentNames[n.model])return s.agentNames[n.model];if(Lu(s.value)&&a){const e=a[n.model];return(null==e?void 0:e.name)||n.model}return Mu(s.value)&&s.assistantNames&&s.assistantNames[n.model]?s.assistantNames[n.model]:n.model}if(n.endpoint){const s=t.find((e=>e.value===n.endpoint));return(null==s?void 0:s.label)||e("com_ui_select_model")}return e("com_ui_select_model")},Nz=n.createContext(void 0);function Cz(){const e=n.useContext(Nz);if(void 0===e)throw new Error("useModelSelectorContext must be used within a ModelSelectorProvider");return e}function kz({children:e,startupConfig:t}){const a=zk(),r=bS(),{data:o}=Ky(),{endpoint:i,model:l,spec:c,agent_id:d,assistant_id:u,newConversation:m}=function(){const e=n.useContext(_z);if(!e)throw new Error("useModelSelectorChatContext must be used within ModelSelectorChatProvider");return e}(),p=n.useMemo((()=>{var e;const n=(null==(e=null==t?void 0:t.modelSpecs)?void 0:e.list)??[];return a?n.filter((e=>{var t,n;return(null==(t=e.preset)?void 0:t.endpoint)!==Nu.agents||!(null==(n=e.preset)?void 0:n.agent_id)||e.preset.agent_id in a})):n}),[t,a]),f=Yk(),{data:h=null}=Py({requiredPermission:f},{select:e=>null==e?void 0:e.data}),{mappedEndpoints:g,endpointRequiresUserKey:x}=OE({agents:h,assistantsMap:r,startupConfig:t,endpointsConfig:o}),{onSelectEndpoint:v,onSelectSpec:b}=mz({modelSpecs:p,assistantsMap:r,endpointsConfig:o,newConversation:m,returnHandlers:!0}),[_,y]=n.useState({endpoint:i||"",model:l||"",modelSpec:c||""});!function({index:e=0,agentsMap:t,conversation:s,assistantsMap:a,setSelectedValues:r}){const{setOption:o}=xT(),i=n.useMemo((()=>Object.values(t??{})),[t]),{agent_id:l=null,assistant_id:c=null,endpoint:d}=s??{},u=n.useMemo((()=>Mu(d)?Object.values((null==a?void 0:a[d??""])??{}):[]),[a,d]);n.useEffect((()=>{var n;if(Lu(d)&&null==l&&i.length>0){let s=localStorage.getItem(`${uh.AGENT_ID_PREFIX}${e}`);null==s&&(s=null==(n=i[0])?void 0:n.id),void 0!==(null==t?void 0:t[s])&&(o("model")(""),o("agent_id")(s))}}),[e,i,l,t,d,o]),n.useEffect((()=>{var t,n;if(Mu(d)&&null==c&&u.length>0){let s=localStorage.getItem(`${uh.ASST_ID_PREFIX}${e}`);null==s&&(s=null==(t=u[0])?void 0:t.id);const r=null==(n=null==a?void 0:a[d??""])?void 0:n[s];void 0!==r&&(o("model")(r.model),o("assistant_id")(s))}}),[e,u,c,a,d,o]);const m=n.useRef(null),p=e=>{m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{r(e)}),150)};n.useEffect((()=>{if(null==s?void 0:s.endpoint){if((null==s?void 0:s.assistant_id)||(null==s?void 0:s.agent_id)||(null==s?void 0:s.model)||(null==s?void 0:s.spec)){if(Lu(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.agent_id??"",modelSpec:s.spec||""});if(Mu(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.assistant_id||"",modelSpec:s.spec||""});p({endpoint:s.endpoint||"",model:s.model||"",modelSpec:s.spec||""})}return()=>{m.current&&clearTimeout(m.current)}}}),[null==s?void 0:s.spec,null==s?void 0:s.model,null==s?void 0:s.endpoint,null==s?void 0:s.agent_id,null==s?void 0:s.assistant_id])}({agentsMap:a,conversation:i?{endpoint:i??null,model:l??null,spec:c??null,agent_id:d??null,assistant_id:u??null}:null,assistantsMap:r,setSelectedValues:y});const[j,w]=n.useState(""),[N,C]=n.useState({}),k=EE(),S=n.useMemo((()=>{if(!j)return null;return function(e,t,n,s){const a=t.trim().toLowerCase();return a?e.filter((e=>!!(e.label.toLowerCase().includes(a)||e.name&&e.name.toLowerCase().includes(a)||e.value&&e.value.toLowerCase().includes(a))||!!(e.models&&e.models.length>0)&&e.models.some((t=>{var r;if(t.name.toLowerCase().includes(a))return!0;if(Lu(e.value)&&n&&t.name in n){const e=null==(r=n[t.name])?void 0:r.name;return"string"==typeof e&&e.toLowerCase().includes(a)}if(Mu(e.value)&&s){const n=e.value??"",r=s[n][t.name];return!(!r||"string"!=typeof r.name)&&r.name.toLowerCase().includes(a)}return!1})))):null}([...p,...g],j,a,r||{})}),[j,p,g,a,r]),T=n.useMemo((()=>ko((e=>{w(e)}),200)),[]),E={searchValue:j,searchResults:S,selectedValues:_,endpointSearchValues:N,agentsMap:a,modelSpecs:p,assistantsMap:r,mappedEndpoints:g,endpointsConfig:o,handleSelectSpec:e=>{let t=e.preset.model??null;null==b||b(e),Lu(e.preset.endpoint)?t=e.preset.agent_id??"":Mu(e.preset.endpoint)&&(t=e.preset.assistant_id??""),y({endpoint:e.preset.endpoint,model:t,modelSpec:e.name})},handleSelectModel:(e,t)=>{var n,s,o;Lu(e.value)?null==v||v(e.value,{agent_id:t,model:(null==(n=null==a?void 0:a[t])?void 0:n.model)??""}):Mu(e.value)?null==v||v(e.value,{assistant_id:t,model:(null==(o=null==(s=null==r?void 0:r[e.value])?void 0:s[t])?void 0:o.model)??""}):e.value&&(null==v||v(e.value,{model:t})),y({endpoint:e.value,model:t,modelSpec:""})},setSelectedValues:y,handleSelectEndpoint:e=>{e.hasModels||(e.value&&(null==v||v(e.value)),y({endpoint:e.value,model:"",modelSpec:""}))},setEndpointSearchValue:(e,t)=>{C((n=>({...n,[e]:t})))},endpointRequiresUserKey:x,setSearchValue:T,...k};return s.jsx(Nz.Provider,{value:E,children:e})}const Sz=n.forwardRef((function({label:e,children:t,values:n,onValuesChange:a,searchValue:r,onSearch:o,combobox:i,trigger:l,defaultOpen:c,...d},u){const m=ae(),p=null!=r||!!o||!!i,f=te({showTimeout:100,placement:m?"right":"left",defaultOpen:c}),h=s.jsxs(ne,{store:f,values:n,setValues:a,children:[s.jsxs(ie,{ref:u,...d,className:s_(!m&&"flex h-10 w-full items-center justify-center gap-2 rounded-xl border border-border-light px-3 py-2 text-sm text-text-primary",f.useState("open")?"bg-surface-tertiary hover:bg-surface-tertiary":"bg-surface-secondary hover:bg-surface-tertiary",d.className),render:m?s.jsx(Ez,{render:l}):l,children:[s.jsx("span",{className:"flex-1",children:e}),s.jsx(le,{className:"stroke-1 text-base opacity-75"})]}),s.jsx(re,{open:f.useState("open"),portal:!0,overlap:!0,unmountOnHide:!0,gutter:m?-4:4,className:s_((m?"animate-popover-left ml-3":"animate-popover")+" outline-none! z-50 flex max-h-[min(450px,var(--popover-available-height))] w-full","w-[var(--menu-width,auto)] min-w-[300px] flex-col overflow-auto rounded-xl border border-border-light","bg-surface-secondary px-3 py-2 text-sm text-text-primary shadow-lg","max-w-[calc(100vw-4rem)] sm:max-h-[calc(65vh)] sm:max-w-[400px]",p&&"p-0"),children:s.jsx(Tz.Provider,{value:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"sticky top-0 z-10 bg-inherit p-1",children:s.jsx(z,{autoSelect:!0,render:i,className:s_("h-10 w-full rounded-lg border-none bg-transparent px-2 text-base","sm:h-8 sm:text-sm","focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white")})}),s.jsx(U,{className:"p-0.5 pt-0",children:t})]}):t})})]});return p?s.jsx(G,{resetValueOnHide:!0,includesBaseElement:!1,value:r,setValue:o,children:h}):h}));n.forwardRef((function(e,t){return s.jsx(oe,{ref:t,...e,className:s_("my-0.5 h-0 w-full border-t border-slate-200 dark:border-slate-700",e.className)})})),n.forwardRef((function({label:e,...t},n){return s.jsxs(ps,{ref:n,...t,className:s_("",t.className),children:[e&&s.jsx(fs,{className:"cursor-default p-2 text-sm font-medium opacity-60 sm:py-1 sm:text-xs",children:e}),t.children]})}));const Tz=n.createContext(!1),Ez=n.forwardRef((function({name:e,value:t,...a},r){const o=ae(),l=n.useContext(Tz),c={ref:r,focusOnHover:!0,blurOnHoverEnd:!1,...a,className:s_("relative flex cursor-default items-center gap-2 rounded-lg p-2 outline-none! scroll-m-1 scroll-mt-[calc(var(--combobox-height,0px)+var(--label-height,4px))] aria-disabled:opacity-25 data-[active-item]:bg-black/[0.075] data-[active-item]:text-black dark:data-[active-item]:bg-white/10 dark:data-[active-item]:text-white sm:py-1 sm:text-sm min-w-0 w-full before:absolute before:left-0 before:top-1 before:bottom-1 before:w-0.5 before:bg-transparent before:rounded-full data-[active-item]:before:bg-black dark:data-[active-item]:before:bg-white",a.className)},d=i(o,(n=>!!e&&(null!=t&&null!=(null==n?void 0:n.values[e])))),u=i(o,(n=>!!e&&(null==n?void 0:n.values[e])===t));if(d&&(c.children=s.jsxs(n.Fragment,{children:[s.jsx("span",{className:"flex-1",children:c.children}),s.jsx(ms,{checked:u}),l&&s.jsx(Bt,{children:u?"checked":"not checked"})]})),!l){if(null!=e&&null!=t){const n={...c,name:e,value:t,hideOnClick:!0};return s.jsx(hs,{...n})}return s.jsx(ce,{...c})}return s.jsx(B,{...c,setValueOnClick:!1,value:d?t:void 0,selectValueOnClick:()=>null!=e&&null!=t&&(null==o||o.setValue(e,t),!0),hideOnClick:e=>!e.currentTarget.hasAttribute("aria-expanded")&&(null==o||o.hideAll(),!0)})}));function Rz({spec:e,isSelected:t}){const{handleSelectSpec:n,endpointsConfig:a}=Cz(),{showIconInMenu:r=!0}=e;return s.jsxs(Ez,{onClick:()=>n(e),className:s_("flex w-full cursor-pointer items-center justify-between rounded-lg px-2 text-sm"),children:[s.jsxs("div",{className:s_("flex w-full min-w-0 gap-2 px-1 py-1",e.description?"items-start":"items-center"),children:[r&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx(jz,{currentSpec:e,endpointsConfig:a})}),s.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[s.jsx("span",{className:"truncate text-left",children:e.label}),e.description&&s.jsx("span",{className:"break-words text-xs font-normal",children:e.description})]})]}),t&&s.jsx("div",{className:"flex-shrink-0 self-center",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},e.name)}function Iz({modelId:e,endpoint:t,isSelected:n}){var a,r,o,i;const{handleSelectModel:l}=Cz();let c=!1,d=e;const u=(null==(a=null==t?void 0:t.modelIcons)?void 0:a[e??""])||null;if(t&&e&&Lu(t.value)&&(null==(r=t.agentNames)?void 0:r[e])){d=t.agentNames[e];const n=null==(o=null==t?void 0:t.models)?void 0:o.find((t=>t.name===e));c=(null==n?void 0:n.isGlobal)??!1}else t&&e&&Mu(t.value)&&(null==(i=t.assistantNames)?void 0:i[e])&&(d=t.assistantNames[e]);return s.jsxs(Ez,{onClick:()=>l(t,e??""),className:"flex h-8 w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[u?s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:s.jsx("img",{src:u,alt:d??"",className:"h-full w-full object-cover"})}):(Lu(t.value)||Mu(t.value))&&t.icon?s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:t.icon}):null,s.jsx("span",{children:d})]}),c&&s.jsx(we,{className:"ml-auto size-4 text-green-400"}),n&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},e)}function Pz(e,t,n,a){return(a||t.map((e=>e.name))).map((t=>e&&s.jsx(Iz,{modelId:t,endpoint:e,isSelected:n===t},t)))}const Az=({endpoint:e,className:t,handleOpenKeyDialog:n})=>{const a=Uk()("com_endpoint_config_key");return s.jsx("button",{id:`endpoint-${e.value}-settings`,onClick:t=>{e.value&&(t.stopPropagation(),n(e.value,t))},className:s_("flex items-center overflow-visible text-text-primary transition-all duration-300 ease-in-out","group/button rounded-md px-1 hover:bg-surface-secondary focus:bg-surface-secondary",t),"aria-label":`${a} ${e.label}`,children:s.jsxs("div",{className:"flex w-[28px] items-center gap-1 whitespace-nowrap transition-all duration-300 ease-in-out group-hover:w-auto group-focus/button:w-auto",children:[s.jsx(ze,{className:"h-4 w-4 flex-shrink-0"}),s.jsx("span",{className:"max-w-0 overflow-hidden whitespace-nowrap opacity-0 transition-all duration-300 ease-in-out group-hover:max-w-[100px] group-hover:opacity-100 group-focus/button:max-w-[100px] group-focus/button:opacity-100",children:a})]})})};function Mz({endpoint:e}){const t=Uk(),{agentsMap:a,assistantsMap:r,selectedValues:o,handleOpenKeyDialog:i,handleSelectEndpoint:l,endpointSearchValues:c,setEndpointSearchValue:d,endpointRequiresUserKey:u}=Cz(),{model:m,endpoint:p}=o,f=c[e.value]||"",h=n.useMemo((()=>u(e.value)),[e.value]),g=()=>s.jsxs("div",{className:"flex items-center gap-2",children:[e.icon&&s.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:e.icon}),s.jsx("span",{className:s_("truncate text-left",h?"group-hover:w-24 group-focus:w-24":""),children:e.label}),"gptPlugins"===e.value&&s.jsx(Dl,{description:t("com_endpoint_deprecated_info"),"aria-label":t("com_endpoint_deprecated_info_a11y"),render:s.jsx("span",{className:"ml-2 rounded bg-amber-600/70 px-2 py-0.5 text-xs font-semibold text-white",children:t("com_endpoint_deprecated")})})]});if(e.hasModels){const n=f?function(e,t,n,s,a){const r=n.trim().toLowerCase();return r?t.filter((t=>{var n;let o=t;if(Lu(e.value)&&s&&s[t])o=(null==(n=s[t])?void 0:n.name)||t;else if(Mu(e.value)&&a&&a[e.value]){const n=a[e.value][t];o="string"==typeof n.name&&n.name?n.name:t}return o.toLowerCase().includes(r)})):t}(e,(e.models||[]).map((e=>e.name)),f,a,r):null,o=Lu(e.value)||Mu(e.value)?t("com_endpoint_search_var",{0:e.label}):t("com_endpoint_search_endpoint_models",{0:e.label});return s.jsx(Sz,{id:`endpoint-${e.value}-menu`,className:"transition-opacity duration-200 ease-in-out",defaultOpen:e.value===p,searchValue:f,onSearch:t=>d(e.value,t),combobox:s.jsx("input",{placeholder:o}),label:s.jsxs("div",{onClick:()=>l(e),className:"group flex w-full flex-shrink cursor-pointer items-center justify-between rounded-xl px-1 py-1 text-sm",children:[g(),h&&s.jsx(Az,{endpoint:e,handleOpenKeyDialog:i})]}),children:Mu(e.value)&&void 0===e.models?s.jsx("div",{className:"flex items-center justify-center p-2",children:s.jsx(rc,{})}):n?Pz(e,e.models||[],m,n):e.models&&Pz(e,e.models,m)},`endpoint-${e.value}-item`)}return s.jsx(Ez,{id:`endpoint-${e.value}-menu`,onClick:()=>l(e),className:"flex h-8 w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:s.jsxs("div",{className:"group flex w-full min-w-0 items-center justify-between",children:[g(),s.jsxs("div",{className:"flex items-center gap-2",children:[u(e.value)&&s.jsx(Az,{endpoint:e,handleOpenKeyDialog:i}),p===e.value&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})},`endpoint-${e.value}-item`)}function Lz(e){return e.map((e=>s.jsx(Mz,{endpoint:e},`endpoint-${e.value}-item`)))}function Oz({results:e,localize:t,searchValue:a}){const{selectedValues:r,handleSelectSpec:o,handleSelectModel:i,handleSelectEndpoint:l,endpointsConfig:c}=Cz(),{modelSpec:d,endpoint:u,model:m}=r;return e?e.length?s.jsx(s.Fragment,{children:e.map(((e,t)=>{if("name"in e&&"label"in e){const t=e;return s.jsxs(Ez,{onClick:()=>o(t),className:s_("flex w-full cursor-pointer justify-between rounded-lg px-2 text-sm",t.description?"items-start":"items-center"),children:[s.jsxs("div",{className:s_("flex w-full min-w-0 gap-2 px-1 py-1",t.description?"items-start":"items-center"),children:[(t.showIconInMenu??!0)&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx(jz,{currentSpec:t,endpointsConfig:c})}),s.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[s.jsx("span",{className:"truncate text-left",children:t.label}),t.description&&s.jsx("span",{className:"break-words text-xs font-normal",children:t.description})]})]}),d===t.name&&s.jsx("div",{className:s_("flex-shrink-0",t.description?"pt-1":""),children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},t.name)}{const r=e;if(r.hasModels&&r.models&&r.models.length>0){const e=a.toLowerCase(),o=r.label.toLowerCase().includes(e)?r.models:r.models.filter((t=>{let n=t.name;return Lu(r.value)&&r.agentNames&&r.agentNames[t.name]?n=r.agentNames[t.name]:Mu(r.value)&&r.assistantNames&&r.assistantNames[t.name]&&(n=r.assistantNames[t.name]),n.toLowerCase().includes(e)}));return o.length?s.jsxs(n.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-sm font-medium",children:[r.icon&&s.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full p-1",children:r.icon}),r.label]}),o.map((e=>{var n,a;const o=e.name;let l=!1,c=o;if(Lu(r.value)&&r.agentNames&&r.agentNames[o]){c=r.agentNames[o];const e=null==(n=null==r?void 0:r.models)?void 0:n.find((e=>e.name===o));l=(null==e?void 0:e.isGlobal)??!1}else Mu(r.value)&&r.assistantNames&&r.assistantNames[o]&&(c=r.assistantNames[o]);return s.jsxs(Ez,{onClick:()=>i(r,o),className:"flex w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 pl-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[(null==(a=r.modelIcons)?void 0:a[o])&&s.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:s.jsx("img",{src:r.modelIcons[o],alt:c,className:"h-full w-full object-cover"})}),s.jsx("span",{children:c})]}),l&&s.jsx(we,{className:"ml-auto size-4 text-green-400"}),u===r.value&&m===o&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`${r.value}-${o}-search-${t}`)}))]},`endpoint-${r.value}-search-${t}`):null}return s.jsxs(Ez,{onClick:()=>l(r),className:"flex w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[r.icon&&s.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full border border-gray-200 p-1 dark:border-gray-700",style:{borderRadius:"50%"},children:r.icon}),s.jsx("span",{children:r.label})]}),u===r.value&&s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`endpoint-${r.value}-search-item`)}}))}):s.jsx("div",{className:"cursor-default p-2 sm:py-1 sm:text-sm",children:t("com_files_no_results")}):null}function Dz(e,t,n){return s.jsx(Oz,{results:e,localize:t,searchValue:n},`search-results-${n}`)}const Fz=[{value:"screenshot",label:"screenshot (.png)"},{value:"text",label:"text (.txt)"},{value:"markdown",label:"markdown (.md)"},{value:"json",label:"json (.json)"},{value:"csv",label:"csv (.csv)"}];function zz({open:e,onOpenChange:t,conversation:a,triggerRef:r,children:o}){const i=Uk(),[l,c]=n.useState(""),[d,u]=n.useState("screenshot"),[m,p]=n.useState(!0),[f,h]=n.useState(!1),[g,x]=n.useState(!0);n.useEffect((()=>{!e&&r&&r.current&&r.current.focus()}),[e,r]),n.useEffect((()=>{c(Je(String((null==a?void 0:a.title)??"file"))),u("screenshot"),p(!0),h(!1),x(!0)}),[null==a?void 0:a.title,e]);const v=n.useCallback((e=>{const t="csv"!==e&&"screenshot"!==e;h("json"===e||"csv"===e||"webpage"===e),p(t),u(e)}),[]),b=n.useMemo((()=>"json"===d||"csv"===d||"webpage"===d),[d]),_=n.useMemo((()=>"csv"!==d&&"screenshot"!==d),[d]),{exportConversation:y}=jT({conversation:a,filename:Je(l),type:d,includeOptions:m,exportBranches:f,recursive:g});return s.jsxs(ml,{open:e,onOpenChange:t,triggerRef:r,children:[o,s.jsx(Ud,{title:i("com_nav_export_conversation"),className:"max-w-full sm:max-w-2xl",main:s.jsxs("div",{className:"flex w-full flex-col items-center gap-6",children:[s.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[s.jsxs("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:[s.jsx(ul,{htmlFor:"filename",className:"text-left text-sm font-medium",children:i("com_nav_export_filename")}),s.jsx(cl,{id:"filename",value:l,onChange:e=>c(e.target.value||""),placeholder:i("com_nav_export_filename_placeholder")})]}),s.jsxs("div",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",children:[s.jsx(ul,{htmlFor:"type",className:"text-left text-sm font-medium",children:i("com_nav_export_type")}),s.jsx(od,{value:d,onChange:v,options:Fz,className:"z-50",portal:!1})]})]}),s.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[s.jsx("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"includeOptions",className:"text-left text-sm font-medium",children:i("com_nav_export_include_endpoint_options")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Ti,{id:"includeOptions",disabled:!_,checked:m,onCheckedChange:p}),s.jsx("label",{htmlFor:"includeOptions",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i(_?"com_nav_enabled":"com_nav_not_supported")})]})]})}),s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"exportBranches",className:"text-left text-sm font-medium",children:i("com_nav_export_all_message_branches")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Ti,{id:"exportBranches",disabled:!b,checked:f,onCheckedChange:h}),s.jsx("label",{htmlFor:"exportBranches",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i(b?"com_nav_enabled":"com_nav_not_supported")})]})]}),"json"===d?s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx(ul,{htmlFor:"recursive",className:"text-left text-sm font-medium",children:i("com_nav_export_recursive_or_sequential")}),s.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[s.jsx(Ti,{id:"recursive",checked:g,onCheckedChange:x}),s.jsx("label",{htmlFor:"recursive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:i("com_nav_export_recursive")})]})]}):null]})]}),buttons:s.jsx(s.Fragment,{children:s.jsx(Si,{onClick:y,variant:"submit",children:i("com_endpoint_export")})}),selection:void 0})]})}const Uz={isArchived:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function Vz({onOpenChange:e}){const t=Uk(),a=Wi("(max-width: 768px)"),{showToast:r}=$d(),o=Ae(Cy.search),[i,l]=n.useState(!1),[c,d]=n.useState(Uz),[u,m]=n.useState(null),{data:p,fetchNextPage:f,hasNextPage:h,isFetchingNextPage:g,refetch:x,isLoading:v}=pj(c,{staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),b=n.useCallback(((e,t)=>{d((n=>({...n,sortBy:e,sortDirection:t})))}),[]),_=n.useCallback((e=>{const t=encodeURIComponent(e.trim());d((e=>({...e,search:t})))}),[]),y=n.useMemo((()=>ko(_,300)),[_]);n.useEffect((()=>()=>{y.cancel()}),[y]);const j=n.useMemo((()=>(null==p?void 0:p.pages)?p.pages.flatMap((e=>{var t;return(null==(t=null==e?void 0:e.conversations)?void 0:t.filter(Boolean))??[]})):[]),[null==p?void 0:p.pages]),w=Sj({onSuccess:async()=>{l(!1),await x()},onError:e=>{r({message:t("com_ui_archive_delete_error"),severity:jv.ERROR})}}),N=yj({onSuccess:async()=>{await x()},onError:e=>{r({message:t("com_ui_unarchive_error"),severity:jv.ERROR})}}),C=n.useCallback((async()=>{h&&!g&&await f()}),[f,h,g]),k=n.useMemo((()=>[{accessorKey:"title",header:()=>{const e="title"===c.sortBy,n=c.sortDirection;return s.jsxs(Si,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("title",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_name"),e&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{conversationId:t,title:n}=e.original;return s.jsxs("button",{type:"button",className:"flex items-center gap-2 truncate",onClick:()=>window.open(`/c/${t}`,"_blank"),children:[s.jsx(ZR,{endpoint:e.original.endpoint,size:28,isCreatedByUser:!1,iconClassName:"size-4"}),s.jsx("span",{className:"underline",children:n})]})},meta:{size:a?"70%":"50%",mobileSize:"70%"}},{accessorKey:"createdAt",header:()=>{const e="createdAt"===c.sortBy,n=c.sortDirection;return s.jsxs(Si,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("createdAt",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_created_at"),e&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Ov((null==(t=e.original.createdAt)?void 0:t.toString())??"",a)},meta:{size:a?"30%":"35%",mobileSize:"30%"}},{accessorKey:"actions",header:()=>s.jsx(ul,{className:"px-2 py-0 text-xs sm:px-2 sm:py-2 sm:text-sm",children:t("com_assistants_actions")}),cell:({row:e})=>{const n=e.original;return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Dl,{description:t("com_ui_unarchive"),render:s.jsx(Si,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>N.mutate({conversationId:n.conversationId,isArchived:!1}),title:t("com_ui_unarchive"),disabled:N.isLoading,children:N.isLoading?s.jsx(rc,{}):s.jsx(vs,{className:"size-4"})})}),s.jsx(Dl,{description:t("com_ui_delete"),render:s.jsx(Si,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{m(e.original),l(!0)},title:t("com_ui_delete"),children:s.jsx(Zn,{className:"size-4"})})})]})},meta:{size:"15%",mobileSize:"25%"}}]),[b,a,t,c,N]);return s.jsxs(s.Fragment,{children:[s.jsx(fd,{columns:k,data:j,filterColumn:"title",onFilterChange:y,filterValue:c.search,fetchNextPage:C,hasNextPage:h,isFetchingNextPage:g,isLoading:v,showCheckboxes:!1,enableSearch:o}),s.jsx(ml,{open:i,onOpenChange:e,children:s.jsxs(xl,{title:t("com_ui_delete_confirm")+" "+((null==u?void 0:u.title)??""),className:"w-11/12 max-w-md",children:[s.jsx(vl,{children:s.jsxs(_l,{children:[t("com_ui_delete_confirm")," ",s.jsx("strong",{children:null==u?void 0:u.title})]})}),s.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[s.jsx(Si,{"aria-label":"cancel",variant:"outline",onClick:()=>l(!1),children:t("com_ui_cancel")}),s.jsx(Si,{variant:"destructive",onClick:()=>w.mutate({conversationId:(null==u?void 0:u.conversationId)??""}),disabled:w.isLoading,children:w.isLoading?s.jsx(rc,{}):t("com_ui_delete")})]})]})})]})}function Bz(){const e=Uk(),[t,a]=n.useState(!1);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_archived_chats")}),s.jsxs(ml,{open:t,onOpenChange:a,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"outline","aria-label":"Archived chats",children:e("com_ui_manage")})}),s.jsx(Ud,{title:e("com_nav_archived_chats"),className:"max-w-[1000px]",showCancelButton:!1,main:s.jsx(Vz,{isOpen:t,onOpenChange:a})})]})]})}const $z=({stateAtom:e,localizationKey:t,hoverCardText:n,switchId:a,onCheckedChange:r})=>{const[o,i]=Ie(e),l=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:l(t)}),n&&s.jsx(Ld,{side:Oi.Bottom,text:l(n)})]}),s.jsx(kl,{id:a,checked:o,onCheckedChange:e=>{i(e),null==r||r(e)},className:"ml-4","data-testid":a})]})},Hz=[{stateAtom:Cy.enableUserMsgMarkdown,localizationKey:"com_nav_user_msg_markdown",switchId:"enableUserMsgMarkdown",hoverCardText:void 0,key:"enableUserMsgMarkdown"},{stateAtom:Cy.autoScroll,localizationKey:"com_nav_auto_scroll",switchId:"autoScroll",hoverCardText:void 0,key:"autoScroll"},{stateAtom:Cy.hideSidePanel,localizationKey:"com_nav_hide_panel",switchId:"hideSidePanel",hoverCardText:void 0,key:"hideSidePanel"}],Gz=({theme:e,onChange:t})=>{const n=Uk(),a=[{value:"system",label:n("com_nav_theme_system")},{value:"dark",label:n("com_nav_theme_dark")},{value:"light",label:n("com_nav_theme_light")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_theme")}),s.jsx(od,{value:e,onChange:t,options:a,sizeClasses:"w-[180px]",testId:"theme-selector",className:"z-50"})]})},Kz=({langcode:e,onChange:t})=>{const n=Uk(),a=[{value:"auto",label:n("com_nav_lang_auto")},{value:"en-US",label:n("com_nav_lang_english")},{value:"zh-Hans",label:n("com_nav_lang_chinese")},{value:"zh-Hant",label:n("com_nav_lang_traditional_chinese")},{value:"ar-EG",label:n("com_nav_lang_arabic")},{value:"bs",label:n("com_nav_lang_bosnian")},{value:"da-DK",label:n("com_nav_lang_danish")},{value:"de-DE",label:n("com_nav_lang_german")},{value:"es-ES",label:n("com_nav_lang_spanish")},{value:"ca-ES",label:n("com_nav_lang_catalan")},{value:"et-EE",label:n("com_nav_lang_estonian")},{value:"fa-IR",label:n("com_nav_lang_persian")},{value:"fr-FR",label:n("com_nav_lang_french")},{value:"he-HE",label:n("com_nav_lang_hebrew")},{value:"hu-HU",label:n("com_nav_lang_hungarian")},{value:"hy-AM",label:n("com_nav_lang_armenian")},{value:"it-IT",label:n("com_nav_lang_italian")},{value:"nb",label:n("com_nav_lang_norwegian_bokmal")},{value:"pl-PL",label:n("com_nav_lang_polish")},{value:"pt-BR",label:n("com_nav_lang_brazilian_portuguese")},{value:"pt-PT",label:n("com_nav_lang_portuguese")},{value:"ru-RU",label:n("com_nav_lang_russian")},{value:"ja-JP",label:n("com_nav_lang_japanese")},{value:"ka-GE",label:n("com_nav_lang_georgian")},{value:"cs-CZ",label:n("com_nav_lang_czech")},{value:"sv-SE",label:n("com_nav_lang_swedish")},{value:"ko-KR",label:n("com_nav_lang_korean")},{value:"lv-LV",label:n("com_nav_lang_latvian")},{value:"vi-VN",label:n("com_nav_lang_vietnamese")},{value:"th-TH",label:n("com_nav_lang_thai")},{value:"tr-TR",label:n("com_nav_lang_turkish")},{value:"ug",label:n("com_nav_lang_uyghur")},{value:"nl-NL",label:n("com_nav_lang_dutch")},{value:"id-ID",label:n("com_nav_lang_indonesia")},{value:"fi-FI",label:n("com_nav_lang_finnish")},{value:"sl",label:n("com_nav_lang_slovenian")},{value:"bo",label:n("com_nav_lang_tibetan")},{value:"uk-UA",label:n("com_nav_lang_ukrainian")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_language")}),s.jsx(od,{value:e,onChange:t,sizeClasses:"[--anchor-max-height:256px]",options:a,className:"z-50"})]})};const Wz=S.memo((function(){const{theme:e,setTheme:t}=n.useContext(Rd),[a,r]=Ie(Cy.lang),o=n.useCallback((e=>{t(e)}),[t]),i=n.useCallback((e=>{let t=e;"auto"===e&&(t=navigator.language||navigator.languages[0]),requestAnimationFrame((()=>{document.documentElement.lang=t})),r(t),Me.set("lang",t,{expires:365})}),[r]);return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Gz,{theme:e,onChange:o})}),s.jsx("div",{className:"pb-3",children:s.jsx(Kz,{langcode:a,onChange:i})}),Hz.map((e=>s.jsx("div",{className:"pb-3",children:s.jsx($z,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),s.jsx("div",{className:"pb-3",children:s.jsx(Bz,{})})]})}));function qz(){const[e,t]=Ie(Cy.fontSize),n=Uk(),a=[{value:"text-xs",label:n("com_nav_font_size_xs")},{value:"text-sm",label:n("com_nav_font_size_sm")},{value:"text-base",label:n("com_nav_font_size_base")},{value:"text-lg",label:n("com_nav_font_size_lg")},{value:"text-xl",label:n("com_nav_font_size_xl")}];return s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsx("div",{children:n("com_nav_font_size")}),s.jsx(od,{value:e,options:a,onChange:e=>{t(e),ui(e)},testId:"font-size-selector",sizeClasses:"w-[150px]",className:"z-50"})]})}const Qz=()=>{const e=Uk(),[t,n]=Ie(Cy.forkSetting),[a,r]=Ie(Cy.splitAtTarget),[o,i]=Ie(Cy.rememberDefaultFork),l=[{value:mh.DIRECT_PATH,label:e("com_ui_fork_visible")},{value:mh.INCLUDE_BRANCHES,label:e("com_ui_fork_branches")},{value:mh.TARGET_LEVEL,label:e("com_ui_fork_all_target")}];return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[" ",e("com_ui_fork_default")," "]}),s.jsx(kl,{id:"rememberDefaultFork",checked:o,onCheckedChange:i,className:"ml-4","data-testid":"rememberDefaultFork"})]})}),o&&s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:e("com_ui_fork_change_default")}),s.jsx(Ld,{side:Oi.Bottom,text:e("com_nav_info_fork_change_default")})]}),s.jsx(od,{value:t,onChange:n,options:l,sizeClasses:"w-[200px]",testId:"fork-setting-dropdown",className:"z-[50]"})]})}),s.jsx("div",{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{children:e("com_ui_fork_split_target_setting")}),s.jsx(Ld,{side:Oi.Bottom,text:e("com_nav_info_fork_split_target_setting")})]}),s.jsx(kl,{id:"splitAtTarget",checked:a,onCheckedChange:r,className:"ml-4","data-testid":"splitAtTarget"})]})})]})},Yz=()=>{const[e,t]=Ie(Cy.chatDirection),n=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx("span",{id:"chat-direction-label",children:n("com_nav_chat_direction")})}),s.jsxs(Si,{variant:"outline","aria-label":"Toggle chat direction",onClick:()=>{t((e=>"LTR"===e?"RTL":"LTR"))},"data-testid":"chatDirection",children:[s.jsx("span",{"aria-hidden":"true",children:e.toLowerCase()}),s.jsx("span",{id:"chat-direction-status",className:"sr-only",children:n("LTR"===e?"chat_direction_left_to_right":"chat_direction_right_to_left")})]})]})},Xz=[{stateAtom:Cy.enterToSend,localizationKey:"com_nav_enter_to_send",switchId:"enterToSend",hoverCardText:"com_nav_info_enter_to_send",key:"enterToSend"},{stateAtom:Cy.maximizeChatSpace,localizationKey:"com_nav_maximize_chat_space",switchId:"maximizeChatSpace",hoverCardText:void 0,key:"maximizeChatSpace"},{stateAtom:Cy.centerFormOnLanding,localizationKey:"com_nav_center_chat_input",switchId:"centerFormOnLanding",hoverCardText:void 0,key:"centerFormOnLanding"},{stateAtom:Cy.showThinking,localizationKey:"com_nav_show_thinking",switchId:"showThinking",hoverCardText:void 0,key:"showThinking"},{stateAtom:Cy.showCode,localizationKey:"com_nav_show_code",switchId:"showCode",hoverCardText:void 0,key:"showCode"},{stateAtom:Cy.LaTeXParsing,localizationKey:"com_nav_latex_parsing",switchId:"latexParsing",hoverCardText:"com_nav_info_latex_parsing",key:"latexParsing"},{stateAtom:Cy.saveDrafts,localizationKey:"com_nav_save_drafts",switchId:"saveDrafts",hoverCardText:"com_nav_info_save_draft",key:"saveDrafts"},{stateAtom:Cy.showScrollButton,localizationKey:"com_nav_scroll_button",switchId:"showScrollButton",hoverCardText:void 0,key:"showScrollButton"},{stateAtom:Cy.saveBadgesState,localizationKey:"com_nav_save_badges_state",switchId:"showBadges",hoverCardText:"com_nav_info_save_badges_state",key:"showBadges"},{stateAtom:Cy.modularChat,localizationKey:"com_nav_modular_chat",switchId:"modularChat",hoverCardText:void 0,key:"modularChat"}];const Zz=n.memo((function(){return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(qz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(Yz,{})}),Xz.map((e=>s.jsx("div",{className:"pb-3",children:s.jsx($z,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),s.jsx(Qz,{})]})}));function Jz(){const e=Uk(),t=n.useRef(null),{showToast:a}=$d(),[,r]=n.useState([]),[o,i]=n.useState(!0),l=e=>r((t=>[...t,e])),c=Tj({onSuccess:()=>{a({message:e("com_ui_import_conversation_success")}),i(!0)},onError:t=>{var n,s;console.error("Error: ",t),i(!0),l((null==(s=null==(n=t.response)?void 0:n.data)?void 0:s.message)??"An error occurred while uploading the file."),!0===(null==t?void 0:t.toString().includes("Unsupported import type"))?a({message:e("com_ui_import_conversation_file_type_error"),status:"error"}):a({message:e("com_ui_import_conversation_error"),status:"error"})},onMutate:()=>{i(!1)}}),d=async e=>{try{await(async e=>{const t=new FormData;t.append("file",e,encodeURIComponent(e.name||"File")),c.mutate(t)})(e)}catch(t){console.log("file handling error",t),l("An error occurred while processing the file.")}},u=()=>{var e;null==(e=t.current)||e.click()};return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_ui_import_conversation_info")}),s.jsxs("button",{onClick:u,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),u())},disabled:!o,"aria-label":e("com_ui_import"),className:"btn btn-neutral relative",children:[o?s.jsx(bs,{className:"mr-1 flex h-4 w-4 items-center stroke-1"}):s.jsx(rc,{className:"mr-1 w-4"}),s.jsx("span",{children:e("com_ui_import")})]}),s.jsx("input",{ref:t,type:"file",className:s_("hidden"),accept:".json",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];n&&d(n)},"aria-hidden":"true"})]})}const eU=({endpoint:e="",all:t=!1,disabled:a=!1,setDialogOpen:r})=>{const o=Uk(),[i,l]=n.useState(!1),c=mk(e),d=pk(),u=()=>{r&&r(!1)},m=t?o("com_ui_revoke_keys"):o("com_ui_revoke_key_endpoint",{0:e}),p=o(t?"com_ui_revoke_keys_confirm":"com_ui_revoke_key_confirm"),f=c.isLoading||d.isLoading;return s.jsxs(ml,{open:i,onOpenChange:l,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>l(!0),disabled:a,children:o("com_ui_revoke")})}),s.jsx(Ud,{showCloseButton:!1,title:m,className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:p}),selection:{selectHandler:()=>{t?d.mutate({}):c.mutate({},{onSuccess:u})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:f?s.jsx(rc,{}):o("com_ui_revoke")}})]})},tU=()=>{const e=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ul,{className:"font-light",children:e("com_ui_revoke_info")}),s.jsx(eU,{all:!0})]})},nU=({disabled:e=!1})=>{const t=Uk(),[a,r]=n.useState(!1),[o,i]=n.useState(!0),[l,c]=n.useState(!1),[d,u]=n.useState(!1);qi(n.useRef(null),(()=>l&&c(!1)),[]);const m=n.useCallback((async()=>{const e=await caches.open("tts-responses"),t=await e.keys();i(0===t.length)}),[]);n.useEffect((()=>{m()}),[m]);const p=n.useCallback((async()=>{u(!0);const e=await caches.open("tts-responses");await e.keys().then((t=>Promise.all(t.map((t=>e.delete(t)))))),u(!1)}),[]);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ul,{className:"font-light",children:t("com_nav_delete_cache_storage")}),s.jsxs(ml,{open:a,onOpenChange:r,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>r(!0),disabled:e||o,children:t("com_ui_delete")})}),s.jsx(Ud,{showCloseButton:!1,title:t("com_nav_confirm_clear"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:t("com_nav_clear_cache_confirm_message")}),selection:{selectHandler:p,selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:d?s.jsx(rc,{}):t("com_ui_delete")}})]})]})},sU=()=>{const e=Uk(),[t,a]=n.useState(!1),{newConversation:r}=lT(),o=uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ul,{className:"font-light",children:e("com_nav_clear_all_chats")}),s.jsxs(ml,{open:t,onOpenChange:a,children:[s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>a(!0),children:e("com_ui_delete")})}),s.jsx(Ud,{showCloseButton:!1,title:e("com_nav_confirm_clear"),className:"max-w-[450px]",main:s.jsx(ul,{className:"text-left text-sm font-medium",children:e("com_nav_clear_conversation_confirm_message")}),selection:{selectHandler:()=>{o.mutate({},{onSuccess:()=>{Vb(),r()}})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:o.isLoading?s.jsx(rc,{}):e("com_ui_delete")}})]})]})},aU={pageSize:25,isPublic:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function rU(){const e=Uk(),{showToast:t}=$d(),a=Wi("(max-width: 768px)"),r=Ae(Cy.search),[o,i]=n.useState(aU),[l,c]=n.useState(null),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{data:f,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:x,refetch:v,isLoading:b}=fj(o,{enabled:m,staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),_=n.useCallback(((e,t)=>{i((n=>({...n,sortBy:e,sortDirection:t})))}),[]),y=n.useCallback((e=>{const t=encodeURIComponent(e.trim());i((e=>({...e,search:t})))}),[]),j=n.useMemo((()=>ko(y,300)),[y]);n.useEffect((()=>()=>{j.cancel()}),[j]);const w=n.useMemo((()=>(null==f?void 0:f.pages)?f.pages.flatMap((e=>e.links.filter(Boolean))):[]),[null==f?void 0:f.pages]),N=Nj({onSuccess:async()=>{u(!1),c(null),await v()}}),C=n.useCallback((async n=>{const s=n.filter((e=>"string"==typeof e.shareId&&e.shareId.length>0));if(0!==s.length)try{for(const e of s)await N.mutateAsync({shareId:e.shareId});t({message:e(1===s.length?"com_ui_shared_link_delete_success":"com_ui_shared_link_bulk_delete_success"),severity:jv.SUCCESS})}catch(a){console.error("Failed to delete shared links:",a),t({message:e("com_ui_bulk_delete_error"),severity:jv.ERROR})}else t({message:e("com_ui_no_valid_items"),severity:jv.WARNING})}),[N,t,e]),k=n.useCallback((async()=>{!0!==g||x||await h()}),[h,g,x]),S=n.useCallback((()=>{l&&C([l]),u(!1)}),[l,C]),T=n.useMemo((()=>[{accessorKey:"title",header:()=>{const t="title"===o.sortBy,n=o.sortDirection;return s.jsxs(Si,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>_("title",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_name"),t&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{title:t,shareId:n}=e.original;return s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(As,{to:`/share/${n}`,target:"_blank",rel:"noopener noreferrer",className:"block truncate text-blue-500 hover:underline",title:t,children:t})})},meta:{size:"35%",mobileSize:"50%"}},{accessorKey:"createdAt",header:()=>{const t="createdAt"===o.sortBy,n=o.sortDirection;return s.jsxs(Si,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>_("createdAt",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_date"),t&&"asc"===n&&s.jsx(gs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&s.jsx(xs,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&s.jsx(_n,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Ov((null==(t=e.original.createdAt)?void 0:t.toString())??"",a)},meta:{size:"10%",mobileSize:"20%"}},{accessorKey:"actions",header:()=>s.jsx(ul,{className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",children:e("com_assistants_actions")}),meta:{size:"7%",mobileSize:"25%"},cell:({row:t})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Dl,{description:e("com_ui_view_source"),render:s.jsx(Si,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{window.open(`/c/${t.original.conversationId}`,"_blank")},title:e("com_ui_view_source"),children:s.jsx(_s,{className:"size-4"})})}),s.jsx(Dl,{description:e("com_ui_delete"),render:s.jsx(Si,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{c(t.original),u(!0)},title:e("com_ui_delete"),children:s.jsx(Zn,{className:"size-4"})})})]})}]),[a,e,o,_]);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_shared_links")}),s.jsxs(ml,{open:m,onOpenChange:p,children:[s.jsx(pl,{asChild:!0,onClick:()=>p(!0),children:s.jsx(Si,{variant:"outline",children:e("com_ui_manage")})}),s.jsxs(xl,{title:e("com_nav_my_files"),className:"w-11/12 max-w-5xl bg-background text-text-primary shadow-2xl",children:[s.jsx(vl,{children:s.jsx(_l,{children:e("com_nav_shared_links")})}),s.jsx(fd,{columns:T,data:w,onDelete:C,filterColumn:"title",hasNextPage:g,isFetchingNextPage:x,fetchNextPage:k,showCheckboxes:!1,onFilterChange:j,filterValue:o.search,isLoading:b,enableSearch:r})]})]}),s.jsx(ml,{open:d,onOpenChange:u,children:s.jsx(Ud,{showCloseButton:!1,title:e("com_ui_delete_shared_link"),className:"max-w-[450px]",main:s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:s.jsx("div",{className:"grid w-full items-center gap-2",children:s.jsxs(ul,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[e("com_ui_delete_confirm")," ",s.jsx("strong",{children:null==l?void 0:l.title})]})})})}),selection:{selectHandler:S,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white "+(N.isLoading?"cursor-not-allowed opacity-80":""),selectText:N.isLoading?s.jsx(rc,{}):e("com_ui_delete")}})})]})}const oU=S.memo((function(){const e=n.useRef(null),[t,a]=n.useState(!1);return qi(e,(()=>t&&a(!1)),[]),s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(Jz,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(rU,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(tU,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(nU,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(sU,{})})]})}));function iU(){const[e,t]=Ie(Cy.slashCommand),n=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_slash_command_description")}),s.jsx(kl,{id:"slashCommand",checked:e,onCheckedChange:e=>{t(e)},"data-testid":"slashCommand"})]})}function lU(){const[e,t]=Ie(Cy.plusCommand),n=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_plus_command_description")}),s.jsx(kl,{id:"plusCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"plusCommand"})]})}function cU(){const[e,t]=Ie(Cy.atCommand),n=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:n("com_nav_at_command_description")}),s.jsx(kl,{id:"atCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"atCommand"})]})}const dU=n.memo((function(){const e=Uk(),t=Qk({permissionType:Zh.PROMPTS,permission:Jh.USE}),n=Qk({permissionType:Zh.MULTI_CONVO,permission:Jh.USE});return s.jsxs("div",{className:"space-y-4 p-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary",children:e("com_nav_chat_commands")}),s.jsx(Ld,{side:Oi.Bottom,text:e("com_nav_chat_commands_info")})]}),s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(cU,{})}),!0===n&&s.jsx("div",{className:"pb-3",children:s.jsx(lU,{})}),!0===t&&s.jsx("div",{className:"pb-3",children:s.jsx(iU,{})})]})]})}));function uU(){const e=Uk(),[t,n]=Ie(Cy.UsernameDisplay);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ul,{className:"font-light",children:e("com_nav_user_name_display")}),s.jsx(Ld,{side:Oi.Bottom,text:e("com_nav_info_user_name_display")})]}),s.jsx(kl,{id:"UsernameDisplay",checked:t,onCheckedChange:e=>{n(e)},className:"ml-4","data-testid":"UsernameDisplay"})]})}const mU=({disabled:e=!1})=>{const t=Uk(),{user:a,logout:r}=qk(),{mutate:o,isLoading:i}=(e=>{const t=pr(),n=Ey(),s=Oe(Cy.defaultPreset);return fr([ax.deleteUser],{mutationFn:()=>fx.deleteUser(),...e||{},onSuccess:(...a)=>{var r;s(),n(),Vb(),t.removeQueries(),null==(r=null==e?void 0:e.onSuccess)||r.call(e,...a)}})})({onMutate:()=>r()}),[l,c]=n.useState(!1),[d,u]=n.useState(!0),m=n.useCallback((e=>{const t=e.trim().toLowerCase()===(null==a?void 0:a.email.trim().toLowerCase());u(!t)}),[null==a?void 0:a.email]);return s.jsx(s.Fragment,{children:s.jsxs(ml,{open:l,onOpenChange:c,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:t("com_nav_delete_account")}),s.jsx(pl,{asChild:!0,children:s.jsx(Si,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>c(!0),disabled:e,children:t("com_ui_delete")})})]}),s.jsxs(xl,{className:"w-11/12 max-w-md",children:[s.jsx(vl,{children:s.jsx(_l,{className:"text-lg font-medium leading-6",children:t("com_nav_delete_account_confirm")})}),s.jsx("div",{className:"mb-8 text-sm text-black dark:text-white",children:s.jsxs("ul",{className:"font-semibold text-amber-600",children:[s.jsx("li",{children:t("com_nav_delete_warning")}),s.jsx("li",{children:t("com_nav_delete_data_info")})]})}),s.jsxs("div",{className:"flex-col items-center justify-center",children:[s.jsx("div",{className:"mb-4",children:pU(t("com_nav_delete_account_email_placeholder"),"email-confirm-input",(null==a?void 0:a.email)??"",(e=>m(e.target.value)))}),fU((()=>{d||o(void 0)}),i,d,t)]})]})]})})},pU=(e,t,n,a)=>s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"mb-1 block text-sm font-medium text-black dark:text-white",htmlFor:t,children:e}),s.jsx(cl,{id:t,onChange:a,placeholder:n})]}),fU=(e,t,n,a)=>s.jsx("button",{className:s_("mt-4 flex w-full items-center justify-center rounded-lg bg-surface-tertiary px-4 py-2 transition-all duration-200",n?"cursor-not-allowed opacity-30":"bg-destructive text-destructive-foreground"),onClick:e,disabled:t||n,children:t?s.jsx("div",{className:"flex h-6 justify-center",children:s.jsx(rc,{className:"icon-sm m-auto"})}):s.jsx(s.Fragment,{children:n?s.jsxs(s.Fragment,{children:[s.jsx(ys,{className:"size-5"}),s.jsx("span",{className:"ml-2",children:a("com_ui_locked")})]}):s.jsxs(s.Fragment,{children:[s.jsx(Zn,{className:"size-5"}),s.jsx("span",{className:"ml-2",children:a("com_nav_delete_account_button")})]})})});function hU(){const e=Pe(Cy.user),[t,a]=n.useState(1),[r,o]=n.useState(0),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(null),[m,p]=n.useState(!1),{data:f=Gm}=Xy({select:e=>Ym(e)}),h=Uk(),{showToast:g}=$d(),{mutate:x,isLoading:v}=Ej({onSuccess:t=>{var n;g({message:h("com_ui_upload_success")}),e((e=>({...e,avatar:t.url}))),null==(n=c.current)||n.click()},onError:e=>{console.error("Error:",e),g({message:h("com_ui_upload_error"),status:"error"})}}),b=e=>{if(null!=f.avatarSizeLimit&&e&&e.size<=f.avatarSizeLimit)u(e),a(1),o(0);else{const e=null!=f.avatarSizeLimit?Fv(f.avatarSizeLimit):2;g({message:h("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}},_=n.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.files[0];b(t)}),[]),y=n.useCallback((e=>{e.preventDefault()}),[]),j=n.useCallback((()=>{u(null),a(1),o(0)}),[]);return s.jsxs(ml,{open:m,onOpenChange:e=>{p(e),e||(j(),setTimeout((()=>{var e;null==(e=c.current)||e.focus()}),0))},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:h("com_nav_profile_picture")}),s.jsx(pl,{ref:c,children:s.jsxs(Si,{variant:"outline",children:[s.jsx(js,{className:"mr-2 flex w-[22px] items-center stroke-1"}),s.jsx("span",{children:h("com_nav_change_picture")})]})})]}),s.jsxs(xl,{className:"w-11/12 max-w-sm",style:{borderRadius:"12px"},children:[s.jsx(vl,{children:s.jsx(_l,{className:"text-lg font-medium leading-6 text-text-primary",children:h(null!=d?"com_ui_preview":"com_ui_upload_image")})}),s.jsx("div",{className:"flex flex-col items-center justify-center",children:null!=d?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"relative overflow-hidden rounded-full",children:s.jsx(ws,{ref:i,image:d,width:250,height:250,border:0,borderRadius:125,color:[255,255,255,.6],scale:t,rotate:r})}),s.jsxs("div",{className:"mt-4 flex w-full flex-col items-center space-y-4",children:[s.jsxs("div",{className:"flex w-full items-center justify-center space-x-4",children:[s.jsx("span",{className:"text-sm",children:h("com_ui_zoom")}),s.jsx(jl,{value:[t],min:1,max:5,step:.001,onValueChange:e=>{a(e[0])},className:"w-2/3 max-w-xs"})]}),s.jsx("button",{onClick:()=>{o((e=>(e+90)%360))},className:"rounded-full bg-gray-200 p-2 transition-colors hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:s.jsx(Qn,{className:"h-5 w-5"})})]}),s.jsxs(Si,{className:s_("btn btn-primary mt-4 flex w-full hover:bg-green-600",v?"cursor-not-allowed opacity-90":""),onClick:()=>{if(i.current){i.current.getImageScaledToCanvas().toBlob((e=>{if(e){const t=new FormData;t.append("file",e,"avatar.png"),t.append("manual","true"),x(t)}}),"image/png")}},disabled:v,children:[v?s.jsx(rc,{className:"icon-sm mr-2"}):s.jsx(Ns,{className:"mr-2 h-5 w-5"}),h("com_ui_upload")]})]}):s.jsxs("div",{className:"flex h-64 w-11/12 flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-transparent dark:border-gray-600",onDrop:_,onDragOver:y,children:[s.jsx(js,{className:"mb-4 size-12 text-gray-400"}),s.jsx("p",{className:"mb-2 text-center text-sm text-gray-500 dark:text-gray-400",children:h("com_ui_drag_drop")}),s.jsx(Si,{variant:"secondary",onClick:()=>{var e;null==(e=l.current)||e.click()},children:h("com_ui_select_file")}),s.jsx("input",{ref:l,type:"file",className:"hidden",accept:".png, .jpg, .jpeg",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];b(n)}})]})})]})]})}const gU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},xU=({backupCodes:e,onDownload:t,downloaded:n,onNext:a})=>{const r=Uk();return s.jsxs(oo.div,{...gU,className:"space-y-6",children:[s.jsx(ul,{className:"break-keep text-sm",children:r("com_ui_download_backup_tooltip")}),s.jsx("div",{className:"grid grid-cols-2 gap-4 rounded-xl bg-surface-secondary p-6",children:e.map(((e,t)=>s.jsx(oo.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"rounded-lg bg-surface-tertiary p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"hidden text-sm text-text-secondary sm:inline",children:["#",t+1]}),s.jsx("span",{className:"font-mono text-lg",children:e})]})},e)))}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs(Si,{variant:"outline",onClick:t,className:"flex-1 gap-2",children:[s.jsx(On,{className:"h-4 w-4"}),s.jsx("span",{className:"hidden sm:inline",children:r("com_ui_download_backup")})]}),s.jsx(Si,{onClick:a,disabled:!n,className:"flex-1",children:r("com_ui_complete_setup")})]})]})},vU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},bU=({secret:e,otpauthUrl:t,onNext:a})=>{const r=Uk(),[o,i]=n.useState(!1);return s.jsxs(oo.div,{...vU,className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[s.jsx(oo.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"rounded-2xl bg-white p-4 shadow-lg",children:s.jsx(qo,{value:t,size:240})}),s.jsxs("div",{className:"w-full space-y-3",children:[s.jsx(ul,{className:"text-sm font-medium text-text-secondary",children:r("com_ui_secret_key")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(cl,{value:e,readOnly:!0,className:"font-mono text-lg tracking-wider"}),s.jsx(Si,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(e),i(!0),setTimeout((()=>i(!1)),2e3)},className:s_("h-auto shrink-0",o?"cursor-default":""),children:o?s.jsx(es,{className:"size-4"}):s.jsx(ht,{className:"size-4"})})]})]})]}),s.jsx(Si,{onClick:a,className:"w-full",children:r("com_ui_continue")})]})},_U={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},yU=({token:e,onTokenChange:t,isVerifying:n,onNext:a})=>{const r=Uk();return s.jsxs(oo.div,{..._U,className:"space-y-8",children:[s.jsx("div",{className:"flex justify-center",children:s.jsxs(zl,{value:e,onChange:t,maxLength:6,pattern:dt,className:"gap-2",children:[s.jsx(Ul,{children:Array.from({length:3}).map(((e,t)=>s.jsx(Vl,{index:t},t)))}),s.jsx(Bl,{}),s.jsx(Ul,{children:Array.from({length:3}).map(((e,t)=>s.jsx(Vl,{index:t+3},t+3)))})]})}),s.jsx(Si,{onClick:a,disabled:n||6!==e.length,className:"w-full",children:r("com_ui_verify")})]})},jU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},wU=({isGenerating:e,onGenerate:t})=>{const n=Uk();return s.jsx(oo.div,{...jU,className:"space-y-6",children:s.jsxs("div",{className:"rounded-xl bg-surface-secondary p-6",children:[s.jsx("h3",{className:"mb-4 flex justify-center text-lg font-medium",children:n("com_ui_2fa_account_security")}),s.jsxs(Si,{variant:"default",onClick:t,className:"flex w-full",disabled:e,children:[e?s.jsx(rc,{className:"size-5"}):s.jsx(Yn,{className:"size-5"}),n(e?"com_ui_generating":"com_ui_generate_qrcode")]})]})})},NU={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},CU=({onDisable:e,isDisabling:t})=>{const a=Uk(),[r,o]=n.useState(""),[i,l]=n.useState(!1);return s.jsxs(oo.div,{...NU,className:"space-y-8",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx(zl,{value:r,onChange:o,maxLength:i?8:6,pattern:i?ut:dt,className:"gap-2",children:i?s.jsxs(Ul,{children:[s.jsx(Vl,{index:0}),s.jsx(Vl,{index:1}),s.jsx(Vl,{index:2}),s.jsx(Vl,{index:3}),s.jsx(Vl,{index:4}),s.jsx(Vl,{index:5}),s.jsx(Vl,{index:6}),s.jsx(Vl,{index:7})]}):s.jsxs(s.Fragment,{children:[s.jsxs(Ul,{children:[s.jsx(Vl,{index:0}),s.jsx(Vl,{index:1}),s.jsx(Vl,{index:2})]}),s.jsx(Bl,{}),s.jsxs(Ul,{children:[s.jsx(Vl,{index:3}),s.jsx(Vl,{index:4}),s.jsx(Vl,{index:5})]})]})})}),s.jsxs(Si,{variant:"destructive",onClick:()=>e(r,i),disabled:t||r.length!==(i?8:6),className:"w-full rounded-xl px-6 py-3 transition-all disabled:opacity-50",children:[t&&s.jsx(rc,{className:"mr-2"}),a(t?"com_ui_disabling":"com_ui_2fa_disable")]}),s.jsx("button",{onClick:()=>l(!i),className:"text-sm text-primary hover:underline",children:a(i?"com_ui_use_2fa_code":"com_ui_use_backup_code")})]})},kU=({enabled:e,onChange:t,disabled:n})=>{const a=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs(ul,{className:"font-light",children:[" ",a("com_nav_2fa")]})}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx(Si,{variant:e?"destructive":"outline",onClick:t,disabled:n,children:a(e?"com_ui_2fa_disable":"com_ui_2fa_enable")})})]})},SU={initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},TU=S.memo((()=>{const e=Uk(),{user:t}=qk(),a=Pe(Cy.user),{showToast:r}=$d(),[o,i]=n.useState(""),[l,c]=n.useState(""),[d,u]=n.useState(!1),[m,p]=n.useState([]),[f,h]=n.useState(""),[g,x]=n.useState(!1),[v,b]=n.useState(""),[_,y]=n.useState((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),{mutate:j}=(()=>{const e=pr();return fr((e=>fx.confirmTwoFactor(e)),{onSuccess:t=>{e.setQueryData([ex.user,"2fa"],t)}})})(),{mutate:w,isLoading:N}=(()=>{const e=pr();return fr((()=>fx.enableTwoFactor()),{onSuccess:t=>{e.setQueryData([ex.user,"2fa"],t)}})})(),{mutate:C,isLoading:k}=(()=>{const e=pr();return fr((e=>fx.verifyTwoFactor(e)),{onSuccess:t=>{e.setQueryData([ex.user,"2fa"],t)}})})(),{mutate:S,isLoading:T}=(()=>{const e=pr();return fr((e=>fx.disableTwoFactor(e)),{onSuccess:()=>{e.setQueryData([ex.user,"2fa"],null)}})})(),E=["Setup","Scan QR","Verify","Backup"],R={setup:"Setup",qr:"Scan QR",verify:"Verify",backup:"Backup",disable:""},I=E.indexOf(R[_]),P=n.useCallback((()=>{(null==t?void 0:t.twoFactorEnabled)&&l&&S(void 0,{onError:()=>r({message:e("com_ui_2fa_disable_error"),status:"error"})}),c(""),i(""),p([]),b(""),h(""),y((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),u(!1)}),[t,l,S,e,r]),A=n.useCallback((()=>{w(void 0,{onSuccess:({otpauthUrl:e,backupCodes:t})=>{c(e),i(e.split("secret=")[1].split("&")[0]),p(t),y("qr")},onError:()=>r({message:e("com_ui_2fa_generate_error"),status:"error"})})}),[w,e,r]),M=n.useCallback((()=>{v&&C({token:v},{onSuccess:()=>{r({message:e("com_ui_2fa_verified")}),j({token:v},{onSuccess:()=>y("backup"),onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})},onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})}),[v,C,j,e,r]),L=n.useCallback((()=>{if(!m.length)return;const e=new Blob([m.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="backup-codes.txt",n.click(),URL.revokeObjectURL(t),u(!0)}),[m]),O=n.useCallback((()=>{x(!1),y("disable"),r({message:e("com_ui_2fa_enabled")}),a((e=>({...e,backupCodes:m.map((e=>({code:e,codeHash:e,used:!1,usedAt:null}))),twoFactorEnabled:!0})))}),[a,e,r,m]),D=n.useCallback(((t,n)=>{if(!n&&t.trim().length<6)return;if(n&&t.trim().length<8)return;const s={};n?s.backupCode=t.trim():s.token=t.trim(),S(s,{onSuccess:()=>{r({message:e("com_ui_2fa_disabled")}),x(!1),a((e=>({...e,totpSecret:"",backupCodes:[],twoFactorEnabled:!1}))),y("setup"),c("")},onError:()=>r({message:e("com_ui_2fa_invalid"),status:"error"})})}),[S,r,e,a]);return s.jsxs(ml,{open:g,onOpenChange:e=>{x(e),e||P()},children:[s.jsx(kU,{enabled:!!(null==t?void 0:t.twoFactorEnabled),onChange:()=>x(!0),disabled:k||T||N}),s.jsx(xl,{className:"w-11/12 max-w-lg p-6",children:s.jsx(io,{mode:"wait",children:s.jsxs(oo.div,{variants:SU,initial:"initial",animate:"animate",exit:"exit",className:"space-y-6",children:[s.jsxs(vl,{children:[s.jsxs(_l,{className:"mb-2 flex items-center gap-3 text-2xl font-bold",children:[s.jsx(Cs,{className:"h-6 w-6 text-primary"}),(null==t?void 0:t.twoFactorEnabled)?e("com_ui_2fa_disable"):e("com_ui_2fa_setup")]}),(null==t?void 0:t.twoFactorEnabled)&&"disable"!==_&&s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsx(Fl,{value:E.indexOf(R[_])/(E.length-1)*100,className:"h-2 rounded-full"}),s.jsx("div",{className:"flex justify-between text-sm",children:E.map(((e,t)=>s.jsx(oo.span,{animate:{color:I>=t?"var(--text-primary)":"var(--text-tertiary)"},className:"font-medium",children:e},e)))})]})]}),s.jsxs(io,{mode:"wait",children:["setup"===_&&s.jsx(wU,{isGenerating:N,onGenerate:A,onNext:()=>y("qr"),onError:e=>r({message:e.message,status:"error"})}),"qr"===_&&s.jsx(bU,{secret:o,otpauthUrl:l,onNext:()=>y("verify"),onError:e=>r({message:e.message,status:"error"})}),"verify"===_&&s.jsx(yU,{token:v,onTokenChange:b,isVerifying:k,onNext:M,onError:e=>r({message:e.message,status:"error"})}),"backup"===_&&s.jsx(xU,{backupCodes:m,onDownload:L,downloaded:d,onNext:O,onError:e=>r({message:e.message,status:"error"})}),"disable"===_&&s.jsx(CU,{onDisable:D,isDisabling:T,onError:e=>r({message:e.message,status:"error"})})]})]},_)})})]})})),EU=S.memo((()=>{const e=Uk(),{user:t}=qk(),{showToast:a}=$d(),r=Pe(Cy.user),[o,i]=n.useState(!1),{mutate:l,isLoading:c}=(()=>{const e=pr();return fr((()=>fx.regenerateBackupCodes()),{onSuccess:t=>{e.setQueryData([ex.user,"2fa","backup"],t)}})})(),d=()=>{((t=!1)=>{l(void 0,{onSuccess:n=>{const s=n.backupCodesHash.map((e=>({codeHash:e,used:!1,usedAt:null})));if(r((e=>({...e,backupCodes:s}))),a({message:e("com_ui_backup_codes_regenerated"),status:"success"}),!t&&s.length){const e=n.backupCodes.join("\n"),t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="backup-codes.txt",a.click(),URL.revokeObjectURL(s)}},onError:()=>a({message:e("com_ui_backup_codes_regenerate_error"),status:"error"})})})(!1)};return s.jsxs(ml,{open:o,onOpenChange:i,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-3",children:s.jsx(ul,{className:"font-light",children:e("com_ui_backup_codes")})}),s.jsx(pl,{asChild:!0,children:s.jsx(Si,{"aria-label":"Manage Backup Codes",variant:"outline",children:e("com_ui_manage")})})]}),s.jsxs(xl,{className:"w-11/12 max-w-lg",children:[s.jsx(_l,{className:"mb-6 text-2xl font-semibold",children:e("com_ui_backup_codes")}),s.jsx(io,{children:s.jsx(oo.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-4",children:Array.isArray(null==t?void 0:t.backupCodes)&&(null==t?void 0:t.backupCodes.length)>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-warning-300 bg-warning-50 dark:border-warning-700 dark:bg-warning-900/20 mb-6 rounded-lg border p-4",children:s.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_backup_codes_security_info")})}),s.jsx("h3",{className:"mb-4 text-lg font-medium",children:e("com_ui_backup_codes_status")}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:null==t?void 0:t.backupCodes.map(((t,n)=>{const a=t.used,r=`Backup code number ${n+1}, ${a?`used on ${t.usedAt?new Date(t.usedAt).toLocaleDateString():"an unknown date"}`:"not used yet"}`;return s.jsx(oo.div,{role:"listitem",tabIndex:0,"aria-label":r,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},onFocus:()=>{const e=new CustomEvent("announce",{detail:{message:r}});document.dispatchEvent(e)},className:`flex flex-col rounded-xl border p-4 backdrop-blur-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary ${a?"border-red-200 bg-red-50/80 dark:border-red-800 dark:bg-red-900/20":"border-green-200 bg-green-50/80 dark:border-green-800 dark:bg-green-900/20"} `,children:s.jsxs("div",{className:"flex items-center justify-between","aria-hidden":"true",children:[s.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e("com_ui_backup_code_number",{number:n+1})}),s.jsx(Dl,{description:t.usedAt?new Date(t.usedAt).toLocaleDateString():"",disabled:!a,focusable:!1,className:a?"cursor-pointer":"cursor-default",render:s.jsx("span",{className:"rounded-full px-3 py-1 text-sm font-medium "+(a?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300"),children:e(a?"com_ui_used":"com_ui_not_used")})})]})},t.codeHash)}))}),s.jsx("div",{className:"mt-12 flex justify-center",children:s.jsxs(Si,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c?s.jsx(rc,{className:"mr-2"}):s.jsx(ks,{className:"mr-2 h-4 w-4"}),e(c?"com_ui_regenerating":"com_ui_regenerate_backup")]})})]}):s.jsx("div",{className:"flex flex-col items-center gap-4 p-6 text-center",children:s.jsxs(Si,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c&&s.jsx(rc,{className:"mr-2"}),e("com_ui_regenerate_backup")]})})})})]})]})}));const RU=S.memo((function(){const{user:e}=qk();return s.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[s.jsx("div",{className:"pb-3",children:s.jsx(uU,{})}),s.jsx("div",{className:"pb-3",children:s.jsx(hU,{})}),"local"===(null==e?void 0:e.provider)&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"pb-3",children:s.jsx(TU,{})}),(null==e?void 0:e.twoFactorEnabled)&&s.jsx("div",{className:"pb-3",children:s.jsx(EU,{})})]}),s.jsx("div",{className:"pb-3",children:s.jsx(mU,{})})]})})),IU=({tokenCredits:e})=>{const t=Uk();return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ul,{className:"font-light",children:t("com_nav_balance")}),s.jsx(Ld,{side:Oi.Bottom,text:t("com_nav_info_balance")})]}),s.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:void 0!==e?e.toFixed(2):"0.00"})]})},PU=(e,t,n)=>{const s=new Date(e);switch(n){case"seconds":s.setSeconds(s.getSeconds()+t);break;case"minutes":s.setMinutes(s.getMinutes()+t);break;case"hours":s.setHours(s.getHours()+t);break;case"days":s.setDate(s.getDate()+t);break;case"weeks":s.setDate(s.getDate()+7*t);break;case"months":s.setMonth(s.getMonth()+t)}return s};const AU=({lastRefill:e,refillAmount:t,refillIntervalUnit:n,refillIntervalValue:a})=>{const r=Uk(),o=e?new Date(e):null,i=o?function(e,t,n){const s=new Date;if(e>s)return PU(e,t,n);if("months"===n){let a=new Date(e);for(;a<=s;)a=PU(a,t,n);return a}const a={seconds:1e3*t,minutes:1e3*t*60,hours:1e3*t*60*60,days:1e3*t*60*60*24,weeks:1e3*t*60*60*24*7}[n];if(a<=0)return PU(e,t,n);const r=s.getTime()-e.getTime(),o=Math.floor(r/a)+1,i=e.getTime()+o*a;return new Date(i)}(o,a,n):null;return s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:r("com_nav_balance_auto_refill_settings")}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_last_refill")}),s.jsx("span",{children:o?o.toLocaleString():"-"})]}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_refill_amount")}),s.jsx("span",{children:void 0!==t?t:"-"})]}),s.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[s.jsx("span",{children:r("com_nav_balance_interval")}),s.jsxs("span",{children:[r("com_nav_balance_every")," ",a," ",((e,t)=>{let n;switch(t){case"seconds":n=1===e?"com_nav_balance_second":"com_nav_balance_seconds";break;case"minutes":n=1===e?"com_nav_balance_minute":"com_nav_balance_minutes";break;case"hours":n=1===e?"com_nav_balance_hour":"com_nav_balance_hours";break;case"days":n=1===e?"com_nav_balance_day":"com_nav_balance_days";break;case"weeks":n=1===e?"com_nav_balance_week":"com_nav_balance_weeks";break;case"months":n=1===e?"com_nav_balance_month":"com_nav_balance_months";break;default:n="com_nav_balance_seconds"}return r(n)})(a,n)]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ul,{className:"font-light",children:r("com_nav_balance_next_refill")}),s.jsx(Ld,{side:Oi.Bottom,text:r("com_nav_balance_next_refill_info")})]}),s.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:i?i.toLocaleString():"-"})]})]})};const MU=S.memo((function(){var e;const t=Uk(),{isAuthenticated:n}=qk(),{data:a}=Wy(),r=rj({enabled:!!n&&!!(null==(e=null==a?void 0:a.balance)?void 0:e.enabled)}).data,{tokenCredits:o=0,autoRefillEnabled:i=!1,lastRefill:l,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}=r??{},m=void 0!==l&&void 0!==c&&void 0!==d&&void 0!==u;return s.jsxs("div",{className:"flex flex-col gap-4 p-4 text-sm text-text-primary",children:[s.jsx(IU,{tokenCredits:o}),i?m?s.jsx(AU,{lastRefill:l,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}):s.jsx("div",{className:"text-sm text-red-600",children:t("com_nav_balance_auto_refill_error")}):s.jsx("div",{className:"text-sm text-gray-600",children:t("com_nav_balance_auto_refill_disabled")})]})}));function LU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.cloudBrowserVoices),[r]=Ie(Cy.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_enable_cloud_browser_voice")}),s.jsx(kl,{id:"CloudBrowserVoices",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"CloudBrowserVoices",disabled:!r})]})}function OU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.automaticPlayback);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_automatic_playback")}),s.jsx(kl,{id:"AutomaticPlayback",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"AutomaticPlayback"})]})}function DU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_text_to_speech")})}),s.jsx(kl,{id:"TextToSpeech",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"TextToSpeech"})]})}const FU=({external:e})=>{const t=Uk(),[n,a]=Ie(Cy.engineTTS),r=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_engine")}),s.jsx(od,{value:n,onChange:e=>{a(e)},options:r,sizeClasses:"w-[180px]",testId:"EngineTTSDropdown",className:"z-50"})]})};function zU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.cacheTTS),[r]=Ie(Cy.textToSpeech);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_enable_cache_tts")}),s.jsx(kl,{id:"CacheTTS",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"CacheTTS",disabled:!r})]})}const UU={[hv.browser]:function(){const e=Uk(),{voices:t=[]}=Gj(),[n,a]=Ie(Cy.voice);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_voice_select")}),s.jsx(od,{value:n??"",options:t,onChange:e=>{a_.log("Browser Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"BrowserVoiceDropdown",className:"z-50"},`browser-voice-dropdown-${t.length}`)]})},[hv.external]:function(){const e=Uk(),{voices:t=[]}=Hj(),[n,a]=Ie(Cy.voice);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_voice_select")}),s.jsx(od,{value:n??"",options:t,onChange:e=>{a_.log("External Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"ExternalVoiceDropdown",className:"z-50"},`external-voice-dropdown-${t.length}`)]})}};function VU(){const e=Ae(Cy.engineTTS),t=UU[e];return t?s.jsx(t,{}):null}function BU(){const e=Uk(),t=Ae(Cy.textToSpeech),[n,a]=Ie(Cy.playbackRate);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_playback_rate")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"1"}),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(jl,{value:[n??1],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(null),min:.1,max:2,step:.1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(dl,{value:n??1,disabled:!t,onChange:e=>a(e?e[0]:0),min:.1,max:2,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function $U(){const e=Uk(),t=Ae(Cy.speechToText),[n,a]=Ie(Cy.autoSendText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_auto_send_text")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_nav_auto_send_text_disabled"),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(jl,{value:[n??-1],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(-1),min:-1,max:60,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(dl,{value:`${n} s`,disabled:!t,onChange:e=>a(e?e[0]:0),min:-1,max:60,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function HU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.speechToText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_speech_to_text")})}),s.jsx(kl,{id:"SpeechToText",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"SpeechToText"})]})}const GU=({external:e})=>{const t=Uk(),[n,a]=Ie(Cy.engineSTT),r=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_engine")}),s.jsx(od,{value:n,onChange:e=>{a(e)},options:r,sizeClasses:"w-[180px]",testId:"EngineSTTDropdown",className:"z-50"})]})};function KU(){const e=Uk(),t=Ae(Cy.speechToText),[n,a]=Ie(Cy.decibelValue);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_db_sensitivity")}),s.jsx("div",{className:"w-2"}),s.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"-45"}),")"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(jl,{value:[n??-45],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(-45),min:-100,max:-30,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),s.jsx("div",{className:"w-2"}),s.jsx(dl,{value:n,disabled:!t,onChange:e=>a(e?e[0]:0),min:-100,max:-30,className:s_(h_,s_(g_,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function WU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.autoTranscribeAudio),r=Ae(Cy.speechToText);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:t("com_nav_auto_transcribe_audio")}),s.jsx(kl,{id:"AutoTranscribeAudio",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},className:"ml-4","data-testid":"AutoTranscribeAudio",disabled:!r})]})}function qU(){const e=Uk(),[t,n]=Ie(Cy.languageSTT);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:e("com_nav_language")}),s.jsx(od,{value:t,onChange:e=>{n(e)},options:[{value:"af",label:"Afrikaans"},{value:"eu",label:"Basque"},{value:"bg",label:"Bulgarian"},{value:"ca",label:"Catalan"},{value:"ar-EG",label:"Arabic (Egypt)"},{value:"ar-JO",label:"Arabic (Jordan)"},{value:"ar-KW",label:"Arabic (Kuwait)"},{value:"ar-LB",label:"Arabic (Lebanon)"},{value:"ar-QA",label:"Arabic (Qatar)"},{value:"ar-AE",label:"Arabic (UAE)"},{value:"ar-MA",label:"Arabic (Morocco)"},{value:"ar-IQ",label:"Arabic (Iraq)"},{value:"ar-DZ",label:"Arabic (Algeria)"},{value:"ar-BH",label:"Arabic (Bahrain)"},{value:"ar-LY",label:"Arabic (Libya)"},{value:"ar-OM",label:"Arabic (Oman)"},{value:"ar-SA",label:"Arabic (Saudi Arabia)"},{value:"ar-TN",label:"Arabic (Tunisia)"},{value:"ar-YE",label:"Arabic (Yemen)"},{value:"cs",label:"Czech"},{value:"nl-NL",label:"Dutch"},{value:"en-AU",label:"English (Australia)"},{value:"en-CA",label:"English (Canada)"},{value:"en-IN",label:"English (India)"},{value:"en-NZ",label:"English (New Zealand)"},{value:"en-ZA",label:"English (South Africa)"},{value:"en-GB",label:"English (UK)"},{value:"en-US",label:"English (US)"},{value:"et-EE",label:"Estonian"},{value:"fi",label:"Finnish"},{value:"fr-FR",label:"French"},{value:"gl",label:"Galician"},{value:"de-DE",label:"German"},{value:"el-GR",label:"Greek"},{value:"he",label:"Hebrew"},{value:"hu",label:"Hungarian"},{value:"is",label:"Icelandic"},{value:"it-IT",label:"Italian"},{value:"id",label:"Indonesian"},{value:"ja",label:"Japanese"},{value:"ko",label:"Korean"},{value:"la",label:"Latin"},{value:"lv-LV",label:"Latvian"},{value:"lt-LT",label:"Lithuanian"},{value:"zh-CN",label:"Mandarin Chinese"},{value:"zh-TW",label:"Taiwanese"},{value:"zh-HK",label:"Cantonese"},{value:"ms-MY",label:"Malaysian"},{value:"no-NO",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"xx-piglatin",label:"Pig Latin"},{value:"pt-PT",label:"Portuguese"},{value:"pt-br",label:"Portuguese (Brasil)"},{value:"ro-RO",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr-SP",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"es-AR",label:"Spanish (Argentina)"},{value:"es-BO",label:"Spanish (Bolivia)"},{value:"es-CL",label:"Spanish (Chile)"},{value:"es-CO",label:"Spanish (Colombia)"},{value:"es-CR",label:"Spanish (Costa Rica)"},{value:"es-DO",label:"Spanish (Dominican Republic)"},{value:"es-EC",label:"Spanish (Ecuador)"},{value:"es-SV",label:"Spanish (El Salvador)"},{value:"es-GT",label:"Spanish (Guatemala)"},{value:"es-HN",label:"Spanish (Honduras)"},{value:"es-MX",label:"Spanish (Mexico)"},{value:"es-NI",label:"Spanish (Nicaragua)"},{value:"es-PA",label:"Spanish (Panama)"},{value:"es-PY",label:"Spanish (Paraguay)"},{value:"es-PE",label:"Spanish (Peru)"},{value:"es-PR",label:"Spanish (Puerto Rico)"},{value:"es-ES",label:"Spanish (Spain)"},{value:"es-US",label:"Spanish (US)"},{value:"es-UY",label:"Spanish (Uruguay)"},{value:"es-VE",label:"Spanish (Venezuela)"},{value:"sv-SE",label:"Swedish"},{value:"tr",label:"Turkish"},{value:"zu",label:"Zulu"}],sizeClasses:"[--anchor-max-height:256px]",testId:"LanguageSTTDropdown",className:"z-50"})]})}function QU({onCheckedChange:e}){const t=Uk(),[n,a]=Ie(Cy.conversationMode),r=Ae(Cy.speechToText),o=Ae(Cy.textToSpeech),[,i]=Ie(Cy.autoSendText),[,l]=Ie(Cy.decibelValue),[,c]=Ie(Cy.autoTranscribeAudio);return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{children:s.jsx("strong",{children:t("com_nav_conversation_mode")})}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsx(kl,{id:"ConversationMode",checked:n,onCheckedChange:t=>{c(t),i(3),l(-45),a(t),e&&e(t)},className:"ml-4","data-testid":"ConversationMode",disabled:!o||!r})})]})}const YU=S.memo((function(){const e=Uk(),[t,a]=n.useState(!1),{data:r}=Nk(),o=Wi("(max-width: 767px)"),[i,l]=n.useState(!1),[c,d]=n.useState(!1),[u,m]=Ie(Cy.advancedMode),[p,f]=Ie(Cy.autoTranscribeAudio),[h,g]=Ie(Cy.conversationMode),[x,v]=Ie(Cy.speechToText),[b,_]=Ie(Cy.textToSpeech),[y,j]=Ie(Cy.cacheTTS),[w,N]=Ie(Cy.engineSTT),[C,k]=Ie(Cy.languageSTT),[S,T]=Ie(Cy.decibelValue),[E,R]=Ie(Cy.autoSendText),[I,P]=Ie(Cy.engineTTS),[A,M]=Ie(Cy.voice),[L,O]=Ie(Cy.cloudBrowserVoices),[D,F]=Ie(Cy.languageTTS),[z,U]=Ie(Cy.automaticPlayback),[V,B]=Ie(Cy.playbackRate),$=n.useCallback(((e,t)=>{const n={sttExternal:{value:i,setFunc:l},ttsExternal:{value:c,setFunc:d},conversationMode:{value:h,setFunc:g},advancedMode:{value:u,setFunc:m},speechToText:{value:x,setFunc:v},textToSpeech:{value:b,setFunc:_},cacheTTS:{value:y,setFunc:j},engineSTT:{value:w,setFunc:N},languageSTT:{value:C,setFunc:k},autoTranscribeAudio:{value:p,setFunc:f},decibelValue:{value:S,setFunc:T},autoSendText:{value:E,setFunc:R},engineTTS:{value:I,setFunc:P},voice:{value:A,setFunc:M},cloudBrowserVoices:{value:L,setFunc:O},languageTTS:{value:D,setFunc:F},automaticPlayback:{value:z,setFunc:U},playbackRate:{value:V,setFunc:B}}[e];n&&n.setFunc(t)}),[i,c,h,u,x,b,y,w,C,p,S,E,I,A,L,D,z,V,l,d,g,m,v,_,j,N,k,f,T,R,P,M,O,F,U,B]);return n.useEffect((()=>{r&&"not_found"!==r.message&&Object.entries(r).forEach((([e,t])=>{null===localStorage.getItem(e)&&"sttExternal"!==e&&"ttsExternal"!==e?$(e,t):"sttExternal"!==e&&"ttsExternal"!==e||$(e,t)}))}),[r]),n.useEffect((()=>{["browser","external"].includes(I)||P("browser")}),[I,P]),qi(n.useRef(null),(()=>t&&a(!1)),[]),s.jsxs(Qa,{defaultValue:"simple",orientation:"horizontal",value:u?"advanced":"simple",children:[s.jsx("div",{className:"sticky -top-1 z-50 mb-4 bg-white dark:bg-gray-700",children:s.jsxs(ja,{className:"flex justify-center bg-background",children:[s.jsxs(wa,{onClick:()=>m(!1),className:s_("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",o?"flex-row rounded-lg":"rounded-xl","w-full"),value:"simple",style:{userSelect:"none"},children:[s.jsx(qe,{}),e("com_ui_simple")]}),s.jsxs(wa,{onClick:()=>m(!0),className:s_("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",o?"flex-row rounded-lg":"rounded-xl","w-full"),value:"advanced",style:{userSelect:"none"},children:[s.jsx(Ss,{}),e("com_ui_advanced")]})]})}),s.jsx(Na,{value:"simple",children:s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx(HU,{}),s.jsx(GU,{external:i}),s.jsx(qU,{}),s.jsx("div",{className:"h-px bg-border-medium",role:"none"}),s.jsx(DU,{}),s.jsx(FU,{external:c}),s.jsx(VU,{})]})}),s.jsx(Na,{value:"advanced",children:s.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[s.jsx(QU,{}),s.jsx("div",{className:"mt-2 h-px bg-border-medium",role:"none"}),s.jsx(HU,{}),s.jsx(GU,{external:i}),s.jsx(qU,{}),s.jsx("div",{className:"pb-2",children:s.jsx(WU,{})}),p&&s.jsx("div",{className:"pb-2",children:s.jsx(KU,{})}),s.jsx("div",{className:"pb-2",children:s.jsx($U,{})}),s.jsx("div",{className:"h-px bg-border-medium",role:"none"}),s.jsx("div",{className:"pb-3",children:s.jsx(DU,{})}),s.jsx(OU,{}),s.jsx(FU,{external:c}),s.jsx(VU,{}),"browser"===I&&s.jsx("div",{className:"pb-2",children:s.jsx(LU,{})}),s.jsx("div",{className:"pb-2",children:s.jsx(BU,{})}),s.jsx(zU,{})]})})]})}));function XU({setNavVisible:e}){const t=Uk(),n=pr(),{newConversation:a}=lT(),r=Ae(Cy.conversationByIndex(0)),{title:o="New Chat"}=r||{};return s.jsxs("div",{className:"bg-token-main-surface-primary sticky top-0 z-10 flex min-h-[40px] items-center justify-center bg-white pl-1 dark:bg-gray-800 dark:text-white md:hidden",children:[s.jsxs("button",{type:"button","data-testid":"mobile-header-new-chat-button","aria-label":t("com_nav_open_sidebar"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),children:[s.jsx("span",{className:"sr-only",children:t("com_nav_open_sidebar")}),s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})]}),s.jsx("h1",{className:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap text-center text-sm font-normal",children:o??t("com_ui_new_chat")}),s.jsx("button",{type:"button","aria-label":t("com_ui_new_chat"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>{n.setQueryData([ex.messages,(null==r?void 0:r.conversationId)??dh.NEW_CONVO],[]),n.invalidateQueries([ex.messages]),a()},children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})})]})}const ZU=n.forwardRef(((e,t)=>{const a=Uk(),r=De(),o=pr(),i=Fe(),{isSmallScreen:l}=e,[c,d]=n.useState(""),u=n.useRef(null),[m,p]=n.useState(!1),{newConversation:f}=lT(),[h,g]=Ie(Cy.search),x=n.useCallback((e=>{((null==e?void 0:e.includes("/search"))||"/c/new"===e)&&(o.removeQueries([ex.messages]),f({disableFocus:!0}),i("/c/new"))}),[f,i,o]),v=n.useCallback((e=>{var t;p(!1),d(""),g((e=>({...e,query:"",debouncedQuery:"",isTyping:!1}))),x(e),null==(t=u.current)||t.focus()}),[g,x]),b=n.useCallback((e=>{const{value:t}=e.target;"Backspace"===e.key&&""===t&&v(r.pathname)}),[v,r.pathname]),_=n.useCallback((e=>{e&&o.invalidateQueries([ex.messages])}),[o]),y=n.useMemo((()=>ko((e=>{g((t=>({...t,debouncedQuery:e,isTyping:!1}))),_(e)}),500)),[g,_]);return n.useEffect((()=>{h.isTyping&&!h.isSearching&&h.debouncedQuery===h.query&&g((e=>({...e,isTyping:!1})))}),[h.isTyping,h.isSearching,h.debouncedQuery,h.query,g]),s.jsxs("div",{ref:t,className:s_("group relative mt-1 flex h-10 cursor-pointer items-center gap-3 rounded-lg border-border-medium px-3 py-2 text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===l?"mb-2 h-14 rounded-xl":""),children:[s.jsx(wt,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),s.jsx("input",{type:"text",ref:u,className:"m-0 mr-0 w-full border-none bg-transparent p-0 pl-7 text-sm leading-tight placeholder-text-secondary placeholder-opacity-100 focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary",value:c,onChange:e=>{const t=e.target.value;p(t.length>0),d(t),g((e=>({...e,query:t,isTyping:!0}))),y(t),t.length>0&&"/search"!==r.pathname&&i("/search",{replace:!0})},onKeyDown:e=>{"Space"===e.code&&e.stopPropagation()},"aria-label":a("com_nav_search_placeholder"),placeholder:a("com_nav_search_placeholder"),onKeyUp:b,onFocus:()=>g((e=>({...e,isSearching:!0}))),onBlur:()=>g((e=>({...e,isSearching:!1}))),autoComplete:"off",dir:"auto"}),s.jsx("button",{type:"button","aria-label":`${a("com_ui_clear")} ${a("com_ui_search")}`,className:s_("absolute right-[7px] flex h-5 w-5 items-center justify-center rounded-full border-none bg-transparent p-0 transition-opacity duration-200",m?"opacity-100":"opacity-0",!0===l?"right-[16px]":""),onClick:()=>v(r.pathname),tabIndex:m?0:-1,disabled:!m,children:s.jsx(vt,{className:"h-5 w-5 cursor-pointer"})})]})}));const JU=n.lazy((()=>ci((()=>import("./BookmarkNav.TMwYk4NF.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),eV=n.lazy((()=>ci((()=>import("./AccountSettings.4B1-w-QW.js")),__vite__mapDeps([30,1,2,3,4,5,6,8,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),tV=n.lazy((()=>ci((()=>import("./AgentMarketplaceButton.dR_d2pWo.js")),__vite__mapDeps([31,1,2,3,4,5,6,8,11,12,13,7,9,14,15,16,17,10,18,19,20,21,22,23,24,25,26,27,28,29]),import.meta.url))),nV="260px",sV=n.memo((({navVisible:e,toggleNavVisible:t})=>s.jsx("div",{id:"mobile-nav-mask-toggle",role:"button",tabIndex:0,className:"nav-mask transition-opacity duration-200 ease-in-out "+(e?"active opacity-100":"opacity-0"),onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},"aria-label":"Toggle navigation"}))),aV=n.memo((function({index:e=0,toggleNav:t,subHeaders:a,isSmallScreen:r,headerButtons:o}){const i=pr(),{newConversation:l}=lT(e),c=Fe(),d=Uk(),{conversation:u}=Cy.useCreateConversationAtom(e),m=n.useCallback((e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(i.setQueryData([ex.messages,(null==u?void 0:u.conversationId)??dh.NEW_CONVO],[]),i.invalidateQueries([ex.messages]),l(),c("/c/new",{state:{focusChat:!0}}),r&&t()):window.open("/c/new","_blank")}),[i,u,l,c,t,r]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between py-[2px] md:py-2",children:[s.jsx(Dl,{description:d("com_nav_close_sidebar"),render:s.jsxs(Si,{size:"icon",variant:"outline","data-testid":"close-sidebar-button","aria-label":d("com_nav_close_sidebar"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:t,children:[s.jsx(sc,{className:"max-md:hidden"}),s.jsx(ac,{className:"m-1 inline-flex size-10 items-center justify-center md:hidden"})]})}),s.jsxs("div",{className:"flex gap-0.5",children:[o,s.jsx(Dl,{description:d("com_ui_new_chat"),render:s.jsx(Si,{size:"icon",variant:"outline","data-testid":"nav-new-chat-button","aria-label":d("com_ui_new_chat"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:m,children:s.jsx(zc,{className:"icon-lg text-text-primary"})})})]})]}),null!=a?a:null]})})),rV=n.memo((({navVisible:e,setNavVisible:t})=>{const a=Uk(),{isAuthenticated:r}=qk(),[o,i]=n.useState(nV),l=Wi("(max-width: 768px)"),[c,d]=DE("newUser",!0),[u,m]=n.useState(!1),[p,f]=n.useState([]),h=Qk({permissionType:Zh.BOOKMARKS,permission:Jh.USE}),g=Ae(Cy.search),{data:x,fetchNextPage:v,isFetchingNextPage:b,isLoading:_,isFetching:y,refetch:j}=pj({tags:0===p.length?void 0:p,search:g.debouncedQuery||void 0},{enabled:r,staleTime:3e4,cacheTime:3e5}),w=n.useMemo((()=>{if((null==x?void 0:x.pages)&&x.pages.length>0){return null!==x.pages[x.pages.length-1].nextCursor}return!1}),[null==x?void 0:x.pages]),N=n.useRef(null),C=n.useRef(null),{moveToTop:k}=wT({setShowLoading:m,fetchNextPage:async e=>w?v(e):Promise.resolve({}),isFetchingNext:b}),S=n.useMemo((()=>x?x.pages.flatMap((e=>e.conversations)):[]),[x]),T=n.useCallback((()=>{t((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),c&&d(!1)}),[c,t,d]),E=n.useCallback((()=>{l&&T()}),[l,T]);n.useEffect((()=>{if(l){null===localStorage.getItem("navVisible")&&T(),i("320px")}else i(nV)}),[l,T]),n.useEffect((()=>{j()}),[p,j]);const R=n.useCallback((()=>{!b&&w&&v()}),[b,w,v]),I=n.useMemo((()=>!0===g.enabled&&s.jsx(ZU,{isSmallScreen:l})),[g.enabled,l]),P=n.useMemo((()=>s.jsxs(s.Fragment,{children:[s.jsx(n.Suspense,{fallback:null,children:s.jsx(tV,{isSmallScreen:l,toggleNav:T})}),h&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-1.5"}),s.jsx(n.Suspense,{fallback:null,children:s.jsx(JU,{tags:p,setTags:f,isSmallScreen:l})})]})]})),[h,p,l,T]),[A,M]=n.useState(!!g.query&&(g.isTyping||_||y));return n.useEffect((()=>{g.isTyping?M(!0):_||y?g.query&&(_||y)&&M(!0):M(!1)}),[g.query,g.isTyping,_,y]),s.jsxs(s.Fragment,{children:[s.jsx("div",{"data-testid":"nav",className:s_("nav active max-w-[320px] flex-shrink-0 transform overflow-x-hidden bg-surface-primary-alt transition-all duration-200 ease-in-out","md:max-w-[260px]"),style:{width:e?o:"0px",transform:e?"translateX(0)":"translateX(-100%)"},children:s.jsx("div",{className:"h-full w-[320px] md:w-[260px]",children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsx("div",{className:"flex h-full flex-col transition-opacity duration-200 ease-in-out "+(e?"opacity-100":"opacity-0"),children:s.jsx("div",{className:"flex h-full flex-col",children:s.jsxs("nav",{id:"chat-history-nav","aria-label":a("com_ui_chat_history"),className:"flex h-full flex-col px-2 pb-3.5 md:px-3",children:[s.jsxs("div",{className:"flex flex-1 flex-col",ref:N,children:[s.jsx(aV,{subHeaders:I,toggleNav:T,headerButtons:P,isSmallScreen:l}),s.jsx(PD,{conversations:S,moveToTop:k,toggleNav:E,containerRef:C,loadMoreConversations:R,isLoading:b||u||_,isSearchLoading:A})]}),s.jsx(n.Suspense,{fallback:null,children:s.jsx(eV,{})})]})})})})})}),l&&s.jsx(sV,{navVisible:e,toggleNavVisible:T})]})}));rV.displayName="Nav",n.forwardRef(((e,t)=>{const{svg:n,text:a,clickHandler:r,disabled:o,className:i=""}=e,l={className:s_("w-full flex gap-2 rounded p-2.5 text-sm cursor-pointer group items-center transition-colors duration-200 text-text-primary",i,{"opacity-50 pointer-events-none":o})};return r&&(l.onClick=r),s.jsxs("button",{...l,ref:t,children:[n(),a]})}));const oV=n.forwardRef(((e,t)=>{const{id:n,value:a,label:r,subLabel:o,onChange:i,labelClassName:l="",inputClassName:c=""}=e,d=Uk();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:s_("mt-4 flex flex-row",l),children:[s.jsx(ul,{htmlFor:n,className:"text-left text-sm font-medium",children:r}),ul&&s.jsx(ul,{className:"mx-1 text-right text-sm text-text-secondary",children:o}),s.jsx("br",{})]}),s.jsx("div",{className:"h-1"}),s.jsx(cl,{id:n,"data-testid":`input-${n}`,value:a??"",onChange:i,ref:t,placeholder:`${d("com_endpoint_config_value")} ${r}`,className:s_("flex h-10 max-h-10 w-full resize-none px-3 py-2")})]})})),iV=mo({client_email:po().email().min(3),project_id:po().min(3),private_key:po().min(601)}),lV=e=>iV.safeParse(e).success,cV=({endpoint:e,userProvideURL:t})=>{const{control:n}=Uo(),a=e===Nu.azureOpenAI;return s.jsxs("form",{className:"flex-wrap",children:[!a&&s.jsx(Bo,{name:"apiKey",control:n,render:({field:e})=>s.jsx(oV,{id:"apiKey",...e,label:(a?"Azure q":"")+"OpenAI API Key",labelClassName:"mb-1",inputClassName:"mb-2"})}),a&&s.jsxs(s.Fragment,{children:[s.jsx(Bo,{name:"azureOpenAIApiKey",control:n,render:({field:e})=>s.jsx(oV,{id:"azureOpenAIApiKey",...e,label:"Azure OpenAI API Key",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Bo,{name:"azureOpenAIApiInstanceName",control:n,render:({field:e})=>s.jsx(oV,{id:"azureOpenAIApiInstanceName",...e,label:"Azure OpenAI Instance Name",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Bo,{name:"azureOpenAIApiDeploymentName",control:n,render:({field:e})=>s.jsx(oV,{id:"azureOpenAIApiDeploymentName",...e,label:"Azure OpenAI Deployment Name",labelClassName:"mb-1"})}),s.jsx("div",{className:"mt-3"}),s.jsx(Bo,{name:"azureOpenAIApiVersion",control:n,render:({field:e})=>s.jsx(oV,{id:"azureOpenAIApiVersion",...e,label:"Azure OpenAI API Version",labelClassName:"mb-1"})})]}),t&&s.jsx("div",{className:"mt-3",children:s.jsx(Bo,{name:"baseURL",control:n,render:({field:e})=>s.jsx(oV,{id:"baseURL",...e,label:"API Base URL",subLabel:"(Optional)",labelClassName:"mb-1"})})})]})};const dV=n.memo((function({endpoint:e}){const t=Uk();return{[Nu.google]:s.jsxs(s.Fragment,{children:[s.jsxs("small",{className:"mt-4 break-all text-text-secondary",children:[t("com_endpoint_config_google_service_key"),": ",t("com_endpoint_config_key_google_need_to")," ",s.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/vertex-ai",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_vertex_ai")})," ",t("com_endpoint_config_key_google_vertex_api")," ",s.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/projectselector/iam-admin/serviceaccounts/create?walkthrough_id=iam--create-service-account#step_index=1",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_service_account")}),". ",t("com_endpoint_config_key_google_vertex_api_role")]}),s.jsxs("small",{className:"break-all text-text-secondary",children:[t("com_endpoint_config_google_api_key"),": ",t("com_endpoint_config_google_api_info")," ",s.jsx("a",{target:"_blank",href:"https://makersuite.google.com/app/apikey",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_click_here")})," "]})]})}[e]||null})),uV={[Nu.google]:({userKey:e,setUserKey:t})=>{const n=Uk(),{getMultiKey:a,setMultiKey:r}=function(e){return{getMultiKey:function(e,t){return Ev(t)?JSON.parse(t)[e]:""},setMultiKey:function(t,n,s){let a={};Ev(s)&&(a=JSON.parse(s)),a[t]=n,e(JSON.stringify(a))}}}(t);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-row",children:[s.jsx(ul,{htmlFor:rh.GOOGLE_SERVICE_KEY,className:"text-left text-sm font-medium",children:n("com_endpoint_config_google_service_key")}),s.jsx(ul,{className:"mx-1 text-right text-sm text-text-secondary",children:n("com_endpoint_config_google_cloud_platform")}),s.jsx("br",{})]}),s.jsx(gL,{id:rh.GOOGLE_SERVICE_KEY,className:"w-full",containerClassName:"dark:bg-gray-700 h-10 max-h-10 w-full resize-none py-2 dark:ring-1 dark:ring-gray-600",text:n("com_endpoint_config_key_import_json_key"),successText:n("com_endpoint_config_key_import_json_key_success"),invalidText:n("com_endpoint_config_key_import_json_key_invalid"),validator:lV,onFileSelected:t=>{r(rh.GOOGLE_SERVICE_KEY,JSON.stringify(t),e)}}),s.jsx(oV,{id:rh.GOOGLE_API_KEY,value:a(rh.GOOGLE_API_KEY,e)??"",onChange:t=>r(rh.GOOGLE_API_KEY,t.target.value??"",e),label:n("com_endpoint_config_google_api_key"),subLabel:n("com_endpoint_config_google_gemini_api")})]})},[Nu.openAI]:cV,[Nu.custom]:({endpoint:e,userProvideURL:t})=>{const{control:n}=Uo();return s.jsxs("form",{className:"flex-wrap",children:[s.jsx(Bo,{name:"apiKey",control:n,render:({field:t})=>s.jsx(oV,{id:"apiKey",...t,label:`${e} API Key`,labelClassName:"mb-1",inputClassName:"mb-2"})}),t&&s.jsx(Bo,{name:"baseURL",control:n,render:({field:t})=>s.jsx(oV,{id:"baseURL",...t,label:`${e} API URL`,labelClassName:"mb-1"})})]})},[Nu.azureOpenAI]:cV,[Nu.gptPlugins]:cV,[Nu.assistants]:cV,[Nu.azureAssistants]:cV,default:({userKey:e,setUserKey:t,endpoint:n})=>{const a=Uk();return s.jsx(oV,{id:n,value:e??"",onChange:e=>t(e.target.value??""),label:a("com_endpoint_config_key_name")})}},mV=new Set([Nu.openAI,Nu.custom,Nu.azureOpenAI,Nu.gptPlugins,Nu.assistants,Nu.azureAssistants]),pV={THIRTY_MINUTES:{label:"in 30 minutes",value:18e5},TWO_HOURS:{label:"in 2 hours",value:72e5},TWELVE_HOURS:{label:"in 12 hours",value:432e5},ONE_DAY:{label:"in 1 day",value:864e5},ONE_WEEK:{label:"in 7 days",value:6048e5},ONE_MONTH:{label:"in 30 days",value:2592e6},NEVER:{label:"never",value:0}},fV=({open:e,onOpenChange:t,endpoint:a,endpointType:r,userProvideURL:o})=>{const i=Vo({defaultValues:{apiKey:"",baseURL:"",azureOpenAIApiKey:"",azureOpenAIApiInstanceName:"",azureOpenAIApiDeploymentName:"",azureOpenAIApiVersion:""}}),[l,c]=n.useState(""),{data:d}=Ky(),[u,m]=n.useState(pV.TWELVE_HOURS.label),{getExpiry:p,saveUserKey:f}=sT(a),{showToast:h}=$d(),g=Uk(),x=Object.values(pV),v=uV[r??a]??uV.default,b=p(),_=null==d?void 0:d[a];return s.jsx(ml,{open:e,onOpenChange:t,children:s.jsx(Ud,{title:`${g("com_endpoint_config_key_for")} ${qf[a]??a}`,className:"w-11/12 max-w-2xl",showCancelButton:!1,main:s.jsxs("div",{className:"grid w-full items-center gap-2",children:[s.jsx("small",{className:"text-red-600",children:"never"===b?g("com_endpoint_config_key_never_expires"):`${g("com_endpoint_config_key_encryption")} ${new Date(b??0).toLocaleString()}`}),s.jsx(od,{label:"Expires ",value:u,onChange:e=>{m(e)},options:x.map((e=>e.label)),sizeClasses:"w-[185px]",portal:!1}),s.jsx("div",{className:"mt-2"}),s.jsx($o,{...i,children:s.jsx(v,{userKey:l,setUserKey:c,endpoint:a===Nu.gptPlugins&&(null==_?void 0:_.azure)?Nu.azureOpenAI:a,userProvideURL:o})}),s.jsx(dV,{endpoint:a})]}),selection:{selectHandler:()=>{const e=x.find((e=>e.label===u));let n;n=0===(null==e?void 0:e.value)?null:Date.now()+(e?e.value:0);const s=e=>{f(e,n),t(!1)};mV.has(a)||mV.has(r??"")?i.handleSubmit((e=>{const n=a===Nu.azureOpenAI,r=n||a===Nu.openAI||a===Nu.gptPlugins||Mu(a);n&&(e.apiKey="n/a");const l=Object.keys(e).filter((t=>!(!n&&t.startsWith("azure"))&&((!r||"baseURL"!==t)&&(!("baseURL"===t&&!o)&&""===e[t]))));if(l.length>0)return h({message:"The following fields are required: "+l.join(", "),status:"error"}),void t(!0);const{apiKey:c,baseURL:d,...u}=e,m={apiKey:c,baseURL:d};n&&(m.apiKey=JSON.stringify({azureOpenAIApiKey:u.azureOpenAIApiKey,azureOpenAIApiInstanceName:u.azureOpenAIApiInstanceName,azureOpenAIApiDeploymentName:u.azureOpenAIApiDeploymentName,azureOpenAIApiVersion:u.azureOpenAIApiVersion})),s(JSON.stringify(m)),i.reset()}))():(s(l),c(""))},selectClasses:"btn btn-primary",selectText:g("com_ui_submit")},leftButtons:s.jsx(eU,{endpoint:a,disabled:!b,setDialogOpen:t})})})},hV=({keyDialogOpen:e,keyDialogEndpoint:t,onOpenChange:n,endpointsConfig:a})=>s.jsx(s.Fragment,{children:t&&s.jsx(fV,{open:e,endpoint:t,endpointType:Sb(a,t,"type"),onOpenChange:n,userProvideURL:Sb(a,t,"userProvideURL")})});function gV(){const e=Uk(),{agentsMap:t,modelSpecs:a,mappedEndpoints:r,endpointsConfig:o,searchValue:i,searchResults:l,selectedValues:c,setSearchValue:d,setSelectedValues:u,keyDialogOpen:m,onOpenChange:p,keyDialogEndpoint:f}=Cz(),h=n.useMemo((()=>function({mappedEndpoints:e,selectedValues:t,modelSpecs:n,endpointsConfig:s}){var a;const{endpoint:r,model:o,modelSpec:i}=t;if(i){const e=n.find((e=>e.name===i));if(!e)return null;const{showIconInHeader:t=!0}=e;return t?S.createElement(jz,{currentSpec:e,endpointsConfig:s}):null}if(r&&o){const t=e.find((e=>e.value===r));if(!t)return null;if(null==(a=t.modelIcons)?void 0:a[o]){const e=t.modelIcons[o];return S.createElement("div",{className:"h-5 w-5 overflow-hidden rounded-full"},S.createElement("img",{src:e,alt:o,className:"h-full w-full object-cover"}))}return t.icon||S.createElement(Ne,{size:20,className:"icon-md shrink-0 text-text-primary"})}if(r){const t=e.find((e=>e.value===r));return(null==t?void 0:t.icon)||null}return null}({mappedEndpoints:r??[],selectedValues:c,modelSpecs:a,endpointsConfig:o})),[r,c,a,o]),g=n.useMemo((()=>wz({localize:e,agentsMap:t,modelSpecs:a,selectedValues:c,mappedEndpoints:r})),[e,t,a,c,r]),x=s.jsxs("button",{className:"my-1 flex h-10 w-full max-w-[70vw] items-center justify-center gap-2 rounded-xl border border-border-light bg-surface-secondary px-3 py-2 text-sm text-text-primary hover:bg-surface-tertiary","aria-label":e("com_ui_select_model"),children:[h&&S.isValidElement(h)&&s.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:h}),s.jsx("span",{className:"flex-grow truncate text-left",children:g})]});return s.jsxs("div",{className:"relative flex w-full max-w-md flex-col items-center gap-2",children:[s.jsx(Sz,{values:c,onValuesChange:e=>{u({endpoint:e.endpoint||"",model:e.model||"",modelSpec:e.modelSpec||""})},onSearch:e=>d(e),combobox:s.jsx("input",{placeholder:e("com_endpoint_search_models")}),trigger:x,children:l?Dz(l,e,i):s.jsxs(s.Fragment,{children:[(v=a,b=c.modelSpec||"",v&&0!==v.length?v.map((e=>s.jsx(Rz,{spec:e,isSelected:b===e.name},e.name))):null),Lz(r??[])]})}),s.jsx(hV,{keyDialogOpen:m,onOpenChange:p,endpointsConfig:o||{},keyDialogEndpoint:f||void 0})]});var v,b}function xV({startupConfig:e}){return s.jsx(yz,{children:s.jsx(kz,{startupConfig:e,children:s.jsx(gV,{})})})}function vV({isSharedButtonEnabled:e}){const t=Uk(),[a,r]=n.useState(!1),[o,i]=n.useState(!1),[l,c]=n.useState(!1),d=n.useId(),u=n.useRef(null),m=n.useRef(null),p=Wi("(max-width: 768px)"),f=Ae(Cy.conversationByIndex(0));if(!1===(f&&null!=f.conversationId&&"new"!==f.conversationId&&"search"!==f.conversationId))return null;const h=[{label:t("com_ui_share"),onClick:()=>{c(!0)},icon:s.jsx(Qt,{className:"icon-md mr-2 text-text-secondary"}),show:e,hideOnClick:!1,ref:u,render:e=>s.jsx("button",{...e})},{label:t("com_endpoint_export"),onClick:()=>{r(!0)},icon:s.jsx(Ns,{className:"icon-md mr-2 text-text-secondary"}),hideOnClick:!1,ref:m,render:e=>s.jsx("button",{...e})}];return s.jsxs(s.Fragment,{children:[s.jsx(Nd,{portal:!0,menuId:d,focusLoop:!0,unmountOnHide:!0,isOpen:o,setIsOpen:i,trigger:s.jsx(Dl,{description:t("com_endpoint_export_share"),render:s.jsx(ie,{id:"export-menu-button","aria-label":"Export options",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(Qt,{className:"icon-md text-text-secondary","aria-hidden":"true",focusable:"false"})})}),items:h,className:p?"":"absolute right-0 top-0 mt-2"}),s.jsx(zz,{open:a,onOpenChange:r,conversation:f,triggerRef:m,"aria-label":t("com_ui_export_convo_modal")}),s.jsx(ND,{triggerRef:u,conversationId:f.conversationId??"",open:l,onOpenChange:c})]})}const bV=()=>{const e=Uk(),t=pr(),{showToast:a}=$d(),r=Ae(Cy.conversationByIndex(0))||void 0,o=(null==r?void 0:r.conversationId)??"",i=(e=>{const t=Pe(Cy.updateConversationSelector(e)),{updateTagsInConversation:n}=uj();return s=>{e&&(n(e,s),t({tags:s}))}})(o),l=null==r?void 0:r.tags,c=null!=(null==r?void 0:r.expiredAt),d=n.useId(),[u,m]=n.useState(!1),[p,f]=n.useState(!1),h=((e,t)=>{const n=hj(),{updateTagsInConversation:s}=uj();return fr((t=>fx.addTagToConversation(e,t)),{onSuccess:(a,...r)=>{var o;n.refetch(),s(e,a),null==(o=null==t?void 0:t.onSuccess)||o.call(t,a,...r)},onError:null==t?void 0:t.onError,onMutate:null==t?void 0:t.onMutate})})(o,{onSuccess:(e,t)=>{i(e);const n=document.getElementById(t.tag);console.log("tagElement",n),n&&setTimeout((()=>n.focus()),2)},onError:()=>{a({message:"Error adding bookmark",severity:jv.ERROR})},onMutate:e=>{const t=document.getElementById(e.tag);console.log("tagElement",t),t&&setTimeout((()=>t.focus()),2)}}),{data:g}=hj(),x=Boolean(r&&o&&o!==dh.NEW_CONVO&&"search"!==o),v=n.useCallback((e=>{if(void 0===e||""===e||!o)return void a({message:"Invalid tag or conversationId",severity:jv.ERROR});a_.log("tag_mutation","BookmarkMenu - handleSubmit: tags before setting",l);const n=(t.getQueryData([ex.conversationTags])??[]).map((e=>e.tag)),s=null==l?void 0:l.filter((e=>n.includes(e)));a_.log("tag_mutation","BookmarkMenu - handleSubmit: tags after filtering",s);const r=!0===(null==s?void 0:s.includes(e))?s.filter((t=>t!==e)):[...s??[],e];a_.log("tag_mutation","BookmarkMenu - handleSubmit: tags after",r),h.mutate({tags:r,tag:e})}),[l,o,h,t,a]),b=n.useRef(null),_=n.useMemo((()=>{const t=[{id:"%___new___bookmark___%",label:e("com_ui_bookmarks_new"),icon:s.jsx(nn,{className:"size-4"}),hideOnClick:!1,ref:b,render:e=>s.jsx("button",{...e}),onClick:()=>f(!0)}];if(g)for(const e of g){const n=null==l?void 0:l.includes(e.tag);t.push({id:e.tag,label:e.tag,hideOnClick:!1,icon:!0===n?s.jsx(Ya,{className:"size-4"}):s.jsx(Xa,{className:"size-4"}),onClick:()=>v(e.tag),disabled:h.isLoading})}return t}),[l,g,v,h.isLoading,e]);if(!x)return null;if(c)return null;return s.jsxs(mS.Provider,{value:{bookmarks:g||[]},children:[s.jsx(Nd,{portal:!0,menuId:d,focusLoop:!0,isOpen:u,unmountOnHide:!0,setIsOpen:m,keyPrefix:`${o}-bookmark-`,trigger:s.jsx(Dl,{description:e("com_ui_bookmarks_add"),render:s.jsx(ie,{id:"bookmark-menu-button","aria-label":e("com_ui_bookmarks_add"),className:s_("mt-text-sm flex size-10 flex-shrink-0 items-center justify-center gap-2 rounded-xl border border-border-light text-sm transition-colors duration-200 hover:bg-surface-hover",u?"bg-surface-hover":""),"data-testid":"bookmark-menu",children:h.isLoading?s.jsx(rc,{"aria-label":"Spinner"}):((null==l?void 0:l.length)??0)>0?s.jsx(Ya,{className:"icon-sm","aria-label":"Filled Bookmark"}):s.jsx(Xa,{className:"icon-sm","aria-label":"Bookmark"})})}),items:_}),s.jsx(DP,{tags:l,open:p,setTags:i,setOpen:f,triggerRef:b,conversationId:o,context:"BookmarkMenu - BookmarkEditDialog"})]})};function _V(){const e=Uk(),[t,n]=Ie(Cy.isTemporary),{conversation:a,isSubmitting:r}=Mk(),o={icon:Ts,label:"com_ui_temporary",atom:Cy.isTemporary},i=Re((()=>()=>{n(!t)}),[t]);return Array.isArray(null==a?void 0:a.messages)&&a.messages.length>=1||r?null:s.jsx("div",{className:"relative flex flex-wrap items-center gap-2",children:s.jsx(Dl,{description:e(o.label),render:s.jsx("button",{onClick:i,"aria-label":e(o.label),className:s_("inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",t?"bg-surface-active shadow-md":"bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md","active:shadow-inner"),children:o.icon&&s.jsx(o.icon,{className:s_("relative h-5 w-5 md:h-4 md:w-4",!1)})})})})}function yV(){const{conversation:e}=Mk(),{setConversation:t}=oS(),n=Uk();return e?Mu(e.endpoint)?null:s.jsx(Dl,{id:"add-multi-conversation-button","aria-label":n("com_ui_add_multi_conversation"),description:n("com_ui_add_multi_conversation"),tabIndex:0,role:"button",onClick:()=>{const{title:n,...s}=e??{};t({...s,title:""});const a=document.getElementById(gv);a&&a.focus()},"data-testid":"parameters-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:s.jsx(bt,{size:16,"aria-label":"Plus Icon"})}):null}const jV=Gf().interface;function wV(){const{data:e}=Wy(),{navVisible:t,setNavVisible:a}=ct(),r=n.useMemo((()=>(null==e?void 0:e.interface)??jV),[e]),o=Qk({permissionType:Zh.BOOKMARKS,permission:Jh.USE}),i=Qk({permissionType:Zh.MULTI_CONVO,permission:Jh.USE}),l=Wi("(max-width: 768px)");return s.jsxs("div",{className:"sticky top-0 z-10 flex h-14 w-full items-center justify-between bg-white p-2 font-semibold text-text-primary dark:bg-gray-800",children:[s.jsxs("div",{className:"hide-scrollbar flex w-full items-center justify-between gap-2 overflow-x-auto",children:[s.jsxs("div",{className:"mx-1 flex items-center gap-2",children:[s.jsxs("div",{className:`flex items-center gap-2 ${l?"":"transition-all duration-200 ease-in-out"} ${t?"pointer-events-none translate-x-[-100px] opacity-0":"translate-x-0 opacity-100"}`,children:[s.jsx(yL,{setNavVisible:a,className:"max-md:hidden"}),s.jsx(jL,{})]}),s.jsxs("div",{className:`flex items-center gap-2 ${l?"":"transition-all duration-200 ease-in-out"} ${t?"translate-x-[-100px]":"translate-x-0"}`,children:[s.jsx(xV,{startupConfig:e}),!0===r.presets&&r.modelSelect&&s.jsx(_L,{}),!0===o&&s.jsx(bV,{}),!0===i&&s.jsx(yV,{}),l&&s.jsxs(s.Fragment,{children:[s.jsx(vV,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),s.jsx(_V,{})]})]})]}),!l&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(vV,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),s.jsx(_V,{})]})]}),s.jsx("div",{})]})}function NV(){return s.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:s.jsx("div",{className:"relative flex h-full items-center justify-center",children:s.jsx(rc,{className:"text-text-primary"})})})}const CV=n.memo((function({index:e=0}){const{conversationId:t}=nt(),a=Ae(Cy.submissionByIndex(e)),r=Ae(Cy.submissionByIndex(e+1)),o=Ae(Cy.centerFormOnLanding),i=aS(),{data:l=null,isLoading:c}=aj(t??"",{select:n.useCallback((e=>{const t=Lh({messages:e,fileMap:i});return 0===(null==t?void 0:t.length)?null:t??null}),[i]),enabled:!!i}),d=cT(e,t),u=function({rootIndex:e}){const t=n.useMemo((()=>e+1),[e]),{ask:s,regenerate:a,setMessages:r,getMessages:o,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d}=dT({rootIndex:e,currentIndex:t}),{generateConversation:u}=uT({index:t,rootIndex:e,setConversation:c});return{ask:s,regenerate:a,getMessages:o,setMessages:r,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d,generateConversation:u,addedIndex:t}}({rootIndex:e});CE(a,d,!1),CE(r,u,!0);const m=Vo({defaultValues:{text:""}});let p;const f=!(l&&0!==l.length||t!==dh.NEW_CONVO&&t),h=(!l||0===l.length)&&null!=t;return p=c&&t!==dh.NEW_CONVO?s.jsx(NV,{}):!c&&!h||f?f?s.jsx(bz,{centerFormOnLanding:o}):s.jsx(eF,{messagesTree:l}):s.jsx(NV,{}),s.jsx(dS,{...m,children:s.jsx(Ak.Provider,{value:d,children:s.jsx(rS.Provider,{value:u,children:s.jsx(IF,{children:s.jsxs("div",{className:"flex h-full w-full flex-col",children:[!c&&s.jsx(wV,{}),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:s_("flex flex-col",f?"flex-1 items-center justify-end sm:justify-center":"h-full overflow-y-auto"),children:[p,s.jsxs("div",{className:s_("w-full",f&&"max-w-3xl transition-all duration-200 xl:max-w-4xl"),children:[s.jsx(gz,{index:e}),f?s.jsx(dD,{}):s.jsx(iD,{})]})]}),f&&s.jsx(iD,{})]})]})})})})})}));function kV(){const{data:e}=Wy(),{isAuthenticated:t,user:a}=function(){const{user:e,isAuthenticated:t}=qk(),s=Fe();return n.useEffect((()=>{const e=setTimeout((()=>{t||s("/login",{replace:!0})}),300);return()=>{clearTimeout(e)}}),[t,s]),{user:e,isAuthenticated:t}}(),r=Re((({set:e})=>t=>{e(yy.isTemporary,t)}),[]);pT({startupConfig:e,user:a});const{conversationId:o=""}=nt();!function(e){const t=n.useRef(null),s=Oe(Cy.visibleArtifacts);n.useEffect((()=>{e!==t.current&&(a_.log("conversation","Conversation ID change"),s()),t.current=e}),[e,s])}(o);const{hasSetConversation:i,conversation:l}=Cy.useCreateConversationAtom(0),{newConversation:c}=lT(),d=fk({enabled:t,refetchOnMount:"always"}),u=((e,t)=>{const n=pr();return mr([ex.conversation,e],(()=>{const t=ib(n.getQueryData([ex.allConversations],{exact:!1}),e);return t&&null!=t.messages?t:fx.getConversationById(e)}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})(o,{enabled:t&&o!==dh.NEW_CONVO&&!i.current}),m=Ky({enabled:t}),p=Ok(),f=!(!l||!l.expiredAt);return n.useEffect((()=>{o===dh.NEW_CONVO||f?f&&r(f):r(!1)}),[o,f,r]),n.useEffect((()=>{var t;if((e&&!i.current&&!(null==(t=d.data)?void 0:t.initial))??!1)if(o===dh.NEW_CONVO&&m.data&&d.data){const t=Ib(e);a_.log("conversation","ChatRoute, new convo effect",l),c({modelsData:d.data,template:l||void 0,...t?{preset:Pb(t)}:{}}),i.current=!0}else if(u.data&&m.data&&d.data)a_.log("conversation","ChatRoute initialConvoQuery",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),i.current=!0;else if(o===dh.NEW_CONVO&&p[Nu.assistants]&&p[Nu.azureAssistants]){const t=Ib(e);a_.log("conversation","ChatRoute new convo, assistants effect",l),c({modelsData:d.data,template:l||void 0,...t?{preset:Pb(t)}:{}}),i.current=!0}else p[Nu.assistants]&&p[Nu.azureAssistants]&&(a_.log("conversation","ChatRoute convo, assistants effect",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),i.current=!0)}),[e,u.data,m.data,d.data,p]),m.isLoading||d.isLoading?s.jsx("div",{className:"flex h-screen items-center justify-center","aria-live":"polite",role:"status",children:s.jsx(rc,{className:"text-text-primary"})}):t?(null==l?void 0:l.conversationId)===dh.SEARCH?null:((null==l?void 0:l.conversationId)===o||l)&&o?s.jsx(TS,{conversationId:l.conversationId??"",children:s.jsx(CV,{index:0})}):null:null}const SV=S.forwardRef(((e,t)=>s.jsx("div",{className:s_("relative flex w-full grow overflow-hidden bg-white dark:bg-gray-800",e.className),children:s.jsx("div",{className:"transition-width relative h-full w-full flex-1 overflow-auto bg-white dark:bg-gray-800",children:s.jsx("div",{className:"flex h-full flex-col",role:"presentation",tabIndex:0,children:s.jsx("div",{className:"flex-1 overflow-hidden overflow-y-auto",children:s.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:s.jsx("div",{ref:t,style:{height:"100%",overflowY:"auto",width:"100%"},children:s.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e.children,s.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})})})})));function TV({message:e}){const t=Uk(),n=pr(),a=Ae(Cy.search),{navigateToConvo:r}=gT(),o=e.conversationId??"";return o?s.jsx("div",{className:"visible mt-0 flex items-center justify-center gap-1 self-end text-text-secondary lg:justify-start",children:s.jsxs("button",{type:"button",className:"ml-0 flex cursor-pointer items-center gap-1.5 rounded-md p-1 text-xs hover:text-text-primary hover:underline",onClick:async t=>{if(t.preventDefault(),!o)return;let s=e.title??"",i=n.getQueryData([ex.conversation,o]);const l=n.getQueryData([ex.allConversations,{search:a.debouncedQuery}]);!i&&l&&(i=ib(l,o)),s||(s=(null==i?void 0:i.title)??""),document.title=s,r(i??{conversationId:o,title:s},{resetLatestMessage:!0})},title:t("com_ui_go_to_conversation"),children:[s.jsx(Zt,{className:"icon-sm"}),e.title]})}):null}const EV=({iconData:e})=>s.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:s.jsx("div",{className:"pt-0.5",children:s.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:s.jsx(HD,{iconData:e})})})}),RV=({message:e,messageLabel:t,fontSize:n})=>s.jsxs("div",{className:s_("relative flex w-11/12 flex-col",e.isCreatedByUser?"":"agent-turn"),children:[s.jsx("div",{className:s_("select-none font-semibold",n),children:t}),s.jsx(JO,{message:e}),s.jsxs(sD,{classes:"text-xs",children:[s.jsx(jO,{message:e}),s.jsx(TV,{message:e})]})]});function IV({message:e}){const t=Ae(Cy.UsernameDisplay),a=Ae(Cy.fontSize),{user:r}=qk(),o=Uk(),i=n.useMemo((()=>({endpoint:(null==e?void 0:e.endpoint)??"",model:(null==e?void 0:e.model)??"",iconURL:(null==e?void 0:e.iconURL)??"",isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1})),[null==e?void 0:e.endpoint,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.isCreatedByUser]),l=n.useMemo((()=>(null==e?void 0:e.isCreatedByUser)?t?((null==r?void 0:r.name)??"")||((null==r?void 0:r.username)??""):o("com_user_message"):(null==e?void 0:e.sender)??""),[null==e?void 0:e.isCreatedByUser,null==e?void 0:e.sender,t,null==r?void 0:r.name,null==r?void 0:r.username,o]);return e?s.jsx("div",{className:"text-token-text-primary w-full bg-transparent",children:s.jsx("div",{className:"m-auto p-4 py-2 md:gap-6",children:s.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-3xl md:px-5 lg:max-w-[40rem] lg:px-1 xl:max-w-[48rem] xl:px-5",children:[s.jsx(EV,{iconData:i}),s.jsx(RV,{message:e,messageLabel:l,fontSize:a})]})})}):null}function PV(){var e;const t=Uk(),a=aS(),{showToast:r}=$d(),{isAuthenticated:o}=qk(),i=Ae(Cy.search),l=i.debouncedQuery,{data:c,isLoading:d,isError:u,fetchNextPage:m,isFetchingNextPage:p,hasNextPage:f}=((e,t)=>{const{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}=e;return hr({queryKey:[ex.messages,{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}],queryFn:({pageParam:e})=>fx.listMessages({sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})})({search:l||void 0},{enabled:o&&!!l,staleTime:3e4,cacheTime:3e5}),{containerRef:h}=wT({nextCursor:null==(e=null==c?void 0:c.pages[c.pages.length-1])?void 0:e.nextCursor,setShowLoading:()=>({}),fetchNextPage:m,isFetchingNext:p}),g=n.useMemo((()=>{const e=(null==c?void 0:c.pages.flatMap((e=>e.messages.map((e=>e.files&&a?{...e,files:e.files.map((e=>a[e.file_id??""]??e))}:e)))))||[];return 0===e.length?null:e}),[a,null==c?void 0:c.pages]);n.useEffect((()=>{u&&l&&r({message:"An error occurred during search",status:"error"})}),[u,l,r]);return i.isTyping||d||p?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(rc,{className:"text-text-primary"})}):l?s.jsxs(SV,{ref:h,className:"relative flex h-full pt-4",children:[g&&0===g.length||null==g?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"rounded-lg bg-white p-6 text-lg text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:t("com_ui_nothing_found")})}):s.jsxs(s.Fragment,{children:[g.map((e=>s.jsx(IV,{message:e},e.messageId))),p&&s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(rc,{className:"text-text-primary"})})]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[5%] bg-gradient-to-t from-gray-50 to-transparent dark:from-gray-800"})]}):null}const AV=({open:e,onOpenChange:t,onAccept:a,onDecline:r,title:o,modalContent:i})=>{const l=Uk(),{showToast:c}=$d(),d=(e=>{const t=pr();return fr((()=>fx.acceptTerms()),{onSuccess:(n,s,a)=>{var r;t.setQueryData([ex.userTerms],{termsAccepted:!0}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)},onError:null==e?void 0:e.onError,onMutate:null==e?void 0:e.onMutate})})({onSuccess:()=>{a(),t(!1)},onError:()=>{c({message:"Failed to accept terms"})}}),u=n.useMemo((()=>"string"==typeof i?i:Array.isArray(i)?i.join("\n"):""),[i]);return s.jsx(ml,{open:e,onOpenChange:n=>{e&&!n||t(n)},children:s.jsx(Dd,{title:o??l("com_ui_terms_and_conditions"),className:"w-11/12 max-w-3xl sm:w-3/4 md:w-1/2 lg:w-2/5",showCloseButton:!1,showCancelButton:!1,main:s.jsx("section",{tabIndex:0,className:"max-h-[60vh] overflow-y-auto p-4","aria-label":l("com_ui_terms_and_conditions"),children:s.jsx("div",{className:"prose dark:prose-invert w-full max-w-none !text-text-primary",children:""!==u?s.jsx(DA,{content:u}):s.jsx("p",{children:l("com_ui_no_terms_content")})})}),buttons:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{r(),t(!1)},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-surface-active",children:l("com_ui_decline")}),s.jsx("button",{onClick:()=>{d.mutate()},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-green-500 hover:text-white focus:bg-green-500 focus:text-white dark:hover:bg-green-600 dark:focus:bg-green-600",children:l("com_ui_accept")})]})})})};function MV(){var e,t,a,r;const[o,i]=n.useState(!1),[l,c]=n.useState(0),[d,u]=n.useState((()=>{const e=localStorage.getItem("navVisible");return null===e||JSON.parse(e)})),{isAuthenticated:m,logout:p}=qk();((e=!1)=>{const t=pr(),s=n.useRef(!1),a=n.useRef(null),r=n.useRef(null);n.useEffect((()=>{if(!e)return;if(s.current)return;s.current=!0;const n=setTimeout((()=>{const e=async()=>{try{await t.fetchQuery([ex.health],(()=>fx.healthCheck()),{retry:!1,cacheTime:0,staleTime:0})}catch(e){console.error("Health check failed:",e)}};e(),a.current=setInterval(e,th.TEN_MINUTES);const n=async()=>{const n=t.getQueryState([ex.health]);if(!(null==n?void 0:n.dataUpdatedAt))return void(await e());const s=new Date(n.dataUpdatedAt),a=new Date(Date.now()-th.TEN_MINUTES);a_.log(`Last health check: ${s.toISOString()}`),a_.log(`Ten minutes ago: ${a.toISOString()}`),s<a&&await e()};r.current=n,window.addEventListener("focus",n)}),500);return()=>{clearTimeout(n),a.current&&(clearInterval(a.current),a.current=null),r.current&&(window.removeEventListener("focus",r.current),r.current=null)}}),[e,t])})(m);const f=function({isAuthenticated:e}){const{data:t={}}=xj(Nu.assistants,void 0,{select:e=>Cv(e.data),enabled:e}),{data:n={}}=xj(Nu.azureAssistants,void 0,{select:e=>Cv(e.data),enabled:e});return{[Nu.assistants]:t,[Nu.azureAssistants]:n}}({isAuthenticated:m}),h=Dk({isAuthenticated:m}),g=function({isAuthenticated:e}){const{data:t}=Qy({select:Nv,enabled:e});return t}({isAuthenticated:m}),{data:x}=Wy(),{data:v}=(e=>mr([ex.userTerms],(()=>fx.getUserTerms()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}))({enabled:m&&!0===(null==(t=null==(e=null==x?void 0:x.interface)?void 0:e.termsOfService)?void 0:t.modalAcceptance)});!function(e){const t=Pe(Cy.search),s=oj({enabled:e});n.useEffect((()=>{!0===s.data?t((e=>({...e,enabled:s.data}))):s.isError&&a_.error("Failed to get search enabled: ",s.error)}),[s.data,s.error,s.isError,t])}(m),n.useEffect((()=>{v&&i(!v.termsAccepted)}),[v]);return m?s.jsx(k_,{children:s.jsx(sS.Provider,{value:g,children:s.jsxs(vS.Provider,{value:f,children:[s.jsx(Fk.Provider,{value:h,children:s.jsxs(WS,{children:[s.jsx(FL,{onHeightChange:c}),s.jsx("div",{className:"flex",style:{height:`calc(100dvh - ${l}px)`},children:s.jsxs("div",{className:"relative z-0 flex h-full w-full overflow-hidden",children:[s.jsx(rV,{navVisible:d,setNavVisible:u}),s.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col overflow-hidden",children:[s.jsx(XU,{setNavVisible:u}),s.jsx(En,{context:{navVisible:d,setNavVisible:u}})]})]})})]})}),!0===(null==(r=null==(a=null==x?void 0:x.interface)?void 0:a.termsOfService)?void 0:r.modalAcceptance)&&s.jsx(AV,{open:o,onOpenChange:i,onAccept:()=>{i(!1)},onDecline:()=>{i(!1),p("/login?redirect=false")},title:x.interface.termsOfService.modalTitle,modalContent:x.interface.termsOfService.modalContent})]})})}):null}const LV=()=>s.jsxs(Wk,{children:[s.jsx(En,{}),s.jsx(QE,{})]}),OV=document.querySelector("base"),DV=(null==OV?void 0:OV.getAttribute("href"))||"/",FV=Ms([{path:"share/:shareId",element:s.jsx(cD,{}),errorElement:s.jsx(LL,{})},{path:"oauth",errorElement:s.jsx(LL,{}),children:[{path:"success",element:s.jsx(IL,{})},{path:"error",element:s.jsx(PL,{})}]},{path:"/",element:s.jsx(BL,{}),errorElement:s.jsx(LL,{}),children:[{path:"register",element:s.jsx(KE,{})},{path:"forgot-password",element:s.jsx(ZE,{})},{path:"reset-password",element:s.jsx(WE,{})}]},{path:"verify",element:s.jsx(qE,{}),errorElement:s.jsx(LL,{})},{element:s.jsx(LV,{}),errorElement:s.jsx(LL,{}),children:[{path:"/",element:s.jsx($L,{}),children:[{path:"login",element:s.jsx(GE,{})},{path:"login/2fa",element:s.jsx(JE,{})}]},yO,{path:"/",element:s.jsx(MV,{}),children:[{index:!0,element:s.jsx(Ln,{to:"/c/new",replace:!0})},{path:"c/:conversationId?",element:s.jsx(kV,{})},{path:"search",element:s.jsx(PV,{})},{path:"agents",element:s.jsx(eR,{children:s.jsx(RL,{})})},{path:"agents/:category",element:s.jsx(eR,{children:s.jsx(RL,{})})}]}]}],{basename:DV}),zV=()=>{const{setError:e}=TE(),t=new xr({queryCache:new vr({onError:t=>{var n;401===(null==(n=null==t?void 0:t.response)?void 0:n.status)&&e(t)}})}),n=function(){if(!Object.keys(u_).some((e=>e.startsWith("REACT_APP_THEME_"))))return;const e={},t=e=>u_[`REACT_APP_THEME_${e}`];return t("TEXT_PRIMARY")&&(e["rgb-text-primary"]=t("TEXT_PRIMARY")),t("TEXT_SECONDARY")&&(e["rgb-text-secondary"]=t("TEXT_SECONDARY")),t("TEXT_TERTIARY")&&(e["rgb-text-tertiary"]=t("TEXT_TERTIARY")),t("TEXT_WARNING")&&(e["rgb-text-warning"]=t("TEXT_WARNING")),t("SURFACE_PRIMARY")&&(e["rgb-surface-primary"]=t("SURFACE_PRIMARY")),t("SURFACE_SECONDARY")&&(e["rgb-surface-secondary"]=t("SURFACE_SECONDARY")),t("SURFACE_TERTIARY")&&(e["rgb-surface-tertiary"]=t("SURFACE_TERTIARY")),t("SURFACE_SUBMIT")&&(e["rgb-surface-submit"]=t("SURFACE_SUBMIT")),t("SURFACE_SUBMIT_HOVER")&&(e["rgb-surface-submit-hover"]=t("SURFACE_SUBMIT_HOVER")),t("SURFACE_DESTRUCTIVE")&&(e["rgb-surface-destructive"]=t("SURFACE_DESTRUCTIVE")),t("SURFACE_DESTRUCTIVE_HOVER")&&(e["rgb-surface-destructive-hover"]=t("SURFACE_DESTRUCTIVE_HOVER")),t("SURFACE_DIALOG")&&(e["rgb-surface-dialog"]=t("SURFACE_DIALOG")),t("SURFACE_CHAT")&&(e["rgb-surface-chat"]=t("SURFACE_CHAT")),t("BORDER_LIGHT")&&(e["rgb-border-light"]=t("BORDER_LIGHT")),t("BORDER_MEDIUM")&&(e["rgb-border-medium"]=t("BORDER_MEDIUM")),t("BORDER_HEAVY")&&(e["rgb-border-heavy"]=t("BORDER_HEAVY")),t("BORDER_XHEAVY")&&(e["rgb-border-xheavy"]=t("BORDER_XHEAVY")),t("BRAND_PURPLE")&&(e["rgb-brand-purple"]=t("BRAND_PURPLE")),t("HEADER_PRIMARY")&&(e["rgb-header-primary"]=t("HEADER_PRIMARY")),t("HEADER_HOVER")&&(e["rgb-header-hover"]=t("HEADER_HOVER")),t("PRESENTATION")&&(e["rgb-presentation"]=t("PRESENTATION")),Object.keys(e).length>0?e:void 0}();return s.jsx(br,{client:t,children:s.jsx(Es,{children:s.jsx(VE,{children:s.jsx(Pd,{...n&&{initialTheme:"system",themeRGB:n},children:s.jsx(Za,{children:s.jsx(Hd,{children:s.jsxs(rr,{backend:or,children:[s.jsx(Ls,{router:FV}),s.jsx(_r,{initialIsOpen:!1,position:"top-right"}),s.jsx(Ol,{}),s.jsx(Ja,{className:"pointer-events-none fixed inset-0 z-[1000] mx-auto my-2 flex max-w-[560px] flex-col items-stretch justify-start md:pb-5"})]})})})})})})})},UV=()=>s.jsxs(yT,{children:[s.jsx(zV,{}),s.jsx("iframe",{src:"assets/silence.mp3",allow:"autoplay",id:"audio",title:"audio-silence",style:{display:"none"}})]}),VV=document.getElementById("root");Rs.createRoot(VV).render(s.jsx(SE,{children:s.jsx(UV,{})}));export{rc as $,RU as A,mS as B,Zz as C,kl as D,Yc as E,yI as F,Wz as G,_m as H,CI as I,Jh as J,Rc as K,Ec as L,Cy as M,Sc as N,nc as O,fx as P,Zh as Q,Fc as R,YU as S,cl as T,Xm as U,Ri as V,Mi as W,Sl as X,Tl as Y,Rl as Z,$d as _,Uk as a,Il as a0,El as a1,Pl as a2,Qy as a3,ml as a4,xl as a5,vl as a6,_l as a7,qk as a8,rj as a9,sd as aa,Nc as ab,Kk as ac,Dl as b,s_ as c,qy as d,CT as e,Sy as f,nj as g,Qk as h,Wi as i,Wy as j,Cc as k,$c as l,dU as m,oU as n,ih as o,MU as p,Ei as q,Pi as r,Ai as s,ex as t,pS as u,Li as v,Ti as w,Lv as x,Ov as y,Si as z};
